<!DOCTYPE html><html class="appearance-auto" lang="zh-CN"><head><meta charset="UTF-8"><title>ğŸ¤– ååˆ†é’Ÿç”¨ Python å’Œ OpenAI åˆ›å»º Telegram æœºå™¨äººï¼ ğŸš€</title><meta name="description" content="May the Force be with you"><meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, initial-scale=1"><!-- Google Analytics --><!-- End Google Analytics -->
<!-- Baidu Analytics --><!-- End Baidu Analytics --><link rel="icon" href="/images/favicon.ico"><link rel="stylesheet" href="/style/common/bulma.css"><link rel="stylesheet" href="/style/base.css"><link rel="stylesheet" href="/style/common/helper.css"><script src="/js/common.js"></script><link rel="stylesheet" href="/style/post.css"><link rel="stylesheet" href="/style/themes/highlight-theme-light.css"><link rel="stylesheet" href="/style/common/jquery.fancybox.min.css"><script src="/js/highlight.pack.js"></script><meta name="description" content="ğŸ¤– ååˆ†é’Ÿç”¨ Python å’Œ OpenAI åˆ›å»º Telegram æœºå™¨äººï¼ ğŸš€åœ¨è¿™ä¸ªæœ‰è¶£çš„æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•åˆ›å»ºä¸€ä¸ªå…·æœ‰çš„ Telegram æœºå™¨äººï¼Œè¯¥æœºå™¨äººèƒ½å¤Ÿä¸ç”¨æˆ·èŠå¤©å¹¶ç”Ÿæˆå¹½é»˜å›å¤ã€‚æˆ‘ä»¬å°†è¯¦ç»†è§£é‡Šæ¯ä¸€æ­¥ï¼Œè®©æ‚¨è½»æ¾å…¥é—¨ï¼
æ­¥éª¤ 1ï¼šåˆ›å»º Telegram æœºå™¨äºº ğŸ¤–é¦–å…ˆï¼Œè®©æˆ‘ä»¬æ¥åˆ›å»ºæ‚¨è‡ªå·±çš„ Telegram æœºå™¨äººã€‚è¿™æ˜¯å¦‚ä½•åšçš„ï¼š

æ‰“å¼€ Telegram åº”ç”¨å¹¶æœç´¢ â€œBotFatherâ€ã€‚
åœ¨ BotFather èŠå¤©ä¸­ï¼Œä½¿ç”¨ /newbot å‘½ä»¤åˆ›å»ºä¸€ä¸ªæ–°æœºå™¨äººã€‚æ‚¨éœ€è¦ä¸ºæœºå™¨äººå–ä¸ªåå­—ï¼Œæ¯”å¦‚ â€œPunshineBotâ€ã€‚
BotFather ä¼šä¸ºæ‚¨ç”Ÿæˆä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„ API ä»¤ç‰Œï¼ˆTokenï¼‰ã€‚ä¸€å®šè¦å¦¥å–„ä¿å­˜è¿™ä¸ªä»¤ç‰Œï¼Œç¨åæˆ‘ä»¬ä¼šåœ¨ä»£ç ä¸­ç”¨åˆ°å®ƒã€‚



æ­¥éª¤ 2ï¼šå¯¼å…¥å¿…è¦çš„åº“ ï¿½.."><meta name="generator" content="Hexo 6.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="é»‘å¤´å‘†é±¼è¿›åŒ–ä¹‹æ—…" type="application/atom+xml">
</head><body class="is-flex is-flex-direction-column"><header class="header-widget is-flex-shrink-0 is-hidden-mobile"><div class="container is-fullhd is-flex is-justify-content-space-between is-align-items-center is-full-height"><section class="is-hidden-mobile is-flex-shrink-0"><h2><a href="/">user's blog</a></h2></section><h3 class="is-hidden-mobile is-family-serif is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height" id="postTopic"><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">ğŸ¤– ååˆ†é’Ÿç”¨ Python å’Œ OpenAI åˆ›å»º Telegram æœºå™¨äººï¼ ğŸš€</p><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">ç‚¹å‡»è¿”å›é¡¶éƒ¨</p></div></h3><aside class="is-flex-shrink-0"><h3 class="is-inline-block"><a href="/">é¦–é¡µ</a></h3><h3 class="is-inline-block"><a href="/about">å…³äº</a></h3><h3 class="is-inline-block"><a href="/archives">å½’æ¡£</a></h3></aside></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-center is-hidden-tablet"><h3 class="is-inline-block"><a href="/">é¦–é¡µ</a></h3><h3 class="is-inline-block"><a href="/about">å…³äº</a></h3><h3 class="is-inline-block"><a href="/archives">å½’æ¡£</a></h3></header><main><main class="container is-max-widescreen content section post-page pt-4 px-4"><div class="columns is-flex-desktop is-justify-content-center is-flex-direction-row-reverse"><div class="column is-3 is-hidden-mobile"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%F0%9F%A4%96-%E5%8D%81%E5%88%86%E9%92%9F%E7%94%A8-Python-%E5%92%8C-OpenAI-%E5%88%9B%E5%BB%BA-Telegram-%E6%9C%BA%E5%99%A8%E4%BA%BA%EF%BC%81-%F0%9F%9A%80"><span class="toc-text">ğŸ¤– ååˆ†é’Ÿç”¨ Python å’Œ OpenAI åˆ›å»º Telegram æœºå™¨äººï¼ ğŸš€</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4-1%EF%BC%9A%E5%88%9B%E5%BB%BA-Telegram-%E6%9C%BA%E5%99%A8%E4%BA%BA-%F0%9F%A4%96"><span class="toc-text">æ­¥éª¤ 1ï¼šåˆ›å»º Telegram æœºå™¨äºº ğŸ¤–</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4-2%EF%BC%9A%E5%AF%BC%E5%85%A5%E5%BF%85%E8%A6%81%E7%9A%84%E5%BA%93-%F0%9F%93%9A"><span class="toc-text">æ­¥éª¤ 2ï¼šå¯¼å…¥å¿…è¦çš„åº“ ğŸ“š</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4-3%EF%BC%9A%E8%AE%BE%E7%BD%AE-API-%E5%AF%86%E9%92%A5%E5%92%8C-Telegram-%E4%BB%A4%E7%89%8C-%F0%9F%94%91"><span class="toc-text">æ­¥éª¤ 3ï¼šè®¾ç½® API å¯†é’¥å’Œ Telegram ä»¤ç‰Œ ğŸ”‘</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4-4%EF%BC%9A%E5%88%9B%E5%BB%BA%E5%90%AF%E5%8A%A8%E5%92%8C%E5%B8%AE%E5%8A%A9%E5%91%BD%E4%BB%A4-%F0%9F%9A%80"><span class="toc-text">æ­¥éª¤ 4ï¼šåˆ›å»ºå¯åŠ¨å’Œå¸®åŠ©å‘½ä»¤ ğŸš€</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4-5%EF%BC%9A%E5%A4%84%E7%90%86%E7%94%A8%E6%88%B7%E6%B6%88%E6%81%AF-%F0%9F%93%A8"><span class="toc-text">æ­¥éª¤ 5ï¼šå¤„ç†ç”¨æˆ·æ¶ˆæ¯ ğŸ“¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4-6%EF%BC%9A%E8%BF%90%E8%A1%8C-Telegram-%E6%9C%BA%E5%99%A8%E4%BA%BA-%F0%9F%9A%80"><span class="toc-text">æ­¥éª¤ 6ï¼šè¿è¡Œ Telegram æœºå™¨äºº ğŸš€</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4-7%EF%BC%9A%E5%85%8D%E8%B4%B9%E5%9C%A8%E7%BA%BF%E6%89%98%E7%AE%A1%E6%82%A8%E7%9A%84-Telegram-%E6%9C%BA%E5%99%A8%E4%BA%BA-24-x2F-7-%F0%9F%9A%80"><span class="toc-text">æ­¥éª¤ 7ï¼šå…è´¹åœ¨çº¿æ‰˜ç®¡æ‚¨çš„ Telegram æœºå™¨äºº 24&#x2F;7 ğŸš€</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1%EF%BC%9A%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA-Python-%E8%84%9A%E6%9C%AC"><span class="toc-text">7.1ï¼šåˆ›å»ºä¸€ä¸ª Python è„šæœ¬</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2%EF%BC%9A%E5%AE%89%E8%A3%85%E6%89%80%E9%9C%80%E7%9A%84%E5%8C%85"><span class="toc-text">7.2ï¼šå®‰è£…æ‰€éœ€çš„åŒ…</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3%EF%BC%9A%E8%BF%90%E8%A1%8C%E6%9C%BA%E5%99%A8%E4%BA%BA"><span class="toc-text">7.3ï¼šè¿è¡Œæœºå™¨äºº</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E8%AF%AD"><span class="toc-text">ç»“è¯­</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#References"><span class="toc-text">References</span></a></li></ol></li></ol></li></ol></div><div class="column is-9"><header class="my-4"><a href="/tags/Chatbot"><i class="tag post-item-tag">Chatbot</i></a></header><h1 class="mt-0 mb-1 is-family-serif" id="postTitle">ğŸ¤– ååˆ†é’Ÿç”¨ Python å’Œ OpenAI åˆ›å»º Telegram æœºå™¨äººï¼ ğŸš€</h1><time class="has-text-grey" datetime="2023-09-23T19:12:03.000Z">2023-09-24</time><article class="mt-2 post-content"><h1 id="ğŸ¤–-ååˆ†é’Ÿç”¨-Python-å’Œ-OpenAI-åˆ›å»º-Telegram-æœºå™¨äººï¼-ğŸš€"><a href="#ğŸ¤–-ååˆ†é’Ÿç”¨-Python-å’Œ-OpenAI-åˆ›å»º-Telegram-æœºå™¨äººï¼-ğŸš€" class="headerlink" title="ğŸ¤– ååˆ†é’Ÿç”¨ Python å’Œ OpenAI åˆ›å»º Telegram æœºå™¨äººï¼ ğŸš€"></a>ğŸ¤– ååˆ†é’Ÿç”¨ Python å’Œ OpenAI åˆ›å»º Telegram æœºå™¨äººï¼ ğŸš€</h1><p>åœ¨è¿™ä¸ªæœ‰è¶£çš„æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•åˆ›å»ºä¸€ä¸ªå…·æœ‰çš„ Telegram æœºå™¨äººï¼Œè¯¥æœºå™¨äººèƒ½å¤Ÿä¸ç”¨æˆ·èŠå¤©å¹¶ç”Ÿæˆå¹½é»˜å›å¤ã€‚æˆ‘ä»¬å°†è¯¦ç»†è§£é‡Šæ¯ä¸€æ­¥ï¼Œè®©æ‚¨è½»æ¾å…¥é—¨ï¼</p>
<h2 id="æ­¥éª¤-1ï¼šåˆ›å»º-Telegram-æœºå™¨äºº-ğŸ¤–"><a href="#æ­¥éª¤-1ï¼šåˆ›å»º-Telegram-æœºå™¨äºº-ğŸ¤–" class="headerlink" title="æ­¥éª¤ 1ï¼šåˆ›å»º Telegram æœºå™¨äºº ğŸ¤–"></a>æ­¥éª¤ 1ï¼šåˆ›å»º Telegram æœºå™¨äºº ğŸ¤–</h2><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬æ¥åˆ›å»ºæ‚¨è‡ªå·±çš„ Telegram æœºå™¨äººã€‚è¿™æ˜¯å¦‚ä½•åšçš„ï¼š</p>
<ol>
<li>æ‰“å¼€ Telegram åº”ç”¨å¹¶æœç´¢ â€œBotFatherâ€ã€‚</li>
<li>åœ¨ BotFather èŠå¤©ä¸­ï¼Œä½¿ç”¨ <code>/newbot</code> å‘½ä»¤åˆ›å»ºä¸€ä¸ªæ–°æœºå™¨äººã€‚æ‚¨éœ€è¦ä¸ºæœºå™¨äººå–ä¸ªåå­—ï¼Œæ¯”å¦‚ â€œPunshineBotâ€ã€‚</li>
<li>BotFather ä¼šä¸ºæ‚¨ç”Ÿæˆä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„ API ä»¤ç‰Œï¼ˆTokenï¼‰ã€‚ä¸€å®šè¦å¦¥å–„ä¿å­˜è¿™ä¸ªä»¤ç‰Œï¼Œç¨åæˆ‘ä»¬ä¼šåœ¨ä»£ç ä¸­ç”¨åˆ°å®ƒã€‚</li>
</ol>


<h2 id="æ­¥éª¤-2ï¼šå¯¼å…¥å¿…è¦çš„åº“-ğŸ“š"><a href="#æ­¥éª¤-2ï¼šå¯¼å…¥å¿…è¦çš„åº“-ğŸ“š" class="headerlink" title="æ­¥éª¤ 2ï¼šå¯¼å…¥å¿…è¦çš„åº“ ğŸ“š"></a>æ­¥éª¤ 2ï¼šå¯¼å…¥å¿…è¦çš„åº“ ğŸ“š</h2><p>æˆ‘ä»¬é¦–å…ˆéœ€è¦å¯¼å…¥ä¸€äº› Python åº“ï¼Œä»¥ä¾¿åˆ›å»º Telegram æœºå™¨äººå¹¶ä¸ OpenAI è¿›è¡Œè‡ªç„¶è¯­è¨€å¤„ç†ã€‚</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Final, Deque, <span class="type">Dict</span>, <span class="type">Union</span></span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> deque</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> openai</span><br><span class="line"><span class="keyword">from</span> telegram <span class="keyword">import</span> Update</span><br><span class="line"><span class="keyword">from</span> telegram.ext <span class="keyword">import</span> (</span><br><span class="line">    Application,</span><br><span class="line">    CommandHandler,</span><br><span class="line">    ContextTypes,</span><br><span class="line">    MessageHandler,</span><br><span class="line">    filters,</span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure>

<p>è¯·ç¡®ä¿æ‚¨å·²ç»å®‰è£…äº† Telegram Bot API å’Œ OpenAI Python åº“ã€‚</p>
<h2 id="æ­¥éª¤-3ï¼šè®¾ç½®-API-å¯†é’¥å’Œ-Telegram-ä»¤ç‰Œ-ğŸ”‘"><a href="#æ­¥éª¤-3ï¼šè®¾ç½®-API-å¯†é’¥å’Œ-Telegram-ä»¤ç‰Œ-ğŸ”‘" class="headerlink" title="æ­¥éª¤ 3ï¼šè®¾ç½® API å¯†é’¥å’Œ Telegram ä»¤ç‰Œ ğŸ”‘"></a>æ­¥éª¤ 3ï¼šè®¾ç½® API å¯†é’¥å’Œ Telegram ä»¤ç‰Œ ğŸ”‘</h2><p>åœ¨è¿™ä¸€æ­¥ï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½® OpenAI API å¯†é’¥å’Œ Telegram æœºå™¨äººä»¤ç‰Œã€‚ç¡®ä¿æ‚¨å·²ç»æ³¨å†Œäº† OpenAI å¹¶è·å–äº† API å¯†é’¥ã€‚ç„¶åï¼Œå°†ä¸‹é¢çš„ç¤ºä¾‹ä»£ç ä¸­çš„ API å¯†é’¥å’Œ Telegram ä»¤ç‰Œæ›¿æ¢ä¸ºæ‚¨è‡ªå·±çš„ï¼š</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">openai.api_key = <span class="string">"æ‚¨çš„ OpenAI API å¯†é’¥"</span></span><br><span class="line">TOKEN: Final = <span class="string">"æ‚¨çš„ Telegram æœºå™¨äººä»¤ç‰Œ"</span></span><br></pre></td></tr></tbody></table></figure>

<h2 id="æ­¥éª¤-4ï¼šåˆ›å»ºå¯åŠ¨å’Œå¸®åŠ©å‘½ä»¤-ğŸš€"><a href="#æ­¥éª¤-4ï¼šåˆ›å»ºå¯åŠ¨å’Œå¸®åŠ©å‘½ä»¤-ğŸš€" class="headerlink" title="æ­¥éª¤ 4ï¼šåˆ›å»ºå¯åŠ¨å’Œå¸®åŠ©å‘½ä»¤ ğŸš€"></a>æ­¥éª¤ 4ï¼šåˆ›å»ºå¯åŠ¨å’Œå¸®åŠ©å‘½ä»¤ ğŸš€</h2><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸¤ä¸ªå‘½ä»¤å¤„ç†å‡½æ•°ï¼Œç”¨äºå¤„ç†å¯åŠ¨å’Œå¸®åŠ©å‘½ä»¤ã€‚è¿™äº›å‘½ä»¤å…è®¸ç”¨æˆ·ä¸æœºå™¨äººè¿›è¡Œäº’åŠ¨ã€‚</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">start_command</span>(<span class="params">update: Update, context: ContextTypes.DEFAULT_TYPE</span>):</span><br><span class="line">    <span class="keyword">await</span> update.message.reply_text(<span class="string">"ä½ å¥½ä¸–ç•Œ! ğŸ˜„"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">help_command</span>(<span class="params">update: Update, context: ContextTypes.DEFAULT_TYPE</span>):</span><br><span class="line">    <span class="keyword">await</span> update.message.reply_text(<span class="string">"æˆ‘æ˜¯ PunShine Botï¼Œæˆ‘å¯ä»¥å¸®ä½ æ‰¾åˆ°æœ€æç¬‘çš„åŒå…³è¯­ï¼ ğŸ˜‚"</span>)</span><br></pre></td></tr></tbody></table></figure>

<p><code>start_command</code> å‡½æ•°ç”¨äºå¤„ç†å¯åŠ¨å‘½ä»¤ï¼Œå½“ç”¨æˆ·å‘é€ <code>/start</code> å‘½ä»¤æ—¶ï¼Œæœºå™¨äººå°†å›å¤ â€œä½ å¥½ä¸–ç•Œ! ğŸ˜„â€ã€‚<code>help_command</code> å‡½æ•°ç”¨äºå¤„ç†å¸®åŠ©å‘½ä»¤ï¼Œå½“ç”¨æˆ·å‘é€ <code>/help</code> å‘½ä»¤æ—¶ï¼Œæœºå™¨äººå°†å›å¤å¸®åŠ©ä¿¡æ¯ã€‚</p>
<h2 id="æ­¥éª¤-5ï¼šå¤„ç†ç”¨æˆ·æ¶ˆæ¯-ğŸ“¨"><a href="#æ­¥éª¤-5ï¼šå¤„ç†ç”¨æˆ·æ¶ˆæ¯-ğŸ“¨" class="headerlink" title="æ­¥éª¤ 5ï¼šå¤„ç†ç”¨æˆ·æ¶ˆæ¯ ğŸ“¨"></a>æ­¥éª¤ 5ï¼šå¤„ç†ç”¨æˆ·æ¶ˆæ¯ ğŸ“¨</h2><p>åœ¨è¿™ä¸€æ­¥ï¼Œæˆ‘ä»¬å®šä¹‰äº†å¤„ç†ç”¨æˆ·æ¶ˆæ¯çš„ <code>handle_response</code> å‡½æ•°ï¼Œå¹¶åˆ›å»ºäº†æ¶ˆæ¯å¤„ç†ç¨‹åº <code>message_handler</code>ã€‚è¿™ä¸ªå‡½æ•°å°†ç”¨æˆ·çš„æ¶ˆæ¯æ·»åŠ åˆ°å¯¹è¯å†å²è®°å½•ä¸­ï¼Œå¹¶ä½¿ç”¨ OpenAI API ç”Ÿæˆæœºå™¨äººçš„å›å¤ã€‚</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">handle_response</span>(<span class="params">chat_id: <span class="type">Union</span>[<span class="built_in">int</span>, <span class="built_in">str</span>], text: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="comment"># è·å–èŠå¤©å†å²è®°å½•</span></span><br><span class="line">    chat_history = get_chat_history(chat_id)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># åˆ›å»ºç”¨æˆ·æ¶ˆæ¯</span></span><br><span class="line">    user_message = {<span class="string">"role"</span>: <span class="string">"user"</span>, <span class="string">"content"</span>: text}</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å°†ç”¨æˆ·æ¶ˆæ¯æ·»åŠ åˆ°èŠå¤©å†å²è®°å½•</span></span><br><span class="line">    chat_history.append(user_message)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ„å»ºæ¶ˆæ¯åˆ—è¡¨ï¼ŒåŒ…æ‹¬ç³»ç»Ÿæ¶ˆæ¯å’Œç”¨æˆ·æ¶ˆæ¯</span></span><br><span class="line">    messages = [</span><br><span class="line">        {</span><br><span class="line">            <span class="string">"role"</span>: <span class="string">"system"</span>,</span><br><span class="line">            <span class="string">"content"</span>: <span class="string">"ä½ æ˜¯ PunshineBotï¼Œç”¨ä¸­æ–‡å›ç­”ï¼Œè¯­æ°”éšæ„ï¼Œåˆ«å¤ªæ­£å¼ï¼Œå¤šç”¨ emojiï¼Œå›å¤è¦ç®€çŸ­ä¸€ç‚¹ã€‚ ğŸ˜„ğŸš€"</span>,</span><br><span class="line">        }</span><br><span class="line">    ]</span><br><span class="line">    messages.extend(chat_history)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># ä½¿ç”¨ OpenAI API ç”Ÿæˆæœºå™¨äººçš„å›å¤</span></span><br><span class="line">    response = openai.ChatCompletion.create(</span><br><span class="line">        model=<span class="string">"gpt-3.5-turbo"</span>,</span><br><span class="line">        messages=messages,</span><br><span class="line">        temperature=<span class="number">1</span>,</span><br><span class="line">        max_tokens=<span class="number">256</span>,</span><br><span class="line">        top_p=<span class="number">1</span>,</span><br><span class="line">        frequency_penalty=<span class="number">0</span>,</span><br><span class="line">        presence_penalty=<span class="number">0</span>,</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    bot_response = response[<span class="string">"choices"</span>][<span class="number">0</span>][<span class="string">"message"</span>][<span class="string">"content"</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å°†æœºå™¨äººçš„å›å¤æ·»åŠ åˆ°å¯¹è¯å†å²è®°å½•</span></span><br><span class="line">    chat_history.append({<span class="string">"role"</span>: <span class="string">"assistant"</span>, <span class="string">"content"</span>: bot_response})</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> bot_response</span><br></pre></td></tr></tbody></table></figure>

<p><code>handle_response</code> å‡½æ•°å°†ç”¨æˆ·æ¶ˆæ¯æ·»åŠ åˆ°å¯¹è¯å†å²è®°å½•ä¸­ï¼Œç„¶åä½¿ç”¨ OpenAI API ç”Ÿæˆæœºå™¨äººçš„å›å¤ï¼Œå¹¶å°†æœºå™¨äººçš„å›å¤æ·»åŠ åˆ°å¯¹è¯å†å²è®°å½•ä¸­ï¼Œä»¥ä¿æŒä¸Šä¸‹æ–‡ã€‚</p>
<p><code>message_handler</code> å‡½æ•°ç”¨äºå¤„ç†ç”¨æˆ·å‘é€çš„æ¶ˆæ¯ã€‚å®ƒæ£€æŸ¥æ¶ˆæ¯çš„ç±»å‹ï¼ˆç¾¤ç»„æ¶ˆæ¯æˆ–ç§èŠæ¶ˆæ¯ï¼‰ä»¥åŠæ¶ˆæ¯çš„å†…å®¹ï¼Œç„¶åè°ƒç”¨ <code>handle_response</code> å‡½æ•°ç”Ÿæˆæœºå™¨äººçš„å›å¤ã€‚</p>
<h2 id="æ­¥éª¤-6ï¼šè¿è¡Œ-Telegram-æœºå™¨äºº-ğŸš€"><a href="#æ­¥éª¤-6ï¼šè¿è¡Œ-Telegram-æœºå™¨äºº-ğŸš€" class="headerlink" title="æ­¥éª¤ 6ï¼šè¿è¡Œ Telegram æœºå™¨äºº ğŸš€"></a>æ­¥éª¤ 6ï¼šè¿è¡Œ Telegram æœºå™¨äºº ğŸš€</h2><p>æœ€åï¼Œåœ¨ä¸»å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª Telegram æœºå™¨äººåº”ç”¨ç¨‹åºï¼Œå¹¶æ·»åŠ äº†å‘½ä»¤å¤„ç†ç¨‹åºå’Œæ¶ˆæ¯å¤„ç†ç¨‹åºã€‚ç„¶åï¼Œæˆ‘ä»¬å¯åŠ¨äº† Telegram æœºå™¨äººï¼Œä½¿å…¶å¯ä»¥æ¥æ”¶å’Œå¤„ç†æ¶ˆæ¯ã€‚</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    app = Application.builder().token(TOKEN).build()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ·»åŠ å‘½ä»¤å¤„ç†ç¨‹åº</span></span><br><span class="line">    app.add_handler(CommandHandler(<span class="string">"start"</span>, start_command))</span><br><span class="line">    app.add_handler(CommandHandler(<span class="string">"help"</span>, help_command))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ·»åŠ æ¶ˆæ¯å¤„ç†ç¨‹åº</span></span><br><span class="line">    app.add_handler(MessageHandler(filters.TEXT, callback=message_handler))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¯åŠ¨ Telegram æœºå™¨äºº</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"æœºå™¨äººå·²å¯åŠ¨ï¼ ğŸ˜ğŸ¤–"</span>)</span><br><span class="line">    app.run_polling(poll_interval=<span class="number">1</span>)</span><br></pre></td></tr></tbody></table></figure>




<p><code>app.run_polling(poll_interval=1)</code> å¯åŠ¨äº† Telegram æœºå™¨äººï¼Œä»¥æ¯ç§’çš„é—´éš”è½®è¯¢æ–°æ¶ˆæ¯ã€‚è¿™æ„å‘³ç€æœºå™¨äººä¼šä¸€ç›´è¿è¡Œï¼Œå¹¶åœ¨æ¥æ”¶åˆ°æ¶ˆæ¯æ—¶è§¦å‘ç›¸åº”çš„å¤„ç†ç¨‹åºã€‚</p>
<h2 id="æ­¥éª¤-7ï¼šå…è´¹åœ¨çº¿æ‰˜ç®¡æ‚¨çš„-Telegram-æœºå™¨äºº-24-x2F-7-ğŸš€"><a href="#æ­¥éª¤-7ï¼šå…è´¹åœ¨çº¿æ‰˜ç®¡æ‚¨çš„-Telegram-æœºå™¨äºº-24-x2F-7-ğŸš€" class="headerlink" title="æ­¥éª¤ 7ï¼šå…è´¹åœ¨çº¿æ‰˜ç®¡æ‚¨çš„ Telegram æœºå™¨äºº 24/7 ğŸš€"></a>æ­¥éª¤ 7ï¼šå…è´¹åœ¨çº¿æ‰˜ç®¡æ‚¨çš„ Telegram æœºå™¨äºº 24/7 ğŸš€</h2><p>åœ¨ä¹‹å‰çš„æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬æ•™æ‚¨å¦‚ä½•åˆ›å»ºä¸€ä¸ª Telegram æœºå™¨äººã€‚ä½†æ˜¯ï¼Œè¦ä½¿æ‚¨çš„æœºå™¨äººä¸€ç›´åœ¨çº¿è¿è¡Œï¼Œæ‚¨éœ€è¦è®©æ‚¨çš„è®¡ç®—æœºä¿æŒå¼€å¯ï¼Œè¿™å¯èƒ½ä¸å¤ªæ–¹ä¾¿ã€‚åœ¨è¿™ç¯‡åšå®¢ä¸­ï¼Œæˆ‘ä»¬å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•å°†æ‚¨çš„æœºå™¨äººå…è´¹æ‰˜ç®¡åœ¨äº‘æœåŠ¡å™¨ä¸Šï¼Œä»¥ä¾¿æ‚¨çš„æœºå™¨äººå¯ä»¥å…¨å¤©å€™åœ¨çº¿è¿è¡Œã€‚</p>
<p>PythonAnywhere æ˜¯ä¸€ä¸ªå…è®¸æ‚¨å…è´¹æ‰˜ç®¡ Python ä»£ç çš„ç½‘ç«™ï¼Œå®ƒå…·æœ‰ä¸€å®šçš„ä½¿ç”¨é™åˆ¶ï¼Œä½†å¯¹äºç®€å•çš„ç”¨é€”æ¥è¯´ï¼Œéå¸¸åˆé€‚ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†å±•ç¤ºå¦‚ä½•ä½¿ç”¨ PythonAnywhere æ¥æ‰˜ç®¡æ‚¨çš„ Telegram æœºå™¨äººã€‚</p>
<p>è®¿é—® <a target="_blank" rel="noopener" href="https://www.pythonanywhere.com/">PythonAnywhere ç½‘ç«™</a> å¹¶åˆ›å»ºä¸€ä¸ªå¸æˆ·ã€‚</p>


<h3 id="7-1ï¼šåˆ›å»ºä¸€ä¸ª-Python-è„šæœ¬"><a href="#7-1ï¼šåˆ›å»ºä¸€ä¸ª-Python-è„šæœ¬" class="headerlink" title="7.1ï¼šåˆ›å»ºä¸€ä¸ª Python è„šæœ¬"></a>7.1ï¼šåˆ›å»ºä¸€ä¸ª Python è„šæœ¬</h3><p>ä¸€æ—¦æ‚¨ç™»å½•åˆ° PythonAnywhere çš„ä»ªè¡¨æ¿ï¼Œæ‚¨å°†çœ‹åˆ°ä¸€ä¸ªåä¸º â€œFilesâ€ çš„é€‰é¡¹ã€‚ç‚¹å‡»å®ƒï¼Œç„¶ååˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ï¼Œæˆ‘ä»¬å°†å‘½åå®ƒä¸º â€œtelegram_bot.pyâ€ã€‚åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å°†ç²˜è´´ä¹‹å‰åˆ›å»ºçš„ Telegram æœºå™¨äººä»£ç ã€‚</p>
<h3 id="7-2ï¼šå®‰è£…æ‰€éœ€çš„åŒ…"><a href="#7-2ï¼šå®‰è£…æ‰€éœ€çš„åŒ…" class="headerlink" title="7.2ï¼šå®‰è£…æ‰€éœ€çš„åŒ…"></a>7.2ï¼šå®‰è£…æ‰€éœ€çš„åŒ…</h3><p>åœ¨è¿è¡Œ Telegram æœºå™¨äººä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å®‰è£…æ‰€éœ€çš„ Python åŒ…ã€‚PythonAnywhere æä¾›äº†ä¸€ä¸ªå‘½ä»¤è¡Œç•Œé¢ï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install python-telegram-bot</span><br><span class="line">pip install openai</span><br></pre></td></tr></tbody></table></figure>

<p>è¿™å°†å®‰è£… Telegram æœºå™¨äººåº“ï¼Œä½¿æ‚¨çš„ä»£ç èƒ½å¤Ÿä¸ Telegram æœåŠ¡å™¨é€šä¿¡ã€‚</p>
<h3 id="7-3ï¼šè¿è¡Œæœºå™¨äºº"><a href="#7-3ï¼šè¿è¡Œæœºå™¨äºº" class="headerlink" title="7.3ï¼šè¿è¡Œæœºå™¨äºº"></a>7.3ï¼šè¿è¡Œæœºå™¨äºº</h3><p>ç°åœ¨ï¼Œæ‚¨å¯ä»¥è¿”å›åˆ° PythonAnywhere çš„ä»ªè¡¨æ¿ï¼Œå¹¶åœ¨ â€œFilesâ€ ä¸‹æ‰¾åˆ°æ‚¨çš„ â€œtelegram_bot.pyâ€ æ–‡ä»¶ã€‚ç„¶åï¼Œç‚¹å‡» â€œRunâ€ æŒ‰é’®ï¼Œæ‚¨çš„æœºå™¨äººå°†å¼€å§‹è¿è¡Œã€‚æœºå™¨äººå°†ä¸€ç›´åœ¨çº¿ï¼Œå³ä½¿æ‚¨å…³é—­äº†è®¡ç®—æœºä¹Ÿæ˜¯å¦‚æ­¤ã€‚</p>
<h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>ç°åœ¨ï¼Œæ‚¨å·²ç»æŒæ¡äº†å¦‚ä½•åˆ›å»ºä¸€ä¸ª Python Telegram æœºå™¨äººï¼Œå¹¶ä¸ OpenAI é›†æˆï¼Œä½¿å…¶èƒ½å¤Ÿå›åº”ç”¨æˆ·çš„æ¶ˆæ¯å¹¶ç”Ÿæˆå›å¤ã€‚é€šè¿‡è¿™ä¸ªç®€å•çš„æ­¥éª¤ï¼Œæ‚¨å¯ä»¥å°†æ‚¨çš„ Telegram æœºå™¨äººå…è´¹æ‰˜ç®¡åœ¨äº‘æœåŠ¡å™¨ä¸Šï¼Œä»¥ä¾¿å®ƒå¯ä»¥å…¨å¤©å€™åœ¨çº¿è¿è¡Œã€‚è¿™æ ·ï¼Œæ‚¨å°±å¯ä»¥ä¸æ‚¨çš„æœºå™¨äººäº’åŠ¨ï¼Œè€Œä¸å¿…æ‹…å¿ƒè®¡ç®—æœºæ˜¯å¦å¼€å¯ã€‚å¦‚æœæ‚¨æœ‰å…¶ä»–å…è´¹æ‰˜ç®¡æœåŠ¡æˆ–å…¶ä»–é—®é¢˜ï¼Œæ¬¢è¿åœ¨è¯„è®ºä¸­åˆ†äº«ï¼ç¥æ‚¨çš„æœºå™¨äººè¿è¡Œæ„‰å¿«ï¼ğŸ¤–ğŸš€ğŸ˜„</p>
<p>å¦å¤–ï¼Œå¦‚æœæ‚¨æƒ³äº†è§£æ›´å¤šå…³äºå¦‚ä½•åœ¨ Discord ä¸Šæ‰˜ç®¡æœºå™¨äººçš„ä¿¡æ¯ï¼Œå¯ä»¥è§‚çœ‹æ­¤ YouTube è§†é¢‘ï¼š<a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=2TI-tCVhe9k">How To Host Your Bot Online 24/7 For FREE With Python (Telegram, Discord, Etc)</a>ã€‚è§†é¢‘ä¸­æœ‰æ›´è¯¦ç»†çš„æ•™ç¨‹å’Œç¤ºä¾‹ã€‚</p>
<p>å¦‚æœæ‚¨æœ‰ä»»ä½•é—®é¢˜æˆ–éœ€è¦è¿›ä¸€æ­¥çš„å¸®åŠ©ï¼Œè¯·éšæ—¶ç•™ä¸‹è¯„è®ºã€‚ç¥æ‚¨ç¼–ç¨‹æ„‰å¿«ï¼ ğŸš€ğŸ¤–ğŸ˜„</p>
<h3 id="References"><a href="#References" class="headerlink" title="References"></a>References</h3><ul>
<li><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=vZtm1wuA2yc">How To Create A Telegram Bot In Python For Beginners (2023 Tutorial)</a></li>
<li><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=2TI-tCVhe9k">How To Host Your Bot Online 24/7 For FREE With Python (Telegram, Discord, Etc)</a></li>
</ul>
</article><section class="jump-container is-flex is-justify-content-space-between my-6"><!-- em is empty placeholder--><a class="button is-default" href="/2023/09/24/NLP%20Insights/%E5%8D%81%E5%88%86%E9%92%9F%E7%94%A8%20Python%20%E5%92%8C%20OpenAI%20%E5%88%9B%E5%BB%BA%20Telegram%20%E6%9C%BA%E5%99%A8%E4%BA%BA.en/" title="ğŸ¤– ååˆ†é’Ÿç”¨ Python å’Œ OpenAI åˆ›å»º Telegram æœºå™¨äººï¼ ğŸš€"><i class="iconfont icon-prev mr-2 has-text-grey"></i><span class="has-text-weight-semibold">ä¸Šä¸€é¡µ: ğŸ¤– ååˆ†é’Ÿç”¨ Python å’Œ OpenAI åˆ›å»º Telegram æœºå™¨äººï¼ ğŸš€</span></a><a class="button is-default" href="/2023/09/13/Debugging%20Diaries/Resolving%20Port%20Conflicts:%20Identifying%20and%20Terminating%20Processes.en/" title="Resolving Port Conflicts: Identifying and Terminating Processes"><span class="has-text-weight-semibold">ä¸‹ä¸€é¡µ: Resolving Port Conflicts: Identifying and Terminating Processes</span><i class="iconfont icon-next ml-2 has-text-grey"></i></a></section><article class="mt-6 comment-container"><script async repo="Haojen/Claudia-theme-blog" src="https://utteranc.es/client.js" issue-term="pathname" theme="preferred-color-scheme"></script></article></div></div></main></main><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0 is-family-serif"><section class="sns-container"><a title="twitter" target="_blank" rel="noopener nofollow" href="//twitter.com//"><i class="iconfont icon-twitter"></i></a><!-- Github--><a title="github" target="_blank" rel="noopener nofollow" href="//github.com/haojen"><i class="iconfont icon-github"></i></a><!-- Ins--><a title="instagram" target="_blank" rel="noopener nofollow" href="//www.instagram.com//"><i class="iconfont icon-ins"></i></a><!-- RSS--><!-- çŸ¥ä¹--><!-- é¢†è‹±--><!-- è„¸ä¹¦--><a title="facebook" target="_blank" rel="noopener nofollow" href="//www.facebook.com//"><i class="iconfont icon-tian7_facebook"></i></a></section><p><span>Copyright Â©</span><span> user 2026</span></p><div class="is-flex is-justify-content-center is-flex-wrap-wrap"><p>Powered by Hexo &verbar;&nbsp;</p><p class="is-flex is-justify-content-center"><a title="Hexo theme author" target="_blank" rel="noopener" href="//github.com/haojen">Theme by Haojen&nbsp;</a></p><div style="margin-top: 2px"><a class="github-button" title="github-button" target="_blank" rel="noopener" href="https://github.com/haojen/hexo-theme-Claudia" data-color-scheme="no-preference: light; light: light; dark: dark;" data-show-count="true"></a></div></div><div><span></span></div></footer><script src="/js/lang-switch.js"></script><script async defer src="https://buttons.github.io/buttons.js"></script><script src="/js/jquery-3.6.1.min.js"></script><script src="/js/jquery-fancybox.min.js"></script><script src="/js/img_zoom.js"></script><script src="/js/post.js"></script></body></html>