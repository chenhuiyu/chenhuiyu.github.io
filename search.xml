<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title></title>
      <link href="/2026/02/21/NLP%20Insights/Evaluation%20of%20Generation-Based%20Large%20Language%20Models%20(LLMs):%20Opportunities%20and%20Challenges%20from%20Generation%20to%20Judgment/"/>
      <url>/2026/02/21/NLP%20Insights/Evaluation%20of%20Generation-Based%20Large%20Language%20Models%20(LLMs):%20Opportunities%20and%20Challenges%20from%20Generation%20to%20Judgment/</url>
      
        <content type="html"><![CDATA[<h1 id="Evaluation-of-Generation-Based-Large-Language-Models-LLMs-Opportunities-and-Challenges-from-Generation-to-Judgment"><a href="#Evaluation-of-Generation-Based-Large-Language-Models-LLMs-Opportunities-and-Challenges-from-Generation-to-Judgment" class="headerlink" title="Evaluation of Generation-Based Large Language Models (LLMs): Opportunities and Challenges from Generation to Judgment"></a>Evaluation of Generation-Based Large Language Models (LLMs): Opportunities and Challenges from Generation to Judgment</h1><h2 id="Abstract"><a href="#Abstract" class="headerlink" title="Abstract"></a>Abstract</h2><p>Evaluation tasks in artificial intelligence (AI) and natural language processing (NLP) have long been challenging. Traditional evaluation methods, such as those based on matching or embeddings, are limited in assessing complex attributes. The recent development of large language models (LLMs) has given rise to the â€œLLM-as-a-Judgeâ€ paradigm, which utilizes LLMs for scoring, ranking, or selection tasks. This paper provides a comprehensive review of LLM evaluation methodologies, including their definitions, classification frameworks, benchmarks, and future research directions.</p><hr><h2 id="1-Introduction"><a href="#1-Introduction" class="headerlink" title="1. Introduction"></a>1. Introduction</h2><h3 id="1-1-Background"><a href="#1-1-Background" class="headerlink" title="1.1 Background"></a>1.1 Background</h3><p>Evaluation is one of the core issues in machine learning and NLP. Traditional evaluation methods such as BLEU and ROUGE often rely on text overlap and lack applicability in complex scenarios. With the development of deep learning and LLMs (e.g., GPT-4), researchers have proposed the â€œLLM-as-a-Judgeâ€ paradigm to address the limitations of traditional evaluation methods.</p><h3 id="1-2-Research-Questions"><a href="#1-2-Research-Questions" class="headerlink" title="1.2 Research Questions"></a>1.2 Research Questions</h3><p>This paper aims to explore the following questions:</p><ul><li><strong>What do LLMs evaluate?</strong></li><li><strong>How is evaluation conducted?</strong></li><li><strong>Where are LLMs applied for evaluation?</strong></li></ul><hr><h2 id="2-Preliminary-Knowledge"><a href="#2-Preliminary-Knowledge" class="headerlink" title="2. Preliminary Knowledge"></a>2. Preliminary Knowledge</h2><h3 id="2-1-Input-Formats"><a href="#2-1-Input-Formats" class="headerlink" title="2.1 Input Formats"></a>2.1 Input Formats</h3><p>Evaluation inputs can be categorized as follows:</p><ul><li><strong>Point-Wise</strong>: Evaluation of a single sample.</li><li><strong>Pair/List-Wise</strong>: Comparative evaluation of multiple samples.</li></ul><h3 id="2-2-Output-Formats"><a href="#2-2-Output-Formats" class="headerlink" title="2.2 Output Formats"></a>2.2 Output Formats</h3><p>Evaluation outputs include:</p><ul><li><strong>Scores</strong>: Quantitative scoring of samples.</li><li><strong>Ranking</strong>: Ordering based on merit.</li><li><strong>Selection</strong>: Choosing the best option among candidates.</li></ul><hr><h2 id="3-Evaluation-Attributes"><a href="#3-Evaluation-Attributes" class="headerlink" title="3. Evaluation Attributes"></a>3. Evaluation Attributes</h2><h3 id="3-1-Helpfulness"><a href="#3-1-Helpfulness" class="headerlink" title="3.1 Helpfulness"></a>3.1 Helpfulness</h3><p>LLMs evaluate the helpfulness of responses by guiding user tasks and generating feedback, which is crucial in AI alignment.</p><h3 id="3-2-Harmlessness"><a href="#3-2-Harmlessness" class="headerlink" title="3.2 Harmlessness"></a>3.2 Harmlessness</h3><p>Evaluating the harmlessness of text is key to generating safe content. LLMs assist in data labeling or directly assess potential harmful content.</p><h3 id="3-3-Reliability"><a href="#3-3-Reliability" class="headerlink" title="3.3 Reliability"></a>3.3 Reliability</h3><p>LLMs detect factual accuracy and consistency, e.g., generating supporting evidence or conducting conversation-level reliability evaluations.</p><h3 id="3-4-Relevance"><a href="#3-4-Relevance" class="headerlink" title="3.4 Relevance"></a>3.4 Relevance</h3><p>LLMs assess the relevance of generated or retrieved content, applicable in scenarios like conversations and retrieval-augmented generation (RAG).</p><h3 id="3-5-Feasibility"><a href="#3-5-Feasibility" class="headerlink" title="3.5 Feasibility"></a>3.5 Feasibility</h3><p>In complex tasks, LLMs judge the feasibility of candidate steps or actions to optimize decision paths.</p><h3 id="3-6-Overall-Quality"><a href="#3-6-Overall-Quality" class="headerlink" title="3.6 Overall Quality"></a>3.6 Overall Quality</h3><p>By scoring across multiple dimensions, LLMs provide an overall evaluation, suitable for comprehensive comparisons in generation tasks.</p><hr><h3 id="4-Methodology"><a href="#4-Methodology" class="headerlink" title="4. Methodology"></a>4. Methodology</h3><h4 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h4><p>The methodology section focuses on optimizing the capabilities of LLMs as evaluators (LLM-as-a-Judge) through two approaches: fine-tuning and prompt engineering.</p><ol><li><strong>Fine-Tuning Techniques</strong>: Enhancing LLM judgment capabilities using supervised fine-tuning (SFT) and preference learning with labeled or synthetic feedback.</li><li><strong>Prompt Engineering</strong>: Designing effective prompt strategies, such as operation swapping, rule enhancement, and multi-agent collaboration, to improve inference and evaluation accuracy and reliability.</li></ol><hr><h4 id="4-1-Fine-Tuning-Techniques"><a href="#4-1-Fine-Tuning-Techniques" class="headerlink" title="4.1 Fine-Tuning Techniques"></a>4.1 Fine-Tuning Techniques</h4><h5 id="Data-Sources"><a href="#Data-Sources" class="headerlink" title="Data Sources"></a>Data Sources</h5><h6 id="1-Human-Labeled-Data"><a href="#1-Human-Labeled-Data" class="headerlink" title="1. Human-Labeled Data"></a>1. <strong>Human-Labeled Data</strong></h6><p>Human-labeled data provides high-quality training samples that help LLMs learn human preferences. Key studies and innovations include:</p><ol><li><p><strong>PandaLM</strong> [Wang et al., 2024h]:</p><ul><li>Collected a diverse dataset with 300,000 samples for instruction-generation tasks.</li><li>Enhanced generalization by integrating data sources like open-domain QA and dialogue generation.</li><li>Introduced standardized annotation workflows for consistency and emphasized multilingual support.</li></ul></li><li><p><strong>AspectInstruct</strong> [Liu et al., 2024a]:</p><ul><li>Introduced a dataset tailored for multi-dimensional evaluation, covering 65 tasks and 27 evaluation dimensions.</li><li>Designed a unique task segmentation mechanism for contextual understanding and dimension prioritization.</li></ul></li></ol><h6 id="2-Synthetic-Data"><a href="#2-Synthetic-Data" class="headerlink" title="2. Synthetic Data"></a>2. <strong>Synthetic Data</strong></h6><p>Synthetic data generated by LLMs reduces dependency on human labeling and expands data coverage. Key studies and innovations include:</p><ol><li><p><strong>JudgeLM</strong> [Zhu et al., 2023]:</p><ul><li>Generated a dataset with 100,000 samples, covering various instruction-generation scenarios.</li><li>Introduced task-seeding methods to ensure diversity and specificity.</li></ul></li><li><p><strong>Meta-Rewarding</strong> [Wu et al., 2024]:</p><ul><li>Proposed â€œmeta-rewarding,â€ using LLM self-evaluation signals to enhance training effectiveness.</li></ul></li></ol><h5 id="Fine-Tuning-Methods"><a href="#Fine-Tuning-Methods" class="headerlink" title="Fine-Tuning Methods"></a>Fine-Tuning Methods</h5><h6 id="1-Supervised-Fine-Tuning-SFT"><a href="#1-Supervised-Fine-Tuning-SFT" class="headerlink" title="1. Supervised Fine-Tuning (SFT)"></a>1. <strong>Supervised Fine-Tuning (SFT)</strong></h6><p>SFT trains LLMs using human-labeled or synthetic data to learn evaluation criteria. Key studies include:</p><ol><li><p><strong>FLAMe</strong> [Vu et al., 2024]:</p><ul><li>Leveraged a multi-task learning framework with 5 million samples for multi-task SFT.</li><li>Unified evaluation standards across diverse tasks.</li></ul></li><li><p><strong>JSFT</strong> [Lee et al., 2024]:</p><ul><li>Combined SFT with preference learning to optimize performance on diverse evaluation tasks.</li></ul></li></ol><h6 id="2-Preference-Learning"><a href="#2-Preference-Learning" class="headerlink" title="2. Preference Learning"></a>2. <strong>Preference Learning</strong></h6><p>Preference learning optimizes LLM comparison and ranking capabilities for complex evaluations. Key studies include:</p><ol><li><p><strong>HALU-J</strong> [Wang et al., 2024a]:</p><ul><li>Employed directed preference optimization (DPO) with multi-evidence selection mechanisms.</li></ul></li><li><p><strong>Self-Taught Evaluators</strong> [Wang et al., 2024f]:</p><ul><li>Used self-generated suboptimal responses as negative samples for dynamic improvement.</li></ul></li></ol><hr><h3 id="5-Applications"><a href="#5-Applications" class="headerlink" title="5. Applications"></a>5. Applications</h3><h4 id="Overview-1"><a href="#Overview-1" class="headerlink" title="Overview"></a>Overview</h4><p>The applications of LLM-as-a-Judge have expanded from generation evaluation to alignment, retrieval, and reasoning. This section systematically introduces these applications, their specific tasks, and representative studies.</p><hr><h4 id="5-1-Evaluation"><a href="#5-1-Evaluation" class="headerlink" title="5.1 Evaluation"></a>5.1 Evaluation</h4><h5 id="Overview-2"><a href="#Overview-2" class="headerlink" title="Overview"></a>Overview</h5><p>LLM-as-a-Judge was initially applied to evaluation tasks like dialogue generation and summarization. Key studies include:</p><ol><li><p><strong>MD-Judge</strong> [Li et al., 2024f]:</p><ul><li>Evaluated safety-related Q&amp;A frameworks, focusing on harmfulness and ethical risks.</li></ul></li><li><p><strong>Chan Framework</strong> [Chan et al., 2023]:</p><ul><li>Introduced a multi-agent debate framework for improved evaluation quality.</li></ul></li><li><p><strong>ICE</strong> [Jain et al., 2023b]:</p><ul><li>Used few-shot examples for interactive multi-dimensional evaluation.</li></ul></li></ol><hr><h3 id="7-Challenges-and-Future-Directions"><a href="#7-Challenges-and-Future-Directions" class="headerlink" title="7. Challenges and Future Directions"></a>7. Challenges and Future Directions</h3><h4 id="Overview-3"><a href="#Overview-3" class="headerlink" title="Overview"></a>Overview</h4><p>Despite its powerful capabilities, LLM-as-a-Judge faces challenges such as evaluation bias, adaptability to dynamic tasks, and the potential of human-AI collaborative evaluation. This section explores these challenges and outlines future research directions.</p><h5 id="7-1-Bias-and-Vulnerabilities"><a href="#7-1-Bias-and-Vulnerabilities" class="headerlink" title="7.1 Bias and Vulnerabilities"></a>7.1 Bias and Vulnerabilities</h5><ol><li><strong>OffsetBias</strong> [Park et al., 2024]:<ul><li>Proposed a de-biasing framework to mitigate positional and content biases.</li></ul></li></ol><h5 id="7-2-Dynamic-and-Complex-Evaluations"><a href="#7-2-Dynamic-and-Complex-Evaluations" class="headerlink" title="7.2 Dynamic and Complex Evaluations"></a>7.2 Dynamic and Complex Evaluations</h5><ol><li><strong>Tree of Thought (ToT)</strong> [Yao et al., 2023a]:<ul><li>Enhanced multi-step reasoning with dynamic state evaluation mechanisms.</li></ul></li></ol><h5 id="7-3-Self-Evaluation-and-Human-AI-Collaboration"><a href="#7-3-Self-Evaluation-and-Human-AI-Collaboration" class="headerlink" title="7.3 Self-Evaluation and Human-AI Collaboration"></a>7.3 Self-Evaluation and Human-AI Collaboration</h5><ol><li><p><strong>Self-Taught Evaluators</strong> [Wang et al., 2024f]:</p><ul><li>Highlighted the potential for models to improve through self-learning mechanisms.</li></ul></li><li><p><strong>Meta-Rewarding</strong> [Wu et al., 2024]:</p><ul><li>Demonstrated the advantages of integrating self-evaluation signals into optimization.</li></ul></li></ol><hr>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>SeCom: Redefining Memory Management in Conversational AI</title>
      <link href="/2025/06/24/NLP%20Insights/SeCom%20Redefining%20Memory%20Management%20in%20Conversational%20AI/"/>
      <url>/2025/06/24/NLP%20Insights/SeCom%20Redefining%20Memory%20Management%20in%20Conversational%20AI/</url>
      
        <content type="html"><![CDATA[<h1 id="SeCom-Redefining-Memory-Management-in-Conversational-AI"><a href="#SeCom-Redefining-Memory-Management-in-Conversational-AI" class="headerlink" title="SeCom: Redefining Memory Management in Conversational AI"></a>SeCom: Redefining Memory Management in Conversational AI</h1><h2 id="Foreword"><a href="#Foreword" class="headerlink" title="Foreword"></a>Foreword</h2><p>Iâ€™ve recently been diving into memory management for dialog-based AI, especially how to construct and retrieve memories in long-term conversations. During my exploration I came across an eye-opening ICLR 2025 paperâ€”**â€SeCom: On Memory Construction and Retrieval for Personalized Conversational Agentsâ€**â€”a collaboration between Microsoft and Tsinghua University.</p><p>SeCom solves a core problem: <strong>How can an agent effectively manage and retrieve historical information in prolonged conversations?</strong> In this post Iâ€™ll unpack the methodâ€™s key ideas and technical innovations, hoping to spark inspiration for researchers working in this arena.</p><h2 id="1-Why-Should-We-Care-About-Dialog-Memory-Management"><a href="#1-Why-Should-We-Care-About-Dialog-Memory-Management" class="headerlink" title="1. Why Should We Care About Dialog Memory Management?"></a>1. Why Should We Care About Dialog Memory Management?</h2><h3 id="1-1-Real-World-Challenges-in-Long-Conversations"><a href="#1-1-Real-World-Challenges-in-Long-Conversations" class="headerlink" title="1.1 Real-World Challenges in Long Conversations"></a>1.1 Real-World Challenges in Long Conversations</h3><p>Anyone who chats with LLMs regularly has probably experienced this: once a conversation grows long, the agent seems to â€œforgetâ€ earlier context or respond incoherently. Thatâ€™s the memory problem in action.</p><p>Even with long-context models, super-long dialogs increase compute cost and often degrade quality. Key challenges include:</p><ul><li><strong>Context length limits</strong>: Token budgets remain finite.</li><li><strong>Information relevance</strong>: History contains plenty of facts irrelevant to the current query.</li><li><strong>Semantic coherence</strong>: Related information may be scattered across non-contiguous turns.</li><li><strong>Personalization</strong>: The agent must remember user preferences and interaction patterns.</li></ul><h3 id="1-2-A-Quick-Landscape-of-Existing-Approaches"><a href="#1-2-A-Quick-Landscape-of-Existing-Approaches" class="headerlink" title="1.2 A Quick Landscape of Existing Approaches"></a>1.2 A Quick Landscape of Existing Approaches</h3><p>The communityâ€™s strategies roughly split into three camps:</p><ol><li><strong>â€œGive Me Everythingâ€ (full history)</strong><ul><li>Complete information, zero recall loss.</li><li>But like moving an entire library just to find one bookâ€”computational overkill.</li></ul></li><li><strong>â€œBullet-Point Digestâ€ (summaries)</strong><ul><li>Compact and efficient.</li><li>Risk of omitting crucial details during abstraction.</li></ul></li><li><strong>â€œPrecision Strikeâ€ (retrieval-based)</strong><ul><li>Fetch only what you need, exactly when you need it.</li><li>Success hinges on choosing the right retrieval granularityâ€”precisely the issue SeCom addresses.</li></ul></li></ol><h4 id="1-2-3-Retrieval-Augmented-Generation-RAG-in-Dialog"><a href="#1-2-3-Retrieval-Augmented-Generation-RAG-in-Dialog" class="headerlink" title="1.2.3 Retrieval-Augmented Generation (RAG) in Dialog"></a>1.2.3 Retrieval-Augmented Generation (RAG) in Dialog</h4><p>RAG faces dialog-specific hurdles:</p><ul><li><strong>Chunking strategy</strong>: How to segment a dialog into retrievable units.</li><li><strong>Relevance estimation</strong>: Harder than in static docs due to dialog dynamics.</li><li><strong>Temporal dependency</strong>: Order matters; turns refer to earlier context.</li></ul><h3 id="1-3-The-Granularity-Dilemma"><a href="#1-3-The-Granularity-Dilemma" class="headerlink" title="1.3 The Granularity Dilemma"></a>1.3 The Granularity Dilemma</h3><p>We often index memories at the turn-level or at the whole-conversation level. Both extremes break down:</p><ul><li><strong>Turn-level</strong> â†’ fragments context, loses dependencies, retrieval recall suffers.</li><li><strong>Conversation-level</strong> â†’ topic mixture, lots of noise, retrieval becomes coarse.</li><li><strong>Summaries</strong> â†’ irreversible information loss.</li></ul><p>SeComâ€™s insight: dialog naturally contains <strong>paragraph-level thematic boundaries</strong>. Segmenting at this â€œjust-rightâ€ granularity preserves coherence without exploding memory size.</p><h2 id="2-Inside-SeCom"><a href="#2-Inside-SeCom" class="headerlink" title="2. Inside SeCom"></a>2. Inside SeCom</h2><h3 id="2-1-Two-Key-Insights"><a href="#2-1-Two-Key-Insights" class="headerlink" title="2.1 Two Key Insights"></a>2.1 Two Key Insights</h3><ol><li><strong>Paragraph-like Topic Shifts</strong> exist in dialog just as in essays.</li><li><strong>Natural Language Is Redundant</strong>â€”filler words, confirmations, small talk, etc. Removing them boosts retrieval precision.</li></ol><p>Hence <strong>SeCom = Segmentation + Compression</strong>.</p><h3 id="2-2-System-Pipeline"><a href="#2-2-System-Pipeline" class="headerlink" title="2.2 System Pipeline"></a>2.2 System Pipeline</h3><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">History â†’ [Segmenter] â†’ Paragraph-level units â†’ [Compressor] â†’ Denoised memories â†’ [Retriever] â†’ Relevant context â†’ [Generator] â†’ Final reply</span><br></pre></td></tr></tbody></table></figure><p>Technically:</p><ol><li>Segmenter $f_{\mathcal I}$ splits the dialog.</li><li>Compressor $f_{comp}$ denoises each segment.</li><li>Retriever $f_R$ ranks memories for the current user utterance $u^*$.</li><li>LLM $f_{LLM}$ produces the answer based on top-N memories.</li></ol><h3 id="2-3-How-to-Segment-Without-Labels"><a href="#2-3-How-to-Segment-Without-Labels" class="headerlink" title="2.3 How to Segment Without Labels"></a>2.3 How to Segment Without Labels</h3><p>SeCom leverages GPT-4 in a <strong>zero-shot</strong> fashion: craft a prompt asking the model to mark topic boundaries and output span indices. No training data required.</p><p>When limited gold data are available, a <strong>reflection-based</strong> loop iteratively refines the guidelines using WindowDiff scores and GPT-4 reasoning.</p><p>An <strong>incremental segmenter</strong> decides on-the-fly whether a new turn merges into the previous segment or starts a fresh one.</p><h3 id="2-4-Denoising-via-LLMLingua-2"><a href="#2-4-Denoising-via-LLMLingua-2" class="headerlink" title="2.4 Denoising via LLMLingua-2"></a>2.4 Denoising via LLMLingua-2</h3><p>LLMLingua-2 scores token importance and keeps the top $(1-r)$ fraction (e.g., 25 %) accordingly. Empirically, retaining just 25 % tokens preserves <strong>&gt;95 %</strong> key information, lifts retrieval GPT4Score by <strong>+9.46</strong>, and yields 4 Ã— speed-up.</p><h3 id="2-5-Hybrid-Retrieval"><a href="#2-5-Hybrid-Retrieval" class="headerlink" title="2.5 Hybrid Retrieval"></a>2.5 Hybrid Retrieval</h3><p>BM25 (sparse) and MPNet (dense) scores are linearly combined:</p><p>$$\text{score}_{hybrid}=\alpha,\text{BM25}+(1-\alpha),\text{MPNet}, \quad \alpha=0.6$$</p><h2 id="3-Final-Thoughts"><a href="#3-Final-Thoughts" class="headerlink" title="3. Final Thoughts"></a>3. Final Thoughts</h2><h3 id="3-1-What-SeCom-Teaches-Us"><a href="#3-1-What-SeCom-Teaches-Us" class="headerlink" title="3.1 What SeCom Teaches Us"></a>3.1 What SeCom Teaches Us</h3><ul><li><strong>Simplicity Wins</strong>: Segment + Compress, nothing fancy, yet highly effective.</li><li><strong>Understand the Problem First</strong>: The authors nailed the granularity pain-point before designing a solution.</li></ul><p>Future directions:</p><ul><li><strong>Personalized segmentation</strong> tuned to each userâ€™s dialog style.</li><li><strong>Real-time adaptation</strong> of compression and segmentation based on quality metrics.</li></ul><hr><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul><li><strong>Paper</strong>: <a href="https://www.arxiv.org/abs/2502.05589">SeCom: On Memory Construction and Retrieval for Personalized Conversational Agents (ICLR 2025)</a></li><li><strong>Project Page</strong>: <a href="https://llmlingua.com/secom.html">https://llmlingua.com/secom.html</a></li><li><strong>Code</strong>: SeCom-main</li><li><strong>Datasets</strong>: LOCOMO, Long-MT-Bench+, DialSeg711, TIAGE, SuperDialSeg</li></ul><p><em>This post is based on Microsoft &amp; Tsinghua Universityâ€™s ICLR 2025 paper. Please refer to the original publication and open-source repo for implementation details.</em> </p>]]></content>
      
      
      <categories>
          
          <category> NLP Insights </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Conversational AI </tag>
            
            <tag> Memory Management </tag>
            
            <tag> SeCom </tag>
            
            <tag> RAG </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SeCom: é‡æ–°å®šä¹‰å¯¹è¯AIçš„è®°å¿†ç®¡ç†</title>
      <link href="/2025/06/24/NLP%20Insights/SeCom:%20%E9%87%8D%E6%96%B0%E5%AE%9A%E4%B9%89%E5%AF%B9%E8%AF%9DAI%E7%9A%84%E8%AE%B0%E5%BF%86%E7%AE%A1%E7%90%86/"/>
      <url>/2025/06/24/NLP%20Insights/SeCom:%20%E9%87%8D%E6%96%B0%E5%AE%9A%E4%B9%89%E5%AF%B9%E8%AF%9DAI%E7%9A%84%E8%AE%B0%E5%BF%86%E7%AE%A1%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h1 id="SeCom-é‡æ–°å®šä¹‰å¯¹è¯AIçš„è®°å¿†ç®¡ç†"><a href="#SeCom-é‡æ–°å®šä¹‰å¯¹è¯AIçš„è®°å¿†ç®¡ç†" class="headerlink" title="SeCom: é‡æ–°å®šä¹‰å¯¹è¯AIçš„è®°å¿†ç®¡ç†"></a>SeCom: é‡æ–°å®šä¹‰å¯¹è¯AIçš„è®°å¿†ç®¡ç†</h1><h2 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h2><p>æœ€è¿‘ç¬”è€…ä¸€ç›´åœ¨ç ”ç©¶å¯¹è¯AIä¸­çš„å†…å­˜ç®¡ç†é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯é•¿æœŸå¯¹è¯åœºæ™¯ä¸‹çš„è®°å¿†æ„å»ºä¸æ£€ç´¢æŠ€æœ¯ã€‚å‘ç°äº†ä¸€ç¯‡ä»¤äººçœ¼å‰ä¸€äº®çš„ICLR 2025è®ºæ–‡â€”â€”<strong>ã€ŠSeCom: On Memory Construction and Retrieval for Personalized Conversational Agentsã€‹</strong>ï¼Œç”±Microsoftå’Œæ¸…åå¤§å­¦çš„ç ”ç©¶å›¢é˜Ÿè”åˆå‘è¡¨ã€‚</p><p>è¿™ç¯‡è®ºæ–‡æå‡ºçš„SeComæ–¹æ³•å·§å¦™åœ°è§£å†³äº†ä¸€ä¸ªæ ¸å¿ƒé—®é¢˜ï¼š<strong>å¦‚ä½•åœ¨é•¿æœŸå¯¹è¯ä¸­æœ‰æ•ˆç®¡ç†å’Œæ£€ç´¢å†å²ä¿¡æ¯</strong>ï¼Ÿä»Šå¤©æƒ³å’Œå¤§å®¶åˆ†äº«ä¸€ä¸‹è¿™ä¸ªæ–¹æ³•çš„æŠ€æœ¯ç»†èŠ‚å’Œåˆ›æ–°ç‚¹ï¼Œå¸Œæœ›èƒ½ä¸ºä»äº‹ç›¸å…³ç ”ç©¶çš„æœ‹å‹ä»¬æä¾›ä¸€äº›å¯å‘ã€‚</p><h2 id="1-ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦å…³æ³¨å¯¹è¯å†…å­˜ç®¡ç†ï¼Ÿ"><a href="#1-ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦å…³æ³¨å¯¹è¯å†…å­˜ç®¡ç†ï¼Ÿ" class="headerlink" title="1. ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦å…³æ³¨å¯¹è¯å†…å­˜ç®¡ç†ï¼Ÿ"></a>1. ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦å…³æ³¨å¯¹è¯å†…å­˜ç®¡ç†ï¼Ÿ</h2><h3 id="1-1-é•¿æœŸå¯¹è¯çš„ç°å®æŒ‘æˆ˜"><a href="#1-1-é•¿æœŸå¯¹è¯çš„ç°å®æŒ‘æˆ˜" class="headerlink" title="1.1 é•¿æœŸå¯¹è¯çš„ç°å®æŒ‘æˆ˜"></a>1.1 é•¿æœŸå¯¹è¯çš„ç°å®æŒ‘æˆ˜</h3><p>åœ¨ä¸LLMsçš„æ—¥å¸¸äº¤äº’ä¸­ï¼Œç›¸ä¿¡å¤§å®¶éƒ½é‡åˆ°è¿‡è¿™æ ·çš„å›°æ‰°ï¼šå½“å¯¹è¯å˜å¾—å¾ˆé•¿æ—¶ï¼ŒAIä¼¼ä¹â€å¿˜è®°â€äº†ä¹‹å‰è®¨è®ºçš„å†…å®¹ï¼Œæˆ–è€…ç»™å‡ºçš„å›ç­”ä¸å‰é¢çš„ä¸Šä¸‹æ–‡ä¸å¤Ÿè¿è´¯ã€‚è¿™èƒŒååæ˜ çš„æ­£æ˜¯é•¿æœŸå¯¹è¯ä¸­çš„å†…å­˜ç®¡ç†æŒ‘æˆ˜ã€‚</p><p>éšç€å¤§è¯­è¨€æ¨¡å‹æŠ€æœ¯çš„æˆç†Ÿï¼ŒåŸºäºLLMçš„å¯¹è¯ä»£ç†å·²ç»æ·±å…¥åˆ°æˆ‘ä»¬ç”Ÿæ´»çš„æ–¹æ–¹é¢é¢ã€‚ä½†æ˜¯ï¼Œå½“æˆ‘ä»¬å¸Œæœ›ä¸AIè¿›è¡ŒçœŸæ­£çš„é•¿æœŸã€ä¸ªæ€§åŒ–äº¤äº’æ—¶â€”â€”æ¯”å¦‚è·¨è¶Šæ•°å¤©ã€æ•°å‘¨çš„é¡¹ç›®è®¨è®ºï¼Œç°æœ‰çš„æŠ€æœ¯å°±æ˜¾å¾—åŠ›ä¸ä»å¿ƒäº†ã€‚</p><p>é•¿æœŸå¯¹è¯é¢ä¸´çš„ä¸»è¦æŠ€æœ¯æŒ‘æˆ˜åŒ…æ‹¬ï¼š</p><ul><li><strong>ä¸Šä¸‹æ–‡é•¿åº¦é™åˆ¶</strong>ï¼šå³ä½¿æ˜¯æ”¯æŒé•¿ä¸Šä¸‹æ–‡çš„æ¨¡å‹ï¼Œåœ¨å¤„ç†è¶…é•¿å¯¹è¯æ—¶ä¹Ÿé¢ä¸´è®¡ç®—æˆæœ¬å’Œæ€§èƒ½ä¸‹é™çš„é—®é¢˜</li><li><strong>ä¿¡æ¯ç›¸å…³æ€§</strong>ï¼šå†å²å¯¹è¯ä¸­å¯èƒ½åŒ…å«å¤§é‡ä¸å½“å‰æŸ¥è¯¢æ— å…³çš„ä¿¡æ¯</li><li><strong>è¯­ä¹‰è¿è´¯æ€§</strong>ï¼šç›¸å…³ä¿¡æ¯å¯èƒ½åˆ†æ•£åœ¨å¤šä¸ªä¸è¿ç»­çš„å¯¹è¯è½®æ¬¡ä¸­</li><li><strong>ä¸ªæ€§åŒ–è®°å¿†</strong>ï¼šéœ€è¦è®°ä½ç”¨æˆ·çš„åå¥½ã€ä¹ æƒ¯å’Œå†å²äº¤äº’æ¨¡å¼</li></ul><h3 id="1-2-ç¬”è€…å¯¹Memoryç®¡ç†é¢†åŸŸçš„è§‚å¯Ÿ"><a href="#1-2-ç¬”è€…å¯¹Memoryç®¡ç†é¢†åŸŸçš„è§‚å¯Ÿ" class="headerlink" title="1.2 ç¬”è€…å¯¹Memoryç®¡ç†é¢†åŸŸçš„è§‚å¯Ÿ"></a>1.2 ç¬”è€…å¯¹Memoryç®¡ç†é¢†åŸŸçš„è§‚å¯Ÿ</h3><p>åœ¨æ·±å…¥ç ”ç©¶è¿™ä¸ªé¢†åŸŸçš„è¿‡ç¨‹ä¸­ï¼Œç¬”è€…å‘ç°å¯¹è¯å†…å­˜ç®¡ç†å…¶å®æ˜¯ä¸€ä¸ªç›¸å½“å¤æ‚çš„ç³»ç»Ÿå·¥ç¨‹ã€‚å®ƒçš„æ ¸å¿ƒç›®æ ‡å¬èµ·æ¥å¾ˆç®€å•ï¼šä»å†å²å¯¹è¯ä¸­æå–ã€å­˜å‚¨å’Œæ£€ç´¢ç›¸å…³ä¿¡æ¯ï¼Œä»¥æ”¯æŒå½“å‰å¯¹è¯çš„ç”Ÿæˆã€‚ä½†å®é™…å®ç°èµ·æ¥ï¼Œéœ€è¦è§£å†³ä¸‰ä¸ªå…³é”®é—®é¢˜ï¼š</p><ol><li><strong>å†…å­˜æ„å»ºï¼ˆMemory Constructionï¼‰</strong>ï¼šå¦‚ä½•å°†è‡ªç„¶è¯­è¨€å¯¹è¯è½¬æ¢ä¸ºç»“æ„åŒ–çš„å†…å­˜å•å…ƒï¼Ÿ</li><li><strong>å†…å­˜æ£€ç´¢ï¼ˆMemory Retrievalï¼‰</strong>ï¼šé¢å¯¹æµ·é‡å†å²ä¿¡æ¯ï¼Œå¦‚ä½•å¿«é€Ÿå‡†ç¡®åœ°æ‰¾åˆ°ç›¸å…³å†…å®¹ï¼Ÿ</li><li><strong>å“åº”ç”Ÿæˆï¼ˆResponse Generationï¼‰</strong>ï¼šå¦‚ä½•åŸºäºæ£€ç´¢åˆ°çš„è®°å¿†ç”Ÿæˆè¿è´¯ã€ä¸ªæ€§åŒ–çš„å›å¤ï¼Ÿ</li></ol><p>å¬èµ·æ¥æ˜¯ä¸æ˜¯å¾ˆåƒäººç±»çš„è®°å¿†æœºåˆ¶ï¼Ÿç¡®å®å¦‚æ­¤ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆè¿™ä¸ªé—®é¢˜å¦‚æ­¤æœ‰è¶£å’Œå…·æœ‰æŒ‘æˆ˜æ€§ã€‚</p><h4 id="1-2-2-ç°æœ‰æ–¹æ³•çš„â€ä¸‰å›½æ¼”ä¹‰â€"><a href="#1-2-2-ç°æœ‰æ–¹æ³•çš„â€ä¸‰å›½æ¼”ä¹‰â€" class="headerlink" title="1.2.2 ç°æœ‰æ–¹æ³•çš„â€ä¸‰å›½æ¼”ä¹‰â€"></a>1.2.2 ç°æœ‰æ–¹æ³•çš„â€ä¸‰å›½æ¼”ä¹‰â€</h4><p>åœ¨ç ”ç©¶è¿‡ç¨‹ä¸­ï¼Œç¬”è€…å‘ç°ç°æœ‰çš„æ–¹æ³•å¤§è‡´å¯ä»¥åˆ†ä¸ºä¸‰å¤§æµæ´¾ï¼Œæ¯ä¸ªéƒ½æœ‰è‡ªå·±çš„â€å“²å­¦â€ï¼š</p><p><strong>â€œå…¨ç›˜æ‰˜å‡ºâ€æ´¾ï¼ˆåŸºäºå®Œæ•´å†å²ï¼‰</strong>ï¼š</p><ul><li><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šæ—¢ç„¶ä¸çŸ¥é“ä»€ä¹ˆé‡è¦ï¼Œé‚£å°±å…¨éƒ¨ç»™ä½ ï¼</li><li><strong>ä¼˜åŠ¿</strong>ï¼šä¿¡æ¯å®Œæ•´ï¼Œç»ä¸é—æ¼</li><li><strong>é—®é¢˜</strong>ï¼šå°±åƒæŠŠæ•´ä¸ªå›¾ä¹¦é¦†æ¬ç»™ä½ æ‰¾ä¸€æœ¬ä¹¦ï¼Œæ•ˆç‡å¯æƒ³è€ŒçŸ¥</li></ul><p><strong>â€œæçº²æŒˆé¢†â€æ´¾ï¼ˆåŸºäºæ‘˜è¦ï¼‰</strong>ï¼š</p><ul><li><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šé‡è¦çš„ä¿¡æ¯æµ“ç¼©æˆæ‘˜è¦å°±å¤Ÿäº†</li><li><strong>ä¼˜åŠ¿</strong>ï¼šä¿¡æ¯å‹ç¼©ï¼Œè®¡ç®—é«˜æ•ˆ</li><li><strong>é—®é¢˜</strong>ï¼šæ‘˜è¦è¿‡ç¨‹ä¸­é‡è¦ç»†èŠ‚å¯èƒ½â€æ„å¤–å¤±è¸ªâ€</li></ul><p><strong>â€œç²¾å‡†æ‰“å‡»â€æ´¾ï¼ˆåŸºäºæ£€ç´¢ï¼‰</strong>ï¼š</p><ul><li><strong>ä»£è¡¨æ–¹æ³•</strong>ï¼šè½®æ¬¡çº§æ£€ç´¢ã€ä¼šè¯çº§æ£€ç´¢</li><li><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šéœ€è¦ä»€ä¹ˆå°±æ£€ç´¢ä»€ä¹ˆï¼ŒæŒ‰éœ€å–ç”¨</li><li><strong>ä¼˜åŠ¿</strong>ï¼šè®¡ç®—æ•ˆç‡é«˜ï¼Œå®šä½ç²¾ç¡®</li><li><strong>é—®é¢˜</strong>ï¼šå…³é”®åœ¨äºå¦‚ä½•ç¡®å®šæ£€ç´¢çš„â€ç²’åº¦â€â€”â€”è¿™æ­£æ˜¯SeComè¦è§£å†³çš„æ ¸å¿ƒé—®é¢˜ï¼</li></ul><h4 id="1-2-3-æ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGï¼‰åœ¨å¯¹è¯ä¸­çš„åº”ç”¨"><a href="#1-2-3-æ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGï¼‰åœ¨å¯¹è¯ä¸­çš„åº”ç”¨" class="headerlink" title="1.2.3 æ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGï¼‰åœ¨å¯¹è¯ä¸­çš„åº”ç”¨"></a>1.2.3 æ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGï¼‰åœ¨å¯¹è¯ä¸­çš„åº”ç”¨</h4><p>æ£€ç´¢å¢å¼ºç”ŸæˆæŠ€æœ¯åœ¨å¯¹è¯ç³»ç»Ÿä¸­çš„åº”ç”¨æ—¥ç›Šå¹¿æ³›ï¼Œä¸»è¦åŒ…æ‹¬ï¼š</p><ul><li>**Dense Passage Retrieval (DPR)**ï¼šä½¿ç”¨é¢„è®­ç»ƒçš„å¯†é›†æ£€ç´¢æ¨¡å‹</li><li><strong>BM25</strong>ï¼šåŸºäºè¯é¢‘ç»Ÿè®¡çš„ç¨€ç–æ£€ç´¢æ–¹æ³•</li><li><strong>Hybrid Retrieval</strong>ï¼šç»“åˆå¯†é›†æ£€ç´¢å’Œç¨€ç–æ£€ç´¢çš„ä¼˜åŠ¿</li></ul><p>ç„¶è€Œï¼Œç°æœ‰RAGæ–¹æ³•åœ¨å¯¹è¯åœºæ™¯ä¸­é¢ä¸´ç‹¬ç‰¹æŒ‘æˆ˜ï¼š</p><ul><li><strong>åˆ†å—ç­–ç•¥ï¼ˆChunking Strategyï¼‰</strong>ï¼šå¦‚ä½•å°†å¯¹è¯åˆ†å‰²ä¸ºæ£€ç´¢å•å…ƒ</li><li><strong>ç›¸å…³æ€§åˆ¤æ–­</strong>ï¼šå¯¹è¯çš„ç›¸å…³æ€§åˆ¤æ–­æ¯”æ–‡æ¡£æ£€ç´¢æ›´å¤æ‚</li><li><strong>æ—¶åºä¾èµ–</strong>ï¼šå¯¹è¯å…·æœ‰å¼ºæ—¶åºæ€§ï¼Œå‰åæ–‡å…³ç³»é‡è¦</li></ul><h3 id="1-3-å†…å­˜ç²’åº¦é—®é¢˜çš„æ·±å±‚åˆ†æ"><a href="#1-3-å†…å­˜ç²’åº¦é—®é¢˜çš„æ·±å±‚åˆ†æ" class="headerlink" title="1.3 å†…å­˜ç²’åº¦é—®é¢˜çš„æ·±å±‚åˆ†æ"></a>1.3 å†…å­˜ç²’åº¦é—®é¢˜çš„æ·±å±‚åˆ†æ</h3><h4 id="1-3-1-è½®æ¬¡çº§å†…å­˜çš„å±€é™æ€§"><a href="#1-3-1-è½®æ¬¡çº§å†…å­˜çš„å±€é™æ€§" class="headerlink" title="1.3.1 è½®æ¬¡çº§å†…å­˜çš„å±€é™æ€§"></a>1.3.1 è½®æ¬¡çº§å†…å­˜çš„å±€é™æ€§</h4><p>è½®æ¬¡çº§å†…å­˜å°†æ¯ä¸ªç”¨æˆ·-ä»£ç†äº¤äº’ï¼ˆturnï¼‰ä½œä¸ºç‹¬ç«‹çš„å†…å­˜å•å…ƒï¼š</p><p><strong>æ•°å­¦è¡¨ç¤º</strong>ï¼š<br>è®¾å¯¹è¯å†å² $\mathcal{H} = {\mathbf{c}<em>i}</em>{i=1}^C$ï¼Œå…¶ä¸­æ¯ä¸ªä¼šè¯ $\mathbf{c}<em>i = {\mathbf{t}<em>j}</em>{j=1}^{T_i}$<br>è½®æ¬¡çº§å†…å­˜ï¼š$|\mathcal{M}| = \sum</em>{i=1}^C T_i$ï¼Œæ¯ä¸ª $\mathbf{m} \in \mathcal{M}$ å¯¹åº”ä¸€ä¸ªè½®æ¬¡ $\mathbf{t}$</p><p><strong>ä¸»è¦é—®é¢˜</strong>ï¼š</p><ul><li><strong>ä¿¡æ¯ç¢ç‰‡åŒ–</strong>ï¼šç›¸å…³ä¿¡æ¯åˆ†æ•£åœ¨å¤šä¸ªè½®æ¬¡ä¸­ï¼Œå•ä¸ªè½®æ¬¡å¯èƒ½ç¼ºä¹å®Œæ•´è¯­ä¹‰</li><li><strong>ä¸Šä¸‹æ–‡ç¼ºå¤±</strong>ï¼šè½®æ¬¡é—´çš„ä¾èµ–å…³ç³»ä¸¢å¤±</li><li><strong>æ£€ç´¢ç²¾åº¦ä½</strong>ï¼šæŸ¥è¯¢è¯æ±‡å¯èƒ½ä¸ç›´æ¥å‡ºç°åœ¨ç›¸å…³è½®æ¬¡ä¸­</li></ul><p><strong>å…·ä½“ç¤ºä¾‹</strong>ï¼š<br>ç”¨æˆ·åœ¨ç¬¬3è½®è¯¢é—®â€ä»€ä¹ˆæ˜¯æœºå™¨å­¦ä¹ â€ï¼Œç¬¬5è½®è¯¢é—®â€ç›‘ç£å­¦ä¹ çš„ä¾‹å­â€ï¼Œç¬¬8è½®è¯¢é—®â€å¦‚ä½•é€‰æ‹©ç®—æ³•â€ã€‚å½“ç”¨æˆ·åœ¨ç¬¬10è½®è¯¢é—®â€ä¹‹å‰æåˆ°çš„åˆ†ç±»ç®—æ³•æ€§èƒ½å¦‚ä½•è¯„ä¼°â€æ—¶ï¼Œè½®æ¬¡çº§æ£€ç´¢å¯èƒ½æ— æ³•æ‰¾åˆ°å®Œæ•´çš„ä¸Šä¸‹æ–‡ã€‚</p><h4 id="1-3-2-ä¼šè¯çº§å†…å­˜çš„å±€é™æ€§"><a href="#1-3-2-ä¼šè¯çº§å†…å­˜çš„å±€é™æ€§" class="headerlink" title="1.3.2 ä¼šè¯çº§å†…å­˜çš„å±€é™æ€§"></a>1.3.2 ä¼šè¯çº§å†…å­˜çš„å±€é™æ€§</h4><p>ä¼šè¯çº§å†…å­˜å°†æ•´ä¸ªå¯¹è¯ä¼šè¯ä½œä¸ºå†…å­˜å•å…ƒï¼š</p><p><strong>æ•°å­¦è¡¨ç¤º</strong>ï¼š<br>ä¼šè¯çº§å†…å­˜ï¼š$|\mathcal{M}| = C$ï¼Œæ¯ä¸ª $\mathbf{m} \in \mathcal{M}$ å¯¹åº”ä¸€ä¸ªä¼šè¯ $\mathbf{c}$</p><p><strong>ä¸»è¦é—®é¢˜</strong>ï¼š</p><ul><li><strong>ä¸»é¢˜æ··æ‚</strong>ï¼šå•ä¸ªä¼šè¯å¯èƒ½åŒ…å«å¤šä¸ªä¸ç›¸å…³ä¸»é¢˜</li><li><strong>å™ªå£°å¹²æ‰°</strong>ï¼šå¤§é‡æ— å…³ä¿¡æ¯å½±å“æ£€ç´¢å’Œç”Ÿæˆè´¨é‡</li><li><strong>æ£€ç´¢ç²—ç³™</strong>ï¼šæ— æ³•ç²¾ç¡®å®šä½åˆ°å…·ä½“ç›¸å…³å†…å®¹</li></ul><p><strong>å…·ä½“ç¤ºä¾‹</strong>ï¼š<br>ä¸€ä¸ªä¼šè¯ä¸­ç”¨æˆ·è®¨è®ºäº†æœºå™¨å­¦ä¹ ã€çƒ¹é¥ªé£Ÿè°±ã€æ—…è¡Œè®¡åˆ’å’Œç”µå½±æ¨èã€‚å½“æŸ¥è¯¢æœºå™¨å­¦ä¹ ç›¸å…³é—®é¢˜æ—¶ï¼Œæ£€ç´¢åˆ°çš„ä¼šè¯åŒ…å«å¤§é‡æ— å…³çš„çƒ¹é¥ªå’Œæ—…è¡Œä¿¡æ¯ã€‚</p><h4 id="1-3-3-æ‘˜è¦åŒ–æ–¹æ³•çš„ä¿¡æ¯æŸå¤±"><a href="#1-3-3-æ‘˜è¦åŒ–æ–¹æ³•çš„ä¿¡æ¯æŸå¤±" class="headerlink" title="1.3.3 æ‘˜è¦åŒ–æ–¹æ³•çš„ä¿¡æ¯æŸå¤±"></a>1.3.3 æ‘˜è¦åŒ–æ–¹æ³•çš„ä¿¡æ¯æŸå¤±</h4><p>æ‘˜è¦åŒ–æ–¹æ³•é€šè¿‡å‹ç¼©å¯¹è¯å†…å®¹æ¥å‡å°‘ä¿¡æ¯é‡ï¼š</p><p><strong>ä¸»è¦é—®é¢˜</strong>ï¼š</p><ul><li><strong>ç»†èŠ‚ä¸¢å¤±</strong>ï¼šæ‘˜è¦è¿‡ç¨‹ä¸­é‡è¦ç»†èŠ‚å¯èƒ½è¢«çœç•¥</li><li><strong>ä¸»è§‚æ€§</strong>ï¼šæ‘˜è¦è´¨é‡ä¾èµ–äºæ¨¡å‹çš„ç†è§£èƒ½åŠ›</li><li><strong>ä¸å¯é€†æ€§</strong>ï¼šä¸€æ—¦ä¿¡æ¯è¢«æ‘˜è¦ï¼ŒåŸå§‹ç»†èŠ‚æ— æ³•æ¢å¤</li></ul><h2 id="2-SeComçš„è®¾è®¡"><a href="#2-SeComçš„è®¾è®¡" class="headerlink" title="2. SeComçš„è®¾è®¡"></a>2. SeComçš„è®¾è®¡</h2><h3 id="2-1-æ ¸å¿ƒå‘ç°"><a href="#2-1-æ ¸å¿ƒå‘ç°" class="headerlink" title="2.1 æ ¸å¿ƒå‘ç°"></a>2.1 æ ¸å¿ƒå‘ç°</h3><p>SeComï¼ˆ<strong>Se</strong>gmentation + <strong>Com</strong>pressionï¼‰çš„ä¸¤ä¸ªæ ¸å¿ƒå‘ç°ï¼š</p><p><strong>æ´å¯Ÿä¸€ï¼šå¯¹è¯å¤©ç„¶å…·æœ‰â€æ®µè½â€ç»“æ„</strong><br>å°±åƒæˆ‘ä»¬å†™æ–‡ç« ä¼šåˆ†æ®µä¸€æ ·ï¼Œäººç±»çš„å¯¹è¯å…¶å®ä¹Ÿæœ‰å¤©ç„¶çš„ä¸»é¢˜è¾¹ç•Œã€‚æ¯”å¦‚åœ¨ä¸€æ¬¡é•¿å¯¹è¯ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½å…ˆè®¨è®ºå·¥ä½œé¡¹ç›®ï¼Œç„¶åè½¬åˆ°å‘¨æœ«è®¡åˆ’ï¼Œå†èŠåˆ°æœ€è¿‘çœ‹çš„ç”µå½±ã€‚æ¯ä¸ªä¸»é¢˜å°±æ˜¯ä¸€ä¸ªå¤©ç„¶çš„â€æ®µè½â€ã€‚</p><p>ä¼ ç»Ÿæ–¹æ³•è¦ä¹ˆæŠŠæ¯å¥è¯å½“ä½œç‹¬ç«‹å•å…ƒï¼ˆå¤ªç¢ç‰‡åŒ–ï¼‰ï¼Œè¦ä¹ˆæŠŠæ•´ä¸ªå¯¹è¯å½“ä½œä¸€ä¸ªæ•´ä½“ï¼ˆå¤ªç²—ç³™ï¼‰ï¼Œè€ŒSeComæ‰¾åˆ°äº†ä¸­é—´çš„æœ€ä½³å¹³è¡¡ç‚¹â€”â€”<strong>æ®µè½çº§çš„è¯­ä¹‰å•å…ƒ</strong>ã€‚</p><p><strong>æ´å¯ŸäºŒï¼šè‡ªç„¶è¯­è¨€å……æ»¡â€åºŸè¯â€</strong><br>è¿™å¬èµ·æ¥æœ‰ç‚¹åˆ»è–„ï¼Œä½†ç¡®å®å¦‚æ­¤ã€‚æˆ‘ä»¬æ—¥å¸¸å¯¹è¯ä¸­å……æ»¡äº†â€å—¯â€ã€â€é‚£ä¸ªâ€ã€â€ä½ çŸ¥é“çš„â€è¿™æ ·çš„å†—ä½™è¡¨è¾¾ï¼Œè¿˜æœ‰å¤§é‡çš„é‡å¤ã€ç¡®è®¤ã€å®¢å¥—è¯ã€‚è¿™äº›åœ¨äººé™…äº¤æµä¸­å¾ˆé‡è¦ï¼Œä½†å¯¹æœºå™¨æ£€ç´¢æ¥è¯´å°±æ˜¯å™ªå£°ã€‚</p><p>SeComé€šè¿‡æ™ºèƒ½å‹ç¼©ï¼Œä¿ç•™å…³é”®ä¿¡æ¯çš„åŒæ—¶å»é™¤è¿™äº›â€å™ªå£°â€ï¼Œè®©æ£€ç´¢æ›´åŠ ç²¾å‡†ã€‚</p><h3 id="2-2-ç³»ç»Ÿè®¾è®¡"><a href="#2-2-ç³»ç»Ÿè®¾è®¡" class="headerlink" title="2.2 ç³»ç»Ÿè®¾è®¡"></a>2.2 ç³»ç»Ÿè®¾è®¡</h3><p>SeComçš„æ•´ä½“æ¶æ„è®¾è®¡éå¸¸ä¼˜é›…ï¼Œå°±åƒä¸€æ¡é«˜æ•ˆçš„æµæ°´çº¿ï¼š</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å†å²å¯¹è¯ â†’ [åˆ†æ®µå™¨] â†’ æ®µè½çº§å†…å­˜å•å…ƒ â†’ [å‹ç¼©å™¨] â†’ å»å™ªå†…å­˜å•å…ƒ â†’ [æ£€ç´¢å™¨] â†’ ç›¸å…³ä¸Šä¸‹æ–‡ â†’ [ç”Ÿæˆå™¨] â†’ æœ€ç»ˆå›å¤</span><br></pre></td></tr></tbody></table></figure><p>ç”¨æ›´ç›´è§‚çš„è¯æ¥è§£é‡Šè¿™ä¸ªæµç¨‹ï¼š</p><ol><li><strong>åˆ†æ®µå™¨</strong>ï¼šå°†æ‚ä¹±çš„å¯¹è¯å†å²æŒ‰ä¸»é¢˜â€åˆ‡å—â€</li><li><strong>å‹ç¼©å™¨</strong>ï¼šå°†æ¯ä¸ªâ€å—â€ä¸­çš„åºŸè¯å»æ‰ï¼Œä¿ç•™ç²¾å</li><li><strong>æ£€ç´¢å™¨</strong>ï¼šæ ¹æ®å½“å‰é—®é¢˜æ‰¾åˆ°æœ€ç›¸å…³çš„â€å—â€</li><li><strong>ç”Ÿæˆå™¨</strong>ï¼šåŸºäºç›¸å…³ä¿¡æ¯ç”Ÿæˆå›ç­”</li></ol><p><strong>æŠ€æœ¯è¡¨ç¤º</strong>ï¼ˆæ²¡ä»€ä¹ˆç”¨ï¼Œå†™ç»™å–œæ¬¢æ•°å­¦çš„æœ‹å‹ï¼‰ï¼š<br>è®¾ $f_{\mathcal{I}}$ ä¸ºåˆ†æ®µå™¨ï¼Œ$f_{Comp}$ ä¸ºå‹ç¼©å™¨ï¼Œ$f_R$ ä¸ºæ£€ç´¢å™¨ï¼Œ$f_{LLM}$ ä¸ºç”Ÿæˆå™¨</p><p>å®Œæ•´æµç¨‹ï¼š</p><ol><li>${\mathbf{s}<em>k}</em>{k=1}^K \leftarrow f_{\mathcal{I}}(\mathcal{H})$ ï¼ˆå¯¹è¯åˆ†æ®µï¼‰</li><li>${\mathbf{m}<em>k}</em>{k=1}^K \leftarrow f_{Comp}({\mathbf{s}<em>k}</em>{k=1}^K)$ ï¼ˆå‹ç¼©å»å™ªï¼‰</li><li>${\mathbf{m}<em>n}</em>{n=1}^N \leftarrow f_R(u^*, {\mathbf{m}<em>k}</em>{k=1}^K, N)$ ï¼ˆå†…å­˜æ£€ç´¢ï¼‰</li><li>$r^* = f_{LLM}(u^*, {\mathbf{m}<em>n}</em>{n=1}^N)$ ï¼ˆå“åº”ç”Ÿæˆï¼‰</li></ol><h3 id="2-3-åˆ†æ®µç®—æ³•ï¼šæ•™AIå­¦ä¼šâ€æ–­å¥â€"><a href="#2-3-åˆ†æ®µç®—æ³•ï¼šæ•™AIå­¦ä¼šâ€æ–­å¥â€" class="headerlink" title="2.3 åˆ†æ®µç®—æ³•ï¼šæ•™AIå­¦ä¼šâ€æ–­å¥â€"></a>2.3 åˆ†æ®µç®—æ³•ï¼šæ•™AIå­¦ä¼šâ€æ–­å¥â€</h3><h4 id="2-3-1-é›¶æ ·æœ¬åˆ†æ®µ"><a href="#2-3-1-é›¶æ ·æœ¬åˆ†æ®µ" class="headerlink" title="2.3.1 é›¶æ ·æœ¬åˆ†æ®µ"></a>2.3.1 é›¶æ ·æœ¬åˆ†æ®µ</h4><p>å¦‚ä½•è®©AIè‡ªåŠ¨è¯†åˆ«å¯¹è¯ä¸­çš„ä¸»é¢˜è¾¹ç•Œï¼Ÿä¼ ç»Ÿæ–¹æ³•éœ€è¦å¤§é‡æ ‡æ³¨æ•°æ®è®­ç»ƒä¸“é—¨çš„åˆ†æ®µæ¨¡å‹ï¼Œè€ŒSeComé‡‡ç”¨äº†ä¸€ä¸ªéå¸¸èªæ˜çš„â€é›¶æ ·æœ¬â€æ–¹æ³•ã€‚</p><p><strong>æ ¸å¿ƒæ€è·¯</strong>ï¼š<br>æ—¢ç„¶GPT-4è¿™æ ·çš„å¤§æ¨¡å‹å·²ç»å…·å¤‡äº†å¼ºå¤§çš„æ–‡æœ¬ç†è§£èƒ½åŠ›ï¼Œä¸ºä»€ä¹ˆä¸ç›´æ¥è®©å®ƒæ¥åˆ¤æ–­å¯¹è¯çš„ä¸»é¢˜è¾¹ç•Œå‘¢ï¼Ÿå°±åƒè®©ä¸€ä¸ªæ–‡å­¦è€å¸ˆæ¥ç»™æ–‡ç« åˆ†æ®µä¸€æ ·ã€‚</p><p><strong>è¾“å…¥é¢„å¤„ç†</strong>ï¼š<br>å°†å¯¹è¯ä¼šè¯å¢å¼ºä¸ºç»“æ„åŒ–æ ¼å¼ï¼š</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Turn j: </span><br><span class="line">[user]: u_j</span><br><span class="line">[agent]: r_j</span><br></pre></td></tr></tbody></table></figure><p><strong>åˆ†æ®µæç¤ºè®¾è®¡</strong>ï¼š</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">åˆ†æä»¥ä¸‹å¯¹è¯ï¼Œè¯†åˆ«ä¸»é¢˜è¾¹ç•Œï¼Œå°†å¯¹è¯åˆ†å‰²ä¸ºè¯­ä¹‰è¿è´¯çš„æ®µè½ã€‚</span><br><span class="line">æ¯ä¸ªæ®µè½åº”è¯¥ï¼š</span><br><span class="line">1. å›´ç»•å•ä¸€ä¸»é¢˜æˆ–ç›¸å…³ä¸»é¢˜</span><br><span class="line">2. åŒ…å«å®Œæ•´çš„äº¤äº’åºåˆ—</span><br><span class="line">3. å…·æœ‰æ˜ç¡®çš„å¼€å§‹å’Œç»“æŸè¾¹ç•Œ</span><br><span class="line"></span><br><span class="line">å¯¹è¯å†…å®¹ï¼š</span><br><span class="line">[å¯¹è¯å†…å®¹]</span><br><span class="line"></span><br><span class="line">è¯·è¾“å‡ºæ¯ä¸ªæ®µè½çš„èµ·å§‹å’Œç»“æŸè½®æ¬¡ç¼–å·ã€‚</span><br></pre></td></tr></tbody></table></figure><p><strong>ä¼˜åŠ¿</strong>ï¼š</p><ul><li>æ— éœ€è®­ç»ƒæ•°æ®ï¼Œé€‚ç”¨äºå¼€æ”¾åŸŸå¯¹è¯</li><li>åˆ©ç”¨LLMçš„å¼ºå¤§ç†è§£èƒ½åŠ›</li><li>å¯å¤„ç†å¤æ‚çš„ä¸»é¢˜è½¬æ¢æ¨¡å¼</li></ul><h4 id="2-3-2-åŸºäºåæ€çš„åˆ†æ®µä¼˜åŒ–"><a href="#2-3-2-åŸºäºåæ€çš„åˆ†æ®µä¼˜åŒ–" class="headerlink" title="2.3.2 åŸºäºåæ€çš„åˆ†æ®µä¼˜åŒ–"></a>2.3.2 åŸºäºåæ€çš„åˆ†æ®µä¼˜åŒ–</h4><p>å½“æœ‰å°‘é‡æ ‡æ³¨æ•°æ®æ—¶ï¼Œé‡‡ç”¨åæ€æœºåˆ¶ä¼˜åŒ–åˆ†æ®µæ•ˆæœï¼š</p><p><strong>ç®—æ³•æ­¥éª¤</strong>ï¼š</p><ol><li><strong>åˆå§‹åˆ†æ®µ</strong>ï¼šä½¿ç”¨é›¶æ ·æœ¬æ–¹æ³•å¯¹æ‰¹é‡æ•°æ®è¿›è¡Œåˆ†æ®µ</li><li><strong>é”™è¯¯è¯†åˆ«</strong>ï¼šåŸºäºWindowDiffæŒ‡æ ‡é€‰æ‹©top-Kä¸ªåˆ†æ®µé”™è¯¯æœ€å¤§çš„æ ·æœ¬</li><li><strong>åæ€å­¦ä¹ </strong>ï¼šè®©LLMåˆ†æåˆ†æ®µé”™è¯¯ï¼Œæ›´æ–°åˆ†æ®µæŒ‡å¯¼åŸåˆ™</li><li><strong>è¿­ä»£ä¼˜åŒ–</strong>ï¼šé‡å¤ä¸Šè¿°è¿‡ç¨‹ç›´åˆ°æ”¶æ•›</li></ol><p><strong>åæ€æç¤ºè®¾è®¡</strong>ï¼š</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">åˆ†æä»¥ä¸‹åˆ†æ®µé”™è¯¯ï¼Œå¹¶æ›´æ–°åˆ†æ®µæŒ‡å¯¼åŸåˆ™ï¼š</span><br><span class="line"></span><br><span class="line">é”™è¯¯æ¡ˆä¾‹ï¼š</span><br><span class="line">[åˆ†æ®µç»“æœ] vs [æ ‡å‡†ç­”æ¡ˆ]</span><br><span class="line"></span><br><span class="line">è¯·åˆ†æé”™è¯¯åŸå› å¹¶æä¾›æ”¹è¿›çš„åˆ†æ®µæŒ‡å¯¼åŸåˆ™ã€‚</span><br></pre></td></tr></tbody></table></figure><p><strong>æ•°å­¦è¡¨ç¤º</strong>ï¼š<br>è®¾ $\boldsymbol{G}<em>m$ ä¸ºç¬¬mè½®çš„åˆ†æ®µæŒ‡å¯¼åŸåˆ™ï¼Œæ›´æ–°å…¬å¼ä¸ºï¼š<br>$$\boldsymbol{G}</em>{m+1} = \boldsymbol{G}_m - \eta \nabla \mathcal{L}(\boldsymbol{G}_m)$$</p><p>å…¶ä¸­ $\nabla \mathcal{L}(\boldsymbol{G}_m)$ ä¸ºLLMéšå¼ä¼°è®¡çš„åˆ†æ®µæŸå¤±æ¢¯åº¦ã€‚</p><h4 id="2-3-3-å¢é‡åˆ†æ®µç®—æ³•"><a href="#2-3-3-å¢é‡åˆ†æ®µç®—æ³•" class="headerlink" title="2.3.3 å¢é‡åˆ†æ®µç®—æ³•"></a>2.3.3 å¢é‡åˆ†æ®µç®—æ³•</h4><p>å¯¹äºæ–°å¢çš„å¯¹è¯è½®æ¬¡ï¼Œè®¾è®¡å¢é‡åˆ†æ®µç®—æ³•ï¼š</p><p><strong>ç®—æ³•æµç¨‹</strong>ï¼š</p><ol><li>è¾“å…¥æ–°è½®æ¬¡ $\mathbf{t}<em>{new}$ å’Œå‰ä¸€æ®µè½ $\mathbf{s}</em>{prev}$</li><li>åˆ¤æ–­æ˜¯å¦åº”è¯¥åˆå¹¶ï¼š$binary = f_{judge}(\mathbf{t}<em>{new}, \mathbf{s}</em>{prev})$</li><li>å¦‚æœåˆå¹¶ï¼š$\mathbf{s}<em>{prev} \leftarrow \mathbf{s}</em>{prev} \cup {\mathbf{t}_{new}}$</li><li>å¦åˆ™ï¼šåˆ›å»ºæ–°æ®µè½ $\mathbf{s}<em>{new} = {\mathbf{t}</em>{new}}$</li></ol><p><strong>åˆ¤æ–­æç¤º</strong>ï¼š</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">åˆ¤æ–­æ–°çš„ç”¨æˆ·-æœºå™¨äººè½®æ¬¡æ˜¯å¦åº”è¯¥ä¸å‰ä¸€æ®µè½åˆå¹¶ï¼š</span><br><span class="line"></span><br><span class="line">æ–°è½®æ¬¡ï¼š[æ–°è½®æ¬¡å†…å®¹]</span><br><span class="line">å‰ä¸€æ®µè½ï¼š[å‰ä¸€æ®µè½å†…å®¹]</span><br><span class="line"></span><br><span class="line">å¦‚æœå±äºåŒä¸€ä¸»é¢˜ï¼Œå›ç­”"Yes"ï¼Œå¦åˆ™å›ç­”"No"ã€‚</span><br></pre></td></tr></tbody></table></figure><h3 id="2-4-å‹ç¼©å¼å†…å­˜å»å™ª"><a href="#2-4-å‹ç¼©å¼å†…å­˜å»å™ª" class="headerlink" title="2.4 å‹ç¼©å¼å†…å­˜å»å™ª"></a>2.4 å‹ç¼©å¼å†…å­˜å»å™ª</h3><h4 id="2-4-1-è‡ªç„¶è¯­è¨€å†—ä½™æ€§åˆ†æ"><a href="#2-4-1-è‡ªç„¶è¯­è¨€å†—ä½™æ€§åˆ†æ" class="headerlink" title="2.4.1 è‡ªç„¶è¯­è¨€å†—ä½™æ€§åˆ†æ"></a>2.4.1 è‡ªç„¶è¯­è¨€å†—ä½™æ€§åˆ†æ</h4><p><strong>ç†è®ºåŸºç¡€</strong>ï¼š<br>æ ¹æ®Shannonä¿¡æ¯è®ºï¼Œè‡ªç„¶è¯­è¨€å…·æœ‰é«˜åº¦å†—ä½™æ€§ï¼Œå†—ä½™ç‡çº¦ä¸º50-75%ã€‚è¿™ç§å†—ä½™åœ¨äººç±»äº¤æµä¸­æœ‰åŠ©äºé”™è¯¯çº æ­£å’Œç†è§£ï¼Œä½†åœ¨æœºå™¨æ£€ç´¢ä¸­æ„æˆå™ªå£°ã€‚</p><p><strong>å†—ä½™ç±»å‹</strong>ï¼š</p><ol><li><strong>è¯æ±‡å†—ä½™</strong>ï¼šåŒä¹‰è¯ã€é‡å¤è¡¨è¾¾</li><li><strong>è¯­æ³•å†—ä½™</strong>ï¼šå†—ä½™çš„è¯­æ³•ç»“æ„</li><li><strong>è¯­ä¹‰å†—ä½™</strong>ï¼šé‡å¤çš„è¯­ä¹‰ä¿¡æ¯</li><li><strong>å¯¹è¯å†—ä½™</strong>ï¼šå®¢å¥—è¯ã€ç¡®è®¤æ€§å›å¤</li></ol><h4 id="2-4-2-LLMLingua-2å‹ç¼©åŸç†"><a href="#2-4-2-LLMLingua-2å‹ç¼©åŸç†" class="headerlink" title="2.4.2 LLMLingua-2å‹ç¼©åŸç†"></a>2.4.2 LLMLingua-2å‹ç¼©åŸç†</h4><p><strong>ç®—æ³•æ ¸å¿ƒ</strong>ï¼š<br>LLMLingua-2åŸºäºtokené‡è¦æ€§è¯„åˆ†è¿›è¡Œå‹ç¼©ï¼š</p><ol><li><p><strong>é‡è¦æ€§è¯„åˆ†</strong>ï¼š<br>$$s_i = f_{score}(x_i | x_{&lt;i}, x_{&gt;i})$$<br>å…¶ä¸­ $x_i$ ä¸ºç¬¬iä¸ªtokenï¼Œ$x_{&lt;i}$ å’Œ $x_{&gt;i}$ ä¸ºä¸Šä¸‹æ–‡</p></li><li><p><strong>åŠ¨æ€å‹ç¼©</strong>ï¼š<br>æ ¹æ®ç›®æ ‡å‹ç¼©ç‡ $r$ï¼Œä¿ç•™top $(1-r) \times N$ ä¸ªé‡è¦token</p></li><li><p><strong>è¯­ä¹‰ä¿æŒ</strong>ï¼š<br>é€šè¿‡åŒå‘ä¸Šä¸‹æ–‡å»ºæ¨¡ç¡®ä¿å…³é”®è¯­ä¹‰ä¿¡æ¯ä¸ä¸¢å¤±</p></li></ol><p><strong>å‹ç¼©æ•ˆæœåˆ†æ</strong>ï¼š<br>å®éªŒè¡¨æ˜ï¼Œ75%å‹ç¼©ç‡ä¸‹ï¼š</p><ul><li>å…³é”®ä¿¡æ¯ä¿ç•™ç‡ &gt; 95%</li><li>æ£€ç´¢ç›¸å…³æ€§æå‡ 9.46åˆ†ï¼ˆGPT4Scoreï¼‰</li><li>è®¡ç®—æ•ˆç‡æå‡ 4å€</li></ul><h4 id="2-4-3-å‹ç¼©å¯¹æ£€ç´¢æ€§èƒ½çš„å½±å“"><a href="#2-4-3-å‹ç¼©å¯¹æ£€ç´¢æ€§èƒ½çš„å½±å“" class="headerlink" title="2.4.3 å‹ç¼©å¯¹æ£€ç´¢æ€§èƒ½çš„å½±å“"></a>2.4.3 å‹ç¼©å¯¹æ£€ç´¢æ€§èƒ½çš„å½±å“</h4><p><strong>ç›¸ä¼¼æ€§å˜åŒ–åˆ†æ</strong>ï¼š<br>è®¾ $sim(q, s)$ ä¸ºæŸ¥è¯¢qä¸æ®µè½sçš„ç›¸ä¼¼æ€§</p><p>å‹ç¼©å‰ï¼š$sim_{before}(q, s_{relevant})$ï¼Œ$sim_{before}(q, s_{irrelevant})$<br>å‹ç¼©åï¼š$sim_{after}(q, sâ€™<em>{relevant})$ï¼Œ$sim</em>{after}(q, sâ€™_{irrelevant})$</p><p>å®éªŒç»“æœæ˜¾ç¤ºï¼š</p><ul><li>$sim_{after}(q, sâ€™<em>{relevant}) &gt; sim</em>{before}(q, s_{relevant})$ ï¼ˆç›¸å…³æ®µè½ç›¸ä¼¼æ€§æå‡ï¼‰</li><li>$sim_{after}(q, sâ€™<em>{irrelevant}) &lt; sim</em>{before}(q, s_{irrelevant})$ ï¼ˆæ— å…³æ®µè½ç›¸ä¼¼æ€§é™ä½ï¼‰</li></ul><h3 id="2-5-å¤šæ¨¡æ€æ£€ç´¢ç³»ç»Ÿ"><a href="#2-5-å¤šæ¨¡æ€æ£€ç´¢ç³»ç»Ÿ" class="headerlink" title="2.5 å¤šæ¨¡æ€æ£€ç´¢ç³»ç»Ÿ"></a>2.5 å¤šæ¨¡æ€æ£€ç´¢ç³»ç»Ÿ</h3><h4 id="2-5-1-æ£€ç´¢å™¨é€‰æ‹©ä¸é…ç½®"><a href="#2-5-1-æ£€ç´¢å™¨é€‰æ‹©ä¸é…ç½®" class="headerlink" title="2.5.1 æ£€ç´¢å™¨é€‰æ‹©ä¸é…ç½®"></a>2.5.1 æ£€ç´¢å™¨é€‰æ‹©ä¸é…ç½®</h4><p><strong>BM25æ£€ç´¢å™¨</strong>ï¼š<br>$$BM25(q, d) = \sum_{i=1}^{|q|} IDF(q_i) \cdot \frac{tf(q_i, d) \cdot (k_1 + 1)}{tf(q_i, d) + k_1 \cdot (1 - b + b \cdot \frac{|d|}{avgdl})}$$</p><p>å‚æ•°è®¾ç½®ï¼š$k_1 = 1.2$ï¼Œ$b = 0.75$</p><p><strong>MPNetæ£€ç´¢å™¨</strong>ï¼š<br>åŸºäºMPNetæ¨¡å‹çš„å¯†é›†æ£€ç´¢ï¼š<br>$$score = \cos(\mathbf{e}_q, \mathbf{e}_d)$$<br>å…¶ä¸­ $\mathbf{e}_q$ å’Œ $\mathbf{e}_d$ åˆ†åˆ«ä¸ºæŸ¥è¯¢å’Œæ–‡æ¡£çš„å‘é‡è¡¨ç¤º</p><h4 id="2-5-2-æ··åˆæ£€ç´¢ç­–ç•¥"><a href="#2-5-2-æ··åˆæ£€ç´¢ç­–ç•¥" class="headerlink" title="2.5.2 æ··åˆæ£€ç´¢ç­–ç•¥"></a>2.5.2 æ··åˆæ£€ç´¢ç­–ç•¥</h4><p>ç»“åˆç¨€ç–æ£€ç´¢å’Œå¯†é›†æ£€ç´¢çš„ä¼˜åŠ¿ï¼š<br>$$score_{hybrid} = \alpha \cdot score_{BM25} + (1-\alpha) \cdot score_{MPNet}$$</p><p>é€šè¿‡å®éªŒç¡®å®šæœ€ä¼˜æƒé‡ $\alpha = 0.6$</p><h2 id="3-å†™åœ¨æœ€åï¼šä¸€äº›æ€è€ƒ"><a href="#3-å†™åœ¨æœ€åï¼šä¸€äº›æ€è€ƒ" class="headerlink" title="3. å†™åœ¨æœ€åï¼šä¸€äº›æ€è€ƒ"></a>3. å†™åœ¨æœ€åï¼šä¸€äº›æ€è€ƒ</h2><h3 id="3-1-SeComç»™æˆ‘ä»¬çš„å¯å‘"><a href="#3-1-SeComç»™æˆ‘ä»¬çš„å¯å‘" class="headerlink" title="3.1 SeComç»™æˆ‘ä»¬çš„å¯å‘"></a>3.1 SeComç»™æˆ‘ä»¬çš„å¯å‘</h3><p>ç ”è¯»è¿™ç¯‡è®ºæ–‡åï¼Œç¬”è€…æœ‰å‡ ç‚¹æ·±åˆ»çš„æ„Ÿæ‚Ÿï¼š</p><p><strong>ç®€å•å¾€å¾€æ˜¯æœ€æœ‰æ•ˆçš„</strong>ï¼šSeComçš„æ ¸å¿ƒæ€æƒ³å…¶å®å¾ˆç®€å•â€”â€”åˆ†æ®µ+å‹ç¼©ï¼Œä½†æ­£æ˜¯è¿™ç§ç®€å•çš„ç»„åˆè§£å†³äº†å¤æ‚çš„é—®é¢˜ã€‚è¿™æé†’æˆ‘ä»¬ï¼Œåœ¨é¢å¯¹æŠ€æœ¯æŒ‘æˆ˜æ—¶ï¼Œæœ‰æ—¶å€™æœ€æœ´ç´ çš„æƒ³æ³•åè€Œæ˜¯æœ€æœ‰æ•ˆçš„ã€‚</p><p><strong>ç†è§£é—®é¢˜æ¯”è§£å†³é—®é¢˜æ›´é‡è¦</strong>ï¼šä½œè€…å›¢é˜Ÿæ·±å…¥åˆ†æäº†å†…å­˜ç²’åº¦é—®é¢˜çš„æœ¬è´¨ï¼Œå‘ç°äº†æ®µè½çº§å†…å­˜çš„æœ€ä¼˜æ€§ã€‚è¿™ç§å¯¹é—®é¢˜æœ¬è´¨çš„æ·±åˆ»ç†è§£æ˜¯æŠ€æœ¯åˆ›æ–°çš„åŸºç¡€ã€‚</p><p>ç¬”è€…è®¤ä¸ºæœªæ¥å¯èƒ½çš„å‘å±•æ–¹å‘åŒ…æ‹¬ï¼š</p><ul><li><strong>ä¸ªæ€§åŒ–åˆ†æ®µç­–ç•¥</strong>ï¼šä¸åŒç”¨æˆ·çš„å¯¹è¯æ¨¡å¼ä¸åŒï¼Œèƒ½å¦å­¦ä¹ ä¸ªæ€§åŒ–çš„åˆ†æ®µæ–¹å¼ï¼Ÿ</li><li><strong>å®æ—¶ä¼˜åŒ–æœºåˆ¶</strong>ï¼šèƒ½å¦æ ¹æ®å¯¹è¯è´¨é‡åŠ¨æ€è°ƒæ•´å‹ç¼©ç‡å’Œåˆ†æ®µç­–ç•¥ï¼Ÿ</li></ul><hr><h2 id="å‚è€ƒèµ„æº"><a href="#å‚è€ƒèµ„æº" class="headerlink" title="å‚è€ƒèµ„æº"></a>å‚è€ƒèµ„æº</h2><ul><li><strong>è®ºæ–‡é“¾æ¥</strong>ï¼š<a href="https://www.arxiv.org/abs/2502.05589">SeCom: On Memory Construction and Retrieval for Personalized Conversational Agents (ICLR 2025)</a></li><li><strong>é¡¹ç›®ä¸»é¡µ</strong>ï¼š<a href="https://llmlingua.com/secom.html">https://llmlingua.com/secom.html</a></li><li><strong>ä»£ç ä»“åº“</strong>ï¼šSeCom-mainé¡¹ç›®</li><li><strong>æ•°æ®é›†</strong>ï¼šLOCOMOã€Long-MT-Bench+ã€DialSeg711ã€TIAGEã€SuperDialSeg</li></ul><p><em>æœ¬æ–‡åŸºäºMicrosoftå’Œæ¸…åå¤§å­¦è”åˆç ”ç©¶å›¢é˜Ÿåœ¨ICLR 2025å‘è¡¨çš„è®ºæ–‡æ’°å†™ï¼Œè¯¦ç»†æŠ€æœ¯å®ç°è¯·å‚è€ƒåŸå§‹è®ºæ–‡å’Œå¼€æºä»£ç ã€‚</em> </p>]]></content>
      
      
      <categories>
          
          <category> NLP Insights </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Conversational AI </tag>
            
            <tag> Memory Management </tag>
            
            <tag> SeCom </tag>
            
            <tag> RAG </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Decoder-onlyä¸Encoder-onlyæ¨¡å‹Paddingç­–ç•¥çš„å·®å¼‚</title>
      <link href="/2025/03/06/NLP%20Insights/Decoder%E6%A8%A1%E5%9E%8B%E5%92%8CEncoder%E6%A8%A1%E5%9E%8B%E5%9C%A8Padding%E4%B8%AD%E7%9A%84%E4%B8%8D%E5%90%8C/"/>
      <url>/2025/03/06/NLP%20Insights/Decoder%E6%A8%A1%E5%9E%8B%E5%92%8CEncoder%E6%A8%A1%E5%9E%8B%E5%9C%A8Padding%E4%B8%AD%E7%9A%84%E4%B8%8D%E5%90%8C/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸ“Œ-Padding-çš„å«ä¹‰"><a href="#ğŸ“Œ-Padding-çš„å«ä¹‰" class="headerlink" title="ğŸ“Œ Padding çš„å«ä¹‰"></a>ğŸ“Œ <strong>Padding çš„å«ä¹‰</strong></h2><p>åœ¨å¤§æ¨¡å‹ (<strong>LLM</strong>) ä¸­ï¼Œ<strong>padding</strong> æ˜¯ç”¨äºå°†ä¸åŒé•¿åº¦çš„åºåˆ—è°ƒæ•´ä¸ºåŒä¸€é•¿åº¦çš„æ–¹æ³•ï¼Œä»¥ä¾¿äºæ‰¹é‡ (<strong>batch</strong>) å¤„ç†ã€‚</p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">å¥å­1: "I love NLP"</span><br><span class="line">å¥å­2: "Padding is useful in LLM training"</span><br></pre></td></tr></tbody></table></figure><p>ä½¿ç”¨ <code>&lt;pad&gt;</code> token è¿›è¡Œå¯¹é½ï¼š</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">"I love NLP &lt;pad&gt; &lt;pad&gt; &lt;pad&gt;"</span><br><span class="line">"Padding is useful in LLM training"</span><br></pre></td></tr></tbody></table></figure><hr><h2 id="ğŸ“Œ-Padding-ä½ç½®çš„é€‰æ‹©ï¼šLeft-vs-Right"><a href="#ğŸ“Œ-Padding-ä½ç½®çš„é€‰æ‹©ï¼šLeft-vs-Right" class="headerlink" title="ğŸ“Œ Padding ä½ç½®çš„é€‰æ‹©ï¼šLeft vs Right"></a>ğŸ“Œ <strong>Padding ä½ç½®çš„é€‰æ‹©ï¼šLeft vs Right</strong></h2><p>Padding æœ‰ä¸¤ç§å¸¸è§æ–¹å¼ï¼š</p><ul><li><p><strong>Right padding</strong>ï¼ˆå³å¡«å……ï¼‰ï¼š</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">"I love NLP &lt;pad&gt; &lt;pad&gt;"</span><br></pre></td></tr></tbody></table></figure></li><li><p><strong>Left padding</strong>ï¼ˆå·¦å¡«å……ï¼‰ï¼š</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">"&lt;pad&gt; &lt;pad&gt; I love NLP"</span><br></pre></td></tr></tbody></table></figure></li></ul><p>é€šå¸¸ï¼š</p><ul><li><strong>Decoder-only æ¨¡å‹</strong>ï¼ˆå¦‚ GPT, Llamaï¼‰ï¼šé‡‡ç”¨ <strong>Left padding</strong></li><li><strong>Encoder-only æ¨¡å‹</strong>ï¼ˆå¦‚ BERTï¼‰ï¼šé‡‡ç”¨ <strong>Right padding</strong></li></ul><p>å…·ä½“è€Œè¨€ï¼ŒTransformer æ¨¡å‹é€šå¸¸åˆ†ä¸ºä¸‰ç±»ç»“æ„ï¼š</p><table><thead><tr><th>æ¨¡å‹ç±»å‹</th><th>ä»£è¡¨æ¨¡å‹</th><th>ç‰¹å¾</th><th>å¸¸è§ç”¨é€”</th></tr></thead><tbody><tr><td><strong>Encoder-only</strong></td><td><strong>BERT</strong>ã€RoBERTaã€ALBERTã€ELECTRA</td><td>åŒå‘æ³¨æ„åŠ›ï¼ˆBidirectional Attentionï¼‰</td><td>è‡ªç„¶è¯­è¨€ç†è§£ï¼ˆNLUï¼‰ï¼Œå¦‚æ–‡æœ¬åˆ†ç±»ã€åºåˆ—æ ‡æ³¨</td></tr><tr><td><strong>Decoder-only</strong></td><td>GPTã€GPT-2ã€GPT-3ã€GPT-4ã€LLaMAã€Mistral</td><td>å•å‘è‡ªå›å½’æ³¨æ„åŠ›ï¼ˆCausal Attentionï¼‰</td><td>æ–‡æœ¬ç”Ÿæˆã€èŠå¤©ã€å†™ä½œ</td></tr><tr><td><strong>Encoder-Decoder</strong></td><td>TransformeråŸå§‹è®ºæ–‡ä¸­çš„æ¨¡å‹ã€T5ã€BARTã€mT5ã€PEGASUS</td><td>Encoderä¸ºåŒå‘æ³¨æ„åŠ›ï¼ŒDecoderä¸ºå•å‘è‡ªå›å½’æ³¨æ„åŠ›</td><td>æœºå™¨ç¿»è¯‘ã€æ‘˜è¦ç”Ÿæˆã€å¯¹è¯</td></tr></tbody></table><hr><h2 id="ğŸ“Œ-ä¸ºä»€ä¹ˆ-Encoder-only-æ¨¡å‹ï¼ˆå¦‚BERTï¼‰é‡‡ç”¨-Right-paddingï¼Ÿ"><a href="#ğŸ“Œ-ä¸ºä»€ä¹ˆ-Encoder-only-æ¨¡å‹ï¼ˆå¦‚BERTï¼‰é‡‡ç”¨-Right-paddingï¼Ÿ" class="headerlink" title="ğŸ“Œ ä¸ºä»€ä¹ˆ Encoder-only æ¨¡å‹ï¼ˆå¦‚BERTï¼‰é‡‡ç”¨ Right paddingï¼Ÿ"></a>ğŸ“Œ ä¸ºä»€ä¹ˆ Encoder-only æ¨¡å‹ï¼ˆå¦‚BERTï¼‰é‡‡ç”¨ Right paddingï¼Ÿ</h2><ul><li><strong>Encoder-only æ¨¡å‹</strong>ï¼ˆå¦‚ BERTï¼‰çš„æ ¸å¿ƒç›®æ ‡æ˜¯è·å¾—<strong>æ¯ä¸ª token çš„åµŒå…¥è¡¨ç¤º</strong>ï¼ˆEmbedding representationï¼‰ã€‚</li><li>æ­¤ç±»æ¨¡å‹ä¸º<strong>åŒå‘æ³¨æ„åŠ›ï¼ˆBidirectional Attentionï¼‰</strong>ï¼Œæ¯ä¸ª token å¯åŒæ—¶å…³æ³¨ä¸Šä¸‹æ–‡ï¼Œå› æ­¤<strong>ä½ç½®çš„è½»å¾®å˜åŒ–ä¸ä¼šå¯¹ç»“æœé€ æˆä¸¥é‡å¹²æ‰°</strong>ã€‚</li><li>æ­¤å¤–ï¼Œencoder-only æ¨¡å‹ä¸­é€šå¸¸æœ‰ç‰¹æ®Š tokenï¼ˆå¦‚ <code>[CLS]</code>ï¼‰ï¼Œä½ç½®ç›¸å¯¹ç¨³å®šï¼Œç”¨äºå¥å­åˆ†ç±»æˆ–è¡¨ç¤ºï¼Œå› æ­¤é‡‡ç”¨ <strong>right padding</strong> æ›´è‡ªç„¶ï¼Œä¹Ÿæ›´åˆç†ã€‚</li></ul><p>ç¤ºä¾‹è¯´æ˜ï¼š</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[CLS] Hello I love NLP [SEP] &lt;pad&gt; &lt;pad&gt;</span><br></pre></td></tr></tbody></table></figure><ul><li>å³å¡«å……åï¼Œ<code>[CLS]</code> å’Œ <code>[SEP]</code> token ä½ç½®ç¨³å®šï¼Œä¸”ä¾¿äºæ¨¡å‹ä¸“æ³¨äºå‰é¢çš„æœ‰æ•ˆä¿¡æ¯ã€‚</li></ul><hr><h2 id="ğŸ“Œ-ä¸ºä»€ä¹ˆ-Decoder-only-LLM-é‡‡ç”¨-Left-paddingï¼Ÿ"><a href="#ğŸ“Œ-ä¸ºä»€ä¹ˆ-Decoder-only-LLM-é‡‡ç”¨-Left-paddingï¼Ÿ" class="headerlink" title="ğŸ“Œ ä¸ºä»€ä¹ˆ Decoder-only LLM é‡‡ç”¨ Left paddingï¼Ÿ"></a>ğŸ“Œ ä¸ºä»€ä¹ˆ Decoder-only LLM é‡‡ç”¨ Left paddingï¼Ÿ</h2><p>ä»¥ GPT ä¸ºä»£è¡¨çš„ <strong>Decoder-only æ¨¡å‹</strong> æ˜¯è‡ªå›å½’ï¼ˆ<strong>Autoregressive</strong>ï¼‰æ¨¡å‹ï¼Œæ¯ä¸ªè¯çš„ç”Ÿæˆä»…ä¾èµ–äºå½“å‰åŠä¹‹å‰çš„è¯ï¼Œæœªæ¥è¯ä¸å¯è§ã€‚å› æ­¤ï¼š</p><ul><li><strong>ä½ç½®ç¼–ç çš„ç¨³å®šæ€§</strong>ï¼š<br>å·¦å¡«å……ç¡®ä¿çœŸå® token çš„ç›¸å¯¹ä½ç½®ç¨³å®šï¼Œæ¨¡å‹ç”Ÿæˆæ–° token æ—¶ä½ç½®ç¼–ç å§‹ç»ˆç¨³å®šäºåºåˆ—æœ«å°¾ã€‚<ul><li>å½“é‡‡ç”¨<strong>ç»å¯¹ä½ç½®ç¼–ç </strong>ï¼ˆAbsolute Positional Encodingï¼‰æ—¶ï¼Œæ¯ä¸ª tokenï¼ˆåŒ…æ‹¬ <code>&lt;pad&gt;</code>ï¼‰éƒ½æœ‰å¯¹åº”çš„ä½ç½®ç¼–å·ã€‚</li><li>å¯¹äºå·¦å¡«å……çš„ padding tokensï¼Œè™½ç„¶å®ƒä»¬å æ®äº†ä½ç½®ç¼–å·ï¼ˆå¦‚ 1ã€2ï¼‰ï¼Œä½†æ¨¡å‹é€šè¿‡<strong>æ©ç æœºåˆ¶</strong>å¿½ç•¥å…¶å¯¹æ³¨æ„åŠ›å’Œè¾“å‡ºç»“æœçš„å½±å“ã€‚<br>ç¤ºä¾‹ï¼š</li></ul></li></ul><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ä½ç½®ç¼–ç : [ 1      2      3      4      5      6 ]</span><br><span class="line">Token:   [ &lt;pad&gt;, &lt;pad&gt;, Hello,  I,   love,  NLP ]</span><br><span class="line">æ©ç :     [  0,     0,     1,     1,     1,    1 ]</span><br></pre></td></tr></tbody></table></figure><ul><li>æ¨¡å‹åªå…³æ³¨æ©ç ä¸º 1 çš„æœ‰æ•ˆ tokenï¼Œè€Œå¿½ç•¥æ©ç ä¸º 0 çš„ padding tokensã€‚</li><li><strong>æ³¨æ„åŠ›æ©ç ï¼ˆAttention Maskï¼‰</strong>ï¼š<br>å·¦ä¾§çš„ <code>&lt;pad&gt;</code> ä¼šè¢«<strong>æ³¨æ„åŠ›æ©ç ï¼ˆattention maskï¼‰å¿½ç•¥</strong>ï¼Œä»è€Œé¿å… padding token å¹²æ‰°æœ‰æ•ˆ token çš„ä½ç½®ç¼–ç å’Œæ³¨æ„åŠ›è®¡ç®—ã€‚</li></ul><p>ç¤ºä¾‹è¯´æ˜ï¼š</p><table><thead><tr><th>Token</th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th></tr></thead><tbody><tr><td>Left</td><td><code>&lt;pad&gt;</code></td><td><code>&lt;pad&gt;</code></td><td>Hello</td><td>I</td><td>love</td><td>NLP</td></tr><tr><td>Right</td><td>Hello</td><td>I</td><td>love</td><td>NLP</td><td><code>&lt;pad&gt;</code></td><td><code>&lt;pad&gt;</code></td></tr></tbody></table><ul><li><strong>Left padding</strong> ä¸‹ï¼Œæœ€åæœ‰æ•ˆ token å§‹ç»ˆåœ¨åŒä¸€ä½ç½®ï¼ˆ6ï¼‰ã€‚</li><li><strong>Right padding</strong> ä¸‹ï¼Œtoken çš„ä½ç½®éšåºåˆ—é•¿åº¦å˜åŒ–ï¼Œå½±å“ä½ç½®ç¼–ç çš„ç¨³å®šæ€§ã€‚</li></ul><hr><h2 id="ğŸ“Œ-Padding-åœ¨è®­ç»ƒä¸æ¨ç†é˜¶æ®µçš„å·®å¼‚"><a href="#ğŸ“Œ-Padding-åœ¨è®­ç»ƒä¸æ¨ç†é˜¶æ®µçš„å·®å¼‚" class="headerlink" title="ğŸ“Œ Padding åœ¨è®­ç»ƒä¸æ¨ç†é˜¶æ®µçš„å·®å¼‚"></a>ğŸ“Œ <strong>Padding åœ¨è®­ç»ƒä¸æ¨ç†é˜¶æ®µçš„å·®å¼‚</strong></h2><table><thead><tr><th>é˜¶æ®µ (Phase)</th><th>Padding ç­–ç•¥</th><th>åŸå› </th></tr></thead><tbody><tr><td><strong>è®­ç»ƒ (Training)</strong></td><td>æ‰¹é‡å¤„ç†æ—¶ï¼ŒDecoder-only å¸¸ç”¨å·¦å¡«å……ï¼›Encoder-only æ¨¡å‹åˆ™å¸¸ç”¨å³å¡«å……</td><td>æ‰¹é‡å¤„ç†ï¼ŒåŠ å¿«è®¡ç®—æ•ˆç‡</td></tr><tr><td><strong>æ¨ç† (Inference)</strong></td><td>é€šå¸¸å•æ¡åºåˆ—ï¼Œæ— éœ€ paddingï¼›è‹¥éœ€è¦æ‰¹é‡æ¨ç†ï¼Œä»é‡‡ç”¨å·¦å¡«å……</td><td>ç¨³å®šä½ç½®ç¼–ç </td></tr></tbody></table><hr><h2 id="ğŸ“Œ-æ€»ç»“ä¸å…³é”®è¦ç‚¹ï¼ˆTL-DRï¼‰"><a href="#ğŸ“Œ-æ€»ç»“ä¸å…³é”®è¦ç‚¹ï¼ˆTL-DRï¼‰" class="headerlink" title="ğŸ“Œ æ€»ç»“ä¸å…³é”®è¦ç‚¹ï¼ˆTL;DRï¼‰"></a>ğŸ“Œ <strong>æ€»ç»“ä¸å…³é”®è¦ç‚¹ï¼ˆTL;DRï¼‰</strong></h2><ul><li><strong>Padding</strong> ç”¨äºåºåˆ—é•¿åº¦æ ‡å‡†åŒ–ã€‚</li><li><strong>Decoder-only LLMs (GPT, Llama)</strong> é€šå¸¸é‡‡ç”¨<strong>å·¦å¡«å……ï¼ˆLeft paddingï¼‰</strong>ï¼Œç›®çš„æ˜¯<strong>ç¨³å®šä½ç½®ç¼–ç å¹¶é¿å…æœªæ¥ä¿¡æ¯æ³„æ¼</strong>ï¼›å·¦ä¾§ padding ä¼šè¢«æ©ç å¿½ç•¥ï¼Œä¸å¹²æ‰°æ¨¡å‹é¢„æµ‹ã€‚</li><li><strong>Encoder-only æ¨¡å‹ï¼ˆå¦‚BERTç³»åˆ—ï¼‰</strong>é€šå¸¸é‡‡ç”¨<strong>å³å¡«å……ï¼ˆRight paddingï¼‰</strong>ï¼Œå› ä¸ºæ¨¡å‹ä¸ºåŒå‘æ³¨æ„åŠ›ï¼Œä¸”ç‰¹æ®Štokenï¼ˆå¦‚<code>[CLS]</code>ï¼‰ä½ç½®éœ€è¦ä¿æŒç¨³å®šã€‚</li><li>ä½ç½®ç¼–ç ä¸­è™½ç„¶ padding token å ä½ï¼Œä½†ä¼šè¢«<strong>æ³¨æ„åŠ›æ©ç </strong>æœ‰æ•ˆå±è”½ï¼Œä¸å½±å“æ¨¡å‹çš„æœ€ç»ˆè¾“å‡ºã€‚</li></ul><hr>]]></content>
      
      
      <categories>
          
          <category> NLP Insights </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LLM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Differences in Padding Strategies Between Decoder-only and Encoder-only Models</title>
      <link href="/2025/03/06/NLP%20Insights/Differences%20in%20Padding%20Strategies%20Between%20Decoder-only%20and%20Encoder-only%20Models/"/>
      <url>/2025/03/06/NLP%20Insights/Differences%20in%20Padding%20Strategies%20Between%20Decoder-only%20and%20Encoder-only%20Models/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸ“Œ-What-is-Padding"><a href="#ğŸ“Œ-What-is-Padding" class="headerlink" title="ğŸ“Œ What is Padding?"></a>ğŸ“Œ <strong>What is Padding?</strong></h2><p>In <strong>Large Language Models (LLMs)</strong>, <strong>padding</strong> is a method used to standardize sequence lengths for <strong>batch processing</strong>.</p><p>For example:</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Sentence 1: "I love NLP"</span><br><span class="line">Sentence 2: "Padding is useful in LLM training"</span><br></pre></td></tr></tbody></table></figure><p>Using the <code>&lt;pad&gt;</code> token for alignment:</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">"I love NLP &lt;pad&gt; &lt;pad&gt; &lt;pad&gt;"</span><br><span class="line">"Padding is useful in LLM training"</span><br></pre></td></tr></tbody></table></figure><hr><h2 id="ğŸ“Œ-Padding-Positioning-Left-vs-Right"><a href="#ğŸ“Œ-Padding-Positioning-Left-vs-Right" class="headerlink" title="ğŸ“Œ Padding Positioning: Left vs Right"></a>ğŸ“Œ <strong>Padding Positioning: Left vs Right</strong></h2><p>There are two common padding strategies:</p><ul><li><p><strong>Right padding</strong>:</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">"I love NLP &lt;pad&gt; &lt;pad&gt;"</span><br></pre></td></tr></tbody></table></figure></li><li><p><strong>Left padding</strong>:</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">"&lt;pad&gt; &lt;pad&gt; I love NLP"</span><br></pre></td></tr></tbody></table></figure></li></ul><p>Typically:</p><ul><li><strong>Decoder-only models</strong> (e.g., GPT, Llama): Use <strong>Left padding</strong>.</li><li><strong>Encoder-only models</strong> (e.g., BERT): Use <strong>Right padding</strong>.</li></ul><p>Transformers can be categorized into three main architectures:</p><table><thead><tr><th>Model Type</th><th>Representative Models</th><th>Characteristics</th><th>Common Applications</th></tr></thead><tbody><tr><td><strong>Encoder-only</strong></td><td><strong>BERT</strong>, RoBERTa, ALBERT, ELECTRA</td><td><strong>Bidirectional attention</strong></td><td>NLP tasks like text classification, named entity recognition</td></tr><tr><td><strong>Decoder-only</strong></td><td>GPT, GPT-2, GPT-3, GPT-4, LLaMA, Mistral</td><td><strong>Causal attention (Autoregressive)</strong></td><td>Text generation, chatbots, writing assistance</td></tr><tr><td><strong>Encoder-Decoder</strong></td><td>Transformer (original), T5, BART, mT5, PEGASUS</td><td><strong>Encoder: bidirectional, Decoder: autoregressive</strong></td><td>Machine translation, summarization, dialogue systems</td></tr></tbody></table><hr><h2 id="ğŸ“Œ-Why-Do-Encoder-only-Models-e-g-BERT-Use-Right-Padding"><a href="#ğŸ“Œ-Why-Do-Encoder-only-Models-e-g-BERT-Use-Right-Padding" class="headerlink" title="ğŸ“Œ Why Do Encoder-only Models (e.g., BERT) Use Right Padding?"></a>ğŸ“Œ <strong>Why Do Encoder-only Models (e.g., BERT) Use Right Padding?</strong></h2><ul><li><strong>Encoder-only models</strong> (like BERT) aim to obtain <strong>representations for each token</strong>.</li><li>These models use <strong>bidirectional attention</strong>, meaning each token attends to <strong>both past and future tokens</strong>.</li><li><strong>Slight shifts in position do not significantly impact model performance</strong>.</li><li>Special tokens (e.g., <code>[CLS]</code>) in BERT maintain a <strong>fixed position</strong> for tasks like classification, making <strong>right padding more natural</strong>.</li></ul><p>Example:</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[CLS] Hello I love NLP [SEP] &lt;pad&gt; &lt;pad&gt;</span><br></pre></td></tr></tbody></table></figure><ul><li>Right padding keeps <code>[CLS]</code> and <code>[SEP]</code> in stable positions, allowing the model to focus on meaningful tokens.</li></ul><hr><h2 id="ğŸ“Œ-Why-Do-Decoder-only-LLMs-Use-Left-Padding"><a href="#ğŸ“Œ-Why-Do-Decoder-only-LLMs-Use-Left-Padding" class="headerlink" title="ğŸ“Œ Why Do Decoder-only LLMs Use Left Padding?"></a>ğŸ“Œ <strong>Why Do Decoder-only LLMs Use Left Padding?</strong></h2><p><strong>Decoder-only models</strong> (like GPT) are <strong>autoregressive</strong>, meaning each token is generated based only on <strong>previous tokens</strong>, and future tokens are <strong>masked</strong>.</p><ul><li><strong>Positional Encoding Stability</strong>:<br>Left padding ensures that meaningful tokens have a <strong>consistent relative position</strong>, preventing <strong>position encoding misalignment</strong>.<ul><li>When using <strong>absolute positional encoding</strong>, every token (including <code>&lt;pad&gt;</code>) gets a unique position index.</li><li>Padding tokens at the beginning <strong>do not affect the modelâ€™s attention mechanism</strong> due to <strong>masking</strong>.</li></ul></li></ul><p>Example:</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Position Index: [ 1      2      3      4      5      6 ]</span><br><span class="line">Token:         [ &lt;pad&gt;, &lt;pad&gt;, Hello,  I,   love,  NLP ]</span><br><span class="line">Mask:          [  0,     0,     1,     1,     1,    1 ]</span><br></pre></td></tr></tbody></table></figure><ul><li><p>The model <strong>only attends to tokens where the mask is 1</strong>, ignoring padding tokens.</p></li><li><p><strong>Attention Masking</strong>:<br>Left padding ensures that <code>&lt;pad&gt;</code> tokens <strong>do not interfere with token position encoding</strong>.</p></li></ul><p>Illustration:</p><table><thead><tr><th>Token</th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th></tr></thead><tbody><tr><td>Left</td><td><code>&lt;pad&gt;</code></td><td><code>&lt;pad&gt;</code></td><td>Hello</td><td>I</td><td>love</td><td>NLP</td></tr><tr><td>Right</td><td>Hello</td><td>I</td><td>love</td><td>NLP</td><td><code>&lt;pad&gt;</code></td><td><code>&lt;pad&gt;</code></td></tr></tbody></table><ul><li><strong>With Left padding</strong>, the last valid token <strong>always remains in the same position</strong>.</li><li><strong>With Right padding</strong>, token positions shift, affecting positional encoding stability.</li></ul><hr><h2 id="ğŸ“Œ-Padding-Differences-in-Training-vs-Inference"><a href="#ğŸ“Œ-Padding-Differences-in-Training-vs-Inference" class="headerlink" title="ğŸ“Œ Padding Differences in Training vs Inference"></a>ğŸ“Œ <strong>Padding Differences in Training vs Inference</strong></h2><table><thead><tr><th>Phase</th><th>Padding Strategy</th><th>Reason</th></tr></thead><tbody><tr><td><strong>Training</strong></td><td>Left padding for decoder-only; Right padding for encoder-only</td><td>Optimized for batch processing efficiency</td></tr><tr><td><strong>Inference</strong></td><td>Typically, no padding for single sequences; Left padding for batched inference</td><td>Ensures stable positional encoding</td></tr></tbody></table><hr><h2 id="ğŸ“Œ-Summary-amp-Key-Takeaways-TL-DR"><a href="#ğŸ“Œ-Summary-amp-Key-Takeaways-TL-DR" class="headerlink" title="ğŸ“Œ Summary &amp; Key Takeaways (TL;DR)"></a>ğŸ“Œ <strong>Summary &amp; Key Takeaways (TL;DR)</strong></h2><ul><li><strong>Padding</strong> standardizes sequence lengths for batch processing.</li><li><strong>Decoder-only models (GPT, Llama)</strong> use <strong>Left padding</strong> to <strong>stabilize positional encoding and prevent future token leakage</strong>. Left padding tokens are masked out.</li><li><strong>Encoder-only models (BERT, RoBERTa)</strong> use <strong>Right padding</strong> since they employ <strong>bidirectional attention</strong> and rely on stable special token positions (e.g., <code>[CLS]</code>).</li><li>Although padding tokens occupy positions in <strong>positional encoding</strong>, <strong>attention masks</strong> effectively filter them out, ensuring they do not affect model predictions.</li></ul><hr>]]></content>
      
      
      <categories>
          
          <category> NLP Insights </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LLM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MoEæ¨¡å‹çš„çš„å¯è§†åŒ–æŒ‡å—ï¼šæ­ç§˜ MoE åœ¨å¤§å‹è¯­è¨€æ¨¡å‹ä¸­çš„è§’è‰²</title>
      <link href="/2025/02/11/NLP%20Insights/MoE%E6%A8%A1%E5%9E%8B%E7%9A%84%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%8D%97%EF%BC%9A%E6%8F%AD%E7%A7%98%20MoE%20%E5%9C%A8%E5%A4%A7%E5%9E%8B%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E4%B8%AD%E7%9A%84%E8%A7%92%E8%89%B2/"/>
      <url>/2025/02/11/NLP%20Insights/MoE%E6%A8%A1%E5%9E%8B%E7%9A%84%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%8D%97%EF%BC%9A%E6%8F%AD%E7%A7%98%20MoE%20%E5%9C%A8%E5%A4%A7%E5%9E%8B%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E4%B8%AD%E7%9A%84%E8%A7%92%E8%89%B2/</url>
      
        <content type="html"><![CDATA[<h1 id="MoE-æ¨¡å‹çš„çš„å¯è§†åŒ–æŒ‡å—ï¼šæ­ç§˜-MoE-åœ¨å¤§å‹è¯­è¨€æ¨¡å‹ä¸­çš„è§’è‰²"><a href="#MoE-æ¨¡å‹çš„çš„å¯è§†åŒ–æŒ‡å—ï¼šæ­ç§˜-MoE-åœ¨å¤§å‹è¯­è¨€æ¨¡å‹ä¸­çš„è§’è‰²" class="headerlink" title="MoE æ¨¡å‹çš„çš„å¯è§†åŒ–æŒ‡å—ï¼šæ­ç§˜ MoE åœ¨å¤§å‹è¯­è¨€æ¨¡å‹ä¸­çš„è§’è‰²"></a>MoE æ¨¡å‹çš„çš„å¯è§†åŒ–æŒ‡å—ï¼šæ­ç§˜ MoE åœ¨å¤§å‹è¯­è¨€æ¨¡å‹ä¸­çš„è§’è‰²</h1><p><strong>åŸæ–‡åœ°å€</strong>ï¼š<a href="https://newsletter.maartengrootendorst.com/p/a-visual-guide-to-mixture-of-experts">A Visual Guide to Mixture of Experts (MoE)</a></p><p>ğŸ“… ä½œè€…ï¼šMaarten Grootendorst</p><p>ğŸ“† æ—¥æœŸï¼š2024 å¹´ 10 æœˆ 7 æ—¥</p><hr><h1 id="æ¢ç´¢è¯­è¨€æ¨¡å‹ï¼šæ··åˆä¸“å®¶æ¨¡å‹ï¼ˆMoEï¼‰å¯è§†åŒ–æŒ‡å—"><a href="#æ¢ç´¢è¯­è¨€æ¨¡å‹ï¼šæ··åˆä¸“å®¶æ¨¡å‹ï¼ˆMoEï¼‰å¯è§†åŒ–æŒ‡å—" class="headerlink" title="æ¢ç´¢è¯­è¨€æ¨¡å‹ï¼šæ··åˆä¸“å®¶æ¨¡å‹ï¼ˆMoEï¼‰å¯è§†åŒ–æŒ‡å—"></a>æ¢ç´¢è¯­è¨€æ¨¡å‹ï¼šæ··åˆä¸“å®¶æ¨¡å‹ï¼ˆMoEï¼‰å¯è§†åŒ–æŒ‡å—</h1><h2 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h2><ul><li><a href="#moe-%E6%A8%A1%E5%9E%8B%E7%9A%84%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%8D%97%E6%8F%AD%E7%A7%98-moe-%E5%9C%A8%E5%A4%A7%E5%9E%8B%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E4%B8%AD%E7%9A%84%E8%A7%92%E8%89%B2">MoE æ¨¡å‹çš„çš„å¯è§†åŒ–æŒ‡å—ï¼šæ­ç§˜ MoE åœ¨å¤§å‹è¯­è¨€æ¨¡å‹ä¸­çš„è§’è‰²</a></li><li><a href="#%E6%8E%A2%E7%B4%A2%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E6%B7%B7%E5%90%88%E4%B8%93%E5%AE%B6%E6%A8%A1%E5%9E%8Bmoe%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%8D%97">æ¢ç´¢è¯­è¨€æ¨¡å‹ï¼šæ··åˆä¸“å®¶æ¨¡å‹ï¼ˆMoEï¼‰å¯è§†åŒ–æŒ‡å—</a><ul><li><a href="#%E7%9B%AE%E5%BD%95">ç›®å½•</a></li><li><a href="#%E4%BB%80%E4%B9%88%E6%98%AF%E6%B7%B7%E5%90%88%E4%B8%93%E5%AE%B6moe%E6%A8%A1%E5%9E%8B">ä»€ä¹ˆæ˜¯æ··åˆä¸“å®¶ï¼ˆMoEï¼‰æ¨¡å‹ï¼Ÿ</a></li><li><a href="#experts">Experts</a><ul><li><a href="#dense-layers">Dense Layers</a></li><li><a href="#sparse-layers">Sparse Layers</a></li><li><a href="#what-does-an-expert-learn">What does an Expert Learn?</a></li><li><a href="#%E4%B8%93%E5%AE%B6%E7%9A%84%E6%9E%B6%E6%9E%84architecture-of-experts">ä¸“å®¶çš„æ¶æ„ï¼ˆArchitecture of Expertsï¼‰</a></li></ul></li></ul></li></ul><p>å½“æˆ‘ä»¬æŸ¥çœ‹æœ€æ–°å‘å¸ƒçš„å¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆ<strong>LLMs</strong>ï¼ŒLarge Language Modelsï¼‰æ—¶ï¼Œå¸¸å¸¸ä¼šåœ¨æ ‡é¢˜ä¸­çœ‹åˆ° â€œ<strong>MoE</strong>â€ã€‚è¿™ä¸ª â€œMoEâ€ ä»£è¡¨ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆè¿™ä¹ˆå¤š LLM éƒ½åœ¨ä½¿ç”¨å®ƒï¼Ÿ</p><p>åœ¨è¿™ä»½å¯è§†åŒ–æŒ‡å—ä¸­ï¼Œæˆ‘ä»¬ä¼šé€šè¿‡ 50 å¤šä¸ªå¯è§†åŒ–å›¾ç¤ºï¼Œé€æ­¥æ¢ç´¢è¿™ä¸€å…³é”®ç»„ä»¶ï¼š**Mixture of Experts (MoE)**ã€‚</p><img src="/2025/02/11/NLP%20Insights/MoE%E6%A8%A1%E5%9E%8B%E7%9A%84%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%8D%97%EF%BC%9A%E6%8F%AD%E7%A7%98%20MoE%20%E5%9C%A8%E5%A4%A7%E5%9E%8B%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E4%B8%AD%E7%9A%84%E8%A7%92%E8%89%B2/20250224_145859.png" class=""><p><strong>å›¾ç¤ºå†…å®¹</strong>ï¼šåœ¨è¿™å¼ å›¾ä¸­ï¼Œå¯ä»¥çœ‹åˆ°ä¸€ä¸ªå…¸å‹ <strong>MoE</strong> ç»“æ„çš„ä¸¤ä¸ªä¸»è¦ç»„æˆéƒ¨åˆ†ï¼š<strong>Experts</strong>ï¼ˆä¸“å®¶ï¼‰å’Œ <strong>Router</strong>ï¼ˆè·¯ç”±å™¨æˆ–é—¨æ§ç½‘ç»œï¼‰ã€‚å›¾ä¸­æ˜¾ç¤ºäº†ä¸€ä¸ª <strong>Router</strong>ï¼Œä»¥åŠä¸‹æ–¹å¹¶åˆ—çš„å¤šä¸ª <strong>Experts</strong>ï¼Œè¡¨æ˜åœ¨ <strong>LLM</strong> æ¶æ„ä¸­ï¼ŒMoE ä¼šå°†è¾“å…¥æ ¹æ®éœ€è¦è·¯ç”±åˆ°åˆé€‚çš„ä¸“å®¶ã€‚<br><strong>å›¾ 1 è¯¦ç»†è¯´æ˜</strong>ï¼š</p><ol><li><strong>Router</strong>ï¼šå†³å®šå°†è¾“å…¥ï¼ˆä¾‹å¦‚ tokenï¼‰å‘é€ç»™å“ªä¸€ä¸ªæˆ–å“ªå‡ ä¸ªä¸“å®¶ã€‚</li><li><strong>Experts</strong>ï¼šè‹¥å¹²ä¸ªä¸åŒçš„å­æ¨¡å‹ï¼ˆé€šå¸¸æ˜¯ <strong>FFNN</strong> ç»“æ„ï¼‰ï¼Œæ¯ä¸ªä¸“å®¶å¯èƒ½åœ¨ä¸åŒæ–¹é¢å…·æœ‰ä¸“é•¿ã€‚</li><li><strong>å·¥ä½œæµç¨‹</strong>ï¼šè¾“å…¥å…ˆé€šè¿‡ <strong>Router</strong>ï¼Œå†è¢«åˆ†é…åˆ°ä¸åŒçš„ä¸“å®¶è¿›è¡Œå¤„ç†ï¼Œæœ€åæ±‡æ€»ç»“æœã€‚</li></ol><h2 id="ä»€ä¹ˆæ˜¯æ··åˆä¸“å®¶ï¼ˆMoEï¼‰æ¨¡å‹ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯æ··åˆä¸“å®¶ï¼ˆMoEï¼‰æ¨¡å‹ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯æ··åˆä¸“å®¶ï¼ˆMoEï¼‰æ¨¡å‹ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯æ··åˆä¸“å®¶ï¼ˆMoEï¼‰æ¨¡å‹ï¼Ÿ</h2><p><strong>Mixture of Experts (MoE)</strong> æ˜¯ä¸€ç§æŠ€æœ¯ï¼Œå®ƒä½¿ç”¨è®¸å¤šä¸åŒçš„å­æ¨¡å‹ï¼ˆæˆ–â€œ<strong>experts</strong>â€ï¼‰æ¥æå‡å¤§å‹è¯­è¨€æ¨¡å‹çš„è´¨é‡ã€‚</p><p>åœ¨ MoE ä¸­ï¼Œæœ‰ä¸¤ä¸ªä¸»è¦ç»„ä»¶ï¼š</p><ol><li><strong>Experts</strong><ul><li>æ¯ä¸ª <strong>FFNN</strong> å±‚éƒ½ä¸å†æ˜¯ä¸€ä¸ªå•ç‹¬çš„ç½‘ç»œï¼Œè€Œæ˜¯æœ‰ä¸€ç»„â€œä¸“å®¶â€å¯ä¾›é€‰æ‹©ã€‚</li><li>è¿™äº›â€œä¸“å®¶â€é€šå¸¸ä¹Ÿæ˜¯ <strong>FFNN</strong>ï¼ˆFeedforward Neural Networkï¼‰ç»“æ„ã€‚</li></ul></li><li><strong>Router</strong> æˆ– <strong>gate network</strong><ul><li>è´Ÿè´£å†³å®šå“ªäº› <strong>tokens</strong> è¢«å‘é€åˆ°å“ªäº›ä¸“å®¶ã€‚</li></ul></li></ol><p>åœ¨ä¸€ä¸ªå¸¦æœ‰ MoE çš„ <strong>LLM</strong> çš„æ¯ä¸€å±‚ï¼Œæˆ‘ä»¬éƒ½èƒ½çœ‹åˆ°ï¼ˆåœ¨æŸç§ç¨‹åº¦ä¸Šï¼‰æœ‰æ‰€ä¸“é—¨åŒ–çš„ä¸“å®¶ï¼š</p><img src="/2025/02/11/NLP%20Insights/MoE%E6%A8%A1%E5%9E%8B%E7%9A%84%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%8D%97%EF%BC%9A%E6%8F%AD%E7%A7%98%20MoE%20%E5%9C%A8%E5%A4%A7%E5%9E%8B%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E4%B8%AD%E7%9A%84%E8%A7%92%E8%89%B2/20250224_150409.png" class=""><p><strong>å›¾ç¤ºå†…å®¹</strong>ï¼šå±•ç¤ºäº†åœ¨ <strong>LLM</strong> çš„æ¯ä¸€å±‚éƒ½å¯ä»¥æ‹¥æœ‰å¤šä¸ª <strong>Experts</strong>ã€‚å®ƒå¼ºè°ƒäº†è¿™äº›ä¸“å®¶åœ¨ä¸åŒçš„ä¸Šä¸‹æ–‡ä¸­èƒ½å¤Ÿå¤„ç†ä¸åŒçš„è¾“å…¥ tokenã€‚<br><strong>å›¾2è¯¦ç»†è¯´æ˜</strong>ï¼š  </p><ol><li><strong>å±‚ç»“æ„</strong>ï¼šå›¾ä¸­ç”¨ä¸åŒçš„å±‚çº§ï¼ˆLayer 1ã€Layer 2ã€Layer 3â€¦â€¦ï¼‰è¡¨ç¤ºå¤šå±‚æ¨¡å‹ã€‚  </li><li><strong>Experts</strong>ï¼šåœ¨æ¯ä¸€å±‚ï¼Œéƒ½æœ‰è‹¥å¹²ä¸ªä¸“å®¶ï¼ˆExpert 1ã€Expert 2ã€Expert 3ã€Expert 4ï¼‰ï¼Œè¿™äº›ä¸“å®¶å¹¶è¡Œå­˜åœ¨ã€‚  </li><li><strong>ç›®æ ‡</strong>ï¼šå¼ºè°ƒä¸“å®¶åœ¨ç‰¹å®šä¸Šä¸‹æ–‡æˆ–ç‰¹å®šè¾“å…¥æ—¶æ›´å…·å¤‡â€œä¸“ä¸šæ€§â€ï¼Œä»è€Œè¢«é€‰ä¸­æ¥å¤„ç†è¯¥è¾“å…¥ã€‚</li></ol><p>å°½ç®¡ MoE å¹¶ä¸ä¼šåœ¨ç‰¹å®šé¢†åŸŸï¼ˆå¦‚å¿ƒç†å­¦æˆ–ç”Ÿç‰©å­¦ï¼‰ä¸Šä¸“é—¨è®­ç»ƒä¸“å®¶ï¼Œä½†å®ƒä»¬ä»å¯èƒ½åœ¨è¯æ³•æˆ–å¥æ³•çº§åˆ«ä¸Šå½¢æˆä¸€å®šçš„åå‘ï¼š</p><img src="/2025/02/11/NLP%20Insights/MoE%E6%A8%A1%E5%9E%8B%E7%9A%84%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%8D%97%EF%BC%9A%E6%8F%AD%E7%A7%98%20MoE%20%E5%9C%A8%E5%A4%A7%E5%9E%8B%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E4%B8%AD%E7%9A%84%E8%A7%92%E8%89%B2/20250224_153715.png" class=""><ul><li><strong>MoE ä¸“å®¶å¯èƒ½å­¦ä¹ åˆ°ä¸åŒçš„è¯­è¨€ç‰¹å¾</strong><ul><li><strong>Expert 1</strong> å¤„ç†<strong>æ ‡ç‚¹ç¬¦å·</strong>ï¼ˆPunctuationï¼‰ï¼šå¦‚ <code>, . : &amp; - ?</code> ç­‰ã€‚</li><li><strong>Expert 2</strong> å¤„ç†<strong>åŠ¨è¯</strong>ï¼ˆVerbsï¼‰ï¼šå¦‚ <code>said, read, miss</code> ç­‰ã€‚</li><li><strong>Expert 3</strong> å¤„ç†<strong>è¿æ¥è¯</strong>ï¼ˆConjunctionsï¼‰ï¼šå¦‚ <code>the, and, if, not</code> ç­‰ã€‚</li><li><strong>Expert 4</strong> å¤„ç†<strong>è§†è§‰æè¿°è¯</strong>ï¼ˆVisual Descriptionsï¼‰ï¼šå¦‚ <code>dark, outer, yellow</code> ç­‰ã€‚</li></ul></li></ul><p>æ›´å…·ä½“åœ°è¯´ï¼Œä»–ä»¬çš„ä¸“é•¿æ˜¯åœ¨ç‰¹å®šä¸Šä¸‹æ–‡ä¸­å¤„ç†ç‰¹å®šçš„æ ‡è®°ï¼ˆtokensï¼‰ã€‚</p><hr><p><strong>Router (gate network)</strong> é€‰æ‹©æœ€é€‚åˆç»™å®šè¾“å…¥çš„ä¸“å®¶æˆ–ä¸“å®¶ç»„åˆï¼š</p><img src="/2025/02/11/NLP%20Insights/MoE%E6%A8%A1%E5%9E%8B%E7%9A%84%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%8D%97%EF%BC%9A%E6%8F%AD%E7%A7%98%20MoE%20%E5%9C%A8%E5%A4%A7%E5%9E%8B%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E4%B8%AD%E7%9A%84%E8%A7%92%E8%89%B2/20250224_153924.png" class=""><p><strong>å›¾ç¤ºå†…å®¹</strong>ï¼šå±•ç¤ºäº† <strong>Router</strong> å¦‚ä½•åœ¨æ¯ä¸€å±‚æ ¹æ®è¾“å…¥é€‰æ‹©åˆé€‚çš„ä¸“å®¶ã€‚å›¾ä¸­é«˜äº®äº†è¢«é€‰ä¸­çš„ä¸“å®¶ï¼Œä»¥åŠè¾“å…¥ token çš„æµåŠ¨è¿‡ç¨‹ã€‚<br><strong>å›¾3è¯¦ç»†è¯´æ˜</strong>ï¼š  </p><ol><li><strong>è¾“å…¥</strong>ï¼šå›¾é¡¶éƒ¨çš„ Input ä»£è¡¨æ¨¡å‹æ¥æ”¶åˆ°çš„ token æˆ–å‘é‡è¡¨ç¤ºã€‚  </li><li><strong>Router</strong>ï¼šä½äºç½‘ç»œç»“æ„ä¸­ï¼Œèµ·åˆ°å†³ç­–ä½œç”¨ã€‚  </li><li><strong>ä¸“å®¶é€‰æ‹©</strong>ï¼šè¢«é€‰ä¸­çš„ä¸“å®¶ä¼šæ¥æ”¶è¾“å…¥ï¼Œå…¶ä½™ä¸“å®¶åˆ™ä¸è¢«æ¿€æ´»ã€‚  </li><li><strong>è¾“å‡º</strong>ï¼šæ¥è‡ªè¢«æ¿€æ´»ä¸“å®¶çš„ç»“æœè¢«æ±‡æ€»æˆ–ç»§ç»­æµå‘ä¸‹æ¸¸å±‚ã€‚</li></ol><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ¯ä¸ªä¸“å®¶å¹¶ä¸æ˜¯æ•´ä¸ª LLMï¼Œè€Œæ˜¯ <strong>LLM</strong> æ¶æ„ä¸­çš„ä¸€ä¸ªå­æ¨¡å‹éƒ¨åˆ†ã€‚</p><hr><h2 id="Experts"><a href="#Experts" class="headerlink" title="Experts"></a>Experts</h2><p>ä¸ºäº†ç†è§£ä¸“å®¶ï¼ˆ<strong>Experts</strong>ï¼‰æ˜¯ä»€ä¹ˆä»¥åŠå®ƒä»¬å¦‚ä½•å·¥ä½œï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ MoE å¸Œæœ›æ›¿ä»£çš„ä¸œè¥¿ï¼š<strong>dense layers</strong>ã€‚</p><h3 id="Dense-Layers"><a href="#Dense-Layers" class="headerlink" title="Dense Layers"></a>Dense Layers</h3><p>æ‰€æœ‰çš„ <strong>Mixture of Experts (MoE)</strong> éƒ½åŸºäº LLM ä¸­ä¸€ä¸ªç›¸å¯¹åŸºç¡€çš„åŠŸèƒ½ï¼š**Feedforward Neural Network (FFNN)**ã€‚</p><p>å›å¿†ä¸€ä¸‹ï¼Œä¸€ä¸ªæ ‡å‡†çš„ <strong>decoder-only Transformer</strong> æ¶æ„ä¸­ï¼Œ<strong>FFNN</strong> é€šå¸¸æ˜¯åœ¨ <strong>layer normalization</strong> ä¹‹ååº”ç”¨çš„ï¼š</p><img src="/2025/02/11/NLP%20Insights/MoE%E6%A8%A1%E5%9E%8B%E7%9A%84%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%8D%97%EF%BC%9A%E6%8F%AD%E7%A7%98%20MoE%20%E5%9C%A8%E5%A4%A7%E5%9E%8B%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E4%B8%AD%E7%9A%84%E8%A7%92%E8%89%B2/20250224_154729.png" class=""><p><strong>å›¾ç¤ºå†…å®¹</strong>ï¼šå±•ç¤ºäº†ä¸€ä¸ªå…¸å‹çš„ <strong>decoder</strong> ç»“æ„ï¼Œæ¯ä¸ª <strong>decoder block</strong> åŒ…å« <strong>Masked Self-Attention</strong> å’Œ <strong>FFNN</strong>ï¼ˆä¸­é—´ä¼šæœ‰ <strong>Layer Norm</strong>ï¼‰ã€‚  </p><ol><li><strong>Position Embedding</strong>ï¼šåœ¨è¾“å…¥ token ä¹‹å‰æˆ–åŒæ—¶åŠ å…¥ä½ç½®ç¼–ç ä¿¡æ¯ã€‚  </li><li><strong>Decoder Block</strong>ï¼šåŒ…å« <strong>Masked Self-Attention</strong>ã€<strong>Layer Norm</strong> å’Œ <strong>FFNN</strong>ã€‚  </li><li><strong>FFNN</strong>ï¼šåœ¨å›¾ä¸­ç”¨ç´«è‰²æ–¹å—è¡¨ç¤ºï¼Œæ˜¯è¯¥å±‚å¯¹è¾“å…¥è¿›ä¸€æ­¥å˜æ¢ä»¥æ•æ‰æ›´å¤æ‚å…³ç³»çš„å…³é”®ç»„ä»¶ã€‚</li></ol><p><strong>FFNN</strong> å¯ä»¥åˆ©ç”¨æ³¨æ„åŠ›æœºåˆ¶äº§ç”Ÿçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œå¯¹å…¶è¿›è¡Œè¿›ä¸€æ­¥çš„è½¬æ¢ï¼Œä»¥æ•æ‰æ•°æ®ä¸­æ›´å¤æ‚çš„å…³ç³»ã€‚</p><p>ä¸è¿‡ï¼Œä¸ºäº†å­¦ä¹ è¿™äº›å¤æ‚å…³ç³»ï¼Œ<strong>FFNN</strong> çš„è§„æ¨¡ä¼šéšä¹‹å¢é•¿ï¼Œé€šå¸¸ä¼šåœ¨è¾“å…¥ä¸Šè¿›è¡Œæ‰©å¼ ï¼ˆä¾‹å¦‚ï¼Œä¸­é—´å±‚ç»´åº¦ä¼šå˜å¤§ï¼‰ï¼š</p><img src="/2025/02/11/NLP%20Insights/MoE%E6%A8%A1%E5%9E%8B%E7%9A%84%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%8D%97%EF%BC%9A%E6%8F%AD%E7%A7%98%20MoE%20%E5%9C%A8%E5%A4%A7%E5%9E%8B%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E4%B8%AD%E7%9A%84%E8%A7%92%E8%89%B2/20250224_154923.png" class=""><p><strong>å›¾ç¤ºå†…å®¹</strong>ï¼šå±•ç¤ºäº†ä¸€ä¸ª <strong>FFNN</strong> çš„ç»“æ„ï¼Œè¾“å…¥å…ˆè¢«æ˜ å°„åˆ°æ›´é«˜ç»´åº¦ï¼Œç„¶åå†è¢«æ˜ å°„å›è¾“å‡ºç»´åº¦ã€‚  </p><ol><li><strong>è¾“å…¥ç»´åº¦</strong>ï¼šå›¾ä¸­æ˜¾ç¤ºæœ‰ 512 ä¸ªè¾“å…¥å•å…ƒã€‚  </li><li><strong>éšè—å±‚</strong>ï¼šé€šå¸¸ä¼šæœ‰ 4 å€æˆ–æ›´å¤šçš„æ‰©å¼ ï¼ˆå›¾ä¸­ç¤ºä¾‹ä¸º 4 å€æ‰©å¼ åˆ° 2048 ç»´ï¼‰ã€‚  </li><li><strong>è¾“å‡ºç»´åº¦</strong>ï¼šå†æ˜ å°„å› 512 ç»´çš„è¾“å‡ºã€‚</li></ol><h3 id="Sparse-Layers"><a href="#Sparse-Layers" class="headerlink" title="Sparse Layers"></a>Sparse Layers</h3><p>åœ¨ä¼ ç»Ÿçš„ Transformer ä¸­ï¼Œ<strong>FFNN</strong> ç§°ä¸º <strong>dense model</strong>ï¼Œå› ä¸ºå®ƒçš„æ‰€æœ‰å‚æ•°ï¼ˆæƒé‡å’Œåç½®ï¼‰éƒ½ä¼šè¢«æ¿€æ´»ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¨¡å‹çš„å…¨éƒ¨å‚æ•°éƒ½å‚ä¸è®¡ç®—è¾“å‡ºã€‚</p><p>å¦‚æœæˆ‘ä»¬ä»”ç»†è§‚å¯Ÿ <strong>dense model</strong>ï¼Œå¯ä»¥çœ‹åˆ°è¾“å…¥ä¼šæ¿€æ´»æ‰€æœ‰çš„å‚æ•°ï¼š</p><img src="/2025/02/11/NLP%20Insights/MoE%E6%A8%A1%E5%9E%8B%E7%9A%84%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%8D%97%EF%BC%9A%E6%8F%AD%E7%A7%98%20MoE%20%E5%9C%A8%E5%A4%A7%E5%9E%8B%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E4%B8%AD%E7%9A%84%E8%A7%92%E8%89%B2/20250224_163850.png" class=""><p><strong>å›¾ç¤ºå†…å®¹</strong>ï¼šå±•ç¤ºäº†ä¸€ä¸ªâ€œå¯†é›†â€æ¨¡å‹ï¼Œè¾“å…¥å±‚çš„æ¯ä¸ªç¥ç»å…ƒéƒ½ä¸éšè—å±‚æ‰€æœ‰ç¥ç»å…ƒç›¸è¿ï¼Œéšè—å±‚æ‰€æœ‰ç¥ç»å…ƒåˆä¸è¾“å‡ºå±‚ç¥ç»å…ƒç›¸è¿ã€‚<br><strong>å›¾6è¯¦ç»†è¯´æ˜</strong>ï¼š  </p><ol><li><strong>å…¨è¿æ¥</strong>ï¼šå›¾ä¸­æ‰€æœ‰èŠ‚ç‚¹éƒ½è¿æ¥åˆ°ä¸‹ä¸€å±‚çš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œè¡¨ç¤ºæ— ç¨€ç–æ€§ã€‚  </li><li><strong>æ‰€æœ‰å‚æ•°è¢«æ¿€æ´»</strong>ï¼šæ²¡æœ‰ä»»ä½•â€œé—²ç½®â€æˆ–â€œæœªæ¿€æ´»â€çš„å‚æ•°ã€‚</li></ol><p>ä¸ä¹‹å¯¹æ¯”ï¼Œ<strong>sparse models</strong>ï¼ˆç¨€ç–æ¨¡å‹ï¼‰åªæ¿€æ´»ä¸€éƒ¨åˆ†æ€»å‚æ•°ï¼Œè¿™ä¸ <strong>Mixture of Experts</strong> å¯†åˆ‡ç›¸å…³ã€‚</p><p>ä¸ºäº†è¯´æ˜è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ <strong>dense model</strong> åˆ‡åˆ†æˆå¤šä¸ªéƒ¨åˆ†ï¼ˆå³ä¸“å®¶ï¼Œ<strong>experts</strong>ï¼‰ï¼Œé‡æ–°è®­ç»ƒå®ƒï¼Œå¹¶ä¸”åœ¨æ¨ç†ï¼ˆinferenceï¼‰æ—¶åªæ¿€æ´»å…¶ä¸­ä¸€éƒ¨åˆ†ï¼š</p><img src="/2025/02/11/NLP%20Insights/MoE%E6%A8%A1%E5%9E%8B%E7%9A%84%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%8D%97%EF%BC%9A%E6%8F%AD%E7%A7%98%20MoE%20%E5%9C%A8%E5%A4%A7%E5%9E%8B%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E4%B8%AD%E7%9A%84%E8%A7%92%E8%89%B2/20250224_164042.png" class=""><p><strong>å›¾ç¤ºå†…å®¹</strong>ï¼šå°†åŸæœ¬çš„å¯†é›†æ¨¡å‹åˆ†å‰²æˆå¤šä¸ªä¸“å®¶ï¼ˆExpert 1ã€Expert 2ã€Expert 3ã€Expert 4ï¼‰ã€‚åœ¨æ¨ç†é˜¶æ®µï¼Œåªé€‰æ‹©ä¸€éƒ¨åˆ†ä¸“å®¶è¿›è¡Œæ¿€æ´»ã€‚  </p><ol><li><strong>æ¨¡å‹åˆ‡åˆ†</strong>ï¼šåŸæœ‰çš„å¤§ç½‘ç»œè¢«æ‹†åˆ†æˆå¤šä¸ªè¾ƒå°çš„â€œä¸“å®¶â€ã€‚  </li><li><strong>ç¨€ç–æ¿€æ´»</strong>ï¼šå¹¶ä¸æ˜¯æ‰€æœ‰ä¸“å®¶éƒ½è¢«æ¿€æ´»ï¼Œåªæœ‰éƒ¨åˆ†ä¸“å®¶åœ¨æŸäº›è¾“å…¥ä¸‹è¢«æ¿€æ´»ã€‚  </li><li><strong>å¥½å¤„</strong>ï¼šé€šè¿‡ç¨€ç–æ¿€æ´»ï¼Œå¯ä»¥åœ¨ä¸æ˜¾è‘—å¢åŠ è®¡ç®—æˆæœ¬çš„æƒ…å†µä¸‹ï¼Œæ‹¥æœ‰æ›´å¤šçš„æ½œåœ¨å‚æ•°å®¹é‡ã€‚</li></ol><p>å…¶æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šåœ¨è®­ç»ƒæœŸé—´ï¼Œæ¯ä¸ªä¸“å®¶å­¦ä¹ ä¸åŒçš„ä¿¡æ¯ï¼›åœ¨æ¨ç†æ—¶ï¼Œåªç”¨åˆ°ä¸å½“å‰ä»»åŠ¡æœ€ç›¸å…³çš„é‚£äº›ä¸“å®¶ã€‚</p><p>å½“æˆ‘ä»¬æå‡ºä¸€ä¸ªé—®é¢˜æ—¶ï¼Œå°±ä¼šé€‰æ‹©æœ€é€‚åˆè¯¥ä»»åŠ¡çš„ä¸“å®¶ï¼š</p><img src="/2025/02/11/NLP%20Insights/MoE%E6%A8%A1%E5%9E%8B%E7%9A%84%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%8D%97%EF%BC%9A%E6%8F%AD%E7%A7%98%20MoE%20%E5%9C%A8%E5%A4%A7%E5%9E%8B%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E4%B8%AD%E7%9A%84%E8%A7%92%E8%89%B2/20250224_170127.png" class=""><p><strong>å›¾ç¤ºå†…å®¹</strong>ï¼šå±•ç¤ºäº†ä¸€ä¸ªç¤ºä¾‹ï¼šå½“è¾“å…¥æ˜¯ â€œWhat is 1 + 1?â€ è¿™æ ·çš„æ•°å­—ç›¸å…³é—®é¢˜æ—¶ï¼Œè·¯ç”±å™¨åªæ¿€æ´»ä¸æ•°å­—ç›¸å…³çš„ä¸“å®¶ã€‚  </p><ol><li><strong>è¾“å…¥</strong>ï¼šä¸€ä¸ªè¡¨ç¤ºç®—æœ¯é—®é¢˜çš„å¥å­æˆ– tokenã€‚  </li><li><strong>ä¸“å®¶é€‰æ‹©</strong>ï¼šåªæ¿€æ´» â€œNumbersâ€ é¢†åŸŸçš„ä¸“å®¶ã€‚  </li><li><strong>è¾“å‡º</strong>ï¼šä¸“å®¶ç»™å‡ºç»“æœ â€œ2â€ã€‚</li></ol><h3 id="What-does-an-Expert-Learn"><a href="#What-does-an-Expert-Learn" class="headerlink" title="What does an Expert Learn?"></a>What does an Expert Learn?</h3><p>æ­£å¦‚å‰é¢æ‰€æåˆ°çš„ï¼Œä¸“å®¶ï¼ˆ<strong>Experts</strong>ï¼‰å¾€å¾€å­¦ä¹ åˆ°æ¯”æ•´ä¸ªé¢†åŸŸæ›´ç»†è‡´çš„çŸ¥è¯†ã€‚æœ‰äººä¼šè§‰å¾—ç§°å®ƒä»¬ä¸ºâ€œä¸“å®¶â€å¯èƒ½ä¼šå¸¦æ¥è¯¯è§£ï¼Œä½†è¿™æ˜¯å› ä¸ºæ¯ä¸ªä¸“å®¶å¾€å¾€åªä¸“æ³¨äºæŸäº›ç‰¹å®šç±»å‹çš„è¾“å…¥ç‰¹å¾æˆ–ä¸Šä¸‹æ–‡ã€‚</p><img src="/2025/02/11/NLP%20Insights/MoE%E6%A8%A1%E5%9E%8B%E7%9A%84%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%8D%97%EF%BC%9A%E6%8F%AD%E7%A7%98%20MoE%20%E5%9C%A8%E5%A4%A7%E5%9E%8B%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E4%B8%AD%E7%9A%84%E8%A7%92%E8%89%B2/20250224_170229.png" class=""><p><strong>å›¾ç¤ºå†…å®¹</strong>ï¼šå±•ç¤ºäº†ä¸€ä¸ªè¡¨æ ¼æˆ–å¯¹ç…§ï¼Œè¯´æ˜åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¸åŒçš„ä¸“å®¶å¯èƒ½å­¦ä¹ åˆ°ä¸åŒçš„ç‰¹å¾ï¼ˆæ¯”å¦‚æ ‡ç‚¹ç¬¦å·ã€åŠ¨è¯ã€æ•°å­—ç­‰ï¼‰ã€‚  </p><ol><li><strong>ç¤ºä¾‹åŒ–ä¸“å®¶</strong>ï¼šPunctuationã€Conjunctionsã€Verbsã€Numbers ç­‰ã€‚  </li><li><strong>åˆ†å±‚ä½ç½®</strong>ï¼šä¸åŒä¸“å®¶å¯èƒ½å‡ºç°åœ¨æ¨¡å‹çš„ä¸åŒå±‚ã€‚  </li><li><strong>åˆ†é…</strong>ï¼šæŸäº› token ä¼šè·¯ç”±åˆ°æŸäº›ä¸“å®¶ï¼Œä»¥è·å¾—æ›´æœ‰æ•ˆçš„å¤„ç†ã€‚</li></ol><p>åœ¨ <strong>decoder</strong> æ¨¡å‹ä¸­ï¼Œä¸“å®¶ä¹‹é—´å¯èƒ½æ²¡æœ‰é‚£ä¹ˆæ˜æ˜¾çš„é¢†åŸŸåˆ†å·¥ã€‚ç„¶è€Œï¼Œè¿™å¹¶ä¸æ„å‘³ç€æ‰€æœ‰ä¸“å®¶éƒ½å®Œå…¨ç›¸åŒã€‚<br>åœ¨ <strong>Mixtral 8x7B</strong> è¿™ç¯‡è®ºæ–‡ä¸­ï¼Œæœ‰ä¸€ä¸ªå¾ˆå¥½çš„ç¤ºä¾‹ï¼šæ¯ä¸ª token ä¼šè¢«æ ‡è®°ä¸ºå…¶é¦–é€‰ä¸“å®¶ï¼Œè¿™äº›ä¸“å®¶å¹¶ä¸ä¸€å®šå¯¹åº”ç›´è§‚çš„è¯­ä¹‰é¢†åŸŸï¼Œä½†åœ¨ç»Ÿè®¡ä¸Šè¡¨ç°å‡ºæŸäº›å€¾å‘ã€‚</p><img src="/2025/02/11/NLP%20Insights/MoE%E6%A8%A1%E5%9E%8B%E7%9A%84%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%8D%97%EF%BC%9A%E6%8F%AD%E7%A7%98%20MoE%20%E5%9C%A8%E5%A4%A7%E5%9E%8B%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E4%B8%AD%E7%9A%84%E8%A7%92%E8%89%B2/20250224_182219.png" class=""><p>è¿™å¼ å¯è§†åŒ–ç¤ºä¾‹è¿˜å±•ç¤ºäº†ï¼Œexpertsï¼ˆä¸“å®¶ï¼‰æ›´å€¾å‘äºå…³æ³¨å¥æ³•ï¼ˆsyntaxï¼‰ï¼Œè€Œä¸æ˜¯ç‰¹å®šçš„é¢†åŸŸï¼ˆdomainï¼‰ã€‚å› æ­¤ï¼Œè™½ç„¶ decoder expertsï¼ˆè§£ç å™¨ä¸“å®¶ï¼‰ä¼¼ä¹å¹¶æ²¡æœ‰æ˜ç¡®çš„â€œä¸“ä¸šé¢†åŸŸï¼ˆspecialismï¼‰â€ï¼Œä½†å®ƒä»¬ä¼¼ä¹ä¼šåœ¨æŸäº›ç‰¹å®šç±»å‹çš„ tokensï¼ˆæ ‡è®°ï¼‰ä¸Šè¢«æŒç»­åœ°ä½¿ç”¨ã€‚</p><p>åœ¨[å›¾1]ä¸­ï¼Œå±•ç¤ºäº†ä¸€æ®µå…³äº MoELayer çš„ç¤ºä¾‹ä»£ç æˆ–å¯è§†åŒ–ç»“æœï¼Œè‰²å—åŒºåˆ†äº†ä¸åŒéƒ¨åˆ†ï¼Œå¼ºè°ƒäº†<strong>ä¸“å®¶ï¼ˆexpertsï¼‰ä¸è·¯ç”±å™¨ï¼ˆrouterï¼‰</strong>ä¹‹é—´çš„å…³ç³»ã€‚é€šè¿‡è‰²å—å¯ä»¥çœ‹å‡ºï¼š</p><ul><li>experts åˆ—è¡¨ï¼ˆåœ¨ä»£ç ä¸­ç”¨ nn.ModuleList è¡¨ç¤ºï¼‰åŒ…å«äº†å¤šä¸ªå­ç½‘ç»œï¼ˆå³å¤šä¸ª FFNNï¼ŒFeed-Forward Neural Networkï¼Œå‰é¦ˆç¥ç»ç½‘ç»œï¼‰ã€‚</li><li>gateï¼ˆé—¨æ§ç½‘ç»œï¼Œä¹Ÿç§° routerï¼‰è´Ÿè´£é€‰æ‹©å“ªäº›ä¸“å®¶ä¼šè¢«æ¿€æ´»ã€‚</li><li>æ•´ä½“ä¸Šå¯ä»¥çœ‹åˆ°ï¼Œè¿™äº›ä¸“å®¶é€šå¸¸å…³æ³¨åˆ°è¾“å…¥å¥å­çš„å¥æ³•å±‚é¢ï¼Œè€Œéç‰¹å®šä¸»é¢˜æˆ–é¢†åŸŸã€‚</li></ul><h3 id="ä¸“å®¶çš„æ¶æ„ï¼ˆArchitecture-of-Expertsï¼‰"><a href="#ä¸“å®¶çš„æ¶æ„ï¼ˆArchitecture-of-Expertsï¼‰" class="headerlink" title="ä¸“å®¶çš„æ¶æ„ï¼ˆArchitecture of Expertsï¼‰"></a>ä¸“å®¶çš„æ¶æ„ï¼ˆArchitecture of Expertsï¼‰</h3>]]></content>
      
      
      <categories>
          
          <category> NLP Insights </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LLM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ¨ç† LLM çš„å¯è§†åŒ–æŒ‡å—ï¼šæ¢ç´¢æ¨ç†æ—¶è®¡ç®—æŠ€æœ¯ä¸ DeepSeek-R1</title>
      <link href="/2025/02/11/NLP%20Insights/%E6%8E%A8%E7%90%86%20LLM%20%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%8D%97%EF%BC%9A%E6%8E%A2%E7%B4%A2%E6%8E%A8%E7%90%86%E6%97%B6%E8%AE%A1%E7%AE%97%E6%8A%80%E6%9C%AF%E4%B8%8E%20DeepSeek-R1/"/>
      <url>/2025/02/11/NLP%20Insights/%E6%8E%A8%E7%90%86%20LLM%20%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%8D%97%EF%BC%9A%E6%8E%A2%E7%B4%A2%E6%8E%A8%E7%90%86%E6%97%B6%E8%AE%A1%E7%AE%97%E6%8A%80%E6%9C%AF%E4%B8%8E%20DeepSeek-R1/</url>
      
        <content type="html"><![CDATA[<h1 id="æ¨ç†-LLM-çš„å¯è§†åŒ–æŒ‡å—ï¼šæ¢ç´¢æ¨ç†æ—¶è®¡ç®—æŠ€æœ¯ä¸-DeepSeek-R1"><a href="#æ¨ç†-LLM-çš„å¯è§†åŒ–æŒ‡å—ï¼šæ¢ç´¢æ¨ç†æ—¶è®¡ç®—æŠ€æœ¯ä¸-DeepSeek-R1" class="headerlink" title="æ¨ç† LLM çš„å¯è§†åŒ–æŒ‡å—ï¼šæ¢ç´¢æ¨ç†æ—¶è®¡ç®—æŠ€æœ¯ä¸ DeepSeek-R1"></a>æ¨ç† LLM çš„å¯è§†åŒ–æŒ‡å—ï¼šæ¢ç´¢æ¨ç†æ—¶è®¡ç®—æŠ€æœ¯ä¸ DeepSeek-R1</h1><p><strong>åŸæ–‡åœ°å€</strong>ï¼š<a href="https://newsletter.maartengrootendorst.com/p/a-visual-guide-to-reasoning-llms">A Visual Guide to Reasoning LLMs</a></p><p>ğŸ“… ä½œè€…ï¼šMaarten Grootendorst</p><p>ğŸ“† æ—¥æœŸï¼š2025 å¹´ 2 æœˆ 3 æ—¥</p><hr><h2 id="ğŸ“Œ-å¼•è¨€"><a href="#ğŸ“Œ-å¼•è¨€" class="headerlink" title="ğŸ“Œ å¼•è¨€"></a>ğŸ“Œ å¼•è¨€</h2><p>DeepSeek-R1ã€OpenAI o3-mini å’Œ Google Gemini 2.0 Flash Thinking æ˜¯å¦‚ä½•é€šè¿‡â€œæ¨ç†â€æ¡†æ¶å°† <strong>LLMï¼ˆå¤§å‹è¯­è¨€æ¨¡å‹, Large Language Modelsï¼‰</strong> æ‰©å±•åˆ°æ–°é«˜åº¦çš„å…¸å‹ç¤ºä¾‹ã€‚</p><p>å®ƒä»¬æ ‡å¿—ç€ä» <strong>æ‰©å±•è®­ç»ƒæ—¶è®¡ç®—ï¼ˆtrain-time computeï¼‰</strong> åˆ° <strong>æ‰©å±•æ¨ç†æ—¶è®¡ç®—ï¼ˆtest-time computeï¼‰</strong> çš„èŒƒå¼è½¬å˜ã€‚</p><p>åœ¨æœ¬ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬æä¾›äº† <strong>è¶…è¿‡ 40 å¼ å®šåˆ¶å¯è§†åŒ–å›¾è¡¨</strong>ï¼Œå¸¦ä½ æ·±å…¥æ¢ç´¢ï¼š</p><ul><li><strong>æ¨ç† LLMï¼ˆReasoning LLMsï¼‰</strong> é¢†åŸŸ</li><li><strong>æ¨ç†æ—¶è®¡ç®—ï¼ˆTest-Time Computeï¼‰</strong> æœºåˆ¶</li><li><strong>DeepSeek-R1</strong> çš„æ ¸å¿ƒæ€æƒ³</li></ul><p>æˆ‘ä»¬å°†é€æ­¥ä»‹ç»ç›¸å…³æ¦‚å¿µï¼Œå¸®åŠ©ä½ å»ºç«‹å¯¹è¿™ä¸€æ–°èŒƒå¼çš„ç›´è§‰ç†è§£ã€‚</p><img src="/2025/02/11/NLP%20Insights/%E6%8E%A8%E7%90%86%20LLM%20%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%8D%97%EF%BC%9A%E6%8E%A2%E7%B4%A2%E6%8E%A8%E7%90%86%E6%97%B6%E8%AE%A1%E7%AE%97%E6%8A%80%E6%9C%AF%E4%B8%8E%20DeepSeek-R1/i24pmg2.png" class=""><hr><h2 id="ğŸ“–-ä»€ä¹ˆæ˜¯æ¨ç†-LLMï¼Ÿ"><a href="#ğŸ“–-ä»€ä¹ˆæ˜¯æ¨ç†-LLMï¼Ÿ" class="headerlink" title="ğŸ“– ä»€ä¹ˆæ˜¯æ¨ç† LLMï¼Ÿ"></a>ğŸ“– ä»€ä¹ˆæ˜¯æ¨ç† LLMï¼Ÿ</h2><p>ä¸æ™®é€š <strong>LLMï¼ˆLarge Language Modelsï¼Œå¤§å‹è¯­è¨€æ¨¡å‹ï¼‰</strong> ç›¸æ¯”ï¼Œ<strong>æ¨ç† LLM</strong> åœ¨å›ç­”é—®é¢˜ä¹‹å‰ï¼Œå¾€å¾€ä¼šå°†é—®é¢˜ <strong>åˆ†è§£ä¸ºæ›´å°çš„æ­¥éª¤</strong>ï¼ˆé€šå¸¸ç§°ä¸º <strong>æ¨ç†æ­¥éª¤ï¼ˆReasoning Stepsï¼‰</strong> æˆ– <strong>æ€è€ƒè¿‡ç¨‹ï¼ˆThought Processï¼‰</strong>ï¼‰ã€‚</p><img src="/2025/02/11/NLP%20Insights/%E6%8E%A8%E7%90%86%20LLM%20%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%8D%97%EF%BC%9A%E6%8E%A2%E7%B4%A2%E6%8E%A8%E7%90%86%E6%97%B6%E8%AE%A1%E7%AE%97%E6%8A%80%E6%9C%AF%E4%B8%8E%20DeepSeek-R1/20250211_143007.png" class=""><h3 id="ğŸ§ -â€œæ¨ç†æ­¥éª¤â€-æˆ–-â€œæ€è€ƒè¿‡ç¨‹â€-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#ğŸ§ -â€œæ¨ç†æ­¥éª¤â€-æˆ–-â€œæ€è€ƒè¿‡ç¨‹â€-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="ğŸ§  â€œæ¨ç†æ­¥éª¤â€ æˆ– â€œæ€è€ƒè¿‡ç¨‹â€ æ˜¯ä»€ä¹ˆï¼Ÿ"></a>ğŸ§  â€œæ¨ç†æ­¥éª¤â€ æˆ– â€œæ€è€ƒè¿‡ç¨‹â€ æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>å°½ç®¡æˆ‘ä»¬å¯ä»¥å“²å­¦åŒ–åœ°æ¢è®¨ LLM æ˜¯å¦çœŸçš„èƒ½å¤Ÿåƒäººç±»ä¸€æ ·æ€è€ƒï¼Œä½†è¿™äº›æ¨ç†æ­¥éª¤å®é™…ä¸Šæ˜¯å°†æ¨ç†è¿‡ç¨‹ åˆ†è§£ä¸ºæ›´å°ã€æ›´ç»“æ„åŒ–çš„æ¨æ–­ã€‚<strong>æ¨ç† LLM é‡‡ç”¨çš„æ˜¯ç»“æ„åŒ–æ¨ç†æ–¹å¼</strong>ï¼Œå³ï¼š</p><ul><li><strong>æ™®é€š LLM</strong>ï¼šç›´æ¥è¾“å‡ºç­”æ¡ˆ</li><li><strong>æ¨ç† LLM</strong>ï¼šé€šè¿‡ç³»ç»Ÿæ€§æ¨ç†ç”Ÿæˆç­”æ¡ˆ</li></ul><img src="/2025/02/11/NLP%20Insights/%E6%8E%A8%E7%90%86%20LLM%20%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%8D%97%EF%BC%9A%E6%8E%A2%E7%B4%A2%E6%8E%A8%E7%90%86%E6%97%B6%E8%AE%A1%E7%AE%97%E6%8A%80%E6%9C%AF%E4%B8%8E%20DeepSeek-R1/20250211_143054.png" class=""><p>æ¢å¥è¯è¯´ï¼Œæ¨ç† LLM ä¸æ˜¯<strong>å­¦ä¹ â€œå›ç­”ä»€ä¹ˆâ€</strong>ï¼Œè€Œæ˜¯<strong>å­¦ä¹ â€œå¦‚ä½•å›ç­”â€</strong>ï¼</p><p>è¦ç†è§£æ¨ç† LLM çš„æ„å»ºåŸç†ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦æ¢è®¨ <strong>è®­ç»ƒæ—¶è®¡ç®—ï¼ˆTrain-Time Computeï¼‰</strong> å’Œ <strong>æ¨ç†æ—¶è®¡ç®—ï¼ˆTest-Time Computeï¼‰</strong> ä¹‹é—´çš„å·®å¼‚ã€‚</p><hr><h2 id="ğŸ”-ä»€ä¹ˆæ˜¯è®­ç»ƒæ—¶è®¡ç®—ï¼ˆTrain-time-Computeï¼‰ï¼Ÿ"><a href="#ğŸ”-ä»€ä¹ˆæ˜¯è®­ç»ƒæ—¶è®¡ç®—ï¼ˆTrain-time-Computeï¼‰ï¼Ÿ" class="headerlink" title="ğŸ” ä»€ä¹ˆæ˜¯è®­ç»ƒæ—¶è®¡ç®—ï¼ˆTrain-time Computeï¼‰ï¼Ÿ"></a>ğŸ” ä»€ä¹ˆæ˜¯è®­ç»ƒæ—¶è®¡ç®—ï¼ˆTrain-time Computeï¼‰ï¼Ÿ</h2><p>ç›´åˆ° 2024 å¹´å¹´ä¸­ï¼Œä¸ºäº†åœ¨ <strong>é¢„è®­ç»ƒï¼ˆPretrainingï¼‰</strong> æœŸé—´æé«˜ LLM çš„æ€§èƒ½ï¼Œç ”ç©¶äººå‘˜é€šå¸¸ä¼šæ‰©å¤§ä»¥ä¸‹è§„æ¨¡ï¼š</p><ul><li><strong>æ¨¡å‹å‚æ•°æ•°é‡ï¼ˆ# of Parametersï¼‰</strong></li><li><strong>æ•°æ®é›†è§„æ¨¡ï¼ˆ# of Tokensï¼‰</strong></li><li><strong>è®¡ç®—é‡ï¼ˆ# of FLOPs, Floating Point Operationsï¼‰</strong></li></ul><p>è¿™äº›åˆç§°ä¸º <strong>è®­ç»ƒæ—¶è®¡ç®—ï¼ˆTrain-time Computeï¼‰</strong>ï¼Œå³ <strong>â€œAI çš„åŒ–çŸ³ç‡ƒæ–™â€</strong>ï¼ŒæŒ‡çš„æ˜¯ï¼š</p><blockquote><p><strong>é¢„è®­ç»ƒé¢„ç®—è¶Šå¤§ï¼Œæœ€ç»ˆå¾—åˆ°çš„æ¨¡å‹å°±è¶Šå¥½ã€‚</strong></p><p>è®­ç»ƒæ—¶è®¡ç®—ï¼ˆTrain-Time Computeï¼‰åŒ…æ‹¬<strong>è®­ç»ƒï¼ˆtrainingï¼‰</strong>æ‰€éœ€çš„è®¡ç®—ï¼Œä»¥åŠ<strong>å¾®è°ƒï¼ˆfine-tuningï¼‰</strong>æ‰€éœ€çš„è®¡ç®—ã€‚é•¿æœŸä»¥æ¥ï¼Œä¸€ç›´æ˜¯æé«˜ LLM æ€§èƒ½çš„ä¸»è¦å…³æ³¨ç‚¹ã€‚</p></blockquote><img src="/2025/02/11/NLP%20Insights/%E6%8E%A8%E7%90%86%20LLM%20%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%8D%97%EF%BC%9A%E6%8E%A2%E7%B4%A2%E6%8E%A8%E7%90%86%E6%97%B6%E8%AE%A1%E7%AE%97%E6%8A%80%E6%9C%AF%E4%B8%8E%20DeepSeek-R1/20250211_143927.png" class=""><img src="/2025/02/11/NLP%20Insights/%E6%8E%A8%E7%90%86%20LLM%20%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%8D%97%EF%BC%9A%E6%8E%A2%E7%B4%A2%E6%8E%A8%E7%90%86%E6%97%B6%E8%AE%A1%E7%AE%97%E6%8A%80%E6%9C%AF%E4%B8%8E%20DeepSeek-R1/20250211_144121.png" class=""><h3 id="ğŸ”¢-è§„æ¨¡å®šå¾‹ï¼ˆScaling-Lawsï¼‰"><a href="#ğŸ”¢-è§„æ¨¡å®šå¾‹ï¼ˆScaling-Lawsï¼‰" class="headerlink" title="ğŸ”¢ è§„æ¨¡å®šå¾‹ï¼ˆScaling Lawsï¼‰"></a>ğŸ”¢ è§„æ¨¡å®šå¾‹ï¼ˆScaling Lawsï¼‰</h3><p>åœ¨ <strong>LLMï¼ˆå¤§å‹è¯­è¨€æ¨¡å‹ï¼‰</strong> ç ”ç©¶é¢†åŸŸï¼Œ<strong>æ¨¡å‹è§„æ¨¡ï¼ˆScaleï¼‰</strong> ä¸ <strong>æ¨¡å‹æ€§èƒ½ï¼ˆPerformanceï¼‰</strong> ä¹‹é—´çš„å…³ç³»è¢«ç§°ä¸º <strong>è§„æ¨¡å®šå¾‹ï¼ˆScaling Lawsï¼‰</strong>ã€‚è¿™äº›å®šå¾‹é€šå¸¸ç”¨äºæè¿° <strong>è®¡ç®—èµ„æºã€æ•°æ®è§„æ¨¡å’Œæ¨¡å‹å‚æ•°</strong> å¦‚ä½•å½±å“æ¨¡å‹çš„æ•´ä½“è¡¨ç°ã€‚</p><p>è¿™äº›å…³ç³»é€šå¸¸ä»¥ <strong>å¯¹æ•°-å¯¹æ•°ï¼ˆlog-logï¼‰</strong> æ–¹å¼å‘ˆç°ï¼Œå¹¶ä¸”åœ¨å›¾è¡¨ä¸Šé€šå¸¸æ˜¾ç¤ºä¸ºä¸€æ¡ <strong>è¿‘ä¼¼ç›´çº¿</strong>ï¼Œä»¥çªå‡ºè®¡ç®—é‡çš„å·¨å¤§å¢é•¿ã€‚</p><img src="/2025/02/11/NLP%20Insights/%E6%8E%A8%E7%90%86%20LLM%20%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%8D%97%EF%BC%9A%E6%8E%A2%E7%B4%A2%E6%8E%A8%E7%90%86%E6%97%B6%E8%AE%A1%E7%AE%97%E6%8A%80%E6%9C%AF%E4%B8%8E%20DeepSeek-R1/20250211_144846.png" class=""><p>è¿™å¼ å›¾ç‰‡å±•ç¤ºäº†<strong>ä¸åŒåæ ‡å°ºåº¦ï¼ˆçº¿æ€§ vs. å¯¹æ•°ï¼‰å¯¹è®¡ç®—èµ„æºï¼ˆComputeï¼‰å’Œæ¨¡å‹æ€§èƒ½ï¼ˆPerformanceï¼‰ä¹‹é—´å…³ç³»çš„å½±å“</strong>ï¼Œå¼ºè°ƒäº†å¤§æ¨¡å‹å¢é•¿çš„å¹‚å¾‹å…³ç³»ï¼ˆPower Lawï¼‰ã€‚</p><ul><li><p><strong>å·¦å›¾ï¼ˆæ™®é€šçº¿æ€§å°ºåº¦ - Normal Scaleï¼‰</strong></p><ul><li>æ¨ªè½´ï¼ˆX è½´ï¼‰ï¼šè®¡ç®—èµ„æºï¼ˆComputeï¼‰ï¼Œ<strong>çº¿æ€§åˆ»åº¦</strong>ã€‚</li><li>çºµè½´ï¼ˆY è½´ï¼‰ï¼šæ€§èƒ½ï¼ˆPerformanceï¼‰ï¼Œ<strong>çº¿æ€§åˆ»åº¦</strong>ã€‚</li><li>æ›²çº¿æ˜¾ç¤º<strong>é€’å‡æ”¶ç›Šï¼ˆDiminishing Returnsï¼‰</strong>ï¼Œå³ï¼š<strong>éšç€è®¡ç®—èµ„æºçš„å¢åŠ ï¼Œæ€§èƒ½å¢é•¿è¶‹ç¼“</strong>ï¼Œä½†ä»ç„¶åœ¨ä¸Šå‡ã€‚</li></ul></li><li><p><strong>å³å›¾ï¼ˆå¯¹æ•°-å¯¹æ•°å°ºåº¦ - Log-log Scaleï¼‰</strong></p><ul><li>æ¨ªè½´ï¼ˆX è½´ï¼‰ï¼šè®¡ç®—èµ„æºï¼ˆComputeï¼‰ï¼Œ<strong>å¯¹æ•°åˆ»åº¦</strong>ã€‚</li><li>çºµè½´ï¼ˆY è½´ï¼‰ï¼šæ€§èƒ½ï¼ˆPerformanceï¼‰ï¼Œ<strong>å¯¹æ•°åˆ»åº¦</strong>ã€‚</li><li>åœ¨å¯¹æ•°-å¯¹æ•°å°ºåº¦ä¸‹ï¼ŒåŸæœ¬å¼¯æ›²çš„æ›²çº¿å˜æˆ<strong>ä¸€æ¡ç›´çº¿</strong>ï¼Œè¯´æ˜è®¡ç®—èµ„æºå’Œæ€§èƒ½ä¹‹é—´å‘ˆ<strong>å¹‚å¾‹å…³ç³»ï¼ˆPower Law Relationshipï¼‰</strong>ã€‚</li></ul></li></ul><p>è¿™äº›å®šå¾‹é€šå¸¸éµå¾ª <strong>å¹‚å¾‹ï¼ˆPower Lawsï¼‰</strong>ï¼Œå³ï¼š</p><blockquote><p><strong>æŸä¸ªå˜é‡ï¼ˆå¦‚è®¡ç®—é‡ï¼‰å¢åŠ ï¼Œä¼šå¯¼è‡´å¦ä¸€ä¸ªå˜é‡ï¼ˆå¦‚æ€§èƒ½ï¼‰æŒ‰ä¸€å®šæ¯”ä¾‹å˜åŒ–ã€‚</strong></p></blockquote><p>æœ€è‘—åçš„ <strong>è§„æ¨¡å®šå¾‹</strong> åŒ…æ‹¬ï¼š</p><ul><li><strong>Kaplan è§„æ¨¡å®šå¾‹</strong>ï¼ˆKaplan Scaling Lawï¼‰ï¼šå½“è®¡ç®—èµ„æºä¸€å®šæ—¶ï¼Œ<strong>å¢åŠ æ¨¡å‹çš„å‚æ•°è§„æ¨¡æ¯”å¢åŠ æ•°æ®è§„æ¨¡æ›´æœ‰æ•ˆ</strong>ã€‚è¡¨æ˜æ¨¡å‹æ€§èƒ½ä¸å‚æ•°é‡ã€è®¡ç®—é‡å’Œè®­ç»ƒæ•°æ®ï¼ˆTokensï¼‰ä¹‹é—´å­˜åœ¨å¹‚å¾‹å…³ç³»ï¼Œå³ æ›´å¤šå‚æ•°ã€æ›´å¤šè®¡ç®—èµ„æºèƒ½æå‡æ€§èƒ½ï¼ˆGPT-3 è®ºæ–‡æå‡ºï¼‰ã€‚</li><li><strong>Chinchilla è§„æ¨¡å®šå¾‹</strong>ï¼ˆChinchilla Scaling Lawï¼‰ï¼šæ¨¡å‹çš„å¤§å°å’Œæ•°æ®è§„æ¨¡åŒæ ·é‡è¦ï¼ŒäºŒè€…éœ€ <strong>åŒæ­¥æ‰©å±•</strong> æ‰èƒ½å®ç°æœ€ä½³æ€§èƒ½ï¼ˆDeepMind æå‡ºï¼‰ã€‚</li></ul><img src="/2025/02/11/NLP%20Insights/%E6%8E%A8%E7%90%86%20LLM%20%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%8D%97%EF%BC%9A%E6%8E%A2%E7%B4%A2%E6%8E%A8%E7%90%86%E6%97%B6%E8%AE%A1%E7%AE%97%E6%8A%80%E6%9C%AF%E4%B8%8E%20DeepSeek-R1/20250211_145639.png" class=""><p>è¿™å¼ å›¾å±•ç¤ºäº†<strong>å¤§è§„æ¨¡ AI è®­ç»ƒä¸­çš„ Scaling Lawsï¼ˆç¼©æ”¾å®šå¾‹ï¼‰</strong>ï¼Œè¡¨æ˜<strong>è®¡ç®—èµ„æºï¼ˆComputeï¼‰ã€æ•°æ®é›†è§„æ¨¡ï¼ˆDataset Sizeï¼‰å’Œå‚æ•°é‡ï¼ˆParametersï¼‰</strong>å¯¹æ¨¡å‹æ€§èƒ½çš„å½±å“ã€‚å…³é”®ä¿¡æ¯å¦‚ä¸‹ï¼š</p><hr><p><strong>1. çºµè½´ï¼ˆYè½´ï¼‰ï¼šæµ‹è¯•æŸå¤±ï¼ˆTest Lossï¼‰</strong></p><ul><li><strong>ç›®æ ‡æ˜¯é™ä½æµ‹è¯•æŸå¤±ï¼ˆTest Lossï¼‰</strong>ï¼Œå³æé«˜æ¨¡å‹çš„æ³›åŒ–æ€§èƒ½ã€‚</li><li><strong>æŸå¤±ï¼ˆLï¼‰è¶Šå°ï¼Œæ¨¡å‹æ€§èƒ½è¶Šå¥½</strong>ã€‚</li></ul><p><strong>2. æ¨ªè½´ï¼ˆXè½´ï¼‰ï¼šä¸‰ç§å…³é”®å˜é‡</strong></p><ul><li><p><strong>å·¦å›¾ï¼ˆComputeï¼Œè®¡ç®—èµ„æºï¼‰</strong>ï¼š</p><ul><li>X è½´æ˜¯è®¡ç®—èµ„æºï¼ˆPF-days, é embeddingï¼‰ã€‚</li><li>è®¡ç®—èµ„æºè¶Šå¤šï¼Œæµ‹è¯•æŸå¤±é™ä½ï¼ˆæ€§èƒ½æå‡ï¼‰ã€‚</li><li>å…¬å¼ï¼š<br>$$<br>L = \left( \frac{C_{\text{min}}}{2.3 \times 10^8} \right)^{-0.050}<br>$$</li><li><strong>ä½“ç°è®¡ç®—èµ„æºçš„å¹‚å¾‹å…³ç³»</strong>ï¼šè®¡ç®—èµ„æºå¢åŠ ï¼ŒæŸå¤±å‡å°‘ï¼Œä½†æ”¶ç›Šé€’å‡ï¼ˆæŒ‡æ•° -0.050ï¼‰ã€‚</li></ul></li><li><p><strong>ä¸­å›¾ï¼ˆDataset Sizeï¼Œæ•°æ®é›†è§„æ¨¡ï¼‰</strong>ï¼š</p><ul><li>X è½´æ˜¯è®­ç»ƒæ•°æ®çš„ Token æ•°é‡ã€‚</li><li>æ•°æ®è§„æ¨¡è¶Šå¤§ï¼Œæµ‹è¯•æŸå¤±é™ä½ï¼ˆæ€§èƒ½æå‡ï¼‰ã€‚</li><li>å…¬å¼ï¼š<br>$$<br>L = \left( \frac{D}{5.4 \times 10^{13}} \right)^{-0.095}<br>$$</li><li><strong>æ•°æ®è§„æ¨¡å¯¹æŸå¤±çš„å½±å“è¾ƒå¤§</strong>ï¼ˆæŒ‡æ•° -0.095ï¼‰ã€‚</li></ul></li><li><p><strong>å³å›¾ï¼ˆParametersï¼Œå‚æ•°é‡ï¼‰</strong>ï¼š</p><ul><li>X è½´æ˜¯æ¨¡å‹å‚æ•°é‡ï¼ˆé embeddingï¼‰ã€‚</li><li>å‚æ•°æ•°é‡è¶Šå¤§ï¼Œæµ‹è¯•æŸå¤±é™ä½ï¼ˆæ€§èƒ½æå‡ï¼‰ã€‚</li><li>å…¬å¼ï¼š<br>$$<br>L = \left( \frac{N}{8.8 \times 10^{13}} \right)^{-0.076}<br>$$</li><li><strong>å‚æ•°å¯¹æŸå¤±çš„å½±å“ä»‹äºè®¡ç®—èµ„æºå’Œæ•°æ®è§„æ¨¡ä¹‹é—´</strong>ï¼ˆæŒ‡æ•° -0.076ï¼‰ã€‚</li></ul></li></ul><p>è¿™äº›ç ”ç©¶è¡¨æ˜ï¼Œ<strong>æ¨¡å‹è§„æ¨¡ã€æ•°æ®è§„æ¨¡å’Œè®¡ç®—èµ„æºå¿…é¡»ååŒæ‰©å±•ï¼Œæ‰èƒ½æœ€å¤§åŒ–æ¨¡å‹çš„æ€§èƒ½</strong>ã€‚</p><ul><li><strong>è®¡ç®—èµ„æºå¢åŠ  â†’ è®­ç»ƒæ›´å¼ºå¤§æ¨¡å‹</strong></li><li><strong>æ›´å¤š Tokens â†’ æ›´å¥½æ³›åŒ–èƒ½åŠ›</strong></li><li><strong>å‚æ•°å¢åŠ  â†’ ä½†éœ€è¦ä¸æ•°æ®åŒ¹é…ï¼Œå¦åˆ™è¿‡æ‹Ÿåˆ</strong></li></ul><p>Kaplan è§„æ¨¡å®šå¾‹è®¤ä¸ºï¼Œåœ¨ <strong>å›ºå®šè®¡ç®—èµ„æº</strong> çš„æƒ…å†µä¸‹ï¼Œ<strong>ä¼˜å…ˆå¢åŠ æ¨¡å‹å‚æ•°</strong> é€šå¸¸æ¯”å¢åŠ æ•°æ®è§„æ¨¡æ›´æœ‰æ•ˆã€‚è€Œ Chinchilla è§„æ¨¡å®šå¾‹åˆ™æŒ‡å‡ºï¼Œ<strong>æ¨¡å‹å‚æ•°å’Œæ•°æ®è§„æ¨¡éƒ½åº”åŒæ­¥å¢é•¿</strong>ï¼Œä»¥è·å¾—æ›´ä¼˜çš„æ¨¡å‹æ€§èƒ½ã€‚</p><img src="/2025/02/11/NLP%20Insights/%E6%8E%A8%E7%90%86%20LLM%20%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%8D%97%EF%BC%9A%E6%8E%A2%E7%B4%A2%E6%8E%A8%E7%90%86%E6%97%B6%E8%AE%A1%E7%AE%97%E6%8A%80%E6%9C%AF%E4%B8%8E%20DeepSeek-R1/20250211_145814.png" class=""><p>ç„¶è€Œï¼Œåœ¨ <strong>2024 å¹´</strong>ï¼Œç ”ç©¶äººå‘˜å‘ç°ï¼Œå°½ç®¡è®¡ç®—èµ„æºã€æ•°æ®è§„æ¨¡å’Œæ¨¡å‹å‚æ•° <strong>æŒç»­å¢é•¿</strong>ï¼Œä½†æ€§èƒ½æå‡çš„ <strong>è¾¹é™…æ”¶ç›Šï¼ˆMarginal Returnï¼‰</strong> å´åœ¨ <strong>é€æ¸é™ä½</strong>ã€‚</p><p>è¿™å¼•å‘äº†ä¸€ä¸ªé‡è¦çš„é—®é¢˜ï¼š</p><p>â“ <strong>â€œæˆ‘ä»¬æ˜¯å¦å·²ç»é‡åˆ°äº† LLM å‘å±•çš„ç“¶é¢ˆï¼Ÿâ€</strong></p><hr><h2 id="ğŸš€-ä»€ä¹ˆæ˜¯æ¨ç†æ—¶è®¡ç®—ï¼ˆTest-time-Computeï¼‰ï¼Ÿ"><a href="#ğŸš€-ä»€ä¹ˆæ˜¯æ¨ç†æ—¶è®¡ç®—ï¼ˆTest-time-Computeï¼‰ï¼Ÿ" class="headerlink" title="ğŸš€ ä»€ä¹ˆæ˜¯æ¨ç†æ—¶è®¡ç®—ï¼ˆTest-time Computeï¼‰ï¼Ÿ"></a>ğŸš€ ä»€ä¹ˆæ˜¯æ¨ç†æ—¶è®¡ç®—ï¼ˆTest-time Computeï¼‰ï¼Ÿ</h2><p>ç”±äº <strong>è®­ç»ƒæ—¶è®¡ç®—çš„æˆæœ¬æå…¶æ˜‚è´µ</strong>ï¼Œç ”ç©¶äººå‘˜å¼€å§‹å…³æ³¨ <strong>æ¨ç†æ—¶è®¡ç®—ï¼ˆTest-time Computeï¼‰</strong>ï¼Œå³ï¼š</p><blockquote><p><strong>è®© LLM åœ¨æ¨ç†æ—¶â€œæ€è€ƒæ›´é•¿æ—¶é—´â€</strong>ï¼Œè€Œéå•çº¯ä¾èµ–æ›´å¤§çš„æ¨¡å‹å’Œæ•°æ®é›†ã€‚</p></blockquote><img src="/2025/02/11/NLP%20Insights/%E6%8E%A8%E7%90%86%20LLM%20%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%8D%97%EF%BC%9A%E6%8E%A2%E7%B4%A2%E6%8E%A8%E7%90%86%E6%97%B6%E8%AE%A1%E7%AE%97%E6%8A%80%E6%9C%AF%E4%B8%8E%20DeepSeek-R1/20250211_145856.png" class=""><p>å¯¹äº<strong>éæ¨ç†æ¨¡å‹</strong>ï¼Œå®ƒä»¬é€šå¸¸ <strong>ç›´æ¥è¾“å‡ºç­”æ¡ˆ</strong>ï¼š</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Q: 8 + 5 = ?</span><br><span class="line">A: 13</span><br></pre></td></tr></tbody></table></figure><img src="/2025/02/11/NLP%20Insights/%E6%8E%A8%E7%90%86%20LLM%20%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%8D%97%EF%BC%9A%E6%8E%A2%E7%B4%A2%E6%8E%A8%E7%90%86%E6%97%B6%E8%AE%A1%E7%AE%97%E6%8A%80%E6%9C%AF%E4%B8%8E%20DeepSeek-R1/20250211_145936.png" class=""><p>è€Œ<strong>æ¨ç†æ¨¡å‹</strong>åˆ™ä¼š <strong>ä½¿ç”¨æ›´å¤š token è¿›è¡Œæ¨ç†</strong>ï¼Œå½¢æˆç³»ç»ŸåŒ–çš„â€œæ€è€ƒâ€è¿‡ç¨‹ï¼š</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Q: 8 + 5 = ?</span><br><span class="line">A: 8 + 5 å¯æ‹†è§£ä¸º 8 + 2 + 3 = 10 + 3 = 13</span><br></pre></td></tr></tbody></table></figure><img src="/2025/02/11/NLP%20Insights/%E6%8E%A8%E7%90%86%20LLM%20%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%8D%97%EF%BC%9A%E6%8E%A2%E7%B4%A2%E6%8E%A8%E7%90%86%E6%97%B6%E8%AE%A1%E7%AE%97%E6%8A%80%E6%9C%AF%E4%B8%8E%20DeepSeek-R1/20250211_150033.png" class=""><p>LLM éœ€è¦æ¶ˆè€—è®¡ç®—èµ„æºï¼ˆå¦‚æ˜¾å­˜è®¡ç®—ï¼‰æ¥ç”Ÿæˆç­”æ¡ˆã€‚ç„¶è€Œï¼Œå¦‚æœæ‰€æœ‰è®¡ç®—èµ„æºéƒ½ç”¨äºç›´æ¥ç”Ÿæˆç­”æ¡ˆï¼Œé‚£å°†ä¼šæ˜¯ä½æ•ˆçš„ï¼</p><p>ç›¸åï¼Œé€šè¿‡æå‰ç”ŸæˆåŒ…å«é¢å¤–ä¿¡æ¯ã€å…³ç³»å’Œæ–°æ€è€ƒçš„æ›´å¤š tokenï¼Œæ¨¡å‹å¯ä»¥åœ¨æ¨ç†è¿‡ç¨‹ä¸­åˆ†é…æ›´å¤šè®¡ç®—èµ„æºä»¥ç”Ÿæˆæœ€ç»ˆç­”æ¡ˆã€‚</p><img src="/2025/02/11/NLP%20Insights/%E6%8E%A8%E7%90%86%20LLM%20%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%8D%97%EF%BC%9A%E6%8E%A2%E7%B4%A2%E6%8E%A8%E7%90%86%E6%97%B6%E8%AE%A1%E7%AE%97%E6%8A%80%E6%9C%AF%E4%B8%8E%20DeepSeek-R1/20250211_151252.png" class=""><p>è¿™å¼ å›¾ç‰‡å±•ç¤ºäº† <strong>å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰</strong> åœ¨è®¡ç®—è¿‡ç¨‹ä¸­å¦‚ä½•åˆ†é… <strong>token</strong>ï¼ˆæ ‡è®°ï¼‰æ¥ä¼˜åŒ–æ¨ç†èƒ½åŠ›å’Œæœ€ç»ˆçš„å›ç­”è´¨é‡ã€‚æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š<strong>å¦‚æœè®¡ç®—èµ„æºï¼ˆå¦‚ GPU/VRAM è®¡ç®—é‡ï¼‰å…¨éƒ¨ç”¨äºç›´æ¥ç”Ÿæˆç­”æ¡ˆï¼Œè€Œæ²¡æœ‰ç”¨äºæ€è€ƒï¼Œé‚£ä¹ˆæ•ˆç‡ä¼šå—åˆ°å½±å“</strong>ã€‚ç›¸åï¼Œå¢åŠ  <strong>æ€è€ƒè¿‡ç¨‹</strong>ï¼ˆå³ç”Ÿæˆæ›´å¤šçš„ä¸­é—´ tokenï¼‰ï¼Œå¯ä»¥æé«˜æ¨¡å‹çš„ <strong>æ¨ç†èƒ½åŠ›</strong>ï¼Œä»è€Œæå‡ <strong>æœ€ç»ˆçš„å›ç­”è´¨é‡</strong>ã€‚</p><p><strong>1. Token çš„ä½¿ç”¨ä¸è®¡ç®—é‡</strong></p><ul><li><strong>LLM ç”Ÿæˆç­”æ¡ˆæ˜¯æŒ‰ token é€æ­¥è¾“å‡ºçš„</strong>ï¼Œæ¯ä¸ª token éƒ½ä¼šå ç”¨è®¡ç®—èµ„æºã€‚</li><li><strong>åˆ†é…æ›´å¤šçš„ token è¿›è¡Œæ€è€ƒ</strong>ï¼Œæ„å‘³ç€æ¨¡å‹å¯ä»¥åœ¨å¾—å‡ºæœ€ç»ˆç­”æ¡ˆä¹‹å‰æœ‰æ›´å¤šçš„æ¨ç†æ­¥éª¤ï¼Œä»è€Œæé«˜æ­£ç¡®ç‡ã€‚</li></ul><p> <strong>2. ä¸‰ç§ä¸åŒçš„è®¡ç®—æ–¹å¼</strong></p><ul><li><p><strong>åœºæ™¯ 1ï¼ˆ1 ä¸ª tokenï¼šæœ€å°‘è®¡ç®—ï¼‰</strong></p><ul><li>ç›´æ¥è¾“å‡º <strong>â€œ5â€</strong> ä½œä¸ºç­”æ¡ˆã€‚</li><li><strong>è®¡ç®—é‡æœ€å°‘</strong>ï¼Œé€Ÿåº¦æœ€å¿«ã€‚</li><li><strong>å¦‚æœé—®é¢˜è¾ƒå¤æ‚ï¼Œå¯èƒ½ä¼šå‡ºé”™</strong>ï¼Œå› ä¸ºæ¨¡å‹æ²¡æœ‰è¶³å¤Ÿçš„è®¡ç®—æ—¶é—´æ¥æ€è€ƒã€‚</li></ul></li><li><p><strong>åœºæ™¯ 2ï¼ˆ6 ä¸ª tokenï¼šä¸­ç­‰è®¡ç®—ï¼‰</strong></p><ul><li>æ¨¡å‹ç”Ÿæˆä¸€ä¸ªç®€çŸ­çš„æ¨ç†è¿‡ç¨‹ï¼š<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Adding 3 and 2 gives 5</span><br></pre></td></tr></tbody></table></figure></li><li><strong>æ¯”ç¬¬ä¸€ç§æ–¹æ³•å¤šäº†ä¸€äº›è®¡ç®—é‡</strong>ï¼Œä½†ä»ç„¶è¾ƒä¸ºç®€æ´ã€‚</li><li>è¿™ç§æ–¹å¼é€‚ç”¨äº<strong>ç®€å•çš„æ•°å­¦è¿ç®—æˆ–é€»è¾‘æ¨ç†</strong>ï¼Œä½†åœ¨æ›´å¤æ‚çš„æƒ…å†µä¸‹ä»å¯èƒ½å‡ºç°é”™è¯¯ã€‚</li></ul></li><li><p><strong>åœºæ™¯ 3ï¼ˆ15 ä¸ª tokenï¼šå®Œæ•´æ¨ç†ï¼‰</strong></p><ul><li>æ¨¡å‹å…ˆè¿›è¡Œè¯¦ç»†çš„é€æ­¥æ¨ç†ï¼š<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">3 + 1 = 4 , 4 + 1 = 5</span><br></pre></td></tr></tbody></table></figure>ç„¶åï¼Œæ¨¡å‹å†æ˜ç¡®åœ°æ€»ç»“ï¼š<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">the total is 5</span><br></pre></td></tr></tbody></table></figure></li><li><strong>æ¨ç†è¿‡ç¨‹æ›´è¯¦ç»†ï¼Œå ç”¨çš„è®¡ç®—é‡æœ€å¤§</strong>ã€‚</li><li><strong>é€‚ç”¨äºéœ€è¦å¤šæ­¥æ¨ç†çš„ä»»åŠ¡ï¼Œå¦‚æ•°å­¦é¢˜ã€é€»è¾‘æ¨ç†é¢˜ç­‰</strong>ã€‚</li></ul></li></ul><h3 id="ğŸ”¢-è§„æ¨¡å®šå¾‹ï¼ˆScaling-Lawsï¼‰-1"><a href="#ğŸ”¢-è§„æ¨¡å®šå¾‹ï¼ˆScaling-Lawsï¼‰-1" class="headerlink" title="ğŸ”¢ è§„æ¨¡å®šå¾‹ï¼ˆScaling Lawsï¼‰"></a>ğŸ”¢ è§„æ¨¡å®šå¾‹ï¼ˆScaling Lawsï¼‰</h3><p>ç›¸æ¯”äºè®­ç»ƒæ—¶è®¡ç®—ï¼Œæ¨ç†æ—¶è®¡ç®—çš„è§„æ¨¡å®šå¾‹ä»ç„¶è¾ƒä¸ºæ–°é¢–ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæœ‰ä¸¤é¡¹ç ”ç©¶æ­ç¤ºäº†æ¨ç†æ—¶è®¡ç®—è§„æ¨¡ä¸è®­ç»ƒæ—¶è®¡ç®—è§„æ¨¡çš„å…³ç³»ã€‚</p><p>é¦–å…ˆï¼ŒOpenAI å‘è¡¨çš„ä¸€ç¯‡æ–‡ç« è¡¨æ˜ï¼Œæ¨ç†æ—¶è®¡ç®—å¯èƒ½éµå¾ªä¸è®­ç»ƒæ—¶è®¡ç®—ç›¸åŒçš„æ‰©å±•è¶‹åŠ¿ã€‚</p><img src="/2025/02/11/NLP%20Insights/%E6%8E%A8%E7%90%86%20LLM%20%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%8D%97%EF%BC%9A%E6%8E%A2%E7%B4%A2%E6%8E%A8%E7%90%86%E6%97%B6%E8%AE%A1%E7%AE%97%E6%8A%80%E6%9C%AF%E4%B8%8E%20DeepSeek-R1/20250211_151722.png" class=""><blockquote><p><strong>æ¥è‡ªâ€œå­¦ä¹ å¦‚ä½•æ¨ç†çš„ LLMâ€ä¸€æ–‡çš„æ³¨é‡Šå›¾</strong>ï¼šçº¢è‰²è™šçº¿æ˜¾ç¤ºäº† OpenAI æå‡ºçš„æ–°èŒƒå¼å¯èƒ½æ˜¯æ¨ç†æ—¶è®¡ç®—ã€‚<br>è¿™å¼ å›¾å±•ç¤ºäº† <strong>è®­ç»ƒæ—¶é—´è®¡ç®—ï¼ˆtrain-time computeï¼‰å’Œæµ‹è¯•æ—¶é—´è®¡ç®—ï¼ˆtest-time computeï¼‰</strong> å¯¹æ¨¡å‹ <strong>pass@1 å‡†ç¡®ç‡ï¼ˆaccuracyï¼‰</strong> çš„å½±å“ï¼Œå…·ä½“æ¥è¯´ï¼Œå®ƒå¼ºè°ƒäº† <strong>æµ‹è¯•æ—¶é—´è®¡ç®—å¯èƒ½æ¯”è®­ç»ƒæ—¶é—´è®¡ç®—æ›´æœ‰åˆ©äºæ‰©å±•æ¨¡å‹æ€§èƒ½</strong>ã€‚</p></blockquote><ol><li><p><strong>å·¦å›¾ï¼šè®­ç»ƒæ—¶é—´è®¡ç®— vs. å‡†ç¡®ç‡</strong></p><ul><li><strong>X è½´ï¼ˆæ¨ªè½´ï¼‰ï¼šè®­ç»ƒæ—¶é—´è®¡ç®—ï¼ˆlog scaleï¼ŒæŒ‡æ•°åˆ»åº¦ï¼‰</strong>ã€‚</li><li><strong>Y è½´ï¼ˆçºµè½´ï¼‰ï¼špass@1 å‡†ç¡®ç‡</strong>ï¼ˆå³æ¨¡å‹åœ¨ä¸€æ¬¡å°è¯•ä¸­å¾—åˆ°æ­£ç¡®ç­”æ¡ˆçš„æ¦‚ç‡ï¼‰ã€‚</li><li><strong>é»‘è‰²ç‚¹</strong> ä»£è¡¨ä¸åŒè®¡ç®—é‡ä¸‹çš„æ¨¡å‹è¡¨ç°ï¼Œç²‰è‰²è™šçº¿å±•ç¤ºäº†å¤§è‡´çš„è¶‹åŠ¿ã€‚</li><li>å¯ä»¥çœ‹åˆ°ï¼Œéšç€ <strong>è®­ç»ƒè®¡ç®—é‡çš„å¢åŠ ï¼Œå‡†ç¡®ç‡é€æ¸æé«˜</strong>ï¼Œä½†å¢é•¿è¶‹åŠ¿ç›¸å¯¹å¹³ç¨³ã€‚</li></ul></li><li><p><strong>å³å›¾ï¼šæµ‹è¯•æ—¶é—´è®¡ç®— vs. å‡†ç¡®ç‡</strong></p><ul><li><strong>X è½´ï¼ˆæ¨ªè½´ï¼‰ï¼šæµ‹è¯•æ—¶é—´è®¡ç®—ï¼ˆlog scaleï¼‰</strong>ã€‚</li><li><strong>Y è½´ï¼ˆçºµè½´ï¼‰ï¼špass@1 å‡†ç¡®ç‡</strong>ã€‚</li><li>åŒæ ·ï¼Œé»‘è‰²ç‚¹ä»£è¡¨ä¸åŒè®¡ç®—é‡ä¸‹çš„æ¨¡å‹è¡¨ç°ï¼Œç²‰è‰²è™šçº¿å±•ç¤ºäº†å¤§è‡´çš„è¶‹åŠ¿ã€‚</li><li>è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œéšç€ <strong>æµ‹è¯•æ—¶è®¡ç®—é‡å¢åŠ ï¼Œæ¨¡å‹çš„å‡†ç¡®ç‡å¢é•¿æ›´æ˜¾è‘—ï¼Œç”šè‡³è¶…è¿‡äº†è®­ç»ƒè®¡ç®—é‡çš„æ•ˆæœ</strong>ã€‚<br>å› æ­¤ï¼Œä»–ä»¬è®¤ä¸ºï¼Œæ¨ç†æ—¶è®¡ç®—çš„æ‰©å±•å¯èƒ½ä»£è¡¨ç€æ–°çš„ç ”ç©¶èŒƒå¼ã€‚</li></ul></li></ol><p>å…¶æ¬¡ï¼Œä¸€ç¯‡åä¸ºã€ŠScaling Scaling Laws with Board Gamesã€‹çš„è®ºæ–‡ç ”ç©¶äº† AlphaZero åœ¨ä¸åŒè®¡ç®—é‡ä¸‹ç© Hex æ¸¸æˆçš„è¡¨ç°ã€‚</p><img src="/2025/02/11/NLP%20Insights/%E6%8E%A8%E7%90%86%20LLM%20%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%8D%97%EF%BC%9A%E6%8E%A2%E7%B4%A2%E6%8E%A8%E7%90%86%E6%97%B6%E8%AE%A1%E7%AE%97%E6%8A%80%E6%9C%AF%E4%B8%8E%20DeepSeek-R1/20250211_152050.png" class=""><blockquote><p><strong>æ¥è‡ªâ€œScaling Scaling Laws with Board Gamesâ€ä¸€æ–‡çš„æ³¨é‡Šå›¾</strong>ï¼šè¯¥å›¾å±•ç¤ºäº†ä»–ä»¬å¦‚ä½•æ„å»ºä¸åŒè§„æ¨¡çš„è®­ç»ƒæ—¶è®¡ç®—å’Œæ¨ç†æ—¶è®¡ç®—ã€‚- <strong>AlphaZero</strong> æ˜¯ <strong>DeepMind</strong> å¼€å‘çš„ä¸€ä¸ª <strong>å¼ºåŒ–å­¦ä¹ ï¼ˆReinforcement Learning, RLï¼‰</strong> è®­ç»ƒçš„ AIã€‚</p></blockquote><ul><li>è¯¥ç®—æ³•é€šè¿‡ <strong>è‡ªæˆ‘å¯¹å¼ˆï¼ˆself-playï¼‰</strong> è®­ç»ƒï¼Œæ— éœ€äººä¸ºè§„åˆ™è¾“å…¥ï¼Œå³å¯æŒæ¡<strong>å›´æ£‹ã€å›½é™…è±¡æ£‹ã€å°†æ£‹ç­‰æ¸¸æˆ</strong>ã€‚</li><li>å®ƒç»“åˆäº† <strong>ç¥ç»ç½‘ç»œé¢„æµ‹</strong> å’Œ <strong>è’™ç‰¹å¡æ´›æ ‘æœç´¢ï¼ˆMCTS, Monte Carlo Tree Searchï¼‰</strong> æ¥è¿›è¡Œå†³ç­–ã€‚</li></ul><p>è¿™å¼ å›¾ç‰‡å±•ç¤ºäº† <strong>AlphaZero ç®—æ³•</strong> åœ¨<strong>è®­ç»ƒé˜¶æ®µï¼ˆtrain-time computeï¼‰å’Œæµ‹è¯•é˜¶æ®µï¼ˆtest-time computeï¼‰</strong>è®¡ç®—èµ„æºçš„ä¸åŒåº”ç”¨ã€‚ä¸»è¦å¼ºè°ƒäº†ï¼š</p><ul><li><strong>è®­ç»ƒæ—¶</strong>ï¼šä¾èµ–äº<strong>æ›´å¤šå‚æ•°å’Œæ›´é•¿çš„è®­ç»ƒæ—¶é—´</strong>æ¥ä¼˜åŒ–æ¨¡å‹ã€‚</li><li><strong>æµ‹è¯•æ—¶</strong>ï¼šä¾é  <strong>æ›´æ·±å…¥çš„æ ‘æœç´¢ï¼ˆtree searchï¼‰</strong> æ¥æå‡å†³ç­–èƒ½åŠ›ã€‚</li></ul><img src="/2025/02/11/NLP%20Insights/%E6%8E%A8%E7%90%86%20LLM%20%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%8D%97%EF%BC%9A%E6%8E%A2%E7%B4%A2%E6%8E%A8%E7%90%86%E6%97%B6%E8%AE%A1%E7%AE%97%E6%8A%80%E6%9C%AF%E4%B8%8E%20DeepSeek-R1/20250211_152430.png" class=""><blockquote><p>æ¥è‡ªâ€œScaling Scaling Laws with Board Gamesâ€ä¸€æ–‡çš„æ³¨é‡Šå›¾ï¼šè¯¥å›¾å±•ç¤ºäº†è®­ç»ƒæ—¶è®¡ç®—ä¸æ¨ç†æ—¶è®¡ç®—ä¹‹é—´çš„å…³ç³»ã€‚<br>ç ”ç©¶ç»“æœè¡¨æ˜ï¼Œè®­ç»ƒæ—¶è®¡ç®—å’Œæ¨ç†æ—¶è®¡ç®—ç´§å¯†ç›¸å…³ã€‚æ¯æ¡è™šçº¿è¡¨ç¤ºè¾¾åˆ°ç‰¹å®š ELO åˆ†æ•°æ‰€éœ€çš„æœ€å°è®¡ç®—é‡ã€‚<br><strong>1. åæ ‡è½´å«ä¹‰</strong></p></blockquote><ul><li><strong>X è½´ï¼ˆæ¨ªè½´ï¼‰ï¼šè®­ç»ƒæ—¶è®¡ç®—é‡ï¼ˆTrain-time Computeï¼ŒFLOP-secondsï¼‰</strong></li><li><strong>Y è½´ï¼ˆçºµè½´ï¼‰ï¼šæ¨ç†æ—¶è®¡ç®—é‡ï¼ˆTest-time Computeï¼ŒFLOP-secondsï¼‰</strong></li><li><strong>å¯¹æ•°åˆ»åº¦ï¼ˆlog scaleï¼‰ï¼šè®¡ç®—é‡çš„å¢é•¿å‘ˆæŒ‡æ•°çº§ï¼Œè€Œä¸æ˜¯çº¿æ€§å¢é•¿ã€‚</strong></li></ul><p><strong>2. å…³é”®æ•°æ®è¶‹åŠ¿</strong></p><ul><li>ä¸åŒé¢œè‰²çš„æ›²çº¿åˆ†åˆ«è¡¨ç¤º<strong>ä¸åŒçš„ ELO åˆ†æ•°æ°´å¹³</strong>ï¼ˆ-1500ã€-1250ã€-1000ã€-750ã€-500ã€-250ï¼‰ã€‚</li><li><strong>è™šçº¿å’Œå®çº¿</strong>ï¼š<ul><li><strong>è™šçº¿</strong> è¡¨ç¤ºæŸä¸ª ELO åˆ†æ•°ä¸‹çš„æœ€ä¼˜è®¡ç®—è¾¹ç•Œã€‚</li><li><strong>å®çº¿</strong> ä»£è¡¨å®é™…æ•°æ®è¶‹åŠ¿ã€‚</li></ul></li></ul><ol><li><p><strong>è®­ç»ƒè®¡ç®—å’Œæ¨ç†è®¡ç®—å¯ä»¥äº’ç›¸æ›¿ä»£</strong></p><ul><li><strong>å¦‚æœæ¨ç†è®¡ç®—é‡å¢åŠ ï¼ˆå·¦ä¸ŠåŒºåŸŸï¼‰</strong>ï¼Œé‚£ä¹ˆæ‰€éœ€çš„è®­ç»ƒè®¡ç®—é‡å‡å°‘ã€‚</li><li><strong>å¦‚æœè®­ç»ƒè®¡ç®—é‡å¢åŠ ï¼ˆå³ä¸‹åŒºåŸŸï¼‰</strong>ï¼Œé‚£ä¹ˆæ‰€éœ€çš„æ¨ç†è®¡ç®—é‡å‡å°‘ã€‚</li><li><strong>ä¸¤è€…å‘ˆç°è´Ÿç›¸å…³å…³ç³»</strong>ã€‚</li></ul></li><li><p><strong>ä½è®­ç»ƒè®¡ç®— vs. é«˜æ¨ç†è®¡ç®—</strong></p><ul><li>åœ¨ <strong>è®­ç»ƒè®¡ç®—è¾ƒå°‘</strong> çš„æƒ…å†µä¸‹ï¼ˆå¦‚å·¦ä¾§çš„çº¢è‰²åœˆï¼‰ï¼Œæ¨¡å‹ä»ç„¶å¯ä»¥è¾¾åˆ°ç›¸åŒçš„ ELO æ°´å¹³ï¼Œä½†éœ€è¦ <strong>åœ¨æ¨ç†æ—¶å¢åŠ è®¡ç®—é‡</strong>ï¼ˆå¦‚æ›´æ·±çš„æœç´¢æ ‘ã€æ›´é•¿çš„æ€è€ƒè·¯å¾„ï¼‰ã€‚</li></ul></li><li><p><strong>é«˜è®­ç»ƒè®¡ç®— vs. ä½æ¨ç†è®¡ç®—</strong></p><ul><li>åœ¨ <strong>è®­ç»ƒè®¡ç®—å……è¶³</strong> çš„æƒ…å†µä¸‹ï¼ˆå¦‚å³ä¾§çš„çº¢è‰²åœˆï¼‰ï¼Œæ¨¡å‹å¯ä»¥<strong>å‡å°‘æ¨ç†è®¡ç®—éœ€æ±‚</strong>ï¼Œå³ <strong>å³ä½¿ä½¿ç”¨è¾ƒå°‘çš„æœç´¢æ·±åº¦ï¼Œä»ç„¶èƒ½è·å¾—è¾ƒé«˜çš„æ€§èƒ½</strong>ã€‚</li></ul></li><li><p><strong>å…¬å¼è§£é‡Š</strong></p><ul><li>å…¬å¼ï¼š<br>$$<br>\log_{10}(\text{test compute}) = -1.2 \cdot \log_{10}(\text{train compute}) + 0.004 \cdot \text{elo} + 29<br>$$</li><li>è¿™è¯´æ˜ï¼š<ul><li><strong>è®­ç»ƒè®¡ç®—ï¼ˆtrain computeï¼‰å¢åŠ æ—¶ï¼Œæ¨ç†è®¡ç®—ï¼ˆtest computeï¼‰å‡å°‘ï¼ˆç³»æ•° -1.2ï¼‰</strong>ã€‚</li><li><strong>æ›´é«˜çš„ ELOï¼ˆæ›´å¼ºçš„ AIï¼‰éœ€è¦é¢å¤–çš„è®¡ç®—ï¼ˆç³»æ•° 0.004ï¼‰</strong>ã€‚</li></ul></li></ul></li></ol><p>éšç€æ¨ç†æ—¶è®¡ç®—æ‰©å±•ç±»ä¼¼äºè®­ç»ƒæ—¶è®¡ç®—ï¼Œç ”ç©¶èŒƒå¼æ­£æœç€â€œæ¨ç†â€æ¨¡å‹åˆ©ç”¨æ›´å¤šæ¨ç†æ—¶è®¡ç®—çš„æ–¹å‘å‘å±•ã€‚é€šè¿‡è¿™ç§èŒƒå¼è½¬å˜ï¼Œè¿™äº›â€œæ¨ç†â€æ¨¡å‹ä¸å†å•çº¯å…³æ³¨è®­ç»ƒæ—¶è®¡ç®—ï¼ˆé¢„è®­ç»ƒå’Œå¾®è°ƒï¼‰ï¼Œè€Œæ˜¯å¹³è¡¡è®­ç»ƒä¸æ¨ç†ã€‚</p><img src="/2025/02/11/NLP%20Insights/%E6%8E%A8%E7%90%86%20LLM%20%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%8D%97%EF%BC%9A%E6%8E%A2%E7%B4%A2%E6%8E%A8%E7%90%86%E6%97%B6%E8%AE%A1%E7%AE%97%E6%8A%80%E6%9C%AF%E4%B8%8E%20DeepSeek-R1/20250211_152824.png" class=""><p>æ¨ç†æ—¶è®¡ç®—ç”šè‡³å¯ä»¥éšé•¿åº¦æ‰©å±•ï¼š</p><img src="/2025/02/11/NLP%20Insights/%E6%8E%A8%E7%90%86%20LLM%20%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%8D%97%EF%BC%9A%E6%8E%A2%E7%B4%A2%E6%8E%A8%E7%90%86%E6%97%B6%E8%AE%A1%E7%AE%97%E6%8A%80%E6%9C%AF%E4%B8%8E%20DeepSeek-R1/20250211_153922.png" class=""><p>è¿™æ˜¯æˆ‘ä»¬åœ¨ DeepSeek-R1 ç ”ç©¶ä¸­ä¹Ÿå°†æ¢è®¨çš„å†…å®¹ï¼</p><h3 id="ğŸ“Œ-æ¨ç†æ—¶è®¡ç®—çš„ç±»åˆ«ï¼ˆCategories-of-Test-time-Computeï¼‰"><a href="#ğŸ“Œ-æ¨ç†æ—¶è®¡ç®—çš„ç±»åˆ«ï¼ˆCategories-of-Test-time-Computeï¼‰" class="headerlink" title="ğŸ“Œ æ¨ç†æ—¶è®¡ç®—çš„ç±»åˆ«ï¼ˆCategories of Test-time Computeï¼‰"></a>ğŸ“Œ æ¨ç†æ—¶è®¡ç®—çš„ç±»åˆ«ï¼ˆCategories of Test-time Computeï¼‰</h3><p>æ¨ç†æ¨¡å‹ï¼ˆå¦‚ <strong>DeepSeek-R1</strong> å’Œ <strong>OpenAI o1</strong>ï¼‰çš„æˆåŠŸè¡¨æ˜ï¼Œåœ¨æ¨ç†è¿‡ç¨‹ä¸­ï¼Œé™¤äº†ç®€å•åœ°â€œæ€è€ƒæ›´é•¿æ—¶é—´â€ä¹‹å¤–ï¼Œè¿˜æœ‰æ›´å¤šçš„ä¼˜åŒ–æŠ€æœ¯ã€‚</p><p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†æ¢è®¨ <strong>æ¨ç†æ—¶è®¡ç®—ï¼ˆTest-time Computeï¼‰</strong> çš„å¤šç§å®ç°æ–¹å¼ï¼ŒåŒ…æ‹¬ï¼š</p><ul><li><strong>é“¾å¼æ€ç»´ï¼ˆChain-of-Thoughtï¼‰</strong></li><li><strong>ç­”æ¡ˆä¿®è®¢ï¼ˆRevising Answersï¼‰</strong></li><li><strong>å›æº¯æ¨ç†ï¼ˆBacktrackingï¼‰</strong></li><li><strong>å¤šæ ·æ€§é‡‡æ ·ï¼ˆSamplingï¼‰</strong></li><li><strong>å…¶ä»–æ–¹æ³•</strong></li></ul><p>æ€»ä½“è€Œè¨€ï¼Œæ¨ç†æ—¶è®¡ç®—å¯å½’çº³ä¸ºä»¥ä¸‹ <strong>ä¸¤å¤§ç±»åˆ«</strong>ï¼š</p><ol><li><p><strong>åŸºäºéªŒè¯å™¨çš„æœç´¢ï¼ˆSearch against Verifiersï¼‰</strong>  </p><ul><li>é€šè¿‡ <strong>é‡‡æ ·å¤šä¸ªç­”æ¡ˆ</strong> å¹¶ <strong>é€‰æ‹©æœ€ä½³ç­”æ¡ˆ</strong> æ¥ä¼˜åŒ–æ¨ç†ã€‚</li></ul></li><li><p><strong>ä¿®æ”¹æè®®åˆ†å¸ƒï¼ˆModifying Proposal Distributionï¼‰</strong>  </p><ul><li>é€šè¿‡è®­ç»ƒ <strong>â€œæ€è€ƒâ€è¿‡ç¨‹</strong> æ¥æé«˜æ¨ç†èƒ½åŠ›ã€‚Proposal Distributionï¼ˆæè®®åˆ†å¸ƒï¼ŒæŒ‡åœ¨æ¨¡å‹ç”Ÿæˆç­”æ¡ˆæ—¶ï¼Œå¯¹ä¸åŒå¯èƒ½ç­”æ¡ˆçš„æ¦‚ç‡åˆ†å¸ƒè¿›è¡Œè°ƒæ•´ï¼‰</li></ul></li></ol><img src="/2025/02/11/NLP%20Insights/%E6%8E%A8%E7%90%86%20LLM%20%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%8D%97%EF%BC%9A%E6%8E%A2%E7%B4%A2%E6%8E%A8%E7%90%86%E6%97%B6%E8%AE%A1%E7%AE%97%E6%8A%80%E6%9C%AF%E4%B8%8E%20DeepSeek-R1/20250211_154456.png" class=""><p>ä»æœ¬è´¨ä¸Šè®²ï¼š</p><ul><li><strong>åŸºäºéªŒè¯å™¨çš„æœç´¢</strong> æ›´å…³æ³¨ <strong>è¾“å‡ºè´¨é‡</strong>ï¼ˆOutput-focusedï¼‰ã€‚</li><li><strong>ä¿®æ”¹æè®®åˆ†å¸ƒ</strong> å…³æ³¨ <strong>è¾“å…¥ç»“æ„</strong>ï¼ˆInput-focusedï¼‰ã€‚</li></ul><img src="/2025/02/11/NLP%20Insights/%E6%8E%A8%E7%90%86%20LLM%20%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%8D%97%EF%BC%9A%E6%8E%A2%E7%B4%A2%E6%8E%A8%E7%90%86%E6%97%B6%E8%AE%A1%E7%AE%97%E6%8A%80%E6%9C%AF%E4%B8%8E%20DeepSeek-R1/20250211_154547.png" class=""><h3 id="ğŸ”-ä¸¤ç§ä¸»è¦éªŒè¯å™¨ç±»å‹"><a href="#ğŸ”-ä¸¤ç§ä¸»è¦éªŒè¯å™¨ç±»å‹" class="headerlink" title="ğŸ” ä¸¤ç§ä¸»è¦éªŒè¯å™¨ç±»å‹"></a>ğŸ” ä¸¤ç§ä¸»è¦éªŒè¯å™¨ç±»å‹</h3><p>ä¸ºäº†æ›´å¥½åœ°ç­›é€‰å’Œè¯„ä¼°æ¨ç†ç­”æ¡ˆï¼Œæˆ‘ä»¬å¼•å…¥äº†ä¸¤ç§ <strong>éªŒè¯å™¨ï¼ˆVerifiersï¼‰</strong>ï¼š</p><ol><li><p><strong>ç»“æœå¥–åŠ±æ¨¡å‹ï¼ˆOutcome Reward Models, ORMï¼‰</strong>  </p><ul><li>ä»…å¯¹æœ€ç»ˆç­”æ¡ˆè¿›è¡Œè¯„åˆ†ï¼Œè€Œä¸è€ƒè™‘æ¨ç†è¿‡ç¨‹ã€‚</li></ul></li><li><p><strong>è¿‡ç¨‹å¥–åŠ±æ¨¡å‹ï¼ˆProcess Reward Models, PRMï¼‰</strong>  </p><ul><li>æ—¢è¯„ä¼°æœ€ç»ˆç­”æ¡ˆï¼Œä¹Ÿå¯¹æ¨ç†è¿‡ç¨‹è¿›è¡Œè¯„åˆ†ã€‚</li></ul></li></ol><p>åœ¨æ¥ä¸‹æ¥çš„éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†è¯¦ç»†æ¢è®¨ <strong>å¦‚ä½•å°† ORM å’Œ PRM åº”ç”¨äºä¸åŒçš„éªŒè¯æ–¹æ³•</strong>ï¼</p><p>é¡¾åæ€ä¹‰ï¼Œ<strong>ç»“æœå¥–åŠ±æ¨¡å‹ï¼ˆOutcome Reward Model, ORMï¼‰</strong> ä»…è¯„ä¼°æœ€ç»ˆçš„ç­”æ¡ˆè´¨é‡ï¼Œè€Œä¸å…³æ³¨ç­”æ¡ˆèƒŒåçš„æ¨ç†è¿‡ç¨‹ï¼š</p><img src="/2025/02/11/NLP%20Insights/%E6%8E%A8%E7%90%86%20LLM%20%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%8D%97%EF%BC%9A%E6%8E%A2%E7%B4%A2%E6%8E%A8%E7%90%86%E6%97%B6%E8%AE%A1%E7%AE%97%E6%8A%80%E6%9C%AF%E4%B8%8E%20DeepSeek-R1/20250211_160242.png" class=""><ul><li>ORM åªçœ‹æœ€ç»ˆè¾“å‡ºï¼Œè€Œä¸å…³å¿ƒæ¨¡å‹æ˜¯å¦‚ä½•å¾—å‡ºè¿™ä¸ªç­”æ¡ˆçš„ã€‚</li></ul><p>ç›¸æ¯”ä¹‹ä¸‹ï¼Œ<strong>è¿‡ç¨‹å¥–åŠ±æ¨¡å‹ï¼ˆProcess Reward Model, PRMï¼‰</strong> åˆ™ä¼šè¯„ä¼°æ¨ç†è¿‡ç¨‹æœ¬èº«ï¼š</p><img src="/2025/02/11/NLP%20Insights/%E6%8E%A8%E7%90%86%20LLM%20%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%8D%97%EF%BC%9A%E6%8E%A2%E7%B4%A2%E6%8E%A8%E7%90%86%E6%97%B6%E8%AE%A1%E7%AE%97%E6%8A%80%E6%9C%AF%E4%B8%8E%20DeepSeek-R1/20250211_160258.png" class=""><ul><li>PRM æ—¢è¯„ä¼°ç­”æ¡ˆçš„æ­£ç¡®æ€§ï¼Œä¹Ÿå…³æ³¨æ¨ç†è·¯å¾„çš„åˆç†æ€§ã€‚</li></ul><h3 id="ğŸ§-PRM-å¦‚ä½•è¯„ä¼°æ¨ç†è¿‡ç¨‹ï¼Ÿ"><a href="#ğŸ§-PRM-å¦‚ä½•è¯„ä¼°æ¨ç†è¿‡ç¨‹ï¼Ÿ" class="headerlink" title="ğŸ§ PRM å¦‚ä½•è¯„ä¼°æ¨ç†è¿‡ç¨‹ï¼Ÿ"></a>ğŸ§ PRM å¦‚ä½•è¯„ä¼°æ¨ç†è¿‡ç¨‹ï¼Ÿ</h3><p>ä¸ºäº†æ›´æ¸…æ¥šåœ°è¯´æ˜æ¨ç†æ­¥éª¤çš„é‡è¦æ€§ï¼Œè®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªç¤ºä¾‹ï¼š</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">é—®é¢˜ï¼šæŸä¸ªæ–¹ç¨‹çš„è§£æ˜¯å¤šå°‘ï¼Ÿ</span><br><span class="line"></span><br><span class="line">æ¨ç†æ­¥éª¤ 1ï¼šé¦–å…ˆå±•å¼€æ–¹ç¨‹ï¼Œå¾—åˆ° x = 3ã€‚</span><br><span class="line">æ¨ç†æ­¥éª¤ 2ï¼šé”™è¯¯åœ°å°† x = 3 æ”¹å†™ä¸º x = 5ã€‚</span><br><span class="line">æ¨ç†æ­¥éª¤ 3ï¼šæœ€ç»ˆè¾“å‡º x = 5ã€‚</span><br></pre></td></tr></tbody></table></figure><p>åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œè™½ç„¶æœ€ç»ˆç­”æ¡ˆï¼ˆx = 5ï¼‰æ˜¯é”™è¯¯çš„ï¼Œä½† ORM ä»…è¯„ä¼°æœ€ç»ˆè¾“å‡ºï¼Œä¸ä¼šå…³æ³¨ä¸­é—´çš„é”™è¯¯æ¨ç†ã€‚</p><img src="/2025/02/11/NLP%20Insights/%E6%8E%A8%E7%90%86%20LLM%20%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%8D%97%EF%BC%9A%E6%8E%A2%E7%B4%A2%E6%8E%A8%E7%90%86%E6%97%B6%E8%AE%A1%E7%AE%97%E6%8A%80%E6%9C%AF%E4%B8%8E%20DeepSeek-R1/20250211_160332.png" class=""><p>æˆ–è€…åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒPRM ä¼šå‘ç° <strong>æ¨ç†æ­¥éª¤ 2 æ˜¯é”™è¯¯çš„</strong>ï¼Œå¹¶å¯¹æ­¤æ­¥éª¤ç»™äºˆä½åˆ†ï¼Œä»è€Œé¿å…é”™è¯¯ç­”æ¡ˆçš„å‡ºç°ã€‚</p><hr><h3 id="ğŸ”-ORM-vs-PRM-åœ¨æ¨ç†ä¸­çš„åº”ç”¨"><a href="#ğŸ”-ORM-vs-PRM-åœ¨æ¨ç†ä¸­çš„åº”ç”¨" class="headerlink" title="ğŸ” ORM vs. PRM åœ¨æ¨ç†ä¸­çš„åº”ç”¨"></a>ğŸ” ORM vs. PRM åœ¨æ¨ç†ä¸­çš„åº”ç”¨</h3><p>ç°åœ¨ä½ å·²ç»æŒæ¡äº† <strong>ç»“æœå¥–åŠ±æ¨¡å‹ï¼ˆORMï¼‰</strong> å’Œ <strong>è¿‡ç¨‹å¥–åŠ±æ¨¡å‹ï¼ˆPRMï¼‰</strong> ä¹‹é—´çš„åŒºåˆ«ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥æ¢è®¨å¦‚ä½•å°†å®ƒä»¬åº”ç”¨äºå„ç§ <strong>éªŒè¯æŠ€æœ¯ï¼ˆVerification Techniquesï¼‰</strong>ã€‚</p><h2 id="ğŸ“Œ-åŸºäºéªŒè¯å™¨çš„æœç´¢ï¼ˆSearch-against-Verifiersï¼‰"><a href="#ğŸ“Œ-åŸºäºéªŒè¯å™¨çš„æœç´¢ï¼ˆSearch-against-Verifiersï¼‰" class="headerlink" title="ğŸ“Œ åŸºäºéªŒè¯å™¨çš„æœç´¢ï¼ˆSearch against Verifiersï¼‰"></a>ğŸ“Œ åŸºäºéªŒè¯å™¨çš„æœç´¢ï¼ˆSearch against Verifiersï¼‰</h2><p>æ¨ç†æ—¶è®¡ç®—çš„ç¬¬ä¸€å¤§ç±»åˆ«æ˜¯ <strong>åŸºäºéªŒè¯å™¨çš„æœç´¢</strong>ï¼Œå®ƒé€šå¸¸åŒ…å«ä¸¤ä¸ªæ­¥éª¤ï¼š</p><ol><li><strong>ç”Ÿæˆå¤šä¸ªæ¨ç†è¿‡ç¨‹å’Œç­”æ¡ˆæ ·æœ¬</strong></li><li><strong>ä½¿ç”¨éªŒè¯å™¨ï¼ˆå¥–åŠ±æ¨¡å‹ï¼‰å¯¹ç”Ÿæˆçš„è¾“å‡ºè¿›è¡Œè¯„åˆ†</strong><img src="/2025/02/11/NLP%20Insights/%E6%8E%A8%E7%90%86%20LLM%20%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%8D%97%EF%BC%9A%E6%8E%A2%E7%B4%A2%E6%8E%A8%E7%90%86%E6%97%B6%E8%AE%A1%E7%AE%97%E6%8A%80%E6%9C%AF%E4%B8%8E%20DeepSeek-R1/20250211_160918.png" class=""></li></ol><h3 id="ğŸ¤–-éªŒè¯å™¨çš„ä½œç”¨"><a href="#ğŸ¤–-éªŒè¯å™¨çš„ä½œç”¨" class="headerlink" title="ğŸ¤– éªŒè¯å™¨çš„ä½œç”¨"></a>ğŸ¤– éªŒè¯å™¨çš„ä½œç”¨</h3><p>éªŒè¯å™¨é€šå¸¸æ˜¯ä¸€ä¸ªå¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰ï¼Œç»è¿‡å¾®è°ƒä»¥è¯„ä¼°ç»“æœï¼ˆORMï¼‰æˆ–è¿‡ç¨‹ï¼ˆPRMï¼‰ã€‚ ä½¿ç”¨éªŒè¯å™¨çš„ä¸€ä¸ªä¸»è¦ä¼˜åŠ¿æ˜¯ï¼Œæ— éœ€é‡æ–°è®­ç»ƒæˆ–å¾®è°ƒç”¨äºå›ç­”é—®é¢˜çš„å¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰ï¼Œä»…é€šè¿‡è¯„åˆ†æœºåˆ¶é€‰æ‹©æœ€ä½³ç­”æ¡ˆã€‚</p><hr><h3 id="âœ…-å¤šæ•°æŠ•ç¥¨æ³•ï¼ˆMajority-Votingï¼‰"><a href="#âœ…-å¤šæ•°æŠ•ç¥¨æ³•ï¼ˆMajority-Votingï¼‰" class="headerlink" title="âœ… å¤šæ•°æŠ•ç¥¨æ³•ï¼ˆMajority Votingï¼‰"></a>âœ… å¤šæ•°æŠ•ç¥¨æ³•ï¼ˆMajority Votingï¼‰</h3><p>æœ€ç®€å•çš„æ–¹æ³•æ˜¯ <strong>ä¸ä½¿ç”¨å¥–åŠ±æ¨¡å‹æˆ–éªŒè¯å™¨</strong>ï¼Œè€Œæ˜¯æ‰§è¡Œ <strong>å¤šæ•°æŠ•ç¥¨ï¼ˆMajority Votingï¼‰</strong>ã€‚</p><p>ğŸ“Œ <strong>æ–¹æ³•ï¼š</strong> è®© LLM ç”Ÿæˆå¤šä¸ªç­”æ¡ˆï¼Œé€‰æ‹©å‡ºç°æ¬¡æ•°æœ€å¤šçš„ç­”æ¡ˆä½œä¸ºæœ€ç»ˆç­”æ¡ˆã€‚</p><p>ğŸ“Œ <strong>ç¤ºä¾‹ï¼š</strong></p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Q: 15 Ã— 3 = ?</span><br><span class="line">A1: 45</span><br><span class="line">A2: 42</span><br><span class="line">A3: 45</span><br><span class="line">æœ€ç»ˆç­”æ¡ˆ: 45ï¼ˆå› å…¶å‡ºç°é¢‘ç‡æœ€é«˜ï¼‰</span><br></pre></td></tr></tbody></table></figure><img src="/2025/02/11/NLP%20Insights/%E6%8E%A8%E7%90%86%20LLM%20%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%8D%97%EF%BC%9A%E6%8E%A2%E7%B4%A2%E6%8E%A8%E7%90%86%E6%97%B6%E8%AE%A1%E7%AE%97%E6%8A%80%E6%9C%AF%E4%B8%8E%20DeepSeek-R1/20250211_161249.png" class=""><p>è¿™ç§æ–¹æ³•ä¹Ÿç§°ä¸º <strong>è‡ªä¸€è‡´æ€§ï¼ˆSelf-Consistencyï¼‰</strong>ï¼Œå¼ºè°ƒ <strong>ç”Ÿæˆå¤šä¸ªç­”æ¡ˆå’Œæ¨ç†æ­¥éª¤</strong> çš„é‡è¦æ€§ã€‚</p><hr><h3 id="ğŸ”¢-Best-of-N-é‡‡æ ·æ³•ï¼ˆBest-of-N-Samplesï¼‰"><a href="#ğŸ”¢-Best-of-N-é‡‡æ ·æ³•ï¼ˆBest-of-N-Samplesï¼‰" class="headerlink" title="ğŸ”¢ Best-of-N é‡‡æ ·æ³•ï¼ˆBest-of-N Samplesï¼‰"></a>ğŸ”¢ Best-of-N é‡‡æ ·æ³•ï¼ˆBest-of-N Samplesï¼‰</h3><p>Best-of-N é‡‡æ ·æ˜¯ç¬¬ä¸€ä¸ªæ¶‰åŠéªŒè¯å™¨ï¼ˆVerifierï¼‰çš„æ–¹æ³•ï¼Œå®ƒçš„åŸºæœ¬æ€æƒ³æ˜¯ç”Ÿæˆ N ä¸ªæ ·æœ¬ç­”æ¡ˆï¼Œç„¶åä½¿ç”¨ å¥–åŠ±æ¨¡å‹ï¼ˆReward Model, RMï¼‰ å¯¹è¿™äº›ç­”æ¡ˆè¿›è¡Œè¯„åˆ†ï¼Œå¹¶é€‰æ‹©å¾—åˆ†æœ€é«˜çš„ç­”æ¡ˆã€‚</p><p>ğŸ“Œ <strong>æ­¥éª¤ï¼š</strong></p><ol><li><strong>ç”Ÿæˆå¤šä¸ªç­”æ¡ˆ</strong>ï¼ˆä½¿ç”¨è¾ƒé«˜æˆ–è€…ä¸åŒçš„æ¸©åº¦å‚æ•°ç”Ÿæˆ N ä¸ªæ ·æœ¬ï¼‰ã€‚<img src="/2025/02/11/NLP%20Insights/%E6%8E%A8%E7%90%86%20LLM%20%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%8D%97%EF%BC%9A%E6%8E%A2%E7%B4%A2%E6%8E%A8%E7%90%86%E6%97%B6%E8%AE%A1%E7%AE%97%E6%8A%80%E6%9C%AF%E4%B8%8E%20DeepSeek-R1/20250211_161825.png" class=""></li><li><strong>ç»“æœå¥–åŠ±æ¨¡å‹ï¼ˆORM, Outcome Reward Modelï¼‰</strong>ï¼Œæ¯ä¸ªç­”æ¡ˆéƒ½ä¼šé€šè¿‡ ORM è¿›è¡Œè¯„åˆ†ã€‚é€‰å–å¾—åˆ†æœ€é«˜çš„ç­”æ¡ˆä½œä¸ºæœ€ç»ˆè¾“å‡ºã€‚<img src="/2025/02/11/NLP%20Insights/%E6%8E%A8%E7%90%86%20LLM%20%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%8D%97%EF%BC%9A%E6%8E%A2%E7%B4%A2%E6%8E%A8%E7%90%86%E6%97%B6%E8%AE%A1%E7%AE%97%E6%8A%80%E6%9C%AF%E4%B8%8E%20DeepSeek-R1/20250211_161833.png" class="">ğŸ“Œ <strong>ç¤ºä¾‹ï¼š</strong></li></ol><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Q: 8 + 5 = ?</span><br><span class="line">A1: 12 (å¾—åˆ† 0.2)</span><br><span class="line">A2: 13 (å¾—åˆ† 0.9)</span><br><span class="line">A3: 14 (å¾—åˆ† 0.4)</span><br><span class="line">æœ€ç»ˆé€‰æ‹©: A2ï¼ˆå› å…¶å¾—åˆ†æœ€é«˜ï¼‰</span><br></pre></td></tr></tbody></table></figure><h2 id="ğŸ“Œ-è¿›ä¸€æ­¥ä¼˜åŒ–ï¼š-è‹¥ä½¿ç”¨-PRMï¼Œåˆ™ä¸åªè¯„ä¼°ç­”æ¡ˆï¼Œè¿˜è¯„ä¼°æ•´ä¸ªæ¨ç†è¿‡ç¨‹ã€‚ä¸ä»…è¯„ä¼°æœ€ç»ˆç­”æ¡ˆçš„ç»“æœå¥–åŠ±æ¨¡å‹ï¼ˆORMï¼‰ä¸åŒï¼Œè¿‡ç¨‹å¥–åŠ±æ¨¡å‹ï¼ˆPRMï¼‰ä¼šè¯„ä¼°æ¨ç†è¿‡ç¨‹çš„è´¨é‡ã€‚PRM-å…³æ³¨æ¨ç†çš„æ¯ä¸ªæ­¥éª¤ï¼Œç¡®ä¿æ¨ç†è¿‡ç¨‹åˆç†ã€è¿è´¯ï¼Œå¹¶æœ€ç»ˆé€‰æ‹©æ€»è¯„åˆ†æœ€é«˜çš„å€™é€‰ç­”æ¡ˆã€‚-åŠ æƒ-Best-of-N-é‡‡æ ·ï¼ˆWeighted-Best-of-N-samplesï¼‰-ç»“åˆ-ORM-å’Œ-PRM-ä¸¤ç§éªŒè¯æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹æ‰€æœ‰å€™é€‰ç­”æ¡ˆè¿›è¡ŒåŠ æƒè¯„åˆ†ï¼Œå¹¶é€‰æ‹©æ€»æƒé‡æœ€é«˜çš„ç­”æ¡ˆã€‚è¿™ç§æ–¹æ³•ç§°ä¸º-åŠ æƒ-Best-of-N-é‡‡æ ·ï¼ˆWeighted-Best-of-N-samplesï¼‰ï¼šã€‚"><a href="#ğŸ“Œ-è¿›ä¸€æ­¥ä¼˜åŒ–ï¼š-è‹¥ä½¿ç”¨-PRMï¼Œåˆ™ä¸åªè¯„ä¼°ç­”æ¡ˆï¼Œè¿˜è¯„ä¼°æ•´ä¸ªæ¨ç†è¿‡ç¨‹ã€‚ä¸ä»…è¯„ä¼°æœ€ç»ˆç­”æ¡ˆçš„ç»“æœå¥–åŠ±æ¨¡å‹ï¼ˆORMï¼‰ä¸åŒï¼Œè¿‡ç¨‹å¥–åŠ±æ¨¡å‹ï¼ˆPRMï¼‰ä¼šè¯„ä¼°æ¨ç†è¿‡ç¨‹çš„è´¨é‡ã€‚PRM-å…³æ³¨æ¨ç†çš„æ¯ä¸ªæ­¥éª¤ï¼Œç¡®ä¿æ¨ç†è¿‡ç¨‹åˆç†ã€è¿è´¯ï¼Œå¹¶æœ€ç»ˆé€‰æ‹©æ€»è¯„åˆ†æœ€é«˜çš„å€™é€‰ç­”æ¡ˆã€‚-åŠ æƒ-Best-of-N-é‡‡æ ·ï¼ˆWeighted-Best-of-N-samplesï¼‰-ç»“åˆ-ORM-å’Œ-PRM-ä¸¤ç§éªŒè¯æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹æ‰€æœ‰å€™é€‰ç­”æ¡ˆè¿›è¡ŒåŠ æƒè¯„åˆ†ï¼Œå¹¶é€‰æ‹©æ€»æƒé‡æœ€é«˜çš„ç­”æ¡ˆã€‚è¿™ç§æ–¹æ³•ç§°ä¸º-åŠ æƒ-Best-of-N-é‡‡æ ·ï¼ˆWeighted-Best-of-N-samplesï¼‰ï¼šã€‚" class="headerlink" title="ğŸ“Œ è¿›ä¸€æ­¥ä¼˜åŒ–ï¼š- è‹¥ä½¿ç”¨ PRMï¼Œåˆ™ä¸åªè¯„ä¼°ç­”æ¡ˆï¼Œè¿˜è¯„ä¼°æ•´ä¸ªæ¨ç†è¿‡ç¨‹ã€‚ä¸ä»…è¯„ä¼°æœ€ç»ˆç­”æ¡ˆçš„ç»“æœå¥–åŠ±æ¨¡å‹ï¼ˆORMï¼‰ä¸åŒï¼Œè¿‡ç¨‹å¥–åŠ±æ¨¡å‹ï¼ˆPRMï¼‰ä¼šè¯„ä¼°æ¨ç†è¿‡ç¨‹çš„è´¨é‡ã€‚PRM å…³æ³¨æ¨ç†çš„æ¯ä¸ªæ­¥éª¤ï¼Œç¡®ä¿æ¨ç†è¿‡ç¨‹åˆç†ã€è¿è´¯ï¼Œå¹¶æœ€ç»ˆé€‰æ‹©æ€»è¯„åˆ†æœ€é«˜çš„å€™é€‰ç­”æ¡ˆã€‚- åŠ æƒ Best-of-N é‡‡æ ·ï¼ˆWeighted Best-of-N samplesï¼‰:ç»“åˆ ORM å’Œ PRM ä¸¤ç§éªŒè¯æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹æ‰€æœ‰å€™é€‰ç­”æ¡ˆè¿›è¡ŒåŠ æƒè¯„åˆ†ï¼Œå¹¶é€‰æ‹©æ€»æƒé‡æœ€é«˜çš„ç­”æ¡ˆã€‚è¿™ç§æ–¹æ³•ç§°ä¸º åŠ æƒ Best-of-N é‡‡æ ·ï¼ˆWeighted Best-of-N samplesï¼‰ï¼šã€‚"></a>ğŸ“Œ <strong>è¿›ä¸€æ­¥ä¼˜åŒ–ï¼š</strong><br>- è‹¥ä½¿ç”¨ <strong>PRM</strong>ï¼Œåˆ™ä¸åªè¯„ä¼°ç­”æ¡ˆï¼Œè¿˜è¯„ä¼°æ•´ä¸ªæ¨ç†è¿‡ç¨‹ã€‚ä¸ä»…è¯„ä¼°æœ€ç»ˆç­”æ¡ˆçš„ç»“æœå¥–åŠ±æ¨¡å‹ï¼ˆORMï¼‰ä¸åŒï¼Œè¿‡ç¨‹å¥–åŠ±æ¨¡å‹ï¼ˆPRMï¼‰ä¼šè¯„ä¼°æ¨ç†è¿‡ç¨‹çš„è´¨é‡ã€‚PRM å…³æ³¨æ¨ç†çš„æ¯ä¸ªæ­¥éª¤ï¼Œç¡®ä¿æ¨ç†è¿‡ç¨‹åˆç†ã€è¿è´¯ï¼Œå¹¶æœ€ç»ˆé€‰æ‹©æ€»è¯„åˆ†æœ€é«˜çš„å€™é€‰ç­”æ¡ˆã€‚<br><img src="/2025/02/11/NLP%20Insights/%E6%8E%A8%E7%90%86%20LLM%20%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%8D%97%EF%BC%9A%E6%8E%A2%E7%B4%A2%E6%8E%A8%E7%90%86%E6%97%B6%E8%AE%A1%E7%AE%97%E6%8A%80%E6%9C%AF%E4%B8%8E%20DeepSeek-R1/20250211_161922.png" class=""><br>- <strong>åŠ æƒ Best-of-N é‡‡æ ·ï¼ˆWeighted Best-of-N samplesï¼‰</strong>:ç»“åˆ ORM å’Œ PRM ä¸¤ç§éªŒè¯æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹æ‰€æœ‰å€™é€‰ç­”æ¡ˆè¿›è¡ŒåŠ æƒè¯„åˆ†ï¼Œå¹¶é€‰æ‹©æ€»æƒé‡æœ€é«˜çš„ç­”æ¡ˆã€‚è¿™ç§æ–¹æ³•ç§°ä¸º åŠ æƒ Best-of-N é‡‡æ ·ï¼ˆWeighted Best-of-N samplesï¼‰ï¼šã€‚<br><img src="/2025/02/11/NLP%20Insights/%E6%8E%A8%E7%90%86%20LLM%20%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%8D%97%EF%BC%9A%E6%8E%A2%E7%B4%A2%E6%8E%A8%E7%90%86%E6%97%B6%E8%AE%A1%E7%AE%97%E6%8A%80%E6%9C%AF%E4%B8%8E%20DeepSeek-R1/20250211_162139.png" class=""></h2><h3 id="ğŸš€-ä½¿ç”¨è¿‡ç¨‹å¥–åŠ±æ¨¡å‹ï¼ˆPRMï¼‰çš„æŸæœç´¢ï¼ˆBeam-Searchï¼‰"><a href="#ğŸš€-ä½¿ç”¨è¿‡ç¨‹å¥–åŠ±æ¨¡å‹ï¼ˆPRMï¼‰çš„æŸæœç´¢ï¼ˆBeam-Searchï¼‰" class="headerlink" title="ğŸš€ ä½¿ç”¨è¿‡ç¨‹å¥–åŠ±æ¨¡å‹ï¼ˆPRMï¼‰çš„æŸæœç´¢ï¼ˆBeam Searchï¼‰"></a>ğŸš€ ä½¿ç”¨è¿‡ç¨‹å¥–åŠ±æ¨¡å‹ï¼ˆPRMï¼‰çš„æŸæœç´¢ï¼ˆBeam Searchï¼‰</h3><p>åœ¨ç”Ÿæˆç­”æ¡ˆåŠå…¶ä¸­é—´æ¨ç†æ­¥éª¤çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <strong>æŸæœç´¢ï¼ˆBeam Searchï¼‰</strong> è¿›ä¸€æ­¥ä¼˜åŒ–æ¨ç†è·¯å¾„ã€‚</p><p>ğŸ“Œ <strong>æŸæœç´¢çš„æ ¸å¿ƒæ€æƒ³ï¼š</strong></p><ul><li>åœ¨æ¨ç†è¿‡ç¨‹ä¸­ï¼Œç”Ÿæˆå¤šä¸ªå¯èƒ½çš„æ¨ç†è·¯å¾„ï¼ˆç§°ä¸ºâ€œæŸâ€ï¼‰ã€‚</li><li>ä½¿ç”¨ <strong>è¿‡ç¨‹å¥–åŠ±æ¨¡å‹ï¼ˆPRM, Process Reward Modelï¼‰</strong> å¯¹æ¯æ¡è·¯å¾„è¿›è¡Œè¯„åˆ†ã€‚</li><li>ç±»ä¼¼äº <strong>Tree of Thought</strong> æ–¹æ³•ï¼Œå§‹ç»ˆä¿ç•™å¾—åˆ†æœ€é«˜çš„ <strong>å‰ 3 æ¡æ¨ç†è·¯å¾„</strong>ï¼Œå¹¶åœ¨æ¨ç†è¿‡ç¨‹ä¸­æŒç»­è·Ÿè¸ªè¿™äº›è·¯å¾„ã€‚</li><li>å¦‚æœæŸæ¡è·¯å¾„çš„å¾—åˆ†è¾ƒä½ï¼ˆPRM è¯„åˆ†ä½ï¼‰ï¼Œåˆ™æå‰åœæ­¢è¯¥æ¨ç†è·¯å¾„ï¼Œä»¥é¿å…ä¸å¿…è¦çš„è®¡ç®—å¼€é”€ã€‚</li></ul><img src="/2025/02/11/NLP%20Insights/%E6%8E%A8%E7%90%86%20LLM%20%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%8D%97%EF%BC%9A%E6%8E%A2%E7%B4%A2%E6%8E%A8%E7%90%86%E6%97%B6%E8%AE%A1%E7%AE%97%E6%8A%80%E6%9C%AF%E4%B8%8E%20DeepSeek-R1/20250211_162508.png" class=""><p>ğŸ“Œ <strong>ä¼˜åŒ–åçš„ç­”æ¡ˆç­›é€‰æ–¹å¼ï¼š</strong><br>æœ€ç»ˆï¼Œç”Ÿæˆçš„æ‰€æœ‰ç­”æ¡ˆå°†ä½¿ç”¨ <strong>Best-of-N é‡‡æ ·</strong> æ–¹æ³•è¿›è¡ŒåŠ æƒè¯„åˆ†ï¼Œç¡®ä¿é€‰å‡ºæœ€ä½³æ¨ç†è·¯å¾„çš„æœ€ç»ˆç­”æ¡ˆã€‚</p><p>ğŸš€ <strong>ä¼˜åŠ¿ï¼š</strong></p><ul><li>é¿å…è®¡ç®—èµ„æºæµªè´¹ï¼Œå¿«é€Ÿæ·˜æ±°ä½è´¨é‡æ¨ç†è·¯å¾„ã€‚</li><li>ç»“åˆ PRMï¼Œå¯ä»¥ç¡®ä¿æ¨¡å‹çš„æ¨ç†è¿‡ç¨‹æ›´è¿è´¯ã€æ›´ç¬¦åˆé€»è¾‘ã€‚</li><li>é€šè¿‡ Best-of-N æ–¹æ³•è¿›ä¸€æ­¥ä¼˜åŒ–ç­”æ¡ˆè´¨é‡ï¼Œä½¿æœ€ç»ˆç­”æ¡ˆæ›´åŠ å¯é ã€‚</li></ul><hr><h3 id="ğŸ²-è’™ç‰¹å¡æ´›æ ‘æœç´¢ï¼ˆMonte-Carlo-Tree-Search-MCTSï¼‰"><a href="#ğŸ²-è’™ç‰¹å¡æ´›æ ‘æœç´¢ï¼ˆMonte-Carlo-Tree-Search-MCTSï¼‰" class="headerlink" title="ğŸ² è’™ç‰¹å¡æ´›æ ‘æœç´¢ï¼ˆMonte Carlo Tree Search, MCTSï¼‰"></a>ğŸ² è’™ç‰¹å¡æ´›æ ‘æœç´¢ï¼ˆMonte Carlo Tree Search, MCTSï¼‰</h3><p>è’™ç‰¹å¡æ´›æ ‘æœç´¢ï¼ˆMonte Carlo Tree Search, <strong>MCTS</strong>ï¼‰æ˜¯ä¸€ç§å¸¸ç”¨äºå†³ç­–æ ‘æœç´¢çš„ç®—æ³•ï¼Œåœ¨ LLM çš„æ¨ç†ä¼˜åŒ–ä¸­ä¹Ÿå¯ä»¥é‡‡ç”¨è¯¥æ–¹æ³•ã€‚MCTS é€šè¿‡å››ä¸ªæ­¥éª¤æ¥ä¼˜åŒ–æ¨ç†è·¯å¾„ï¼š<br>ğŸ“Œ <strong>ä¸»è¦æ­¥éª¤ï¼š</strong></p><ol><li><strong>é€‰æ‹©ï¼ˆSelectionï¼‰ï¼š</strong> æ ¹æ®é¢„å®šä¹‰çš„å…¬å¼ï¼Œä»å½“å‰æœç´¢æ ‘ä¸­é€‰æ‹©ä¸€ä¸ªå¶èŠ‚ç‚¹ è¿›è¡Œæ‰©å±•ã€‚</li><li><strong>æ‰©å±•ï¼ˆExpandï¼‰ï¼š</strong> åœ¨æ‰€é€‰å¶èŠ‚ç‚¹çš„åŸºç¡€ä¸Š åˆ›å»ºæ–°çš„å­èŠ‚ç‚¹ï¼Œä»¥æ¢ç´¢æ›´å¤šå¯èƒ½çš„æ¨ç†è·¯å¾„ã€‚</li><li><strong>æ¨¡æ‹Ÿï¼ˆRolloutsï¼‰ï¼š</strong> é€šè¿‡éšæœºç”Ÿæˆæ–°çš„æ¨ç†è·¯å¾„ï¼ŒæŒç»­æ‰©å±•èŠ‚ç‚¹ï¼Œç›´åˆ°è¾¾åˆ°ç»ˆç‚¹ï¼ˆå³å¾—åˆ°æœ€ç»ˆç­”æ¡ˆï¼‰ã€‚</li><li><strong>å›æº¯ï¼ˆBackpropagationï¼‰ï¼š</strong> æ ¹æ®æœ€ç»ˆè¾“å‡ºç»“æœ æ›´æ–°çˆ¶èŠ‚ç‚¹çš„è¯„åˆ†ï¼Œä»è€Œä¼˜åŒ–æœªæ¥çš„æœç´¢å†³ç­–ã€‚</li></ol><p>åœ¨å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰çš„æ¨ç†è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸å¸Œæœ›æ‰¾åˆ°æœ€ä½³çš„æ¨ç†è·¯å¾„ï¼Œä½¿å…¶æœ€ç»ˆç”Ÿæˆçš„ç­”æ¡ˆæœ€ä¼˜ã€‚ä½†åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œéœ€è¦åœ¨ <strong>æ¢ç´¢ï¼ˆExplorationï¼‰</strong> å’Œ <strong>åˆ©ç”¨ï¼ˆExploitationï¼‰</strong> ä¹‹é—´å–å¾—å¹³è¡¡ï¼š</p><ul><li><strong>åˆ©ç”¨ï¼ˆExploitationï¼‰</strong>ï¼šé€‰æ‹©å½“å‰çœ‹èµ·æ¥æœ€ä¼˜çš„è·¯å¾„ï¼Œä»¥åˆ©ç”¨å·²çŸ¥çš„é«˜è´¨é‡æ¨ç†æ­¥éª¤ã€‚</li><li><strong>æ¢ç´¢ï¼ˆExplorationï¼‰</strong>ï¼šé€‰æ‹©è®¿é—®æ¬¡æ•°è¾ƒå°‘çš„è·¯å¾„ï¼Œä»¥å‘ç°å¯èƒ½æ›´ä¼˜çš„æ¨ç†æ­¥éª¤ã€‚</li></ul><h4 id="é€‰æ‹©åˆ†æ•°ï¼ˆSelection-Scoreï¼‰"><a href="#é€‰æ‹©åˆ†æ•°ï¼ˆSelection-Scoreï¼‰" class="headerlink" title="é€‰æ‹©åˆ†æ•°ï¼ˆSelection Scoreï¼‰"></a>é€‰æ‹©åˆ†æ•°ï¼ˆSelection Scoreï¼‰</h4><img src="/2025/02/11/NLP%20Insights/%E6%8E%A8%E7%90%86%20LLM%20%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%8D%97%EF%BC%9A%E6%8E%A2%E7%B4%A2%E6%8E%A8%E7%90%86%E6%97%B6%E8%AE%A1%E7%AE%97%E6%8A%80%E6%9C%AF%E4%B8%8E%20DeepSeek-R1/20250211_163149.png" class=""><p>åœ¨é€‰æ‹©æ¨ç†è·¯å¾„æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨ <strong>é€‰æ‹©åˆ†æ•°ï¼ˆSelection Scoreï¼‰</strong> è®¡ç®—æ¯ä¸ªæ¨ç†æ­¥éª¤ï¼ˆå³æ ‘çš„èŠ‚ç‚¹ï¼‰çš„ä¼˜å…ˆçº§ï¼Œå…¬å¼å¦‚ä¸‹ï¼š</p><p>$$<br>\text{Selection Score} = \frac{\text{Total Node Reward}}{\text{Number of Node Visits}} + C \times \sqrt{\frac{\text{Number of Parent Node Visits}}{\text{Number of Node Visits}}}<br>$$</p><p>å…¶ä¸­ï¼š</p><ul><li><p><strong>ç¬¬ä¸€é¡¹</strong>ï¼š$$\frac{\text{Total Node Reward}}{\text{Number of Node Visits}}$$ï¼ˆåˆ©ç”¨é¡¹ï¼ŒExploitation Termï¼‰</p><ul><li><strong>Total Node Reward</strong>ï¼šè¯¥èŠ‚ç‚¹ç´¯è®¡è·å¾—çš„å¥–åŠ±å€¼ï¼ˆè¡¨ç¤ºå…¶å†å²è¡¨ç°ï¼‰ã€‚</li><li><strong>Number of Node Visits</strong>ï¼šè¯¥èŠ‚ç‚¹è¢«è®¿é—®çš„æ¬¡æ•°ã€‚</li><li>è¿™é¡¹è®¡ç®—çš„æ˜¯è¯¥èŠ‚ç‚¹çš„ <strong>å¹³å‡å¥–åŠ±å€¼</strong>ï¼Œé«˜å¥–åŠ±çš„èŠ‚ç‚¹ä¼šè¢«ä¼˜å…ˆé€‰æ‹©ã€‚</li></ul></li><li><p><strong>ç¬¬äºŒé¡¹</strong>ï¼š$$C \times \sqrt{\frac{\text{Number of Parent Node Visits}}{\text{Number of Node Visits}}}$$ï¼ˆæ¢ç´¢é¡¹ï¼ŒExploration Termï¼‰</p><ul><li><strong># of Parent Node Visits</strong>ï¼šçˆ¶èŠ‚ç‚¹è¢«è®¿é—®çš„æ¬¡æ•°ã€‚</li><li><strong># of Node Visits</strong>ï¼šå½“å‰èŠ‚ç‚¹è¢«è®¿é—®çš„æ¬¡æ•°ã€‚</li><li><strong>C</strong>ï¼šä¸€ä¸ªè¶…å‚æ•°ï¼Œæ§åˆ¶æ¢ç´¢ä¸åˆ©ç”¨çš„å¹³è¡¡ã€‚</li><li>è¿™é¡¹é¼“åŠ±æ¢ç´¢è®¿é—®æ¬¡æ•°è¾ƒå°‘çš„èŠ‚ç‚¹ï¼Œä»¥é˜²æ­¢è¿‡æ—©é™·å…¥å±€éƒ¨æœ€ä¼˜è§£ã€‚</li></ul></li></ul><p>æ€»ç»“ï¼š</p><ul><li><strong>ç¬¬ä¸€é¡¹ï¼ˆExploitation Termï¼‰</strong> è®©ç®—æ³•å€¾å‘äºé€‰æ‹© <strong>å†å²è¡¨ç°è¾ƒå¥½çš„è·¯å¾„</strong>ã€‚</li><li><strong>ç¬¬äºŒé¡¹ï¼ˆExploration Termï¼‰</strong> è®©ç®—æ³•å€¾å‘äº <strong>æ¢ç´¢è®¿é—®è¾ƒå°‘çš„è·¯å¾„</strong>ï¼Œé¿å…é™·å…¥å±€éƒ¨æœ€ä¼˜ã€‚</li><li><strong>å‚æ•° C</strong> æ§åˆ¶è¿™ä¸¤è€…çš„å¹³è¡¡ã€‚</li></ul><h4 id="2-é€‰æ‹©ï¼ˆSelectionï¼‰ä¸æ‰©å±•ï¼ˆExpandï¼‰"><a href="#2-é€‰æ‹©ï¼ˆSelectionï¼‰ä¸æ‰©å±•ï¼ˆExpandï¼‰" class="headerlink" title="2. é€‰æ‹©ï¼ˆSelectionï¼‰ä¸æ‰©å±•ï¼ˆExpandï¼‰"></a><strong>2. é€‰æ‹©ï¼ˆSelectionï¼‰ä¸æ‰©å±•ï¼ˆExpandï¼‰</strong></h4><img src="/2025/02/11/NLP%20Insights/%E6%8E%A8%E7%90%86%20LLM%20%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%8D%97%EF%BC%9A%E6%8E%A2%E7%B4%A2%E6%8E%A8%E7%90%86%E6%97%B6%E8%AE%A1%E7%AE%97%E6%8A%80%E6%9C%AF%E4%B8%8E%20DeepSeek-R1/20250211_164346.png" class=""><p>è¿™ä¸€é˜¶æ®µï¼Œæˆ‘ä»¬ä½¿ç”¨ <strong>é€‰æ‹©åˆ†æ•°</strong> æ¥å†³å®šå“ªæ¡æ¨ç†è·¯å¾„å€¼å¾—ç»§ç»­æ‰©å±•ï¼š</p><p><strong>ï¼ˆ1ï¼‰é€‰æ‹©ï¼ˆSelectionï¼‰</strong></p><ul><li><strong>è¾“å…¥ï¼šé—®é¢˜ï¼ˆQuestionï¼‰</strong></li><li><strong>LLM ç”Ÿæˆå¤šä¸ªæ¨ç†æ­¥éª¤ï¼ˆReasoning Stepsï¼‰</strong><ul><li>ä¾‹å¦‚ï¼Œåœ¨å›¾ç‰‡ä¸­ï¼ŒLLM ç”Ÿæˆäº† 3 ä¸ªæ¨ç†æ­¥éª¤ï¼š<ul><li><strong>Thought 1</strong>ï¼ˆè¯„åˆ† 0.4ï¼‰</li><li><strong>Thought 2</strong>ï¼ˆè¯„åˆ† 0.2ï¼‰</li><li><strong>Thought 3</strong>ï¼ˆè¯„åˆ† 0.1ï¼‰</li></ul></li></ul></li><li><strong>ä½¿ç”¨é€‰æ‹©åˆ†æ•°ï¼ˆSelection Scoreï¼‰é€‰æ‹©æœ€ä¼˜è·¯å¾„</strong>ï¼ˆéšæœºåˆå§‹åŒ–ï¼‰<ul><li>åœ¨ç¤ºä¾‹ä¸­ï¼Œè¯„åˆ†æœ€é«˜çš„ <strong>Thought 1ï¼ˆ0.4ï¼‰</strong> è¢«é€‰ä¸­ã€‚</li></ul></li></ul><p><strong>ï¼ˆ2ï¼‰æ‰©å±•ï¼ˆExpandï¼‰</strong></p><ul><li><strong>åœ¨é€‰ä¸­çš„æ¨ç†è·¯å¾„ä¸Šï¼Œç”Ÿæˆæ–°çš„æ¨ç†æ­¥éª¤</strong></li><li>è¿™äº›æ–°æ¨ç†æ­¥éª¤çš„åˆå§‹å€¼è®¾ä¸º 0ï¼Œè¡¨ç¤ºå®ƒä»¬è¿˜æ²¡æœ‰ç»è¿‡è¯„ä¼°ã€‚</li></ul><p>è¿™ä¸ªè¿‡ç¨‹ç±»ä¼¼äº <strong>MCTS çš„æ‹“å±•ï¼ˆExpansionï¼‰é˜¶æ®µ</strong>ï¼Œå³ï¼š</p><ol><li>é€‰æ‹©å½“å‰æœ€ä¼˜è·¯å¾„ï¼ˆä½¿ç”¨ <strong>é€‰æ‹©åˆ†æ•°</strong>ï¼‰ã€‚</li><li>åœ¨è¯¥è·¯å¾„ä¸‹ï¼Œæ‰©å±•æ–°çš„æ¨ç†æ­¥éª¤ï¼ˆæœªè¯„åˆ†çš„å­èŠ‚ç‚¹ï¼‰ã€‚</li></ol><h4 id="3-Rolloutsï¼ˆæ¨¡æ‹Ÿï¼‰ä¸-Backpropagationï¼ˆåå‘ä¼ æ’­ï¼‰"><a href="#3-Rolloutsï¼ˆæ¨¡æ‹Ÿï¼‰ä¸-Backpropagationï¼ˆåå‘ä¼ æ’­ï¼‰" class="headerlink" title="3. Rolloutsï¼ˆæ¨¡æ‹Ÿï¼‰ä¸ Backpropagationï¼ˆåå‘ä¼ æ’­ï¼‰"></a><strong>3. Rolloutsï¼ˆæ¨¡æ‹Ÿï¼‰ä¸ Backpropagationï¼ˆåå‘ä¼ æ’­ï¼‰</strong></h4><img src="/2025/02/11/NLP%20Insights/%E6%8E%A8%E7%90%86%20LLM%20%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%8D%97%EF%BC%9A%E6%8E%A2%E7%B4%A2%E6%8E%A8%E7%90%86%E6%97%B6%E8%AE%A1%E7%AE%97%E6%8A%80%E6%9C%AF%E4%B8%8E%20DeepSeek-R1/20250211_165052.png" class=""><p>ä¸€æ—¦æ‰©å±•äº†æ¨ç†æ­¥éª¤ï¼Œæˆ‘ä»¬éœ€è¦ç»§ç»­æ¢ç´¢ï¼Œå¹¶åˆ©ç”¨ <strong>æ¨¡æ‹Ÿï¼ˆRolloutsï¼‰</strong> å’Œ <strong>åå‘ä¼ æ’­ï¼ˆBackpropagationï¼‰</strong> æ¥ä¼˜åŒ–æ•´ä¸ªæœç´¢è¿‡ç¨‹ã€‚</p><h3 id="ï¼ˆ3ï¼‰Rolloutsï¼ˆæ¨¡æ‹Ÿï¼‰"><a href="#ï¼ˆ3ï¼‰Rolloutsï¼ˆæ¨¡æ‹Ÿï¼‰" class="headerlink" title="ï¼ˆ3ï¼‰Rolloutsï¼ˆæ¨¡æ‹Ÿï¼‰"></a><strong>ï¼ˆ3ï¼‰Rolloutsï¼ˆæ¨¡æ‹Ÿï¼‰</strong></h3><ul><li>é€‰å®šè·¯å¾„åï¼Œæˆ‘ä»¬ç»§ç»­å±•å¼€æ¨ç†æ­¥éª¤ï¼Œç›´åˆ° <strong>ç”Ÿæˆæœ€ç»ˆç­”æ¡ˆ</strong>ã€‚</li><li>è¿™ä¸ªè¿‡ç¨‹ç±»ä¼¼äº <strong>åœ¨ MCTS ä¸­éšæœºæ¨¡æ‹Ÿæ¸¸æˆåˆ°ç»“æŸ</strong>ï¼š<ul><li>æˆ‘ä»¬ä»å½“å‰èŠ‚ç‚¹å‡ºå‘ï¼Œè¿›è¡Œä¸€ç³»åˆ—æ¨ç†ï¼Œç›´åˆ°æ¨¡å‹ç”Ÿæˆæœ€ç»ˆçš„ç­”æ¡ˆã€‚</li><li>åœ¨å›¾ç‰‡ä¸­ï¼Œæˆ‘ä»¬æ²¿ç€ Thought 1ï¼ˆ0.4ï¼‰ ç»§ç»­å±•å¼€æ¨ç†æ­¥éª¤ã€‚</li><li>è¿™äº›æ¨ç†æ­¥éª¤æœ€ç»ˆä¼š <strong>ç”Ÿæˆå¤šä¸ªç­”æ¡ˆ</strong>ï¼ˆå›¾ç‰‡ä¸­ç´«è‰²æ¡†ï¼‰ã€‚</li></ul></li></ul><h3 id="ï¼ˆ4ï¼‰Backpropagationï¼ˆåå‘ä¼ æ’­ï¼‰"><a href="#ï¼ˆ4ï¼‰Backpropagationï¼ˆåå‘ä¼ æ’­ï¼‰" class="headerlink" title="ï¼ˆ4ï¼‰Backpropagationï¼ˆåå‘ä¼ æ’­ï¼‰"></a><strong>ï¼ˆ4ï¼‰Backpropagationï¼ˆåå‘ä¼ æ’­ï¼‰</strong></h3><ul><li>é€šè¿‡å¯¹ <strong>æœ€ç»ˆç­”æ¡ˆ</strong> è¿›è¡Œè¯„åˆ†ï¼Œæˆ‘ä»¬å¯ä»¥æ›´æ–°å‰é¢æ‰€æœ‰å‚ä¸æ¨ç†çš„èŠ‚ç‚¹åˆ†æ•°ï¼š<ul><li><strong>PRMï¼ˆProcess Reward Modelï¼‰</strong>ï¼šå¯¹æ¨ç†æ­¥éª¤æœ¬èº«è¿›è¡Œè¯„åˆ†ï¼Œè¡¡é‡å…¶åˆç†æ€§ã€‚</li><li><strong>ORMï¼ˆOutput Reward Modelï¼‰</strong>ï¼šå¯¹æœ€ç»ˆç­”æ¡ˆè¿›è¡Œè¯„åˆ†ï¼Œè¡¡é‡å…¶æ­£ç¡®æ€§ã€‚</li><li>è¿™äº›è¯„åˆ† <strong>å‘ä¸Šä¼ æ’­</strong>ï¼Œæ›´æ–° <strong>æ‰€æœ‰ç»è¿‡çš„èŠ‚ç‚¹</strong> çš„å¥–åŠ±å€¼ã€‚</li></ul></li><li>ä¾‹å¦‚ï¼š<ul><li>åœ¨å›¾ç‰‡ä¸­ï¼Œæœ€ç»ˆç­”æ¡ˆçš„è¯„åˆ†å¯¼è‡´ <strong>Thought 1</strong> çš„è¯„åˆ†ä» 0.4 æé«˜åˆ° <strong>0.8</strong>ã€‚</li><li>è¿›ä¸€æ­¥å‘ä¸Šä¼ æ’­ï¼Œä½¿å¾— <strong>çˆ¶èŠ‚ç‚¹çš„é€‰æ‹©åˆ†æ•°ä¹Ÿéšä¹‹æ›´æ–°</strong>ã€‚</li></ul></li></ul><p>è¿™ä¸ªè¿‡ç¨‹ä¿è¯äº†ï¼š</p><ul><li><strong>è¾ƒå¥½çš„æ¨ç†è·¯å¾„ä¼šé€æ¸è·å¾—æ›´é«˜çš„åˆ†æ•°</strong>ï¼Œæé«˜è¢«é€‰ä¸­çš„æ¦‚ç‡ã€‚</li><li><strong>è¾ƒå·®çš„æ¨ç†è·¯å¾„ä¼šè¢«é€æ¸æ·˜æ±°</strong>ï¼Œé¿å…æµªè´¹è®¡ç®—èµ„æºã€‚</li></ul><hr><h2 id="ğŸ“Œ-ä¿®æ”¹æè®®åˆ†å¸ƒï¼ˆModifying-Proposal-Distributionï¼‰"><a href="#ğŸ“Œ-ä¿®æ”¹æè®®åˆ†å¸ƒï¼ˆModifying-Proposal-Distributionï¼‰" class="headerlink" title="ğŸ“Œ ä¿®æ”¹æè®®åˆ†å¸ƒï¼ˆModifying Proposal Distributionï¼‰"></a>ğŸ“Œ ä¿®æ”¹æè®®åˆ†å¸ƒï¼ˆModifying Proposal Distributionï¼‰</h2><p><strong>ä¿®æ”¹æè®®åˆ†å¸ƒï¼ˆModifying Proposal Distributionï¼‰</strong></p><p>åœ¨å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰çš„æ¨ç†è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹æè®®åˆ†å¸ƒï¼ˆModifying Proposal Distributionï¼‰æ¥ä¼˜åŒ–æ¨¡å‹çš„æ¨ç†èƒ½åŠ›ã€‚è¿™ç§æ–¹æ³•çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š</p><ul><li><strong>ä¸å†å•çº¯ä¾èµ–æ¨¡å‹æœç´¢æ­£ç¡®æ¨ç†æ­¥éª¤</strong>ï¼ˆåŸºäºè¾“å‡ºçš„ä¼˜åŒ–ï¼‰ï¼Œ</li><li><strong>è€Œæ˜¯è®©æ¨¡å‹ä¸»åŠ¨ç”Ÿæˆæ›´ä¼˜çš„æ¨ç†æ­¥éª¤</strong>ï¼ˆåŸºäºè¾“å…¥çš„ä¼˜åŒ–ï¼‰ã€‚</li></ul><p>æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬ä¸æ˜¯åœ¨è¾“å‡ºç»“æœåè¿›è¡Œæ£€éªŒï¼Œè€Œæ˜¯ç›´æ¥ä¿®æ”¹æ¨¡å‹åœ¨æ¨ç†è¿‡ç¨‹ä¸­å¦‚ä½•é€‰æ‹© tokenï¼Œè®©å®ƒæ›´å€¾å‘äºé€‰æ‹©èƒ½å¤Ÿå¼•å¯¼æ¨ç†çš„ tokenï¼Œè€Œä¸æ˜¯ç«‹å³è¾“å‡ºæœ€ç»ˆç­”æ¡ˆã€‚ä¿®æ”¹äº†ç”¨äºé‡‡æ ·è¡¥å…¨ï¼ˆcompletionsï¼‰ã€æ€ç»´ï¼ˆthoughtsï¼‰æˆ–æ ‡è®°ï¼ˆtokensï¼‰çš„æ¦‚ç‡åˆ†å¸ƒã€‚è¿™ç§æ–¹æ³•å¯ä»¥è®©æ¨¡å‹ç”Ÿæˆçš„ç­”æ¡ˆæ›´åŠ å‡†ç¡®ã€å¯è§£é‡Šï¼Œå¹¶ä¸”åœ¨é¢å¯¹å¤æ‚é—®é¢˜æ—¶æ›´å…·æœ‰é²æ£’æ€§ï¼ˆrobustnessï¼‰ã€‚</p><p><strong>1. ç›´æ¥é€‰æ‹©æœ€é«˜æ¦‚ç‡ Tokenï¼ˆGreedy é€‰æ‹©ï¼‰</strong></p><p>åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ŒLLM ç”Ÿæˆå¤šä¸ªå¯èƒ½çš„ token ä½œä¸ºè¾“å‡ºå€™é€‰é¡¹ï¼Œå¹¶æ ¹æ®å…¶æ¦‚ç‡è¿›è¡Œæ’åºï¼Œæœ€ç»ˆé€‰æ‹©æœ€é«˜æ¦‚ç‡çš„ token è¿›è¡Œè¾“å‡ºã€‚è¿™ç§æ–¹æ³•ç§°ä¸º<strong>è´ªå¿ƒé€‰æ‹©ï¼ˆGreedy Selectionï¼‰</strong>ã€‚</p><p>ä½ å¯ä»¥æƒ³è±¡ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªé—®é¢˜ï¼ˆquestionï¼‰å’Œä¸€ä¸ªç”¨äºé‡‡æ · token çš„æ¦‚ç‡åˆ†å¸ƒï¼ˆdistributionï¼‰ã€‚å¸¸è§çš„ç­–ç•¥æ˜¯é€‰æ‹©å¾—åˆ†æœ€é«˜çš„ tokenã€‚</p><img src="/2025/02/11/NLP%20Insights/%E6%8E%A8%E7%90%86%20LLM%20%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%8D%97%EF%BC%9A%E6%8E%A2%E7%B4%A2%E6%8E%A8%E7%90%86%E6%97%B6%E8%AE%A1%E7%AE%97%E6%8A%80%E6%9C%AF%E4%B8%8E%20DeepSeek-R1/20250211_170357.png" class=""><ul><li>ä¾‹å¦‚ï¼Œç»™å®šé—®é¢˜ <code>What is 3 + 2?</code>ï¼ŒLLM å¯èƒ½ä¼šç”Ÿæˆå¦‚ä¸‹å€™é€‰ tokenï¼š<ul><li><code>5</code>ï¼ˆæœ€é«˜æ¦‚ç‡ï¼‰</li><li><code>3</code></li><li><code>Adding</code></li><li><code>4</code></li><li><code>If</code></li></ul></li><li>åœ¨è´ªå¿ƒç­–ç•¥ä¸‹ï¼Œæ¨¡å‹ä¼šç›´æ¥é€‰æ‹© <code>5</code> ä½œä¸ºæœ€ç»ˆç­”æ¡ˆï¼Œè€Œä¸ä¼šè¿›è¡Œæ¨ç†ã€‚</li></ul><p>è¿™ç§æ–¹æ³•è™½ç„¶å¿«é€Ÿï¼Œä½†å­˜åœ¨å¦‚ä¸‹é—®é¢˜ï¼š</p><ul><li><strong>ç¼ºä¹æ¨ç†èƒ½åŠ›</strong>ï¼šæ¨¡å‹å¯èƒ½ç›´æ¥è¾“å‡ºé”™è¯¯ç­”æ¡ˆï¼Œå› ä¸ºå®ƒæ²¡æœ‰è¿›è¡Œæ¨ç†ã€‚</li><li><strong>å¯è§£é‡Šæ€§å·®</strong>ï¼šå¯¹äºå¤æ‚é—®é¢˜ï¼Œç”¨æˆ·æ— æ³•ç†è§£æ¨¡å‹æ˜¯å¦‚ä½•å¾—å‡ºç­”æ¡ˆçš„ã€‚</li></ul><p><strong>2. é€šè¿‡æ¨ç†ï¼ˆReasoning Before Answeringï¼‰æé«˜ç­”æ¡ˆè´¨é‡</strong></p><p>ç„¶è€Œï¼Œè¯·æ³¨æ„ä¸Šå›¾ä¸­æœ‰ä¸€äº›<strong>æ ‡è®°ï¼ˆtokens</strong>è¢«æ ‡çº¢ã€‚è¿™äº›tokenæ›´æœ‰å¯èƒ½å¼•å¯¼æ¨¡å‹è¿›å…¥ä¸€ä¸ªåˆç†çš„æ¨ç†è¿‡ç¨‹ã€‚è™½ç„¶é€‰æ‹©è´ªå¿ƒï¼ˆgreedyï¼‰ç­–ç•¥ä¸‹å¾—åˆ†æœ€é«˜çš„ token ä¸ä¸€å®šæ˜¯é”™è¯¯çš„ï¼Œä½†é€‰æ‹©é‚£äº›èƒ½å¼•å¯¼æ¨¡å‹è¿›å…¥æ¨ç†è¿‡ç¨‹çš„ tokenï¼Œé€šå¸¸ä¼šå¾—åˆ°æ›´å¥½çš„ç­”æ¡ˆã€‚<br>è®© LLM <strong>å…ˆè¿›è¡Œæ¨ç†ï¼Œå†ç»™å‡ºç­”æ¡ˆ</strong>ï¼Œå³ï¼š</p><ul><li>é€‰æ‹©æ¨ç† tokenï¼ˆå¦‚ <code>Adding</code>ï¼‰</li><li>é€æ­¥ç”Ÿæˆæ¨ç†è¿‡ç¨‹ï¼Œå¦‚ï¼š<ul><li><code>Adding â†’ 3 and 2 gives â†’ 5</code></li><li><code>If â†’ 3 + 1 = 4, 4 + 1 = 5 â†’ 5</code></li><li><code>The total is â†’ 5</code></li></ul></li><li>é€šè¿‡æ¨ç†é“¾æ¡é€æ­¥æ¨å¯¼å‡º <code>5</code>ï¼Œç›¸æ¯”ç›´æ¥é€‰æ‹© <code>5</code>ï¼Œè¿™ç§æ–¹æ³•æ›´åŠ å¯è§£é‡Šï¼Œå¹¶ä¸”èƒ½åœ¨å¤æ‚é—®é¢˜ä¸Šè¡¨ç°æ›´å¥½ã€‚</li></ul><p><strong>3. é€šè¿‡ä¿®æ”¹æè®®åˆ†å¸ƒï¼ˆRe-Ranking Token Probabilitiesï¼‰å¼•å¯¼æ¨ç†è¿‡ç¨‹</strong></p><img src="/2025/02/11/NLP%20Insights/%E6%8E%A8%E7%90%86%20LLM%20%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%8D%97%EF%BC%9A%E6%8E%A2%E7%B4%A2%E6%8E%A8%E7%90%86%E6%97%B6%E8%AE%A1%E7%AE%97%E6%8A%80%E6%9C%AF%E4%B8%8E%20DeepSeek-R1/20250211_171002.png" class=""><p>å½“æˆ‘ä»¬<strong>ä¿®æ”¹æè®®åˆ†å¸ƒï¼ˆproposal distributionï¼Œå³ token çš„æ¦‚ç‡åˆ†å¸ƒï¼‰</strong>æ—¶ï¼Œå®é™…ä¸Šæ˜¯åœ¨<strong>é‡æ–°æ’åºï¼ˆre-rankï¼‰</strong>è¿™ä¸ªåˆ†å¸ƒï¼Œä½¿å¾—â€œæ¨ç†ç›¸å…³â€çš„ token è¢«é€‰ä¸­çš„æ¦‚ç‡æ›´é«˜ã€‚<br>åœ¨è¿™ç§æ–¹æ³•ä¸‹ï¼Œæˆ‘ä»¬è°ƒæ•´ LLM çš„æè®®åˆ†å¸ƒï¼Œä½¿å…¶æ›´å€¾å‘äºé€‰æ‹©æ¨ç† tokenï¼Œè€Œéç›´æ¥é€‰æ‹©ç­”æ¡ˆï¼š</p><ul><li>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>5</code> å…·æœ‰æœ€é«˜æ¦‚ç‡ï¼Œè€Œ <code>Adding</code>ã€<code>If</code> ç­‰æ¨ç† token çš„æ¦‚ç‡è¾ƒä½ã€‚</li><li>é€šè¿‡ä¿®æ”¹æè®®åˆ†å¸ƒï¼Œæˆ‘ä»¬æé«˜ <code>Adding</code>ã€<code>If</code> çš„æ¦‚ç‡ï¼Œä½¿æ¨¡å‹å€¾å‘äºè¿›è¡Œæ¨ç†ã€‚</li></ul><p><strong>4. å¦‚ä½•å®ç°ä¿®æ”¹æè®®åˆ†å¸ƒï¼Ÿ</strong></p><p>ä¸»è¦æœ‰ä¸¤ç§æ–¹å¼ï¼š</p><ol><li><strong>é€šè¿‡ Prompt Engineering</strong><ul><li>ä¿®æ”¹ Promptï¼Œå¼•å¯¼æ¨¡å‹ç”Ÿæˆæ¨ç†æ­¥éª¤ã€‚</li><li>ä¾‹å¦‚ï¼š<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Q: What is 3 + 2?</span><br><span class="line">A: Let's think step by step.</span><br></pre></td></tr></tbody></table></figure></li></ul></li><li><strong>è®­ç»ƒæ¨¡å‹æ›´å€¾å‘äºæ¨ç†</strong><ul><li>åœ¨å¾®è°ƒè¿‡ç¨‹ä¸­ï¼Œæä¾›æ›´å¤šå…·æœ‰æ¨ç†é“¾çš„è®­ç»ƒæ•°æ®ï¼Œè®©æ¨¡å‹ä¹ æƒ¯ç”Ÿæˆæ¨ç† tokenã€‚</li></ul></li></ol><p><strong>æ€»ç»“</strong></p><ul><li><strong>è´ªå¿ƒé€‰æ‹©ï¼ˆGreedy Selectionï¼‰</strong>ï¼šå¿«é€Ÿï¼Œä½†ç¼ºä¹æ¨ç†ï¼Œå¯è§£é‡Šæ€§å·®ã€‚</li><li><strong>æ¨ç†åå›ç­”ï¼ˆReasoning Before Answeringï¼‰</strong>ï¼šæé«˜ç­”æ¡ˆè´¨é‡å’Œå¯è§£é‡Šæ€§ã€‚</li><li><strong>ä¿®æ”¹æè®®åˆ†å¸ƒï¼ˆModifying Proposal Distributionï¼‰</strong>ï¼šè°ƒæ•´ token é€‰æ‹©çš„æ¦‚ç‡ï¼Œä½¿æ¨¡å‹æ›´å€¾å‘äºé€‰æ‹©æ¨ç† tokenï¼Œæé«˜æ•´ä½“ç­”æ¡ˆçš„åˆç†æ€§ã€‚</li></ul><p>è¿™ç§æ–¹æ³•åœ¨<strong>æ•°å­¦è®¡ç®—ã€é€»è¾‘æ¨ç†ã€æ³•å¾‹æ¨ç†ç­‰ä»»åŠ¡</strong>ä¸Šå°¤ä¸ºé‡è¦ï¼Œä½¿å¾— LLM <strong>ä¸ä»…èƒ½â€œç­”å¯¹â€ï¼Œè¿˜èƒ½â€œè¯´æ˜ç™½â€</strong>ã€‚</p><h3 id="Prompting"><a href="#Prompting" class="headerlink" title="Prompting"></a><strong>Prompting</strong></h3><p>éšç€æˆ‘ä»¬ä½¿ç”¨ <strong>prompt engineering</strong>ï¼ˆæç¤ºå·¥ç¨‹ï¼‰æ¥æ”¹è¿›è¾“å‡ºï¼Œæˆ‘ä»¬ä¼šé€šè¿‡æ›´æ–°æç¤ºï¼ˆpromptï¼‰æ¥å°è¯•æå‡æ¨¡å‹çš„è¡¨ç°ã€‚è¿™ä¸ªè¿‡ç¨‹ä¹Ÿå¯èƒ½æ¨åŠ¨æ¨¡å‹å»å±•ç¤ºå…ˆå‰æˆ‘ä»¬çœ‹åˆ°çš„ä¸€äº›<strong>reasoning</strong>ï¼ˆæ¨ç†ï¼‰è¿‡ç¨‹ã€‚</p><p><strong>1. æ”¹å˜ Proposal Distribution</strong></p><p>åœ¨æ›´æ”¹ <strong>proposal distribution</strong>æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç»™æ¨¡å‹æä¾›ç¤ºä¾‹ï¼ˆä¹Ÿå«åš <strong>in-context learning</strong>ï¼‰ï¼Œè®©å®ƒåœ¨ç”Ÿæˆç­”æ¡ˆæ—¶æ¨¡ä»¿ç±»ä¼¼çš„æ¨ç†é£æ ¼ã€‚ä¸‹é¢çš„å›¾å°±å±•ç¤ºäº†ä¸€ä¸ªç¤ºä¾‹çš„æƒ…å½¢ï¼š</p><img src="/2025/02/11/NLP%20Insights/%E6%8E%A8%E7%90%86%20LLM%20%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%8D%97%EF%BC%9A%E6%8E%A2%E7%B4%A2%E6%8E%A8%E7%90%86%E6%97%B6%E8%AE%A1%E7%AE%97%E6%8A%80%E6%9C%AF%E4%B8%8E%20DeepSeek-R1/20250211_172130.png" class=""><blockquote><ul><li><strong>å›¾ç¤ºå†…å®¹</strong>ï¼šå·¦ä¾§æ˜¯ä¸€ä¸ªç®€å•çš„é—®é¢˜ â€œWhat is 3 + 2?â€ï¼Œæ¨¡å‹å†…éƒ¨ç”¨ â€œThoughtsâ€ è¡¨ç¤ºéšè—çš„æ€è€ƒè¿‡ç¨‹ï¼Œæ¯”å¦‚ï¼š<ol><li>First, 3 and 1 gives 4.</li><li>Then, 4 and 1 gives 5.</li><li>I believe the answer is 5.</li></ol></li><li><strong>Answer</strong>ï¼ˆç­”æ¡ˆï¼‰ï¼š5</li><li>å³ä¾§ç”¨çº¢è‰²ã€è“è‰²ç­‰ä¸åŒé¢œè‰²çš„æ¡å½¢æˆ–æ–¹å—è¡¨ç¤ºæ¨ç†è¿‡ç¨‹çš„ä¸åŒéƒ¨åˆ†ï¼Œç¤ºæ„æœ‰ä¸€éƒ¨åˆ†å±äºéšè—çš„æ¨ç†è¿‡ç¨‹ï¼ˆçº¢è‰²ï¼‰ï¼Œä»¥åŠè¾“å‡ºç»“æœæˆ–è‹¥å¹²ä¸­é—´æ­¥éª¤ï¼ˆè“è‰²ï¼‰ã€‚</li></ul></blockquote><p>é€šè¿‡ç±»ä¼¼çš„ç¤ºä¾‹ï¼Œæ¨¡å‹åœ¨æ¨ç†æ—¶å°±å¯èƒ½æ¨¡ä»¿ç±»ä¼¼çš„æ ¼å¼æ¥è¿›è¡Œ<strong>reasoning</strong>å¹¶ç»™å‡ºæœ€ç»ˆç­”æ¡ˆã€‚</p><p><strong>2. â€œLetâ€™s think step-by-stepâ€ çš„å½±å“</strong></p><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡åœ¨æç¤ºä¸­ç›´æ¥ä½¿ç”¨ â€œLetâ€™s think step-by-stepâ€ æ¥ç®€åŒ–ä¸Šè¿°æµç¨‹ã€‚è¿™ä¼šæ”¹å˜æ¨¡å‹çš„ <strong>proposal distribution</strong>ï¼Œè®© <strong>LLM</strong>ï¼ˆå¤§å‹è¯­è¨€æ¨¡å‹ï¼‰å€¾å‘äºåœ¨å›ç­”ä¹‹å‰åˆ†æ­¥éª¤æ€è€ƒã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><img src="/2025/02/11/NLP%20Insights/%E6%8E%A8%E7%90%86%20LLM%20%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%8D%97%EF%BC%9A%E6%8E%A2%E7%B4%A2%E6%8E%A8%E7%90%86%E6%97%B6%E8%AE%A1%E7%AE%97%E6%8A%80%E6%9C%AF%E4%B8%8E%20DeepSeek-R1/20250211_172232.png" class=""><blockquote><ul><li><strong>å›¾ç¤ºå†…å®¹</strong>ï¼šè¿™é‡Œå°†æç¤ºæ¢æˆ â€œLetâ€™s think step-by-stepâ€ï¼Œé—®é¢˜ä»ç„¶æ˜¯ â€œWhat is 3 + 2?â€ã€‚</li><li>æ¨¡å‹äº§ç”Ÿæ›´æ˜¾å¼çš„æ¨ç†è¿‡ç¨‹ï¼ˆç”¨çº¢è‰²å—ç¤ºæ„ï¼‰ï¼Œå†è¾“å‡ºæ­£ç¡®ç­”æ¡ˆ 5ã€‚</li><li>æ•´ä¸ªæ€è·¯ç±»ä¼¼å›¾1ï¼Œä½†æ›´åŠ çªå‡ºâ€œåˆ†æ­¥éª¤æ€è€ƒâ€å¯¹æœ€ç»ˆç­”æ¡ˆç”Ÿæˆçš„å½±å“ã€‚</li></ul></blockquote><p>ç„¶è€Œï¼Œè¿™å¹¶ä¸æ„å‘³ç€æ¨¡å‹æœ¬èº«å·²ç»å†…åŒ–äº†è¿™ç§æ¨ç†èƒ½åŠ›â€”â€”å®ƒ<strong>å¹¶æ²¡æœ‰ä»æ ¹æœ¬ä¸Šå­¦ä¼š</strong>å»â€œåæ€â€æˆ–â€œä¿®æ­£â€é”™è¯¯ã€‚å¦‚æœæ¨¡å‹ä¸€å¼€å§‹çš„æ¨ç†è¿‡ç¨‹æ˜¯é”™è¯¯çš„ï¼Œé‚£ä¹ˆåœ¨è¿™ç§é™æ€ä¸”çº¿æ€§çš„æµç¨‹ä¸­ï¼Œå®ƒå¾€å¾€ä¼šä¸€ç›´å»¶ç»­è¿™ä¸ªé”™è¯¯ï¼Œè€Œä¸æ˜¯å¯¹è‡ªèº«æ¨ç†è¿›è¡Œä¿®æ­£ã€‚</p><hr><h3 id="STaRï¼ˆSelf-Taught-Reasonerï¼‰"><a href="#STaRï¼ˆSelf-Taught-Reasonerï¼‰" class="headerlink" title="STaRï¼ˆSelf-Taught Reasonerï¼‰"></a><strong>STaRï¼ˆSelf-Taught Reasonerï¼‰</strong></h3><p>é™¤äº†é€šè¿‡ <strong>prompting</strong>ï¼ˆæç¤ºï¼‰è®©æ¨¡å‹ä¸´æ—¶å±•ç¤ºæ¨ç†æ­¥éª¤ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è®©æ¨¡å‹åœ¨è®­ç»ƒä¸­å› ä¸ºâ€œäº§ç”Ÿæ­£ç¡®æ¨ç†æ­¥éª¤â€è€Œå¾—åˆ°å¥–åŠ±ï¼Œä»è€Œè®©å®ƒçœŸæ­£â€œå­¦ä¼šâ€æ¨ç†ã€‚è¿™é€šå¸¸éœ€è¦åœ¨<strong>å¤§é‡å¸¦æœ‰æ¨ç†è¿‡ç¨‹çš„æ•°æ®</strong>ä¸Šè¿›è¡Œè®­ç»ƒï¼Œå¹¶ç»“åˆ <strong>reinforcement learning</strong>ï¼ˆå¼ºåŒ–å­¦ä¹ ï¼‰æ¥å¥–åŠ±ç‰¹å®šçš„è¡Œä¸ºã€‚</p><p>ä¸€ä¸ªé¢‡å—äº‰è®®ï¼ˆâ€œmuch-debatedâ€ï¼‰çš„æŠ€æœ¯å°±æ˜¯ <strong>STaR</strong>ï¼Œå³ <strong>Self-Taught Reasoner</strong>ã€‚å®ƒæ˜¯è®© <strong>LLM</strong> ç”Ÿæˆè‡ªå·±çš„æ¨ç†æ•°æ®ï¼Œå†æŠŠè¿™äº›æ•°æ®ç”¨äºå¯¹æ¨¡å‹è¿›è¡Œ<strong>ç²¾è°ƒ</strong>ï¼ˆ<em>fine-tuning</em>ï¼‰çš„è¿‡ç¨‹ã€‚</p><p><strong>1. STaR çš„æµç¨‹æ¦‚è¿°</strong></p><img src="/2025/02/11/NLP%20Insights/%E6%8E%A8%E7%90%86%20LLM%20%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%8D%97%EF%BC%9A%E6%8E%A2%E7%B4%A2%E6%8E%A8%E7%90%86%E6%97%B6%E8%AE%A1%E7%AE%97%E6%8A%80%E6%9C%AF%E4%B8%8E%20DeepSeek-R1/20250211_172455.png" class=""><ul><li>è¿™å¹…å›¾æ¦‚æ‹¬äº† STaR çš„å·¥ä½œåŸç†ï¼š<ol><li><strong>Generate reasoning + answer</strong>ï¼šæ¨¡å‹å…ˆé’ˆå¯¹è¾“å…¥é—®é¢˜ç”Ÿæˆä¸€æ®µ <strong>reasoning</strong>ï¼ˆæ¨ç†ï¼‰å’Œä¸€ä¸ª <strong>answer</strong>ï¼ˆç­”æ¡ˆï¼‰ï¼›<br>2a. å¦‚æœç­”æ¡ˆæ­£ç¡®ï¼ˆCorrect answerï¼‰ï¼Œåˆ™å°† <strong>Question, Reasoning, Answer</strong> ä½œä¸ºè®­ç»ƒæ ·æœ¬æ·»åŠ åˆ°ä¸‰å…ƒç»„æ•°æ®é›†ä¸­ï¼ˆ3aï¼‰ï¼›<br>  3b. åˆ©ç”¨è¿™äº›ä¸‰å…ƒç»„æ•°æ®è¿›è¡Œ <strong>supervised fine-tuning</strong>ï¼ˆç›‘ç£å¾®è°ƒï¼‰ï¼Œè®©æ¨¡å‹å­¦ä¼šåœ¨ç±»ä¼¼æƒ…å½¢ä¸‹äº§å‡ºæ­£ç¡®æ¨ç†ä¸ç­”æ¡ˆã€‚</li></ol></li></ul><p>å¦‚æœæ¨¡å‹ç»™å‡ºäº†é”™è¯¯ç­”æ¡ˆï¼Œåˆ™ä¼šè§¦å‘å¦ä¸€æ¡è·¯å¾„ï¼š</p><img src="/2025/02/11/NLP%20Insights/%E6%8E%A8%E7%90%86%20LLM%20%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%8D%97%EF%BC%9A%E6%8E%A2%E7%B4%A2%E6%8E%A8%E7%90%86%E6%97%B6%E8%AE%A1%E7%AE%97%E6%8A%80%E6%9C%AF%E4%B8%8E%20DeepSeek-R1/20250211_172608.png" class=""><ul><li>å½“ (2b) æ¨¡å‹ç­”æ¡ˆé”™è¯¯æ—¶ï¼Œæˆ‘ä»¬æä¾›æ­£ç¡®ç­”æ¡ˆä½œä¸º <strong>hint</strong>ï¼ˆæç¤ºï¼‰ï¼Œå¹¶è®©æ¨¡å‹å»æ€è€ƒâ€œä¸ºä»€ä¹ˆè¿™ä¸ªç­”æ¡ˆæ˜¯æ­£ç¡®çš„â€ï¼›</li><li>ä¹Ÿå°±æ˜¯ <strong>Generate reasoning only</strong> (why this answer is correct?)ï¼›</li><li>å¾—åˆ°çš„è¿™æ®µæ–°çš„æ¨ç†ä¾æ—§ä¼šè¢«åŠ å…¥åˆ°ä¸‰å…ƒç»„æ•°æ®ä¸­ï¼Œç„¶åå†è¿›è¡Œ <strong>supervised fine-tuning</strong>ã€‚</li></ul><p>è¿™é‡Œçš„å…³é”®è¦ç‚¹æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ç§æ–¹æ³•<strong>æ˜¾å¼</strong>åœ°è®­ç»ƒæ¨¡å‹â€œåº”è¯¥å¦‚ä½•è¿›è¡Œæ¨ç†â€ï¼Œè€Œä¸ä»…ä»…æ˜¯è®©å®ƒä¸´æ—¶åœ°æ¨¡ä»¿æ¨ç†è¿‡ç¨‹ã€‚æˆ‘ä»¬è¦å¯¹æ¨¡å‹çš„æ¨ç†æ–¹å¼è¿›è¡Œ<strong>ç›‘ç£</strong>ï¼ˆ<em>supervised fine-tuning</em>ï¼‰ï¼Œä»è€ŒæŠŠæˆ‘ä»¬æƒ³è¦çš„æ¨ç†æ¨¡å¼â€œçŒè¾“â€ç»™æ¨¡å‹ã€‚</p><p><strong>2. è‡ªåŠ¨ç”Ÿæˆåˆæˆè®­ç»ƒæ ·æœ¬</strong></p><p>STaR çš„æ•´ä¸ªæµç¨‹éå¸¸æœ‰è¶£ï¼Œå› ä¸ºå®ƒä¼š<strong>è‡ªåŠ¨ç”Ÿæˆåˆæˆè®­ç»ƒæ ·æœ¬</strong>ï¼ˆ<em>synthetic training examples</em>ï¼‰ã€‚è¿™äº›æ ·æœ¬ä¸ä»…åŒ…å«é—®é¢˜å’Œç­”æ¡ˆï¼Œè¿˜åŒ…å«ä¸€ç³»åˆ—æ¨ç†æ­¥éª¤ï¼Œèƒ½å¤Ÿå¸®åŠ©æ¨¡å‹æ›´å¥½åœ°å­¦ä¹ å¦‚ä½•â€œæ€è€ƒâ€ã€‚åœ¨å…¶ä»–ç ”ç©¶ä¸­ï¼ˆä¾‹å¦‚ <strong>DeepSeek R-1</strong>ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™äº›åˆæˆæ ·æœ¬æ¥<strong>è’¸é¦</strong>ï¼ˆ<em>distill</em>ï¼Œæ„ä¸ºâ€œæç‚¼å’Œä¿ç•™å…³é”®ä¿¡æ¯â€ï¼‰æ¨ç†è¿‡ç¨‹åˆ°å…¶å®ƒæ¨¡å‹ä¸Šã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªæŒæ¡äº†æ¨ç†èƒ½åŠ›çš„æ¨¡å‹å¯ä»¥å¸®åŠ©å¦ä¸€ä¸ªæ¨¡å‹æ›´å¿«åœ°å­¦ä¼šç±»ä¼¼çš„æ¨ç†ã€‚</p><hr><p><strong>é‡ç‚¹ï¼š</strong></p><ul><li><strong>Prompting</strong>ï¼ˆæç¤ºï¼‰èƒ½å¤Ÿå½±å“æ¨¡å‹çš„è¾“å‡ºé£æ ¼å’Œæ€ç»´è¿‡ç¨‹ï¼Œæ¯”å¦‚ä½¿ç”¨ â€œLetâ€™s think step-by-stepâ€ è®©æ¨¡å‹æ˜¾å¼ç»™å‡ºæ¨ç†æ­¥éª¤ï¼Œä½†å¹¶ä¸ä¿è¯æ¨¡å‹è‡ªåŠ¨çº æ­£é”™è¯¯ã€‚</li><li><strong>STaR</strong>ï¼ˆ<strong>Self-Taught Reasoner</strong>ï¼‰ç­‰æ–¹æ³•åˆ™é€šè¿‡<strong>ç”Ÿæˆæ¨ç†æ•°æ®ã€ç›‘ç£å¾®è°ƒå’Œå¥–åŠ±æœºåˆ¶</strong>ï¼Œå¸®åŠ©æ¨¡å‹çœŸæ­£å­¦ä¼šæŒ‰ç…§æŒ‡å®šçš„æ¨ç†æ–¹å¼å»æ€è€ƒå’Œå›ç­”é—®é¢˜ã€‚</li><li>æ— è®ºæ˜¯å“ªä¸€ç§æ–¹æ³•ï¼Œéƒ½å¯ä»¥è§†ä¸ºå¯¹ <strong>proposal distribution</strong> çš„è°ƒèŠ‚ï¼šè¦ä¹ˆæ˜¯æç¤ºæ—¶ä¸´æ—¶<strong>nudge</strong>ï¼ˆå¼•å¯¼ï¼‰ï¼Œè¦ä¹ˆæ˜¯ä»è®­ç»ƒæ ¹æºä¸Šè¿›è¡Œè°ƒæ•™ï¼Œè®©æ¨¡å‹å†…åŒ–è¿™ç§æ¨ç†è¿‡ç¨‹ã€‚</li><li>åˆ©ç”¨ <strong>in-context learning</strong> æä¾›ç¤ºä¾‹ï¼Œèƒ½å¤Ÿè®©æ¨¡å‹æ¨¡ä»¿æ¨ç†é£æ ¼ã€‚</li><li>ç”¨ <strong>reinforcement learning</strong> æˆ–<strong>ç›‘ç£å¾®è°ƒ</strong>ï¼ˆ<strong>supervised fine-tuning</strong>ï¼‰å¯ä»¥ä½¿æ¨¡å‹é€æ¸æŒæ¡æˆ‘ä»¬æœŸæœ›çš„æ¨ç†æ¨¡å¼ã€‚</li><li><strong>STaR</strong> æ–¹æ³•ä¼šè‡ªåŠ¨æ”¶é›†â€œæ­£ç¡®æ¨ç†â€æ•°æ®å¹¶è¿›è¡Œè®­ç»ƒï¼Œä½¿å¾—æ¨¡å‹åœ¨åç»­å›ç­”ä¸­æ›´å¯èƒ½äº§ç”Ÿæ­£ç¡®ä¸”ç¬¦åˆè¦æ±‚çš„æ¨ç†æ­¥éª¤ã€‚</li></ul><hr><h2 id="DeepSeek-R1"><a href="#DeepSeek-R1" class="headerlink" title="DeepSeek-R1"></a>DeepSeek-R1</h2><hr><h3 id="1-ç®€ä»‹"><a href="#1-ç®€ä»‹" class="headerlink" title="1. ç®€ä»‹"></a>1. ç®€ä»‹</h3><p><strong>DeepSeek-R1</strong> æ˜¯ä¸€ä¸ªåœ¨æ¨ç†ï¼ˆreasoningï¼‰æ¨¡å‹é¢†åŸŸçš„é‡å¤§ç‰ˆæœ¬ï¼Œå…¶æƒé‡å·²ç»å¼€æºã€‚å®ƒç›´æ¥ä¸ OpenAI çš„ <strong>o1</strong> æ¨ç†æ¨¡å‹å±•å¼€ç«äº‰ï¼Œå¹¶åœ¨è¿™ä¸€é¢†åŸŸäº§ç”Ÿäº†é‡å¤§å½±å“ã€‚</p><p>DeepSeek é¡¹ç›®åœ¨å°†æ¨ç†åŠŸèƒ½ä¼˜é›…åœ°æ•´åˆè¿›å…¶åŸºç¡€æ¨¡å‹ï¼ˆ<strong>DeepSeek-V3-Base</strong>ï¼‰æ–¹é¢æˆå°±å“è‘—ï¼Œé‡‡ç”¨äº†å¤šç§æŠ€æœ¯æ¥å®Œæˆè¿™ä¸€ç›®æ ‡ã€‚</p><p>æœ‰è¶£çš„æ˜¯ï¼Œè¯¥é¡¹ç›®åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­å¹¶æœªä¾èµ–é¢å¤–çš„éªŒè¯å™¨ï¼ˆverifierï¼‰ï¼Œè€Œä¸”å¹¶ä¸æ˜¯å•çº¯åœ°ä¾é ç›‘ç£å¾®è°ƒï¼ˆsupervised fine-tuningï¼‰æ¥æç‚¼æ¨ç†è¡Œä¸ºã€‚ç›¸åï¼Œ<strong>å¼ºåŒ–å­¦ä¹ ï¼ˆReinforcement Learning, RLï¼‰</strong> åœ¨å…¶ä¸­æ‰®æ¼”äº†é‡è¦è§’è‰²ã€‚</p><p>ä»¥ä¸‹æˆ‘ä»¬å°†ä¸€èµ·æ¢ç©¶ä»–ä»¬æ˜¯å¦‚ä½•åœ¨æ¨¡å‹ä¸­è®­ç»ƒå‡ºæ¨ç†è¡Œä¸ºçš„ï¼</p><hr><h3 id="2-DeepSeek-R1-Zeroï¼šæ¨ç†çš„å…³é”®æ¢ç´¢"><a href="#2-DeepSeek-R1-Zeroï¼šæ¨ç†çš„å…³é”®æ¢ç´¢" class="headerlink" title="2. DeepSeek-R1 Zeroï¼šæ¨ç†çš„å…³é”®æ¢ç´¢"></a>2. DeepSeek-R1 Zeroï¼šæ¨ç†çš„å…³é”®æ¢ç´¢</h3><p>åœ¨é€šå¾€ <strong>DeepSeek-R1</strong> çš„é“è·¯ä¸Šï¼Œæœ‰ä¸€ä¸ªåä¸º <strong>DeepSeek-R1 Zero</strong> çš„å®éªŒæ€§æ¨¡å‹ä¸ºè¿™æ¬¡çªç ´æ‰“ä¸‹äº†åŸºç¡€ã€‚å®ƒä» <strong>DeepSeek-V3-Base</strong> å‡ºå‘ï¼Œå®Œå…¨ä¸ä½¿ç”¨å¤§è§„æ¨¡ç›‘ç£å¾®è°ƒæ¥åŠ å…¥æ¨ç†æ•°æ®ï¼Œè€Œæ˜¯åªä¾é  <strong>å¼ºåŒ–å­¦ä¹ </strong> æ¥è·å¾—æ¨ç†èƒ½åŠ›ã€‚</p><h4 id="è®­ç»ƒè¿‡ç¨‹ä¸ç³»ç»Ÿæç¤ºï¼ˆPromptï¼‰"><a href="#è®­ç»ƒè¿‡ç¨‹ä¸ç³»ç»Ÿæç¤ºï¼ˆPromptï¼‰" class="headerlink" title="è®­ç»ƒè¿‡ç¨‹ä¸ç³»ç»Ÿæç¤ºï¼ˆPromptï¼‰"></a>è®­ç»ƒè¿‡ç¨‹ä¸ç³»ç»Ÿæç¤ºï¼ˆPromptï¼‰</h4><p>åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œä»–ä»¬é¦–å…ˆå‡†å¤‡äº†ä¸€ä¸ªéå¸¸ç›´æ¥çš„æç¤ºï¼ˆpromptï¼‰ï¼Œå…¶å½¢å¼ç±»ä¼¼äºç³»ç»Ÿæç¤ºï¼ˆsystem promptï¼‰ï¼Œç”¨æ¥ä½œä¸ºæ¨ç†ç®¡çº¿çš„ä¸€éƒ¨åˆ†ã€‚ä¸‹æ–‡å³å±•ç¤ºäº†ç›¸å…³æç¤ºã€‚è¯·æ³¨æ„ï¼Œå…¶ä¸­æ˜ç¡®æŒ‡å‡ºäº†æ¨ç†è¿‡ç¨‹è¦å†™åœ¨ <code>&lt;think&gt;</code> æ ‡ç­¾å†…ã€ç­”æ¡ˆè¦å†™åœ¨ <code>&lt;answer&gt;</code> æ ‡ç­¾å†…ï¼Œä½†æ²¡æœ‰è¿›ä¸€æ­¥è§„å®šæ¨ç†è¿‡ç¨‹åº”å¦‚ä½•å…·ä½“å‘ˆç°æˆ–ç»„ç»‡ã€‚</p><img src="/2025/02/11/NLP%20Insights/%E6%8E%A8%E7%90%86%20LLM%20%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%8D%97%EF%BC%9A%E6%8E%A2%E7%B4%A2%E6%8E%A8%E7%90%86%E6%97%B6%E8%AE%A1%E7%AE%97%E6%8A%80%E6%9C%AF%E4%B8%8E%20DeepSeek-R1/20250211_183150.png" class=""><p>åœ¨ä¸Šå›¾ä¸­ï¼Œå¯ä»¥çœ‹åˆ°ä¸€ä¸ªç®€åŒ–ç‰ˆçš„å¯¹è¯ç¤ºä¾‹ï¼ˆSystem prompt ä¸ User promptï¼‰ä»¥åŠæ¨¡å‹å¦‚ä½•å°†<strong>æ¨ç†</strong>ï¼ˆreasoningï¼‰æ”¾åœ¨ <code>&lt;think&gt;</code> æ ‡ç­¾å†…ã€å°†<strong>ç­”æ¡ˆ</strong>ï¼ˆanswerï¼‰æ”¾åœ¨ <code>&lt;answer&gt;</code> æ ‡ç­¾å†…ã€‚è¯¥å›¾çªå‡ºå±•ç¤ºäº†åœ¨æç¤ºï¼ˆpromptï¼‰ä¸­å¯¹æ¨¡å‹çš„çº¦æŸï¼š</p><ul><li><em>â€œThe assistant first thinks about the reasoning process in the mind and then provides the user with the answer.â€</em></li><li>è¦æ±‚ä½¿ç”¨ <code>&lt;think&gt;</code> è¿›è¡Œæ¨ç†ï¼Œä½¿ç”¨ <code>&lt;answer&gt;</code> è¿›è¡Œå›ç­”ã€‚</li></ul><p>è¿™é‡Œå¹¶æœªæä¾›å…³äºâ€œæ¨ç†è¿‡ç¨‹â€æ ¼å¼çš„å…¶ä»–ä¾‹å­æˆ–æ¨¡æ¿â€”â€”å®Œå…¨ç”±æ¨¡å‹è‡ªå·±åœ¨è®­ç»ƒä¸­æ‘¸ç´¢å‡ºè¦å¦‚ä½•è¾“å‡ºâ€œChain-of-Thoughtâ€å¼çš„æ¨ç†æ–‡å­—ã€‚</p><h4 id="å¼ºåŒ–å­¦ä¹ å¥–åŠ±"><a href="#å¼ºåŒ–å­¦ä¹ å¥–åŠ±" class="headerlink" title="å¼ºåŒ–å­¦ä¹ å¥–åŠ±"></a>å¼ºåŒ–å­¦ä¹ å¥–åŠ±</h4><p>åœ¨è®­ç»ƒä¸­ï¼Œé‡‡ç”¨äº†ä¸¤ä¸ªåŸºäºè§„åˆ™ï¼ˆrule-basedï¼‰çš„å¥–åŠ±æœºåˆ¶ï¼š</p><ol><li><strong>å‡†ç¡®æ€§å¥–åŠ±ï¼ˆAccuracy rewardsï¼‰</strong><br>é€šè¿‡æµ‹è¯•ç»™å‡ºçš„ç­”æ¡ˆæ˜¯å¦æ­£ç¡®æ¥è¿›è¡Œå¥–åŠ±ã€‚è‹¥æ¨¡å‹è¾“å‡ºçš„ç­”æ¡ˆæ­£ç¡®ï¼Œå°±ä¼šå¢åŠ å¥–åŠ±ã€‚</li><li><strong>æ ¼å¼å¥–åŠ±ï¼ˆFormat rewardsï¼‰</strong><br>å¥–åŠ±æ¨¡å‹å¯¹ <code>&lt;think&gt;</code> å’Œ <code>&lt;answer&gt;</code> æ ‡ç­¾çš„æ­£ç¡®ä½¿ç”¨ã€‚</li></ol><p>ä»–ä»¬æ‰€ä½¿ç”¨çš„å¼ºåŒ–å­¦ä¹ ç®—æ³•åä¸º <strong>Group Relative Policy Optimizationï¼ˆGRPOï¼‰</strong>ã€‚æ­¤ç®—æ³•çš„ç›´è§‚æƒ³æ³•åœ¨äºï¼šä½¿æ‰€æœ‰å¯¼è‡´æ­£ç¡®æˆ–é”™è¯¯ç­”æ¡ˆçš„å†³ç­–æ›´æ˜“æˆ–æ›´éš¾å†æ¬¡å‡ºç°ã€‚è¿™äº›å†³ç­–å¯èƒ½åŒ…æ‹¬æ¨¡å‹ç”Ÿæˆçš„æŸäº›æ ‡è®°ï¼ˆtokenï¼‰åºåˆ—ï¼Œä¹Ÿå¯èƒ½åŒ…æ‹¬æ¨ç†æ­¥éª¤æœ¬èº«ï¼ˆå³æ€è€ƒè¿‡ç¨‹ï¼‰ã€‚ä¸‹æ–‡ç»™å‡ºäº†è¿™ä¸€è®­ç»ƒé˜¶æ®µçš„ç¤ºæ„å›¾ã€‚</p><img src="/2025/02/11/NLP%20Insights/%E6%8E%A8%E7%90%86%20LLM%20%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%8D%97%EF%BC%9A%E6%8E%A2%E7%B4%A2%E6%8E%A8%E7%90%86%E6%97%B6%E8%AE%A1%E7%AE%97%E6%8A%80%E6%9C%AF%E4%B8%8E%20DeepSeek-R1/20250211_183402.png" class=""><p>åœ¨å›¾ä¸­ï¼Œé‡ç‚¹å±•ç¤ºäº†åœ¨ RLï¼ˆå¼ºåŒ–å­¦ä¹ ï¼‰è¿‡ç¨‹ä¸­æ‰€ä½¿ç”¨çš„ä¸¤ç±»å¥–åŠ±ï¼š</p><ul><li>â€œis <code>&lt;think&gt;</code> used?â€ â€”â€” ä¸ºä½¿ç”¨ <code>&lt;think&gt;</code> æ ‡ç­¾è€Œæ‰“åˆ†ã€‚</li><li>â€œis <code>&lt;answer&gt;</code> used?â€ â€”â€” ä¸ºä½¿ç”¨ <code>&lt;answer&gt;</code> æ ‡ç­¾è€Œæ‰“åˆ†ã€‚</li></ul><p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰å¯¹ç­”æ¡ˆ<strong>æ­£ç¡®æ€§</strong>çš„å¥–åŠ±ï¼ˆaccuracy rewardï¼‰ã€‚å›¾ä¸­ç®­å¤´æ‰€ç¤ºçš„å¾ªç¯ä»£è¡¨äº†åœ¨è®­ç»ƒä¸­ä¸æ–­è¿­ä»£æ›´æ–°æ¨¡å‹ï¼Œä½¿ä¹‹è¶Šæ¥è¶Šå€¾å‘äºæ­£ç¡®çš„æ¨ç†æ–¹å¼å¹¶åˆä¹æ ¼å¼è¦æ±‚ã€‚</p><h4 id="è‡ªå‘æ¨ç†è¡Œä¸ºçš„å‡ºç°"><a href="#è‡ªå‘æ¨ç†è¡Œä¸ºçš„å‡ºç°" class="headerlink" title="è‡ªå‘æ¨ç†è¡Œä¸ºçš„å‡ºç°"></a>è‡ªå‘æ¨ç†è¡Œä¸ºçš„å‡ºç°</h4><p>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œç ”ç©¶äººå‘˜å¹¶æ²¡æœ‰å‘æ¨¡å‹æä¾›ä»»ä½•ç¤ºä¾‹æ¥å‘Šè¯‰å®ƒ <code>&lt;think&gt;</code> æ ‡ç­¾ä¸­çš„å†…å®¹åº”è¯¥å¦‚ä½•ä¹¦å†™æˆ–å±•å¼€ã€‚ä»–ä»¬ä»…ä»…å‘Šè¯‰æ¨¡å‹ï¼š</p><blockquote><p>â€œIt should use <code>&lt;think&gt;</code> tags, and nothing more!â€</p></blockquote><p>é€šè¿‡å¯¹â€œChain-of-Thoughtâ€ç›¸å…³è¡Œä¸ºè¿›è¡Œ<strong>é—´æ¥å¥–åŠ±</strong>ï¼ˆå³åªè¦æ¨ç†æ­£ç¡®ã€ä½¿ç”¨æ­£ç¡®æ ¼å¼ï¼Œå°±é¼“åŠ±è¾“å‡ºæ›´å®Œæ•´çš„æ¨ç†å†…å®¹ï¼‰ï¼Œæ¨¡å‹åœ¨è®­ç»ƒä¸­è‡ªå‘åœ°å­¦ä¼šäº†è¶Šå†™è¶Šé•¿çš„æ¨ç†è¿‡ç¨‹ï¼Œä¹Ÿæ›´æ˜“äº§ç”Ÿæ­£ç¡®ç­”æ¡ˆã€‚</p><img src="/2025/02/11/NLP%20Insights/%E6%8E%A8%E7%90%86%20LLM%20%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%8D%97%EF%BC%9A%E6%8E%A2%E7%B4%A2%E6%8E%A8%E7%90%86%E6%97%B6%E8%AE%A1%E7%AE%97%E6%8A%80%E6%9C%AF%E4%B8%8E%20DeepSeek-R1/20250211_183551.png" class=""><p>ä¸Šå›¾å‘ˆç°äº†æ¨¡å‹åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­è¾“å‡ºçš„æ¨ç†é•¿åº¦éšè®­ç»ƒæ­¥æ•°å¢åŠ è€Œé€æ¸å˜é•¿çš„è¶‹åŠ¿ã€‚çºµè½´æ˜¯æ¯ä¸ªå“åº”çš„å¹³å‡é•¿åº¦ï¼Œæ¨ªè½´æ˜¯è®­ç»ƒæ­¥æ•°ã€‚å¯ä»¥çœ‹åˆ°ï¼Œæ›²çº¿æ•´ä½“æ˜¯å‘ä¸Šæ”€å‡çš„ï¼Œè¿™è¡¨æ˜æ¨¡å‹ä¸æ–­å€¾å‘äºè¾“å‡ºæ›´é•¿ã€æ›´è¯¦ç»†çš„æ€è€ƒå†…å®¹ï¼ˆChain-of-Thoughtï¼‰ï¼Œå¹¶å› æ­¤è·å¾—æ›´é«˜å¥–åŠ±ã€‚è¿™ç§åšæ³•å°†å¤§éƒ¨åˆ†è®¡ç®—æ¶ˆè€—ä»è®­ç»ƒé˜¶æ®µï¼ˆtrain-time computeï¼‰è½¬ç§»åˆ°äº†æ¨ç†é˜¶æ®µï¼ˆtest-time computeï¼‰ï¼Œä¹Ÿå°±æ˜¯åœ¨æ¨ç†æ—¶æ‰ç”Ÿæˆæ›´é•¿çš„æ€è€ƒè¿‡ç¨‹ã€‚</p><p>æ ¹æ®ç ”ç©¶ï¼Œä»–ä»¬å‘ç°é€šè¿‡è¿™ç§è®­ç»ƒç­–ç•¥ï¼Œæ¨¡å‹èƒ½å¤Ÿè‡ªè¡Œå‘ç°æœ€ä¼˜çš„ Chain-of-Thought é£æ ¼çš„æ€è€ƒæ–¹å¼ï¼Œå¹¶å±•ç°å‡ºé«˜çº§çš„æ¨ç†èƒ½åŠ›ï¼Œä¾‹å¦‚ï¼š<strong>è‡ªæˆ‘åæ€ï¼ˆself-reflectionï¼‰</strong> å’Œ <strong>è‡ªæˆ‘éªŒè¯ï¼ˆself-verificationï¼‰</strong>ã€‚</p><p>ä¸è¿‡ï¼ŒDeepSeek-R1 Zero çš„æ¨¡å‹è¾“å‡ºä»å­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚å¯è¯»æ€§æ¬ ä½³ï¼Œä¸”æœ‰æ—¶ä¼šæ··ç”¨å¤šç§è¯­è¨€ã€‚ä¸ºäº†åœ¨äº§å“åŒ–æˆ–å‘å¸ƒçº§åˆ«è¿›ä¸€æ­¥å®Œå–„ï¼Œç ”ç©¶äººå‘˜æå‡ºäº†å¦ä¸€ä¸ªé€‰é¡¹ï¼Œä¹Ÿå°±æ˜¯åœ¨æ­£å¼ç‰ˆæœ¬ä¸­ä½¿ç”¨çš„ <strong>DeepSeek R1</strong>ã€‚</p><hr><h3 id="3-æ·±å…¥äº†è§£-DeepSeek-R1"><a href="#3-æ·±å…¥äº†è§£-DeepSeek-R1" class="headerlink" title="3. æ·±å…¥äº†è§£ DeepSeek-R1"></a>3. æ·±å…¥äº†è§£ DeepSeek-R1</h3><p>è¦æ„å»º <strong>DeepSeek-R1</strong>ï¼Œä½œè€…å…±è¿›è¡Œäº†ä»¥ä¸‹äº”ä¸ªå…³é”®æ­¥éª¤ï¼š</p><ol><li><strong>å†·å¯åŠ¨ï¼ˆCold Startï¼‰</strong></li><li><strong>ä»¥æ¨ç†ä¸ºå¯¼å‘çš„å¼ºåŒ–å­¦ä¹ ï¼ˆReasoning-oriented Reinforcement Learningï¼‰</strong></li><li><strong>æ‹’ç»é‡‡æ ·ï¼ˆRejection Samplingï¼‰</strong></li><li><strong>ç›‘ç£å¾®è°ƒï¼ˆSupervised Fine-Tuningï¼‰</strong></li><li><strong>åœ¨æ‰€æœ‰åœºæ™¯ä¸‹è¿›è¡Œå¼ºåŒ–å­¦ä¹ ï¼ˆReinforcement Learning for all Scenariosï¼‰</strong></li></ol><p>æ¥ä¸‹æ¥æˆ‘ä»¬ä¾æ¬¡å±•å¼€è¯´æ˜ã€‚</p><hr><h4 id="ç¬¬ä¸€æ­¥ï¼šå†·å¯åŠ¨"><a href="#ç¬¬ä¸€æ­¥ï¼šå†·å¯åŠ¨" class="headerlink" title="ç¬¬ä¸€æ­¥ï¼šå†·å¯åŠ¨"></a>ç¬¬ä¸€æ­¥ï¼šå†·å¯åŠ¨</h4><p>åœ¨ç¬¬ä¸€æ­¥ä¸­ï¼Œç ”ç©¶äººå‘˜å…ˆä½¿ç”¨äº†ä¸€ä¸ªçº¦ 5000 ä¸ªtokensçš„é«˜è´¨é‡æ¨ç†æ•°æ®é›†å¯¹ <strong>DeepSeek-V3-Base</strong> è¿›è¡Œå¾®è°ƒï¼Œä»¥é¿å…äº§ç”Ÿå¯è¯»æ€§ä¸ä½³çš„<strong>å†·å¯åŠ¨é—®é¢˜ï¼ˆcold start problemï¼‰</strong>ã€‚è¿™ä¸ªå¾®è°ƒæ­¥éª¤å¯ä»¥è®©æ¨¡å‹çš„è¾“å‡ºæ›´åŠ å¯è¯»ï¼Œä¸è‡³äºåœ¨ä¸€å¼€å§‹å°±äº§ç”Ÿæ··ä¹±çš„æ¨ç†æ–‡æœ¬ã€‚ä¸‹æ–‡å±•ç¤ºäº†è¿™ä¸€è¿‡ç¨‹çš„ç¤ºæ„å›¾ã€‚</p><hr><img src="/2025/02/11/NLP%20Insights/%E6%8E%A8%E7%90%86%20LLM%20%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%8D%97%EF%BC%9A%E6%8E%A2%E7%B4%A2%E6%8E%A8%E7%90%86%E6%97%B6%E8%AE%A1%E7%AE%97%E6%8A%80%E6%9C%AF%E4%B8%8E%20DeepSeek-R1/20250211_184058.png" class=""><p>åœ¨å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼š</p><ul><li>â€œDeepSeek-V3-Baseâ€ é€šè¿‡<strong>ç›‘ç£å¾®è°ƒï¼ˆSupervised Fine-Tuningï¼‰</strong>çš„æ–¹å¼ï¼Œå¼•å…¥äº†çº¦ 5000 æ¡é«˜è´¨é‡æ¨ç†æ ·æœ¬ã€‚</li><li>è¿™äº›æ ·æœ¬åŒ…å«äº†<strong>Reasoning</strong>ï¼ˆæ¨ç†ï¼‰å’Œ<strong>Answer</strong>ï¼ˆç­”æ¡ˆï¼‰ä¸¤ç§éƒ¨åˆ†ã€‚</li><li>è¯¥æ­¥éª¤ç›®çš„æ˜¯â€œé˜²æ­¢å†·å¯åŠ¨â€ï¼Œå³è®©æ¨¡å‹åœ¨ä¸€å¼€å§‹å°±æŒæ¡åŸºç¡€çš„å¯è¯»æ€§æ¨ç†ã€‚</li></ul><hr><h4 id="ç¬¬äºŒæ­¥ï¼šæ¨ç†å¯¼å‘çš„å¼ºåŒ–å­¦ä¹ "><a href="#ç¬¬äºŒæ­¥ï¼šæ¨ç†å¯¼å‘çš„å¼ºåŒ–å­¦ä¹ " class="headerlink" title="ç¬¬äºŒæ­¥ï¼šæ¨ç†å¯¼å‘çš„å¼ºåŒ–å­¦ä¹ "></a>ç¬¬äºŒæ­¥ï¼šæ¨ç†å¯¼å‘çš„å¼ºåŒ–å­¦ä¹ </h4><p>åœ¨å¾—åˆ°ä¸€ä¸ªåˆæ­¥å¾®è°ƒåçš„æ¨¡å‹åï¼ˆä¸Šä¸€æ­¥çš„æˆæœï¼‰ï¼Œä½œè€…ä½¿ç”¨ä¸ <strong>DeepSeek-V3-Zero</strong> ç±»ä¼¼çš„å¼ºåŒ–å­¦ä¹ æµç¨‹å¯¹æ¨¡å‹è¿›è¡Œè®­ç»ƒï¼Œä½†é¢å¤–åŠ å…¥äº†<strong>ç›®æ ‡è¯­è¨€ä¸€è‡´æ€§</strong>çš„å¥–åŠ±ï¼Œä»¥ç¡®ä¿æ¨¡å‹åœ¨æ¨ç†å’Œå›ç­”æ—¶ä¸ä¼šæ··ç”¨å¤šç§è¯­è¨€ã€‚</p><p>é™¤äº†ä¹‹å‰æåˆ°çš„å‡†ç¡®æ€§ï¼ˆaccuracy rewardï¼‰å’Œæ ¼å¼ï¼ˆformat rewardï¼‰ç­‰ï¼Œè¿˜å¢åŠ äº†<strong>è¯­è¨€å¥–åŠ±ï¼ˆlanguage rewardï¼‰</strong>æ¥ä¿è¯ç”Ÿæˆçš„è¯­è¨€é£æ ¼æˆ–è¯­è¨€ç±»å‹ä¿æŒä¸€è‡´ï¼Œä¸è‡³äºå‡ºç°â€œä¸­è‹±æ–‡æ··æ‚â€æˆ–â€œé£æ ¼ä¸ç¨³â€çš„ç°è±¡ã€‚</p><img src="/2025/02/11/NLP%20Insights/%E6%8E%A8%E7%90%86%20LLM%20%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%8D%97%EF%BC%9A%E6%8E%A2%E7%B4%A2%E6%8E%A8%E7%90%86%E6%97%B6%E8%AE%A1%E7%AE%97%E6%8A%80%E6%9C%AF%E4%B8%8E%20DeepSeek-R1/20250211_184229.png" class=""><ul><li><strong>Format reward</strong>ï¼šä¾æ—§å…³æ³¨ <code>&lt;think&gt;</code> å’Œ <code>&lt;answer&gt;</code> çš„ä½¿ç”¨ã€‚</li><li><strong>Accuracy reward</strong>ï¼šæ£€æŸ¥ç­”æ¡ˆæ˜¯å¦æ­£ç¡®ï¼Œä»¥åŠæ˜¯å¦èƒ½é€šè¿‡ç›¸åº”çš„â€œå•å…ƒæµ‹è¯•â€ã€‚</li><li><strong>Language reward</strong>ï¼šæ£€æŸ¥è¯­è¨€æ˜¯å¦ä¸€è‡´ã€é€šé¡ºä»¥åŠæ˜¯å¦ç¬¦åˆç›®æ ‡è¯­è¨€è¦æ±‚ã€‚</li></ul><p>è¿™äº›å¥–åŠ±ç»¼åˆèµ·æ¥ï¼Œé€šè¿‡å¼ºåŒ–å­¦ä¹ ï¼ˆRLï¼‰å¾ªç¯ä½¿æ¨¡å‹çš„æ¨ç†å’Œç­”æ¡ˆåœ¨å¯è¯»æ€§ã€å‡†ç¡®åº¦å’Œè¯­è¨€é£æ ¼æ–¹é¢é€æ¸ä¼˜åŒ–ã€‚</p><hr><h4 id="ç¬¬ä¸‰æ­¥ï¼šæ‹’ç»é‡‡æ ·"><a href="#ç¬¬ä¸‰æ­¥ï¼šæ‹’ç»é‡‡æ ·" class="headerlink" title="ç¬¬ä¸‰æ­¥ï¼šæ‹’ç»é‡‡æ ·"></a>ç¬¬ä¸‰æ­¥ï¼šæ‹’ç»é‡‡æ ·</h4><p>åœ¨è¿™ä¸€é˜¶æ®µï¼Œä½œè€…ç”¨<strong>ç¬¬ 2 æ­¥</strong>å¼ºåŒ–å­¦ä¹ åå¾—åˆ°çš„æ¨¡å‹ï¼Œæ¥å¤§è§„æ¨¡ç”Ÿæˆ<strong>åˆæˆæ¨ç†æ•°æ®</strong>ï¼Œå¹¶é…åˆ <strong>DeepSeek-V3-Base</strong> æ¨¡å‹æ¥è¿›è¡Œâ€œè¯„ä¼°â€å’Œâ€œè§„åˆ™è¿‡æ»¤â€ï¼Œæœ€ç»ˆäº§ç”Ÿçº¦ 60 ä¸‡æ¡é«˜è´¨é‡çš„æ¨ç†æ ·æœ¬å¯ç”¨äºåç»­ç›‘ç£å¾®è°ƒã€‚åŒæ—¶ï¼Œä»–ä»¬è¿˜å¦å¤–ç”Ÿæˆäº†çº¦ 20 ä¸‡æ¡<strong>éæ¨ç†æ ·æœ¬</strong>ï¼ŒåŒ…å«äº†å†™ä½œã€ç®€å•é—®ç­”ã€è‡ªæˆ‘è®¤çŸ¥ã€ç¿»è¯‘ç­‰å¤šç§ä»»åŠ¡æ•°æ®ã€‚ä¸‹æ–‡æ€»ç»“äº†è¿™ä¸€è¿‡ç¨‹ã€‚</p><img src="/2025/02/11/NLP%20Insights/%E6%8E%A8%E7%90%86%20LLM%20%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%8D%97%EF%BC%9A%E6%8E%A2%E7%B4%A2%E6%8E%A8%E7%90%86%E6%97%B6%E8%AE%A1%E7%AE%97%E6%8A%80%E6%9C%AF%E4%B8%8E%20DeepSeek-R1/20250211_184407.png" class=""><ul><li>å·¦è¾¹å±•ç¤ºäº†<strong>DeepSeek-V3-2</strong> å¦‚ä½•é‡‡æ ·åˆ°å¤§é‡<strong>Reasoning</strong>ï¼ˆæ¨ç†ï¼‰å’Œ<strong>Answer</strong>ï¼ˆç­”æ¡ˆï¼‰ï¼Œå†åˆ©ç”¨åŸºäºè§„åˆ™çš„ç­›é€‰å’Œ <strong>DeepSeek-V3-Base</strong> çš„åˆ¤æ–­ï¼ˆåˆ¤æ–­ç”Ÿæˆçš„å†…å®¹è´¨é‡ï¼‰ï¼Œä¿ç•™è´¨é‡æ›´å¥½çš„æ¨ç†æ•°æ®ï¼ˆçº¦ 600,000 æ¡ï¼‰ã€‚</li><li>å³è¾¹å±•ç¤ºäº†<strong>éæ¨ç†</strong>ï¼ˆnon-reasoningï¼‰æ•°æ®é‡‡æ ·æµç¨‹ï¼Œæ¥è‡ª DeepSeek-V3-Base æ‰€ä½¿ç”¨çš„ä¸€éƒ¨åˆ†æ•°æ®ï¼Œæ€»å…±çº¦ 200,000 æ¡ï¼Œè¿™äº›æ•°æ®ä¸»è¦æ¶‰åŠå†™ä½œã€äº‹å®æ€§é—®ç­”ï¼ˆfactual QAï¼‰ã€è‡ªæˆ‘è®¤çŸ¥ã€ç¿»è¯‘ç­‰æ–¹é¢ã€‚</li></ul><p>ç”±æ­¤ï¼Œç ”ç©¶äººå‘˜å¾—åˆ°è§„æ¨¡çº¦ 80 ä¸‡æ¡çš„â€œæ··åˆâ€æ•°æ®ï¼Œå…¶ä¸­æ—¢æœ‰æ¨ç†æ ·æœ¬ï¼Œä¹Ÿæœ‰éæ¨ç†æ ·æœ¬ã€‚</p><hr><h4 id="ç¬¬å››æ­¥ï¼šç›‘ç£å¾®è°ƒ"><a href="#ç¬¬å››æ­¥ï¼šç›‘ç£å¾®è°ƒ" class="headerlink" title="ç¬¬å››æ­¥ï¼šç›‘ç£å¾®è°ƒ"></a>ç¬¬å››æ­¥ï¼šç›‘ç£å¾®è°ƒ</h4><p>åœ¨å¾—åˆ°ä¸Šè¿° 80 ä¸‡æ¡æ•°æ®åï¼Œç ”ç©¶äººå‘˜å†æ¬¡å¯¹ <strong>DeepSeek-V3-Base</strong> è¿›è¡Œç›‘ç£å¾®è°ƒï¼Œå…·ä½“è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><img src="/2025/02/11/NLP%20Insights/%E6%8E%A8%E7%90%86%20LLM%20%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%8D%97%EF%BC%9A%E6%8E%A2%E7%B4%A2%E6%8E%A8%E7%90%86%E6%97%B6%E8%AE%A1%E7%AE%97%E6%8A%80%E6%9C%AF%E4%B8%8E%20DeepSeek-R1/20250211_184526.png" class=""><ul><li>åœ¨å›¾ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°â€œDeepSeek-V3-Baseâ€è¢«ç”¨äºæ‰§è¡Œ<strong>ç›‘ç£å¾®è°ƒï¼ˆSupervised Fine-Tuningï¼‰</strong>ï¼Œä½¿ç”¨çš„æ­£æ˜¯å‰æ–‡æ‰€æåˆ°çš„ 800,000 æ¡<strong>é«˜è´¨é‡æ¨ç†ä¸éæ¨ç†æ ·æœ¬</strong>ã€‚</li><li>è¿™ä¸€é˜¶æ®µä½¿å¾—æ¨¡å‹åœ¨æ›´å¤§è§„æ¨¡çš„æ•°æ®åŸºç¡€ä¸Šï¼Œå­¦ä¹ åˆ°æ›´å¹¿æ³›ã€æ›´å¤šæ ·çš„æ¨ç†å½¢å¼å’Œä»»åŠ¡å½¢å¼ã€‚</li></ul><hr><h4 id="ç¬¬äº”æ­¥ï¼šåœ¨æ‰€æœ‰åœºæ™¯ä¸‹çš„å¼ºåŒ–å­¦ä¹ "><a href="#ç¬¬äº”æ­¥ï¼šåœ¨æ‰€æœ‰åœºæ™¯ä¸‹çš„å¼ºåŒ–å­¦ä¹ " class="headerlink" title="ç¬¬äº”æ­¥ï¼šåœ¨æ‰€æœ‰åœºæ™¯ä¸‹çš„å¼ºåŒ–å­¦ä¹ "></a>ç¬¬äº”æ­¥ï¼šåœ¨æ‰€æœ‰åœºæ™¯ä¸‹çš„å¼ºåŒ–å­¦ä¹ </h4><p>åœ¨ç›‘ç£å¾®è°ƒå®Œæˆåï¼Œç ”ç©¶äººå‘˜ç»§ç»­é‡‡ç”¨ç±»ä¼¼ <strong>DeepSeek-R1-Zero</strong> çš„æ–¹æ³•è¿›è¡Œ <strong>RLï¼ˆå¼ºåŒ–å­¦ä¹ ï¼‰</strong> è®­ç»ƒã€‚ä½†æ˜¯ï¼Œä¸ºäº†è®©æ¨¡å‹æ›´ç¬¦åˆäººç±»åå¥½ï¼Œä»–ä»¬åœ¨è¿™ä¸ªé˜¶æ®µå¼•å…¥äº†æ›´å¤šçš„ <strong>â€œæœ‰ç›Šä¸æ— å®³â€ï¼ˆhelpfulness and harmlessnessï¼‰</strong> å¥–åŠ±ä¿¡å·ï¼Œç”¨æ¥çº¦æŸæ¨¡å‹çš„å›ç­”ã€‚</p><p>åŒæ—¶ï¼Œæ¨¡å‹ä¹Ÿè¢«è¦æ±‚<strong>å¯¹æ¨ç†è¿‡ç¨‹è¿›è¡Œæ€»ç»“ï¼ˆsummarizeï¼‰</strong>ï¼Œä»¥é˜²æ­¢åœ¨æœ€ç»ˆè¾“å‡ºæ—¶æ˜¾ç¤ºå‡ºè¿‡é•¿ã€éš¾ä»¥é˜…è¯»çš„æ¨ç†æ–‡æœ¬ã€‚è¿™ä¸€æ­¥éª¤è§£å†³äº†å‰è¿°æåˆ°çš„å¯è¯»æ€§é—®é¢˜ã€‚</p><img src="/2025/02/11/NLP%20Insights/%E6%8E%A8%E7%90%86%20LLM%20%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%8D%97%EF%BC%9A%E6%8E%A2%E7%B4%A2%E6%8E%A8%E7%90%86%E6%97%B6%E8%AE%A1%E7%AE%97%E6%8A%80%E6%9C%AF%E4%B8%8E%20DeepSeek-R1/20250211_184907.png" class=""><ol><li><strong>Format rewardï¼ˆæ ¼å¼å¥–åŠ±ï¼‰</strong>  <ul><li>æ˜¯å¦æ­£ç¡®ä½¿ç”¨ <code>&lt;think&gt;</code> æ ‡ç­¾ä¹¦å†™æ¨ç†å†…å®¹  </li><li>æ˜¯å¦æ­£ç¡®ä½¿ç”¨ <code>&lt;answer&gt;</code> æ ‡ç­¾è¾“å‡ºç­”æ¡ˆ</li></ul></li><li><strong>Accuracy rewardï¼ˆå‡†ç¡®æ€§å¥–åŠ±ï¼‰</strong>  <ul><li>æµ‹è¯•è¾“å‡ºæ˜¯å¦èƒ½ç¼–è¯‘ï¼ˆâ€œdoes it compile?â€ï¼‰  </li><li>æ˜¯å¦èƒ½é€šè¿‡å•å…ƒæµ‹è¯•ï¼ˆâ€œdoes it pass unit tests?â€ï¼‰</li></ul></li><li><strong>Preference rewardsï¼ˆåå¥½å¥–åŠ±ï¼‰</strong>  <ul><li>å…³æ³¨ <strong>Helpfulnessï¼ˆæœ‰ç›Šï¼‰</strong>ã€<strong>Harmlessnessï¼ˆæ— å®³ï¼‰</strong>ã€<strong>Human preferenceï¼ˆäººç±»åå¥½ï¼‰</strong> ç­‰  </li><li>ç”± RMï¼ˆReward Modelï¼‰ æ¨¡å—æ¥è¯„ä¼°è¿™äº›åå¥½æŒ‡æ ‡</li></ul></li></ol><p>å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œ<strong>Reasoning</strong>ï¼ˆæ¨ç†ï¼‰é˜¶æ®µå’Œ <strong>Answer</strong>ï¼ˆç­”æ¡ˆï¼‰é˜¶æ®µéœ€è¦åˆ†åˆ«ç”¨ <code>&lt;think&gt;</code> å’Œ <code>&lt;answer&gt;</code> æ ‡ç­¾è¿›è¡Œæ˜ç¡®åŒºåˆ†ã€‚åŒæ—¶ï¼Œä¸ºäº†è¾“å‡ºæ›´ä¸ºç²¾ç®€ã€å¯è¯»çš„å†…å®¹ï¼Œæ¨¡å‹ä¹Ÿå¯èƒ½äº§ç”Ÿä¸€ä¸ª <strong>Summary</strong>ï¼ˆæ€»ç»“ï¼‰ç‰‡æ®µã€‚å¼ºåŒ–å­¦ä¹ çš„è¿­ä»£è¿‡ç¨‹ä¼šåŒæ—¶è€ƒè™‘å¤šç§å¥–åŠ±ä¿¡å·ï¼Œä»è€Œä¸æ–­æ›´æ–°æ¨¡å‹å¹¶å¾—åˆ°æœ€ç»ˆç‰ˆæœ¬çš„ <strong>DeepSeek-R1</strong>ã€‚</p><p>ä¸Šå›¾ä¸­ï¼Œâ€œRMâ€ å³ Reward Modelï¼Œç”¨äºå¯¹åå¥½è¿›è¡Œæ‰“åˆ†ï¼ˆå¦‚å¯¹è¯æ˜¯å¦å‹å–„ã€æ˜¯å¦ç¬¦åˆä¼¦ç†è¦æ±‚ç­‰ï¼‰ï¼Œå†æŠŠç»“æœåé¦ˆç»™æ¨¡å‹ã€‚</p><p>â€œ<strong>And thatâ€™s it!<strong>â€è¿™æ„å‘³ç€ <strong>DeepSeek-R1</strong> å®é™…ä¸Šæ˜¯ <strong>DeepSeek-V3-Base</strong> ç»è¿‡ç›‘ç£å¾®è°ƒï¼ˆSupervised Fine-Tuningï¼‰å’Œå¼ºåŒ–å­¦ä¹ ï¼ˆRLï¼‰è¿›ä¸€æ­¥ä¼˜åŒ–è€Œæˆã€‚å¤§é‡çš„å·¥ä½œéƒ½ç”¨äºä¿è¯</strong>é«˜è´¨é‡æ•°æ®</strong>çš„ç”Ÿæˆä¸ä½¿ç”¨ï¼Œè¿›è€Œè®­ç»ƒå‡ºè¿™æ ·ä¸€ä¸ªå…·å¤‡å¼ºå¤§æ¨ç†èƒ½åŠ›çš„æ¨¡å‹ã€‚</p><hr><h2 id="å°†æ¨ç†çŸ¥è¯†ä»-DeepSeek-R1-è’¸é¦åˆ°å…¶ä»–æ¨¡å‹"><a href="#å°†æ¨ç†çŸ¥è¯†ä»-DeepSeek-R1-è’¸é¦åˆ°å…¶ä»–æ¨¡å‹" class="headerlink" title="å°†æ¨ç†çŸ¥è¯†ä» DeepSeek-R1 è’¸é¦åˆ°å…¶ä»–æ¨¡å‹"></a>å°†æ¨ç†çŸ¥è¯†ä» DeepSeek-R1 è’¸é¦åˆ°å…¶ä»–æ¨¡å‹</h2><p><strong>DeepSeek-R1</strong> æ‹¥æœ‰ <strong>6710 äº¿ï¼ˆ671Bï¼‰</strong> å‚æ•°ã€‚è¿™ä¸€è§„æ¨¡çš„æ¨¡å‹åœ¨æ™®é€šæ¶ˆè´¹çº§ç¡¬ä»¶ä¸Šè¿è¡Œå­˜åœ¨è¾ƒå¤§éš¾åº¦ã€‚å‡ºäºå®ç”¨æ€§è€ƒè™‘ï¼Œä½œè€…ä»¬ç ”ç©¶äº†å¦‚ä½•å°† <strong>DeepSeek-R1</strong> çš„æ¨ç†èƒ½åŠ›â€œè’¸é¦ï¼ˆdistillï¼‰â€åˆ°æ›´å°çš„æ¨¡å‹ï¼ˆå¦‚ <strong>Qwen-32B</strong>ï¼‰ä¸Šï¼Œä»¥ä¾¿èƒ½åœ¨æ¶ˆè´¹çº§ç¡¬ä»¶ä¸Šéƒ¨ç½²å’Œä½¿ç”¨ã€‚</p><h3 id="è’¸é¦è¿‡ç¨‹ï¼šTeacher-Student-æ¡†æ¶"><a href="#è’¸é¦è¿‡ç¨‹ï¼šTeacher-Student-æ¡†æ¶" class="headerlink" title="è’¸é¦è¿‡ç¨‹ï¼šTeacher-Student æ¡†æ¶"></a>è’¸é¦è¿‡ç¨‹ï¼šTeacher-Student æ¡†æ¶</h3><p>åœ¨è’¸é¦è¿‡ç¨‹ä¸­ï¼Œ<strong>DeepSeek-R1</strong> ä½œä¸ºæ•™å¸ˆæ¨¡å‹ï¼ˆTeacherï¼‰ï¼Œè€Œè§„æ¨¡æ›´å°çš„æ¨¡å‹ï¼ˆå¦‚ Qwen-32Bï¼‰ä½œä¸ºå­¦ç”Ÿæ¨¡å‹ï¼ˆStudentï¼‰ã€‚äºŒè€…é¢å¯¹ç›¸åŒçš„æç¤ºï¼ˆpromptï¼‰æ—¶ï¼Œåˆ†åˆ«ä¼šè¾“å‡ºä¸€ç»„<strong>è¯å…ƒæ¦‚ç‡åˆ†å¸ƒï¼ˆtoken probability distributionï¼‰</strong>ã€‚è®­ç»ƒæ—¶ï¼Œå­¦ç”Ÿæ¨¡å‹ä¼šå°½é‡å­¦ä¹ å¹¶æ¥è¿‘æ•™å¸ˆæ¨¡å‹çš„è¾“å‡ºåˆ†å¸ƒã€‚</p><img src="/2025/02/11/NLP%20Insights/%E6%8E%A8%E7%90%86%20LLM%20%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%8D%97%EF%BC%9A%E6%8E%A2%E7%B4%A2%E6%8E%A8%E7%90%86%E6%97%B6%E8%AE%A1%E7%AE%97%E6%8A%80%E6%9C%AF%E4%B8%8E%20DeepSeek-R1/20250211_185245.png" class=""><ul><li>æ•™å¸ˆï¼ˆDeepSeek-R1ï¼‰ç»™å‡ºè‡ªå·±çš„â€œproposal distributionâ€ã€‚ä¾‹å¦‚åœ¨å›ç­”â€œWhat is 3 + 2?â€æ—¶ï¼Œæ•™å¸ˆæ¨¡å‹å¯èƒ½å€¾å‘è¾“å‡ºâ€œAddingâ€â€œIfâ€â€œ5â€â€œ3â€â€œ4â€ç­‰æ ‡è®°ï¼Œå¹¶èµ‹äºˆå„è‡ªä¸åŒçš„æ¦‚ç‡ã€‚  </li><li>å­¦ç”Ÿï¼ˆQwen-32Bï¼‰åˆ™ä¼šåœ¨è®­ç»ƒä¸­ä¸æ–­æ›´æ–°è‡ªå·±çš„æ¦‚ç‡åˆ†å¸ƒï¼Œä½¿ä¹‹æ›´æ¥è¿‘æ•™å¸ˆçš„åˆ†å¸ƒã€‚</li></ul><blockquote><p><strong>é¢å¤–è§£é‡Š</strong>ï¼š  </p><ol><li><strong>æ¦‚ç‡åˆ†å¸ƒï¼ˆproposal distributionï¼‰</strong>ï¼šè¯­è¨€æ¨¡å‹åœ¨ç”Ÿæˆä¸‹ä¸€ä¸ªè¯å…ƒï¼ˆtokenï¼‰æ—¶ï¼Œä¼šè¾“å‡ºå¯¹æ‰€æœ‰å¯èƒ½è¯å…ƒçš„æ¦‚ç‡ä¼°è®¡ã€‚  </li><li><strong>è’¸é¦ï¼ˆdistillationï¼‰</strong>ï¼šé€šè¿‡æ¯”è¾ƒæ•™å¸ˆå’Œå­¦ç”Ÿçš„åˆ†å¸ƒå·®å¼‚ï¼Œå­¦ç”Ÿä¼šé€æ­¥è°ƒæ•´è‡ªèº«å‚æ•°ï¼Œä½¿å…¶è¾“å‡ºæ›´æ¥è¿‘æ•™å¸ˆæ¨¡å‹çš„é£æ ¼å’Œæ¨ç†å€¾å‘ã€‚</li></ol></blockquote><p>è®­ç»ƒæ‰€ä½¿ç”¨çš„æ•°æ®ï¼Œæ­£æ˜¯ä¹‹å‰æåˆ°çš„é‚£ <strong>80 ä¸‡æ¡é«˜è´¨é‡æ ·æœ¬</strong>â€”â€”å…¶ä¸­åŒ…å«çº¦ 60 ä¸‡æ¨ç†æ ·æœ¬å’Œ 20 ä¸‡éæ¨ç†æ ·æœ¬ã€‚ä¸‹å›¾å±•ç¤ºäº†è¿™ä¸€æ•°æ®æµå‘ï¼š </p><img src="/2025/02/11/NLP%20Insights/%E6%8E%A8%E7%90%86%20LLM%20%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8C%87%E5%8D%97%EF%BC%9A%E6%8E%A2%E7%B4%A2%E6%8E%A8%E7%90%86%E6%97%B6%E8%AE%A1%E7%AE%97%E6%8A%80%E6%9C%AF%E4%B8%8E%20DeepSeek-R1/20250211_185323.png" class=""><ul><li>å·¦ä¾§çš„ <strong>Reasoning</strong>ï¼ˆæ¨ç†ï¼‰å’Œ <strong>Answer</strong>ï¼ˆç­”æ¡ˆï¼‰æ•°æ®ï¼Œåˆè®¡ 80 ä¸‡æ¡ã€‚  </li><li>ç”± <strong>DeepSeek-R1</strong>ï¼ˆTeacherï¼‰ç”Ÿæˆæˆ–è¯„ä¼°ï¼Œå¾—åˆ°å¯¹åº”çš„æ¦‚ç‡åˆ†å¸ƒã€‚  </li><li>å­¦ç”Ÿæ¨¡å‹ <strong>Qwen-32B</strong> åˆ™æ ¹æ®æ•™å¸ˆçš„åˆ†å¸ƒè¿›è¡Œå­¦ä¹ ï¼Œæœ€ç»ˆå¾—åˆ°ä¸€ä¸ªè’¸é¦ç‰ˆæœ¬ <strong>DeepSeek-R1-Distill-Qwen-32B</strong>ã€‚</li></ul><p><img src="https://user-images.githubusercontent.com/your-image-url.png" alt="ä½¿ç”¨ 80 ä¸‡æ¡é«˜è´¨é‡æ ·æœ¬è’¸é¦çš„æµç¨‹ï¼ˆå›¾10ï¼‰"></p><blockquote><p><strong>é¢å¤–è§£é‡Š</strong>ï¼š  </p><ul><li>å­¦ç”Ÿæ¨¡å‹ä¸ä»…ä»…å­¦ä¹ äº†é‚£ 80 ä¸‡æ¡æ ·æœ¬æœ¬èº«çš„è¾“å…¥-è¾“å‡ºæ¨¡å¼ï¼Œä¹Ÿå­¦ä¹ åˆ° <strong>DeepSeek-R1</strong> åœ¨é¢å¯¹è¿™äº›æ•°æ®æ—¶æ‰€â€œå€¾å‘â€é‡‡ç”¨çš„æ¨ç†ç­–ç•¥å’Œæ¦‚ç‡åˆ†å¸ƒï¼Œä»è€Œåœ¨æ›´å°æ¨¡å‹ä¸Šå¤ç°ç±»ä¼¼çš„æ¨ç†èƒ½åŠ›ã€‚  </li><li>â€œDistilledâ€ æ¨¡å‹å¾€å¾€ä¼šåœ¨æ¨ç†è´¨é‡ä¸è®¡ç®—èµ„æºä¹‹é—´æ‰¾åˆ°æ›´å¥½çš„å¹³è¡¡ï¼šè™½ç„¶å¯èƒ½åœ¨æ€§èƒ½ä¸Šç•¥é€Šè‰²äºè€å¸ˆæ¨¡å‹ï¼Œä½†ä¾ç„¶èƒ½åœ¨å¤§å¤šæ•°å¸¸è§ä»»åŠ¡ä¸Šè¾¾åˆ°ä»¤äººæ»¡æ„çš„ç»“æœï¼Œå¹¶ä¸”æ‰€éœ€èµ„æºæ›´ä½ã€‚</li></ul></blockquote><hr><h2 id="å…¶ä»–æœªæˆåŠŸçš„å°è¯•"><a href="#å…¶ä»–æœªæˆåŠŸçš„å°è¯•" class="headerlink" title="å…¶ä»–æœªæˆåŠŸçš„å°è¯•"></a>å…¶ä»–æœªæˆåŠŸçš„å°è¯•</h2><p>åœ¨ç ”ç©¶è¿‡ç¨‹ä¸­ï¼ŒDeepSeek å›¢é˜Ÿä¹Ÿæ›¾å°è¯•è¿‡ <strong>Process Reward Modelsï¼ˆPRMsï¼‰</strong> å’Œ <strong>Monte Carlo Tree Searchï¼ˆMCTSï¼‰</strong> ç­‰æ–¹æ³•æ¥æ³¨å…¥æ¨ç†èƒ½åŠ›ï¼Œä½†ç»“æœå¹¶ä¸ç†æƒ³ï¼š</p><ol><li><p><strong>ä½¿ç”¨ MCTS</strong>  </p><ul><li>é¢ä¸´çš„ä¸»è¦é—®é¢˜æ˜¯æœç´¢ç©ºé—´è¿‡äºåºå¤§ï¼Œåªèƒ½å¯¹èŠ‚ç‚¹å±•å¼€è¿›è¡Œä¸¥æ ¼é™åˆ¶ã€‚è¿™æ ·ä¸€æ¥ï¼Œæ•ˆæœå°±å¤§æ‰“æŠ˜æ‰£ã€‚  </li><li>æ­¤å¤–ï¼Œç²¾ç»†åŒ–è®­ç»ƒ Reward Model ä¹Ÿç›¸å½“å›°éš¾ã€‚</li></ul></li><li><p><strong>ä½¿ç”¨ PRMs è¿›è¡Œ Best-of-N ç­–ç•¥</strong>  </p><ul><li>å¦‚æœä¸æ–­é‡è®­ç»ƒ Reward Model ä»¥é˜²æ­¢æ¨¡å‹å‡ºç°â€œæŠ•æœºå–å·§â€ï¼ˆreward hackingï¼‰è¡Œä¸ºï¼Œä¼šå¸¦æ¥é«˜æ˜‚çš„è®¡ç®—å¼€é”€ã€‚</li></ul></li></ol><p>è¿™äº›ç»“æœå¹¶ä¸æ„å‘³ç€è¿™äº›æŠ€æœ¯æ— æ•ˆï¼Œè€Œæ˜¯è¯´æ˜å®ƒä»¬åœ¨å½“å‰å¤§è§„æ¨¡è¯­è¨€æ¨¡å‹ä¸Šçš„å®è·µè¿˜æœ‰è¯¸å¤šé™åˆ¶ä¸éš¾ç‚¹ã€‚<strong>DeepSeek-R1</strong> ä¹‹æ‰€ä»¥å–å¾—æˆåŠŸï¼Œæ›´å¤šä¾èµ–äº<strong>å¼ºåŒ–å­¦ä¹  + ç›‘ç£å¾®è°ƒ</strong>çš„ç»„åˆï¼Œä»¥åŠå¯¹å¤§è§„æ¨¡é«˜è´¨é‡æ•°æ®çš„æŒ–æ˜ä¸åˆ©ç”¨ã€‚</p><hr><h2 id="æ€»ç»“ä¸å±•æœ›"><a href="#æ€»ç»“ä¸å±•æœ›" class="headerlink" title="æ€»ç»“ä¸å±•æœ›"></a>æ€»ç»“ä¸å±•æœ›</h2><p>è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»å¤§è‡´å›é¡¾äº† <strong>DeepSeek-R1</strong> çš„æ¨ç†è®­ç»ƒä¹‹æ—…ã€‚å¸Œæœ›ä»¥ä¸Šå†…å®¹èƒ½å¤Ÿè®©ä½ æ›´å¥½åœ°ç†è§£ï¼š  </p><ul><li><strong>Test-time computeï¼ˆæ¨ç†æ—¶è®¡ç®—ï¼‰</strong> å¯ä»¥é€šè¿‡æ¨¡å‹è¾“å‡ºæ›´é•¿ã€æ›´ç²¾ç»†çš„æ€è€ƒè¿‡ç¨‹ï¼ˆChain-of-Thoughtï¼‰æ¥å–å¾—æ›´ä½³æ•ˆæœã€‚  </li><li>å¤§è§„æ¨¡â€œ<strong>å…ˆç›‘ç£å¾®è°ƒï¼Œå†å¼ºåŒ–å­¦ä¹ </strong>â€çš„è®­ç»ƒæµç¨‹ï¼Œä»¥åŠ<strong>è’¸é¦</strong>åˆ°æ›´å°æ¨¡å‹çš„æŠ€æœ¯è·¯çº¿ï¼Œä¹Ÿå±•ç°äº†åœ¨ç¡¬ä»¶èµ„æºå’Œæ¨ç†æ€§èƒ½é—´å–å¾—å¹³è¡¡çš„æ–¹æ³•ã€‚</li></ul><p>å¦‚å‰æ‰€è¿°ï¼Œ<strong>DeepSeek-R1</strong> å¼•å…¥äº†å¤šç§å¥–åŠ±æœºåˆ¶ï¼Œå°¤å…¶æ˜¯é’ˆå¯¹æ ¼å¼å’Œäººç±»åå¥½çš„å¥–åŠ±ï¼Œæ¥ä¿è¯å›ç­”æ—¢æ­£ç¡®åˆæ˜“è¯»ã€‚â€œæ€»ç»“æ¨ç†è¿‡ç¨‹â€ï¼ˆSummaryï¼‰çš„åšæ³•ä¹Ÿåœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šæ”¹å–„äº†çº¯æ–‡æœ¬Chain-of-Thoughtè¿‡é•¿è€Œå¯¼è‡´çš„å¯è¯»æ€§é—®é¢˜ã€‚</p><hr><h2 id="æ›´å¤šèµ„æº"><a href="#æ›´å¤šèµ„æº" class="headerlink" title="æ›´å¤šèµ„æº"></a>æ›´å¤šèµ„æº</h2><p>å¦‚æœä½ å¯¹ <strong>Large Language Modelsï¼ˆLLMsï¼‰</strong> ä¸­çš„æ¨ç†è¯é¢˜æ„Ÿå…´è¶£ï¼Œä»¥ä¸‹èµ„æºå€¼å¾—å‚è€ƒï¼š</p><ol><li><a href="https://newsletter.languagemodels.co/p/the-illustrated-deepseek-r1"><strong>The Illustrated DeepSeek-R1</strong></a>  <ul><li>Jay Alammar åˆ¶ä½œçš„é«˜è´¨é‡å¯è§†åŒ–æŒ‡å—ï¼Œè¯¦ç»†ä»‹ç»äº† DeepSeek-R1 æ¨¡å‹èƒŒåçš„åŸç†ä¸å®ç°ç»†èŠ‚ã€‚</li></ul></li><li><a href="https://huggingface.co/spaces/HuggingFaceH4/blogpost-scaling-test-time-compute"><strong>Hugging Face çš„ä¸€ç¯‡åšæ–‡</strong></a>  <ul><li>é‡ç‚¹è®¨è®ºäº†åœ¨æ¨ç†é˜¶æ®µå¦‚ä½•å¯¹è®¡ç®—é‡è¿›è¡Œæ‰©å±•ï¼Œå¹¶ç»™å‡ºäº†æœ‰è¶£çš„å®éªŒã€‚</li></ul></li><li><a href="https://www.youtube.com/watch?v=6PEJ96k1kiw"><strong>è§†é¢‘ â€œSpeculations on Test-Time Scalingâ€</strong></a>  <ul><li>æ·±å…¥æ¢è®¨äº†åœ¨æ¨ç†é˜¶æ®µè¿›è¡Œå„ç§è®¡ç®—æ‰©å±•çš„å¸¸ç”¨æŠ€æœ¯ç»†èŠ‚ã€‚</li></ul></li></ol><p>æ­¤å¤–ï¼Œä½œè€…åœ¨æ–‡ä¸­ä¹Ÿæåˆ°äº†ä¸€æœ¬å…³äºå¤§å‹è¯­è¨€æ¨¡å‹çš„è‘—ä½œï¼Œå†…å«æ›´å¤šå¯è§†åŒ–å’Œå®éªŒç»“æœï¼Œæ˜¯æƒ³è¿›ä¸€æ­¥ç ”ç©¶æ¨ç† LLMs çš„æœ‹å‹å¯ä»¥æ·±å…¥é˜…è¯»çš„å¥½èµ„æ–™ã€‚</p><ul><li><strong>Official Website of the Book</strong>: <a href="https://www.llm-book.com/">llm-book.com</a>  </li><li><strong>Amazon è´­ä¹°é“¾æ¥</strong>: <a href="https://www.amazon.com/Hands-Large-Language-Models-Understanding/dp/1098150961">Hands-On Large Language Models: Understanding, Building, and Optimizing LLMs</a>  </li><li><strong>GitHub ä»£ç ä»“åº“</strong>: <a href="https://github.com/handsOnLLM/Hands-On-Large-Language-Models">handsOnLLM/Hands-On-Large-Language-Models</a></li></ul><hr><h3 id="è‡´è°¢"><a href="#è‡´è°¢" class="headerlink" title="è‡´è°¢"></a>è‡´è°¢</h3><p>æ„Ÿè°¢ä½ é˜…è¯»æœ¬ç¯‡å…³äº <strong>DeepSeek-R1</strong> çš„ä»‹ç»æ–‡æ¡£ã€‚é€šè¿‡å¯¹æ‰€æœ‰å›¾ç‰‡ä¸æ–‡å­—å†…å®¹çš„ä¾æ¬¡è§£è¯»ï¼Œä»¥åŠå¯¹æ¯ä¸ªç¯èŠ‚æ‰€æ¶‰åŠçš„å…³é”®æŠ€æœ¯è¿›è¡Œäº†æ›´å¤šè§£é‡Šï¼Œæˆ‘ä»¬å¸Œæœ›è®©ä½ å¯¹ <strong>DeepSeek-R1</strong> çš„è®­ç»ƒæµç¨‹ã€è’¸é¦æ–¹æ³•å’ŒæœªæˆåŠŸçš„å°è¯•éƒ½æœ‰æ›´åŠ å…¨é¢çš„äº†è§£ã€‚</p><p>åœ¨æœªæ¥ï¼Œéšç€ç¡¬ä»¶æ€§èƒ½çš„æå‡ä¸æ›´æˆç†Ÿçš„è®­ç»ƒæŠ€æœ¯å‡ºç°ï¼Œ<strong>æ·±åº¦æ¨ç†</strong>ä¸<strong>æ¨¡å‹è’¸é¦</strong>å¿…å°†åœ¨æ›´å¤šå®é™…åº”ç”¨åœºæ™¯ä¸­å‘æŒ¥å·¨å¤§ä½œç”¨ã€‚è®©æˆ‘ä»¬æ‹­ç›®ä»¥å¾…ï¼</p>]]></content>
      
      
      <categories>
          
          <category> NLP Insights </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LLM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¿½é€ä¸å€’å½±</title>
      <link href="/2024/12/11/Life%20Reflections/%E8%BF%BD%E9%80%90%E4%B8%8E%E5%80%92%E5%BD%B1/"/>
      <url>/2024/12/11/Life%20Reflections/%E8%BF%BD%E9%80%90%E4%B8%8E%E5%80%92%E5%BD%B1/</url>
      
        <content type="html"><![CDATA[<h3 id="è¿½é€ä¸å€’å½±"><a href="#è¿½é€ä¸å€’å½±" class="headerlink" title="è¿½é€ä¸å€’å½±"></a>è¿½é€ä¸å€’å½±</h3><p>åœ¨æ¸…æ™¨çš„ç¬¬ä¸€ç¼•å…‰æ´’ä¸‹ä¹‹å‰ï¼Œä¸–é—´ä¸€åˆ‡å°šæœªæ˜¾å½¢ã€‚å…‰ä¸å½±çš„è¾¹ç•Œæ¨¡ç³Šï¼Œå½·ä½›å¯ä»¥äº¤å ï¼Œåˆå½·ä½›æ³¨å®šåˆ†ç¦»ã€‚äººä»¬å¸¸è¯´ï¼Œæœé˜³æ˜¯å¸Œæœ›çš„è±¡å¾ï¼Œå¯å®ƒå‡èµ·æ—¶ï¼Œå¿…å°†æŠ›ä¸‹ä¸€åœ°å½±å­ã€‚å…‰å’Œå½±ä¹‹é—´ï¼Œç©¶ç«Ÿæ˜¯è¿½é€è¿˜æ˜¯ç›¸ä¼´ï¼Ÿè¿™æ ·çš„æ€è€ƒè®©æˆ‘æƒ³èµ·ä¸€åˆ™å¤è€çš„å¯“è¨€ï¼šä¸€åŒ¹é©¬åœ¨æ²™æ¼ ä¸­è¿½é€è¿œæ–¹çš„ç»¿æ´²ï¼Œå´ä¸çŸ¥é“é‚£ä¸è¿‡æ˜¯æµ·å¸‚èœƒæ¥¼ï¼Œå®ƒæ¯å‰è¿›ä¸€æ­¥ï¼Œç»¿æ´²ä¹Ÿéšä¹‹è¿œå»ã€‚</p><p>æœ‰æ—¶æˆ‘ä»¬è¿½å¯»çš„ç›®æ ‡ï¼Œå¦‚åŒæ²™æ¼ ä¸­çš„ç»¿æ´²ä¸€èˆ¬ï¼Œå®ƒå¹¶éè™šæ— ï¼Œä½†ä¹Ÿä¸å®Œå…¨çœŸå®ã€‚å®ƒæ˜¯ä¸€ç§å­˜åœ¨äºå¿ƒä¸­çš„æ˜ åƒï¼Œä¸€ä¸ªæ— æ³•ä¼åŠçš„å½¼å²¸ã€‚æ— è®ºæˆ‘ä»¬æ€æ ·é è¿‘ï¼Œé‚£ä»½è·ç¦»ä¼¼ä¹æ€»æ˜¯æ’å®šï¼Œç”šè‡³åœ¨æˆ‘ä»¬ä¼¸æ‰‹è§¦ç¢°çš„ä¸€åˆ¹é‚£ï¼Œå®ƒä¾¿å¦‚çƒŸé›¾èˆ¬æ¶ˆæ•£ã€‚æ˜¯ç›®æ ‡å˜äº†ï¼Œè¿˜æ˜¯æˆ‘ä»¬çš„æ‰§å¿µè®©å®ƒæ„ˆåŠ æ¨¡ç³Šï¼Ÿ</p><p>é•œä¸­çš„å€’å½±ä¹Ÿæ˜¯å¦‚æ­¤ã€‚å½“ä½ ç«™åœ¨é•œå‰å‡è§†è‡ªå·±æ—¶ï¼Œä½ çœ‹è§çš„é‚£ä¸ªâ€œä½ â€ï¼Œç©¶ç«Ÿæ˜¯è°ï¼Ÿæ˜¯ä¸€ä¸ªå¿ å®çš„å†ç°ï¼Œè¿˜æ˜¯ä¸€åœºæ¸©æŸ”çš„æ¬ºéª—ï¼Ÿé•œä¸­çš„å€’å½±æ€»ä¼šå›åº”ä½ çš„åŠ¨ä½œï¼Œå¯æ˜¯ä½ æ°¸è¿œæ— æ³•æ‹¥æŠ±å®ƒï¼Œç”šè‡³è¿ç¢°è§¦éƒ½æ— æ³•åšåˆ°ã€‚è¿™ç§è§¦ä¸å¯åŠçš„å…³ç³»ï¼Œæ—¢ä»¤äººæƒ‹æƒœï¼Œåˆæ•™äººæ€ç´¢ã€‚å€˜è‹¥ç”Ÿå‘½ä¸­è®¸å¤šäº‹ç‰©éƒ½åƒè¿™é¢é•œå­ï¼Œæ˜¯å¦æ„å‘³ç€æˆ‘ä»¬æ³¨å®šåªèƒ½é¥æœ›ï¼Œå´æ— æ³•çœŸæ­£æ‹¥æœ‰ï¼Ÿ</p><p>â€œäººç±»æœ€å¤§çš„æ‚²å‰§åœ¨äºï¼Œä»–ä»¬æ³¨å®šè¦è¿½æ±‚é‚£äº›ä¸å¯å¾—ä¹‹ç‰©ã€‚â€èµ·åˆï¼Œæˆ‘å¯¹è¿™å¥è¯å—¤ä¹‹ä»¥é¼»ã€‚ä¸–ç•Œè¿™ä¹ˆå¤§ï¼Œæ€ä¹ˆå¯èƒ½æ‰€æœ‰çš„è¿½æ±‚éƒ½æ˜¯å¾’åŠ³ï¼Ÿç„¶è€Œï¼Œå½“ç»å†äº†ä¸€äº›æ— æ³•è¨€è¯´çš„æ„Ÿå—åï¼Œæˆ‘é€æ¸æ˜ç™½ï¼Œè¿™ç§â€œä¸å¯å¾—â€å¹¶éæŒ‡ç»å¯¹çš„å¤±è´¥ï¼Œè€Œæ˜¯ä¸€ç§ä¸ç›®æ ‡é—´æ— æ³•æ¶ˆå¼­çš„é—´éš™ã€‚å®ƒå¯èƒ½æ˜¯æ—¶é—´çš„é”™ä½ï¼Œä¹Ÿå¯èƒ½æ˜¯ç©ºé—´çš„ç–ç¦»ï¼Œç”šè‡³å¯èƒ½åªæ˜¯å¿ƒå¢ƒçš„ä¸åŒã€‚</p><p>ä¹Ÿè®¸ï¼Œæ­£æ˜¯è¿™ç§æ— æ³•å½»åº•æ¡ä½çš„æ„Ÿè§‰ï¼Œèµ‹äºˆäº†è¿½é€çš„è¿‡ç¨‹ä»¥æ„ä¹‰ã€‚å€˜è‹¥ä¸€åˆ‡è§¦æ‰‹å¯å¾—ï¼Œç”Ÿå‘½æ˜¯å¦ä¼šå› å°‘äº†äº›è®¸é—æ†¾è€Œå¤±å»è‰²å½©ï¼Ÿå…‰å› ä¸ºæœ‰å½±å­æ‰å¾—ä»¥åˆ†æ˜ï¼Œçˆ±å› ä¸ºä¸å¯å¾—æ‰æ˜¾å¾—æ·±åˆ»ã€‚æˆ‘ä»¬åœ¨é—æ†¾ä¸­ä½“ä¼šåˆ°å¸Œæœ›ï¼Œåœ¨è·ç¦»ä¸­å‘ç°è‡ªæˆ‘ï¼Œè¿™æ˜¯å¦æ˜¯ä¸€ç§éšç§˜çš„å¹³è¡¡ï¼Ÿ</p><p>å¤œå¹•é™ä¸´æ—¶ï¼Œæ¸…æ™¨çš„å½±å­ä¼šè¢«é»‘æš—åæ²¡ï¼Œä½†å®ƒå¹¶æœªçœŸæ­£æ¶ˆå¤±ï¼Œåªæ˜¯æ¢äº†ä¸€ç§å½¢æ€ï¼Œæˆä¸ºå¿ƒåº•ä¸€æŸæ— æ³•ç†„ç­çš„å¾®å…‰ã€‚è¿™å…‰æŒ‡å¼•ç€æˆ‘ä»¬ï¼Œè™½ä¸å¯æ‰æ‘¸ï¼Œå´åˆçœŸå®å­˜åœ¨ã€‚æˆ–è®¸ï¼Œæˆ‘ä»¬æ— éœ€æ‰§ç€äºæ˜¯å¦èƒ½å¾—åˆ°ï¼Œè€Œæ˜¯å­¦ä¼šåœ¨è¿½é€çš„è¿‡ç¨‹ä¸­ï¼Œæ¥å—å…‰ä¸å½±äº¤ç»‡çš„ç¾ã€‚</p><p>ä¸–é—´çš„ä¸€åˆ‡ï¼Œçš†æ˜¯å€’å½±ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Life Reflections </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ‚è°ˆ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŸºäºç”Ÿæˆçš„å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰è¯„ä¼°ï¼šä»ç”Ÿæˆåˆ°åˆ¤æ–­çš„æœºé‡ä¸æŒ‘æˆ˜</title>
      <link href="/2024/12/06/NLP%20Insights/%E5%9F%BA%E4%BA%8E%E7%94%9F%E6%88%90%E7%9A%84%E5%A4%A7%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%EF%BC%88LLM%EF%BC%89%E8%AF%84%E4%BC%B0%EF%BC%9A%E4%BB%8E%E7%94%9F%E6%88%90%E5%88%B0%E5%88%A4%E6%96%AD%E7%9A%84%E6%9C%BA%E9%81%87%E4%B8%8E%E6%8C%91%E6%88%98/"/>
      <url>/2024/12/06/NLP%20Insights/%E5%9F%BA%E4%BA%8E%E7%94%9F%E6%88%90%E7%9A%84%E5%A4%A7%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%EF%BC%88LLM%EF%BC%89%E8%AF%84%E4%BC%B0%EF%BC%9A%E4%BB%8E%E7%94%9F%E6%88%90%E5%88%B0%E5%88%A4%E6%96%AD%E7%9A%84%E6%9C%BA%E9%81%87%E4%B8%8E%E6%8C%91%E6%88%98/</url>
      
        <content type="html"><![CDATA[<hr><h1 id="åŸºäºç”Ÿæˆçš„å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰è¯„ä¼°ï¼šä»ç”Ÿæˆåˆ°åˆ¤æ–­çš„æœºé‡ä¸æŒ‘æˆ˜"><a href="#åŸºäºç”Ÿæˆçš„å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰è¯„ä¼°ï¼šä»ç”Ÿæˆåˆ°åˆ¤æ–­çš„æœºé‡ä¸æŒ‘æˆ˜" class="headerlink" title="åŸºäºç”Ÿæˆçš„å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰è¯„ä¼°ï¼šä»ç”Ÿæˆåˆ°åˆ¤æ–­çš„æœºé‡ä¸æŒ‘æˆ˜"></a>åŸºäºç”Ÿæˆçš„å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰è¯„ä¼°ï¼šä»ç”Ÿæˆåˆ°åˆ¤æ–­çš„æœºé‡ä¸æŒ‘æˆ˜</h1><h2 id="æ‘˜è¦"><a href="#æ‘˜è¦" class="headerlink" title="æ‘˜è¦"></a>æ‘˜è¦</h2><p>äººå·¥æ™ºèƒ½ï¼ˆAIï¼‰ä¸è‡ªç„¶è¯­è¨€å¤„ç†ï¼ˆNLPï¼‰é¢†åŸŸä¸­çš„è¯„ä¼°ä»»åŠ¡é•¿æœŸé¢ä¸´æŒ‘æˆ˜ã€‚ä¼ ç»Ÿçš„è¯„ä¼°æ–¹æ³•ï¼ˆå¦‚åŸºäºåŒ¹é…æˆ–åµŒå…¥çš„æŠ€æœ¯ï¼‰åœ¨åˆ¤æ–­å¤æ‚å±æ€§æ—¶æ•ˆæœæœ‰é™ã€‚è¿‘æœŸå¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰çš„å‘å±•å‚¬ç”Ÿäº†â€œLLM-as-a-Judgeâ€èŒƒå¼ï¼Œåˆ©ç”¨LLMå¯¹ä»»åŠ¡è¿›è¡Œè¯„åˆ†ã€æ’åºæˆ–é€‰æ‹©ã€‚æœ¬è®ºæ–‡å¯¹LLMè¯„ä¼°æ–¹æ³•è¿›è¡Œäº†å…¨é¢ç»¼è¿°ï¼ŒåŒ…æ‹¬å…¶å®šä¹‰ã€åˆ†ç±»æ¡†æ¶ã€è¯„ä¼°åŸºå‡†ï¼Œä»¥åŠæœªæ¥çš„ç ”ç©¶æ–¹å‘ã€‚</p><hr><h2 id="1-å¼•è¨€"><a href="#1-å¼•è¨€" class="headerlink" title="1. å¼•è¨€"></a>1. å¼•è¨€</h2><h3 id="1-1-èƒŒæ™¯"><a href="#1-1-èƒŒæ™¯" class="headerlink" title="1.1 èƒŒæ™¯"></a>1.1 èƒŒæ™¯</h3><p>è¯„ä¼°æ˜¯æœºå™¨å­¦ä¹ å’ŒNLPçš„æ ¸å¿ƒé—®é¢˜ä¹‹ä¸€ï¼Œä¼ ç»Ÿè¯„ä¼°æ–¹æ³•å¦‚BLEUå’ŒROUGEé€šå¸¸åŸºäºæ–‡æœ¬é‡å ï¼Œç¼ºä¹å¯¹å¤æ‚åœºæ™¯çš„é€‚ç”¨æ€§ã€‚éšç€æ·±åº¦å­¦ä¹ å’ŒLLMçš„å‘å±•ï¼ˆå¦‚GPT-4ï¼‰ï¼Œç ”ç©¶è€…æå‡ºäº†â€œLLM-as-a-Judgeâ€æ¨¡å¼ï¼Œä»¥è§£å†³ä¼ ç»Ÿè¯„ä¼°çš„å±€é™ã€‚</p><h3 id="1-2-ç ”ç©¶é—®é¢˜"><a href="#1-2-ç ”ç©¶é—®é¢˜" class="headerlink" title="1.2 ç ”ç©¶é—®é¢˜"></a>1.2 ç ”ç©¶é—®é¢˜</h3><p>æœ¬è®ºæ–‡æ—¨åœ¨æ¢è®¨ä»¥ä¸‹é—®é¢˜ï¼š</p><ul><li><strong>è¯„ä¼°å†…å®¹ï¼šLLMè¯„ä¼°ä»€ä¹ˆï¼Ÿ</strong></li><li><strong>è¯„ä¼°æ–¹æ³•ï¼šå¦‚ä½•è¿›è¡Œè¯„ä¼°ï¼Ÿ</strong></li><li><strong>åº”ç”¨åœºæ™¯ï¼šLLMåœ¨å“ªé‡Œè¯„ä¼°ï¼Ÿ</strong></li></ul><hr><h2 id="2-é¢„å¤‡çŸ¥è¯†"><a href="#2-é¢„å¤‡çŸ¥è¯†" class="headerlink" title="2. é¢„å¤‡çŸ¥è¯†"></a>2. é¢„å¤‡çŸ¥è¯†</h2><h3 id="2-1-è¾“å…¥æ ¼å¼"><a href="#2-1-è¾“å…¥æ ¼å¼" class="headerlink" title="2.1 è¾“å…¥æ ¼å¼"></a>2.1 è¾“å…¥æ ¼å¼</h3><p>è¯„ä¼°è¾“å…¥å¯åˆ†ä¸ºï¼š</p><ul><li><strong>ç‚¹å¯¹ç‚¹ï¼ˆPoint-Wiseï¼‰</strong>ï¼šå•ä¸ªæ ·æœ¬è¯„ä¼°ã€‚</li><li><strong>å¯¹/åˆ—è¡¨è¯„ä¼°ï¼ˆPair/List-Wiseï¼‰</strong>ï¼šå¤šä¸ªæ ·æœ¬çš„æ¯”è¾ƒè¯„ä¼°ã€‚</li></ul><h3 id="2-2-è¾“å‡ºæ ¼å¼"><a href="#2-2-è¾“å‡ºæ ¼å¼" class="headerlink" title="2.2 è¾“å‡ºæ ¼å¼"></a>2.2 è¾“å‡ºæ ¼å¼</h3><p>è¯„ä¼°è¾“å‡ºåŒ…æ‹¬ï¼š</p><ul><li><strong>è¯„åˆ†ï¼ˆScoreï¼‰</strong>ï¼šå¯¹æ ·æœ¬è¿›è¡Œé‡åŒ–è¯„åˆ†ã€‚</li><li><strong>æ’åºï¼ˆRankingï¼‰</strong>ï¼šæ ¹æ®ä¼˜åŠ£æ’åºã€‚</li><li><strong>é€‰æ‹©ï¼ˆSelectionï¼‰</strong>ï¼šä»å¤šä¸ªå€™é€‰ä¸­é€‰å–æœ€ä½³æ–¹æ¡ˆã€‚</li></ul><hr><h2 id="3-è¯„ä¼°å±æ€§"><a href="#3-è¯„ä¼°å±æ€§" class="headerlink" title="3. è¯„ä¼°å±æ€§"></a>3. è¯„ä¼°å±æ€§</h2><h3 id="3-1-æœ‰ç”¨æ€§ï¼ˆHelpfulnessï¼‰"><a href="#3-1-æœ‰ç”¨æ€§ï¼ˆHelpfulnessï¼‰" class="headerlink" title="3.1 æœ‰ç”¨æ€§ï¼ˆHelpfulnessï¼‰"></a>3.1 æœ‰ç”¨æ€§ï¼ˆHelpfulnessï¼‰</h3><p>LLMé€šè¿‡æŒ‡å¯¼ç”¨æˆ·ä»»åŠ¡å’Œç”Ÿæˆåé¦ˆï¼Œå¯¹å“åº”çš„æœ‰ç”¨æ€§è¿›è¡Œè¯„ä¼°ã€‚è¿™åœ¨AIå¯¹é½ï¼ˆAlignmentï¼‰ä¸­å°¤ä¸ºé‡è¦ã€‚</p><h3 id="3-2-æ— å®³æ€§ï¼ˆHarmlessnessï¼‰"><a href="#3-2-æ— å®³æ€§ï¼ˆHarmlessnessï¼‰" class="headerlink" title="3.2 æ— å®³æ€§ï¼ˆHarmlessnessï¼‰"></a>3.2 æ— å®³æ€§ï¼ˆHarmlessnessï¼‰</h3><p>è¯„ä¼°æ–‡æœ¬çš„æ— å®³æ€§æ˜¯ç”Ÿæˆå®‰å…¨å†…å®¹çš„å…³é”®ã€‚LLMå¯è¾…åŠ©æ•°æ®æ ‡æ³¨æˆ–ç›´æ¥è¯„ä¼°æ½œåœ¨çš„æœ‰å®³å†…å®¹ã€‚</p><h3 id="3-3-å¯é æ€§ï¼ˆReliabilityï¼‰"><a href="#3-3-å¯é æ€§ï¼ˆReliabilityï¼‰" class="headerlink" title="3.3 å¯é æ€§ï¼ˆReliabilityï¼‰"></a>3.3 å¯é æ€§ï¼ˆReliabilityï¼‰</h3><p>LLMå¯æ£€æµ‹äº‹å®æ€§å’Œä¸€è‡´æ€§ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡ç”Ÿæˆè¾…åŠ©è¯æ®æˆ–è¿›è¡Œå¯¹è¯çº§åˆ«çš„å¯é æ€§è¯„ä¼°ã€‚</p><h3 id="3-4-ç›¸å…³æ€§ï¼ˆRelevanceï¼‰"><a href="#3-4-ç›¸å…³æ€§ï¼ˆRelevanceï¼‰" class="headerlink" title="3.4 ç›¸å…³æ€§ï¼ˆRelevanceï¼‰"></a>3.4 ç›¸å…³æ€§ï¼ˆRelevanceï¼‰</h3><p>LLMå¯è¯„ä¼°ç”Ÿæˆæˆ–æ£€ç´¢å†…å®¹çš„ç›¸å…³æ€§ï¼Œé€‚ç”¨äºä¼šè¯ã€æ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGï¼‰ç­‰åœºæ™¯ã€‚</p><h3 id="3-5-å¯è¡Œæ€§ï¼ˆFeasibilityï¼‰"><a href="#3-5-å¯è¡Œæ€§ï¼ˆFeasibilityï¼‰" class="headerlink" title="3.5 å¯è¡Œæ€§ï¼ˆFeasibilityï¼‰"></a>3.5 å¯è¡Œæ€§ï¼ˆFeasibilityï¼‰</h3><p>åœ¨å¤æ‚ä»»åŠ¡ä¸­ï¼ŒLLMå¯å¯¹å€™é€‰æ­¥éª¤æˆ–è¡ŒåŠ¨è¿›è¡Œå¯è¡Œæ€§åˆ¤æ–­ï¼Œä»è€Œä¼˜åŒ–å†³ç­–è·¯å¾„ã€‚</p><h3 id="3-6-æ€»ä½“è´¨é‡ï¼ˆOverall-Qualityï¼‰"><a href="#3-6-æ€»ä½“è´¨é‡ï¼ˆOverall-Qualityï¼‰" class="headerlink" title="3.6 æ€»ä½“è´¨é‡ï¼ˆOverall Qualityï¼‰"></a>3.6 æ€»ä½“è´¨é‡ï¼ˆOverall Qualityï¼‰</h3><p>LLMé€šè¿‡å¤šç»´åº¦è¯„åˆ†ç”Ÿæˆæ•´ä½“è¯„ä»·ï¼Œé€‚ç”¨äºç”Ÿæˆä»»åŠ¡çš„ç»¼åˆæ¯”è¾ƒã€‚</p><hr><h3 id="4-æ–¹æ³•è®º"><a href="#4-æ–¹æ³•è®º" class="headerlink" title="4. æ–¹æ³•è®º"></a>4. æ–¹æ³•è®º</h3><h4 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h4><p>æ–¹æ³•è®ºéƒ¨åˆ†ä¸»è¦æ¢è®¨å¦‚ä½•ä¼˜åŒ–LLMä½œä¸ºè¯„ä¼°è€…ï¼ˆLLM-as-a-Judgeï¼‰çš„èƒ½åŠ›ï¼Œä»è°ƒä¼˜å’Œæç¤ºæŠ€æœ¯ä¸¤ä¸ªæ–¹é¢è¿›è¡Œé˜è¿°ï¼š</p><ol><li><strong>è°ƒä¼˜æŠ€æœ¯</strong>ï¼šé€šè¿‡ç›‘ç£å¾®è°ƒï¼ˆSFTï¼‰å’Œåå¥½å­¦ä¹ ç­‰æ–¹æ³•ï¼Œåˆ©ç”¨äººå·¥æ ‡æ³¨æ•°æ®æˆ–åˆæˆåé¦ˆæ¥å¢å¼ºLLMçš„åˆ¤æ–­èƒ½åŠ›ã€‚</li><li><strong>æç¤ºæŠ€æœ¯</strong>ï¼šè®¾è®¡é«˜æ•ˆçš„æç¤ºç­–ç•¥ï¼ˆå¦‚æ“ä½œäº¤æ¢ã€è§„åˆ™å¢å¼ºã€å¤šä»£ç†åä½œç­‰ï¼‰ä»¥æå‡LLMåœ¨æ¨ç†å’Œè¯„ä¼°è¿‡ç¨‹ä¸­çš„å‡†ç¡®æ€§å’Œå¯é æ€§ã€‚</li></ol><hr><h4 id="4-1-è°ƒä¼˜æŠ€æœ¯"><a href="#4-1-è°ƒä¼˜æŠ€æœ¯" class="headerlink" title="4.1 è°ƒä¼˜æŠ€æœ¯"></a>4.1 è°ƒä¼˜æŠ€æœ¯</h4><h5 id="æ•°æ®æ¥æº"><a href="#æ•°æ®æ¥æº" class="headerlink" title="æ•°æ®æ¥æº"></a>æ•°æ®æ¥æº</h5><h6 id="1-äººå·¥æ ‡æ³¨æ•°æ®"><a href="#1-äººå·¥æ ‡æ³¨æ•°æ®" class="headerlink" title="1. äººå·¥æ ‡æ³¨æ•°æ®"></a>1. <strong>äººå·¥æ ‡æ³¨æ•°æ®</strong></h6><p>äººå·¥æ ‡æ³¨æ•°æ®æä¾›äº†é«˜è´¨é‡çš„è®­ç»ƒæ ·æœ¬ï¼Œå¸®åŠ©LLMå­¦ä¹ äººç±»åå¥½ã€‚ä»¥ä¸‹æ˜¯æ ¸å¿ƒç ”ç©¶åŠå…¶åˆ›æ–°ç‚¹ï¼š</p><ol><li><p><strong>PandaLM</strong>ã€Wang et al., 2024hã€‘ï¼š</p><ul><li>PandaLMé¡¹ç›®æ”¶é›†äº†å¤šæ ·åŒ–çš„äººå·¥æ ‡æ³¨æ•°æ®é›†ï¼Œæ¶µç›–æŒ‡ä»¤ç”Ÿæˆä»»åŠ¡çš„300,000ä¸ªæ ·æœ¬ã€‚</li><li>ä½œè€…é€šè¿‡æ•´åˆå¤šç§æ•°æ®æºï¼ˆå¦‚å¼€æ”¾é¢†åŸŸé—®ç­”å’Œå¯¹è¯ç”Ÿæˆï¼‰æ¥å¢å¼ºæ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ã€‚</li><li>è¯¥ç ”ç©¶çš„å…³é”®åˆ›æ–°åœ¨äºå¼•å…¥äº†æ ‡å‡†åŒ–çš„æ ‡æ³¨æµç¨‹ï¼Œä»¥ç¡®ä¿æ•°æ®è´¨é‡ä¸ä¸€è‡´æ€§ã€‚</li><li>æ­¤å¤–ï¼ŒPandaLMå¼ºè°ƒå¤šè¯­è¨€æ”¯æŒï¼Œé€šè¿‡è·¨æ–‡åŒ–çš„æ•°æ®æ ‡æ³¨æé«˜æ¨¡å‹çš„é€‚ç”¨æ€§ã€‚</li><li>æœ€ç»ˆï¼ŒPandaLMè¢«è¯æ˜åœ¨å¤šä¸ªè¯„ä¼°ä»»åŠ¡ä¸Šè¡¨ç°ä¼˜å¼‚ï¼Œå…¶è¾“å‡ºä¸äººå·¥è¯„ä¼°é«˜åº¦ç›¸å…³ã€‚</li></ul></li><li><p><strong>AspectInstruct</strong>ã€Liu et al., 2024aã€‘ï¼š</p><ul><li>è¯¥ç ”ç©¶é¦–æ¬¡æå‡ºäº†ä¸€ä¸ªé’ˆå¯¹å¤šç»´åº¦è¯„ä¼°çš„æŒ‡ä»¤è°ƒä¼˜æ•°æ®é›†ï¼Œæ¶µç›–65ä¸ªä»»åŠ¡å’Œ27ä¸ªè¯„ä¼°ç»´åº¦ã€‚</li><li>æ•°æ®é›†ä¸­åŒ…å«å¯¹è¯ç”Ÿæˆã€æ‘˜è¦å’Œæ•°æ®åˆ°æ–‡æœ¬è½¬æ¢ç­‰å¤æ‚ä»»åŠ¡çš„å¤šæ–¹é¢è¯„åˆ†ã€‚</li><li>ä½œè€…è®¾è®¡äº†ç‹¬ç‰¹çš„ä»»åŠ¡åˆ†å‰²æœºåˆ¶ï¼Œä½¿æ¨¡å‹èƒ½å¤Ÿæ ¹æ®ä¸Šä¸‹æ–‡ç†è§£å¹¶ä¼˜å…ˆè¯„ä¼°ç‰¹å®šç»´åº¦ã€‚</li><li>ç ”ç©¶çš„äº®ç‚¹åœ¨äºæ•°æ®é›†çš„å¤šæ ·æ€§å’Œå…¨é¢æ€§ï¼Œä¸ºå¤šä»»åŠ¡è¯„ä¼°æä¾›äº†æ–°çš„åŸºå‡†ã€‚</li><li>æœ€ç»ˆï¼Œè¯¥æ•°æ®é›†æ˜¾è‘—æå‡äº†LLMåœ¨ä¸åŒè¯„ä¼°åœºæ™¯ä¸­çš„å¤šç»´åº¦ç†è§£å’Œè¯„ä¼°èƒ½åŠ›ã€‚</li></ul></li></ol><h6 id="2-åˆæˆæ•°æ®"><a href="#2-åˆæˆæ•°æ®" class="headerlink" title="2. åˆæˆæ•°æ®"></a>2. <strong>åˆæˆæ•°æ®</strong></h6><p>åˆæˆæ•°æ®é€šè¿‡LLMç”Ÿæˆè®­ç»ƒæ ·æœ¬ï¼Œå‡å°‘äº†å¯¹äººå·¥æ ‡æ³¨çš„ä¾èµ–ï¼ŒåŒæ—¶æ‰©å±•äº†æ•°æ®è¦†ç›–èŒƒå›´ã€‚ä»¥ä¸‹æ˜¯æ ¸å¿ƒç ”ç©¶åŠå…¶åˆ›æ–°ç‚¹ï¼š</p><ol><li><p><strong>JudgeLM</strong>ã€Zhu et al., 2023ã€‘ï¼š</p><ul><li>ç ”ç©¶è€…åˆ©ç”¨GPT-4ç”ŸæˆåŒ…å«ä»»åŠ¡ç§å­ã€ç”Ÿæˆç­”æ¡ˆåŠç›¸å…³è¯„ä¼°çš„é«˜è´¨é‡æ•°æ®é›†ã€‚</li><li>æ•°æ®é›†ä¸­åŒ…å«10ä¸‡ä¸ªæ ·æœ¬ï¼Œè¦†ç›–äº†æŒ‡ä»¤ç”Ÿæˆä»»åŠ¡çš„å¤šç§åœºæ™¯ã€‚</li><li>æ ¸å¿ƒåˆ›æ–°ç‚¹åœ¨äºå¼•å…¥äº†ç”Ÿæˆä»»åŠ¡ç§å­çš„æ–¹æ³•ï¼Œç¡®ä¿ç”Ÿæˆæ•°æ®çš„å¤šæ ·æ€§å’Œé’ˆå¯¹æ€§ã€‚</li><li>ä½œè€…è¿˜è®¾è®¡äº†ä¸€ç§åŸºäºåå¥½å­¦ä¹ çš„ä¼˜åŒ–æ–¹æ³•ï¼Œä»¥æé«˜LLMå¯¹ç»†ç²’åº¦ä»»åŠ¡çš„åˆ¤æ–­èƒ½åŠ›ã€‚</li><li>ç ”ç©¶è¡¨æ˜ï¼Œç»è¿‡è¿™ç§ä¼˜åŒ–åçš„JudgeLMåœ¨å¤šä¸ªåŸºå‡†æµ‹è¯•ä¸­è¶…è¶Šäº†ä¼ ç»Ÿæ–¹æ³•ã€‚</li></ul></li><li><p><strong>Meta-Rewarding</strong>ã€Wu et al., 2024ã€‘ï¼š</p><ul><li>æå‡ºäº†ä¸€ç§æ–°é¢–çš„â€œå…ƒå¥–åŠ±â€ï¼ˆMeta-Rewardingï¼‰æ–¹æ³•ï¼Œé€šè¿‡LLMè‡ªæˆ‘è¯„ä¼°ç”Ÿæˆçš„åˆ¤æ–­ä¿¡å·å¢å¼ºè®­ç»ƒæ•ˆæœã€‚</li><li>è¯¥æ–¹æ³•è¦æ±‚æ¨¡å‹åœ¨ç”Ÿæˆç­”æ¡ˆåå¯¹è‡ªå·±çš„è¾“å‡ºè¿›è¡Œè¯„åˆ†ï¼Œä»è€Œç”Ÿæˆåå¥½æ•°æ®ã€‚</li><li>åˆ›æ–°ç‚¹åœ¨äºé‡‡ç”¨ç­–ç•¥æ¨¡å‹ä½œä¸ºè¯„ä¼°è€…ï¼Œæ˜¾è‘—æé«˜äº†æ•°æ®ç”Ÿæˆæ•ˆç‡å’Œè´¨é‡ã€‚</li><li>æ­¤å¤–ï¼Œè¯¥ç ”ç©¶é€šè¿‡é€æ­¥æ”¹è¿›çš„åå¥½æ•°æ®è®­ç»ƒLLMï¼Œæé«˜äº†å…¶è¯„ä¼°ä»»åŠ¡çš„é²æ£’æ€§ã€‚</li><li>æœ€ç»ˆï¼ŒMeta-Rewardingå±•ç¤ºäº†LLMè‡ªæˆ‘å¢å¼ºèƒ½åŠ›çš„æ½œåŠ›ï¼Œæˆä¸ºåå¥½å­¦ä¹ é¢†åŸŸçš„é‡è¦è¿›å±•ã€‚</li></ul></li></ol><h5 id="è°ƒä¼˜æ–¹æ³•"><a href="#è°ƒä¼˜æ–¹æ³•" class="headerlink" title="è°ƒä¼˜æ–¹æ³•"></a>è°ƒä¼˜æ–¹æ³•</h5><h6 id="1-ç›‘ç£å¾®è°ƒï¼ˆSFTï¼‰"><a href="#1-ç›‘ç£å¾®è°ƒï¼ˆSFTï¼‰" class="headerlink" title="1. ç›‘ç£å¾®è°ƒï¼ˆSFTï¼‰"></a>1. <strong>ç›‘ç£å¾®è°ƒï¼ˆSFTï¼‰</strong></h6><p>ç›‘ç£å¾®è°ƒé€šè¿‡ä½¿ç”¨äººå·¥æ ‡æ³¨æˆ–åˆæˆæ•°æ®ï¼Œè®©LLMä»ç¤ºä¾‹ä¸­å­¦ä¹ åˆ¤æ–­æ ‡å‡†ã€‚ä»¥ä¸‹æ˜¯æ ¸å¿ƒç ”ç©¶åŠå…¶åˆ›æ–°ç‚¹ï¼š</p><ol><li><p><strong>FLAMe</strong>ã€Vu et al., 2024ã€‘ï¼š</p><ul><li>è¯¥ç ”ç©¶æå‡ºäº†Foundational Large Autorater Models (FLAMe)ï¼Œåˆ©ç”¨è¶…è¿‡500ä¸‡ä¸ªæ ·æœ¬è¿›è¡Œå¤§è§„æ¨¡å¤šä»»åŠ¡ç›‘ç£å¾®è°ƒã€‚</li><li>FLAMeåœ¨å¤šä»»åŠ¡æ•°æ®ä¸­å¼•å…¥äº†ç»Ÿä¸€çš„è¯„ä»·æ ‡å‡†ï¼Œæé«˜äº†æ¨¡å‹åœ¨å¤šæ ·åŒ–ä»»åŠ¡ä¸­çš„è¯„ä¼°èƒ½åŠ›ã€‚</li><li>åˆ›æ–°ç‚¹åœ¨äºé‡‡ç”¨å¤šä»»åŠ¡å­¦ä¹ æ¡†æ¶ï¼Œå°†å¤šä¸ªè¯„ä¼°ç»´åº¦é›†æˆåˆ°ä¸€ä¸ªæ¨¡å‹ä¸­ã€‚</li><li>ä½œè€…è¿˜è®¾è®¡äº†ä»»åŠ¡åˆ†å±‚è®­ç»ƒç­–ç•¥ï¼Œä½¿æ¨¡å‹èƒ½å¤Ÿé€æ­¥æŒæ¡å¤æ‚çš„è¯„ä¼°ä»»åŠ¡ã€‚</li><li>å®éªŒç»“æœè¡¨æ˜ï¼ŒFLAMeåœ¨å¤šä¸ªç”Ÿæˆä»»åŠ¡ä¸Šçš„è¡¨ç°ä¼˜äºä¼ ç»Ÿè¯„ä¼°æŒ‡æ ‡ã€‚</li></ul></li><li><p><strong>JSFT</strong>ã€Lee et al., 2024ã€‘ï¼š</p><ul><li>æå‡ºäº†Judge-augmented Supervised Fine-Tuningï¼ˆJSFTï¼‰æ–¹æ³•ï¼Œé€šè¿‡æ‰©å±•åå¥½å­¦ä¹ æ•°æ®å¢å¼ºå¾®è°ƒæ•ˆæœã€‚</li><li>æ•°æ®é›†ä¸­åŒ…å«ç‚¹å¯¹ç‚¹å’Œå¯¹æ¯”è¯„ä¼°ä»»åŠ¡ï¼Œä»¥å…¨é¢è¦†ç›–å¤šç§è¯„ä¼°åœºæ™¯ã€‚</li><li>åˆ›æ–°ç‚¹åœ¨äºå¼•å…¥äº†å¤šé˜¶æ®µè®­ç»ƒç­–ç•¥ï¼Œç»“åˆç›‘ç£å­¦ä¹ å’Œåå¥½å­¦ä¹ ä¼˜åŒ–æ¨¡å‹æ€§èƒ½ã€‚</li><li>æ­¤å¤–ï¼Œç ”ç©¶è€…è®¾è®¡äº†ç®€åŒ–æç¤ºæœºåˆ¶ï¼Œæ˜¾è‘—æé«˜äº†æ¨¡å‹å¤„ç†å¤æ‚è¾“å…¥çš„èƒ½åŠ›ã€‚</li><li>JSFTçš„å®éªŒç»“æœæ˜¾ç¤ºï¼Œå…¶ç”Ÿæˆçš„è¯„ä¼°ç»“æœåœ¨å¤šä¸ªåŸºå‡†ä¸Šè¶…è¿‡äº†ç°æœ‰æ–¹æ³•ã€‚</li></ul></li></ol><h6 id="2-åå¥½å­¦ä¹ "><a href="#2-åå¥½å­¦ä¹ " class="headerlink" title="2. åå¥½å­¦ä¹ "></a>2. <strong>åå¥½å­¦ä¹ </strong></h6><p>åå¥½å­¦ä¹ é€šè¿‡ä¼˜åŒ–LLMçš„æ¯”è¾ƒå’Œæ’åºèƒ½åŠ›ï¼Œé€‚ç”¨äºå¤æ‚è¯„ä¼°ä»»åŠ¡ã€‚ä»¥ä¸‹æ˜¯æ ¸å¿ƒç ”ç©¶åŠå…¶åˆ›æ–°ç‚¹ï¼š</p><ol><li><p><strong>HALU-J</strong>ã€Wang et al., 2024aã€‘ï¼š</p><ul><li>æå‡ºäº†ä¸€ç§åŸºäºæ‰¹è¯„çš„åå¥½å­¦ä¹ æ–¹æ³•ï¼Œä¸“æ³¨äºé€‰æ‹©ç›¸å…³è¯æ®å¹¶ç”Ÿæˆè¯¦ç»†æ‰¹è¯„ã€‚</li><li>åˆ›æ–°ç‚¹åœ¨äºè®¾è®¡äº†å¤šè¯æ®é€‰æ‹©æœºåˆ¶ï¼Œæé«˜äº†LLMçš„å¯é æ€§è¯„ä¼°èƒ½åŠ›ã€‚</li><li>è¯¥æ–¹æ³•é€šè¿‡Directed Preference Optimizationï¼ˆDPOï¼‰è¿›è¡Œä¼˜åŒ–ï¼Œä½¿æ¨¡å‹èƒ½å¤Ÿæ›´å‡†ç¡®åœ°åˆ¤æ–­ä»»åŠ¡é—´çš„ä¼˜åŠ£ã€‚</li><li>HALU-Jè¿˜ç»“åˆäº†ä¸Šä¸‹æ–‡æ¨ç†ï¼Œæ‰©å±•äº†åå¥½å­¦ä¹ çš„åº”ç”¨åœºæ™¯ã€‚</li><li>å®éªŒè¡¨æ˜ï¼ŒHALU-Jæ˜¾è‘—æå‡äº†å¤æ‚ä»»åŠ¡çš„è¯„ä¼°å‡†ç¡®æ€§ï¼Œå°¤å…¶æ˜¯åœ¨äº‹å®æ€§å’Œé€»è¾‘æ€§åˆ¤æ–­ä¸Šã€‚</li></ul></li><li><p><strong>Self-Taught Evaluators</strong>ã€Wang et al., 2024fã€‘ï¼š</p><ul><li>è¯¥ç ”ç©¶æå‡ºäº†ä¸€ç§è‡ªå­¦ä¹ çš„è¯„ä¼°è€…æ–¹æ³•ï¼Œåˆ©ç”¨è¢«æ‰°ä¹±çš„æŒ‡ä»¤ç”Ÿæˆä½è´¨é‡æ•°æ®ä½œä¸ºåå¥½å­¦ä¹ çš„è´Ÿæ ·æœ¬ã€‚</li><li>è‡ªå­¦ä¹ æ–¹æ³•é€šè¿‡è‡ªåŠ¨ç”Ÿæˆçš„æ¬¡ä¼˜å“åº”ï¼Œæä¾›äº†ä¸°å¯Œçš„è®­ç»ƒæ•°æ®ã€‚</li><li>åˆ›æ–°ç‚¹åœ¨äºé€šè¿‡åŠ¨æ€è°ƒæ•´åå¥½ä¿¡å·ï¼Œæå‡äº†æ¨¡å‹çš„é€‚åº”æ€§å’Œé€šç”¨æ€§ã€‚</li><li>ä½œè€…è¿˜è®¾è®¡äº†åŸºäºå¤šè½®äº¤äº’çš„å­¦ä¹ ç­–ç•¥ï¼Œä½¿æ¨¡å‹èƒ½å¤Ÿåœ¨åŠ¨æ€ç¯å¢ƒä¸­è‡ªæˆ‘ä¼˜åŒ–ã€‚</li><li>å®éªŒç»“æœæ˜¾ç¤ºï¼ŒSelf-Taught Evaluatorsåœ¨å¤šä¸ªå¼€æ”¾å¼ç”Ÿæˆä»»åŠ¡ä¸­è¡¨ç°ä¼˜å¼‚ã€‚</li></ul></li></ol><h3 id="4-2-æç¤ºæŠ€æœ¯"><a href="#4-2-æç¤ºæŠ€æœ¯" class="headerlink" title="4.2 æç¤ºæŠ€æœ¯"></a>4.2 æç¤ºæŠ€æœ¯</h3><h4 id="æ¦‚è¿°-1"><a href="#æ¦‚è¿°-1" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h4><p>æç¤ºæŠ€æœ¯ï¼ˆPromptingï¼‰é€šè¿‡è®¾è®¡é«˜æ•ˆçš„æç¤ºç­–ç•¥å’Œæ¨ç†æµç¨‹ä¼˜åŒ–LLMçš„è¯„ä¼°èƒ½åŠ›ã€‚è¿™éƒ¨åˆ†æ¢è®¨å¦‚ä½•åœ¨æ¨ç†é˜¶æ®µåˆ©ç”¨æç¤ºæŠ€æœ¯æå‡åˆ¤æ–­ç²¾åº¦ï¼Œå‡å°‘åå·®ï¼Œå¹¶å¢å¼ºæ¨¡å‹çš„è¯„ä¼°é²æ£’æ€§ã€‚ä¸»è¦æ–¹æ³•åŒ…æ‹¬æ“ä½œäº¤æ¢ã€è§„åˆ™å¢å¼ºã€å¤šä»£ç†åä½œã€æ¼”ç¤ºã€å¤šè½®äº¤äº’ä»¥åŠæ¯”è¾ƒåŠ é€Ÿã€‚</p><hr><h4 id="4-2-1-æ“ä½œäº¤æ¢ï¼ˆSwapping-Operationï¼‰"><a href="#4-2-1-æ“ä½œäº¤æ¢ï¼ˆSwapping-Operationï¼‰" class="headerlink" title="4.2.1 æ“ä½œäº¤æ¢ï¼ˆSwapping Operationï¼‰"></a>4.2.1 æ“ä½œäº¤æ¢ï¼ˆSwapping Operationï¼‰</h4><h5 id="æ¦‚è¿°-2"><a href="#æ¦‚è¿°-2" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h5><p>æ“ä½œäº¤æ¢æŠ€æœ¯é€šè¿‡æ›´æ”¹å€™é€‰é¡¹é¡ºåºå‡å°‘è¯„ä¼°çš„åç½®æ€§ï¼Œç¡®ä¿LLMå¯¹è¾“å…¥é¡ºåºä¸æ•æ„Ÿï¼Œä»è€Œæé«˜è¯„ä¼°çš„å…¬å¹³æ€§å’Œå¯é æ€§ã€‚</p><h6 id="1-MT-Benchã€Zheng-et-al-2023ã€‘ï¼š"><a href="#1-MT-Benchã€Zheng-et-al-2023ã€‘ï¼š" class="headerlink" title="1. MT-Benchã€Zheng et al., 2023ã€‘ï¼š"></a>1. <strong>MT-Bench</strong>ã€Zheng et al., 2023ã€‘ï¼š</h6><ul><li>æœ¬ç ”ç©¶é¦–æ¬¡ç³»ç»Ÿæ€§åœ°æå‡ºæ“ä½œäº¤æ¢æŠ€æœ¯ï¼Œé€šè¿‡å¤šè½®è¯„ä¼°å‡å°‘LLMçš„é¡ºåºæ•æ„Ÿæ€§ã€‚</li><li>åˆ›æ–°ç‚¹åœ¨äºå¼•å…¥â€œå¯¹ç§°æ€§æ£€æŸ¥â€æœºåˆ¶ï¼šå°†å€™é€‰é¡¹é¡ºåºäº’æ¢ï¼Œè‹¥è¯„åˆ†ç»“æœä¸€è‡´ï¼Œåˆ™æ ‡è®°ä¸ºç¨³å®šï¼Œå¦åˆ™æ ‡è®°ä¸ºä¸ç¨³å®šã€‚</li><li>ä½œè€…å‘ç°æ“ä½œäº¤æ¢èƒ½å¤Ÿæœ‰æ•ˆå‡å°‘ç”±äºä½ç½®åå·®å¯¼è‡´çš„é”™è¯¯åˆ¤æ–­ã€‚</li><li>è¯¥æŠ€æœ¯åº”ç”¨äºå¤šä»»åŠ¡è¯„ä¼°ä¸­ï¼Œå°¤å…¶æ˜¯åœ¨å¤æ‚ç”Ÿæˆä»»åŠ¡çš„æ’åºä¸­è¡¨ç°çªå‡ºã€‚</li><li>MT-Benchä¸ºåç»­çš„LLMè¯„ä¼°æŠ€æœ¯æä¾›äº†ä¸€ä¸ªé‡è¦çš„å…¬å¹³æ€§åŸºå‡†ã€‚</li></ul><h6 id="2-Starlingã€Zhu-et-al-2024aã€‘ï¼š"><a href="#2-Starlingã€Zhu-et-al-2024aã€‘ï¼š" class="headerlink" title="2. Starlingã€Zhu et al., 2024aã€‘ï¼š"></a>2. <strong>Starling</strong>ã€Zhu et al., 2024aã€‘ï¼š</h6><ul><li>æå‡ºä¸€ç§ç±»ä¼¼é“¾å¼æ¨ç†ï¼ˆChain-of-Thought, CoTï¼‰çš„æç¤ºæŠ€æœ¯ï¼Œé€šè¿‡å…¨é¢è¯„ä¼°æ‰€æœ‰å€™é€‰é¡¹çš„ä¸¤ä¸¤å…³ç³»ï¼Œå†æ€»ç»“ä¸ºæœ€ç»ˆæ’åºã€‚</li><li>åˆ›æ–°ç‚¹åœ¨äºå¼ºåˆ¶æ¨¡å‹ç”Ÿæˆæ‰€æœ‰å¯èƒ½çš„å¯¹æ¯”ç»“æœï¼Œç¡®ä¿è¯„ä¼°å…¨é¢ä¸”æ— åã€‚</li><li>ä½œè€…è¿˜è®¾è®¡äº†ä¸€ç§äº¤å‰éªŒè¯æœºåˆ¶ï¼Œè¿›ä¸€æ­¥æé«˜è¯„ä¼°ç¨³å®šæ€§ã€‚</li><li>å®éªŒæ˜¾ç¤ºï¼Œè¿™ç§æ–¹æ³•æ˜¾è‘—å‡å°‘äº†ä½ç½®åå·®å¸¦æ¥çš„è¯¯å·®ï¼Œç‰¹åˆ«æ˜¯åœ¨æ’åºä»»åŠ¡ä¸­è¡¨ç°ä¼˜å¼‚ã€‚</li><li>StarlingéªŒè¯äº†é“¾å¼æ€ç»´ç»“åˆæ“ä½œäº¤æ¢æŠ€æœ¯çš„æ½œåŠ›ï¼Œå°¤å…¶åœ¨å¤æ‚å¯¹æ¯”ä»»åŠ¡ä¸­çš„æ•ˆæœæ˜¾è‘—ã€‚</li></ul><hr><h4 id="4-2-2-è§„åˆ™å¢å¼ºï¼ˆRule-Augmentationï¼‰"><a href="#4-2-2-è§„åˆ™å¢å¼ºï¼ˆRule-Augmentationï¼‰" class="headerlink" title="4.2.2 è§„åˆ™å¢å¼ºï¼ˆRule Augmentationï¼‰"></a>4.2.2 è§„åˆ™å¢å¼ºï¼ˆRule Augmentationï¼‰</h4><h5 id="æ¦‚è¿°-3"><a href="#æ¦‚è¿°-3" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h5><p>è§„åˆ™å¢å¼ºæŠ€æœ¯é€šè¿‡åœ¨æç¤ºä¸­åµŒå…¥æ˜ç¡®çš„åŸåˆ™ã€æ ‡å‡†æˆ–å‚è€ƒå†…å®¹ï¼Œä½¿æ¨¡å‹èƒ½å¤Ÿæ›´åŠ ç³»ç»Ÿåœ°è¯„ä¼°ä»»åŠ¡ï¼Œä»è€Œæå‡è¯„ä¼°çš„å‡†ç¡®æ€§å’Œä¸€è‡´æ€§ã€‚</p><h6 id="1-Constitutional-AIã€Bai-et-al-2022ã€‘ï¼š"><a href="#1-Constitutional-AIã€Bai-et-al-2022ã€‘ï¼š" class="headerlink" title="1. Constitutional AIã€Bai et al., 2022ã€‘ï¼š"></a>1. <strong>Constitutional AI</strong>ã€Bai et al., 2022ã€‘ï¼š</h6><ul><li>æœ¬ç ”ç©¶å¼•å…¥äº†â€œåŸåˆ™é©±åŠ¨â€çš„è§„åˆ™å¢å¼ºæ–¹æ³•ï¼Œåˆ©ç”¨å¸®åŠ©æ€§ã€æ— å®³æ€§å’Œè¯šå®æ€§ç­‰æ ‡å‡†æŒ‡å¯¼æ¨¡å‹è¯„ä¼°ã€‚</li><li>åˆ›æ–°ç‚¹åœ¨äºä¸ºæ¯ä¸ªè¯„ä¼°ç»´åº¦å®šä¹‰è¯¦ç»†çš„è¯„åˆ†æ ‡å‡†ï¼Œå¹¶é€šè¿‡åŸåˆ™çº¦æŸç”Ÿæˆå†…å®¹ã€‚</li><li>ä½œè€…é‡‡ç”¨å¤šå±‚æç¤ºè®¾è®¡ï¼Œä½¿LLMèƒ½å¤Ÿé€æ­¥æ¨ç†å¹¶ç»™å‡ºæœ€ç»ˆè¯„ä¼°ã€‚</li><li>å®éªŒè¡¨æ˜ï¼Œè¿™ç§æ–¹æ³•æ˜¾è‘—æå‡äº†æ¨¡å‹åœ¨å¤æ‚åœºæ™¯ä¸­çš„åˆ¤æ–­ä¸€è‡´æ€§ã€‚</li><li>Constitutional AIæˆä¸ºåç»­ç ”ç©¶çš„é‡è¦åŸºçŸ³ï¼Œä¸ºåŸºäºè§„åˆ™çš„è¯„ä¼°æŠ€æœ¯å¥ å®šäº†åŸºç¡€ã€‚</li></ul><h6 id="2-OAIFã€Guo-et-al-2024ã€‘ï¼š"><a href="#2-OAIFã€Guo-et-al-2024ã€‘ï¼š" class="headerlink" title="2. OAIFã€Guo et al., 2024ã€‘ï¼š"></a>2. <strong>OAIF</strong>ã€Guo et al., 2024ã€‘ï¼š</h6><ul><li>æå‡ºäº†åœ¨çº¿AIåé¦ˆï¼ˆOnline AI Feedback, OAIFï¼‰æ¡†æ¶ï¼Œé€šè¿‡å®æ—¶åŸåˆ™æŒ‡å¯¼æå‡æ¨¡å‹è¯„ä¼°çš„çµæ´»æ€§ã€‚</li><li>æ ¸å¿ƒåˆ›æ–°ç‚¹åœ¨äºåŠ¨æ€è°ƒæ•´è¯„ä¼°è§„åˆ™ï¼Œä½¿æ¨¡å‹èƒ½å¤Ÿé€‚åº”å¤šå˜çš„ä»»åŠ¡éœ€æ±‚ã€‚</li><li>OAIFå¼•å…¥äº†ç»†ç²’åº¦çš„å¤šç»´è¯„åˆ†ç­–ç•¥ï¼Œä¸ºæ¯ä¸ªå€™é€‰é¡¹ç”Ÿæˆç‹¬ç«‹çš„è¯„ä¼°æŠ¥å‘Šã€‚</li><li>ä½œè€…éªŒè¯äº†è¿™ç§æ–¹æ³•åœ¨å®æ—¶å†³ç­–ä¸­çš„æ½œåŠ›ï¼Œå°¤å…¶åœ¨å¯¹è¯å’Œç”Ÿæˆä»»åŠ¡ä¸­è¡¨ç°çªå‡ºã€‚</li><li>OAIFå±•ç°äº†è§„åˆ™å¢å¼ºçš„å®æ—¶é€‚åº”èƒ½åŠ›ï¼Œä¸ºå®æ—¶è¯„ä¼°ä»»åŠ¡æä¾›äº†æ–°æ–¹å‘ã€‚</li></ul><hr><h4 id="4-2-3-å¤šä»£ç†åä½œï¼ˆMulti-agent-Collaborationï¼‰"><a href="#4-2-3-å¤šä»£ç†åä½œï¼ˆMulti-agent-Collaborationï¼‰" class="headerlink" title="4.2.3 å¤šä»£ç†åä½œï¼ˆMulti-agent Collaborationï¼‰"></a>4.2.3 å¤šä»£ç†åä½œï¼ˆMulti-agent Collaborationï¼‰</h4><h5 id="æ¦‚è¿°-4"><a href="#æ¦‚è¿°-4" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h5><p>å¤šä»£ç†åä½œé€šè¿‡ç»„åˆå¤šä¸ªLLMçš„è¯„ä¼°ç»“æœï¼Œå‡å°‘å•ä¸€æ¨¡å‹çš„åå·®ï¼Œæé«˜è¯„ä¼°çš„å‡†ç¡®æ€§å’Œé²æ£’æ€§ã€‚è¿™ç§æ–¹æ³•å¼ºè°ƒæ¨¡å‹ä¹‹é—´çš„è§’è‰²åˆ†å·¥å’Œåˆä½œã€‚</p><h6 id="1-Peer-Rank-PR-ã€Li-et-al-2023ã€‘ï¼š"><a href="#1-Peer-Rank-PR-ã€Li-et-al-2023ã€‘ï¼š" class="headerlink" title="1. **Peer Rank (PR)**ã€Li et al., 2023ã€‘ï¼š"></a>1. **Peer Rank (PR)**ã€Li et al., 2023ã€‘ï¼š</h6><ul><li>æå‡ºäº†åŒè¡Œæ’åç®—æ³•ï¼Œæ•´åˆå¤šä¸ªLLMçš„å¯¹æ¯”åå¥½ç”Ÿæˆæœ€ç»ˆæ’åºã€‚</li><li>åˆ›æ–°ç‚¹åœ¨äºè®¾è®¡äº†â€œåŠ æƒæŠ•ç¥¨â€æœºåˆ¶ï¼Œæ ¹æ®æ¨¡å‹ä¹‹é—´çš„è¯„åˆ†ä¸€è‡´æ€§è°ƒæ•´æƒé‡ã€‚</li><li>è¯¥ç ”ç©¶è¿˜æ¢è®¨äº†ä»£ç†é—´çš„åä½œæ•ˆç‡å’Œé²æ£’æ€§ï¼Œæå‡ºäº†ä¼˜åŒ–åä½œè·¯å¾„çš„æ–¹æ³•ã€‚</li><li>PRçš„å®éªŒç»“æœæ˜¾ç¤ºï¼Œå…¶ç”Ÿæˆçš„è¯„ä¼°ç»“æœåœ¨æ’åºå‡†ç¡®æ€§ä¸Šä¼˜äºä¼ ç»Ÿå•æ¨¡å‹æ–¹æ³•ã€‚</li><li>è¯¥ç ”ç©¶ä¸ºå¤šæ¨¡å‹åä½œæŠ€æœ¯å¥ å®šäº†ç†è®ºåŸºç¡€ï¼Œæ˜¯åç»­ç ”ç©¶çš„é‡è¦å‚è€ƒã€‚</li></ul><h6 id="2-Cascaded-Selective-Evaluationã€Jung-et-al-2024ã€‘ï¼š"><a href="#2-Cascaded-Selective-Evaluationã€Jung-et-al-2024ã€‘ï¼š" class="headerlink" title="2. Cascaded Selective Evaluationã€Jung et al., 2024ã€‘ï¼š"></a>2. <strong>Cascaded Selective Evaluation</strong>ã€Jung et al., 2024ã€‘ï¼š</h6><ul><li>è®¾è®¡äº†çº§è”é€‰æ‹©è¯„ä¼°æ¡†æ¶ï¼Œé¦–å…ˆç”±è¾ƒå¼±çš„æ¨¡å‹è¿›è¡Œåˆæ­¥è¯„ä¼°ï¼Œä»…åœ¨éœ€è¦æ—¶è°ƒç”¨æ›´å¼ºå¤§çš„æ¨¡å‹ã€‚</li><li>åˆ›æ–°ç‚¹åœ¨äºé€šè¿‡åˆ†çº§ç­–ç•¥ä¼˜åŒ–è®¡ç®—æˆæœ¬ï¼ŒåŒæ—¶ç¡®ä¿è¯„ä¼°ç»“æœçš„é«˜è´¨é‡ã€‚</li><li>ä½œè€…æå‡ºäº†ä¸€ç§äº¤å‰éªŒè¯æœºåˆ¶ï¼Œç»“åˆå¤šä¸ªä»£ç†çš„ç»“æœç”Ÿæˆæœ€ç»ˆåˆ¤æ–­ã€‚</li><li>ç ”ç©¶è¡¨æ˜ï¼Œè¿™ç§çº§è”ç­–ç•¥åœ¨å¤æ‚ä»»åŠ¡ä¸­è¡¨ç°å‡ºæ˜¾è‘—çš„èµ„æºæ•ˆç‡æå‡ã€‚</li><li>Cascaded Selective Evaluationå±•ç¤ºäº†å¤šä»£ç†åä½œåœ¨èµ„æºæœ‰é™æƒ…å†µä¸‹çš„æ½œåŠ›ã€‚</li></ul><hr><h4 id="4-2-4-æ¼”ç¤ºï¼ˆDemonstrationï¼‰"><a href="#4-2-4-æ¼”ç¤ºï¼ˆDemonstrationï¼‰" class="headerlink" title="4.2.4 æ¼”ç¤ºï¼ˆDemonstrationï¼‰"></a>4.2.4 æ¼”ç¤ºï¼ˆDemonstrationï¼‰</h4><h5 id="æ¦‚è¿°-5"><a href="#æ¦‚è¿°-5" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h5><p>æ¼”ç¤ºæŠ€æœ¯åˆ©ç”¨å…·ä½“çš„ç¤ºä¾‹ä½œä¸ºæç¤ºï¼Œå¸®åŠ©LLMå­¦ä¹ è¯„ä¼°æ ‡å‡†ã€‚è¿™ç§æ–¹æ³•é€šè¿‡å°‘é‡é«˜è´¨é‡æ ·ä¾‹æ˜¾è‘—æé«˜æ¨¡å‹çš„è¯„ä¼°èƒ½åŠ›ã€‚</p><h6 id="1-ALLUREã€Hasanbeig-et-al-2023ã€‘ï¼š"><a href="#1-ALLUREã€Hasanbeig-et-al-2023ã€‘ï¼š" class="headerlink" title="1. ALLUREã€Hasanbeig et al., 2023ã€‘ï¼š"></a>1. <strong>ALLURE</strong>ã€Hasanbeig et al., 2023ã€‘ï¼š</h6><ul><li>æå‡ºäº†è¿­ä»£æ¼”ç¤ºæŠ€æœ¯ï¼Œé€šè¿‡åœ¨æç¤ºä¸­åŠ å…¥æ˜¾è‘—åå·®çš„ç¤ºä¾‹æé«˜æ¨¡å‹çš„é²æ£’æ€§ã€‚</li><li>åˆ›æ–°ç‚¹åœ¨äºé‡‡ç”¨åŠ¨æ€æ¼”ç¤ºæ–¹æ³•ï¼Œé€æ­¥æ›´æ–°æç¤ºä»¥é€‚åº”ä¸åŒçš„è¯„ä¼°ä»»åŠ¡ã€‚</li><li>ç ”ç©¶è¡¨æ˜ï¼Œè¿™ç§æ–¹æ³•åœ¨ä½èµ„æºåœºæ™¯ä¸­è¡¨ç°å‡ºè‰²ï¼Œå°¤å…¶æ˜¯åœ¨æ–°ä»»åŠ¡çš„é€‚åº”æ€§ä¸Šæœ‰æ˜¾è‘—æå‡ã€‚</li><li>ä½œè€…è¿˜æ¢è®¨äº†å¦‚ä½•é€‰æ‹©ä»£è¡¨æ€§æ ·ä¾‹ä»¥æœ€å¤§åŒ–æ¼”ç¤ºæ•ˆæœã€‚</li><li>ALLUREéªŒè¯äº†é«˜è´¨é‡æ¼”ç¤ºæ ·ä¾‹åœ¨æå‡è¯„ä¼°èƒ½åŠ›æ–¹é¢çš„é‡è¦æ€§ã€‚</li></ul><h6 id="2-ICEã€Jain-et-al-2023bã€‘ï¼š"><a href="#2-ICEã€Jain-et-al-2023bã€‘ï¼š" class="headerlink" title="2. ICEã€Jain et al., 2023bã€‘ï¼š"></a>2. <strong>ICE</strong>ã€Jain et al., 2023bã€‘ï¼š</h6><ul><li>æå‡ºäº†äº¤äº’å¼å¤šç»´è¯„ä¼°æ¡†æ¶ï¼Œé€šè¿‡å°‘é‡ä¸Šä¸‹æ–‡ç¤ºä¾‹æŒ‡å¯¼LLMè¯„ä¼°ã€‚</li><li>åˆ›æ–°ç‚¹åœ¨äºå°†è¯„ä¼°ä»»åŠ¡åˆ†è§£ä¸ºå¤šä¸ªç‹¬ç«‹ç»´åº¦ï¼Œæ¯ä¸ªç»´åº¦éƒ½æœ‰é’ˆå¯¹æ€§çš„ç¤ºä¾‹æ”¯æŒã€‚</li><li>ç ”ç©¶è¡¨æ˜ï¼ŒICEæ¡†æ¶æ˜¾è‘—å‡å°‘äº†æ¨¡å‹åœ¨å¤šç»´ä»»åŠ¡ä¸­çš„è¯„ä¼°åå·®ã€‚</li><li>å®éªŒç»“æœæ˜¾ç¤ºï¼Œå…¶ç”Ÿæˆçš„è¯„ä¼°ç»“æœåœ¨ä¸äººå·¥è¯„ä»·çš„ä¸€è‡´æ€§ä¸Šè¾¾åˆ°é«˜æ°´å¹³ã€‚</li><li>ICEä¸ºå¤šç»´åº¦è¯„ä¼°ä»»åŠ¡çš„æç¤ºè®¾è®¡æä¾›äº†æ–°æ€è·¯ã€‚</li></ul><hr><h4 id="4-2-5-å¤šè½®äº¤äº’ï¼ˆMulti-turn-Interactionï¼‰"><a href="#4-2-5-å¤šè½®äº¤äº’ï¼ˆMulti-turn-Interactionï¼‰" class="headerlink" title="4.2.5 å¤šè½®äº¤äº’ï¼ˆMulti-turn Interactionï¼‰"></a>4.2.5 å¤šè½®äº¤äº’ï¼ˆMulti-turn Interactionï¼‰</h4><h5 id="æ¦‚è¿°-6"><a href="#æ¦‚è¿°-6" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h5><p>å¤šè½®äº¤äº’é€šè¿‡åŠ¨æ€è°ƒæ•´æç¤ºå’Œä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œä¸ºLLMæä¾›æ›´å…¨é¢çš„è¯„ä¼°ä¾æ®ï¼Œé€‚ç”¨äºéœ€è¦å¤šæ­¥æ¨ç†çš„å¤æ‚ä»»åŠ¡ã€‚</p><h6 id="1-KIEvalã€Yu-et-al-2024ã€‘ï¼š"><a href="#1-KIEvalã€Yu-et-al-2024ã€‘ï¼š" class="headerlink" title="1. KIEvalã€Yu et al., 2024ã€‘ï¼š"></a>1. <strong>KIEval</strong>ã€Yu et al., 2024ã€‘ï¼š</h6><ul><li>æå‡ºäº†çŸ¥è¯†äº¤äº’å¼è¯„ä¼°æ¡†æ¶ï¼Œé€šè¿‡åŠ¨æ€é—®ç­”ç”Ÿæˆä¸°å¯Œçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚</li><li>åˆ›æ–°ç‚¹åœ¨äºå¼•å…¥äº†â€œäº¤äº’è€…â€è§’è‰²ï¼Œæ¨¡æ‹Ÿç”¨æˆ·å’Œæ¨¡å‹ä¹‹é—´çš„åŠ¨æ€äº¤äº’ã€‚</li><li>ä½œè€…è®¾è®¡äº†ä¸€ç§é²æ£’æ€§æ£€æµ‹æœºåˆ¶ï¼Œé¿å…å› ä¸Šä¸‹æ–‡æ±¡æŸ“å¯¼è‡´çš„é”™è¯¯è¯„ä¼°ã€‚</li><li>ç ”ç©¶è¡¨æ˜ï¼ŒKIEvalåœ¨å¤æ‚ä»»åŠ¡ä¸­çš„è¡¨ç°ä¼˜äºä¼ ç»Ÿé™æ€è¯„ä¼°æ–¹æ³•ã€‚</li><li>æ­¤æ¡†æ¶é€‚ç”¨äºå¤šç»´åº¦è¯„ä¼°ï¼Œç‰¹åˆ«æ˜¯åœ¨éœ€è¦åŠ¨æ€è°ƒæ•´ä¸Šä¸‹æ–‡çš„åœºæ™¯ä¸­ã€‚</li></ul><h6 id="2-Auto-Arenaã€Zhao-et-al-2024cã€‘ï¼š"><a href="#2-Auto-Arenaã€Zhao-et-al-2024cã€‘ï¼š" class="headerlink" title="2. Auto-Arenaã€Zhao et al., 2024cã€‘ï¼š"></a>2. <strong>Auto-Arena</strong>ã€Zhao et al., 2024cã€‘ï¼š</h6><ul><li>è®¾è®¡äº†ä¸€ç§å¤šè½®è¾©è®ºæ¡†æ¶ï¼Œå…è®¸å¤šä¸ªæ¨¡å‹å›´ç»•ç‰¹å®šä»»åŠ¡è¿›è¡Œäº¤äº’è®¨è®ºã€‚</li><li>åˆ›æ–°ç‚¹åœ¨äºç»“åˆå¤šè½®é—®ç­”å’ŒåŠ¨æ€è¯„åˆ†æœºåˆ¶ï¼Œä»ä¸åŒè§’åº¦å¯¹å€™é€‰ç­”æ¡ˆè¿›è¡Œè¯„ä¼°ã€‚</li><li>ç ”ç©¶è¡¨æ˜ï¼Œè¿™ç§æ–¹æ³•èƒ½å¤Ÿæ­ç¤ºå€™é€‰ç­”æ¡ˆé—´çš„æ·±å±‚æ¬¡å·®å¼‚ã€‚</li><li>ä½œè€…è¿˜æ¢è®¨äº†å¦‚ä½•é€šè¿‡åŠ¨æ€è°ƒæ•´è¾©è®ºå†…å®¹æé«˜è¯„ä¼°æ•ˆç‡ã€‚</li><li>Auto-Arenaå±•ç¤ºäº†å¤šè½®äº¤äº’åœ¨å¤æ‚è¯„ä¼°ä»»åŠ¡ä¸­çš„æ½œåŠ›ã€‚</li></ul><hr><h4 id="4-2-6-æ¯”è¾ƒåŠ é€Ÿï¼ˆComparison-Accelerationï¼‰"><a href="#4-2-6-æ¯”è¾ƒåŠ é€Ÿï¼ˆComparison-Accelerationï¼‰" class="headerlink" title="4.2.6 æ¯”è¾ƒåŠ é€Ÿï¼ˆComparison Accelerationï¼‰"></a>4.2.6 æ¯”è¾ƒåŠ é€Ÿï¼ˆComparison Accelerationï¼‰</h4><h5 id="æ¦‚è¿°-7"><a href="#æ¦‚è¿°-7" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h5><p>æ¯”è¾ƒåŠ é€ŸæŠ€æœ¯é€šè¿‡ä¼˜åŒ–æ¯”è¾ƒæµç¨‹ï¼Œå‡å°‘å¤šå€™é€‰æ’åºä»»åŠ¡çš„è®¡ç®—æˆæœ¬ï¼Œæé«˜è¯„ä¼°æ•ˆç‡ã€‚</p><h6 id="1-Ranked-Pairingã€Zhai-et-al-2024ã€‘ï¼š"><a href="#1-Ranked-Pairingã€Zhai-et-al-2024ã€‘ï¼š" class="headerlink" title="1. Ranked Pairingã€Zhai et al., 2024ã€‘ï¼š"></a>1. <strong>Ranked Pairing</strong>ã€Zhai et al., 2024ã€‘ï¼š</h6><ul><li>æå‡ºäº†ä¸€ç§åŸºäºåŸºçº¿æ¯”è¾ƒçš„æ’åºæ–¹æ³•ï¼Œé€šè¿‡å¯¹æ‰€æœ‰å€™é€‰é¡¹ä¸åŸºçº¿è¿›è¡Œæ¯”è¾ƒç¡®å®šä¼˜åŠ£ã€‚</li><li>åˆ›æ–°ç‚¹åœ¨äºé¿å…ä¼ ç»Ÿä¸¤ä¸¤æ¯”è¾ƒçš„é«˜è®¡ç®—å¼€é”€ï¼Œæ˜¾è‘—æé«˜äº†è¯„ä¼°æ•ˆç‡ã€‚</li><li>ä½œè€…è¿˜è®¾è®¡äº†ä¸€ç§è‡ªé€‚åº”æ¯”è¾ƒç­–ç•¥ï¼Œè¿›ä¸€æ­¥ä¼˜åŒ–æ’åºæ€§èƒ½ã€‚</li><li>ç ”ç©¶è¡¨æ˜ï¼ŒRanked Pairingåœ¨å¤§è§„æ¨¡æ’åºä»»åŠ¡ä¸­è¡¨ç°å‡ºæé«˜çš„æ•ˆç‡ã€‚</li><li>æ­¤æ–¹æ³•ç‰¹åˆ«é€‚ç”¨äºéœ€è¦å¿«é€Ÿç”Ÿæˆæ’åºç»“æœçš„åœºæ™¯ã€‚</li></ul><h6 id="2-Tournament-based-Comparisonã€Lee-et-al-2024ã€‘ï¼š"><a href="#2-Tournament-based-Comparisonã€Lee-et-al-2024ã€‘ï¼š" class="headerlink" title="2. Tournament-based Comparisonã€Lee et al., 2024ã€‘ï¼š"></a>2. <strong>Tournament-based Comparison</strong>ã€Lee et al., 2024ã€‘ï¼š</h6><ul><li>é‡‡ç”¨é”¦æ ‡èµ›å¼çš„æ¯”è¾ƒæ–¹æ³•ï¼Œæ„å»ºæ ‘çŠ¶ç»“æ„é€å±‚ç­›é€‰æœ€ä½³</li></ul><p>å€™é€‰ã€‚</p><ul><li>åˆ›æ–°ç‚¹åœ¨äºç»“åˆæ‹’ç»é‡‡æ ·å’Œå¤šè½®æ¯”è¾ƒï¼Œå‡å°‘äº†ä½è´¨é‡å€™é€‰çš„å½±å“ã€‚</li><li>ä½œè€…æ¢è®¨äº†ä¸åŒæ ‘ç»“æ„è®¾è®¡å¯¹è¯„ä¼°æ•ˆç‡å’Œå‡†ç¡®æ€§çš„å½±å“ã€‚</li><li>å®éªŒç»“æœæ˜¾ç¤ºï¼Œè¯¥æ–¹æ³•åœ¨å¤šå€™é€‰ä»»åŠ¡ä¸­æ˜¾è‘—æé«˜äº†è®¡ç®—æ•ˆç‡ã€‚</li><li>Tournament-based Comparisonå±•ç¤ºäº†åŸºäºç»“æ„åŒ–æ¯”è¾ƒçš„æ½œåœ¨ä¼˜åŠ¿ã€‚</li></ul><hr><h3 id="5-åº”ç”¨åœºæ™¯"><a href="#5-åº”ç”¨åœºæ™¯" class="headerlink" title="5. åº”ç”¨åœºæ™¯"></a>5. åº”ç”¨åœºæ™¯</h3><h4 id="æ¦‚è¿°-8"><a href="#æ¦‚è¿°-8" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h4><p>LLM-as-a-Judgeçš„åº”ç”¨åœºæ™¯å·²ä»æœ€åˆçš„ç”Ÿæˆä»»åŠ¡è¯„ä¼°æ‰©å±•åˆ°å¤šä¸ªé¢†åŸŸï¼ŒåŒ…æ‹¬è¯„ä¼°ã€å¯¹é½ï¼ˆAlignmentï¼‰ã€æ£€ç´¢å’Œæ¨ç†ï¼ˆReasoningï¼‰ã€‚è¿™ä¸€éƒ¨åˆ†ç³»ç»Ÿæ€§åœ°ä»‹ç»è¿™äº›åº”ç”¨åœºæ™¯ï¼Œè®¨è®ºæ¯ç§åº”ç”¨çš„å…·ä½“ä»»åŠ¡å’Œä»£è¡¨æ€§ç ”ç©¶ã€‚</p><hr><h4 id="5-1-è¯„ä¼°"><a href="#5-1-è¯„ä¼°" class="headerlink" title="5.1 è¯„ä¼°"></a>5.1 è¯„ä¼°</h4><h5 id="æ¦‚è¿°-9"><a href="#æ¦‚è¿°-9" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h5><p>LLM-as-a-Judgeæœ€åˆçš„æ ¸å¿ƒåº”ç”¨æ˜¯è¯„ä¼°ä»»åŠ¡ï¼ŒåŒ…æ‹¬å¼€æ”¾å¼ç”Ÿæˆä»»åŠ¡ï¼ˆå¦‚å¯¹è¯ç”Ÿæˆã€æ‘˜è¦ç”Ÿæˆï¼‰ã€æ¨ç†ä»»åŠ¡ï¼Œä»¥åŠå…¶ä»–æ–°å…´ä»»åŠ¡ã€‚é€šè¿‡LLMè¯„ä¼°ï¼Œèƒ½å¤Ÿæ›´ç²¾å‡†åœ°æ•æ‰å¤æ‚ç”Ÿæˆä»»åŠ¡ä¸­çš„è´¨é‡ã€ç›¸å…³æ€§åŠé€»è¾‘æ€§ç­‰ç»´åº¦ã€‚</p><h6 id="1-MD-Judgeã€Li-et-al-2024fã€‘ï¼š"><a href="#1-MD-Judgeã€Li-et-al-2024fã€‘ï¼š" class="headerlink" title="1. MD-Judgeã€Li et al., 2024fã€‘ï¼š"></a>1. <strong>MD-Judge</strong>ã€Li et al., 2024fã€‘ï¼š</h6><ul><li>æå‡ºäº†ä¸“é—¨é’ˆå¯¹å®‰å…¨æ€§ç›¸å…³é—®ç­”çš„è¯„ä¼°æ¡†æ¶ï¼Œç”¨äºæ£€æµ‹LLMåœ¨ç”Ÿæˆæ•æ„Ÿå†…å®¹æ—¶çš„å¯é æ€§ã€‚</li><li>åˆ›æ–°ç‚¹åœ¨äºè®¾è®¡äº†å¤šç»´åº¦çš„å®‰å…¨æ€§è¯„ä¼°æ ‡å‡†ï¼ŒåŒ…æ‹¬æ½œåœ¨ä¼¤å®³æ€§ã€é“å¾·é£é™©ä»¥åŠè¯­è¨€è¯¯å¯¼æ€§ã€‚</li><li>ä½œè€…é€šè¿‡å¯¹æ¯”å¤šä¸ªLLMçš„è¯„ä¼°èƒ½åŠ›ï¼ŒéªŒè¯äº†MD-Judgeæ¡†æ¶çš„é²æ£’æ€§ã€‚</li><li>æ­¤æ¡†æ¶åœ¨è¯„ä¼°å¤æ‚åœºæ™¯ï¼ˆå¦‚æ¶æ„é—®é¢˜ï¼‰çš„ç”Ÿæˆæ•ˆæœæ–¹é¢è¡¨ç°çªå‡ºã€‚</li><li>MD-Judgeä¸ºç”Ÿæˆæ¨¡å‹çš„å®‰å…¨æ€§è¯„ä¼°æä¾›äº†ä¸€ä¸ªæ–°çš„åŸºå‡†ã€‚</li></ul><h6 id="2-Chanæ¡†æ¶ã€Chan-et-al-2023ã€‘ï¼š"><a href="#2-Chanæ¡†æ¶ã€Chan-et-al-2023ã€‘ï¼š" class="headerlink" title="2. Chanæ¡†æ¶ã€Chan et al., 2023ã€‘ï¼š"></a>2. <strong>Chanæ¡†æ¶</strong>ã€Chan et al., 2023ã€‘ï¼š</h6><ul><li>æå‡ºäº†ä¸€ä¸ªå¤šä»£ç†è¾©è®ºæ¡†æ¶ï¼Œé€šè¿‡è®©å¤šä¸ªLLMè§’è‰²åˆ†åˆ«ç”Ÿæˆç­”æ¡ˆå¹¶å½¼æ­¤è¯„ä¼°ï¼Œæå‡ç”Ÿæˆä»»åŠ¡çš„è¯„ä¼°è´¨é‡ã€‚</li><li>åˆ›æ–°ç‚¹åœ¨äºè®¾è®¡äº†è§’è‰²åˆ†å·¥æœºåˆ¶ï¼Œä¸åŒæ¨¡å‹åœ¨è¾©è®ºä¸­æ‰®æ¼”ä¸åŒçš„ç«‹åœºï¼Œä»å¤šè§’åº¦è¯„ä¼°å€™é€‰ç­”æ¡ˆã€‚</li><li>ç ”ç©¶è¡¨æ˜ï¼Œè¯¥æ¡†æ¶èƒ½å¤Ÿæ˜¾è‘—æå‡è¯„ä¼°ç»“æœçš„ç»†ç²’åº¦å’Œå¤šæ ·æ€§ã€‚</li><li>ä½œè€…è¿˜æ¢è®¨äº†æ¨¡å‹é—´çš„äº¤äº’å¦‚ä½•å½±å“è¯„ä¼°çš„ä¸€è‡´æ€§å’Œå…¬å¹³æ€§ã€‚</li><li>Chanæ¡†æ¶åœ¨å¼€æ”¾å¼æ–‡æœ¬ç”Ÿæˆä»»åŠ¡ä¸­çš„åº”ç”¨è¡¨æ˜ï¼Œæ¨¡å‹ä¹‹é—´çš„åä½œèƒ½å¤Ÿæ˜¾è‘—æ”¹è¿›è¯„ä¼°è´¨é‡ã€‚</li></ul><h6 id="3-ICEã€Jain-et-al-2023bã€‘ï¼š"><a href="#3-ICEã€Jain-et-al-2023bã€‘ï¼š" class="headerlink" title="3. ICEã€Jain et al., 2023bã€‘ï¼š"></a>3. <strong>ICE</strong>ã€Jain et al., 2023bã€‘ï¼š</h6><ul><li>æå‡ºäº†äº¤äº’å¼å¤šç»´è¯„ä¼°æ¡†æ¶ï¼Œé€šè¿‡å°‘é‡ä¸Šä¸‹æ–‡ç¤ºä¾‹æŒ‡å¯¼LLMè¯„ä¼°ã€‚</li><li>åˆ›æ–°ç‚¹åœ¨äºå°†è¯„ä¼°ä»»åŠ¡åˆ†è§£ä¸ºå¤šä¸ªç‹¬ç«‹ç»´åº¦ï¼Œæ¯ä¸ªç»´åº¦éƒ½æœ‰é’ˆå¯¹æ€§çš„ç¤ºä¾‹æ”¯æŒã€‚</li><li>ç ”ç©¶è¡¨æ˜ï¼ŒICEæ¡†æ¶æ˜¾è‘—å‡å°‘äº†æ¨¡å‹åœ¨å¤šç»´ä»»åŠ¡ä¸­çš„è¯„ä¼°åå·®ã€‚</li><li>å®éªŒç»“æœæ˜¾ç¤ºï¼Œå…¶ç”Ÿæˆçš„è¯„ä¼°ç»“æœåœ¨ä¸äººå·¥è¯„ä»·çš„ä¸€è‡´æ€§ä¸Šè¾¾åˆ°é«˜æ°´å¹³ã€‚</li><li>ICEä¸ºå¤šç»´åº¦è¯„ä¼°ä»»åŠ¡çš„æç¤ºè®¾è®¡æä¾›äº†æ–°æ€è·¯ã€‚</li></ul><hr><h4 id="5-2-å¯¹é½ï¼ˆAlignmentï¼‰"><a href="#5-2-å¯¹é½ï¼ˆAlignmentï¼‰" class="headerlink" title="5.2 å¯¹é½ï¼ˆAlignmentï¼‰"></a>5.2 å¯¹é½ï¼ˆAlignmentï¼‰</h4><h5 id="æ¦‚è¿°-10"><a href="#æ¦‚è¿°-10" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h5><p>å¯¹é½ä»»åŠ¡çš„ç›®æ ‡æ˜¯é€šè¿‡è®­ç»ƒæˆ–å¾®è°ƒä½¿LLMçš„ç”Ÿæˆå†…å®¹æ›´ç¬¦åˆäººç±»çš„ä»·å€¼è§‚å’Œåå¥½ã€‚LLM-as-a-Judgeè¢«å¹¿æ³›ç”¨äºç”Ÿæˆå¯¹é½æ•°æ®å’Œè¯„ä¼°å¯¹é½æ•ˆæœã€‚</p><h6 id="1-Constitutional-AIã€Bai-et-al-2022ã€‘ï¼š-1"><a href="#1-Constitutional-AIã€Bai-et-al-2022ã€‘ï¼š-1" class="headerlink" title="1. Constitutional AIã€Bai et al., 2022ã€‘ï¼š"></a>1. <strong>Constitutional AI</strong>ã€Bai et al., 2022ã€‘ï¼š</h6><ul><li>æå‡ºäº†åŸºäºåŸåˆ™å¯¹é½çš„æ¡†æ¶ï¼Œé€šè¿‡å®šä¹‰å¸®åŠ©æ€§ã€æ— å®³æ€§å’Œè¯šå®æ€§ç­‰åŸåˆ™ï¼Œä¼˜åŒ–ç”Ÿæˆæ¨¡å‹çš„è¾“å‡ºã€‚</li><li>åˆ›æ–°ç‚¹åœ¨äºå°†åŸåˆ™èå…¥å¥–åŠ±å»ºæ¨¡è¿‡ç¨‹ï¼Œåˆ©ç”¨LLMç”Ÿæˆçš„åå¥½ä¿¡å·æ„å»ºå¯¹é½æ•°æ®é›†ã€‚</li><li>ä½œè€…é€šè¿‡å¤šè½®å®éªŒéªŒè¯äº†è¿™ç§åŸºäºè§„åˆ™çš„å¯¹é½æ–¹æ³•å¯¹ç”Ÿæˆè´¨é‡çš„æ˜¾è‘—æå‡ã€‚</li><li>æ­¤æ¡†æ¶é€‚ç”¨äºå„ç§ç”Ÿæˆä»»åŠ¡ï¼Œå°¤å…¶åœ¨å‡å°‘æœ‰å®³è¾“å‡ºæ–¹é¢æ•ˆæœæ˜¾è‘—ã€‚</li><li>Constitutional AIçš„æˆåŠŸå±•ç¤ºäº†åŸºäºè§„åˆ™çš„å¯¹é½æ–¹æ³•çš„æ½œåŠ›ã€‚</li></ul><h6 id="2-DIRECT-RLAIFã€Lee-et-al-2023ã€‘ï¼š"><a href="#2-DIRECT-RLAIFã€Lee-et-al-2023ã€‘ï¼š" class="headerlink" title="2. DIRECT-RLAIFã€Lee et al., 2023ã€‘ï¼š"></a>2. <strong>DIRECT-RLAIF</strong>ã€Lee et al., 2023ã€‘ï¼š</h6><ul><li>æå‡ºäº†ä¸€ç§ç›´æ¥å¼ºåŒ–å­¦ä¹ å¯¹é½åé¦ˆï¼ˆDIRECT-RLAIFï¼‰æ–¹æ³•ï¼Œé€šè¿‡è¾ƒå¤§çš„LLMç”Ÿæˆåå¥½ä¿¡å·æŒ‡å¯¼è¾ƒå°æ¨¡å‹ã€‚</li><li>æ ¸å¿ƒåˆ›æ–°ç‚¹åœ¨äºåˆ©ç”¨è¾ƒå¼ºçš„LLMæ¨¡å‹ä½œä¸ºåŠ¨æ€è¯„ä¼°è€…ï¼Œé¿å…ä¼ ç»Ÿå¥–åŠ±æ¨¡å‹ä¸­å­˜åœ¨çš„â€œå¥–åŠ±é™ˆæ—§æ€§â€é—®é¢˜ã€‚</li><li>ä½œè€…éªŒè¯äº†è¿™ç§æ–¹æ³•åœ¨å¯¹é½ç”Ÿæˆä»»åŠ¡ä¸­çš„æœ‰æ•ˆæ€§ï¼Œç‰¹åˆ«æ˜¯åœ¨å¼€æ”¾å¼å¯¹è¯ä¸­çš„æ˜¾è‘—æ”¹è¿›ã€‚</li><li>DIRECT-RLAIFä¸ºæ›´é«˜æ•ˆçš„å¯¹é½æ–¹æ³•æä¾›äº†ç†è®ºåŸºç¡€ã€‚</li><li>ç ”ç©¶ç»“æœè¡¨æ˜ï¼Œè¿™ç§æ–¹æ³•å¯ä»¥åœ¨è¾ƒå°‘äººå·¥å¹²é¢„çš„æƒ…å†µä¸‹ç”Ÿæˆç¬¦åˆäººç±»åå¥½çš„å†…å®¹ã€‚</li></ul><h6 id="3-OAIFã€Guo-et-al-2024ã€‘ï¼š"><a href="#3-OAIFã€Guo-et-al-2024ã€‘ï¼š" class="headerlink" title="3. OAIFã€Guo et al., 2024ã€‘ï¼š"></a>3. <strong>OAIF</strong>ã€Guo et al., 2024ã€‘ï¼š</h6><ul><li>æå‡ºäº†åœ¨çº¿AIåé¦ˆï¼ˆOnline AI Feedback, OAIFï¼‰æ¡†æ¶ï¼Œé€šè¿‡å®æ—¶åŸåˆ™æŒ‡å¯¼æå‡æ¨¡å‹è¯„ä¼°çš„çµæ´»æ€§ã€‚</li><li>æ ¸å¿ƒåˆ›æ–°ç‚¹åœ¨äºåŠ¨æ€è°ƒæ•´è¯„ä¼°è§„åˆ™ï¼Œä½¿æ¨¡å‹èƒ½å¤Ÿé€‚åº”å¤šå˜çš„ä»»åŠ¡éœ€æ±‚ã€‚</li><li>OAIFå¼•å…¥äº†ç»†ç²’åº¦çš„å¤šç»´è¯„åˆ†ç­–ç•¥ï¼Œä¸ºæ¯ä¸ªå€™é€‰é¡¹ç”Ÿæˆç‹¬ç«‹çš„è¯„ä¼°æŠ¥å‘Šã€‚</li><li>ä½œè€…éªŒè¯äº†è¿™ç§æ–¹æ³•åœ¨å®æ—¶å†³ç­–ä¸­çš„æ½œåŠ›ï¼Œå°¤å…¶åœ¨å¯¹è¯å’Œç”Ÿæˆä»»åŠ¡ä¸­è¡¨ç°çªå‡ºã€‚</li><li>OAIFå±•ç°äº†è§„åˆ™å¢å¼ºçš„å®æ—¶é€‚åº”èƒ½åŠ›ï¼Œä¸ºå®æ—¶è¯„ä¼°ä»»åŠ¡æä¾›äº†æ–°æ–¹å‘ã€‚</li></ul><hr><h4 id="5-3-æ£€ç´¢ï¼ˆRetrievalï¼‰"><a href="#5-3-æ£€ç´¢ï¼ˆRetrievalï¼‰" class="headerlink" title="5.3 æ£€ç´¢ï¼ˆRetrievalï¼‰"></a>5.3 æ£€ç´¢ï¼ˆRetrievalï¼‰</h4><h5 id="æ¦‚è¿°-11"><a href="#æ¦‚è¿°-11" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h5><p>åœ¨æ£€ç´¢åœºæ™¯ä¸­ï¼ŒLLM-as-a-Judgeä¸»è¦ç”¨äºæå‡æ–‡æ¡£æ’åºçš„ç²¾åº¦å’Œæ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGï¼‰çš„æ•ˆæœã€‚é€šè¿‡æ›´é«˜æ•ˆçš„æ’åºç®—æ³•ï¼ŒLLMèƒ½å¤Ÿåœ¨ä¼ ç»Ÿæ£€ç´¢å’Œå¤æ‚ç”Ÿæˆä»»åŠ¡ä¸­æä¾›æ›´é«˜è´¨é‡çš„ç›¸å…³æ€§è¯„ä¼°ã€‚</p><h6 id="1-Ranked-Pairingã€Zhai-et-al-2024ã€‘ï¼š-1"><a href="#1-Ranked-Pairingã€Zhai-et-al-2024ã€‘ï¼š-1" class="headerlink" title="1. Ranked Pairingã€Zhai et al., 2024ã€‘ï¼š"></a>1. <strong>Ranked Pairing</strong>ã€Zhai et al., 2024ã€‘ï¼š</h6><ul><li>æå‡ºäº†ä¸€ç§åŸºäºåŸºçº¿æ¯”è¾ƒçš„æ’åºæ–¹æ³•ï¼Œé€šè¿‡å¯¹æ‰€æœ‰å€™é€‰é¡¹ä¸åŸºçº¿è¿›è¡Œæ¯”è¾ƒç¡®å®šä¼˜åŠ£ã€‚</li><li>åˆ›æ–°ç‚¹åœ¨äºé¿å…ä¼ ç»Ÿä¸¤ä¸¤æ¯”è¾ƒçš„é«˜è®¡ç®—å¼€é”€ï¼Œæ˜¾è‘—æé«˜äº†è¯„ä¼°æ•ˆç‡ã€‚</li><li>ä½œè€…è¿˜è®¾è®¡äº†ä¸€ç§è‡ªé€‚åº”æ¯”è¾ƒç­–ç•¥ï¼Œè¿›ä¸€æ­¥ä¼˜åŒ–æ’åºæ€§èƒ½ã€‚</li><li>ç ”ç©¶è¡¨æ˜ï¼ŒRanked Pairingåœ¨å¤§è§„æ¨¡æ’åºä»»åŠ¡ä¸­è¡¨ç°å‡ºæé«˜çš„æ•ˆç‡ã€‚</li><li>æ­¤æ–¹æ³•ç‰¹åˆ«é€‚ç”¨äºéœ€è¦å¿«é€Ÿç”Ÿæˆæ’åºç»“æœçš„åœºæ™¯ã€‚</li></ul><h6 id="2-LLM-Evalã€Lin-and-Chen-2023aã€‘ï¼š"><a href="#2-LLM-Evalã€Lin-and-Chen-2023aã€‘ï¼š" class="headerlink" title="2. LLM-Evalã€Lin and Chen, 2023aã€‘ï¼š"></a>2. <strong>LLM-Eval</strong>ã€Lin and Chen, 2023aã€‘ï¼š</h6><ul><li>æå‡ºäº†åœ¨å¯¹è¯ç”Ÿæˆä¸­çš„ç›¸å…³æ€§è¯„ä¼°æ¡†æ¶ï¼Œåˆ©ç”¨LLMæ›¿ä»£äººå·¥æ ‡æ³¨ã€‚</li><li>åˆ›æ–°ç‚¹åœ¨äºè®¾è®¡äº†ç»“åˆä¸Šä¸‹æ–‡å’Œç”Ÿæˆå†…å®¹çš„æç¤ºæŠ€æœ¯ï¼Œç¡®ä¿è¯„ä¼°æ›´åŠ ç²¾ç¡®ã€‚</li><li>ä½œè€…é€šè¿‡å¯¹æ¯”å®éªŒéªŒè¯äº†LLMåœ¨ä¼šè¯ç›¸å…³æ€§è¯„ä¼°ä¸­çš„æ½œåŠ›ï¼Œç»“æœä¸äººå·¥æ ‡æ³¨é«˜åº¦ä¸€è‡´ã€‚</li><li>æ­¤æ¡†æ¶æ˜¾è‘—å‡å°‘äº†è¯„ä¼°æˆæœ¬ï¼ŒåŒæ—¶æå‡äº†æ•ˆç‡ã€‚</li><li>LLM-Evalåœ¨å¯¹è¯ç”Ÿæˆä»»åŠ¡ä¸­çš„åº”ç”¨è¡¨æ˜ï¼Œæ¨¡å‹åœ¨ç”Ÿæˆè¯„ä¼°ä¸­çš„è§’è‰²æ—¥ç›Šé‡è¦ã€‚</li></ul><h6 id="3-ToT-Tree-of-Thought-ã€Yao-et-al-2023aã€‘ï¼š"><a href="#3-ToT-Tree-of-Thought-ã€Yao-et-al-2023aã€‘ï¼š" class="headerlink" title="3. **ToT (Tree of Thought)**ã€Yao et al., 2023aã€‘ï¼š"></a>3. **ToT (Tree of Thought)**ã€Yao et al., 2023aã€‘ï¼š</h6><ul><li>æå‡ºäº†é€šè¿‡æ ‘çŠ¶ç»“æ„å¢å¼ºæ¨ç†èƒ½åŠ›çš„æ–¹æ³•ï¼Œå¹¶ç»“åˆLLMè¿›è¡Œè¯„ä¼°ã€‚</li><li>åˆ›æ–°ç‚¹åœ¨äºå¼•å…¥äº†çŠ¶æ€è¯„ä¼°æ¨¡å—ï¼Œé€šè¿‡é€æ­¥ç­›é€‰æœ€ä¼˜æ¨ç†è·¯å¾„æå‡æ£€ç´¢å’Œç”Ÿæˆä»»åŠ¡çš„ç²¾åº¦ã€‚</li><li>ç ”ç©¶è¡¨æ˜ï¼ŒToTæ¡†æ¶æ˜¾è‘—æå‡äº†å¤æ‚ä»»åŠ¡çš„è§£å†³èƒ½åŠ›ï¼Œå°¤å…¶åœ¨å¤šæ­¥æ¨ç†å’Œå†³ç­–ä¸­è¡¨ç°ä¼˜å¼‚ã€‚</li><li>ä½œè€…è¿˜æå‡ºäº†è¯„ä¼°è·¯å¾„çš„åŠ¨æ€è°ƒæ•´æœºåˆ¶ï¼Œä½¿LLMèƒ½å¤Ÿæ›´çµæ´»åœ°åº”å¯¹å¤šæ ·åŒ–ä»»åŠ¡ã€‚</li><li>ToTéªŒè¯äº†ç»“æ„åŒ–è¯„ä¼°æ¡†æ¶åœ¨å¤æ‚ä»»åŠ¡ä¸­çš„æœ‰æ•ˆæ€§ã€‚</li></ul><hr><h4 id="5-4-æ¨ç†ï¼ˆReasoningï¼‰"><a href="#5-4-æ¨ç†ï¼ˆReasoningï¼‰" class="headerlink" title="5.4 æ¨ç†ï¼ˆReasoningï¼‰"></a>5.4 æ¨ç†ï¼ˆReasoningï¼‰</h4><h5 id="æ¦‚è¿°-12"><a href="#æ¦‚è¿°-12" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h5><p>æ¨ç†ä»»åŠ¡çš„æ ¸å¿ƒæ˜¯è¯„ä¼°LLMçš„ä¸­é—´æ¨ç†è¿‡ç¨‹å’Œæœ€ç»ˆç­”æ¡ˆçš„æ­£ç¡®æ€§ã€‚LLM-as-a-Judgeåœ¨æ•°å­¦æ¨ç†ã€æ—¶é—´æ¨ç†å’Œå¤æ‚é€»è¾‘æ¨ç†ä»»åŠ¡ä¸­å±•ç¤ºäº†æ˜¾è‘—çš„è¯„ä¼°èƒ½åŠ›ã€‚</p><h6 id="1-HALU-Jã€Wang-et-al-2024aã€‘ï¼š"><a href="#1-HALU-Jã€Wang-et-al-2024aã€‘ï¼š" class="headerlink" title="1. HALU-Jã€Wang et al., 2024aã€‘ï¼š"></a>1. <strong>HALU-J</strong>ã€Wang et al., 2024aã€‘ï¼š</h6><ul><li>æå‡ºäº†ä¸€ç§åŸºäºæ‰¹è¯„çš„åå¥½å­¦ä¹ æ–¹æ³•ï¼Œä¸“æ³¨äºé€‰æ‹©ç›¸å…³è¯æ®å¹¶ç”Ÿæˆè¯¦ç»†æ‰¹è¯„ã€‚</li><li>åˆ›æ–°ç‚¹åœ¨äºè®¾è®¡äº†å¤šè¯æ®é€‰æ‹©æœºåˆ¶ï¼Œæé«˜äº†LLMçš„å¯é æ€§è¯„ä¼°èƒ½åŠ›ã€‚</li><li>è¯¥æ–¹æ³•é€šè¿‡Directed Preference Optimizationï¼ˆDPOï¼‰è¿›è¡Œä¼˜åŒ–ï¼Œä½¿æ¨¡å‹èƒ½å¤Ÿæ›´å‡†ç¡®åœ°åˆ¤æ–­ä»»åŠ¡é—´çš„ä¼˜åŠ£ã€‚</li><li>HALU-Jè¿˜ç»“åˆäº†ä¸Šä¸‹æ–‡æ¨ç†ï¼Œæ‰©å±•äº†åå¥½å­¦ä¹ çš„åº”ç”¨åœºæ™¯ã€‚</li><li>å®éªŒè¡¨æ˜ï¼ŒHALU-Jæ˜¾è‘—æå‡äº†å¤æ‚ä»»åŠ¡çš„è¯„ä¼°å‡†ç¡®æ€§ï¼Œå°¤å…¶æ˜¯åœ¨äº‹å®æ€§å’Œé€»è¾‘æ€§åˆ¤æ–­ä¸Šã€‚</li></ul><h6 id="2-KIEvalã€Yu-et-al-2024ã€‘ï¼š"><a href="#2-KIEvalã€Yu-et-al-2024ã€‘ï¼š" class="headerlink" title="2. KIEvalã€Yu et al., 2024ã€‘ï¼š"></a>2. <strong>KIEval</strong>ã€Yu et al., 2024ã€‘ï¼š</h6><ul><li>æå‡ºäº†çŸ¥è¯†äº¤äº’å¼è¯„ä¼°æ¡†æ¶ï¼Œé€šè¿‡åŠ¨æ€é—®ç­”ç”Ÿæˆä¸°å¯Œçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚</li><li>åˆ›æ–°ç‚¹åœ¨äºå¼•å…¥äº†â€œäº¤äº’è€…â€è§’è‰²ï¼Œæ¨¡æ‹Ÿç”¨æˆ·å’Œæ¨¡å‹ä¹‹é—´çš„åŠ¨æ€äº¤äº’ã€‚</li><li>ä½œè€…è®¾è®¡äº†ä¸€ç§é²æ£’æ€§æ£€æµ‹æœºåˆ¶ï¼Œé¿å…å› ä¸Šä¸‹æ–‡æ±¡æŸ“å¯¼è‡´çš„é”™è¯¯è¯„ä¼°ã€‚</li><li>ç ”ç©¶è¡¨æ˜ï¼ŒKIEvalåœ¨å¤æ‚ä»»åŠ¡ä¸­çš„è¡¨ç°ä¼˜äºä¼ ç»Ÿé™æ€è¯„ä¼°æ–¹æ³•ã€‚</li><li>æ­¤æ¡†æ¶é€‚ç”¨äºå¤šç»´åº¦è¯„ä¼°ï¼Œç‰¹åˆ«æ˜¯åœ¨éœ€è¦åŠ¨æ€è°ƒæ•´ä¸Šä¸‹æ–‡çš„åœºæ™¯ä¸­ã€‚</li></ul><hr><h3 id="6-è¯„ä¼°åŸºå‡†"><a href="#6-è¯„ä¼°åŸºå‡†" class="headerlink" title="6. è¯„ä¼°åŸºå‡†"></a>6. è¯„ä¼°åŸºå‡†</h3><h4 id="æ¦‚è¿°-13"><a href="#æ¦‚è¿°-13" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h4><p>è¯„ä¼°åŸºå‡†æ˜¯éªŒè¯LLM-as-a-Judgeèƒ½åŠ›çš„é‡è¦å·¥å…·ã€‚æœ¬èŠ‚æ•´ç†å¹¶ä»‹ç»å½“å‰ç”¨äºä¸åŒè¯„ä¼°ç»´åº¦çš„åŸºå‡†ï¼ŒåŒ…æ‹¬æœ‰ç”¨æ€§ã€æ— å®³æ€§ã€å¯é æ€§ç­‰æ–¹é¢çš„å…·ä½“æ¡†æ¶å’Œå…¶æ ¸å¿ƒæ€æƒ³ã€‚è¿™äº›åŸºå‡†è¦†ç›–äº†ä»å¯¹è¯ç”Ÿæˆåˆ°å¤æ‚ä»»åŠ¡æ¨ç†çš„å¹¿æ³›åº”ç”¨åœºæ™¯ï¼Œä¸ºåç»­ç ”ç©¶æä¾›äº†å…³é”®æ•°æ®æ”¯æŒã€‚</p><hr><h5 id="6-1-ç»¼åˆè¯„ä¼°åŸºå‡†"><a href="#6-1-ç»¼åˆè¯„ä¼°åŸºå‡†" class="headerlink" title="6.1 ç»¼åˆè¯„ä¼°åŸºå‡†"></a>6.1 ç»¼åˆè¯„ä¼°åŸºå‡†</h5><h6 id="1-SORRY-Benchã€Xie-et-al-2024aã€‘ï¼š"><a href="#1-SORRY-Benchã€Xie-et-al-2024aã€‘ï¼š" class="headerlink" title="1. SORRY-Benchã€Xie et al., 2024aã€‘ï¼š"></a>1. <strong>SORRY-Bench</strong>ã€Xie et al., 2024aã€‘ï¼š</h6><ul><li>è®¾è®¡äº†ä¸€ä¸ªä¸“æ³¨äºå®‰å…¨æ€§å’Œæ— å®³æ€§è¯„ä¼°çš„ç»¼åˆåŸºå‡†ï¼Œé‡ç‚¹æµ‹è¯•LLMå¯¹æ½œåœ¨æœ‰å®³å†…å®¹çš„æ‹’ç»èƒ½åŠ›ã€‚</li><li>åˆ›æ–°ç‚¹åœ¨äºæä¾›äº†ä¸€ä¸ªå¤šæ¨¡å‹å¯¹æ¯”æ¡†æ¶ï¼ŒåŒ…æ‹¬å¼€æºå’Œä¸“æœ‰LLMçš„è¡¨ç°åˆ†æã€‚</li><li>åŸºå‡†æ•°æ®é›†æ¶µç›–å¤šç§æ½œåœ¨å±é™©åœºæ™¯ï¼Œå¦‚æ”¿æ²»æ•æ„Ÿå†…å®¹å’Œè™šå‡ä¿¡æ¯ç”Ÿæˆã€‚</li><li>ä½œè€…è¿˜å¼•å…¥äº†åŠ¨æ€æ‹’ç»ç‡ä½œä¸ºè¡¡é‡æŒ‡æ ‡ï¼Œå±•ç¤ºäº†ä¸åŒæ¨¡å‹åœ¨æ‹’ç»ä»»åŠ¡ä¸­çš„ç»†ç²’åº¦è¡¨ç°ã€‚</li><li>å®éªŒè¡¨æ˜ï¼Œå°å‹LLMç»è¿‡å¾®è°ƒåå¯ä»¥åœ¨å®‰å…¨æ€§è¯„ä¼°ä¸­è¾¾åˆ°ä¸å¤§å‹æ¨¡å‹ç›¸å½“çš„æ°´å¹³ã€‚</li></ul><h6 id="2-HalluJudgeã€Luo-et-al-2024ã€‘ï¼š"><a href="#2-HalluJudgeã€Luo-et-al-2024ã€‘ï¼š" class="headerlink" title="2. HalluJudgeã€Luo et al., 2024ã€‘ï¼š"></a>2. <strong>HalluJudge</strong>ã€Luo et al., 2024ã€‘ï¼š</h6><ul><li>æå‡ºäº†ä¸€ä¸ªä¸“é—¨ç”¨äºå¯¹è¯çº§äº‹å®æ€§è¯„ä¼°çš„åŸºå‡†ï¼Œæ¶µç›–å¤§è§„æ¨¡å¯¹è¯æ•°æ®é›†ã€‚</li><li>æ ¸å¿ƒåˆ›æ–°åœ¨äºè®¾è®¡äº†ä¸€ç§ç»†ç²’åº¦çš„äº‹å®æ€§è¯„åˆ†æœºåˆ¶ï¼Œé€šè¿‡å¼•å…¥ä¸Šä¸‹æ–‡éªŒè¯ç”Ÿæˆå†…å®¹çš„å‡†ç¡®æ€§ã€‚</li><li>æ•°æ®é›†ä¸­åŒ…æ‹¬å¤šç§ç±»å‹çš„äº‹å®æ€§é”™è¯¯ï¼Œå¦‚æ•°æ®é—æ¼ã€æ¨¡ç³Šè¡¨è¿°å’Œç›´æ¥è™šå‡ä¿¡æ¯ã€‚</li><li>HalluJudgeè¿˜æ•´åˆäº†è‡ªåŠ¨åŒ–å’Œäººå·¥è¯„ä¼°æ–¹æ³•ï¼Œæé«˜äº†åŸºå‡†çš„è¦†ç›–é¢å’Œå¯é æ€§ã€‚</li><li>å®éªŒç»“æœè¡¨æ˜ï¼ŒHalluJudgeèƒ½å¤Ÿæ˜¾è‘—æé«˜LLMåœ¨å¯¹è¯åœºæ™¯ä¸­çš„äº‹å®æ€§æ£€æµ‹èƒ½åŠ›ã€‚</li></ul><hr><h5 id="6-2-ä¸“ç”¨é¢†åŸŸè¯„ä¼°åŸºå‡†"><a href="#6-2-ä¸“ç”¨é¢†åŸŸè¯„ä¼°åŸºå‡†" class="headerlink" title="6.2 ä¸“ç”¨é¢†åŸŸè¯„ä¼°åŸºå‡†"></a>6.2 ä¸“ç”¨é¢†åŸŸè¯„ä¼°åŸºå‡†</h5><h6 id="1-FaithScoreã€Jing-et-al-2024ã€‘ï¼š"><a href="#1-FaithScoreã€Jing-et-al-2024ã€‘ï¼š" class="headerlink" title="1. FaithScoreã€Jing et al., 2024ã€‘ï¼š"></a>1. <strong>FaithScore</strong>ã€Jing et al., 2024ã€‘ï¼š</h6><ul><li>FaithScoreæ˜¯ç¬¬ä¸€ä¸ªè·¨æ¨¡æ€çš„å¯é æ€§è¯„ä¼°æ¡†æ¶ï¼Œé€‚ç”¨äºæ–‡æœ¬å’Œå›¾åƒç”Ÿæˆä»»åŠ¡ã€‚</li><li>åˆ›æ–°ç‚¹åœ¨äºè®¾è®¡äº†å¤šæ¨¡æ€è¯„ä¼°æ–¹æ³•ï¼Œç»“åˆè¯­è¨€å’Œè§†è§‰ä¿¡å·æ¥éªŒè¯ç”Ÿæˆå†…å®¹çš„çœŸå®æ€§ã€‚</li><li>æ•°æ®é›†è¦†ç›–äº†ä»äº‹å®æè¿°åˆ°è·¨æ¨¡æ€æ¨ç†çš„å¤šä¸ªä»»åŠ¡ï¼Œæµ‹è¯•äº†æ¨¡å‹çš„å…¨å±€ä¸€è‡´æ€§å’Œç»†èŠ‚å‡†ç¡®æ€§ã€‚</li><li>FaithScoreè¿˜å¼•å…¥äº†å¤šé˜¶æ®µè¯„åˆ†æœºåˆ¶ï¼Œé€æ­¥åˆ†è§£ä»»åŠ¡ä»¥æé«˜è¯„ä¼°çš„ç²¾ç»†åŒ–ç¨‹åº¦ã€‚</li><li>å®éªŒæ˜¾ç¤ºï¼ŒFaithScoreåœ¨å¤šæ¨¡æ€ç”Ÿæˆä»»åŠ¡ä¸­çš„è¯„ä¼°ç»“æœä¸äººå·¥è¯„åˆ†é«˜åº¦ä¸€è‡´ã€‚</li></ul><h6 id="2-GEMBAã€Kocmi-and-Federmann-2023ã€‘ï¼š"><a href="#2-GEMBAã€Kocmi-and-Federmann-2023ã€‘ï¼š" class="headerlink" title="2. GEMBAã€Kocmi and Federmann, 2023ã€‘ï¼š"></a>2. <strong>GEMBA</strong>ã€Kocmi and Federmann, 2023ã€‘ï¼š</h6><ul><li>GEMBAåŸºå‡†ä¸“æ³¨äºæœºå™¨ç¿»è¯‘å’Œæ–‡æœ¬æ‘˜è¦ä»»åŠ¡çš„æ•´ä½“è´¨é‡è¯„ä¼°ã€‚</li><li>æ ¸å¿ƒåˆ›æ–°ç‚¹åœ¨äºç»“åˆBLEUç­‰ä¼ ç»ŸæŒ‡æ ‡å’ŒLLMç”Ÿæˆçš„ç»¼åˆè¯„åˆ†ï¼Œæä¾›æ›´å…¨é¢çš„è¯„ä¼°ç»“æœã€‚</li><li>æ•°æ®é›†ä¸­åŒ…å«å¤šç§è¯­è¨€å’Œé¢†åŸŸçš„çœŸå®æ–‡æœ¬ï¼Œè¦†ç›–å¤šæ ·åŒ–çš„ä»»åŠ¡éœ€æ±‚ã€‚</li><li>ä½œè€…è®¾è®¡äº†ä¸€ç§åŠ¨æ€åé¦ˆæœºåˆ¶ï¼Œå…è®¸LLMåœ¨è¯„ä¼°è¿‡ç¨‹ä¸­è¿›è¡Œè‡ªé€‚åº”è°ƒæ•´ã€‚</li><li>GEMBAåŸºå‡†çš„å¼•å…¥æ˜¾è‘—æ¨åŠ¨äº†æœºå™¨ç¿»è¯‘å’Œæ‘˜è¦ä»»åŠ¡ä¸­LLM-as-a-Judgeçš„åº”ç”¨ã€‚</li></ul><h6 id="3-Just-Evalã€Lin-et-al-2023ã€‘ï¼š"><a href="#3-Just-Evalã€Lin-et-al-2023ã€‘ï¼š" class="headerlink" title="3. Just-Evalã€Lin et al., 2023ã€‘ï¼š"></a>3. <strong>Just-Eval</strong>ã€Lin et al., 2023ã€‘ï¼š</h6><ul><li>æå‡ºäº†ä¸€ä¸ªåŸºäºç”Ÿæˆå†…å®¹æœ‰ç”¨æ€§å’Œæ— å®³æ€§çš„ç»¼åˆåŸºå‡†ï¼Œé€‚ç”¨äºå¹¿æ³›çš„å¼€æ”¾å¼ä»»åŠ¡ã€‚</li><li>åˆ›æ–°ç‚¹åœ¨äºä¸ºä¸åŒä»»åŠ¡è®¾è®¡äº†å®šåˆ¶åŒ–çš„è¯„ä¼°æ ‡å‡†ï¼Œå¹¶ç»“åˆå¤šç»´è¯„åˆ†ç³»ç»Ÿç”Ÿæˆæœ€ç»ˆè¯„ä»·ã€‚</li><li>æ•°æ®é›†ä¸­æ¶µç›–äº†å¯¹è¯ã€é—®ç­”å’Œå¤æ‚æ¨ç†ç­‰ä»»åŠ¡ï¼ŒéªŒè¯äº†åŸºå‡†çš„é€šç”¨æ€§ã€‚</li><li>ä½œè€…è¿˜åˆ†æäº†æ¨¡å‹åœ¨ä¸åŒä»»åŠ¡å’Œé¢†åŸŸä¸Šçš„è¡¨ç°ï¼Œæä¾›äº†è¯¦ç»†çš„å¯¹æ¯”ç»“æœã€‚</li><li>Just-Evalçš„åº”ç”¨è¡¨æ˜ï¼Œè¯„ä¼°æ¡†æ¶éœ€è¦ç»“åˆä»»åŠ¡ç‰¹ç‚¹è¿›è¡Œä¼˜åŒ–ï¼Œæ‰èƒ½æœ€å¤§åŒ–è¯„ä¼°çš„å‡†ç¡®æ€§ã€‚</li></ul><hr><h4 id="6-3-åŠ¨æ€è¯„ä¼°åŸºå‡†"><a href="#6-3-åŠ¨æ€è¯„ä¼°åŸºå‡†" class="headerlink" title="6.3 åŠ¨æ€è¯„ä¼°åŸºå‡†"></a>6.3 åŠ¨æ€è¯„ä¼°åŸºå‡†</h4><h6 id="1-RevisEvalã€Zhang-et-al-2024eã€‘ï¼š"><a href="#1-RevisEvalã€Zhang-et-al-2024eã€‘ï¼š" class="headerlink" title="1. RevisEvalã€Zhang et al., 2024eã€‘ï¼š"></a>1. <strong>RevisEval</strong>ã€Zhang et al., 2024eã€‘ï¼š</h6><ul><li>RevisEvalé€šè¿‡å¼•å…¥åŠ¨æ€è‡ªæˆ‘ä¿®æ­£æœºåˆ¶ï¼Œè®©LLMåœ¨ç”Ÿæˆè¯„ä¼°ä¹‹å‰å¯¹è¾“å‡ºè¿›è¡Œå¤šæ¬¡è°ƒæ•´ã€‚</li><li>æ ¸å¿ƒåˆ›æ–°åœ¨äºç»“åˆLLMçš„è‡ªæˆ‘çº é”™èƒ½åŠ›ï¼Œå°†æœ€ç»ˆè¾“å‡ºç”¨äºå¤šç»´åº¦è¯„ä¼°ã€‚</li><li>æ•°æ®é›†ä¸­è¦†ç›–äº†å¯¹è¯ç”Ÿæˆã€æ‘˜è¦å’Œå¤æ‚æ¨ç†ä»»åŠ¡ï¼ŒéªŒè¯äº†åŸºå‡†çš„åŠ¨æ€é€‚åº”èƒ½åŠ›ã€‚</li><li>RevisEvalå¼•å…¥äº†å¤šè½®åé¦ˆæœºåˆ¶ï¼Œå…è®¸æ¨¡å‹åœ¨è¯„ä¼°è¿‡ç¨‹ä¸­è¿­ä»£æ”¹è¿›ã€‚</li><li>å®éªŒç»“æœè¡¨æ˜ï¼ŒåŠ¨æ€è¯„ä¼°èƒ½å¤Ÿæ˜¾è‘—æå‡å¤æ‚ä»»åŠ¡ä¸­è¯„ä¼°çš„ç²¾ç¡®æ€§å’Œç¨³å®šæ€§ã€‚</li></ul><h6 id="2-Meta-rankingã€Liu-et-al-2024cã€‘ï¼š"><a href="#2-Meta-rankingã€Liu-et-al-2024cã€‘ï¼š" class="headerlink" title="2. Meta-rankingã€Liu et al., 2024cã€‘ï¼š"></a>2. <strong>Meta-ranking</strong>ã€Liu et al., 2024cã€‘ï¼š</h6><ul><li>Meta-rankingæ¡†æ¶é€šè¿‡å¼±æ¨¡å‹ç”Ÿæˆåˆæ­¥æ’åºï¼Œå†ç”±å¼ºæ¨¡å‹è¿›è¡Œæœ€ç»ˆè¯„ä¼°ã€‚</li><li>åˆ›æ–°ç‚¹åœ¨äºä½¿ç”¨å¤šé˜¶æ®µçš„æ’åæ–¹æ³•ï¼Œæé«˜è¯„ä¼°æ•ˆç‡å¹¶é™ä½è®¡ç®—å¼€é”€ã€‚</li><li>æ•°æ®é›†ä¸­åŒ…å«äº†å¤šç§ä»»åŠ¡ç±»å‹ï¼Œå¹¶é€šè¿‡å®éªŒéªŒè¯äº†Meta-rankingçš„é€šç”¨æ€§ã€‚</li><li>è¯¥æ¡†æ¶ç‰¹åˆ«é€‚ç”¨äºå¤§è§„æ¨¡æ’åºä»»åŠ¡ï¼Œæ˜¾è‘—å‡å°‘äº†è¯„ä¼°æ—¶é—´ã€‚</li><li>Meta-rankingå±•ç¤ºäº†å¼±æ¨¡å‹å’Œå¼ºæ¨¡å‹åä½œè¯„ä¼°çš„æ½œåŠ›ï¼Œæ˜¯å¤šæ¨¡å‹è¯„ä¼°çš„æ–°æ–¹å‘ã€‚</li></ul><hr><h3 id="7-æŒ‘æˆ˜ä¸æœªæ¥æ–¹å‘"><a href="#7-æŒ‘æˆ˜ä¸æœªæ¥æ–¹å‘" class="headerlink" title="7. æŒ‘æˆ˜ä¸æœªæ¥æ–¹å‘"></a>7. æŒ‘æˆ˜ä¸æœªæ¥æ–¹å‘</h3><h4 id="æ¦‚è¿°-14"><a href="#æ¦‚è¿°-14" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h4><p>å°½ç®¡LLM-as-a-Judgeåœ¨è¯„ä¼°ä»»åŠ¡ä¸­å±•ç°äº†å¼ºå¤§èƒ½åŠ›ï¼Œä½†ä¾ç„¶é¢ä¸´ç€å¤šæ–¹é¢çš„æŒ‘æˆ˜ã€‚ä¸»è¦é—®é¢˜åŒ…æ‹¬è¯„ä¼°åå·®ä¸è„†å¼±æ€§ã€åŠ¨æ€ä¸å¤æ‚ä»»åŠ¡ä¸­çš„é€‚åº”æ€§ï¼Œä»¥åŠäººæœºååŒè¯„ä¼°çš„æ½œåŠ›ã€‚æœ¬èŠ‚æ¢è®¨è¿™äº›æŒ‘æˆ˜å¹¶æå‡ºæœªæ¥çš„ç ”ç©¶æ–¹å‘ã€‚</p><hr><h5 id="7-1-åå·®ä¸è„†å¼±æ€§"><a href="#7-1-åå·®ä¸è„†å¼±æ€§" class="headerlink" title="7.1 åå·®ä¸è„†å¼±æ€§"></a>7.1 åå·®ä¸è„†å¼±æ€§</h5><h6 id="1-OffsetBiasã€Park-et-al-2024ã€‘ï¼š"><a href="#1-OffsetBiasã€Park-et-al-2024ã€‘ï¼š" class="headerlink" title="1. OffsetBiasã€Park et al., 2024ã€‘ï¼š"></a>1. <strong>OffsetBias</strong>ã€Park et al., 2024ã€‘ï¼š</h6><ul><li>OffsetBiasé€šè¿‡è®¾è®¡ä¸€ä¸ªå»åä¼˜åŒ–æ¡†æ¶ï¼Œå‡å°‘LLMåœ¨è¯„ä¼°ä»»åŠ¡ä¸­çš„ä½ç½®åå·®å’Œå†…å®¹åè§ã€‚</li><li>åˆ›æ–°ç‚¹åœ¨äºä½¿ç”¨åˆæˆæ•°æ®ç”Ÿæˆâ€œåâ€æ ·æœ¬ï¼Œé€šè¿‡è®­ç»ƒæ¨¡å‹è¯†åˆ«å¹¶ä¿®æ­£åå·®ã€‚</li><li>ä½œè€…æå‡ºäº†ä¸€ç§å¤šç»´åº¦çš„å»åå­¦ä¹ æœºåˆ¶ï¼Œç¡®ä¿è¯„ä¼°åœ¨ä¸åŒåœºæ™¯ä¸‹çš„ä¸€è‡´æ€§ã€‚</li><li>ç ”ç©¶è¡¨æ˜ï¼ŒOffsetBiasèƒ½å¤Ÿæ˜¾è‘—é™ä½æ¨¡å‹åœ¨ç”Ÿæˆä»»åŠ¡ä¸­çš„ä¸å…¬å¹³è¡¨ç°ã€‚</li><li>æ­¤æ–¹æ³•ä¸ºå‡å°‘LLMè¯„ä¼°ä¸­çš„åå·®é—®é¢˜æä¾›äº†é‡è¦æ–¹å‘ã€‚</li></ul><h6 id="2-SORRY-Benchã€Xie-et-al-2024aã€‘ï¼š"><a href="#2-SORRY-Benchã€Xie-et-al-2024aã€‘ï¼š" class="headerlink" title="2. SORRY-Benchã€Xie et al., 2024aã€‘ï¼š"></a>2. <strong>SORRY-Bench</strong>ã€Xie et al., 2024aã€‘ï¼š</h6><ul><li>è¿›ä¸€æ­¥ç ”ç©¶äº†æ¨¡å‹åœ¨æ‹’ç»æœ‰å®³å†…å®¹æ—¶å¯èƒ½å‡ºç°çš„è¯¯æ‹’ç»é—®é¢˜ã€‚</li><li>åˆ›æ–°ç‚¹åœ¨äºç»“åˆåŠ¨æ€è¯„åˆ†æœºåˆ¶å’Œæ‹’ç»æ•°æ®é›†ï¼Œåˆ†ææ¨¡å‹åœ¨å¤šç§ä»»åŠ¡ä¸­çš„æ‹’ç»å€¾å‘ã€‚</li><li>ä½œè€…æŒ‡å‡ºï¼Œå°å‹æ¨¡å‹åœ¨ç‰¹å®šåœºæ™¯ä¸­å¯èƒ½æ¯”å¤§å‹æ¨¡å‹æ›´é«˜æ•ˆã€‚</li><li>å®éªŒç»“æœè¡¨æ˜ï¼ŒSORRY-Benchèƒ½å¤Ÿå¸®åŠ©è¯†åˆ«å¹¶å‡è½»è¯„ä¼°åå·®ã€‚</li><li>æ­¤åŸºå‡†æˆä¸ºæ¢è®¨è¯„ä¼°è„†å¼±æ€§çš„ä¸€ä¸ªé‡è¦å·¥å…·ã€‚</li></ul><hr><h5 id="7-2-åŠ¨æ€ä¸å¤æ‚è¯„ä¼°"><a href="#7-2-åŠ¨æ€ä¸å¤æ‚è¯„ä¼°" class="headerlink" title="7.2 åŠ¨æ€ä¸å¤æ‚è¯„ä¼°"></a>7.2 åŠ¨æ€ä¸å¤æ‚è¯„ä¼°</h5><h6 id="1-Tree-of-Thought-ToT-ã€Yao-et-al-2023aã€‘ï¼š"><a href="#1-Tree-of-Thought-ToT-ã€Yao-et-al-2023aã€‘ï¼š" class="headerlink" title="1. **Tree of Thought (ToT)**ã€Yao et al., 2023aã€‘ï¼š"></a>1. **Tree of Thought (ToT)**ã€Yao et al., 2023aã€‘ï¼š</h6><ul><li>ToTé€šè¿‡æ ‘çŠ¶ç»“æ„ä¼˜åŒ–å¤æ‚ä»»åŠ¡çš„å¤šæ­¥æ¨ç†å’Œè¯„ä¼°ã€‚</li><li>åˆ›æ–°ç‚¹åœ¨äºç»“åˆåŠ¨æ€çŠ¶æ€è¯„ä¼°æœºåˆ¶ï¼Œä½¿è¯„ä¼°æ›´åŠ é€‚åº”å¤æ‚å¤šå˜çš„ä»»åŠ¡éœ€æ±‚ã€‚</li><li>æ•°æ®é›†ä¸­è¦†ç›–äº†éœ€è¦å¤šæ­¥æ¨ç†çš„å¤æ‚ä»»åŠ¡ï¼Œå¦‚é—®ç­”å’Œå†³ç­–ä¼˜åŒ–ã€‚</li><li>å®éªŒè¡¨æ˜ï¼ŒToTæ¡†æ¶æ˜¾è‘—æå‡äº†å¤æ‚ä»»åŠ¡çš„è§£å†³èƒ½åŠ›å’Œè¯„ä¼°å‡†ç¡®æ€§ã€‚</li><li>è¯¥ç ”ç©¶ä¸ºåŠ¨æ€è¯„ä¼°æä¾›äº†æ–°çš„ç†è®ºå’Œå®è·µæ”¯æŒã€‚</li></ul><h6 id="2-RAINã€Li-et-al-2024ã€‘ï¼š"><a href="#2-RAINã€Li-et-al-2024ã€‘ï¼š" class="headerlink" title="2. RAINã€Li et al., 2024ã€‘ï¼š"></a>2. <strong>RAIN</strong>ã€Li et al., 2024ã€‘ï¼š</h6><ul><li>RAINæå‡ºäº†å¯å›æº¯çš„è‡ªå›å½’æ¨ç†æœºåˆ¶ï¼Œè®©LLMèƒ½å¤Ÿåœ¨è¯„ä¼°è¿‡ç¨‹ä¸­åŠ¨æ€ä¿®æ­£é”™è¯¯ã€‚</li><li>åˆ›æ–°ç‚¹åœ¨äºç»“åˆè‡ªæˆ‘è¯„ä¼°å’Œå¤šè½®æ¨ç†æœºåˆ¶ï¼Œç¡®ä¿æœ€ç»ˆè¾“å‡ºçš„é«˜è´¨é‡ã€‚</li><li>ä½œè€…è¿˜è®¾è®¡äº†ä¸€ç§åŠ¨æ€è°ƒæ•´æœºåˆ¶ï¼Œä½¿æ¨¡å‹èƒ½å¤Ÿé€‚åº”ä¸åŒä»»åŠ¡çš„å˜åŒ–ã€‚</li><li>å®éªŒæ˜¾ç¤ºï¼ŒRAINåœ¨å¤æ‚ä»»åŠ¡ä¸­çš„è¯„ä¼°èƒ½åŠ›ä¼˜äºä¼ ç»Ÿé™æ€æ–¹æ³•ã€‚</li><li>æ­¤æ¡†æ¶å±•ç¤ºäº†åŠ¨æ€è¯„ä¼°åœ¨å¤æ‚åœºæ™¯ä¸­çš„æ½œåŠ›ã€‚</li></ul><hr><h5 id="7-3-è‡ªæˆ‘è¯„ä¼°ä¸äººæœºååŒ"><a href="#7-3-è‡ªæˆ‘è¯„ä¼°ä¸äººæœºååŒ" class="headerlink" title="7.3 è‡ªæˆ‘è¯„ä¼°ä¸äººæœºååŒ"></a>7.3 è‡ªæˆ‘è¯„ä¼°ä¸äººæœºååŒ</h5><h6 id="1-Self-Taught-Evaluatorsã€Wang-et-al-2024fã€‘ï¼š"><a href="#1-Self-Taught-Evaluatorsã€Wang-et-al-2024fã€‘ï¼š" class="headerlink" title="1. Self-Taught Evaluatorsã€Wang et al., 2024fã€‘ï¼š"></a>1. <strong>Self-Taught Evaluators</strong>ã€Wang et al., 2024fã€‘ï¼š</h6><ul><li>æå‡ºäº†ä¸€ç§è‡ªæˆ‘å­¦ä¹ æ¡†æ¶ï¼Œæ¨¡å‹é€šè¿‡ç”Ÿæˆä½è´¨é‡æ•°æ®å¯¹è‡ªèº«è¿›è¡ŒåŠ¨æ€ä¼˜åŒ–ã€‚</li><li>åˆ›æ–°ç‚¹åœ¨äºå¼•å…¥äº†ä¸€ç§åŠ¨æ€è¯„ä¼°æœºåˆ¶ï¼Œè®©æ¨¡å‹èƒ½å¤Ÿé€æ­¥æå‡è‡ªèº«è¯„ä¼°èƒ½åŠ›ã€‚</li><li>æ•°æ®é›†ä¸­åŒ…æ‹¬äº†å¤šç§ç±»å‹çš„ä»»åŠ¡ï¼Œä¸ºè‡ªæˆ‘è¯„ä¼°æä¾›äº†å¹¿æ³›æ”¯æŒã€‚</li><li>Self-Taught Evaluatorså±•ç¤ºäº†æ¨¡å‹åœ¨æ— éœ€äººå·¥å¹²é¢„æƒ…å†µä¸‹çš„è‡ªæˆ‘æå‡èƒ½åŠ›ã€‚</li><li>æ­¤æ¡†æ¶ä¸ºè‡ªåŠ¨åŒ–è¯„ä¼°ä»»åŠ¡æä¾›äº†æ–°æ€è·¯ã€‚</li></ul><h6 id="2-Meta-Rewardingã€Wu-et-al-2024ã€‘ï¼š"><a href="#2-Meta-Rewardingã€Wu-et-al-2024ã€‘ï¼š" class="headerlink" title="2. Meta-Rewardingã€Wu et al., 2024ã€‘ï¼š"></a>2. <strong>Meta-Rewarding</strong>ã€Wu et al., 2024ã€‘ï¼š</h6><ul><li>Meta-Rewardingé€šè¿‡å°†LLMçš„è‡ªè¯„ä¼°ä¿¡å·ä½œä¸ºåå¥½æ•°æ®ï¼Œç”¨äºè¿›ä¸€æ­¥ä¼˜åŒ–æ¨¡å‹ã€‚</li><li>åˆ›æ–°ç‚¹åœ¨äºç»“åˆç­–ç•¥æ¨¡å‹è‡ªæˆ‘åé¦ˆï¼Œå¢å¼ºæ¨¡å‹çš„è‡ªé€‚åº”èƒ½åŠ›ã€‚</li><li>ä½œè€…è¿˜æ¢è®¨äº†å¦‚ä½•åŠ¨æ€è°ƒæ•´è¯„ä¼°ç­–ç•¥ä»¥æé«˜é²æ£’æ€§ã€‚</li><li>å®éªŒè¡¨æ˜ï¼ŒMeta-Rewardingèƒ½å¤Ÿæ˜¾è‘—æå‡å¤æ‚ä»»åŠ¡ä¸­çš„è¯„ä¼°æ•ˆæœã€‚</li><li>è¯¥ç ”ç©¶å±•ç¤ºäº†äººæœºååŒè¯„ä¼°çš„æ½œåœ¨ä¼˜åŠ¿ã€‚</li></ul><hr>]]></content>
      
      
      <categories>
          
          <category> NLP Insights </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Onnx </tag>
            
            <tag> Deployment </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Reflections on Identity and Subjectivity</title>
      <link href="/2024/12/03/Life%20Reflections/Reflections%20on%20Identity%20and%20Subjectivity/"/>
      <url>/2024/12/03/Life%20Reflections/Reflections%20on%20Identity%20and%20Subjectivity/</url>
      
        <content type="html"><![CDATA[<h1 id="PR-Application-Rejected-Reflections-on-Identity-and-Subjectivity"><a href="#PR-Application-Rejected-Reflections-on-Identity-and-Subjectivity" class="headerlink" title="PR Application Rejected: Reflections on Identity and Subjectivity"></a>PR Application Rejected: Reflections on Identity and Subjectivity</h1><p>When I received the news of my PR application being rejected, after a brief moment of shock, what arose within me was not merely frustration but a peculiar sense of â€œexistential dilemma.â€ On the surface, it seemed like just an administrative outcome, yet it profoundly mirrored the multiple tensions between the structure of contemporary global mobility and the construction of subjectivity.</p><ul><li>Amid the tension between globalization and national sovereignty, is it even possible to affirm an individualâ€™s identity?</li><li>Does the rejection of a PR application symbolically exclude an individual from a collective sense of belonging?</li></ul><hr><h2 id="PR-Application-From-the-Fantasy-of-Rights-to-the-Maze-of-Identity"><a href="#PR-Application-From-the-Fantasy-of-Rights-to-the-Maze-of-Identity" class="headerlink" title="PR Application: From the Fantasy of Rights to the Maze of Identity"></a>PR Application: From the Fantasy of Rights to the Maze of Identity</h2><p>Within the theoretical framework of Anthony Giddensâ€™ <em>Modernity and Self-Identity</em>, applying for PR is not merely a pursuit of residency rights but a symbolic quest for identity stability and future possibilities. However, in the context of globalization, this pursuit often falls into what Derrida describes as the structure of <em>diffÃ©rance</em>: the realization of rights is perpetually deferred, and the confirmation of identity remains suspended.</p><p>In this context, rejection is tantamount to a form of <strong>symbolic violence</strong>. It not only disrupts my plans for the future but also shatters the illusion of subjectivity I held within this domain.</p><hr><h2 id="Subjectivity-vs-Institutional-Discipline"><a href="#Subjectivity-vs-Institutional-Discipline" class="headerlink" title="Subjectivity vs. Institutional Discipline"></a>Subjectivity vs. Institutional Discipline</h2><p>Bourdieuâ€™s field theory reveals the distribution of power in social practices, and the practice of PR applications is a concrete field where power disciplines individuals. Rejection is not merely an administrative outcome but an invisible disciplining of the subject, hinting at the imbalance of power between individuals and institutions in the era of platform capitalism.</p><p>Through Foucaultâ€™s lens of discipline, this process not only constrains individualsâ€™ <strong>physical mobility</strong> but also profoundly affects the <strong>emotional and mental freedom</strong> of individuals.</p><hr><h2 id="From-Loss-to-Reflection"><a href="#From-Loss-to-Reflection" class="headerlink" title="From Loss to Reflection"></a>From Loss to Reflection</h2><p>In a sense, rejection is not an end but an opportunity for <strong>reconstruction</strong>. Baumanâ€™s concept of <em>liquid modernity</em> might help me interpret this failure: in a constantly fluid world, fixed identities and stable senses of belonging are scarce resources. Perhaps I need to redefine my position amid this loss and find my own meaning in the fragments of grand narratives.</p><p>As Å½iÅ¾ek puts it: <strong>â€œTrue freedom is not about getting what you want but about confronting the trauma of reality.â€</strong> The failure of my PR application may not be the end of identity but a challenge to how I reconstruct subjectivity in the face of uncertainty.</p><p>Thus, this is not an ending but a dialectical transformation: in the moment of shattered stability, perhaps lies the beginning of transcending grand narratives and rediscovering the meaning of oneâ€™s existence.</p>]]></content>
      
      
      <categories>
          
          <category> Life Reflections </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Living in Singapore </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>èº«ä»½ä¸ä¸»ä½“æ€§çš„åæ€</title>
      <link href="/2024/12/03/Life%20Reflections/%E8%BA%AB%E4%BB%BD%E4%B8%8E%E4%B8%BB%E4%BD%93%E6%80%A7%E7%9A%84%E5%8F%8D%E6%80%9D/"/>
      <url>/2024/12/03/Life%20Reflections/%E8%BA%AB%E4%BB%BD%E4%B8%8E%E4%B8%BB%E4%BD%93%E6%80%A7%E7%9A%84%E5%8F%8D%E6%80%9D/</url>
      
        <content type="html"><![CDATA[<h1 id="æ°¸å±…ç”³è¯·è¢«æ‹’ï¼šèº«ä»½ä¸ä¸»ä½“æ€§çš„åæ€"><a href="#æ°¸å±…ç”³è¯·è¢«æ‹’ï¼šèº«ä»½ä¸ä¸»ä½“æ€§çš„åæ€" class="headerlink" title="æ°¸å±…ç”³è¯·è¢«æ‹’ï¼šèº«ä»½ä¸ä¸»ä½“æ€§çš„åæ€"></a>æ°¸å±…ç”³è¯·è¢«æ‹’ï¼šèº«ä»½ä¸ä¸»ä½“æ€§çš„åæ€</h1><p>å½“æˆ‘æ¥åˆ°æ°¸å±…ç”³è¯·è¢«æ‹’çš„æ¶ˆæ¯æ—¶ï¼ŒçŸ­æš‚çš„æ„£ç¥ä¹‹åï¼Œå†…å¿ƒæ¶ŒåŠ¨çš„å´å¹¶éå•çº¯çš„æŒ«è´¥ï¼Œè€Œæ˜¯ä¸€ç§å¥‡å¼‚çš„â€œç”Ÿå­˜è®ºå›°å¢ƒâ€æ„Ÿã€‚è¡¨é¢ä¸Šï¼Œè¿™ä¼¼ä¹åªæ˜¯ä¸€æ¬¡è¡Œæ”¿ç»“æœçš„ä½“ç°ï¼Œä½†å…¶èƒŒåå´æ·±åˆ»æŠ˜å°„äº†å½“ä»£å…¨çƒæµåŠ¨æ€§ç»“æ„ä¸ä¸»ä½“æ€§å»ºæ„ä¹‹é—´çš„å¤šé‡å¼ åŠ›ã€‚</p><ul><li>åœ¨å…¨çƒåŒ–ä¸å›½å®¶ä¸»æƒçš„å¼ åŠ›ä¸‹ï¼Œä¸ªä½“èº«ä»½çš„ç¡®è®¤ç©¶ç«Ÿæ˜¯å¦å¯èƒ½ï¼Ÿ</li><li>å½“æ°¸å±…ç”³è¯·è¢«æ‹’æ—¶ï¼Œæ˜¯å¦æ„å‘³ç€ä¸ªä½“è¢«è±¡å¾æ€§åœ°æ’é™¤åœ¨æŸç§é›†ä½“æ„ä¹‰ä¹‹å¤–ï¼Ÿ</li></ul><hr><h2 id="æ°¸å±…ç”³è¯·ï¼šä»æƒåˆ©å¹»æƒ³åˆ°èº«ä»½è¿·å®«"><a href="#æ°¸å±…ç”³è¯·ï¼šä»æƒåˆ©å¹»æƒ³åˆ°èº«ä»½è¿·å®«" class="headerlink" title="æ°¸å±…ç”³è¯·ï¼šä»æƒåˆ©å¹»æƒ³åˆ°èº«ä»½è¿·å®«"></a>æ°¸å±…ç”³è¯·ï¼šä»æƒåˆ©å¹»æƒ³åˆ°èº«ä»½è¿·å®«</h2><p>åœ¨å‰ç™»æ–¯çš„â€œç°ä»£æ€§ä¸è‡ªæˆ‘è®¤åŒâ€ç†è®ºæ¡†æ¶ä¸‹ï¼Œæ°¸å±…ç”³è¯·ä¸ä»…æ˜¯ä¸€ç§å±…ç•™æƒçš„äº‰å–ï¼Œæ›´æ˜¯ä¸€ç§å¯¹èº«ä»½ç¨³å®šæ€§ä¸æœªæ¥å¯èƒ½æ€§çš„ç¬¦å·åŒ–è¿½æ±‚ã€‚ç„¶è€Œï¼Œåœ¨å…¨çƒåŒ–è¯­å¢ƒä¸‹ï¼Œè¿™ç§è¿½æ±‚å¾€å¾€é™·å…¥å¾·é‡Œè¾¾æ‰€æè¿°çš„â€œå»¶å¼‚â€ç»“æ„ï¼šæƒåˆ©çš„å®ç°æ€»æ˜¯è¢«æ¨è¿Ÿï¼Œèº«ä»½çš„ç¡®è®¤æ€»æ˜¯æ‚¬ç½®ã€‚</p><p>åœ¨æ­¤æƒ…å¢ƒä¸­ï¼Œç”³è¯·è¢«æ‹’çš„ç»“æœæ— å¼‚äºä¸€ç§<strong>ç¬¦å·æš´åŠ›</strong>ã€‚å®ƒä¸ä»…æ–­è£‚äº†æˆ‘å¯¹æœªæ¥çš„è§„åˆ’ï¼Œä¹Ÿæ’•è£‚äº†æˆ‘åœ¨è¿™ä¸€åœºåŸŸä¸­çš„ä¸»ä½“æ€§å¹»è±¡ã€‚</p><hr><h2 id="ä¸»ä½“æ€§ä¸åˆ¶åº¦è§„è®­çš„å¯¹æŠ—"><a href="#ä¸»ä½“æ€§ä¸åˆ¶åº¦è§„è®­çš„å¯¹æŠ—" class="headerlink" title="ä¸»ä½“æ€§ä¸åˆ¶åº¦è§„è®­çš„å¯¹æŠ—"></a>ä¸»ä½“æ€§ä¸åˆ¶åº¦è§„è®­çš„å¯¹æŠ—</h2><p>å¸ƒå°”è¿ªå„çš„åœºåŸŸç†è®ºæ­ç¤ºäº†æƒåŠ›åœ¨ç¤¾ä¼šå®è·µä¸­çš„åˆ†å¸ƒæ–¹å¼ï¼Œè€Œæ°¸å±…ç”³è¯·è¿™ä¸€åˆ¶åº¦å®è·µæ­£æ˜¯æƒåŠ›è§„è®­ä¸ªä½“çš„å…·ä½“åŒ–åœºåŸŸã€‚æ‹’ç»ä¸ä»…æ˜¯ä¸€ç§è¡Œæ”¿ç»“æœï¼Œæ›´æ˜¯ä¸€ç§å¯¹ä¸»ä½“çš„éšå½¢è§„è®­ï¼Œæš—ç¤ºäº†å¹³å°èµ„æœ¬ä¸»ä¹‰æ—¶ä»£ä¸ªä½“ä¸åˆ¶åº¦ä¹‹é—´çš„æƒåŠ›å¤±è¡¡ã€‚</p><p>ç¦æŸ¯çš„è§„è®­è§†è§’è®©æˆ‘ä»¬çœ‹åˆ°ï¼Œè¿™ä¸€è¿‡ç¨‹ä¸ä»…é™åˆ¶äº†ä¸ªä½“çš„<strong>ç‰©ç†æµåŠ¨æ€§</strong>ï¼Œä¹Ÿæ·±åˆ»å½±å“äº†<strong>æƒ…æ„Ÿä¸ç²¾ç¥çš„è‡ªç”±æµåŠ¨</strong>ã€‚</p><hr><h2 id="ä»å¤±è½åˆ°åæ€"><a href="#ä»å¤±è½åˆ°åæ€" class="headerlink" title="ä»å¤±è½åˆ°åæ€"></a>ä»å¤±è½åˆ°åæ€</h2><p>ä»æŸç§æ„ä¹‰ä¸Šè¯´ï¼Œè¢«æ‹’å¹¶éä¸€ç§ç»ˆç»“ï¼Œè€Œæ˜¯ä¸€ç§<strong>é‡æ„çš„å¥‘æœº</strong>ã€‚é²æ›¼æå‡ºçš„â€œæ¶²æ€ç°ä»£æ€§â€æˆ–è®¸èƒ½å¸®åŠ©æˆ‘ç†è§£è¿™æ¬¡å¤±è´¥ï¼šåœ¨ä¸€ä¸ªä¸æ–­æµåŠ¨çš„ä¸–ç•Œä¸­ï¼Œå›ºå®šçš„èº«ä»½å’Œç¨³å®šçš„å½’å±æ„Ÿæœ¬å°±æ˜¯ç¨€ç¼ºèµ„æºã€‚æˆ–è®¸ï¼Œæˆ‘éœ€è¦åœ¨å¤±è½ä¸­é‡æ–°å®šä¹‰è‡ªå·±çš„ä½ç½®ï¼Œä»å®å¤§å™äº‹çš„ç ´ç¢ä¸­æ‰¾åˆ°å±äºè‡ªå·±çš„æ„ä¹‰ã€‚</p><p>æ­£å¦‚é½æ³½å…‹æ‰€è¨€ï¼š<strong>â€œçœŸæ­£çš„è‡ªç”±ä¸æ˜¯å¾—åˆ°ä½ æƒ³è¦çš„ï¼Œè€Œæ˜¯é¢å¯¹ç°å®çš„åˆ›ä¼¤ã€‚â€</strong> æ°¸å±…ç”³è¯·çš„å¤±è´¥ä¹Ÿè®¸ä¸æ˜¯èº«ä»½çš„ç»ˆç»“ï¼Œè€Œæ˜¯å¯¹æˆ‘å¦‚ä½•åœ¨ä¸ç¡®å®šæ€§ä¸­é‡æ–°æ„å»ºä¸»ä½“æ€§çš„ç»ˆææŒ‘æˆ˜ã€‚</p><p>å› æ­¤ï¼Œè¿™å¹¶éç»ˆç»“ï¼Œè€Œæ˜¯ä¸€æ¬¡è¾©è¯çš„è½¬åŒ–ï¼šåœ¨ç¨³å®šæ€§ç ´ç¢çš„ç¬é—´ï¼Œæˆ–è®¸æ°æ˜¯æˆ‘ä»¬è¶…è¶Šå®å¤§å™äº‹ã€é‡æ–°å‘ç°è‡ªæˆ‘å­˜åœ¨æ„ä¹‰çš„å¼€ç«¯ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Life Reflections </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¡å²›ç”Ÿæ´»æŒ‡åŒ— </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€Leetcode Pythoné¢˜è§£ã€‘ã€Œ1346. Check If N and Its Double Existã€</title>
      <link href="/2024/12/02/Code%20Chronicles/Leetcode%20Python%E9%A2%98%E8%A7%A3%E3%80%91%E3%80%8C1346.%20Check%20If%20N%20and%20Its%20Double%20Exist%E3%80%8D/"/>
      <url>/2024/12/02/Code%20Chronicles/Leetcode%20Python%E9%A2%98%E8%A7%A3%E3%80%91%E3%80%8C1346.%20Check%20If%20N%20and%20Its%20Double%20Exist%E3%80%8D/</url>
      
        <content type="html"><![CDATA[<h1 id="ã€Leetcode-Pythoné¢˜è§£ã€‘ã€Œ1346-Check-If-N-and-Its-Double-Existã€"><a href="#ã€Leetcode-Pythoné¢˜è§£ã€‘ã€Œ1346-Check-If-N-and-Its-Double-Existã€" class="headerlink" title="ã€Leetcode Pythoné¢˜è§£ã€‘ã€Œ1346. Check If N and Its Double Existã€"></a>ã€Leetcode Pythoné¢˜è§£ã€‘ã€Œ1346. Check If N and Its Double Existã€</h1><h2 id="é¢˜ç›®ï¼š1346-Check-If-N-and-Its-Double-Exist"><a href="#é¢˜ç›®ï¼š1346-Check-If-N-and-Its-Double-Exist" class="headerlink" title="é¢˜ç›®ï¼š1346. Check If N and Its Double Exist"></a>é¢˜ç›®ï¼š<a href="https://leetcode.com/problems/check-if-n-and-its-double-exist/description/?envType=daily-question&amp;envId=2024-12-01">1346. Check If N and Its Double Exist</a></h2><h2 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h2><p>ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ <code>arr</code>ï¼Œæ£€æŸ¥æ˜¯å¦å­˜åœ¨ä¸¤ä¸ªä¸åŒçš„ç´¢å¼• <code>i</code> å’Œ <code>j</code>ï¼Œæ»¡è¶³ï¼š</p><ul><li><code>i != j</code></li><li><code>0 &lt;= i, j &lt; arr.length</code></li><li><code>arr[i] == 2 * arr[j]</code></li></ul><h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><p><strong>ç¤ºä¾‹ 1:</strong></p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šarr = [10,2,5,3]</span><br><span class="line">è¾“å‡ºï¼štrue</span><br><span class="line">è§£é‡Šï¼šå¯¹äº i = 0 å’Œ j = 2ï¼Œarr[i] = 10 ç­‰äº 2 * 5 = 2 * arr[j]</span><br></pre></td></tr></tbody></table></figure><p><strong>ç¤ºä¾‹ 2:</strong></p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šarr = [3,1,7,11]</span><br><span class="line">è¾“å‡ºï¼šfalse</span><br><span class="line">è§£é‡Šï¼šä¸å­˜åœ¨æ»¡è¶³æ¡ä»¶çš„ i å’Œ jã€‚</span><br></pre></td></tr></tbody></table></figure><h3 id="çº¦æŸæ¡ä»¶"><a href="#çº¦æŸæ¡ä»¶" class="headerlink" title="çº¦æŸæ¡ä»¶"></a>çº¦æŸæ¡ä»¶</h3><ul><li><code>2 &lt;= arr.length &lt;= 500</code></li><li><code>-10Â³ &lt;= arr[i] &lt;= 10Â³</code></li></ul><h2 id="è§£é¢˜æ€è·¯"><a href="#è§£é¢˜æ€è·¯" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h2><p>è¿™é“é¢˜å¯ä»¥ç”¨å¤šç§æ–¹æ³•è§£å†³ï¼Œæˆ‘ä»¬æ¥åˆ†æä¸¤ç§ä¸»è¦çš„è§£æ³•ï¼šæš´åŠ›è§£æ³•å’Œå“ˆå¸Œè¡¨è§£æ³•ã€‚</p><h3 id="1-æš´åŠ›è§£æ³•"><a href="#1-æš´åŠ›è§£æ³•" class="headerlink" title="1. æš´åŠ›è§£æ³•"></a>1. æš´åŠ›è§£æ³•</h3><p>æœ€ç›´è§‚çš„è§£æ³•æ˜¯ä½¿ç”¨ä¸¤å±‚å¾ªç¯ï¼Œéå†æ‰€æœ‰å¯èƒ½çš„æ•°å¯¹ã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">checkIfExist</span>(<span class="params">arr</span>):</span><br><span class="line">    n = <span class="built_in">len</span>(arr)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">            <span class="keyword">if</span> i != j <span class="keyword">and</span> arr[i] == <span class="number">2</span> * arr[j]:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></tbody></table></figure><p><strong>å¤æ‚åº¦åˆ†æï¼š</strong></p><ul><li>æ—¶é—´å¤æ‚åº¦ï¼šO(nÂ²)ï¼Œå…¶ä¸­ n æ˜¯æ•°ç»„é•¿åº¦</li><li>ç©ºé—´å¤æ‚åº¦ï¼šO(1)ï¼Œåªä½¿ç”¨äº†å¸¸æ•°é¢å¤–ç©ºé—´</li></ul><h3 id="2-å“ˆå¸Œè¡¨è§£æ³•"><a href="#2-å“ˆå¸Œè¡¨è§£æ³•" class="headerlink" title="2. å“ˆå¸Œè¡¨è§£æ³•"></a>2. å“ˆå¸Œè¡¨è§£æ³•</h3><p>ä½¿ç”¨å“ˆå¸Œè¡¨å¯ä»¥æ˜¾è‘—ä¼˜åŒ–æ—¶é—´å¤æ‚åº¦ã€‚æˆ‘ä»¬åªéœ€è¦ä¸€æ¬¡éå†æ•°ç»„ï¼ŒåŒæ—¶ç”¨å“ˆå¸Œè¡¨è®°å½•å·²ç»é‡åˆ°çš„æ•°å­—ã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">checkIfExist</span>(<span class="params">arr</span>):</span><br><span class="line">    seen = <span class="built_in">set</span>()</span><br><span class="line">    <span class="keyword">for</span> num <span class="keyword">in</span> arr:</span><br><span class="line">        <span class="keyword">if</span> num * <span class="number">2</span> <span class="keyword">in</span> seen <span class="keyword">or</span> (num % <span class="number">2</span> == <span class="number">0</span> <span class="keyword">and</span> num // <span class="number">2</span> <span class="keyword">in</span> seen):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        seen.add(num)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></tbody></table></figure><p><strong>å¤æ‚åº¦åˆ†æï¼š</strong></p><ul><li>æ—¶é—´å¤æ‚åº¦ï¼šO(n)ï¼Œåªéœ€è¦éå†ä¸€æ¬¡æ•°ç»„</li><li>ç©ºé—´å¤æ‚åº¦ï¼šO(n)ï¼Œéœ€è¦é¢å¤–çš„å“ˆå¸Œè¡¨ç©ºé—´</li></ul><h3 id="ä»£ç ä¼˜åŒ–æ¡ˆä¾‹"><a href="#ä»£ç ä¼˜åŒ–æ¡ˆä¾‹" class="headerlink" title="ä»£ç ä¼˜åŒ–æ¡ˆä¾‹"></a>ä»£ç ä¼˜åŒ–æ¡ˆä¾‹</h3><p>è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªåˆå§‹ç‰ˆæœ¬çš„ä»£ç ï¼Œä»¥åŠå¦‚ä½•ä¼˜åŒ–å®ƒï¼š</p><p><strong>åŸå§‹ç‰ˆæœ¬ï¼š</strong></p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">checkIfExist</span>(<span class="params">self, arr: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">        hashmap = {}</span><br><span class="line">        <span class="keyword">for</span> i, item <span class="keyword">in</span> <span class="built_in">enumerate</span>(arr):</span><br><span class="line">            hashmap[i] = item</span><br><span class="line">            <span class="keyword">if</span> item * <span class="number">2</span> <span class="keyword">in</span> hashmap.values():</span><br><span class="line">                j = <span class="built_in">next</span>(k <span class="keyword">for</span> k, v <span class="keyword">in</span> hashmap.items() <span class="keyword">if</span> v == item * <span class="number">2</span>)</span><br><span class="line">                <span class="keyword">if</span> i != j:</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">            <span class="keyword">if</span> item//<span class="number">2</span> <span class="keyword">in</span> hashmap.values() <span class="keyword">and</span> item%<span class="number">2</span>==<span class="number">0</span>:</span><br><span class="line">                j = <span class="built_in">next</span>(k <span class="keyword">for</span> k, v <span class="keyword">in</span> hashmap.items() <span class="keyword">if</span> v == item//<span class="number">2</span>)</span><br><span class="line">                <span class="keyword">if</span> i != j:</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></tbody></table></figure><p><strong>ä¼˜åŒ–ç‰ˆæœ¬ï¼š</strong></p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">checkIfExist</span>(<span class="params">self, arr: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">        seen = <span class="built_in">set</span>()</span><br><span class="line">        <span class="keyword">for</span> num <span class="keyword">in</span> arr:</span><br><span class="line">            <span class="keyword">if</span> num * <span class="number">2</span> <span class="keyword">in</span> seen <span class="keyword">or</span> (num % <span class="number">2</span> == <span class="number">0</span> <span class="keyword">and</span> num // <span class="number">2</span> <span class="keyword">in</span> seen):</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">            seen.add(num)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></tbody></table></figure><h3 id="ä¼˜åŒ–è¦ç‚¹"><a href="#ä¼˜åŒ–è¦ç‚¹" class="headerlink" title="ä¼˜åŒ–è¦ç‚¹"></a>ä¼˜åŒ–è¦ç‚¹</h3><ol><li><p><strong>æ•°æ®ç»“æ„é€‰æ‹©</strong></p><ul><li>ä½¿ç”¨é›†åˆ(set)æ›¿ä»£å­—å…¸(dict)</li><li>ä¸éœ€è¦å­˜å‚¨ç´¢å¼•ä¿¡æ¯ï¼Œåªå…³æ³¨å€¼çš„å­˜åœ¨æ€§</li></ul></li><li><p><strong>ä»£ç ç®€åŒ–</strong></p><ul><li>åˆå¹¶é‡å¤çš„æ£€æŸ¥é€»è¾‘</li><li>ç§»é™¤ä¸å¿…è¦çš„å˜é‡å’Œè®¡ç®—</li><li>ä½¿ç”¨æ›´ç®€æ´çš„æ¡ä»¶åˆ¤æ–­</li></ul></li><li><p><strong>æ€§èƒ½æå‡</strong></p><ul><li>é¿å…ä½¿ç”¨ <code>hashmap.values()</code> éå†</li><li>ä½¿ç”¨é›†åˆçš„ O(1) æŸ¥æ‰¾ç‰¹æ€§</li><li>å‡å°‘é‡å¤è®¡ç®—</li></ul></li></ol><h2 id="å…³é”®æ³¨æ„ç‚¹"><a href="#å…³é”®æ³¨æ„ç‚¹" class="headerlink" title="å…³é”®æ³¨æ„ç‚¹"></a>å…³é”®æ³¨æ„ç‚¹</h2><ol><li><p><strong>è¾¹ç•Œæƒ…å†µå¤„ç†</strong></p><ul><li>è€ƒè™‘æ•°ç»„ä¸­æœ‰ 0 çš„æƒ…å†µï¼ˆ0 çš„ä¸¤å€ä»ç„¶æ˜¯ 0ï¼‰</li><li>æ³¨æ„è´Ÿæ•°çš„å¤„ç†</li><li>ç¡®ä¿ä¸ä½¿ç”¨åŒä¸€ä¸ªç´¢å¼•ï¼ˆi != jï¼‰</li></ul></li><li><p><strong>æ•°å€¼æ£€æŸ¥</strong></p><ul><li>éœ€è¦åŒæ—¶æ£€æŸ¥ä¸€ä¸ªæ•°çš„ä¸¤å€å’Œä¸€åŠ</li><li>æ£€æŸ¥ä¸€åŠæ—¶è¦ç¡®ä¿æ•°å­—æ˜¯å¶æ•°</li></ul></li><li><p><strong>æ€§èƒ½ä¼˜åŒ–</strong></p><ul><li>ä½¿ç”¨æ°å½“çš„æ•°æ®ç»“æ„ï¼ˆé›†åˆï¼‰</li><li>é¿å…ä¸å¿…è¦çš„è®¡ç®—å’Œéå†</li></ul></li></ol><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è¿™é“é¢˜å±•ç¤ºäº†å¦‚ä½•é€šè¿‡é€‰æ‹©é€‚å½“çš„æ•°æ®ç»“æ„å’Œä¼˜åŒ–ä»£ç é€»è¾‘æ¥æå‡ç®—æ³•çš„æ€§èƒ½ã€‚ä»åˆå§‹çš„æš´åŠ›è§£æ³•åˆ°ä½¿ç”¨å“ˆå¸Œè¡¨ï¼Œå†åˆ°ä»£ç çš„ä¼˜åŒ–ï¼Œæ¯ä¸€æ­¥éƒ½å¸¦æ¥äº†æ˜¾è‘—çš„æ”¹è¿›ã€‚æœ€ç»ˆçš„è§£å†³æ–¹æ¡ˆä¸ä»…è¿è¡Œæ•ˆç‡é«˜ï¼Œè€Œä¸”ä»£ç ç®€æ´æ˜“æ‡‚ã€‚</p><p>å…³é”®æ˜¯è¦ç†è§£ï¼š</p><ol><li>æš´åŠ›è§£æ³•è™½ç„¶ç›´è§‚ï¼Œä½†æ•ˆç‡ä½ä¸‹</li><li>å“ˆå¸Œè¡¨æä¾›äº†æœ€ä¼˜çš„æ—¶ç©ºæƒè¡¡</li><li>ä»£ç ä¼˜åŒ–ä¸ä»…æ˜¯ä¸ºäº†æ•ˆç‡ï¼Œä¹Ÿæ˜¯ä¸ºäº†å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§</li></ol>]]></content>
      
      
      <categories>
          
          <category> Code Chronicles </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> Leetcode </tag>
            
            <tag> æ¯æ—¥ä¸€é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€Leetcode Pythoné¢˜è§£ã€‘ã€Œ2097. Valid Arrangement of Pairsã€</title>
      <link href="/2024/12/01/Code%20Chronicles/%E3%80%90Leetcode%20Python%E9%A2%98%E8%A7%A3%E3%80%91%E3%80%8C2097.%20Valid%20Arrangement%20of%20Pairs%E3%80%8D/"/>
      <url>/2024/12/01/Code%20Chronicles/%E3%80%90Leetcode%20Python%E9%A2%98%E8%A7%A3%E3%80%91%E3%80%8C2097.%20Valid%20Arrangement%20of%20Pairs%E3%80%8D/</url>
      
        <content type="html"><![CDATA[<h1 id="ã€Leetcode-Pythoné¢˜è§£ã€‘ã€Œ2097-Valid-Arrangement-of-Pairsã€"><a href="#ã€Leetcode-Pythoné¢˜è§£ã€‘ã€Œ2097-Valid-Arrangement-of-Pairsã€" class="headerlink" title="ã€Leetcode Pythoné¢˜è§£ã€‘ã€Œ2097. Valid Arrangement of Pairsã€"></a>ã€Leetcode Pythoné¢˜è§£ã€‘ã€Œ2097. Valid Arrangement of Pairsã€</h1><h2 id="åœ¨è¿™ç¯‡æŠ€æœ¯åšå®¢ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥è§£æ-LeetCode-çš„ç¬¬-2097-é¢˜-â€”â€”-Valid-Arrangement-of-Pairsï¼Œå¹¶å…¨é¢ä»‹ç»å¦‚ä½•ä»é¢˜æ„ç†è§£ã€å›¾è®ºå»ºæ¨¡åˆ°ç®—æ³•å®ç°é€æ­¥è§£å†³é—®é¢˜ã€‚é¢˜ç›®ï¼š2097-Valid-Arrangement-of-Pairs"><a href="#åœ¨è¿™ç¯‡æŠ€æœ¯åšå®¢ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥è§£æ-LeetCode-çš„ç¬¬-2097-é¢˜-â€”â€”-Valid-Arrangement-of-Pairsï¼Œå¹¶å…¨é¢ä»‹ç»å¦‚ä½•ä»é¢˜æ„ç†è§£ã€å›¾è®ºå»ºæ¨¡åˆ°ç®—æ³•å®ç°é€æ­¥è§£å†³é—®é¢˜ã€‚é¢˜ç›®ï¼š2097-Valid-Arrangement-of-Pairs" class="headerlink" title="åœ¨è¿™ç¯‡æŠ€æœ¯åšå®¢ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥è§£æ LeetCode çš„ç¬¬ 2097 é¢˜ â€”â€” Valid Arrangement of Pairsï¼Œå¹¶å…¨é¢ä»‹ç»å¦‚ä½•ä»é¢˜æ„ç†è§£ã€å›¾è®ºå»ºæ¨¡åˆ°ç®—æ³•å®ç°é€æ­¥è§£å†³é—®é¢˜ã€‚é¢˜ç›®ï¼š2097. Valid Arrangement of Pairs"></a>åœ¨è¿™ç¯‡æŠ€æœ¯åšå®¢ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥è§£æ LeetCode çš„ç¬¬ 2097 é¢˜ â€”â€” <em>Valid Arrangement of Pairs</em>ï¼Œå¹¶å…¨é¢ä»‹ç»å¦‚ä½•ä»é¢˜æ„ç†è§£ã€å›¾è®ºå»ºæ¨¡åˆ°ç®—æ³•å®ç°é€æ­¥è§£å†³é—®é¢˜ã€‚<br>é¢˜ç›®ï¼š<a href="https://leetcode.com/problems/valid-arrangement-of-pairs/description/">2097. Valid Arrangement of Pairs</a></h2><h2 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h2><p>ç»™å®šä¸€ä¸ªäºŒç»´æ•°ç»„ <code>pairs</code>ï¼Œå…¶ä¸­ <code>pairs[i] = [start, end]</code>ï¼Œæˆ‘ä»¬éœ€è¦é‡æ–°æ’åˆ—è¿™äº›æ•°å­—å¯¹ï¼Œä½¿å¾—ç›¸é‚»çš„ä¸¤ä¸ªæ•°å­—å¯¹ <code>[start1, end1]</code> å’Œ <code>[start2, end2]</code> æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š</p><ul><li><code>end1 == start2</code>ã€‚</li></ul><p>è¾“å…¥æ•°æ®ä¿è¯ä¸€å®šå­˜åœ¨è¿™æ ·ä¸€ç§åˆæ³•çš„æ’åˆ—æ–¹å¼ã€‚</p><h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><h4 id="ç¤ºä¾‹-1"><a href="#ç¤ºä¾‹-1" class="headerlink" title="ç¤ºä¾‹ 1"></a>ç¤ºä¾‹ 1</h4><p><strong>è¾“å…¥ï¼š</strong></p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pairs = [[<span class="number">5</span>,<span class="number">1</span>],[<span class="number">4</span>,<span class="number">5</span>],[<span class="number">11</span>,<span class="number">9</span>],[<span class="number">9</span>,<span class="number">4</span>]]</span><br></pre></td></tr></tbody></table></figure><p><strong>è¾“å‡ºï¼š</strong></p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[<span class="number">11</span>,<span class="number">9</span>],[<span class="number">9</span>,<span class="number">4</span>],[<span class="number">4</span>,<span class="number">5</span>],[<span class="number">5</span>,<span class="number">1</span>]]</span><br></pre></td></tr></tbody></table></figure><p><strong>è§£é‡Šï¼š</strong><br>æ’åˆ—åæ»¡è¶³æ¡ä»¶ï¼š</p><ul><li><code>end0 = 9 == 9 = start1</code></li><li><code>end1 = 4 == 4 = start2</code></li><li><code>end2 = 5 == 5 = start3</code></li></ul><h4 id="ç¤ºä¾‹-2"><a href="#ç¤ºä¾‹-2" class="headerlink" title="ç¤ºä¾‹ 2"></a>ç¤ºä¾‹ 2</h4><p><strong>è¾“å…¥ï¼š</strong></p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pairs = [[<span class="number">1</span>,<span class="number">3</span>],[<span class="number">3</span>,<span class="number">2</span>],[<span class="number">2</span>,<span class="number">1</span>]]</span><br></pre></td></tr></tbody></table></figure><p><strong>è¾“å‡ºï¼š</strong></p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[<span class="number">1</span>,<span class="number">3</span>],[<span class="number">3</span>,<span class="number">2</span>],[<span class="number">2</span>,<span class="number">1</span>]]</span><br></pre></td></tr></tbody></table></figure><hr><h2 id="é—®é¢˜å»ºæ¨¡ï¼šæ¬§æ‹‰è·¯å¾„é—®é¢˜"><a href="#é—®é¢˜å»ºæ¨¡ï¼šæ¬§æ‹‰è·¯å¾„é—®é¢˜" class="headerlink" title="é—®é¢˜å»ºæ¨¡ï¼šæ¬§æ‹‰è·¯å¾„é—®é¢˜"></a>é—®é¢˜å»ºæ¨¡ï¼šæ¬§æ‹‰è·¯å¾„é—®é¢˜</h2><p>è¿™é“é¢˜çš„æœ¬è´¨æ˜¯ä¸€ä¸ªå›¾è®ºä¸­çš„æ¬§æ‹‰è·¯å¾„é—®é¢˜ã€‚æˆ‘ä»¬å°†æ¯ä¸ª <code>pair [start, end]</code> çœ‹ä½œä¸€æ¡ä» <code>start</code> åˆ° <code>end</code> çš„æœ‰å‘è¾¹ï¼Œå¹¶è¯•å›¾æ‰¾åˆ°ä¸€æ¡è·¯å¾„èƒ½éå†æ‰€æœ‰è¾¹ä¸”æ»¡è¶³æ¡ä»¶ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯æ¬§æ‹‰è·¯å¾„ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯æ¬§æ‹‰è·¯å¾„ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯æ¬§æ‹‰è·¯å¾„ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯æ¬§æ‹‰è·¯å¾„ï¼Ÿ</h3><ul><li><strong>å®šä¹‰</strong>ï¼šæ¬§æ‹‰è·¯å¾„æ˜¯ä¸€æ¡è·¯å¾„ï¼Œå®ƒèƒ½éå†å›¾ä¸­æ¯æ¡è¾¹æ°å¥½ä¸€æ¬¡ã€‚</li><li><strong>æ¡ä»¶</strong>ï¼š<ol><li>å¦‚æœå›¾ä¸­æœ‰ä¸”ä»…æœ‰ä¸¤ä¸ªèŠ‚ç‚¹çš„å…¥åº¦å’Œå‡ºåº¦ä¸ç›¸ç­‰ï¼Œåˆ™å¯ä»¥å­˜åœ¨æ¬§æ‹‰è·¯å¾„ã€‚<ul><li>èµ·ç‚¹ï¼šå‡ºåº¦æ¯”å…¥åº¦å¤§ 1 çš„èŠ‚ç‚¹ã€‚</li><li>ç»ˆç‚¹ï¼šå…¥åº¦æ¯”å‡ºåº¦å¤§ 1 çš„èŠ‚ç‚¹ã€‚</li></ul></li><li>å¦‚æœæ‰€æœ‰èŠ‚ç‚¹çš„å…¥åº¦ç­‰äºå‡ºåº¦ï¼Œåˆ™å›¾ä¸­å­˜åœ¨æ¬§æ‹‰å›è·¯ã€‚</li></ol></li></ul><hr><h2 id="è§£é¢˜æ€è·¯"><a href="#è§£é¢˜æ€è·¯" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h2><h3 id="1-å›¾çš„æ„å»º"><a href="#1-å›¾çš„æ„å»º" class="headerlink" title="1. å›¾çš„æ„å»º"></a>1. å›¾çš„æ„å»º</h3><p>å°†æ¯ä¸ª <code>pair [start, end]</code> å»ºæ¨¡ä¸ºæœ‰å‘è¾¹ï¼š</p><ul><li>èŠ‚ç‚¹ä¸º <code>start</code> å’Œ <code>end</code>ã€‚</li><li>è¾¹ä¸ºä» <code>start</code> åˆ° <code>end</code>ã€‚</li></ul><p>åŒæ—¶ç»Ÿè®¡æ¯ä¸ªèŠ‚ç‚¹çš„ <strong>å…¥åº¦</strong> å’Œ <strong>å‡ºåº¦</strong>ï¼Œç”¨äºåç»­åˆ¤æ–­èµ·ç‚¹ã€‚</p><h3 id="2-å¯»æ‰¾èµ·ç‚¹"><a href="#2-å¯»æ‰¾èµ·ç‚¹" class="headerlink" title="2. å¯»æ‰¾èµ·ç‚¹"></a>2. å¯»æ‰¾èµ·ç‚¹</h3><p>é€šè¿‡å…¥åº¦å’Œå‡ºåº¦çš„ç»Ÿè®¡ï¼š</p><ul><li>å‡ºåº¦ - å…¥åº¦ = 1 çš„èŠ‚ç‚¹æ˜¯è·¯å¾„çš„èµ·ç‚¹ã€‚</li><li>å¦‚æœæ²¡æœ‰è¿™æ ·çš„èŠ‚ç‚¹ï¼Œè¯´æ˜å›¾ä¸­å­˜åœ¨æ¬§æ‹‰å›è·¯ï¼Œå¯ä»ä»»æ„èŠ‚ç‚¹å¼€å§‹ã€‚</li></ul><h3 id="3-Hierholzer-ç®—æ³•æ‰¾è·¯å¾„"><a href="#3-Hierholzer-ç®—æ³•æ‰¾è·¯å¾„" class="headerlink" title="3. Hierholzer ç®—æ³•æ‰¾è·¯å¾„"></a>3. Hierholzer ç®—æ³•æ‰¾è·¯å¾„</h3><p><strong>Hierholzer ç®—æ³•</strong> ç”¨äºå¯»æ‰¾æ¬§æ‹‰è·¯å¾„ï¼Œå…¶æ ¸å¿ƒæ­¥éª¤ï¼š</p><ol><li>ä»èµ·ç‚¹å¼€å§‹ï¼Œä»»æ„é€‰æ‹©ä¸€æ¡æœªè®¿é—®çš„è¾¹èµ°ã€‚</li><li>ä¸€ç›´èµ°ç›´åˆ°èµ°åˆ°æ­»èƒ¡åŒï¼ˆå½“å‰èŠ‚ç‚¹æ²¡æœ‰å‡ºè¾¹ï¼‰ã€‚</li><li>å›æº¯è¿‡ç¨‹ä¸­è®°å½•è·¯å¾„ã€‚</li><li>æœ€ç»ˆè®°å½•çš„è·¯å¾„éœ€è¦åè½¬æ‰èƒ½å¾—åˆ°æ­£ç¡®çš„é¡ºåºã€‚</li></ol><hr><h2 id="ç®—æ³•å®ç°"><a href="#ç®—æ³•å®ç°" class="headerlink" title="ç®—æ³•å®ç°"></a>ç®—æ³•å®ç°</h2><p>ä¸‹é¢æ˜¯ Python å®ç°çš„å®Œæ•´ä»£ç ï¼š</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">validArrangement</span>(<span class="params">pairs</span>):</span><br><span class="line">    <span class="comment"># æ„å»ºå›¾</span></span><br><span class="line">    graph = defaultdict(<span class="built_in">list</span>)</span><br><span class="line">    in_degree = defaultdict(<span class="built_in">int</span>)</span><br><span class="line">    out_degree = defaultdict(<span class="built_in">int</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> start, end <span class="keyword">in</span> pairs:</span><br><span class="line">        graph[start].append(end)</span><br><span class="line">        out_degree[start] += <span class="number">1</span></span><br><span class="line">        in_degree[end] += <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å¯»æ‰¾èµ·ç‚¹</span></span><br><span class="line">    start_node = pairs[<span class="number">0</span>][<span class="number">0</span>]  <span class="comment"># é»˜è®¤èµ·ç‚¹</span></span><br><span class="line">    <span class="keyword">for</span> node <span class="keyword">in</span> graph:</span><br><span class="line">        <span class="keyword">if</span> out_degree[node] - in_degree[node] == <span class="number">1</span>:</span><br><span class="line">            start_node = node</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Hierholzerç®—æ³•</span></span><br><span class="line">    path = []</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">dfs</span>(<span class="params">current_node</span>):</span><br><span class="line">        <span class="keyword">while</span> graph[current_node]:</span><br><span class="line">            next_node = graph[current_node].pop()</span><br><span class="line">            dfs(next_node)</span><br><span class="line">            path.append([current_node, next_node])</span><br><span class="line">    </span><br><span class="line">    dfs(start_node)</span><br><span class="line">    <span class="keyword">return</span> path[::-<span class="number">1</span>]</span><br></pre></td></tr></tbody></table></figure><hr><h2 id="ä»£ç è§£æ"><a href="#ä»£ç è§£æ" class="headerlink" title="ä»£ç è§£æ"></a>ä»£ç è§£æ</h2><h3 id="å›¾çš„æ„å»º"><a href="#å›¾çš„æ„å»º" class="headerlink" title="å›¾çš„æ„å»º"></a>å›¾çš„æ„å»º</h3><p>ä½¿ç”¨ <code>defaultdict</code> æ¥å­˜å‚¨å›¾çš„é‚»æ¥è¡¨ï¼Œä»¥åŠç»Ÿè®¡æ¯ä¸ªèŠ‚ç‚¹çš„å…¥åº¦å’Œå‡ºåº¦ï¼š</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">graph = defaultdict(<span class="built_in">list</span>)</span><br><span class="line">in_degree = defaultdict(<span class="built_in">int</span>)</span><br><span class="line">out_degree = defaultdict(<span class="built_in">int</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> start, end <span class="keyword">in</span> pairs:</span><br><span class="line">    graph[start].append(end)</span><br><span class="line">    out_degree[start] += <span class="number">1</span></span><br><span class="line">    in_degree[end] += <span class="number">1</span></span><br></pre></td></tr></tbody></table></figure><h3 id="å¯»æ‰¾èµ·ç‚¹"><a href="#å¯»æ‰¾èµ·ç‚¹" class="headerlink" title="å¯»æ‰¾èµ·ç‚¹"></a>å¯»æ‰¾èµ·ç‚¹</h3><p>æ ¹æ®å…¥åº¦å’Œå‡ºåº¦çš„ç»Ÿè®¡è§„åˆ™ï¼š</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">start_node = pairs[<span class="number">0</span>][<span class="number">0</span>]  <span class="comment"># é»˜è®¤å€¼</span></span><br><span class="line"><span class="keyword">for</span> node <span class="keyword">in</span> graph:</span><br><span class="line">    <span class="keyword">if</span> out_degree[node] - in_degree[node] == <span class="number">1</span>:</span><br><span class="line">        start_node = node</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></tbody></table></figure><h3 id="Hierholzerç®—æ³•"><a href="#Hierholzerç®—æ³•" class="headerlink" title="Hierholzerç®—æ³•"></a>Hierholzerç®—æ³•</h3><p>é€šè¿‡æ·±åº¦ä¼˜å…ˆæœç´¢ï¼ˆDFSï¼‰æ‰¾åˆ°è·¯å¾„ï¼š</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">path = []  <span class="comment"># å­˜å‚¨è·¯å¾„</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dfs</span>(<span class="params">current_node</span>):</span><br><span class="line">    <span class="keyword">while</span> graph[current_node]:  <span class="comment"># å½“å‰èŠ‚ç‚¹è¿˜æœ‰å‡ºè¾¹</span></span><br><span class="line">        next_node = graph[current_node].pop()  <span class="comment"># è·å–å¹¶åˆ é™¤è¾¹</span></span><br><span class="line">        dfs(next_node)</span><br><span class="line">        path.append([current_node, next_node])  <span class="comment"># è®°å½•è·¯å¾„</span></span><br></pre></td></tr></tbody></table></figure><hr><h2 id="ç¤ºä¾‹è¿è¡Œ"><a href="#ç¤ºä¾‹è¿è¡Œ" class="headerlink" title="ç¤ºä¾‹è¿è¡Œ"></a>ç¤ºä¾‹è¿è¡Œ</h2><p>ä»¥ <code>pairs = [[5,1],[4,5],[11,9],[9,4]]</code> ä¸ºä¾‹ï¼š</p><h3 id="å›¾çš„çŠ¶æ€"><a href="#å›¾çš„çŠ¶æ€" class="headerlink" title="å›¾çš„çŠ¶æ€"></a>å›¾çš„çŠ¶æ€</h3><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">11 â†’ 9</span><br><span class="line"> 9 â†’ 4</span><br><span class="line"> 4 â†’ 5</span><br><span class="line"> 5 â†’ 1</span><br></pre></td></tr></tbody></table></figure><h3 id="æ‰§è¡Œè¿‡ç¨‹"><a href="#æ‰§è¡Œè¿‡ç¨‹" class="headerlink" title="æ‰§è¡Œè¿‡ç¨‹"></a>æ‰§è¡Œè¿‡ç¨‹</h3><ol><li><p>ä»èŠ‚ç‚¹ <code>11</code> å¼€å§‹ï¼ŒDFS éå†ï¼š</p><ul><li>èµ° <code>11 â†’ 9</code>ï¼Œç§»é™¤è¾¹ã€‚</li><li>èµ° <code>9 â†’ 4</code>ï¼Œç§»é™¤è¾¹ã€‚</li><li>èµ° <code>4 â†’ 5</code>ï¼Œç§»é™¤è¾¹ã€‚</li><li>èµ° <code>5 â†’ 1</code>ï¼Œç§»é™¤è¾¹ã€‚</li></ul></li><li><p>å›æº¯è®°å½•è·¯å¾„ï¼š</p><ul><li><code>path = [[5,1], [4,5], [9,4], [11,9]]</code></li></ul></li><li><p>åè½¬è·¯å¾„å¾—åˆ°æœ€ç»ˆç»“æœï¼š</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[<span class="number">11</span>,<span class="number">9</span>], [<span class="number">9</span>,<span class="number">4</span>], [<span class="number">4</span>,<span class="number">5</span>], [<span class="number">5</span>,<span class="number">1</span>]]</span><br></pre></td></tr></tbody></table></figure></li></ol><hr><h2 id="ç®—æ³•å¤æ‚åº¦"><a href="#ç®—æ³•å¤æ‚åº¦" class="headerlink" title="ç®—æ³•å¤æ‚åº¦"></a>ç®—æ³•å¤æ‚åº¦</h2><ul><li><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼š<code>O(E)</code>ï¼Œå…¶ä¸­ <code>E</code> æ˜¯è¾¹çš„æ•°é‡ã€‚<ul><li>æ„å»ºå›¾éœ€è¦ <code>O(E)</code>ã€‚</li><li>DFS éå†æ¯æ¡è¾¹éœ€è¦ <code>O(E)</code>ã€‚</li></ul></li><li><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼š<code>O(E)</code>ï¼Œç”¨äºå­˜å‚¨å›¾çš„é‚»æ¥è¡¨å’Œç»“æœè·¯å¾„ã€‚</li></ul><hr><h2 id="Python-æŠ€å·§è¡¥å……"><a href="#Python-æŠ€å·§è¡¥å……" class="headerlink" title="Python æŠ€å·§è¡¥å……"></a>Python æŠ€å·§è¡¥å……</h2><p>æœ€åï¼Œæˆ‘ä»¬è¡¥å……ä¸€äº›ä»£ç ä¸­ç”¨åˆ°çš„ä¸€äº› Python æŠ€å·§ã€‚</p><h3 id="1-é—­åŒ…ï¼ˆClosureï¼‰"><a href="#1-é—­åŒ…ï¼ˆClosureï¼‰" class="headerlink" title="1. é—­åŒ…ï¼ˆClosureï¼‰"></a>1. é—­åŒ…ï¼ˆClosureï¼‰</h3><p><strong>é—­åŒ…</strong> æ˜¯æŒ‡åœ¨ä¸€ä¸ªå‡½æ•°å†…éƒ¨å®šä¹‰å¦ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œå†…éƒ¨å‡½æ•°å¯ä»¥è®¿é—®å¤–éƒ¨å‡½æ•°çš„å˜é‡ï¼Œå³ä½¿å¤–éƒ¨å‡½æ•°å·²ç»æ‰§è¡Œå®Œæ¯•ã€‚ </p><p>åœ¨ä»£ç ä¸­ï¼Œé—­åŒ…çš„ä½œç”¨æ˜¯é€šè¿‡å†…éƒ¨å‡½æ•°è®¿é—®å’Œä¿®æ”¹å¤–éƒ¨ä½œç”¨åŸŸçš„å˜é‡ï¼Œè€Œæ— éœ€é€šè¿‡å‡½æ•°å‚æ•°æ˜¾å¼ä¼ é€’ã€‚</p><h4 id="ç¤ºä¾‹ï¼š"><a href="#ç¤ºä¾‹ï¼š" class="headerlink" title="ç¤ºä¾‹ï¼š"></a>ç¤ºä¾‹ï¼š</h4><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">outer</span>():</span><br><span class="line">    x = <span class="number">10</span>  <span class="comment"># å¤–éƒ¨å˜é‡</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">inner</span>():</span><br><span class="line">        <span class="keyword">nonlocal</span> x  <span class="comment"># æŒ‡å®šä½¿ç”¨å¤–éƒ¨å˜é‡</span></span><br><span class="line">        x += <span class="number">1</span></span><br><span class="line">        <span class="built_in">print</span>(x)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> inner</span><br><span class="line"></span><br><span class="line">closure_func = outer()  <span class="comment"># è¿”å› inner å‡½æ•°</span></span><br><span class="line">closure_func()  <span class="comment"># è¾“å‡º 11</span></span><br><span class="line">closure_func()  <span class="comment"># è¾“å‡º 12</span></span><br></pre></td></tr></tbody></table></figure><p>åœ¨æœ¬æ–‡çš„ç®—æ³•ä¸­ï¼Œ<code>dfs()</code> å‡½æ•°åˆ©ç”¨é—­åŒ…è®¿é—® <code>path</code> åˆ—è¡¨ï¼Œé¿å…äº†é€šè¿‡å‚æ•°æ˜¾å¼ä¼ é€’è·¯å¾„çš„å¤æ‚æ“ä½œã€‚</p><h4 id="ä¸ºä»€ä¹ˆä¸éœ€è¦å°†-path-ä½œä¸ºå‚æ•°ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆä¸éœ€è¦å°†-path-ä½œä¸ºå‚æ•°ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆä¸éœ€è¦å°† path ä½œä¸ºå‚æ•°ï¼Ÿ"></a>ä¸ºä»€ä¹ˆä¸éœ€è¦å°† <code>path</code> ä½œä¸ºå‚æ•°ï¼Ÿ</h4><ul><li><strong>æ˜“è¯»æ€§</strong>ï¼šé—­åŒ…è®©ä»£ç æ›´åŠ ç›´è§‚ï¼Œé¿å…ä¼ é€’å¤šä¸ªå‚æ•°ã€‚</li><li><strong>æ•ˆç‡</strong>ï¼šé—­åŒ…ç›´æ¥æ“ä½œå¤–éƒ¨å˜é‡ï¼Œé¿å…åœ¨é€’å½’è¿‡ç¨‹ä¸­ä¼ é€’å’Œåˆå¹¶è·¯å¾„ã€‚</li></ul><h3 id="2-defaultdict-ä¸-Counter"><a href="#2-defaultdict-ä¸-Counter" class="headerlink" title="2. defaultdict ä¸ Counter"></a>2. <code>defaultdict</code> ä¸ <code>Counter</code></h3><p>Python çš„ <code>collections</code> æ¨¡å—æä¾›äº†è®¸å¤šå·¥å…·ç±»ï¼Œå…¶ä¸­ <code>defaultdict</code> å’Œ <code>Counter</code> æ˜¯æœ¬é¢˜çš„æ ¸å¿ƒå·¥å…·ã€‚</p><h4 id="defaultdict"><a href="#defaultdict" class="headerlink" title="defaultdict"></a><code>defaultdict</code></h4><p><code>defaultdict</code> æ˜¯å­—å…¸çš„ä¸€ä¸ªå­ç±»ï¼Œå¯ä»¥ä¸ºä¸å­˜åœ¨çš„é”®æä¾›é»˜è®¤å€¼ï¼Œä»è€Œé¿å…è®¿é—®ä¸å­˜åœ¨é”®æ—¶æŠ›å‡º <code>KeyError</code>ã€‚</p><h5 id="ä½¿ç”¨æ–¹å¼ï¼š"><a href="#ä½¿ç”¨æ–¹å¼ï¼š" class="headerlink" title="ä½¿ç”¨æ–¹å¼ï¼š"></a>ä½¿ç”¨æ–¹å¼ï¼š</h5><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line"></span><br><span class="line"><span class="comment"># é»˜è®¤å€¼æ˜¯åˆ—è¡¨</span></span><br><span class="line">graph = defaultdict(<span class="built_in">list</span>)</span><br><span class="line">graph[<span class="number">1</span>].append(<span class="number">2</span>)</span><br><span class="line">graph[<span class="number">2</span>].append(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(graph)  <span class="comment"># è¾“å‡ºï¼š{1: [2], 2: [3]}</span></span><br><span class="line"><span class="built_in">print</span>(graph[<span class="number">3</span>])  <span class="comment"># è¾“å‡ºï¼š[]ï¼Œä¸ä¼šæŠ¥é”™</span></span><br></pre></td></tr></tbody></table></figure><p>åœ¨æœ¬æ–‡ä¸­ï¼Œ<code>defaultdict</code> è¢«ç”¨ä½œå›¾çš„é‚»æ¥è¡¨ï¼Œç®€åŒ–äº†å›¾çš„æ„å»ºå’Œæ›´æ–°æ“ä½œã€‚</p><h4 id="Counter"><a href="#Counter" class="headerlink" title="Counter"></a><code>Counter</code></h4><p><code>Counter</code> æ˜¯å­—å…¸çš„å­ç±»ï¼Œç”¨äºç»Ÿè®¡å…ƒç´ çš„å‡ºç°æ¬¡æ•°ã€‚å®ƒå°†æ¯ä¸ªå…ƒç´ ä½œä¸ºé”®ï¼Œå‡ºç°æ¬¡æ•°ä½œä¸ºå€¼ã€‚</p><h5 id="ä½¿ç”¨æ–¹å¼ï¼š-1"><a href="#ä½¿ç”¨æ–¹å¼ï¼š-1" class="headerlink" title="ä½¿ç”¨æ–¹å¼ï¼š"></a>ä½¿ç”¨æ–¹å¼ï¼š</h5><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line"></span><br><span class="line">counts = Counter([<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>])</span><br><span class="line"><span class="built_in">print</span>(counts)  <span class="comment"># è¾“å‡ºï¼šCounter({3: 3, 2: 2, 1: 1})</span></span><br></pre></td></tr></tbody></table></figure><p>åœ¨æœ¬æ–‡ä¸­ï¼Œå¯ä»¥é€šè¿‡ <code>Counter</code> å¿«é€Ÿç»Ÿè®¡æ¯ä¸ªèŠ‚ç‚¹çš„å…¥åº¦å’Œå‡ºåº¦ã€‚</p><hr><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è¿™é“é¢˜é€šè¿‡å°†æ•°å­—å¯¹å»ºæ¨¡ä¸ºå›¾çš„æ¬§æ‹‰è·¯å¾„é—®é¢˜ï¼Œä½¿ç”¨ Hierholzer ç®—æ³•é«˜æ•ˆåœ°æ‰¾åˆ°åˆæ³•æ’åˆ—ã€‚è¿™ç§å›¾è®ºé—®é¢˜çš„å»ºæ¨¡æ–¹æ³•ä¸ä»…æå‡äº†é¢˜ç›®ç†è§£ï¼Œè¿˜ä¸ºç±»ä¼¼é—®é¢˜æä¾›äº†é€šç”¨è§£æ³•ã€‚</p><p>å¸Œæœ›è¿™ç¯‡åšå®¢èƒ½å¸®åŠ©ä½ å½»åº•æŒæ¡è¿™é“é¢˜ï¼å¦‚æœä½ æœ‰å…¶ä»–é—®é¢˜ï¼Œæ¬¢è¿äº¤æµï¼</p>]]></content>
      
      
      <categories>
          
          <category> Code Chronicles </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> Leetcode </tag>
            
            <tag> æ¯æ—¥ä¸€é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Leetcode Python Solution - 2097. Valid Arrangement of Pairs</title>
      <link href="/2024/12/01/Code%20Chronicles/%5BLeetcode%20Python%20Solution%5D%202097.%20Valid%20Arrangement%20of%20Pairs/"/>
      <url>/2024/12/01/Code%20Chronicles/%5BLeetcode%20Python%20Solution%5D%202097.%20Valid%20Arrangement%20of%20Pairs/</url>
      
        <content type="html"><![CDATA[<h1 id="Leetcode-Python-Solution-2097-Valid-Arrangement-of-Pairs"><a href="#Leetcode-Python-Solution-2097-Valid-Arrangement-of-Pairs" class="headerlink" title="[Leetcode Python Solution] 2097. Valid Arrangement of Pairs"></a>[Leetcode Python Solution] 2097. Valid Arrangement of Pairs</h1><p>In this technical blog, weâ€™ll dive deep into Leetcode Problem 2097 â€” <em>Valid Arrangement of Pairs</em>. We will break down the solution step by step, from understanding the problem, modeling it as a graph theory problem, to implementing the solution.</p><p>Problem Link: <a href="https://leetcode.com/problems/valid-arrangement-of-pairs/description/">2097. Valid Arrangement of Pairs</a></p><hr><h2 id="Problem-Description"><a href="#Problem-Description" class="headerlink" title="Problem Description"></a>Problem Description</h2><p>Given a 2D array <code>pairs</code> where <code>pairs[i] = [start, end]</code>, you need to rearrange these pairs so that for adjacent pairs <code>[start1, end1]</code> and <code>[start2, end2]</code>, the condition <code>end1 == start2</code> holds.</p><p>It is guaranteed that at least one valid arrangement exists.</p><h3 id="Examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h3><h4 id="Example-1"><a href="#Example-1" class="headerlink" title="Example 1"></a>Example 1</h4><p><strong>Input:</strong></p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pairs = [[<span class="number">5</span>,<span class="number">1</span>],[<span class="number">4</span>,<span class="number">5</span>],[<span class="number">11</span>,<span class="number">9</span>],[<span class="number">9</span>,<span class="number">4</span>]]</span><br></pre></td></tr></tbody></table></figure><p><strong>Output:</strong></p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[<span class="number">11</span>,<span class="number">9</span>],[<span class="number">9</span>,<span class="number">4</span>],[<span class="number">4</span>,<span class="number">5</span>],[<span class="number">5</span>,<span class="number">1</span>]]</span><br></pre></td></tr></tbody></table></figure><p><strong>Explanation:</strong><br>The arrangement satisfies:</p><ul><li><code>end0 = 9 == 9 = start1</code></li><li><code>end1 = 4 == 4 = start2</code></li><li><code>end2 = 5 == 5 = start3</code></li></ul><h4 id="Example-2"><a href="#Example-2" class="headerlink" title="Example 2"></a>Example 2</h4><p><strong>Input:</strong></p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pairs = [[<span class="number">1</span>,<span class="number">3</span>],[<span class="number">3</span>,<span class="number">2</span>],[<span class="number">2</span>,<span class="number">1</span>]]</span><br></pre></td></tr></tbody></table></figure><p><strong>Output:</strong></p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[<span class="number">1</span>,<span class="number">3</span>],[<span class="number">3</span>,<span class="number">2</span>],[<span class="number">2</span>,<span class="number">1</span>]]</span><br></pre></td></tr></tbody></table></figure><hr><h2 id="Problem-Modeling-Eulerian-Path-Problem"><a href="#Problem-Modeling-Eulerian-Path-Problem" class="headerlink" title="Problem Modeling: Eulerian Path Problem"></a>Problem Modeling: Eulerian Path Problem</h2><p>This problem can be modeled as an <strong>Eulerian Path Problem</strong> in graph theory. Each <code>pair [start, end]</code> is treated as a directed edge from <code>start</code> to <code>end</code>, and we aim to find a path that traverses all edges while satisfying the given condition.</p><h3 id="What-is-an-Eulerian-Path"><a href="#What-is-an-Eulerian-Path" class="headerlink" title="What is an Eulerian Path?"></a>What is an Eulerian Path?</h3><ul><li><strong>Definition</strong>: An Eulerian path is a path in a graph that visits every edge exactly once.</li><li><strong>Conditions</strong>:<ol><li>An Eulerian path exists if and only if there are exactly two nodes in the graph with unbalanced in-degrees and out-degrees:<ul><li>Start node: the node where <code>out-degree - in-degree = 1</code>.</li><li>End node: the node where <code>in-degree - out-degree = 1</code>.</li></ul></li><li>If all nodes have equal in-degrees and out-degrees, the graph contains an Eulerian circuit, and the path can start at any node.</li></ol></li></ul><hr><h2 id="Solution-Approach"><a href="#Solution-Approach" class="headerlink" title="Solution Approach"></a>Solution Approach</h2><h3 id="1-Graph-Construction"><a href="#1-Graph-Construction" class="headerlink" title="1. Graph Construction"></a>1. Graph Construction</h3><p>Model each <code>pair [start, end]</code> as a directed edge:</p><ul><li>Nodes: <code>start</code> and <code>end</code>.</li><li>Edges: Directed edge from <code>start</code> to <code>end</code>.</li></ul><p>Simultaneously, calculate the <strong>in-degrees</strong> and <strong>out-degrees</strong> of each node to identify the starting node.</p><h3 id="2-Finding-the-Start-Node"><a href="#2-Finding-the-Start-Node" class="headerlink" title="2. Finding the Start Node"></a>2. Finding the Start Node</h3><p>Using the in-degree and out-degree counts:</p><ul><li>A node with <code>out-degree - in-degree = 1</code> is the start node.</li><li>If no such node exists, the graph contains an Eulerian circuit, and we can start from any node.</li></ul><h3 id="3-Using-Hierholzerâ€™s-Algorithm-to-Find-the-Path"><a href="#3-Using-Hierholzerâ€™s-Algorithm-to-Find-the-Path" class="headerlink" title="3. Using Hierholzerâ€™s Algorithm to Find the Path"></a>3. Using Hierholzerâ€™s Algorithm to Find the Path</h3><p><strong>Hierholzerâ€™s Algorithm</strong> is used to find an Eulerian path:</p><ol><li>Start at the chosen node and follow any unvisited edge.</li><li>Continue until reaching a dead end (a node with no outgoing edges).</li><li>Backtrack and record the path.</li><li>Reverse the recorded path to get the correct order.</li></ol><hr><h2 id="Implementation"><a href="#Implementation" class="headerlink" title="Implementation"></a>Implementation</h2><p>Hereâ€™s the complete Python solution:</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">validArrangement</span>(<span class="params">pairs</span>):</span><br><span class="line">    <span class="comment"># Construct the graph</span></span><br><span class="line">    graph = defaultdict(<span class="built_in">list</span>)</span><br><span class="line">    in_degree = defaultdict(<span class="built_in">int</span>)</span><br><span class="line">    out_degree = defaultdict(<span class="built_in">int</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> start, end <span class="keyword">in</span> pairs:</span><br><span class="line">        graph[start].append(end)</span><br><span class="line">        out_degree[start] += <span class="number">1</span></span><br><span class="line">        in_degree[end] += <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Find the starting node</span></span><br><span class="line">    start_node = pairs[<span class="number">0</span>][<span class="number">0</span>]  <span class="comment"># Default start node</span></span><br><span class="line">    <span class="keyword">for</span> node <span class="keyword">in</span> graph:</span><br><span class="line">        <span class="keyword">if</span> out_degree[node] - in_degree[node] == <span class="number">1</span>:</span><br><span class="line">            start_node = node</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Hierholzer's Algorithm</span></span><br><span class="line">    path = []</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">dfs</span>(<span class="params">current_node</span>):</span><br><span class="line">        <span class="keyword">while</span> graph[current_node]:</span><br><span class="line">            next_node = graph[current_node].pop()</span><br><span class="line">            dfs(next_node)</span><br><span class="line">            path.append([current_node, next_node])</span><br><span class="line">    </span><br><span class="line">    dfs(start_node)</span><br><span class="line">    <span class="keyword">return</span> path[::-<span class="number">1</span>]</span><br></pre></td></tr></tbody></table></figure><hr><h2 id="Code-Explanation"><a href="#Code-Explanation" class="headerlink" title="Code Explanation"></a>Code Explanation</h2><h3 id="Graph-Construction"><a href="#Graph-Construction" class="headerlink" title="Graph Construction"></a>Graph Construction</h3><p>Using <code>defaultdict</code> to store the adjacency list and count the in-degrees and out-degrees:</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">graph = defaultdict(<span class="built_in">list</span>)</span><br><span class="line">in_degree = defaultdict(<span class="built_in">int</span>)</span><br><span class="line">out_degree = defaultdict(<span class="built_in">int</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> start, end <span class="keyword">in</span> pairs:</span><br><span class="line">    graph[start].append(end)</span><br><span class="line">    out_degree[start] += <span class="number">1</span></span><br><span class="line">    in_degree[end] += <span class="number">1</span></span><br></pre></td></tr></tbody></table></figure><h3 id="Finding-the-Start-Node"><a href="#Finding-the-Start-Node" class="headerlink" title="Finding the Start Node"></a>Finding the Start Node</h3><p>Based on the rules for Eulerian paths:</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">start_node = pairs[<span class="number">0</span>][<span class="number">0</span>]  <span class="comment"># Default value</span></span><br><span class="line"><span class="keyword">for</span> node <span class="keyword">in</span> graph:</span><br><span class="line">    <span class="keyword">if</span> out_degree[node] - in_degree[node] == <span class="number">1</span>:</span><br><span class="line">        start_node = node</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></tbody></table></figure><h3 id="Hierholzerâ€™s-Algorithm"><a href="#Hierholzerâ€™s-Algorithm" class="headerlink" title="Hierholzerâ€™s Algorithm"></a>Hierholzerâ€™s Algorithm</h3><p>Using a recursive DFS to find the Eulerian path:</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">path = []  <span class="comment"># To store the path</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dfs</span>(<span class="params">current_node</span>):</span><br><span class="line">    <span class="keyword">while</span> graph[current_node]:  <span class="comment"># While there are outgoing edges</span></span><br><span class="line">        next_node = graph[current_node].pop()  <span class="comment"># Remove edge</span></span><br><span class="line">        dfs(next_node)</span><br><span class="line">        path.append([current_node, next_node])  <span class="comment"># Record path</span></span><br></pre></td></tr></tbody></table></figure><hr><h2 id="Example-Execution"><a href="#Example-Execution" class="headerlink" title="Example Execution"></a>Example Execution</h2><p>For <code>pairs = [[5,1],[4,5],[11,9],[9,4]]</code>:</p><h3 id="Graph-State"><a href="#Graph-State" class="headerlink" title="Graph State"></a>Graph State</h3><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">11 â†’ 9</span><br><span class="line"> 9 â†’ 4</span><br><span class="line"> 4 â†’ 5</span><br><span class="line"> 5 â†’ 1</span><br></pre></td></tr></tbody></table></figure><h3 id="Execution-Process"><a href="#Execution-Process" class="headerlink" title="Execution Process"></a>Execution Process</h3><ol><li><p>Start DFS from node <code>11</code>:</p><ul><li>Visit <code>11 â†’ 9</code> and remove the edge.</li><li>Visit <code>9 â†’ 4</code> and remove the edge.</li><li>Visit <code>4 â†’ 5</code> and remove the edge.</li><li>Visit <code>5 â†’ 1</code> and remove the edge.</li></ul></li><li><p>Backtrack to record the path:</p><ul><li><code>path = [[5,1], [4,5], [9,4], [11,9]]</code>.</li></ul></li><li><p>Reverse the path for the final result:</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[<span class="number">11</span>,<span class="number">9</span>], [<span class="number">9</span>,<span class="number">4</span>], [<span class="number">4</span>,<span class="number">5</span>], [<span class="number">5</span>,<span class="number">1</span>]]</span><br></pre></td></tr></tbody></table></figure></li></ol><hr><h2 id="Time-and-Space-Complexity"><a href="#Time-and-Space-Complexity" class="headerlink" title="Time and Space Complexity"></a>Time and Space Complexity</h2><ul><li><strong>Time Complexity</strong>: <code>O(E)</code>, where <code>E</code> is the number of edges.<ul><li>Constructing the graph: <code>O(E)</code>.</li><li>DFS traversal: <code>O(E)</code>.</li></ul></li><li><strong>Space Complexity</strong>: <code>O(E)</code> for storing the adjacency list and result path.</li></ul><hr><h2 id="Python-Tips-and-Tricks"><a href="#Python-Tips-and-Tricks" class="headerlink" title="Python Tips and Tricks"></a>Python Tips and Tricks</h2><h3 id="1-Closures"><a href="#1-Closures" class="headerlink" title="1. Closures"></a>1. Closures</h3><p>A <strong>closure</strong> allows inner functions to access variables from the outer function, even after the outer function has finished executing.</p><h4 id="Example"><a href="#Example" class="headerlink" title="Example:"></a>Example:</h4><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">outer</span>():</span><br><span class="line">    x = <span class="number">10</span>  <span class="comment"># Outer variable</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">inner</span>():</span><br><span class="line">        <span class="keyword">nonlocal</span> x  <span class="comment"># Use the outer variable</span></span><br><span class="line">        x += <span class="number">1</span></span><br><span class="line">        <span class="built_in">print</span>(x)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> inner</span><br><span class="line"></span><br><span class="line">closure_func = outer()  <span class="comment"># Returns the inner function</span></span><br><span class="line">closure_func()  <span class="comment"># Outputs 11</span></span><br><span class="line">closure_func()  <span class="comment"># Outputs 12</span></span><br></pre></td></tr></tbody></table></figure><p>In the solution, <code>dfs()</code> uses a closure to access and modify the <code>path</code> list without passing it explicitly.</p><hr><h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>This problem showcases how to model a graph problem as an Eulerian path and use Hierholzerâ€™s algorithm for an efficient solution. Such graph theory techniques provide a robust framework for solving similar problems.</p><p>Feel free to leave questions or share your thoughts!</p>]]></content>
      
      
      <categories>
          
          <category> Code Chronicles </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> Leetcode </tag>
            
            <tag> Daily Challenge </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Detailed Explanation of LoRA, DPO, KTO, and SFT Technologies</title>
      <link href="/2024/10/23/NLP%20Insights/Introduction%20to%20LLM%20Training%20Terminology:%20LoRA,%20DPO,%20KTO,%20and%20SFT%20Technologies/"/>
      <url>/2024/10/23/NLP%20Insights/Introduction%20to%20LLM%20Training%20Terminology:%20LoRA,%20DPO,%20KTO,%20and%20SFT%20Technologies/</url>
      
        <content type="html"><![CDATA[<h3 id="Introduction-to-LLM-Training-Terminology-LoRA-DPO-KTO-and-SFT-Technologies"><a href="#Introduction-to-LLM-Training-Terminology-LoRA-DPO-KTO-and-SFT-Technologies" class="headerlink" title="Introduction to LLM Training Terminology:LoRA, DPO, KTO, and SFT Technologies"></a><strong>Introduction to LLM Training Terminology:LoRA, DPO, KTO, and SFT Technologies</strong></h3><p>This document provides a detailed introduction to several important techniques used in fine-tuning and optimizing large language models (such as LLAMA3), including <strong>SFT (Supervised Fine-Tuning)</strong>, <strong>LoRA (Low-Rank Adaptation)</strong>, <strong>Alignment</strong> technologies, <strong>KTO (Kahneman-Tversky Optimization)</strong>, and <strong>DPO (Direct Preference Optimization)</strong>. The document also elaborates on the principles of each technique, specific implementation methods, as well as the selection of corresponding loss functions and optimizers.</p><hr><h2 id="1-SFT-Supervised-Fine-Tuning"><a href="#1-SFT-Supervised-Fine-Tuning" class="headerlink" title="1. SFT (Supervised Fine-Tuning)"></a>1. <strong>SFT (Supervised Fine-Tuning)</strong></h2><h3 id="1-1-Principle"><a href="#1-1-Principle" class="headerlink" title="1.1 Principle"></a>1.1 <strong>Principle</strong></h3><p>SFT is a traditional fine-tuning method that adjusts the parameters of a pre-trained model through supervised learning to improve its performance on specific tasks. SFT is typically used to fine-tune models on specific labeled datasets, with the training process resembling standard supervised learning.</p><h3 id="1-2-Implementation-Method"><a href="#1-2-Implementation-Method" class="headerlink" title="1.2 Implementation Method"></a>1.2 <strong>Implementation Method</strong></h3><ul><li><strong>Select a Pre-trained Model</strong>: Such as GPT, BERT, and other language models.</li><li><strong>Prepare a Labeled Dataset</strong>: The dataset includes input-output pairs.</li><li><strong>Train the Model</strong>: Use a standard cross-entropy loss function to train the model, optimizing parameters through gradient descent.</li></ul><h3 id="1-3-Core-Code"><a href="#1-3-Core-Code" class="headerlink" title="1.3 Core Code"></a>1.3 <strong>Core Code</strong></h3><p>Using Hugging Faceâ€™s <code>Trainer</code> interface for SFT:</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> Trainer, TrainingArguments, AutoModelForSeq2SeqLM, AutoTokenizer</span><br><span class="line"></span><br><span class="line">model_name = <span class="string">"gpt2"</span></span><br><span class="line">model = AutoModelForSeq2SeqLM.from_pretrained(model_name)</span><br><span class="line">tokenizer = AutoTokenizer.from_pretrained(model_name)</span><br><span class="line"></span><br><span class="line">train_dataset = load_dataset(<span class="string">"my_dataset"</span>, split=<span class="string">"train"</span>)</span><br><span class="line"></span><br><span class="line">training_args = TrainingArguments(</span><br><span class="line">    output_dir=<span class="string">"./results"</span>,</span><br><span class="line">    evaluation_strategy=<span class="string">"epoch"</span>,</span><br><span class="line">    learning_rate=<span class="number">2e-5</span>,</span><br><span class="line">    per_device_train_batch_size=<span class="number">16</span>,</span><br><span class="line">    num_train_epochs=<span class="number">3</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">trainer = Trainer(</span><br><span class="line">    model=model,</span><br><span class="line">    args=training_args,</span><br><span class="line">    train_dataset=train_dataset,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">trainer.train()</span><br></pre></td></tr></tbody></table></figure><hr><h2 id="2-LoRA-Low-Rank-Adaptation"><a href="#2-LoRA-Low-Rank-Adaptation" class="headerlink" title="2. LoRA (Low-Rank Adaptation)"></a>2. <strong>LoRA (Low-Rank Adaptation)</strong></h2><h3 id="2-1-Principle"><a href="#2-1-Principle" class="headerlink" title="2.1 Principle"></a>2.1 <strong>Principle</strong></h3><p>LoRA is a parameter-efficient fine-tuning technique that performs low-rank decomposition of the weight matrices in large models. It decomposes the original weight matrix $W$ into two low-rank matrices $B$ and $A$, and only fine-tunes these low-rank matrices. The design goal of LoRA is to reduce the number of fine-tuning parameters while retaining the pre-trained model weights, optimizing model performance by adjusting the low-rank matrices.</p><h3 id="2-2-Implementation-Method"><a href="#2-2-Implementation-Method" class="headerlink" title="2.2 Implementation Method"></a>2.2 <strong>Implementation Method</strong></h3><ul><li><strong>Weight Decomposition</strong>: For the modelâ€™s linear layers (such as the <code>q_proj</code> and <code>v_proj</code> layers in the attention mechanism), decompose the weight matrix into two low-rank matrices $B$ and $A$.</li><li><strong>Fine-Tune Specific Layers</strong>: Apply LoRA only to these specific linear layers, keeping other layers in the model unchanged.</li></ul><h3 id="2-3-Layers-to-Fine-Tune-vs-Layers-to-Keep-Unchanged"><a href="#2-3-Layers-to-Fine-Tune-vs-Layers-to-Keep-Unchanged" class="headerlink" title="2.3 Layers to Fine-Tune vs. Layers to Keep Unchanged"></a>2.3 <strong>Layers to Fine-Tune vs. Layers to Keep Unchanged</strong></h3><h4 id="Layers-to-Fine-Tune"><a href="#Layers-to-Fine-Tune" class="headerlink" title="Layers to Fine-Tune"></a><strong>Layers to Fine-Tune</strong></h4><p>LoRA is typically applied to the linear projection layers in Transformer models, especially several key layers in the multi-head attention mechanism:</p><ul><li><strong>q_proj</strong> (Query Projection Layer)</li><li><strong>k_proj</strong> (Key Projection Layer)</li><li><strong>v_proj</strong> (Value Projection Layer)</li><li><strong>o_proj</strong> (Output Projection Layer)</li><li><strong>ffn_up_proj</strong> and <strong>ffn_down_proj</strong> (Up and Down Projection Layers of the Feedforward Neural Network)</li></ul><h4 id="Layers-to-Keep-Unchanged"><a href="#Layers-to-Keep-Unchanged" class="headerlink" title="Layers to Keep Unchanged"></a><strong>Layers to Keep Unchanged</strong></h4><ul><li><strong>Embedding Layers</strong>: Responsible for encoding inputs and outputs, usually do not require fine-tuning.</li><li><strong>LayerNorm Layers</strong>: These layers are mainly used for normalization, do not contain many parameters, and are typically kept unchanged.</li><li><strong>Activation Function Layers</strong>: Non-linear activation functions like ReLU or GELU do not involve parameters and do not require fine-tuning.</li></ul><h3 id="2-4-Loss-Function"><a href="#2-4-Loss-Function" class="headerlink" title="2.4 Loss Function"></a>2.4 <strong>Loss Function</strong></h3><p>The loss function for LoRA is usually task-specific. In language generation tasks, LoRA uses <strong>cross-entropy loss</strong> to measure the difference between the generated text and the target text:</p><p>$$<br>\mathcal{L}<em>{\text{LoRA}} = - \sum</em>{i} y_i \log(\hat{y}_i)<br>$$</p><p>where $y_i$ is the true label, and $\hat{y}_i$ is the modelâ€™s output probability.</p><h3 id="2-5-Optimizer"><a href="#2-5-Optimizer" class="headerlink" title="2.5 Optimizer"></a>2.5 <strong>Optimizer</strong></h3><p>LoRA fine-tuning typically uses the <strong>AdamW</strong> optimizer, as shown in the following code:</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">optimizer = torch.optim.AdamW(lora_model.parameters(), lr=<span class="number">5e-5</span>)</span><br></pre></td></tr></tbody></table></figure><h3 id="2-6-Core-Code"><a href="#2-6-Core-Code" class="headerlink" title="2.6 Core Code"></a>2.6 <strong>Core Code</strong></h3><p>Implementing LoRA using the <code>peft</code> library:</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> peft <span class="keyword">import</span> LoraConfig, get_peft_model</span><br><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> AutoModelForSeq2SeqLM</span><br><span class="line"></span><br><span class="line">model_name = <span class="string">"gpt2"</span></span><br><span class="line">model = AutoModelForSeq2SeqLM.from_pretrained(model_name)</span><br><span class="line"></span><br><span class="line">lora_config = LoraConfig(</span><br><span class="line">    r=<span class="number">8</span>,                </span><br><span class="line">    lora_alpha=<span class="number">32</span>,      </span><br><span class="line">    target_modules=[<span class="string">"q_proj"</span>, <span class="string">"v_proj"</span>],  </span><br><span class="line">    lora_dropout=<span class="number">0.1</span>,   </span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">lora_model = get_peft_model(model, lora_config)</span><br><span class="line">lora_model.train()</span><br></pre></td></tr></tbody></table></figure><hr><h2 id="3-Alignment-Alignment-Techniques"><a href="#3-Alignment-Alignment-Techniques" class="headerlink" title="3. Alignment (Alignment Techniques)"></a>3. <strong>Alignment (Alignment Techniques)</strong></h2><p>Before introducing KL divergence, we first need to clarify how LLM alignment is achieved, along with the underlying principles and mathematical formulas.</p><h3 id="1-What-is-Model-Alignment"><a href="#1-What-is-Model-Alignment" class="headerlink" title="1. What is Model Alignment?"></a><strong>1. What is Model Alignment?</strong></h3><p>The core objective of model alignment is to ensure that the language modelâ€™s outputs meet human expectations or preferences. Typically, the model is initially trained through large-scale supervised learning (SFT, Supervised Fine-Tuning) to generate a model with basic capabilities. Subsequently, through alignment techniques, the model is further adjusted to ensure that its generated content better aligns with human preferences or avoids producing harmful or erroneous information.</p><p><strong>Core Mechanism of Alignment</strong>:</p><ul><li><strong>Positive Samples</strong>: Outputs that meet human expectations (e.g., correct answers).</li><li><strong>Negative Samples</strong>: Outputs that do not meet human expectations (e.g., incorrect answers).</li></ul><p>By using paired preference data or labels (correct/incorrect), the modelâ€™s outputs are further fine-tuned to generate more positive samples while reducing the probability of generating negative samples.</p><hr><h3 id="2-Mathematical-Principles-of-Model-Alignment"><a href="#2-Mathematical-Principles-of-Model-Alignment" class="headerlink" title="2. Mathematical Principles of Model Alignment"></a><strong>2. Mathematical Principles of Model Alignment</strong></h3><p>During the alignment process, the model generates outputs through a <strong>policy model</strong>, which is typically an SFT-trained language model used to generate outputs given an input. To optimize the modelâ€™s outputs to better align with human preferences, the following loss functions and optimization methods are commonly used:</p><h4 id="2-1-Policy-Model"><a href="#2-1-Policy-Model" class="headerlink" title="2.1 Policy Model"></a><strong>2.1 Policy Model</strong></h4><p>Assume the current policy of the model is $\pi_\theta$, which represents the probability of the model generating output $y$ given input $x$:</p><p>$$<br>\pi_\theta(y|x)<br>$$</p><p>The objective of the policy model is to adjust the parameters $\theta$ to increase the probability of generating correct outputs (positive samples) and decrease the probability of generating incorrect outputs (negative samples).</p><h4 id="2-2-Mechanism-for-Increasing-Positive-Sample-Probability-and-Decreasing-Negative-Sample-Probability"><a href="#2-2-Mechanism-for-Increasing-Positive-Sample-Probability-and-Decreasing-Negative-Sample-Probability" class="headerlink" title="2.2 Mechanism for Increasing Positive Sample Probability and Decreasing Negative Sample Probability"></a><strong>2.2 Mechanism for Increasing Positive Sample Probability and Decreasing Negative Sample Probability</strong></h4><p>To achieve this goal, loss functions with preference comparisons or labels are typically used for optimization:</p><ol><li><p><strong>Optimization of Positive Samples</strong>: By increasing the loss weight of positive samples, the model is guided to generate positive samples with higher probability when faced with the same problem.</p><ul><li>The loss function for positive samples guides the model to produce more outputs that meet human expectations.</li></ul></li><li><p><strong>Penalty for Negative Samples</strong>: By applying higher loss weights to negative samples, the model learns to reduce the probability of generating these incorrect outputs.</p><ul><li>The loss function for negative samples aims to penalize the model more when it generates incorrect answers, thereby reducing the likelihood of such outputs.</li></ul></li></ol><p>In some methods, such as DPO and KTO, <strong>KL divergence</strong> between the current policy model and a reference model is calculated to prevent the model from deviating excessively from the original pre-trained model during optimization.</p><hr><h3 id="3-Role-of-Loss-Functions-and-KL-Divergence"><a href="#3-Role-of-Loss-Functions-and-KL-Divergence" class="headerlink" title="3. Role of Loss Functions and KL Divergence"></a><strong>3. Role of Loss Functions and KL Divergence</strong></h3><p>In the model alignment process, the loss function typically consists of two parts:</p><ol><li><strong>Preference Loss</strong> or <strong>Label Loss</strong>, used to optimize the model to generate outputs that meet human expectations.</li><li><strong>KL Divergence</strong>, used to constrain the model from deviating from the reference model.</li></ol><h4 id="3-1-Role-of-KL-Divergence"><a href="#3-1-Role-of-KL-Divergence" class="headerlink" title="3.1 Role of KL Divergence"></a><strong>3.1 Role of KL Divergence</strong></h4><p>KL divergence (Kullback-Leibler Divergence) measures the difference between two probability distributions. In model alignment, KL divergence is used to limit the distribution difference between the current model $\pi_\theta$ and the reference model $\pi_{\text{ref}}$, ensuring that the modelâ€™s outputs do not deviate excessively from the pre-trained model during optimization. The specific formula is:</p><p>$$<br>\text{KL}(\pi_\theta(y|x) | \pi_{\text{ref}}(y|x)) = \sum_y \pi_\theta(y|x) \log \frac{\pi_\theta(y|x)}{\pi_{\text{ref}}(y|x)}<br>$$</p><ul><li>If the KL divergence is large, it indicates that the current modelâ€™s generated distribution significantly differs from the reference model, which may mean the model is producing unreasonable outputs.</li><li>By minimizing KL divergence, the model can be further optimized while ensuring the reasonableness of its outputs.</li></ul><h4 id="3-2-Loss-Function-Formulas"><a href="#3-2-Loss-Function-Formulas" class="headerlink" title="3.2 Loss Function Formulas"></a><strong>3.2 Loss Function Formulas</strong></h4><p>Based on preferences or labels, the modelâ€™s loss function can be expressed in the following forms:</p><h5 id="Loss-Function-in-DPO"><a href="#Loss-Function-in-DPO" class="headerlink" title="Loss Function in DPO:"></a><strong>Loss Function in DPO</strong>:</h5><p>$$<br>L_{DPO} = -\mathbb{E}_{x, y_w, y_l \sim D} [\log \sigma(\beta (\log(\pi_\theta(y_w|x)) - \log(\pi_\theta(y_l|x))))]<br>$$</p><ul><li>$y_w$: Higher-preference answer.</li><li>$y_l$: Lower-preference answer.</li></ul><p>In DPO, KL divergence can be introduced as a regularization term:<br>$$<br>L_{DPO} = -\log \sigma(\log(\pi_\theta(y_w|x)) - \log(\pi_\theta(y_l|x)) + \beta \cdot \text{KL}(\pi_\theta | \pi_{\text{ref}}))<br>$$<br>By controlling KL divergence, the modelâ€™s outputs do not deviate too much from the reference model.</p><h5 id="Loss-Function-in-KTO"><a href="#Loss-Function-in-KTO" class="headerlink" title="Loss Function in KTO:"></a><strong>Loss Function in KTO</strong>:</h5><p>The loss function in KTO is based on prospect theory and incorporates KL divergence as a core component:<br>$$<br>L_{KTO} = \lambda_U \cdot \sigma(\beta \cdot (\text{KL}(\pi_\theta(\text{Answer 2}) | \pi_{\text{ref}}) - r_{\theta}(\text{Answer 2})))<br>$$</p><ul><li>$r_{\theta}(x, y)$: The current policyâ€™s confidence in negative samples (incorrect answers).</li><li>KL divergence is used to measure the difference between the current model and the reference model, ensuring that while reducing the generation of negative samples, the model does not deviate from the original reference model.</li></ul><p>By increasing the loss for negative samples (i.e., increasing the value of $\lambda_U$), the model reduces the confidence in negative samples, thereby decreasing the probability of generating similar incorrect answers in the future.</p><hr><h3 id="4-How-to-Optimize-the-Model"><a href="#4-How-to-Optimize-the-Model" class="headerlink" title="4. How to Optimize the Model"></a><strong>4. How to Optimize the Model</strong></h3><p>Through the loss functions introduced above, model optimization is typically performed using <strong>Gradient Descent</strong>. The gradients of the loss function reflect the differences between the modelâ€™s outputs and the expected outputs, and the optimization goal is to minimize the loss function.</p><p><strong>Gradient Update Formula</strong>:<br>$$<br>\theta_{\text{new}} = \theta_{\text{old}} - \eta \nabla_{\theta} L<br>$$<br>where:</p><ul><li>$\eta$ is the learning rate, determining the step size of each parameter update.</li><li>$\nabla_{\theta} L$ is the gradient of the loss function with respect to the model parameters, indicating the contribution of the current parameters to the loss.</li></ul><p>Through continuous iteration, the model gradually increases the probability of generating positive samples and decreases the probability of generating negative samples, ultimately achieving model alignment.</p><ul><li>The core objective of <strong>Model Alignment</strong> is to optimize the modelâ€™s outputs to meet human expectations through preference or label data.</li><li>The <strong>Policy Model</strong> ($\pi_\theta$) generates outputs, and KL divergence is used to control the degree of deviation from the reference model, preventing unreasonable biases during optimization.</li><li>The <strong>Probability of Positive Samples</strong> is gradually increased through the optimization of the loss function, while the <strong>Probability of Negative Samples</strong> is reduced by increasing loss weights and lowering confidence.</li><li>Gradient descent is used to update model parameters, ultimately achieving model alignment.</li></ul><hr><h2 id="4-DPO-Direct-Preference-Optimization"><a href="#4-DPO-Direct-Preference-Optimization" class="headerlink" title="4. DPO (Direct Preference Optimization)"></a>4. <strong>DPO (Direct Preference Optimization)</strong></h2><h3 id="4-1-Principle"><a href="#4-1-Principle" class="headerlink" title="4.1 Principle"></a>4.1 <strong>Principle</strong></h3><p>DPO directly optimizes the modelâ€™s output preference function to make the modelâ€™s outputs more aligned with human preferences. It compares different outputs generated by the model and uses a preference function to evaluate which of the two outputs is better, thereby guiding the optimization of the model parameters.</p><h3 id="4-2-Loss-Function"><a href="#4-2-Loss-Function" class="headerlink" title="4.2 Loss Function"></a>4.2 <strong>Loss Function</strong></h3><p>DPO uses a preference loss function to compare the quality of two outputs:</p><p>$$<br>\mathcal{L}_{\text{DPO}} = \log(1 + \exp(-\sigma \cdot (\hat{y}_a - \hat{y}_b) \cdot p))<br>$$</p><ul><li>$ \hat{y}_a $ and $ \hat{y}_b $ are the modelâ€™s predictions for two samples.</li><li>$ p $ is the human preference (1 indicates preference for $a$, -1 indicates preference for $b$).</li><li>$ \sigma $ is a smoothing parameter.</li></ul><h3 id="4-3-Optimizer"><a href="#4-3-Optimizer" class="headerlink" title="4.3 Optimizer"></a>4.3 <strong>Optimizer</strong></h3><p>DPO typically uses the <strong>AdamW</strong> optimizer, which is suitable for optimizing large-scale parameter models. The code is as follows:</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">optimizer = torch.optim.AdamW(model.parameters(), lr=<span class="number">1e-5</span>)</span><br></pre></td></tr></tbody></table></figure><h3 id="4-4-Core-Code"><a href="#4-4-Core-Code" class="headerlink" title="4.4 Core Code"></a>4.4 <strong>Core Code</strong></h3><p>The following are the training steps for DPO:</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">preference_loss</span>(<span class="params">output_a, output_b, human_preference</span>):</span><br><span class="line">    preference = human_preference(output_a, output_b)</span><br><span class="line">    loss = torch.log(<span class="number">1</span> + torch.exp(-preference * (output_a - output_b)))</span><br><span class="line">    <span class="keyword">return</span> loss</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dpo_training_step</span>(<span class="params">model, data_a, data_b, human_preference</span>):</span><br><span class="line">    output_a = model(data_a)</span><br><span class="line">    output_b = model(data_b)</span><br><span class="line">    </span><br><span class="line">    loss = preference_loss(output_a, output_b, human_preference)</span><br><span class="line">    loss.backward()</span><br><span class="line">    optimizer.step()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> batch_a, batch_b <span class="keyword">in</span> training_data:</span><br><span class="line">    dpo_training_step(model, batch_a, batch_b, human_preference_function)</span><br></pre></td></tr></tbody></table></figure><hr><h2 id="5-KTO-Kahneman-Tversky-Optimization"><a href="#5-KTO-Kahneman-Tversky-Optimization" class="headerlink" title="5. KTO (Kahneman-Tversky Optimization)"></a>5. <strong>KTO (Kahneman-Tversky Optimization)</strong></h2><h3 id="5-1-Principle"><a href="#5-1-Principle" class="headerlink" title="5.1 Principle"></a>5.1 <strong>Principle</strong></h3><p>KTO is based on Kahneman and Tverskyâ€™s Prospect Theory, which uses an asymmetric utility function to measure the modelâ€™s gains and losses. It aims to optimize the modelâ€™s performance, especially in scenarios with asymmetric risks and rewards. The utility function is defined as follows:</p><p>$$<br>\mathcal{U}(x) =<br>\begin{cases}<br>x^{\alpha}, &amp; x \geq 0 \<br>-\lambda (-x)^{\alpha}, &amp; x &lt; 0<br>\end{cases}<br>$$</p><ul><li>$x$ is the difference between the modelâ€™s prediction and the true value.</li><li>$\alpha$ is the non-linear coefficient, typically 0.88.</li><li>$\lambda$ is the loss penalty weight, typically 2.25.</li></ul><h3 id="5-2-Loss-Function"><a href="#5-2-Loss-Function" class="headerlink" title="5.2 Loss Function"></a>5.2 <strong>Loss Function</strong></h3><p>The loss function for KTO is based on the utility function from Prospect Theory and is used to penalize the modelâ€™s prediction errors:</p><p>$$<br>\mathcal{L}<em>{\text{KTO}} = -\mathbb{E}[\mathcal{U}(y</em>{\text{pred}} - y_{\text{true}})]<br>$$</p><h3 id="5-3-Optimizer"><a href="#5-3-Optimizer" class="headerlink" title="5.3 Optimizer"></a>5.3 <strong>Optimizer</strong></h3><p>KTO commonly uses the <strong>AdamW</strong> optimizer to ensure stability during the training process:</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">optimizer = torch.optim.AdamW(model.parameters(), lr=<span class="number">3e-5</span>)</span><br></pre></td></tr></tbody></table></figure><h3 id="5-4-Core-Code"><a href="#5-4-Core-Code" class="headerlink" title="5.4 Core Code"></a>5.4 <strong>Core Code</strong></h3><p>The following is the code for calculating the KTO loss function:</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">prospect_utility</span>(<span class="params">value, alpha=<span class="number">0.88</span>, lambda_=<span class="number">2.25</span></span>):</span><br><span class="line">    <span class="keyword">if</span> value &gt;= <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> torch.<span class="built_in">pow</span>(value, alpha)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> -lambda_ * torch.<span class="built_in">pow</span>(-value, alpha)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">kto_loss</span>(<span class="params">predictions, targets</span>):</span><br><span class="line">    value = predictions - targets</span><br><span class="line">    utility = prospect_utility(value)</span><br><span class="line">    loss = -torch.mean(utility)</span><br><span class="line">    <span class="keyword">return</span> loss</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> data <span class="keyword">in</span> dataloader:</span><br><span class="line">    predictions = model(data)</span><br><span class="line">    loss = kto_loss(predictions, targets)</span><br><span class="line">    loss.backward()</span><br><span class="line">    optimizer.step()</span><br></pre></td></tr></tbody></table></figure><hr><h3 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a><strong>Summary</strong></h3><table><thead><tr><th>Method</th><th>Loss Function</th><th>Optimizer</th></tr></thead><tbody><tr><td><strong>SFT</strong></td><td>Cross-Entropy Loss</td><td>AdamW, RMSprop, SGD</td></tr><tr><td><strong>LoRA</strong></td><td>Cross-Entropy Loss</td><td>AdamW, RMSprop, SGD</td></tr><tr><td><strong>DPO</strong></td><td>Preference Loss Function: $\log(1 + \exp(-\sigma (\hat{y}_a - \hat{y}_b)p))$</td><td>AdamW</td></tr><tr><td><strong>KTO</strong></td><td>Prospect Theory Utility Function: $-\mathbb{E}[\mathcal{U}(y_{\text{pred}} - y_{\text{true}})]$</td><td>AdamW</td></tr></tbody></table><p>Through the organization of this document, readers can clearly understand the principles, specific implementation steps, loss function designs, and optimizer selections for technologies such as SFT, LoRA, DPO, and KTO, especially in the context of fine-tuning large-scale pre-trained models like LLAMA3.</p>]]></content>
      
      
      <categories>
          
          <category> NLP Insights </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LLM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LoRA, DPO, KTO ä¸ SFT æŠ€æœ¯è¯¦è§£</title>
      <link href="/2024/10/23/NLP%20Insights/LLM%E8%AE%AD%E7%BB%83%E6%9C%AF%E8%AF%AD%E4%BB%8B%E7%BB%8D%EF%BC%9ASFT%E3%80%81LoRA%E3%80%81Alignment%E3%80%81KTO%E5%92%8CDPO/"/>
      <url>/2024/10/23/NLP%20Insights/LLM%E8%AE%AD%E7%BB%83%E6%9C%AF%E8%AF%AD%E4%BB%8B%E7%BB%8D%EF%BC%9ASFT%E3%80%81LoRA%E3%80%81Alignment%E3%80%81KTO%E5%92%8CDPO/</url>
      
        <content type="html"><![CDATA[<h3 id="LoRA-DPO-KTO-ä¸-SFT-æŠ€æœ¯è¯¦è§£"><a href="#LoRA-DPO-KTO-ä¸-SFT-æŠ€æœ¯è¯¦è§£" class="headerlink" title="LoRA, DPO, KTO ä¸ SFT æŠ€æœ¯è¯¦è§£"></a><strong>LoRA, DPO, KTO ä¸ SFT æŠ€æœ¯è¯¦è§£</strong></h3><p>æœ¬ç¯‡æ–‡æ¡£å°†è¯¦ç»†ä»‹ç»å‡ ç§åœ¨å¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆå¦‚ LLAMA3ï¼‰å¾®è°ƒå’Œä¼˜åŒ–ä¸­çš„é‡è¦æŠ€æœ¯ï¼ŒåŒ…æ‹¬ <strong>SFTï¼ˆSupervised Fine-Tuningï¼‰</strong>ã€<strong>LoRAï¼ˆLow-Rank Adaptationï¼‰</strong>ã€<strong>Alignment</strong> æŠ€æœ¯ã€<strong>KTOï¼ˆKahneman-Tversky Optimizationï¼‰</strong> å’Œ <strong>DPOï¼ˆDirect Preference Optimizationï¼‰</strong>ã€‚æ–‡ä¸­è¿˜å°†è¯¦ç»†é˜è¿°æ¯ç§æŠ€æœ¯çš„åŸç†ã€å…·ä½“å®ç°æ–¹æ³•ä»¥åŠç›¸åº”çš„æŸå¤±å‡½æ•°ä¸ä¼˜åŒ–å™¨é€‰æ‹©ã€‚</p><hr><h2 id="1-SFTï¼ˆSupervised-Fine-Tuningï¼‰"><a href="#1-SFTï¼ˆSupervised-Fine-Tuningï¼‰" class="headerlink" title="1. SFTï¼ˆSupervised Fine-Tuningï¼‰"></a>1. <strong>SFTï¼ˆSupervised Fine-Tuningï¼‰</strong></h2><h3 id="1-1-åŸç†"><a href="#1-1-åŸç†" class="headerlink" title="1.1 åŸç†"></a>1.1 <strong>åŸç†</strong></h3><p>SFT æ˜¯ä¸€ç§ä¼ ç»Ÿçš„å¾®è°ƒæ–¹æ³•ï¼Œé€šè¿‡ç›‘ç£å­¦ä¹ å¯¹é¢„è®­ç»ƒæ¨¡å‹è¿›è¡Œå¾®è°ƒï¼Œè°ƒæ•´æ¨¡å‹çš„å‚æ•°ä½¿å…¶åœ¨ç‰¹å®šä»»åŠ¡ä¸Šè¡¨ç°æ›´å¥½ã€‚SFT é€šå¸¸ç”¨äºé’ˆå¯¹ç‰¹å®šçš„æ ‡æ³¨æ•°æ®è¿›è¡Œæ¨¡å‹å¾®è°ƒï¼Œè®­ç»ƒçš„è¿‡ç¨‹ç±»ä¼¼äºå¸¸è§„çš„ç›‘ç£å­¦ä¹ ã€‚</p><h3 id="1-2-å®ç°æ–¹æ³•"><a href="#1-2-å®ç°æ–¹æ³•" class="headerlink" title="1.2 å®ç°æ–¹æ³•"></a>1.2 <strong>å®ç°æ–¹æ³•</strong></h3><ul><li><strong>é€‰æ‹©é¢„è®­ç»ƒæ¨¡å‹</strong>ï¼šå¦‚ GPTã€BERT ç­‰è¯­è¨€æ¨¡å‹ã€‚</li><li><strong>å‡†å¤‡æ ‡æ³¨æ•°æ®é›†</strong>ï¼šæ•°æ®é›†åŒ…å«è¾“å…¥å’Œè¾“å‡ºå¯¹ã€‚</li><li><strong>è®­ç»ƒæ¨¡å‹</strong>ï¼šä½¿ç”¨æ ‡å‡†çš„äº¤å‰ç†µæŸå¤±å‡½æ•°å¯¹æ¨¡å‹è¿›è¡Œè®­ç»ƒï¼Œé€šè¿‡æ¢¯åº¦ä¸‹é™ä¼˜åŒ–å‚æ•°ã€‚</li></ul><h3 id="1-3-æ ¸å¿ƒä»£ç "><a href="#1-3-æ ¸å¿ƒä»£ç " class="headerlink" title="1.3 æ ¸å¿ƒä»£ç "></a>1.3 <strong>æ ¸å¿ƒä»£ç </strong></h3><p>ä½¿ç”¨ Hugging Face çš„ <code>Trainer</code> æ¥å£è¿›è¡Œ SFTï¼š</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> Trainer, TrainingArguments, AutoModelForSeq2SeqLM, AutoTokenizer</span><br><span class="line"></span><br><span class="line">model_name = <span class="string">"gpt2"</span></span><br><span class="line">model = AutoModelForSeq2SeqLM.from_pretrained(model_name)</span><br><span class="line">tokenizer = AutoTokenizer.from_pretrained(model_name)</span><br><span class="line"></span><br><span class="line">train_dataset = load_dataset(<span class="string">"my_dataset"</span>, split=<span class="string">"train"</span>)</span><br><span class="line"></span><br><span class="line">training_args = TrainingArguments(</span><br><span class="line">    output_dir=<span class="string">"./results"</span>,</span><br><span class="line">    evaluation_strategy=<span class="string">"epoch"</span>,</span><br><span class="line">    learning_rate=<span class="number">2e-5</span>,</span><br><span class="line">    per_device_train_batch_size=<span class="number">16</span>,</span><br><span class="line">    num_train_epochs=<span class="number">3</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">trainer = Trainer(</span><br><span class="line">    model=model,</span><br><span class="line">    args=training_args,</span><br><span class="line">    train_dataset=train_dataset,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">trainer.train()</span><br></pre></td></tr></tbody></table></figure><hr><h2 id="2-LoRAï¼ˆLow-Rank-Adaptationï¼‰"><a href="#2-LoRAï¼ˆLow-Rank-Adaptationï¼‰" class="headerlink" title="2. LoRAï¼ˆLow-Rank Adaptationï¼‰"></a>2. <strong>LoRAï¼ˆLow-Rank Adaptationï¼‰</strong></h2><h3 id="2-1-åŸç†"><a href="#2-1-åŸç†" class="headerlink" title="2.1 åŸç†"></a>2.1 <strong>åŸç†</strong></h3><p>LoRA æ˜¯ä¸€ç§å‚æ•°é«˜æ•ˆçš„å¾®è°ƒæŠ€æœ¯ï¼Œé€šè¿‡å¯¹å¤§æ¨¡å‹ä¸­çš„æƒé‡çŸ©é˜µè¿›è¡Œä½ç§©åˆ†è§£ï¼Œå°†åŸå§‹æƒé‡çŸ©é˜µ $W$ åˆ†è§£ä¸ºä¸¤ä¸ªä½ç§©çŸ©é˜µ $B$ å’Œ $A$ï¼Œå¹¶ä»…å¯¹è¿™äº›ä½ç§©çŸ©é˜µè¿›è¡Œå¾®è°ƒã€‚LoRA çš„è®¾è®¡ç›®æ ‡æ˜¯å‡å°‘å¾®è°ƒå‚æ•°çš„æ•°é‡ï¼Œåœ¨ä¿ç•™é¢„è®­ç»ƒæ¨¡å‹æƒé‡çš„åŒæ—¶ï¼Œé€šè¿‡è°ƒæ•´ä½ç§©çŸ©é˜µæ¥ä¼˜åŒ–æ¨¡å‹è¡¨ç°ã€‚</p><h3 id="2-2-å®ç°æ–¹æ³•"><a href="#2-2-å®ç°æ–¹æ³•" class="headerlink" title="2.2 å®ç°æ–¹æ³•"></a>2.2 <strong>å®ç°æ–¹æ³•</strong></h3><ul><li><strong>æƒé‡åˆ†è§£</strong>ï¼šå¯¹äºæ¨¡å‹çš„çº¿æ€§å±‚ï¼ˆå¦‚æ³¨æ„åŠ›æœºåˆ¶ä¸­çš„ <code>q_proj</code> å’Œ <code>v_proj</code> å±‚ï¼‰ï¼Œå°†æƒé‡çŸ©é˜µåˆ†è§£ä¸ºä¸¤ä¸ªä½ç§©çŸ©é˜µ $B$ å’Œ $A$ã€‚</li><li><strong>å¾®è°ƒç‰¹å®šå±‚</strong>ï¼šä»…å¯¹è¿™äº›ç‰¹å®šçš„çº¿æ€§å±‚åº”ç”¨ LoRAï¼Œè€Œæ¨¡å‹ä¸­çš„å…¶ä»–å±‚ä¿æŒä¸å˜ã€‚</li></ul><h3 id="2-3-å¯å¾®è°ƒçš„å±‚ä¸ä¸å˜çš„å±‚"><a href="#2-3-å¯å¾®è°ƒçš„å±‚ä¸ä¸å˜çš„å±‚" class="headerlink" title="2.3 å¯å¾®è°ƒçš„å±‚ä¸ä¸å˜çš„å±‚"></a>2.3 <strong>å¯å¾®è°ƒçš„å±‚ä¸ä¸å˜çš„å±‚</strong></h3><h4 id="å¯å¾®è°ƒçš„å±‚"><a href="#å¯å¾®è°ƒçš„å±‚" class="headerlink" title="å¯å¾®è°ƒçš„å±‚"></a><strong>å¯å¾®è°ƒçš„å±‚</strong></h4><p>LoRA é€šå¸¸åº”ç”¨äº Transformer æ¨¡å‹ä¸­çš„çº¿æ€§æŠ•å½±å±‚ï¼Œå°¤å…¶æ˜¯å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶ä¸­çš„å‡ ä¸ªå…³é”®å±‚ï¼š</p><ul><li><strong>q_proj</strong>ï¼ˆQuery æŠ•å½±å±‚ï¼‰</li><li><strong>k_proj</strong>ï¼ˆKey æŠ•å½±å±‚ï¼‰</li><li><strong>v_proj</strong>ï¼ˆValue æŠ•å½±å±‚ï¼‰</li><li><strong>o_proj</strong>ï¼ˆOutput æŠ•å½±å±‚ï¼‰</li><li><strong>ffn_up_proj</strong> å’Œ <strong>ffn_down_proj</strong>ï¼ˆå‰é¦ˆç¥ç»ç½‘ç»œçš„ä¸Šä¸‹æŠ•å½±å±‚ï¼‰</li></ul><h4 id="ä¸å˜çš„å±‚"><a href="#ä¸å˜çš„å±‚" class="headerlink" title="ä¸å˜çš„å±‚"></a><strong>ä¸å˜çš„å±‚</strong></h4><ul><li><strong>Embedding å±‚</strong>ï¼šè´Ÿè´£è¾“å…¥å’Œè¾“å‡ºçš„ç¼–ç ï¼Œé€šå¸¸ä¸éœ€è¦å¾®è°ƒã€‚</li><li><strong>LayerNorm å±‚</strong>ï¼šè¿™äº›å±‚ä¸»è¦ç”¨äºå½’ä¸€åŒ–ï¼Œä¸å«å¤§é‡å‚æ•°ï¼Œé€šå¸¸ä¿æŒä¸å˜ã€‚</li><li><strong>æ¿€æ´»å‡½æ•°å±‚</strong>ï¼šå¦‚ ReLU æˆ– GELU ç­‰éçº¿æ€§æ¿€æ´»å‡½æ•°ä¸æ¶‰åŠå‚æ•°ï¼Œä¸éœ€è¦è¿›è¡Œå¾®è°ƒã€‚</li></ul><h3 id="2-4-æŸå¤±å‡½æ•°"><a href="#2-4-æŸå¤±å‡½æ•°" class="headerlink" title="2.4 æŸå¤±å‡½æ•°"></a>2.4 <strong>æŸå¤±å‡½æ•°</strong></h3><p>LoRA çš„æŸå¤±å‡½æ•°é€šå¸¸ä¸å…·ä½“ä»»åŠ¡ç›¸å…³ã€‚åœ¨è¯­è¨€ç”Ÿæˆä»»åŠ¡ä¸­ï¼ŒLoRA ä½¿ç”¨<strong>äº¤å‰ç†µæŸå¤±</strong>æ¥åº¦é‡ç”Ÿæˆæ–‡æœ¬å’Œç›®æ ‡æ–‡æœ¬ä¹‹é—´çš„å·®å¼‚ï¼š</p><p>$$<br>\mathcal{L}<em>{\text{LoRA}} = - \sum</em>{i} y_i \log(\hat{y}_i)<br>$$</p><p>å…¶ä¸­ $y_i$ æ˜¯çœŸå®æ ‡ç­¾ï¼Œ$\hat{y}_i$ æ˜¯æ¨¡å‹çš„è¾“å‡ºæ¦‚ç‡ã€‚</p><h3 id="2-5-ä¼˜åŒ–å™¨"><a href="#2-5-ä¼˜åŒ–å™¨" class="headerlink" title="2.5 ä¼˜åŒ–å™¨"></a>2.5 <strong>ä¼˜åŒ–å™¨</strong></h3><p>LoRA å¾®è°ƒé€šå¸¸ä½¿ç”¨ <strong>AdamW</strong> ä¼˜åŒ–å™¨ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">optimizer = torch.optim.AdamW(lora_model.parameters(), lr=<span class="number">5e-5</span>)</span><br></pre></td></tr></tbody></table></figure><h3 id="2-6-æ ¸å¿ƒä»£ç "><a href="#2-6-æ ¸å¿ƒä»£ç " class="headerlink" title="2.6 æ ¸å¿ƒä»£ç "></a>2.6 <strong>æ ¸å¿ƒä»£ç </strong></h3><p>ä½¿ç”¨ <code>peft</code> åº“å®ç° LoRAï¼š</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> peft <span class="keyword">import</span> LoraConfig, get_peft_model</span><br><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> AutoModelForSeq2SeqLM</span><br><span class="line"></span><br><span class="line">model_name = <span class="string">"gpt2"</span></span><br><span class="line">model = AutoModelForSeq2SeqLM.from_pretrained(model_name)</span><br><span class="line"></span><br><span class="line">lora_config = LoraConfig(</span><br><span class="line">    r=<span class="number">8</span>,                </span><br><span class="line">    lora_alpha=<span class="number">32</span>,      </span><br><span class="line">    target_modules=[<span class="string">"q_proj"</span>, <span class="string">"v_proj"</span>],  </span><br><span class="line">    lora_dropout=<span class="number">0.1</span>,   </span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">lora_model = get_peft_model(model, lora_config)</span><br><span class="line">lora_model.train()</span><br></pre></td></tr></tbody></table></figure><hr><h2 id="3-Alignmentï¼ˆå¯¹é½æŠ€æœ¯ï¼‰"><a href="#3-Alignmentï¼ˆå¯¹é½æŠ€æœ¯ï¼‰" class="headerlink" title="3. Alignmentï¼ˆå¯¹é½æŠ€æœ¯ï¼‰"></a>3. <strong>Alignmentï¼ˆå¯¹é½æŠ€æœ¯ï¼‰</strong></h2><p>åœ¨å¼•å…¥KLæ•£åº¦ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦æ˜ç¡®LLMå¯¹é½ï¼ˆAlignmentï¼‰æ˜¯å¦‚ä½•å®ç°çš„ï¼Œä»¥åŠèƒŒåçš„åŸç†å’Œæ•°å­¦å…¬å¼ã€‚</p><h3 id="1-ä»€ä¹ˆæ˜¯æ¨¡å‹å¯¹é½ï¼ˆAlignmentï¼‰ï¼Ÿ"><a href="#1-ä»€ä¹ˆæ˜¯æ¨¡å‹å¯¹é½ï¼ˆAlignmentï¼‰ï¼Ÿ" class="headerlink" title="1. ä»€ä¹ˆæ˜¯æ¨¡å‹å¯¹é½ï¼ˆAlignmentï¼‰ï¼Ÿ"></a><strong>1. ä»€ä¹ˆæ˜¯æ¨¡å‹å¯¹é½ï¼ˆAlignmentï¼‰ï¼Ÿ</strong></h3><p>æ¨¡å‹å¯¹é½çš„æ ¸å¿ƒç›®æ ‡æ˜¯è®©è¯­è¨€æ¨¡å‹çš„è¾“å‡ºç¬¦åˆäººç±»çš„æœŸæœ›æˆ–åå¥½ã€‚é€šå¸¸ï¼Œæ¨¡å‹æœ€åˆé€šè¿‡å¤§è§„æ¨¡ç›‘ç£å­¦ä¹ ï¼ˆSFTï¼ŒSupervised Fine-Tuningï¼‰è®­ç»ƒï¼Œç”Ÿæˆå…·æœ‰åŸºç¡€èƒ½åŠ›çš„æ¨¡å‹ã€‚æ¥ä¸‹æ¥ï¼Œé€šè¿‡å¯¹é½æŠ€æœ¯ï¼Œè¿›ä¸€æ­¥è°ƒæ•´æ¨¡å‹ï¼Œä½¿å…¶ç”Ÿæˆçš„å†…å®¹æ›´ç¬¦åˆäººç±»åå¥½æˆ–é¿å…äº§ç”Ÿæœ‰å®³ã€é”™è¯¯çš„ä¿¡æ¯ã€‚</p><p><strong>å¯¹é½çš„æ ¸å¿ƒæœºåˆ¶</strong>ï¼š</p><ul><li><strong>æ­£æ ·æœ¬</strong>ï¼šç¬¦åˆäººç±»é¢„æœŸçš„è¾“å‡ºï¼ˆå¦‚æ­£ç¡®å›ç­”ï¼‰ã€‚</li><li><strong>è´Ÿæ ·æœ¬</strong>ï¼šä¸ç¬¦åˆäººç±»é¢„æœŸçš„è¾“å‡ºï¼ˆå¦‚é”™è¯¯å›ç­”ï¼‰ã€‚</li></ul><p>é€šè¿‡ä½¿ç”¨æˆå¯¹åå¥½æ•°æ®æˆ–æ ‡ç­¾ï¼ˆæ­£ç¡®/é”™è¯¯ï¼‰ï¼Œå¯¹æ¨¡å‹çš„è¾“å‡ºè¿›è¡Œè¿›ä¸€æ­¥å¾®è°ƒï¼Œä½¿æ¨¡å‹èƒ½å¤Ÿç”Ÿæˆæ›´å¤šçš„æ­£æ ·æœ¬ï¼ŒåŒæ—¶å‡å°‘è´Ÿæ ·æœ¬çš„ç”Ÿæˆæ¦‚ç‡ã€‚</p><hr><h3 id="2-æ¨¡å‹å¯¹é½çš„æ•°å­¦åŸç†"><a href="#2-æ¨¡å‹å¯¹é½çš„æ•°å­¦åŸç†" class="headerlink" title="2. æ¨¡å‹å¯¹é½çš„æ•°å­¦åŸç†"></a><strong>2. æ¨¡å‹å¯¹é½çš„æ•°å­¦åŸç†</strong></h3><p>åœ¨å¯¹é½è¿‡ç¨‹ä¸­ï¼Œæ¨¡å‹ä¼šé€šè¿‡<strong>ç­–ç•¥æ¨¡å‹</strong>ï¼ˆPolicy Modelï¼‰æ¥ç”Ÿæˆè¾“å‡ºï¼Œç­–ç•¥æ¨¡å‹é€šå¸¸æ˜¯ç»è¿‡SFTè®­ç»ƒçš„è¯­è¨€æ¨¡å‹ï¼Œç”¨æ¥åœ¨ç»™å®šè¾“å…¥ä¸‹ç”Ÿæˆè¾“å‡ºã€‚ä¸ºäº†ä¼˜åŒ–æ¨¡å‹çš„è¾“å‡ºï¼Œä½¿å…¶æ›´åŠ ç¬¦åˆäººç±»åå¥½ï¼Œå¸¸å¸¸ä½¿ç”¨ä»¥ä¸‹æŸå¤±å‡½æ•°å’Œä¼˜åŒ–æ–¹æ³•ï¼š</p><h4 id="2-1-ç­–ç•¥æ¨¡å‹"><a href="#2-1-ç­–ç•¥æ¨¡å‹" class="headerlink" title="2.1 ç­–ç•¥æ¨¡å‹"></a><strong>2.1 ç­–ç•¥æ¨¡å‹</strong></h4><p>å‡è®¾å½“å‰æ¨¡å‹çš„ç­–ç•¥ä¸º $\pi_\theta$ï¼Œå®ƒè¡¨ç¤ºåœ¨ç»™å®šè¾“å…¥ $x$ æ—¶ï¼Œæ¨¡å‹ç”Ÿæˆè¾“å‡º $y$ çš„æ¦‚ç‡ï¼š<br>$$<br>\pi_\theta(y|x)<br>$$<br>ç­–ç•¥æ¨¡å‹çš„ç›®æ ‡æ˜¯é€šè¿‡è°ƒæ•´å‚æ•° $\theta$ï¼Œæé«˜ç”Ÿæˆæ­£ç¡®è¾“å‡ºï¼ˆæ­£æ ·æœ¬ï¼‰çš„æ¦‚ç‡ï¼Œé™ä½ç”Ÿæˆé”™è¯¯è¾“å‡ºï¼ˆè´Ÿæ ·æœ¬ï¼‰çš„æ¦‚ç‡ã€‚</p><h4 id="2-2-æé«˜æ­£æ ·æœ¬æ¦‚ç‡ä¸é™ä½è´Ÿæ ·æœ¬æ¦‚ç‡çš„æœºåˆ¶"><a href="#2-2-æé«˜æ­£æ ·æœ¬æ¦‚ç‡ä¸é™ä½è´Ÿæ ·æœ¬æ¦‚ç‡çš„æœºåˆ¶" class="headerlink" title="2.2 æé«˜æ­£æ ·æœ¬æ¦‚ç‡ä¸é™ä½è´Ÿæ ·æœ¬æ¦‚ç‡çš„æœºåˆ¶"></a><strong>2.2 æé«˜æ­£æ ·æœ¬æ¦‚ç‡ä¸é™ä½è´Ÿæ ·æœ¬æ¦‚ç‡çš„æœºåˆ¶</strong></h4><p>ä¸ºäº†å®ç°è¿™ä¸ªç›®æ ‡ï¼Œé€šå¸¸ä½¿ç”¨å¸¦æœ‰åå¥½æ¯”è¾ƒæˆ–æ ‡ç­¾çš„æŸå¤±å‡½æ•°è¿›è¡Œä¼˜åŒ–ï¼š</p><ol><li><p><strong>æ­£æ ·æœ¬çš„ä¼˜åŒ–</strong>ï¼šé€šè¿‡å¢åŠ æ­£æ ·æœ¬çš„æŸå¤±æƒé‡ï¼Œä½¿å¾—æ¨¡å‹ç”Ÿæˆæ­£æ ·æœ¬çš„æ¦‚ç‡æ›´é«˜ã€‚</p><ul><li>æ­£æ ·æœ¬çš„æŸå¤±å‡½æ•°ä¼šå¼•å¯¼æ¨¡å‹åœ¨é¢å¯¹ç›¸åŒé—®é¢˜æ—¶ï¼Œç”Ÿæˆæ›´å¤šç¬¦åˆäººç±»æœŸæœ›çš„ç­”æ¡ˆã€‚</li></ul></li><li><p><strong>è´Ÿæ ·æœ¬çš„æƒ©ç½š</strong>ï¼šå¯¹è´Ÿæ ·æœ¬æ–½åŠ æ›´é«˜çš„æŸå¤±æƒé‡ï¼Œæ¨¡å‹ä¼šå­¦ä¹ åˆ°å‡å°‘è¿™äº›é”™è¯¯è¾“å‡ºçš„æ¦‚ç‡ã€‚</p><ul><li>è´Ÿæ ·æœ¬çš„æŸå¤±å‡½æ•°æ—¨åœ¨è®©æ¨¡å‹åœ¨ç”Ÿæˆé”™è¯¯ç­”æ¡ˆæ—¶æ„ŸçŸ¥åˆ°æ›´å¤§çš„æƒ©ç½šï¼Œä»è€Œå‡å°‘è¿™äº›è¾“å‡ºçš„ç”Ÿæˆã€‚</li></ul></li></ol><p>åœ¨æŸäº›æ–¹æ³•ä¸­ï¼Œä¾‹å¦‚DPOå’ŒKTOï¼Œè¿˜ä¼šé€šè¿‡è®¡ç®—å½“å‰ç­–ç•¥æ¨¡å‹ä¸å‚è€ƒæ¨¡å‹ä¹‹é—´çš„<strong>KLæ•£åº¦</strong>ï¼Œæ¥é˜²æ­¢æ¨¡å‹åœ¨ä¼˜åŒ–è¿‡ç¨‹ä¸­è¿‡åº¦åç¦»åŸå§‹é¢„è®­ç»ƒæ¨¡å‹ã€‚</p><hr><h3 id="3-æŸå¤±å‡½æ•°ä¸KLæ•£åº¦çš„ä½œç”¨"><a href="#3-æŸå¤±å‡½æ•°ä¸KLæ•£åº¦çš„ä½œç”¨" class="headerlink" title="3. æŸå¤±å‡½æ•°ä¸KLæ•£åº¦çš„ä½œç”¨"></a><strong>3. æŸå¤±å‡½æ•°ä¸KLæ•£åº¦çš„ä½œç”¨</strong></h3><p>åœ¨æ¨¡å‹å¯¹é½çš„è¿‡ç¨‹ä¸­ï¼ŒæŸå¤±å‡½æ•°é€šå¸¸åŒ…å«ä¸¤éƒ¨åˆ†ï¼š</p><ol><li><strong>åå¥½æŸå¤±</strong>æˆ–<strong>æ ‡ç­¾æŸå¤±</strong>ï¼Œç”¨äºä¼˜åŒ–æ¨¡å‹ç”Ÿæˆç¬¦åˆäººç±»æœŸæœ›çš„è¾“å‡ºã€‚</li><li><strong>KLæ•£åº¦</strong>ï¼Œç”¨äºçº¦æŸæ¨¡å‹ä¸è¦åç¦»å‚è€ƒæ¨¡å‹ã€‚</li></ol><h4 id="3-1-KLæ•£åº¦çš„ä½œç”¨"><a href="#3-1-KLæ•£åº¦çš„ä½œç”¨" class="headerlink" title="3.1 KLæ•£åº¦çš„ä½œç”¨"></a><strong>3.1 KLæ•£åº¦çš„ä½œç”¨</strong></h4><p>KLæ•£åº¦ï¼ˆKullback-Leibler Divergenceï¼‰è¡¡é‡çš„æ˜¯ä¸¤ä¸ªæ¦‚ç‡åˆ†å¸ƒä¹‹é—´çš„å·®å¼‚ã€‚åœ¨æ¨¡å‹å¯¹é½ä¸­ï¼ŒKLæ•£åº¦ç”¨äºé™åˆ¶å½“å‰æ¨¡å‹ \(\pi_\theta\) å’Œå‚è€ƒæ¨¡å‹ \(\pi_{\text{ref}}\) çš„åˆ†å¸ƒå·®å¼‚ï¼Œç¡®ä¿åœ¨ä¼˜åŒ–è¿‡ç¨‹ä¸­æ¨¡å‹çš„è¾“å‡ºä¸ä¼šè¿‡åº¦åç¦»é¢„è®­ç»ƒæ¨¡å‹ã€‚å…·ä½“å…¬å¼ä¸ºï¼š<br>$$<br>\text{KL}(\pi_\theta(y|x) | \pi_{\text{ref}}(y|x)) = \sum_y \pi_\theta(y|x) \log \frac{\pi_\theta(y|x)}{\pi_{\text{ref}}(y|x)}<br>$$</p><ul><li>å¦‚æœKLæ•£åº¦è¾ƒå¤§ï¼Œè¡¨ç¤ºå½“å‰æ¨¡å‹ç”Ÿæˆçš„åˆ†å¸ƒä¸å‚è€ƒæ¨¡å‹æœ‰è¾ƒå¤§çš„å·®å¼‚ï¼Œè¿™å¯èƒ½æ„å‘³ç€æ¨¡å‹ç”Ÿæˆäº†ä¸åˆç†çš„è¾“å‡ºã€‚</li><li>é€šè¿‡æœ€å°åŒ–KLæ•£åº¦ï¼Œæ¨¡å‹èƒ½å¤Ÿåœ¨ä¿è¯è¾“å‡ºåˆç†æ€§çš„åŸºç¡€ä¸Šï¼Œè¿›è¡Œè¿›ä¸€æ­¥çš„ä¼˜åŒ–ã€‚</li></ul><h4 id="3-2-æŸå¤±å‡½æ•°å…¬å¼"><a href="#3-2-æŸå¤±å‡½æ•°å…¬å¼" class="headerlink" title="3.2 æŸå¤±å‡½æ•°å…¬å¼"></a><strong>3.2 æŸå¤±å‡½æ•°å…¬å¼</strong></h4><p>æ ¹æ®åå¥½æˆ–æ ‡ç­¾ï¼Œæ¨¡å‹çš„æŸå¤±å‡½æ•°å¯ä»¥è¡¨è¾¾ä¸ºä»¥ä¸‹å½¢å¼ï¼š</p><h5 id="DPOä¸­çš„æŸå¤±å‡½æ•°ï¼š"><a href="#DPOä¸­çš„æŸå¤±å‡½æ•°ï¼š" class="headerlink" title="DPOä¸­çš„æŸå¤±å‡½æ•°ï¼š"></a><strong>DPOä¸­çš„æŸå¤±å‡½æ•°</strong>ï¼š</h5><p>$$<br>L_{DPO} = -\mathbb{E}_{x, y_w, y_l \sim D} [\log \sigma(\beta (\log(\pi_\theta(y_w|x)) - \log(\pi_\theta(y_l|x))))]<br>$$</p><ul><li>$y_w$ï¼šåå¥½è¾ƒé«˜çš„ç­”æ¡ˆã€‚</li><li>$y_l$ï¼šåå¥½è¾ƒä½çš„ç­”æ¡ˆã€‚</li></ul><p>DPOä¸­å¯ä»¥å¼•å…¥KLæ•£åº¦ä½œä¸ºæ­£åˆ™åŒ–é¡¹ï¼š<br>$$<br>L_{DPO} = -\log \sigma(\log(\pi_\theta(y_w|x)) - \log(\pi_\theta(y_l|x)) + \beta \cdot \text{KL}(\pi_\theta | \pi_{\text{ref}}))<br>$$<br>é€šè¿‡æ§åˆ¶KLæ•£åº¦ï¼Œæ¨¡å‹çš„è¾“å‡ºä¸ä¼šåç¦»å‚è€ƒæ¨¡å‹å¤ªå¤šã€‚</p><h5 id="KTOä¸­çš„æŸå¤±å‡½æ•°ï¼š"><a href="#KTOä¸­çš„æŸå¤±å‡½æ•°ï¼š" class="headerlink" title="KTOä¸­çš„æŸå¤±å‡½æ•°ï¼š"></a><strong>KTOä¸­çš„æŸå¤±å‡½æ•°</strong>ï¼š</h5><p>KTOçš„æŸå¤±å‡½æ•°åŸºäºå‰æ™¯ç†è®ºï¼Œå¹¶å°†KLæ•£åº¦ä½œä¸ºæ ¸å¿ƒéƒ¨åˆ†ï¼Œè¡¨è¾¾ä¸ºï¼š<br>$$<br>L_{KTO} = \lambda_U \cdot \sigma(\beta \cdot (\text{KL}(\pi_\theta(\text{Answer 2}) | \pi_{\text{ref}}) - r_{\theta}(\text{Answer 2})))<br>$$</p><ul><li>$r_{\theta}(x, y)$ï¼šå½“å‰ç­–ç•¥å¯¹è´Ÿæ ·æœ¬ï¼ˆé”™è¯¯ç­”æ¡ˆï¼‰çš„ç½®ä¿¡åº¦ã€‚</li><li>KLæ•£åº¦ç”¨äºè¡¡é‡å½“å‰æ¨¡å‹ä¸å‚è€ƒæ¨¡å‹çš„å·®å¼‚ï¼Œç¡®ä¿æ¨¡å‹åœ¨å‡å°‘è´Ÿæ ·æœ¬ç”Ÿæˆçš„åŒæ—¶ï¼Œä¸åç¦»åŸå§‹å‚è€ƒæ¨¡å‹ã€‚</li></ul><p>é€šè¿‡å¢åŠ è´Ÿæ ·æœ¬çš„æŸå¤±ï¼ˆå³å¢åŠ  $\lambda_U$ çš„å€¼ï¼‰ï¼Œæ¨¡å‹ä¼šé™ä½è´Ÿæ ·æœ¬çš„ç½®ä¿¡åº¦ï¼Œä½¿æœªæ¥ç”Ÿæˆç±»ä¼¼é”™è¯¯ç­”æ¡ˆçš„æ¦‚ç‡å˜å°ã€‚</p><hr><h3 id="4-å¦‚ä½•ä¼˜åŒ–æ¨¡å‹"><a href="#4-å¦‚ä½•ä¼˜åŒ–æ¨¡å‹" class="headerlink" title="4. å¦‚ä½•ä¼˜åŒ–æ¨¡å‹"></a><strong>4. å¦‚ä½•ä¼˜åŒ–æ¨¡å‹</strong></h3><p>é€šè¿‡ä¸Šé¢ä»‹ç»çš„æŸå¤±å‡½æ•°ï¼Œæ¨¡å‹çš„ä¼˜åŒ–é€šå¸¸æ˜¯é€šè¿‡<strong>æ¢¯åº¦ä¸‹é™</strong>ï¼ˆGradient Descentï¼‰æ¥å®Œæˆçš„ã€‚æŸå¤±å‡½æ•°çš„æ¢¯åº¦åæ˜ äº†æ¨¡å‹è¾“å‡ºä¸æœŸæœ›è¾“å‡ºä¹‹é—´çš„å·®å¼‚ï¼Œä¼˜åŒ–ç›®æ ‡æ˜¯æœ€å°åŒ–æŸå¤±å‡½æ•°ã€‚</p><p><strong>æ¢¯åº¦æ›´æ–°å…¬å¼</strong>ï¼š<br>$$<br>\theta_{\text{new}} = \theta_{\text{old}} - \eta \nabla_{\theta} L<br>$$<br>å…¶ä¸­ï¼š</p><ul><li>$\eta$ æ˜¯å­¦ä¹ ç‡ï¼Œå†³å®šæ¯æ¬¡å‚æ•°æ›´æ–°çš„æ­¥é•¿ã€‚</li><li>$\nabla_{\theta} L$ æ˜¯æŸå¤±å‡½æ•°å¯¹æ¨¡å‹å‚æ•°çš„æ¢¯åº¦ï¼Œè¡¨ç¤ºå½“å‰å‚æ•°å¯¹æŸå¤±çš„è´¡çŒ®ã€‚</li></ul><p>é€šè¿‡ä¸æ–­è¿­ä»£ï¼Œæ¨¡å‹ä¼šé€æ¸æé«˜ç”Ÿæˆæ­£æ ·æœ¬çš„æ¦‚ç‡ï¼Œå‡å°‘è´Ÿæ ·æœ¬çš„ç”Ÿæˆæ¦‚ç‡ï¼Œæœ€ç»ˆå®ç°æ¨¡å‹å¯¹é½ã€‚</p><ul><li>æ¨¡å‹å¯¹é½ï¼ˆAlignmentï¼‰çš„æ ¸å¿ƒç›®æ ‡æ˜¯é€šè¿‡åå¥½æˆ–æ ‡ç­¾æ•°æ®ï¼Œä¼˜åŒ–æ¨¡å‹çš„è¾“å‡ºï¼Œä½¿å…¶ç¬¦åˆäººç±»æœŸæœ›ã€‚</li><li><strong>ç­–ç•¥æ¨¡å‹</strong>ï¼ˆ$\pi_\theta$ï¼‰ç”Ÿæˆè¾“å‡ºï¼ŒKLæ•£åº¦ç”¨äºæ§åˆ¶æ¨¡å‹ä¸å‚è€ƒæ¨¡å‹çš„åç¦»ç¨‹åº¦ï¼Œé¿å…æ¨¡å‹åœ¨ä¼˜åŒ–è¿‡ç¨‹ä¸­äº§ç”Ÿä¸åˆç†çš„åå·®ã€‚</li><li><strong>æ­£æ ·æœ¬çš„æ¦‚ç‡</strong>é€šè¿‡æŸå¤±å‡½æ•°çš„ä¼˜åŒ–é€æ­¥æå‡ï¼Œ<strong>è´Ÿæ ·æœ¬çš„æ¦‚ç‡</strong>é€šè¿‡å¢åŠ æŸå¤±æƒé‡å’Œé™ä½ç½®ä¿¡åº¦æ¥å‡å°‘ã€‚</li><li>æ¢¯åº¦ä¸‹é™ç”¨äºæ›´æ–°æ¨¡å‹å‚æ•°ï¼Œæœ€ç»ˆå®ç°æ¨¡å‹å¯¹é½</li></ul><hr><h2 id="4-DPOï¼ˆDirect-Preference-Optimizationï¼‰"><a href="#4-DPOï¼ˆDirect-Preference-Optimizationï¼‰" class="headerlink" title="4. DPOï¼ˆDirect Preference Optimizationï¼‰"></a>4. <strong>DPOï¼ˆDirect Preference Optimizationï¼‰</strong></h2><h3 id="4-1-åŸç†"><a href="#4-1-åŸç†" class="headerlink" title="4.1 åŸç†"></a>4.1 <strong>åŸç†</strong></h3><p>DPO é€šè¿‡ç›´æ¥ä¼˜åŒ–æ¨¡å‹è¾“å‡ºçš„åå¥½å‡½æ•°ï¼Œä½¿æ¨¡å‹çš„è¾“å‡ºæ›´åŠ ç¬¦åˆäººç±»åå¥½ã€‚å®ƒæ¯”è¾ƒæ¨¡å‹çš„ä¸åŒè¾“å‡ºï¼Œå¹¶é€šè¿‡åå¥½å‡½æ•°è¯„ä¼°è¿™ä¸¤ä¸ªè¾“å‡ºå“ªä¸ªæ›´å¥½ï¼Œä»è€ŒæŒ‡å¯¼æ¨¡å‹å‚æ•°çš„ä¼˜åŒ–ã€‚</p><h3 id="4-2-æŸå¤±å‡½æ•°"><a href="#4-2-æŸå¤±å‡½æ•°" class="headerlink" title="4.2 æŸå¤±å‡½æ•°"></a>4.2 <strong>æŸå¤±å‡½æ•°</strong></h3><p>DPO ä½¿ç”¨åå¥½æŸå¤±å‡½æ•°ï¼ˆPreference Lossï¼‰ï¼Œç”¨äºæ¯”è¾ƒä¸¤ä¸ªè¾“å‡ºçš„ä¼˜åŠ£ï¼š</p><p>$$<br>\mathcal{L}_{\text{DPO}} = \log(1 + \exp(-\sigma \cdot (\hat{y}_a - \hat{y}_b) \cdot p))<br>$$</p><ul><li>$ \hat{y}_a $ å’Œ $ \hat{y}_b $ æ˜¯æ¨¡å‹å¯¹ä¸¤ä¸ªæ ·æœ¬çš„é¢„æµ‹å€¼ã€‚</li><li>$ p $ æ˜¯äººç±»åå¥½ï¼ˆ1 è¡¨ç¤ºåå¥½ $a$ï¼Œ-1 è¡¨ç¤ºåå¥½ $b$ï¼‰ã€‚</li><li>$ \sigma $ æ˜¯å¹³æ»‘å‚æ•°ã€‚</li></ul><h3 id="4-3-ä¼˜åŒ–å™¨"><a href="#4-3-ä¼˜åŒ–å™¨" class="headerlink" title="4.3 ä¼˜åŒ–å™¨"></a>4.3 <strong>ä¼˜åŒ–å™¨</strong></h3><p>DPO é€šå¸¸ä½¿ç”¨ <strong>AdamW</strong> ä¼˜åŒ–å™¨ï¼Œé€‚ç”¨äºå¤§è§„æ¨¡å‚æ•°æ¨¡å‹çš„ä¼˜åŒ–ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">optimizer = torch.optim.AdamW(model.parameters(), lr=<span class="number">1e-5</span>)</span><br></pre></td></tr></tbody></table></figure><h3 id="4-4-æ ¸å¿ƒä»£ç "><a href="#4-4-æ ¸å¿ƒä»£ç " class="headerlink" title="4.4 æ ¸å¿ƒä»£ç "></a>4.4 <strong>æ ¸å¿ƒä»£ç </strong></h3><p>ä»¥ä¸‹æ˜¯ DPO çš„è®­ç»ƒæ­¥éª¤ï¼š</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">preference_loss</span>(<span class="params">output_a, output_b, human_preference</span>):</span><br><span class="line">    preference = human_preference(output_a, output_b)</span><br><span class="line">    loss = torch.log(<span class="number">1</span> + torch.exp(-preference * (output_a - output_b)))</span><br><span class="line">    <span class="keyword">return</span> loss</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dpo_training_step</span>(<span class="params">model, data_a, data_b, human_preference</span>):</span><br><span class="line">    output_a = model(data_a)</span><br><span class="line">    output_b = model(data_b)</span><br><span class="line">    </span><br><span class="line">    loss = preference_loss(output_a, output_b, human_preference)</span><br><span class="line">    loss.backward()</span><br><span class="line">    optimizer.step()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> batch_a, batch_b <span class="keyword">in</span> training_data:</span><br><span class="line">    dpo_training_step(model, batch_a, batch_b, human_preference_function)</span><br></pre></td></tr></tbody></table></figure><hr><h2 id="5-KTOï¼ˆKahneman-Tversky-Optimizationï¼‰"><a href="#5-KTOï¼ˆKahneman-Tversky-Optimizationï¼‰" class="headerlink" title="5. KTOï¼ˆKahneman-Tversky Optimizationï¼‰"></a>5. <strong>KTOï¼ˆKahneman-Tversky Optimizationï¼‰</strong></h2><h3 id="5-1-åŸç†"><a href="#5-1-åŸç†" class="headerlink" title="5.1 åŸç†"></a>5.1 <strong>åŸç†</strong></h3><p>KTO åŸºäº Kahneman å’Œ Tversky çš„å‰æ™¯ç†è®ºï¼ˆProspect Theoryï¼‰ï¼Œé€šè¿‡éå¯¹ç§°æ•ˆç”¨å‡½æ•°è¡¡é‡æ¨¡å‹çš„å¢ç›Šå’ŒæŸå¤±ï¼Œæ—¨åœ¨ä¼˜åŒ–æ¨¡å‹çš„è¡¨ç°ï¼Œå°¤å…¶åœ¨é£é™©å’Œæ”¶ç›Šä¸å¯¹ç§°çš„åœºæ™¯ä¸‹ã€‚æ•ˆç”¨å‡½æ•°å®šä¹‰å¦‚ä¸‹ï¼š</p><p>$$<br>\mathcal{U}(x) =<br>\begin{cases}<br>x^{\alpha}, &amp; x \geq 0 \<br>-\lambda (-x)^{\alpha}, &amp; x &lt; 0<br>\end{cases}<br>$$</p><ul><li>$x$ æ˜¯æ¨¡å‹é¢„æµ‹ä¸çœŸå®å€¼çš„å·®å¼‚ã€‚</li><li>$\alpha$ æ˜¯éçº¿æ€§ç³»æ•°ï¼Œé€šå¸¸ä¸º 0</li></ul><p>.88ã€‚</p><ul><li>$\lambda$ æ˜¯æŸå¤±çš„æƒ©ç½šæƒé‡ï¼Œé€šå¸¸ä¸º 2.25ã€‚</li></ul><h3 id="5-2-æŸå¤±å‡½æ•°"><a href="#5-2-æŸå¤±å‡½æ•°" class="headerlink" title="5.2 æŸå¤±å‡½æ•°"></a>5.2 <strong>æŸå¤±å‡½æ•°</strong></h3><p>KTO çš„æŸå¤±å‡½æ•°åŸºäºå‰æ™¯ç†è®ºçš„æ•ˆç”¨å‡½æ•°ï¼Œç”¨äºæƒ©ç½šæ¨¡å‹çš„é¢„æµ‹è¯¯å·®ï¼š</p><p>$$<br>\mathcal{L}<em>{\text{KTO}} = -\mathbb{E}[\mathcal{U}(y</em>{\text{pred}} - y_{\text{true}})]<br>$$</p><h3 id="5-3-ä¼˜åŒ–å™¨"><a href="#5-3-ä¼˜åŒ–å™¨" class="headerlink" title="5.3 ä¼˜åŒ–å™¨"></a>5.3 <strong>ä¼˜åŒ–å™¨</strong></h3><p>KTO å¸¸ä½¿ç”¨ <strong>AdamW</strong> ä¼˜åŒ–å™¨ï¼Œä»¥ç¡®ä¿è®­ç»ƒè¿‡ç¨‹çš„ç¨³å®šæ€§ï¼š</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">optimizer = torch.optim.AdamW(model.parameters(), lr=<span class="number">3e-5</span>)</span><br></pre></td></tr></tbody></table></figure><h3 id="5-4-æ ¸å¿ƒä»£ç "><a href="#5-4-æ ¸å¿ƒä»£ç " class="headerlink" title="5.4 æ ¸å¿ƒä»£ç "></a>5.4 <strong>æ ¸å¿ƒä»£ç </strong></h3><p>ä»¥ä¸‹æ˜¯ KTO æŸå¤±å‡½æ•°çš„è®¡ç®—ä»£ç ï¼š</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">prospect_utility</span>(<span class="params">value, alpha=<span class="number">0.88</span>, lambda_=<span class="number">2.25</span></span>):</span><br><span class="line">    <span class="keyword">if</span> value &gt;= <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> torch.<span class="built_in">pow</span>(value, alpha)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> -lambda_ * torch.<span class="built_in">pow</span>(-value, alpha)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">kto_loss</span>(<span class="params">predictions, targets</span>):</span><br><span class="line">    value = predictions - targets</span><br><span class="line">    utility = prospect_utility(value)</span><br><span class="line">    loss = -torch.mean(utility)</span><br><span class="line">    <span class="keyword">return</span> loss</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> data <span class="keyword">in</span> dataloader:</span><br><span class="line">    predictions = model(data)</span><br><span class="line">    loss = kto_loss(predictions, targets)</span><br><span class="line">    loss.backward()</span><br><span class="line">    optimizer.step()</span><br></pre></td></tr></tbody></table></figure><hr><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a><strong>æ€»ç»“</strong></h3><table><thead><tr><th>æ–¹æ³•</th><th>æŸå¤±å‡½æ•°</th><th>ä¼˜åŒ–å™¨</th></tr></thead><tbody><tr><td><strong>SFT</strong></td><td>äº¤å‰ç†µæŸå¤±</td><td>AdamWï¼ŒRMSpropï¼ŒSGD</td></tr><tr><td><strong>LoRA</strong></td><td>äº¤å‰ç†µæŸå¤±</td><td>AdamWï¼ŒRMSpropï¼ŒSGD</td></tr><tr><td><strong>DPO</strong></td><td>åå¥½æŸå¤±å‡½æ•°ï¼š $\log(1 + \exp(-\sigma (\hat{y}_a - \hat{y}_b)p))$</td><td>AdamW</td></tr><tr><td><strong>KTO</strong></td><td>å‰æ™¯ç†è®ºæ•ˆç”¨å‡½æ•°ï¼š $-\mathbb{E}[\mathcal{U}(y_{\text{pred}} - y_{\text{true}})]$</td><td>AdamW</td></tr></tbody></table><p>é€šè¿‡æœ¬æ–‡æ¡£çš„æ•´ç†ï¼Œè¯»è€…èƒ½å¤Ÿæ¸…æ™°ç†è§£ SFTã€LoRAã€DPO å’Œ KTO ç­‰æŠ€æœ¯çš„åŸç†ã€å…·ä½“å®ç°æ­¥éª¤ã€æŸå¤±å‡½æ•°è®¾è®¡å’Œä¼˜åŒ–å™¨é€‰æ‹©ï¼Œç‰¹åˆ«æ˜¯åœ¨ LLAMA3 è¿™ç§å¤§è§„æ¨¡é¢„è®­ç»ƒæ¨¡å‹çš„å¾®è°ƒåœºæ™¯ä¸‹çš„å®é™…åº”ç”¨ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> NLP Insights </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LLM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨å‹ç¼©æœ‰é™çŠ¶æ€æœºè¿›è¡Œæœ¬åœ° LLM çš„å¿«é€Ÿ JSON è§£ç </title>
      <link href="/2024/08/13/NLP%20Insights/%E4%BD%BF%E7%94%A8%E5%8E%8B%E7%BC%A9%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA%E8%BF%9B%E8%A1%8C%E6%9C%AC%E5%9C%B0%20LLM%20%E7%9A%84%E5%BF%AB%E9%80%9F%20JSON%20%E8%A7%A3%E7%A0%81/"/>
      <url>/2024/08/13/NLP%20Insights/%E4%BD%BF%E7%94%A8%E5%8E%8B%E7%BC%A9%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA%E8%BF%9B%E8%A1%8C%E6%9C%AC%E5%9C%B0%20LLM%20%E7%9A%84%E5%BF%AB%E9%80%9F%20JSON%20%E8%A7%A3%E7%A0%81/</url>
      
        <content type="html"><![CDATA[<h2 id="ä½¿ç”¨å‹ç¼©æœ‰é™çŠ¶æ€æœºè¿›è¡Œæœ¬åœ°-LLM-çš„å¿«é€Ÿ-JSON-è§£ç "><a href="#ä½¿ç”¨å‹ç¼©æœ‰é™çŠ¶æ€æœºè¿›è¡Œæœ¬åœ°-LLM-çš„å¿«é€Ÿ-JSON-è§£ç " class="headerlink" title="ä½¿ç”¨å‹ç¼©æœ‰é™çŠ¶æ€æœºè¿›è¡Œæœ¬åœ° LLM çš„å¿«é€Ÿ JSON è§£ç "></a>ä½¿ç”¨å‹ç¼©æœ‰é™çŠ¶æ€æœºè¿›è¡Œæœ¬åœ° LLM çš„å¿«é€Ÿ JSON è§£ç </h2><p><strong>ä½œè€…</strong>: Liangsheng Yin, Ying Sheng, Lianmin Zheng<br><strong>æ—¥æœŸ</strong>: 2024 å¹´ 2 æœˆ 5 æ—¥</p><hr><p>æœ¬æ–‡å†…å®¹åŸºäº LMSYS Org å‘å¸ƒçš„ä¸€ç¯‡åšå®¢æ–‡ç« ï¼ŒåŸæ–‡é“¾æ¥ï¼š<a href="https://lmsys.org/blog/2024-02-05-compressed-fsm/">LMSYS Org åšå®¢</a>ã€‚ç›¸å…³çš„ä»£ç åº“å¯ä»¥åœ¨ä»¥ä¸‹é“¾æ¥æ‰¾åˆ°ï¼š<a href="https://github.com/sgl-project/sglang/tree/main?tab=readme-ov-file#json-decoding">SGLang ä»£ç åº“</a>ã€‚</p><p>è®©ä¸€ä¸ª LLM å§‹ç»ˆç”Ÿæˆç¬¦åˆç‰¹å®šæ¨¡å¼çš„æœ‰æ•ˆ JSON æˆ– YAMLï¼Œå¯¹äºè®¸å¤šåº”ç”¨æ¥è¯´æ˜¯ä¸€ä¸ªå…³é”®ç‰¹æ€§ã€‚åœ¨è¿™ç¯‡åšå®¢æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†ä¸€ç§æ˜¾è‘—åŠ é€Ÿè¿™ç§çº¦æŸè§£ç çš„ä¼˜åŒ–æ–¹æ³•ã€‚æˆ‘ä»¬çš„æ–¹æ³•åˆ©ç”¨äº†å‹ç¼©çš„æœ‰é™çŠ¶æ€æœºï¼Œå¹¶ä¸”å…¼å®¹ä»»ä½•æ­£åˆ™è¡¨è¾¾å¼ï¼Œå› æ­¤å¯ä»¥é€‚ç”¨äºä»»ä½• JSON æˆ– YAML æ¨¡å¼ã€‚ä¸ç°æœ‰ç³»ç»Ÿé€æ­¥è§£ç ä¸€ä¸ªæ ‡è®°çš„æ–¹å¼ä¸åŒï¼Œæˆ‘ä»¬çš„æ–¹æ³•åˆ†æäº†æ­£åˆ™è¡¨è¾¾å¼çš„æœ‰é™çŠ¶æ€æœºï¼Œå‹ç¼©äº†å•ä¸€çš„è½¬æ¢è·¯å¾„ï¼Œå¹¶åœ¨å¯èƒ½çš„æƒ…å†µä¸‹ä¸€æ¬¡æ€§è§£ç å¤šä¸ªæ ‡è®°ã€‚ä¸æœ€å…ˆè¿›çš„ç³»ç»Ÿï¼ˆguidance + llama.cppï¼Œoutlines + vLLMï¼‰ç›¸æ¯”ï¼Œæˆ‘ä»¬çš„æ–¹æ³•å¯ä»¥å°†å»¶è¿Ÿå‡å°‘æœ€å¤š 2 å€ï¼Œå¹¶æé«˜ååé‡æœ€å¤š 2.5 å€ã€‚è¿™ä¸€ä¼˜åŒ–è¿˜ä½¿å¾—çº¦æŸè§£ç æ¯”æ™®é€šè§£ç æ›´å¿«ã€‚ä½ å¯ä»¥åœ¨ SGLang ä¸Šè¯•ç”¨å®ƒã€‚</p><p><img src="https://lmsys.org/images/blog/compressed_fsm/demo.gif" alt="å›¾1ï¼šSGLangå’ŒOutlines + vLLMåœ¨JSONè§£ç ä¸­çš„æ¯”è¾ƒ"></p><p>å›¾ä¸€å±•ç¤ºäº† SGLang å’Œ Outlines + vLLM åœ¨ JSON è§£ç ä»»åŠ¡ä¸­çš„æ€§èƒ½æ¯”è¾ƒã€‚è¿™æ˜¯ä¸€ä¸ªåŠ¨æ€å¯¹æ¯”ï¼Œç›®çš„æ˜¯å±•ç¤ºä¸¤è€…åœ¨ç›¸åŒä»»åŠ¡ä¸‹çš„é€Ÿåº¦å·®å¼‚ã€‚SGLang é‡‡ç”¨äº†ä¸€ç§æ–°çš„è·³è·ƒå‰è¿›è§£ç ç®—æ³•ï¼Œé€šè¿‡å‹ç¼©æœ‰é™çŠ¶æ€æœºæ¥åŠ é€Ÿè§£ç è¿‡ç¨‹ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼ŒOutlines + vLLM ä½¿ç”¨äº†ä¼ ç»Ÿçš„é€æ­¥è§£ç æ–¹æ³•ã€‚å›¾ä¸­çš„åŠ¨ç”»æ¼”ç¤ºäº† SGLang åœ¨å¤„ç†å¤šå­—ç¬¦ï¼ˆæˆ–æ ‡è®°ï¼‰è§£ç æ—¶çš„ä¼˜åŠ¿ï¼Œæ˜¾è‘—å‡å°‘äº†è§£ç æ—¶é—´ã€‚</p><h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>JSON æ˜¯æ•°æ®äº¤æ¢ä¸­æœ€é‡è¦çš„æ ¼å¼ä¹‹ä¸€ã€‚è¦æ±‚ LLM å§‹ç»ˆç”Ÿæˆæœ‰æ•ˆçš„ JSON å¯ä»¥ä½¿ LLM çš„è¾“å‡ºä»¥ç»“æ„åŒ–æ–¹å¼è½»æ¾è§£æã€‚è®¤è¯†åˆ°å…¶é‡è¦æ€§ï¼ŒOpenAI å¼•å…¥äº† JSON æ¨¡å¼ï¼Œå®ƒçº¦æŸæ¨¡å‹å§‹ç»ˆè¿”å›æœ‰æ•ˆçš„ JSON å¯¹è±¡ã€‚ç„¶è€Œï¼Œé€šå¸¸éœ€è¦æ›´ç»†ç²’åº¦çš„æ§åˆ¶ï¼Œä»¥ç¡®ä¿ç”Ÿæˆçš„ JSON å¯¹è±¡ç¬¦åˆç‰¹å®šçš„æ¨¡å¼ï¼Œä¾‹å¦‚ï¼š</p><img src="/2024/08/13/NLP%20Insights/%E4%BD%BF%E7%94%A8%E5%8E%8B%E7%BC%A9%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA%E8%BF%9B%E8%A1%8C%E6%9C%AC%E5%9C%B0%20LLM%20%E7%9A%84%E5%BF%AB%E9%80%9F%20JSON%20%E8%A7%A3%E7%A0%81/image-1.png" class="" title="å›¾2ï¼šéµå¾ªJSONæ¨¡å¼çš„çº¦æŸç”Ÿæˆç¤ºä¾‹"><p>å›¾äºŒå±•ç¤ºäº†ä¸€ä¸ªå—é™ç”Ÿæˆçš„ä¾‹å­ï¼Œåˆ©ç”¨å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMsï¼‰æ¥ç”Ÿæˆç¬¦åˆç‰¹å®š JSON æ¨¡å¼çš„å¯¹è±¡ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå·¦ä¾§çš„ JSON æ¨¡å¼å®šä¹‰äº†ä¸€ä¸ªå¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«äº† nameã€age å’Œ house ä¸‰ä¸ªå±æ€§ï¼Œåˆ†åˆ«æ˜¯å­—ç¬¦ä¸²å’Œæ•´æ•°ç±»å‹ã€‚å³ä¾§åˆ™æ˜¾ç¤ºäº†å—é™ç”Ÿæˆçš„è¾“å‡ºå¯¹è±¡ï¼Œæ¨¡å‹é€šè¿‡çº¦æŸç”ŸæˆæŠ€æœ¯ï¼Œç”Ÿæˆäº†ç¬¦åˆè¿™äº›å±æ€§çš„å…·ä½“å®ä¾‹ï¼Œå¦‚â€œHarryâ€çš„åå­—ã€15 å²çš„å¹´é¾„ä»¥åŠå±äºâ€œGryffindorâ€çš„æˆ¿å­ã€‚è¿™å±•ç¤ºäº† LLMs åœ¨ç”Ÿæˆç»“æ„åŒ–æ•°æ®æ—¶çš„èƒ½åŠ›ï¼ŒåŒæ—¶ç¡®ä¿äº†ç”Ÿæˆå†…å®¹ç¬¦åˆé¢„å®šçš„æ ¼å¼ã€‚</p><p>å¯¹äºæœ¬åœ° LLMï¼Œæœ‰ä¸¤ç§ä¸»è¦æ–¹æ³•æ¥å¼•å¯¼æ¨¡å‹ç”Ÿæˆç¬¦åˆç‰¹å®šæ¨¡å¼çš„ JSON å¯¹è±¡ã€‚</p><h3 id="æ–¹æ³•-1ï¼šåŸºäºæœ‰é™çŠ¶æ€æœº"><a href="#æ–¹æ³•-1ï¼šåŸºäºæœ‰é™çŠ¶æ€æœº" class="headerlink" title="æ–¹æ³• 1ï¼šåŸºäºæœ‰é™çŠ¶æ€æœº"></a>æ–¹æ³• 1ï¼šåŸºäºæœ‰é™çŠ¶æ€æœº</h3><p>è¿™ç§æ–¹æ³•æ¶‰åŠå°† JSON æ¨¡å¼è½¬æ¢ä¸ºæ­£åˆ™è¡¨è¾¾å¼ã€‚ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥åŸºäºæ­£åˆ™è¡¨è¾¾å¼æ„å»ºä¸€ä¸ªæœ‰é™çŠ¶æ€æœºï¼ˆFSMï¼‰ã€‚FSM ç”¨äºå¼•å¯¼ LLM çš„ç”Ÿæˆã€‚åœ¨ FSM çš„æ¯ä¸ªçŠ¶æ€ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è®¡ç®—å…è®¸çš„è½¬æ¢å¹¶è¯†åˆ«å¯æ¥å—çš„ä¸‹ä¸€ä¸ªæ ‡è®°ã€‚è¿™ä½¿æˆ‘ä»¬èƒ½å¤Ÿåœ¨è§£ç è¿‡ç¨‹ä¸­è·Ÿè¸ªå½“å‰çŠ¶æ€ï¼Œå¹¶é€šè¿‡å¯¹è¾“å‡ºåº”ç”¨ logit åå·®æ¥è¿‡æ»¤æ‰æ— æ•ˆçš„æ ‡è®°ã€‚ä½ å¯ä»¥åœ¨ outlines è®ºæ–‡ä¸­äº†è§£æ›´å¤šå…³äºè¿™ç§æ–¹æ³•çš„ä¿¡æ¯ã€‚</p><img src="/2024/08/13/NLP%20Insights/%E4%BD%BF%E7%94%A8%E5%8E%8B%E7%BC%A9%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA%E8%BF%9B%E8%A1%8C%E6%9C%AC%E5%9C%B0%20LLM%20%E7%9A%84%E5%BF%AB%E9%80%9F%20JSON%20%E8%A7%A3%E7%A0%81/image-2.png" class="" title="å›¾3ï¼šåŸºäºFSMå’ŒLogitså±è”½çš„çº¦æŸè§£ç ã€‚åœ¨ç¬¬ä¸€æ¬¡çº¦æŸè§£ç è¿‡ç¨‹ä¸­ï¼Œä»…å…è®¸ageã€‚åœ¨ç¬¬äºŒæ¬¡è¿‡ç¨‹ä¸­ï¼Œç”±äºæ­£åˆ™è¡¨è¾¾å¼éœ€è¦æ•°å­—ï¼Œå› æ­¤å…è®¸0å’Œ1ï¼Œä½†LLMæ›´æœ‰å¯èƒ½é‡‡æ ·1"><p>å›¾ä¸‰å±•ç¤ºäº†å¦‚ä½•åˆ©ç”¨æœ‰é™çŠ¶æ€æœºï¼ˆFSMï¼‰æ¥å®ç°å—é™è§£ç ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œé¦–å…ˆå°† JSON æ¨¡å¼è½¬æ¢ä¸ºæ­£åˆ™è¡¨è¾¾å¼ï¼Œç„¶ååˆ©ç”¨ FSM æ¥å¼•å¯¼ LLM çš„ç”Ÿæˆã€‚åœ¨å›¾ä¸­ï¼ŒFSM çŠ¶æ€å›¾å±•ç¤ºäº† age å­—æ®µçš„å—é™ç”Ÿæˆè¿‡ç¨‹ï¼Œå…¶ä¸­åªæœ‰åˆæ³•çš„æ•°å­—ï¼ˆå¦‚ 0-9ï¼‰ä¼šè¢«å…è®¸ã€‚æ¯ä¸ªçŠ¶æ€çš„è½¬æ¢ç”±æ­£åˆ™è¡¨è¾¾å¼çš„è§„åˆ™å®šä¹‰ï¼Œç¡®ä¿ç”Ÿæˆçš„ JSON æ•°æ®å§‹ç»ˆæœ‰æ•ˆã€‚è¿™ç§æ–¹æ³•é€šè¿‡åœ¨ç”Ÿæˆè¿‡ç¨‹ä¸­æ–½åŠ é™åˆ¶ï¼Œæ¥æ§åˆ¶ LLM ç”Ÿæˆç‰¹å®šçš„è¾“å‡ºã€‚</p><p>FSM æ–¹æ³•åˆ©ç”¨å¹¿ä¹‰çš„æ­£åˆ™è¡¨è¾¾å¼æ¥å®šä¹‰ä½å±‚æ¬¡è§„åˆ™ï¼Œå¯ä»¥åº”ç”¨äºå¹¿æ³›çš„è¯­æ³•ï¼Œä¾‹å¦‚ JSON æ¨¡å¼ã€IP åœ°å€å’Œç”µå­é‚®ä»¶ã€‚</p><h4 id="é™åˆ¶ï¼š"><a href="#é™åˆ¶ï¼š" class="headerlink" title="é™åˆ¶ï¼š"></a>é™åˆ¶ï¼š</h4><p>ç”±äº FSM æ˜¯åœ¨æ ‡è®°çº§åˆ«æ„å»ºçš„ï¼Œå› æ­¤å®ƒåªèƒ½åœ¨æ¯ä¸€æ­¥é€šè¿‡ä¸€ä¸ªæ ‡è®°æ¥è½¬æ¢çŠ¶æ€ã€‚å› æ­¤ï¼Œå®ƒä¸€æ¬¡åªèƒ½è§£ç ä¸€ä¸ªæ ‡è®°ï¼Œå¯¼è‡´è§£ç é€Ÿåº¦è¾ƒæ…¢ã€‚</p><h3 id="æ–¹æ³•-2ï¼šåŸºäºäº¤ç»‡"><a href="#æ–¹æ³•-2ï¼šåŸºäºäº¤ç»‡" class="headerlink" title="æ–¹æ³• 2ï¼šåŸºäºäº¤ç»‡"></a>æ–¹æ³• 2ï¼šåŸºäºäº¤ç»‡</h3><p>é™¤äº†å°†æ•´ä¸ª JSON æ¨¡å¼è½¬æ¢ä¸ºæ­£åˆ™è¡¨è¾¾å¼ä¹‹å¤–ï¼Œå¦ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨åŸºäºäº¤ç»‡çš„è§£ç ã€‚åœ¨è¿™ç§æ–¹æ³•ä¸­ï¼Œç»™å®šçš„ JSON æ¨¡å¼å¯ä»¥åˆ†è§£ä¸ºå‡ ä¸ªéƒ¨åˆ†ï¼Œæ¯ä¸ªéƒ¨åˆ†åŒ…å«ä¸€ä¸ªåˆ†å—é¢„å¡«å……éƒ¨åˆ†æˆ–ä¸€ä¸ªçº¦æŸè§£ç éƒ¨åˆ†ã€‚è¿™äº›ä¸åŒçš„éƒ¨åˆ†ç”±æ¨ç†ç³»ç»Ÿäº¤ç»‡æ‰§è¡Œã€‚ç”±äºåˆ†å—é¢„å¡«å……å¯ä»¥åœ¨ä¸€ä¸ªå‰å‘ä¼ é€’ä¸­å¤„ç†å¤šä¸ªæ ‡è®°ï¼Œå®ƒæ¯”é€æ ‡è®°è§£ç æ›´å¿«ã€‚</p><p>Guidance æä¾›äº†ä¸€å¥—åŸºäºäº¤ç»‡è§£ç çš„è¯­æ³•è§„åˆ™ï¼Œä½¿ç”¨ llama.cpp ä½œä¸ºåç«¯ã€‚</p><img src="/2024/08/13/NLP%20Insights/%E4%BD%BF%E7%94%A8%E5%8E%8B%E7%BC%A9%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA%E8%BF%9B%E8%A1%8C%E6%9C%AC%E5%9C%B0%20LLM%20%E7%9A%84%E5%BF%AB%E9%80%9F%20JSON%20%E8%A7%A3%E7%A0%81/image-3.png" class="" title="å›¾4ï¼šGuidanceä¸­çš„äº¤ç»‡JSONè§£ç "><p>å›¾å››å±•ç¤ºäº† Guidance æ¡†æ¶ä¸­çš„äº¤ç»‡è¯­æ³•ï¼Œå¦‚ä½•åˆ©ç”¨äº¤ç»‡è¯­æ³•æ¥è¿›è¡Œ JSON çš„è§£ç ã€‚å›¾ä¸­çš„ä»£ç ç‰‡æ®µå®šä¹‰äº†ä¸€ä¸ªå‡½æ•°ï¼Œä½¿ç”¨ Guidance è¯­æ³•ç”Ÿæˆä¸€ä¸ªåŒ…å« nameã€age å’Œ house çš„ JSON å¯¹è±¡ã€‚äº¤ç»‡è¯­æ³•é€šè¿‡å°†ä¸åŒéƒ¨åˆ†çš„è§£ç ä¸é¢„å¡«å……éƒ¨åˆ†äº¤æ›¿è¿›è¡Œï¼Œèƒ½å¤Ÿæé«˜è§£ç é€Ÿåº¦ã€‚å›¾ä¸‹æ–¹å±•ç¤ºäº†è¿™ä¸€è¿‡ç¨‹çš„å·¥ä½œåŸç†ï¼Œç»¿è‰²å’Œè“è‰²çš„æ¡å½¢ä»£è¡¨ä¸åŒéƒ¨åˆ†çš„å¤„ç†è¿‡ç¨‹ï¼Œå±•ç¤ºäº†äº¤ç»‡è§£ç åœ¨ä¸åŒé˜¶æ®µçš„æ‰§è¡Œæƒ…å†µã€‚</p><h4 id="é™åˆ¶ï¼š-1"><a href="#é™åˆ¶ï¼š-1" class="headerlink" title="é™åˆ¶ï¼š"></a>é™åˆ¶ï¼š</h4><ul><li>åŸºäºäº¤ç»‡çš„æ–¹æ³•éœ€è¦è‡ªå®šä¹‰è¯­æ³•ï¼Œä½¿å…¶ä¸å¦‚å•ä¸ªæ­£åˆ™è¡¨è¾¾å¼çµæ´»å’Œè¡¨è¾¾åŠ›å¼ºã€‚</li><li>ç”±äºè§£ç å’Œåˆ†å—é¢„å¡«å……æ®µä¹‹é—´å¯èƒ½å­˜åœ¨å†²çªï¼Œå¤„ç†æ ‡è®°è¾¹ç•Œæ—¶å­˜åœ¨å›°éš¾ã€‚</li><li>è§£é‡Šå™¨ä¸åç«¯ä¹‹é—´çš„é¢‘ç¹é€šä¿¡å¸¦æ¥äº†é¢å¤–çš„å¼€é”€ã€‚</li></ul><h3 id="æˆ‘ä»¬çš„æ–¹æ³•ï¼šä½¿ç”¨å‹ç¼©æœ‰é™çŠ¶æ€æœºçš„è·³è·ƒå‰è¿›è§£ç "><a href="#æˆ‘ä»¬çš„æ–¹æ³•ï¼šä½¿ç”¨å‹ç¼©æœ‰é™çŠ¶æ€æœºçš„è·³è·ƒå‰è¿›è§£ç " class="headerlink" title="æˆ‘ä»¬çš„æ–¹æ³•ï¼šä½¿ç”¨å‹ç¼©æœ‰é™çŠ¶æ€æœºçš„è·³è·ƒå‰è¿›è§£ç "></a>æˆ‘ä»¬çš„æ–¹æ³•ï¼šä½¿ç”¨å‹ç¼©æœ‰é™çŠ¶æ€æœºçš„è·³è·ƒå‰è¿›è§£ç </h3><p>é€šè¿‡å¼•å…¥åŸºäºå‹ç¼©æœ‰é™çŠ¶æ€æœºçš„æ–°è§£ç ç®—æ³•â€”â€”è·³è·ƒå‰è¿›è§£ç ï¼Œæˆ‘ä»¬å¯ä»¥ç»“åˆ FSM å’Œäº¤ç»‡æ–¹æ³•çš„ä¼˜ç‚¹ã€‚</p><p>åœ¨ç”± JSON æ¨¡å¼è½¬æ¢çš„æ­£åˆ™è¡¨è¾¾å¼å¼•å¯¼çš„è§£ç è¿‡ç¨‹ä¸­ï¼Œå½“æˆ‘ä»¬è¾¾åˆ°ç‰¹å®šèŠ‚ç‚¹æ—¶ï¼Œå¯ä»¥é¢„æµ‹å³å°†åˆ°æ¥çš„å­—ç¬¦ä¸²ï¼š</p><p>åœ¨å›¾ 3 ä¸­ï¼Œè§£ç å¼€å§‹æ—¶ï¼Œæ ¹æ®æ­£åˆ™è¡¨è¾¾å¼ï¼Œæˆ‘ä»¬å¯ä»¥é¢„è§åˆ°æ¥ä¸‹æ¥çš„å­—ç¬¦ä¸²æ˜¯ï¼š</p><figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"name"</span><span class="punctuation">:</span></span><br></pre></td></tr></tbody></table></figure><p>ç„¶åè¿›å…¥å®é™…çš„è§£ç éƒ¨åˆ†ã€‚<br>åŒæ ·ï¼Œå½“ LLM åœ¨ä¸ºè§’è‰²å¡«å†™æˆ¿å­å±æ€§æ—¶è¾“å‡ºäº† Gï¼Œæˆ‘ä»¬å¯ä»¥è‡ªä¿¡åœ°é¢„æµ‹ä¸‹ä¸€ä¸ªå­—ç¬¦ä¸²å°†æ˜¯ ryffindorï¼Œä»è€Œå®Œæˆæ•´ä¸ªå­—ç¬¦ä¸²ä¸º Gryffindorã€‚</p><p>è¿™æ­£æ˜¯è·³è·ƒå‰è¿›è§£ç ç®—æ³•åŠ é€Ÿè§£ç çš„æ–¹å¼ã€‚åœ¨è·³è·ƒå‰è¿›ç®—æ³•ä¸­ï¼Œæˆ‘ä»¬æ£€æŸ¥ç»™å®šæ­£åˆ™è¡¨è¾¾å¼çš„æœ‰é™çŠ¶æ€æœºï¼Œè¯†åˆ«æ‰€æœ‰å•ä¸€çš„è½¬æ¢è¾¹ï¼Œå¹¶å°†è¿ç»­çš„è½¬æ¢è·¯å¾„å‹ç¼©ä¸ºå•ä¸€è·¯å¾„ã€‚æˆ‘ä»¬å¯ä»¥ç›´æ¥é¢„å¡«å……ï¼ˆæ‰©å±•ï¼‰è¿™äº›å•ä¸€è·¯å¾„ï¼Œè·³è¿‡é€æ ‡è®°è§£ç ï¼Œç›´åˆ°ä¸‹ä¸€ä¸ªåˆ†æ”¯ç‚¹ã€‚</p><img src="/2024/08/13/NLP%20Insights/%E4%BD%BF%E7%94%A8%E5%8E%8B%E7%BC%A9%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA%E8%BF%9B%E8%A1%8C%E6%9C%AC%E5%9C%B0%20LLM%20%E7%9A%84%E5%BF%AB%E9%80%9F%20JSON%20%E8%A7%A3%E7%A0%81/image-4.png" class="" title="å›¾5ï¼šè·³è·ƒå‰è¿›è§£ç ä¸å‹ç¼©FSMå’Œæ™®é€šè§£ç çš„æ¯”è¾ƒ"><p>å›¾äº”å±•ç¤ºäº†è·³è·ƒå‰è¿›è§£ç ä¸æ™®é€šè§£ç çš„å¯¹æ¯”ã€‚è·³è·ƒå‰è¿›è§£ç åˆ©ç”¨å‹ç¼©çš„æœ‰é™çŠ¶æ€æœºï¼Œé€šè¿‡æå‰é¢„æµ‹å¹¶é¢„å¡«å……å¯èƒ½çš„å­—ç¬¦ä¸²ï¼Œå‡å°‘äº†é€æ ‡è®°è§£ç çš„æ¬¡æ•°ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸º house å­—æ®µç”Ÿæˆå€¼æ—¶ï¼Œæ¨¡å‹åœ¨è§£ç è¿‡ç¨‹ä¸­ç›´æ¥è·³è·ƒå¹¶é¢„å¡«å……äº†â€œGryffindorâ€è¿™ä¸ªå­—ç¬¦ä¸²ï¼Œè€Œæ— éœ€é€å­—ç¬¦ç”Ÿæˆã€‚å›¾ä¸­çš„æµç¨‹å±•ç¤ºäº†å¦‚ä½•é€šè¿‡è¿™ç§æ–¹æ³•æé«˜è§£ç æ•ˆç‡ï¼ŒåŒæ—¶é¿å…äº†ä¸å¿…è¦çš„é‡å¤è®¡ç®—ã€‚<br>å›¾äº”å±•ç¤ºäº†<strong>å‹ç¼©æœ‰é™çŠ¶æ€æœºçš„è·³è·ƒå‰è¿›è§£ç </strong>ä¸<strong>æ™®é€šè§£ç </strong>çš„å¯¹æ¯”ï¼Œç‰¹åˆ«æ˜¯åœ¨ç”Ÿæˆ JSON æ•°æ®æ—¶çš„æ€§èƒ½å·®å¼‚ã€‚ä¸ºäº†æ›´è¯¦ç»†åœ°ç†è§£è¿™å¼ å›¾ï¼Œæˆ‘ä»¬éœ€è¦åˆ†æ­¥éª¤åˆ†æå›¾ä¸­çš„å„ä¸ªéƒ¨åˆ†ã€‚</p><ol><li><p><strong>è¾“å…¥æç¤º</strong>ï¼ˆå·¦ä¾§çš„ç»¿è‰²éƒ¨åˆ†ï¼‰ï¼šæç¤ºæ¨¡å‹ç”Ÿæˆä¸€ä¸ªç¬¦åˆ JSON æ¨¡å¼çš„å¯¹è±¡ã€‚è¿™é‡Œçš„ JSON å¯¹è±¡åŒ…æ‹¬â€œnameâ€ã€â€œageâ€å’Œâ€œhouseâ€ä¸‰ä¸ªå±æ€§ï¼Œåˆ†åˆ«ä»£è¡¨åå­—ã€å¹´é¾„å’Œå­¦é™¢ã€‚</p></li><li><p><strong>è·³è·ƒå‰è¿›è§£ç è¿‡ç¨‹</strong>ï¼ˆä¸­é—´éƒ¨åˆ†çš„è“è‰²å’Œæ©™è‰²æ–¹å—ï¼‰ï¼š</p><ul><li><strong>æ©™è‰²æ–¹å—</strong>ä»£è¡¨éœ€è¦çº¦æŸè§£ç çš„éƒ¨åˆ†ã€‚ä¾‹å¦‚ï¼Œç”Ÿæˆâ€œnameâ€å±æ€§æ—¶ï¼Œæ¨¡å‹é€šè¿‡è·³è·ƒå‰è¿›è§£ç ç®—æ³•å¯ä»¥ç›´æ¥ç”Ÿæˆå®Œæ•´çš„å­—ç¬¦ä¸²â€œHarryâ€ã€‚</li><li><strong>è“è‰²æ–¹å—</strong>ä»£è¡¨æ¨¡å‹åœ¨è·³è·ƒå‰è¿›è¿‡ç¨‹ä¸­é€å­—ç¬¦ï¼ˆæˆ–é€æ ‡è®°ï¼‰è§£ç çš„éƒ¨åˆ†ã€‚è¿™ç§è§£ç æ–¹å¼åœ¨é‡åˆ°éç¡®å®šæ€§æ—¶ï¼ˆä¾‹å¦‚å¤šä¸ªå¯èƒ½çš„å€¼ï¼‰æ‰ä¼šå‡ºç°ã€‚</li></ul></li><li><p><strong>æ™®é€šè§£ç è¿‡ç¨‹</strong>ï¼ˆä¸­é—´éƒ¨åˆ†çš„è“è‰²æ–¹å—ï¼‰ï¼šæ™®é€šè§£ç éœ€è¦é€å­—ç¬¦æˆ–é€æ ‡è®°åœ°ç”Ÿæˆæ•´ä¸ª JSON å¯¹è±¡ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œæ™®é€šè§£ç æ–¹å¼åœ¨å¤„ç†æ¯ä¸€ä¸ªå­—ç¬¦æˆ–æ ‡è®°æ—¶éƒ½éœ€è¦è¿›è¡Œé¢„æµ‹å’Œé€‰æ‹©ï¼Œæ˜¾è‘—é™ä½äº†è§£ç é€Ÿåº¦ã€‚</p></li><li><p><strong>å¯¹æ¯”ç»“æœ</strong>ï¼ˆå³ä¾§éƒ¨åˆ†ï¼‰ï¼š</p><ul><li><strong>è·³è·ƒå‰è¿›è§£ç </strong>ç”Ÿæˆçš„ JSON å¯¹è±¡å±•ç¤ºåœ¨æœ€ä¸Šæ–¹ï¼Œè¿™ç§æ–¹æ³•é€šè¿‡é¢„æµ‹å¹¶é¢„å¡«å……å¯èƒ½çš„å­—ç¬¦ä¸²ï¼Œå¤§å¤§åŠ é€Ÿäº†è§£ç è¿‡ç¨‹ã€‚ä¾‹å¦‚ï¼Œåœ¨ç”Ÿæˆâ€œGryffindorâ€è¿™ä¸ªå­—ç¬¦ä¸²æ—¶ï¼Œæ¨¡å‹ç›´æ¥è·³è¿‡äº†é€å­—ç¬¦ç”Ÿæˆçš„æ­¥éª¤ã€‚</li><li><strong>æ™®é€šè§£ç </strong>ç”Ÿæˆçš„ JSON å¯¹è±¡å±•ç¤ºåœ¨æœ€ä¸‹æ–¹ï¼Œè¿™ç§æ–¹æ³•é€å­—ç¬¦è§£ç ï¼Œè™½ç„¶èƒ½å¤Ÿä¿è¯ç”Ÿæˆçš„å‡†ç¡®æ€§ï¼Œä½†æ•ˆç‡è¾ƒä½ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†é•¿å­—ç¬¦ä¸²æˆ–å¤æ‚ç»“æ„æ—¶ã€‚</li></ul></li></ol><h3 id="è¯¦ç»†è§£è¯»ï¼š"><a href="#è¯¦ç»†è§£è¯»ï¼š" class="headerlink" title="è¯¦ç»†è§£è¯»ï¼š"></a>è¯¦ç»†è§£è¯»ï¼š</h3><ol><li><p><strong>è·³è·ƒå‰è¿›è§£ç çš„å·¥ä½œåŸç†</strong>ï¼š</p><ul><li>åœ¨è§£ç çš„è¿‡ç¨‹ä¸­ï¼Œæ¨¡å‹ä½¿ç”¨å‹ç¼©åçš„æœ‰é™çŠ¶æ€æœºï¼ˆFSMï¼‰æ¥é¢„æµ‹å’Œè¯†åˆ«å³å°†ç”Ÿæˆçš„å­—ç¬¦ä¸²ã€‚å¦‚æœæ¨¡å‹èƒ½åœ¨å½“å‰ä¸Šä¸‹æ–‡ä¸­å‡†ç¡®é¢„æµ‹å‡ºæ¥ä¸‹æ¥è¦ç”Ÿæˆçš„å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆå®ƒå¯ä»¥è·³è¿‡è¿™äº›å­—ç¬¦ä¸²çš„é€æ ‡è®°è§£ç ï¼Œç›´æ¥ç”Ÿæˆæ•´ä¸ªå­—ç¬¦ä¸²ï¼ˆä¾‹å¦‚â€œGryffindorâ€ï¼‰ã€‚</li><li>è¿™ç§æ–¹æ³•åˆ©ç”¨äº†æ­£åˆ™è¡¨è¾¾å¼çš„ç»“æ„ç‰¹ç‚¹ï¼Œå°†è¿ç»­çš„è½¬æ¢è·¯å¾„å‹ç¼©æˆä¸€ä¸ªå•ä¸€è·¯å¾„ï¼Œä»è€Œé¿å…äº†ä¸å¿…è¦çš„é€æ ‡è®°è§£ç æ­¥éª¤ã€‚</li></ul></li><li><p><strong>æ™®é€šè§£ç çš„é™åˆ¶</strong>ï¼š</p><ul><li>æ™®é€šè§£ç æ–¹æ³•éœ€è¦é€æ­¥è§£ç æ¯ä¸€ä¸ªå­—ç¬¦æˆ–æ ‡è®°ï¼Œå› æ­¤åœ¨å¤„ç†å¤æ‚çš„ JSON å¯¹è±¡æ—¶æ•ˆç‡è¾ƒä½ã€‚æ¯ä¸€æ­¥éƒ½éœ€è¦æ¨¡å‹é‡æ–°è®¡ç®—å¯èƒ½çš„è¾“å‡ºï¼Œå¹¶ä»ä¸­é€‰æ‹©æœ€ä¼˜è§£ï¼Œè¿™ä¼šå¤§å¹…å¢åŠ è§£ç æ—¶é—´ã€‚</li></ul></li><li><p><strong>æ€§èƒ½å·®å¼‚</strong>ï¼š</p><ul><li>ç”±äºè·³è·ƒå‰è¿›è§£ç å‡å°‘äº†é€å­—ç¬¦è§£ç çš„æ¬¡æ•°ï¼Œå¹¶ä¸”åˆ©ç”¨äº† FSM çš„å‹ç¼©ç‰¹æ€§ï¼Œå®ƒåœ¨æ—¶é—´å’Œè®¡ç®—èµ„æºä¸Šçš„å¼€é”€éƒ½æ˜¾è‘—ä½äºæ™®é€šè§£ç ã€‚å°¤å…¶åœ¨éœ€è¦ç”Ÿæˆå¤§é‡æ•°æ®æˆ–å¤„ç†å¤æ‚ç»“æ„æ—¶ï¼Œè·³è·ƒå‰è¿›è§£ç çš„ä¼˜åŠ¿æ›´åŠ æ˜æ˜¾ã€‚</li></ul></li></ol><p>SGLang çš„ RadixAttention æœºåˆ¶æå¤§åœ°ç®€åŒ–äº†è·³è·ƒå‰è¿›è§£ç ç®—æ³•çš„å®ç°ã€‚å½“æ‰§è¡Œè·³è·ƒå‰è¿›æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ°ç»ˆæ­¢å½“å‰è¯·æ±‚å¹¶æ’å…¥æ–°è¯·æ±‚ã€‚SGLang è¿è¡Œæ—¶çš„ RadixAttention å’Œé«˜æ•ˆçš„æ‰©å±•åŸè¯­å°†è‡ªåŠ¨é‡ç”¨å‰ä¸€ç»„æ ‡è®°çš„ KV ç¼“å­˜ï¼Œä»è€Œé¿å…å†—ä½™è®¡ç®—ã€‚</p><h2 id="æ ‡è®°è¾¹ç•Œå¤„ç†"><a href="#æ ‡è®°è¾¹ç•Œå¤„ç†" class="headerlink" title="æ ‡è®°è¾¹ç•Œå¤„ç†"></a>æ ‡è®°è¾¹ç•Œå¤„ç†</h2><p>åœ¨å®ç°çº¦æŸè§£ç æ—¶ï¼Œç”±äºå­—ç¬¦ä¸æ ‡è®°ä¹‹é—´å¤æ‚çš„å¯èƒ½æ˜ å°„å…³ç³»ï¼Œå¤„ç†æ ‡è®°è¾¹ç•Œæ€»æ˜¯å¾ˆæ£˜æ‰‹ã€‚</p><p>åœ¨ LLM è§£ç è¿‡ç¨‹ä¸­ï¼Œå®ƒå¯èƒ½æ›´å€¾å‘ï¼ˆæ„å‘³ç€æ¦‚ç‡æ›´é«˜ï¼‰äºå°†å¤šä¸ªå­—ç¬¦ç»„åˆæˆä¸€ä¸ªæ ‡è®°ã€‚ä¾‹å¦‚ï¼Œåœ¨ JSON è§£ç çš„ä¸Šä¸‹æ–‡ä¸­è§£ç â€Helloâ€æ—¶ï¼ŒLLM å¯èƒ½ä¼šè¾“å‡ºå¦‚ä¸‹æ ‡è®°ï¼š<br>â€œ He llo â€œï¼Œ</p><p>è€Œä¸æ˜¯è§£ç æœ€åçš„â€ ï¼Œå®ƒæ€»æ˜¯å€¾å‘äºå°†å…¶ä¸åç»­å­—ç¬¦ç»„åˆæˆæ›´å¸¸è§çš„æ ‡è®°â€ï¼Œ è¿™ç§æ•ˆæœå¯èƒ½å¯¼è‡´ä¸€äº›å¥‡æ€ªçš„è¡Œä¸ºã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸Šè¿°æƒ…å†µä¸‹ï¼Œå¦‚æœæ­£åˆ™è¡¨è¾¾å¼è®¾ç½®ä¸ºâ€[\w\d\s]*â€œï¼ˆä¸åŒ…å«æœ€åçš„â€ï¼Œ ï¼‰ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´æ— é™è§£ç ï¼Œå› ä¸º LLM æƒ³è¦åœæ­¢äºâ€ï¼Œä½†è¯¥æ ‡è®°æ˜¯ä¸å…è®¸çš„ã€‚</p><p>æ­¤å¤–ï¼Œåœ¨è·³è·ƒå‰è¿›è§£ç è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å‘ç°å¯¹è·³è·ƒå‰è¿›éƒ¨åˆ†ä½¿ç”¨ä¸åŒçš„æ ‡è®°ç­–ç•¥å¯èƒ½ä¼šå¯¼è‡´åç»­æ ‡è®°çš„ logit åˆ†å¸ƒä¸åŒã€‚ç®€å•åœ°å°†æ ‡è®°åŒ–çš„è·³è·ƒå‰è¿›éƒ¨åˆ†é™„åŠ åˆ°å½“å‰çš„æ ‡è®°åºåˆ—ä¸­å¯èƒ½ä¼šäº§ç”Ÿæ„å¤–çš„ç»“æœã€‚</p><p>ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œæˆ‘ä»¬æå‡ºäº†ä»¥ä¸‹è§£å†³æ–¹æ¡ˆï¼š</p><ul><li>æˆ‘ä»¬åœ¨è·³è·ƒå‰è¿›é˜¶æ®µå®æ–½äº†é‡æ–°æ ‡è®°åŒ–æœºåˆ¶ã€‚è¿™åŒ…æ‹¬é™„åŠ å­—ç¬¦ä¸²è€Œä¸æ˜¯æ ‡è®°ï¼Œç„¶åé‡æ–°æ ‡è®°æ•´ä¸ªæ–‡æœ¬ã€‚è¿™ç§æ–¹æ³•æœ‰æ•ˆåœ°è§£å†³äº†å¤§å¤šæ•°æ ‡è®°åŒ–é—®é¢˜ï¼Œå¹¶ä¸”ä»…å¯¼è‡´è®¡ç®—å¼€é”€å¢åŠ çº¦ 4%ã€‚</li><li><strong>å»ºè®®</strong>ä½¿ç”¨ç»¼åˆæ­£åˆ™è¡¨è¾¾å¼å¼•å¯¼æ•´ä¸ªè§£ç è¿‡ç¨‹ï¼Œè€Œä¸æ˜¯ä½¿ç”¨å¤šä¸ªè¿æ¥çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚è¿™ç§æ–¹æ³•ç¡®ä¿ FSM å’Œ LLM éƒ½äº†è§£æ•´ä¸ªè§£ç è¿‡ç¨‹ï¼Œä»è€Œå°½é‡å‡å°‘ä¸è¾¹ç•Œç›¸å…³çš„é—®é¢˜ã€‚<br>ä½ è¿˜å¯ä»¥åœ¨è¿™ç¯‡åšå®¢æ–‡ç« ä¸­é˜…è¯»ä¸€äº›é¢å¤–çš„è®¨è®ºã€‚</li></ul><h2 id="åŸºå‡†æµ‹è¯•ç»“æœ"><a href="#åŸºå‡†æµ‹è¯•ç»“æœ" class="headerlink" title="åŸºå‡†æµ‹è¯•ç»“æœ"></a>åŸºå‡†æµ‹è¯•ç»“æœ</h2><p>æˆ‘ä»¬åœ¨ä¸¤ä¸ªä»»åŠ¡ä¸Šå¯¹æˆ‘ä»¬çš„è·³è·ƒå‰è¿›è§£ç è¿›è¡Œäº†åŸºå‡†æµ‹è¯•ï¼š</p><ol><li>ä½¿ç”¨ç®€çŸ­çš„æç¤ºç”Ÿæˆ JSON æ ¼å¼çš„è§’è‰²æ•°æ®ã€‚</li><li>ä»é•¿æ–‡æ¡£ä¸­æå–åŸå¸‚ä¿¡æ¯å¹¶ä»¥ JSON æ ¼å¼è¾“å‡ºã€‚</li></ol><p>æˆ‘ä»¬åœ¨ NVIDIA A10 GPUï¼ˆ24GBï¼‰ä¸Šæµ‹è¯•äº† llama-7Bï¼Œä½¿ç”¨äº† vllm v0.2.7ï¼Œguidance v0.1.0ï¼Œoutlines v0.2.5 å’Œ llama.cpp v0.2.38ï¼ˆPython ç»‘å®šï¼‰ã€‚ä¸‹å›¾æ˜¾ç¤ºäº†è¿™äº›æ–¹æ³•çš„ååé‡ï¼ˆä½¿ç”¨æ¯ä¸ªç³»ç»Ÿæ”¯æŒçš„æœ€å¤§æ‰¹æ¬¡å¤§å°ï¼‰å’Œå»¶è¿Ÿï¼ˆæ‰¹æ¬¡å¤§å°ä¸º 1ï¼‰ï¼š</p><img src="/2024/08/13/NLP%20Insights/%E4%BD%BF%E7%94%A8%E5%8E%8B%E7%BC%A9%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA%E8%BF%9B%E8%A1%8C%E6%9C%AC%E5%9C%B0%20LLM%20%E7%9A%84%E5%BF%AB%E9%80%9F%20JSON%20%E8%A7%A3%E7%A0%81/image-5.png" class="" title="å›¾6ï¼šåŸºå‡†æµ‹è¯•ç»“æœ"><p>ç»“æœè¡¨æ˜ï¼Œä½¿ç”¨æˆ‘ä»¬çš„è§£ç ç®—æ³•çš„ SGLang æ˜¾è‘—ä¼˜äºæ‰€æœ‰å…¶ä»–ç³»ç»Ÿã€‚å®ƒå¯ä»¥å°†å»¶è¿Ÿå‡å°‘æœ€å¤š 2 å€ï¼Œå¹¶å°†ååé‡æé«˜æœ€å¤š 2.5 å€ã€‚åœ¨è§’è‰²ç”Ÿæˆä»»åŠ¡ä¸­ï¼Œå³ä½¿ä¸ä½¿ç”¨è·³è·ƒå‰è¿›çš„ SGLang ä¹Ÿæ¯” Outlines+vLLM å®ç°äº†æ›´é«˜çš„ååé‡ï¼›æˆ‘ä»¬æ€€ç–‘è¿™æ˜¯ç”±äº Outlines ä¸­çš„æŸäº›å¼€é”€æ‰€è‡´ã€‚</p><h2 id="ç”¨ä¾‹"><a href="#ç”¨ä¾‹" class="headerlink" title="ç”¨ä¾‹"></a>ç”¨ä¾‹</h2><p>æˆ‘ä»¬å·²ç»ä¸ Boson.ai æµ‹è¯•äº†è¿™ä¸ªåŠŸèƒ½ä¸¤å‘¨ï¼Œä»–ä»¬æ­£åœ¨å°†è¿™ä¸ªåŠŸèƒ½å¼•å…¥ä»–ä»¬çš„ç”Ÿäº§ç”¨ä¾‹ä¸­ï¼Œå› ä¸ºå®ƒä¿è¯äº†æ›´é«˜çš„è§£ç ååé‡å’Œå¯é çš„å“åº”ã€‚</p><p>æ­¤å¤–ï¼Œå¦ä¸€ä½ç”¨æˆ·ä½¿ç”¨æ­¤åŠŸèƒ½é€šè¿‡è§†è§‰è¯­è¨€æ¨¡å‹ LLaVA ä»å›¾åƒä¸­æå–ç»“æ„åŒ–ä¿¡æ¯ã€‚</p><img src="/2024/08/13/NLP%20Insights/%E4%BD%BF%E7%94%A8%E5%8E%8B%E7%BC%A9%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA%E8%BF%9B%E8%A1%8C%E6%9C%AC%E5%9C%B0%20LLM%20%E7%9A%84%E5%BF%AB%E9%80%9F%20JSON%20%E8%A7%A3%E7%A0%81/image-6.png" class="" title="å›¾7ï¼šä½¿ç”¨SGLangå’ŒLLaVAä»å›¾åƒä¸­æå–ç»“æ„åŒ–ä¿¡æ¯">]]></content>
      
      
      <categories>
          
          <category> NLP Insights </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SGLang </tag>
            
            <tag> Structured LLM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Detailed Steps for Running Fine-tuned Gemma-2-2b-it with vLLM</title>
      <link href="/2024/08/07/NLP%20Insights/Running%20Fine-tuned%20Gemma-2-2b-it%20with%20vLLM/"/>
      <url>/2024/08/07/NLP%20Insights/Running%20Fine-tuned%20Gemma-2-2b-it%20with%20vLLM/</url>
      
        <content type="html"><![CDATA[<p>In this post, I will share the steps to run the fine-tuned Gemma-2-2b-it model using vLLM. This guide will cover the installation process, environment configuration, and common troubleshooting tips.</p><h2 id="Installation-and-Verification-of-vLLM"><a href="#Installation-and-Verification-of-vLLM" class="headerlink" title="Installation and Verification of vLLM"></a>Installation and Verification of vLLM</h2><p>First, ensure that you have installed and verified vLLM version 0.5.3.</p><ol><li><p>Install vLLM:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!pip install vllm==0.5.3</span><br></pre></td></tr></tbody></table></figure></li><li><p>Verify the installation:</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> vllm</span><br><span class="line"><span class="built_in">print</span>(vllm.__version__)</span><br><span class="line"><span class="comment"># Output: 0.5.3</span></span><br></pre></td></tr></tbody></table></figure></li></ol><h2 id="Installing-Flashinfer"><a href="#Installing-Flashinfer" class="headerlink" title="Installing Flashinfer"></a>Installing Flashinfer</h2><p>Follow these steps to install Flashinfer, ensuring compatibility with your torch version and CUDA.</p><ol><li><p>Check the torch version and CUDA compatibility:</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="built_in">print</span>(torch.__version__)  <span class="comment"># Should output: 2.3.1+cu121</span></span><br><span class="line"><span class="built_in">print</span>(torch.version.cuda) <span class="comment"># Should output: 12.1</span></span><br></pre></td></tr></tbody></table></figure></li><li><p>Install Flashinfer:<br>According to the documentation, Gemma runs on version 0.0.8. vLLM requires FlashInfer v0.0.8 (refer to <a href="https://github.com/vllm-project/vllm/issues/7060">vLLM Version and Flashinfer Documentation</a> for details on Gemma 2).</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!pip install flashinfer==0.0.8 -i https://flashinfer.ai/whl/cu121/torch2.3/</span><br></pre></td></tr></tbody></table></figure></li></ol><h2 id="Updating-Environment-Variables-for-vLLM-Backend"><a href="#Updating-Environment-Variables-for-vLLM-Backend" class="headerlink" title="Updating Environment Variables for vLLM Backend"></a>Updating Environment Variables for vLLM Backend</h2><p>Ensure that Flashinfer is set as the attention mechanism backend for vLLM:</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line">os.environ[<span class="string">"VLLM_ATTENTION_BACKEND"</span>] = <span class="string">"FLASHINFER"</span></span><br></pre></td></tr></tbody></table></figure><h2 id="Testing-vLLM"><a href="#Testing-vLLM" class="headerlink" title="Testing vLLM"></a>Testing vLLM</h2><p>Here is the test code to generate text using vLLM:</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> vllm <span class="keyword">import</span> LLM, SamplingParams</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">llm = LLM(model=<span class="string">"gemma-2-2b-model"</span>, trust_remote_code=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">sampling_params = SamplingParams(</span><br><span class="line">    temperature=<span class="number">0.8</span>,</span><br><span class="line">    max_tokens=<span class="number">512</span>,</span><br><span class="line">    top_p=<span class="number">0.95</span>,</span><br><span class="line">    top_k=<span class="number">1</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Example test data</span></span><br><span class="line">test_data = [{<span class="string">"text"</span>: <span class="string">"Input test text 1"</span>}, {<span class="string">"text"</span>: <span class="string">"Input test text 2"</span>}]</span><br><span class="line"></span><br><span class="line">prompts = [</span><br><span class="line">    test_data[random.randint(<span class="number">0</span>, <span class="built_in">len</span>(test_data) - <span class="number">1</span>)][<span class="string">"text"</span>],</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">outputs = llm.generate(</span><br><span class="line">    prompts,</span><br><span class="line">    sampling_params</span><br><span class="line">)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p>By following these steps, you should be able to successfully run the fine-tuned Gemma-2-2b-it model.</p><h2 id="Common-Errors-and-Solutions"><a href="#Common-Errors-and-Solutions" class="headerlink" title="Common Errors and Solutions"></a>Common Errors and Solutions</h2><p>Here are some common errors you might encounter and their solutions:</p><ol><li><p><strong>RuntimeError: <code>CHECK_EQ(paged_kv_indptr.size(0), batch_size + 1) failed. 1 vs 257</code></strong></p><ul><li><strong>Cause</strong>: Incorrect Flashinfer version.</li><li><strong>Solution</strong>: Ensure you have installed the correct version of Flashinfer.</li></ul></li><li><p><strong>TypeError: <code>'NoneType' object is not callable</code></strong></p><ul><li><strong>Cause</strong>: Flashinfer is not installed.</li><li><strong>Solution</strong>: Install Flashinfer following the steps above.</li></ul></li><li><p><strong>ValueError: <code>Please use Flashinfer backend for models with logits_soft_cap (i.e., Gemma-2). Otherwise, the output might be wrong. Set Flashinfer backend by export VLLM_ATTENTION_BACKEND=FLASHINFER.</code></strong></p><ul><li><strong>Cause</strong>: Flashinfer backend is not set.</li><li><strong>Solution</strong>: Set the environment variable <code>VLLM_ATTENTION_BACKEND</code> to <code>FLASHINFER</code>.</li></ul></li></ol><p>By following these detailed steps and solutions, you should be able to successfully run and debug the fine-tuned Gemma-2-2b-it model. If you encounter any issues, refer to the relevant documentation or seek help from the community.</p>]]></content>
      
      
      <categories>
          
          <category> NLP Insights </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vLLM </tag>
            
            <tag> Gemma-2-2b-it </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨vLLMè¿è¡Œå¾®è°ƒåçš„Gemma-2</title>
      <link href="/2024/08/07/NLP%20Insights/%E4%BD%BF%E7%94%A8vLLM%E8%BF%90%E8%A1%8C%E5%BE%AE%E8%B0%83%E5%90%8E%E7%9A%84Gemma-2/"/>
      <url>/2024/08/07/NLP%20Insights/%E4%BD%BF%E7%94%A8vLLM%E8%BF%90%E8%A1%8C%E5%BE%AE%E8%B0%83%E5%90%8E%E7%9A%84Gemma-2/</url>
      
        <content type="html"><![CDATA[<h1 id="ä½¿ç”¨vLLMè¿è¡Œå¾®è°ƒåçš„Gemma-2-2b-itçš„è¯¦ç»†æ­¥éª¤"><a href="#ä½¿ç”¨vLLMè¿è¡Œå¾®è°ƒåçš„Gemma-2-2b-itçš„è¯¦ç»†æ­¥éª¤" class="headerlink" title="ä½¿ç”¨vLLMè¿è¡Œå¾®è°ƒåçš„Gemma-2-2b-itçš„è¯¦ç»†æ­¥éª¤"></a>ä½¿ç”¨vLLMè¿è¡Œå¾®è°ƒåçš„Gemma-2-2b-itçš„è¯¦ç»†æ­¥éª¤</h1><p>åœ¨è¿™é‡Œåˆ†äº«ä¸€ä¸‹æˆ‘è¿è¡Œå¾®è°ƒåçš„Gemma-2-2b-itæ¨¡å‹å¹¶ä½¿ç”¨vLLMçš„æ­¥éª¤ï¼Œå¸Œæœ›å¯¹å…¶ä»–äººæœ‰æ‰€å¸®åŠ©ã€‚æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»å®‰è£…è¿‡ç¨‹ã€ç¯å¢ƒé…ç½®ä»¥åŠå¸¸è§é—®é¢˜çš„è§£å†³æ–¹æ³•ã€‚</p><h2 id="å®‰è£…å’ŒéªŒè¯vLLM"><a href="#å®‰è£…å’ŒéªŒè¯vLLM" class="headerlink" title="å®‰è£…å’ŒéªŒè¯vLLM"></a>å®‰è£…å’ŒéªŒè¯vLLM</h2><p>é¦–å…ˆï¼Œç¡®ä¿å®‰è£…å¹¶éªŒè¯vLLMçš„ç‰ˆæœ¬æ˜¯0.5.3ã€‚</p><ol><li><p>å®‰è£…vLLMï¼š</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install vllm==0.5.3</span><br></pre></td></tr></tbody></table></figure></li><li><p>éªŒè¯å®‰è£…ï¼š</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> vllm</span><br><span class="line"><span class="built_in">print</span>(vllm.__version__)</span><br><span class="line"><span class="comment"># è¾“å‡º: 0.5.3</span></span><br></pre></td></tr></tbody></table></figure></li></ol><h2 id="å®‰è£…Flashinfer"><a href="#å®‰è£…Flashinfer" class="headerlink" title="å®‰è£…Flashinfer"></a>å®‰è£…Flashinfer</h2><p>æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤å®‰è£…Flashinferï¼Œå¹¶ç¡®ä¿æ‚¨çš„torchç‰ˆæœ¬å’ŒCUDAå…¼å®¹æ€§ã€‚</p><ol><li><p>æ£€æŸ¥torchç‰ˆæœ¬å’ŒCUDAå…¼å®¹æ€§ï¼š</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="built_in">print</span>(torch.__version__)  <span class="comment"># åº”è¾“å‡º: 2.3.1+cu121</span></span><br><span class="line"><span class="built_in">print</span>(torch.version.cuda) <span class="comment"># åº”è¾“å‡º: 12.1</span></span><br></pre></td></tr></tbody></table></figure></li><li><p>å®‰è£…Flashinferï¼š<br>æ ¹æ®æ–‡æ¡£ï¼ŒGemmaè¿è¡Œåœ¨ç‰ˆæœ¬0.08ã€‚vLLMéœ€è¦FlashInfer v0.0.8ï¼ˆè¯·å‚é˜…<a href="https://github.com/vllm-project/vllm/issues/7060">vLLMç‰ˆæœ¬å’ŒFlashinferæ–‡æ¡£</a>ä¸­å…³äºGemma 2çš„éƒ¨åˆ†ï¼‰ã€‚</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!pip install flashinfer==0.0.8 -i https://flashinfer.ai/whl/cu121/torch2.3/</span><br></pre></td></tr></tbody></table></figure></li></ol><h2 id="æ›´æ–°ç¯å¢ƒä¸­çš„VLLMåç«¯å˜é‡"><a href="#æ›´æ–°ç¯å¢ƒä¸­çš„VLLMåç«¯å˜é‡" class="headerlink" title="æ›´æ–°ç¯å¢ƒä¸­çš„VLLMåç«¯å˜é‡"></a>æ›´æ–°ç¯å¢ƒä¸­çš„VLLMåç«¯å˜é‡</h2><p>ç¡®ä¿è®¾ç½®Flashinferä¸ºvLLMçš„æ³¨æ„åŠ›æœºåˆ¶åç«¯ï¼š</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line">os.environ[<span class="string">"VLLM_ATTENTION_BACKEND"</span>] = <span class="string">"FLASHINFER"</span></span><br></pre></td></tr></tbody></table></figure><h2 id="æµ‹è¯•vLLM"><a href="#æµ‹è¯•vLLM" class="headerlink" title="æµ‹è¯•vLLM"></a>æµ‹è¯•vLLM</h2><p>ä»¥ä¸‹æ˜¯ä½¿ç”¨vLLMç”Ÿæˆæ–‡æœ¬çš„æµ‹è¯•ä»£ç ï¼š</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> vllm <span class="keyword">import</span> LLM, SamplingParams</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">llm = LLM(model=<span class="string">"gemma-2-2b-model"</span>, trust_remote_code=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">sampling_params = SamplingParams(</span><br><span class="line">    temperature=<span class="number">0.8</span>,</span><br><span class="line">    max_tokens=<span class="number">512</span>,</span><br><span class="line">    top_p=<span class="number">0.95</span>,</span><br><span class="line">    top_k=<span class="number">1</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹æµ‹è¯•æ•°æ®</span></span><br><span class="line">test_data = [{<span class="string">"text"</span>: <span class="string">"è¾“å…¥æµ‹è¯•æ–‡æœ¬1"</span>}, {<span class="string">"text"</span>: <span class="string">"è¾“å…¥æµ‹è¯•æ–‡æœ¬2"</span>}]</span><br><span class="line"></span><br><span class="line">prompts = [</span><br><span class="line">    test_data[random.randint(<span class="number">0</span>, <span class="built_in">len</span>(test_data) - <span class="number">1</span>)][<span class="string">"text"</span>],</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">outputs = llm.generate(</span><br><span class="line">    prompts,</span><br><span class="line">    sampling_params</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># é¢„æœŸè¾“å‡º:</span></span><br><span class="line"><span class="comment"># Processed prompts: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 1/1 [00:01&lt;00:00,  1.24s/it, est. speed input: 991.44 toks/s, output: 87.79 toks/s]</span></span><br></pre></td></tr></tbody></table></figure><p>é€šè¿‡ä¸Šè¿°æ­¥éª¤ï¼Œæ‚¨åº”è¯¥èƒ½å¤ŸæˆåŠŸè¿è¡Œå¾®è°ƒåçš„Gemma-2-2b-itæ¨¡å‹ã€‚</p><h2 id="å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ³•"><a href="#å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ³•" class="headerlink" title="å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ³•"></a>å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ³•</h2><p>åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šé‡åˆ°ä»¥ä¸‹å¸¸è§é”™è¯¯ï¼š</p><ol><li><p><strong>RuntimeError: <code>CHECK_EQ(paged_kv_indptr.size(0), batch_size + 1) failed. 1 vs 257</code></strong></p><ul><li><strong>åŸå› </strong>ï¼šFlashinferç‰ˆæœ¬é”™è¯¯ã€‚</li><li><strong>è§£å†³æ–¹æ³•</strong>ï¼šè¯·ç¡®ä¿å®‰è£…äº†æ­£ç¡®ç‰ˆæœ¬çš„Flashinferã€‚</li></ul></li><li><p><strong>TypeError: <code>'NoneType' object is not callable</code></strong></p><ul><li><strong>åŸå› </strong>ï¼šæ²¡æœ‰å®‰è£…Flashinferã€‚</li><li><strong>è§£å†³æ–¹æ³•</strong>ï¼šæŒ‰ç…§ä¸Šè¿°æ­¥éª¤å®‰è£…Flashinferã€‚</li></ul></li><li><p><strong>ValueError: <code>Please use Flashinfer backend for models with logits_soft_cap (i.e., Gemma-2). Otherwise, the output might be wrong. Set Flashinfer backend by export VLLM_ATTENTION_BACKEND=FLASHINFER.</code></strong></p><ul><li><strong>åŸå› </strong>ï¼šæœªè®¾ç½®Flashinferåç«¯ã€‚</li><li><strong>è§£å†³æ–¹æ³•</strong>ï¼šè®¾ç½®ç¯å¢ƒå˜é‡<code>VLLM_ATTENTION_BACKEND</code>ä¸º<code>FLASHINFER</code>ã€‚</li></ul></li></ol><p>é€šè¿‡ä¸Šè¿°è¯¦ç»†æ­¥éª¤å’Œè§£å†³æ–¹æ³•ï¼Œæ‚¨åº”è¯¥èƒ½å¤ŸæˆåŠŸè¿è¡Œå¹¶è°ƒè¯•å¾®è°ƒåçš„Gemma-2-2b-itæ¨¡å‹ã€‚å¦‚æœæ‚¨åœ¨ä»»ä½•ä¸€æ­¥é‡åˆ°é—®é¢˜ï¼Œè¯·å‚è€ƒç›¸åº”çš„æ–‡æ¡£æˆ–åœ¨ç¤¾åŒºä¸­å¯»æ±‚å¸®åŠ©ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> NLP Insights </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vLLM </tag>
            
            <tag> Gemma-2 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•å‡†ç¡®è®¡ç®—å›ºå®šé•¿åº¦æ¨¡å‹çš„å›°æƒ‘åº¦ï¼ˆPPLï¼‰</title>
      <link href="/2024/04/17/NLP%20Insights/%20%E5%9B%B0%E6%83%91%E5%BA%A6(PPL)/"/>
      <url>/2024/04/17/NLP%20Insights/%20%E5%9B%B0%E6%83%91%E5%BA%A6(PPL)/</url>
      
        <content type="html"><![CDATA[<h1 id="å¦‚ä½•è®¡ç®—å›ºå®šé•¿åº¦æ¨¡å‹çš„å›°æƒ‘åº¦ï¼ˆPPLï¼‰"><a href="#å¦‚ä½•è®¡ç®—å›ºå®šé•¿åº¦æ¨¡å‹çš„å›°æƒ‘åº¦ï¼ˆPPLï¼‰" class="headerlink" title="å¦‚ä½•è®¡ç®—å›ºå®šé•¿åº¦æ¨¡å‹çš„å›°æƒ‘åº¦ï¼ˆPPLï¼‰"></a>å¦‚ä½•è®¡ç®—å›ºå®šé•¿åº¦æ¨¡å‹çš„å›°æƒ‘åº¦ï¼ˆPPLï¼‰</h1><p>å›°æƒ‘åº¦ï¼ˆPPLï¼‰æ˜¯è¯„ä¼°è¯­è¨€æ¨¡å‹æœ€å¸¸ç”¨çš„æŒ‡æ ‡ä¹‹ä¸€ã€‚åœ¨æ·±å…¥æ¢è®¨ä¹‹å‰ï¼Œæˆ‘ä»¬åº”è¯¥æ³¨æ„è¿™ä¸ªæŒ‡æ ‡ç‰¹åˆ«é€‚ç”¨äºä¼ ç»Ÿè¯­è¨€æ¨¡å‹ï¼ˆæœ‰æ—¶è¢«ç§°ä¸ºè‡ªå›å½’æˆ–å› æœè¯­è¨€æ¨¡å‹ï¼‰ï¼Œè€Œå¯¹äºåƒ BERT è¿™æ ·çš„ masked language models åˆ™æ²¡æœ‰æ˜ç¡®å®šä¹‰ï¼ˆè§<a href="https://huggingface.co/docs/transformers/main/en/model_summary">æ¨¡å‹æ€»ç»“</a>ï¼‰ã€‚</p><p>å›°æƒ‘åº¦è¢«å®šä¹‰ä¸ºåºåˆ—çš„æŒ‡æ•°åŒ–å¹³å‡è´Ÿå¯¹æ•°ä¼¼ç„¶ã€‚å¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ªæ ‡è®°åŒ–åºåˆ— $X = (x_0, x_1, \dots, x_t)$ï¼Œé‚£ä¹ˆ $X$ çš„å›°æƒ‘åº¦ä¸ºï¼Œ</p><p>$$<br>\text{PPL}(X) = \exp \left{ -\frac{1}{t}\sum*{i=1}^t \log p<em>\theta (x</em>i|x*{&lt;i}) \right}<br>$$</p><p>å…¶ä¸­ $\log p<em>\theta (x_i|x</em>{&lt;i})$ æ˜¯ç¬¬ i ä¸ªæ ‡è®°çš„å¯¹æ•°ä¼¼ç„¶ï¼Œæ¡ä»¶æ˜¯æ ¹æ®æˆ‘ä»¬çš„æ¨¡å‹å‰é¢çš„æ ‡è®° $x_{&lt;i}$ã€‚ç›´è§‚ä¸Šï¼Œå®ƒå¯ä»¥è¢«è®¤ä¸ºæ˜¯è¯„ä¼°æ¨¡å‹åœ¨è¯­æ–™åº“ä¸­æŒ‡å®šæ ‡è®°é›†åˆä¸Šé¢„æµ‹å‡åŒ€æ€§çš„èƒ½åŠ›ã€‚é‡è¦çš„æ˜¯ï¼Œè¿™æ„å‘³ç€æ ‡è®°åŒ–ç¨‹åºç›´æ¥å½±å“æ¨¡å‹çš„å›°æƒ‘åº¦ï¼Œè¿™åœ¨æ¯”è¾ƒä¸åŒæ¨¡å‹æ—¶åº”å§‹ç»ˆè€ƒè™‘ã€‚</p><p>è¿™ä¹Ÿç›¸å½“äºæ•°æ®å’Œæ¨¡å‹é¢„æµ‹ä¹‹é—´çš„äº¤å‰ç†µçš„æŒ‡æ•°åŒ–ã€‚æƒ³è¦äº†è§£æ›´å¤šå…³äºå›°æƒ‘åº¦åŠå…¶ä¸æ¯å­—ç¬¦ä½æ•°ï¼ˆBPCï¼‰å’Œæ•°æ®å‹ç¼©çš„å…³ç³»çš„ç›´è§‰ï¼Œå¯ä»¥æŸ¥çœ‹è¿™ç¯‡åœ¨ The Gradient ä¸Šçš„<a href="https://thegradient.pub/understanding-evaluation-metrics-for-language-models/">ç²¾å½©åšå®¢æ–‡ç« </a>ã€‚</p><h2 id="Calculating-PPL-with-fixed-length-models"><a href="#Calculating-PPL-with-fixed-length-models" class="headerlink" title="Calculating PPL with fixed-length models"></a>Calculating PPL with fixed-length models</h2><p>å¦‚æœæˆ‘ä»¬ä¸å—æ¨¡å‹ä¸Šä¸‹æ–‡å¤§å°çš„é™åˆ¶ï¼Œæˆ‘ä»¬ä¼šé€šè¿‡è‡ªå›å½’åœ°åˆ†è§£åºåˆ—å¹¶åœ¨æ¯ä¸€æ­¥éƒ½åŸºäºæ•´ä¸ªå‰åºå­åºåˆ—æ¥æ¡ä»¶åŒ–ï¼Œä»è€Œè¯„ä¼°æ¨¡å‹çš„å›°æƒ‘åº¦ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><img width="600" alt="Full decomposition of a sequence with unlimited context length" src="https://huggingface.co/datasets/huggingface/documentation-images/resolve/main/ppl_full.gif"><p>ç„¶è€Œï¼Œåœ¨å¤„ç†è¿‘ä¼¼æ¨¡å‹æ—¶ï¼Œæˆ‘ä»¬é€šå¸¸å—åˆ°æ¨¡å‹å¯ä»¥å¤„ç†çš„æ ‡è®°æ•°é‡çš„é™åˆ¶ã€‚ä¾‹å¦‚ï¼Œ<a href="https://huggingface.co/docs/transformers/main/en/model_doc/gpt2">GPT-2</a>çš„æœ€å¤§ç‰ˆæœ¬æœ‰å›ºå®šçš„ 1024 ä¸ªæ ‡è®°é•¿åº¦ï¼Œæ‰€ä»¥å½“ $t$ å¤§äº 1024 æ—¶ï¼Œæˆ‘ä»¬æ— æ³•ç›´æ¥è®¡ç®— $p<em>\theta(x_t|x</em>{&lt;t})$ã€‚</p><p>ç›¸åï¼Œåºåˆ—é€šå¸¸è¢«åˆ†è§£æˆç­‰äºæ¨¡å‹æœ€å¤§è¾“å…¥å¤§å°çš„å­åºåˆ—ã€‚å¦‚æœæ¨¡å‹çš„æœ€å¤§è¾“å…¥å¤§å°æ˜¯ $k$ï¼Œé‚£ä¹ˆæˆ‘ä»¬é€šè¿‡åªæ¡ä»¶åŒ–å‰ $k-1$ ä¸ªæ ‡è®°ï¼ˆè€Œä¸æ˜¯æ•´ä¸ªä¸Šä¸‹æ–‡ï¼‰æ¥è¿‘ä¼¼è®¡ç®—ä¸€ä¸ªæ ‡è®° $x_t$ çš„ä¼¼ç„¶ã€‚åœ¨è¯„ä¼°æ¨¡å‹åºåˆ—çš„å›°æƒ‘åº¦æ—¶ï¼Œä¸€ç§è¯±äººä½†æ¬¡ä¼˜çš„æ–¹æ³•æ˜¯å°†åºåˆ—åˆ†è§£æˆä¸ç›¸äº¤çš„å—ï¼Œå¹¶ç‹¬ç«‹åœ°ç´¯åŠ æ¯ä¸ªæ®µçš„åˆ†è§£å¯¹æ•°ä¼¼ç„¶ã€‚</p><img width="600" alt="Suboptimal PPL not taking advantage of full available context" src="https://huggingface.co/datasets/huggingface/documentation-images/resolve/main/ppl_chunked.gif"><p>è¿™ç§è®¡ç®—å¾ˆå¿«ï¼Œå› ä¸ºæ¯ä¸ªæ®µçš„å›°æƒ‘åº¦å¯ä»¥åœ¨ä¸€æ¬¡å‰å‘ä¼ é€’ä¸­è®¡ç®—å‡ºæ¥ï¼Œä½†è¿™æ˜¯ä¸€ä¸ªè¾ƒå·®çš„å®Œå…¨åˆ†è§£å›°æƒ‘åº¦çš„è¿‘ä¼¼ï¼Œå¹¶ä¸”é€šå¸¸ä¼šäº§ç”Ÿæ›´é«˜ï¼ˆæ›´å·®ï¼‰çš„ PPLï¼Œå› ä¸ºæ¨¡å‹åœ¨å¤§å¤šæ•°é¢„æµ‹æ­¥éª¤ä¸­çš„ä¸Šä¸‹æ–‡è¾ƒå°‘ã€‚</p><p>ç›¸åï¼Œåº”è¯¥ä½¿ç”¨æ»‘åŠ¨çª—å£ç­–ç•¥æ¥è¯„ä¼°å›ºå®šé•¿åº¦æ¨¡å‹çš„ PPLã€‚è¿™æ¶‰åŠåˆ°é‡å¤æ»‘åŠ¨ä¸Šä¸‹æ–‡çª—å£ï¼Œä½¿æ¨¡å‹åœ¨åšå‡ºæ¯ä¸ªé¢„æµ‹æ—¶æ‹¥æœ‰æ›´å¤šçš„ä¸Šä¸‹æ–‡ã€‚</p><img width="600" alt="Sliding window PPL taking advantage of all available context" src="https://huggingface.co/datasets/huggingface/documentation-images/resolve/main/ppl_sliding.gif"><ol><li><p><strong>æ— é™ä¸Šä¸‹æ–‡åˆ†è§£ï¼š</strong> å¦‚æœæ²¡æœ‰å¯¹æ¨¡å‹è¾“å…¥é•¿åº¦çš„é™åˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ¯ä¸€æ­¥éƒ½ä½¿ç”¨æ•´ä¸ªå‰åºå­åºåˆ—æ¥é¢„æµ‹ä¸‹ä¸€ä¸ªæ ‡è®°ã€‚è¿™æ ·å¯ä»¥æœ€å‡†ç¡®åœ°è¯„ä¼°æ¨¡å‹çš„æ€§èƒ½ï¼Œå› ä¸ºæ¯æ¬¡é¢„æµ‹éƒ½è€ƒè™‘äº†æ‰€æœ‰å…ˆå‰çš„ä¿¡æ¯ã€‚</p></li><li><p><strong>å›ºå®šé•¿åº¦é™åˆ¶ï¼š</strong> å®é™…ä¸­ï¼Œå¤§å¤šæ•°æ¨¡å‹å¦‚ GPT-2 æœ‰å›ºå®šçš„è¾“å…¥é•¿åº¦é™åˆ¶ï¼ˆä¾‹å¦‚ 1024 ä¸ªæ ‡è®°ï¼‰ã€‚å½“åºåˆ—é•¿åº¦è¶…è¿‡è¿™ä¸ªé™åˆ¶æ—¶ï¼Œä¸èƒ½ç›´æ¥è®¡ç®—æ¯ä¸ªæ ‡è®°çš„æ¡ä»¶æ¦‚ç‡ï¼Œå› ä¸ºä¸èƒ½å°†æ•´ä¸ªåºåˆ—ä½œä¸ºæ¡ä»¶ã€‚</p></li><li><p><strong>åˆ†å—è¿‘ä¼¼ï¼š</strong> ä¸€ç§å¤„ç†é•¿åºåˆ—çš„æ–¹æ³•æ˜¯å°†åºåˆ—åˆ†è§£æˆå¤šä¸ªä¸æ¨¡å‹æœ€å¤§è¾“å…¥é•¿åº¦ç›¸ç­‰çš„å­åºåˆ—ã€‚æ¯ä¸ªå­åºåˆ—å•ç‹¬è¯„ä¼°ï¼Œä½†è¿™ç§æ–¹æ³•å¯èƒ½ä¼šå› ä¸ºæ²¡æœ‰ä½¿ç”¨å®Œæ•´çš„ä¸Šä¸‹æ–‡è€Œå¯¼è‡´æ›´é«˜çš„å›°æƒ‘åº¦ã€‚</p></li><li><p><strong>æ»‘åŠ¨çª—å£ç­–ç•¥ï¼š</strong> ä¸ºäº†æ›´å¥½åœ°åˆ©ç”¨å¯ç”¨çš„ä¸Šä¸‹æ–‡ï¼Œå¯ä»¥ä½¿ç”¨æ»‘åŠ¨çª—å£ç­–ç•¥ã€‚è¿™ç§æ–¹æ³•é€šè¿‡ä¸æ–­ç§»åŠ¨ä¸Šä¸‹æ–‡çª—å£æ¥å°è¯•åœ¨æ¯æ¬¡é¢„æµ‹æ—¶ä¸ºæ¨¡å‹æä¾›æ›´å¤šçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œä»è€Œæ›´æ¥è¿‘äºä½¿ç”¨å®Œæ•´ä¸Šä¸‹æ–‡çš„ç†æƒ³æƒ…å†µã€‚</p></li><li><p><strong>è·¨æ­¥æ»‘åŠ¨çª—å£ï¼š</strong> ä¸€ä¸ªå®é™…çš„æŠ˜ä¸­æ–¹æ³•æ˜¯ä½¿ç”¨è·¨æ­¥æ»‘åŠ¨çª—å£ï¼Œè¿™æ ·å¯ä»¥åœ¨ä¿è¯ä¸€å®šæ•ˆç‡çš„åŒæ—¶ï¼Œä¸ºæ¯æ¬¡æ¨¡å‹é¢„æµ‹æä¾›è¶³å¤Ÿçš„ä¸Šä¸‹æ–‡ï¼Œä»è€Œæ”¹å–„å›°æƒ‘åº¦çš„è®¡ç®—å’Œæ¨¡å‹é¢„æµ‹çš„å‡†ç¡®æ€§ã€‚</p></li></ol><p>è¿™äº›æ–¹æ³•éƒ½æ˜¯ä¸ºäº†è§£å†³å› æ¨¡å‹è¾“å…¥é•¿åº¦é™åˆ¶è€Œä¸èƒ½ç›´æ¥è¯„ä¼°æ•´ä¸ªåºåˆ—çš„é—®é¢˜ï¼Œè¯•å›¾é€šè¿‡ä¸åŒçš„æŠ€æœ¯ä½¿è¯„ä¼°æ›´åŠ å‡†ç¡®ï¼ŒåŒæ—¶è€ƒè™‘åˆ°è®¡ç®—èµ„æºçš„æœ‰æ•ˆä½¿ç”¨ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> NLP Insights </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Language Modeling </tag>
            
            <tag> Perplexity </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€Pythoné¢˜è§£ã€‘2834. æ‰¾å‡ºç¾ä¸½æ•°ç»„çš„æœ€å°å’Œ</title>
      <link href="/2024/03/08/Code%20Chronicles/2834.%20%E6%89%BE%E5%87%BA%E7%BE%8E%E4%B8%BD%E6%95%B0%E7%BB%84%E7%9A%84%E6%9C%80%E5%B0%8F%E5%92%8C/"/>
      <url>/2024/03/08/Code%20Chronicles/2834.%20%E6%89%BE%E5%87%BA%E7%BE%8E%E4%B8%BD%E6%95%B0%E7%BB%84%E7%9A%84%E6%9C%80%E5%B0%8F%E5%92%8C/</url>
      
        <content type="html"><![CDATA[<h1 id="2834-æ‰¾å‡ºç¾ä¸½æ•°ç»„çš„æœ€å°å’Œ"><a href="#2834-æ‰¾å‡ºç¾ä¸½æ•°ç»„çš„æœ€å°å’Œ" class="headerlink" title="2834. æ‰¾å‡ºç¾ä¸½æ•°ç»„çš„æœ€å°å’Œ"></a>2834. æ‰¾å‡ºç¾ä¸½æ•°ç»„çš„æœ€å°å’Œ</h1><blockquote><p>Problem: <a href="https://leetcode.cn/problems/find-the-minimum-possible-sum-of-a-beautiful-array/description/">2834. æ‰¾å‡ºç¾ä¸½æ•°ç»„çš„æœ€å°å’Œ</a></p></blockquote><h2 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h2><p>ç»™å®šä¸¤ä¸ªæ­£æ•´æ•° <code>n</code> å’Œ <code>target</code>ï¼Œç›®æ ‡æ˜¯æ‰¾åˆ°ä¸€ä¸ªé•¿åº¦ä¸º <code>n</code> çš„æ•°ç»„ï¼Œæ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š</p><ul><li>æ•°ç»„ç”±ä¸¤ä¸¤ä¸åŒçš„æ­£æ•´æ•°ç»„æˆã€‚</li><li>ä¸å­˜åœ¨ä¸¤ä¸ªä¸åŒä¸‹æ ‡ <code>i</code> å’Œ <code>j</code> ä½¿å¾— <code>nums[i] + nums[j] == target</code>ã€‚<br>è¿”å›ç¬¦åˆæ¡ä»¶çš„ç¾ä¸½æ•°ç»„æ‰€å¯èƒ½å…·å¤‡çš„æœ€å°å’Œï¼Œå¹¶å¯¹ç»“æœè¿›è¡Œ <code>10^9 + 7</code> å–æ¨¡ã€‚</li></ul><h3 id="æµ‹è¯•ç”¨ä¾‹"><a href="#æµ‹è¯•ç”¨ä¾‹" class="headerlink" title="æµ‹è¯•ç”¨ä¾‹"></a>æµ‹è¯•ç”¨ä¾‹</h3><p>ç¤ºä¾‹ 1ï¼š</p><ul><li>è¾“å…¥ï¼šn = 2, target = 3</li><li>è¾“å‡ºï¼š4</li></ul><p>ç¤ºä¾‹ 2ï¼š</p><ul><li>è¾“å…¥ï¼šn = 3, target = 3</li><li>è¾“å‡ºï¼š8</li></ul><p>ç¤ºä¾‹ 3ï¼š</p><ul><li>è¾“å…¥ï¼šn = 1, target = 1</li><li>è¾“å‡ºï¼š1</li></ul><h2 id="åŸå§‹æ€è·¯"><a href="#åŸå§‹æ€è·¯" class="headerlink" title="åŸå§‹æ€è·¯"></a>åŸå§‹æ€è·¯</h2><h3 id="æ–¹æ¡ˆ"><a href="#æ–¹æ¡ˆ" class="headerlink" title="æ–¹æ¡ˆ"></a>æ–¹æ¡ˆ</h3><p>åˆå§‹æ–¹æ¡ˆæ˜¯ä»æœ€å°çš„æ•°å­—å¼€å§‹ï¼Œé€ä¸ªæ£€æŸ¥æ¯ä¸ªæ•°å­—æ˜¯å¦å¯ä»¥è¢«æ·»åŠ åˆ°æ•°ç»„ä¸­ï¼ŒåŒæ—¶ç¡®ä¿ä¸ä¼šå­˜åœ¨ä¸¤ä¸ªæ•°å­—ä¹‹å’Œç­‰äº <code>target</code>ã€‚</p><ul><li>ä» <code>1</code> å¼€å§‹é€ä¸ªå°è¯•æ·»åŠ æ•°å­—åˆ°æ•°ç»„ã€‚</li><li>å¯¹äºæ¯ä¸ªæ•°å­—ï¼Œæ£€æŸ¥æ˜¯å¦ä¸æ•°ç»„ä¸­å·²æœ‰çš„æ•°å­—ç›¸åŠ ä¼šå¾—åˆ° <code>target</code>ã€‚</li><li>å¦‚æœä¸ä¼šï¼Œå°†å…¶æ·»åŠ åˆ°æ•°ç»„ä¸­ã€‚</li><li>ç»§ç»­æ­¤è¿‡ç¨‹ï¼Œç›´åˆ°æ•°ç»„é•¿åº¦è¾¾åˆ° <code>n</code>ã€‚</li></ul><h3 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">minimumPossibleSum</span>(<span class="params">n, target</span>):</span><br><span class="line">    selected_nums = <span class="built_in">set</span>([<span class="number">1</span>])</span><br><span class="line">    total_sum = <span class="number">1</span></span><br><span class="line">    current_num = <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">len</span>(selected_nums) &lt; n:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">all</span>((current_num + num != target) <span class="keyword">for</span> num <span class="keyword">in</span> selected_nums):</span><br><span class="line">            selected_nums.add(current_num)</span><br><span class="line">            total_sum += current_num</span><br><span class="line">        current_num += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> total_sum % (<span class="number">10</span>**<span class="number">9</span> + <span class="number">7</span>)</span><br></pre></td></tr></tbody></table></figure><h3 id="å¤æ‚åº¦åˆ†æ"><a href="#å¤æ‚åº¦åˆ†æ" class="headerlink" title="å¤æ‚åº¦åˆ†æ"></a>å¤æ‚åº¦åˆ†æ</h3><ul><li>æ—¶é—´å¤æ‚åº¦ï¼šO(n^2)ï¼Œå› ä¸ºæ¯ä¸ªæ•°å­—çš„æ·»åŠ éƒ½éœ€è¦éå†å·²é€‰æ‹©çš„æ•°å­—é›†åˆã€‚</li><li>ç©ºé—´å¤æ‚åº¦ï¼šO(n)ï¼Œç”¨äºå­˜å‚¨é€‰æ‹©çš„æ•°å­—é›†åˆã€‚</li></ul><h2 id="è´ªå¿ƒä¼˜åŒ–"><a href="#è´ªå¿ƒä¼˜åŒ–" class="headerlink" title="è´ªå¿ƒä¼˜åŒ–"></a>è´ªå¿ƒä¼˜åŒ–</h2><h3 id="æ–¹æ¡ˆ-1"><a href="#æ–¹æ¡ˆ-1" class="headerlink" title="æ–¹æ¡ˆ"></a>æ–¹æ¡ˆ</h3><ul><li><p><strong>ä¼˜åŒ–ç­–ç•¥</strong>ï¼š</p><ul><li><strong>é¿å…é›†åˆçš„ä½¿ç”¨</strong>ï¼š<ul><li>å¼•å…¥â€œé¿å…â€é›†åˆï¼Œå­˜å‚¨æ‰€æœ‰ä¸å·²é€‰æ•°å­—ç›¸åŠ å¾—åˆ° <code>target</code> çš„æ•°å­—ã€‚</li><li>è¿™æ ·å¯ä»¥å¿«é€Ÿæ£€æŸ¥æ–°æ•°å­—æ˜¯å¦ä¼šå¯¼è‡´å’Œä¸º <code>target</code> çš„æƒ…å†µã€‚</li></ul></li><li><strong>ç›´æ¥æ£€æŸ¥</strong>ï¼š<ul><li>æ¯æ¬¡é€‰æ‹©ä¸€ä¸ªæ–°æ•°å­—æ—¶ï¼Œä»…æ£€æŸ¥å®ƒæ˜¯å¦åœ¨â€œé¿å…â€é›†åˆä¸­ã€‚</li><li>ä¸åœ¨é›†åˆä¸­çš„æ•°å­—è¢«è®¤ä¸ºæ˜¯å®‰å…¨çš„ï¼Œå¯ä»¥ç›´æ¥æ·»åŠ ã€‚</li></ul></li><li><strong>åŠ¨æ€æ›´æ–°é¿å…é›†åˆ</strong>ï¼š<ul><li>å½“æ–°æ•°å­—è¢«æ·»åŠ åˆ°ç¾ä¸½æ•°ç»„æ—¶ï¼Œç›¸åº”çš„ <code>target - æ–°æ•°å­—</code> ä¹Ÿè¢«æ·»åŠ åˆ°â€œé¿å…â€é›†åˆä¸­ã€‚</li><li>è¿™ç¡®ä¿ä»»ä½•å¯èƒ½ä¸æ–°æ•°å­—ç»„æˆ <code>target</code> çš„æ•°å­—åœ¨æœªæ¥éƒ½ä¼šè¢«é¿å…ã€‚</li></ul></li></ul></li><li><p><strong>ä¼˜åŒ–åçš„æ—¶é—´å¤æ‚åº¦</strong>ï¼š</p><ul><li>æ¯ä¸ªæ•°å­—åªéœ€è¿›è¡Œä¸€æ¬¡é›†åˆæ£€æŸ¥ã€‚</li><li>æ—¶é—´å¤æ‚åº¦é™ä½ä¸º O(n)ï¼Œæ˜¾è‘—æé«˜äº†ç®—æ³•æ•ˆç‡ã€‚</li></ul></li></ul><h3 id="ä»£ç -1"><a href="#ä»£ç -1" class="headerlink" title="ä»£ç "></a>ä»£ç </h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">minimumPossibleSum_optimized</span>(<span class="params">n, target</span>):</span><br><span class="line">    selected_nums = <span class="built_in">set</span>()</span><br><span class="line">    avoid_nums = <span class="built_in">set</span>()</span><br><span class="line">    total_sum = <span class="number">0</span></span><br><span class="line">    current_num = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">len</span>(selected_nums) &lt; n:</span><br><span class="line">        <span class="keyword">if</span> current_num <span class="keyword">not</span> <span class="keyword">in</span> avoid_nums:</span><br><span class="line">            selected_nums.add(current_num)</span><br><span class="line">            total_sum += current_num</span><br><span class="line">            avoid_nums.add(target - current_num)</span><br><span class="line">        current_num += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> total_sum % (<span class="number">10</span>**<span class="number">9</span> + <span class="number">7</span>)</span><br></pre></td></tr></tbody></table></figure><h3 id="å¤æ‚åº¦åˆ†æ-1"><a href="#å¤æ‚åº¦åˆ†æ-1" class="headerlink" title="å¤æ‚åº¦åˆ†æ"></a>å¤æ‚åº¦åˆ†æ</h3><ul><li>æ—¶é—´å¤æ‚åº¦ï¼šO(n)ï¼Œå› ä¸ºæ¯ä¸ªæ•°å­—åªéœ€æ£€æŸ¥ä¸€æ¬¡ã€‚</li><li>ç©ºé—´å¤æ‚åº¦ï¼šO(n)ï¼Œç”¨äºå­˜å‚¨é€‰æ‹©çš„æ•°å­—å’Œé¿å…æ•°å­—é›†åˆã€‚</li></ul><h2 id="æ•°å­¦æ–¹æ³•"><a href="#æ•°å­¦æ–¹æ³•" class="headerlink" title="æ•°å­¦æ–¹æ³•"></a>æ•°å­¦æ–¹æ³•</h2><h3 id="æ–¹æ¡ˆ-2"><a href="#æ–¹æ¡ˆ-2" class="headerlink" title="æ–¹æ¡ˆ"></a>æ–¹æ¡ˆ</h3><p>é’ˆå¯¹ä¸Šè¿°é—®é¢˜ï¼Œæˆ‘ä»¬é‡‡ç”¨äº†ä¸€ç§æ›´é«˜æ•ˆçš„æ•°å­¦æ–¹æ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚è¯¥æ–¹æ³•é€šè¿‡åˆ†æé—®é¢˜çš„æ•°å­¦æœ¬è´¨ï¼Œå‡å°‘äº†å¿…è¦çš„è®¡ç®—é‡ï¼Œç‰¹åˆ«é€‚ç”¨äºå¤„ç†å¤§è§„æ¨¡æ•°æ®ã€‚</p><ol><li><p><strong>é—®é¢˜åˆ†è§£</strong>ï¼š</p><ul><li>é¦–å…ˆï¼Œæˆ‘ä»¬å°†é—®é¢˜åˆ†è§£ä¸ºä¸¤éƒ¨åˆ†ã€‚ç”±äºæ•°ç»„ä¸­çš„æ•°å­—éƒ½æ˜¯å”¯ä¸€çš„ï¼Œä¸”ä¸¤ä¸ªä¸åŒçš„æ•°å­—ä¹‹å’Œä¸èƒ½ç­‰äº <code>target</code>ï¼Œæˆ‘ä»¬é¦–å…ˆä»æœ€å°çš„æ•°å­—å¼€å§‹é€‰æ‹©ï¼Œç›´åˆ°æˆ‘ä»¬ä¸èƒ½å†é€‰æ‹©æ›´å¤šçš„æ•°å­—è€Œä¸è¿åå’Œçš„è§„åˆ™ã€‚</li></ul></li><li><p><strong>é€‰æ‹©å‰åŠéƒ¨åˆ†çš„æ•°å­—</strong>ï¼š</p><ul><li>åœ¨ <code>1</code> åˆ° <code>target-1</code> çš„èŒƒå›´å†…ï¼ŒæŸäº›æ•°å­—ä¸èƒ½åŒæ—¶å‡ºç°ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ <code>target</code> æ˜¯ <code>6</code>ï¼Œåˆ™ <code>1</code> å’Œ <code>5</code>ã€<code>2</code> å’Œ <code>4</code> ä¸èƒ½åŒæ—¶å‡ºç°ï¼Œå› ä¸ºå®ƒä»¬çš„å’Œç­‰äº <code>6</code>ã€‚ä½†æ˜¯ï¼Œ<code>3</code>ï¼ˆå½“ <code>target</code> æ˜¯å¶æ•°ï¼‰æˆ– <code>3</code> å’Œ <code>2</code>ï¼ˆå½“ <code>target</code> æ˜¯å¥‡æ•°ï¼‰æ˜¯å¯ä»¥è¢«é€‰æ‹©çš„ã€‚</li><li>è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥è‡ªç”±é€‰æ‹©ä» <code>1</code> åˆ° <code>m</code> çš„æ•°å­—ï¼Œå…¶ä¸­ <code>m = min(âŒŠtarget/2âŒ‹, n)</code>ã€‚å¯¹äºè¿™éƒ¨åˆ†æ•°å­—ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ç­‰å·®æ•°åˆ—çš„æ±‚å’Œå…¬å¼æ¥è®¡ç®—å®ƒä»¬çš„æ€»å’Œï¼Œå³ <code>m * (m + 1) / 2</code>ã€‚</li></ul></li><li><p><strong>é€‰æ‹©ååŠéƒ¨åˆ†çš„æ•°å­—</strong>ï¼š</p><ul><li>ä¸€æ—¦æˆ‘ä»¬é€‰æ‹©äº†å‰ <code>m</code> ä¸ªæ•°å­—ï¼Œå‰©ä¸‹éœ€è¦é€‰æ‹©çš„æ•°å­—çš„æ•°é‡å°±æ˜¯ <code>n - m</code>ã€‚ç”±äºæˆ‘ä»¬å·²ç»é€‰æ‹©äº† <code>1</code> åˆ° <code>m</code>ï¼Œæˆ‘ä»¬ç°åœ¨éœ€è¦ä» <code>target</code> å¼€å§‹é€‰æ‹©å‰©ä¸‹çš„æ•°å­—ã€‚</li><li>å¦‚æœ <code>n</code> å¤§äº <code>m</code>ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†ä» <code>target</code> å¼€å§‹è¿ç»­é€‰æ‹© <code>n - m</code> ä¸ªæ•°å­—ã€‚è¿™äº›æ•°å­—çš„æ€»å’Œå¯ä»¥ç”¨ç­‰å·®æ•°åˆ—çš„æ±‚å’Œå…¬å¼æ¥è®¡ç®—ï¼Œå…¬å¼ä¸ºï¼š<code>(2 * target + n - m - 1) * (n - m) / 2</code>ã€‚</li></ul></li><li><p><strong>è®¡ç®—æ€»å’Œå¹¶å–æ¨¡</strong>ï¼š</p><ul><li>æˆ‘ä»¬å°†ä¸¤éƒ¨åˆ†çš„å’Œç›¸åŠ ï¼Œå¹¶å¯¹ç»“æœè¿›è¡Œ <code>10^9 + 7</code> å–æ¨¡ï¼Œä»¥å¾—åˆ°æœ€ç»ˆç­”æ¡ˆã€‚</li></ul></li></ol><h3 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h3><ul><li>ç¬¬ä¸€éƒ¨åˆ†å’Œï¼šä» <code>1</code> åˆ° <code>min(target // 2, n)</code> çš„å’Œã€‚</li><li>ç¬¬äºŒéƒ¨åˆ†å’Œï¼ˆå¦‚æœéœ€è¦ï¼‰ï¼šä» <code>target</code> å¼€å§‹ï¼Œé€‰æ‹©çš„ <code>n - min(target // 2, n)</code> ä¸ªæ•°å­—çš„å’Œã€‚</li><li>å°†è¿™ä¸¤éƒ¨åˆ†çš„å’Œç›¸åŠ ï¼Œå³å¾—åˆ°ç¬¦åˆæ¡ä»¶çš„ç¾ä¸½æ•°ç»„çš„æœ€å°å’Œã€‚</li></ul><ol><li><p><strong>é€‰æ‹©å°äº <code>target // 2</code> çš„æ•°å­—</strong>ï¼š</p><ul><li>å½“æˆ‘ä»¬ä» 1 å¼€å§‹é€æ¸å¢åŠ æ•°å­—ï¼Œç›´åˆ° <code>target // 2</code>ï¼Œè¿™äº›æ•°å­—ä¸å¯èƒ½ä¸æ•°ç»„ä¸­çš„å…¶ä»–æ•°å­—ç›¸åŠ å¾—åˆ° <code>target</code>ã€‚</li><li>ä¾‹å¦‚ï¼Œå¦‚æœ <code>target</code> æ˜¯ 10ï¼Œé‚£ä¹ˆ <code>target // 2</code> æ˜¯ 5ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ1 åˆ° 5 ä¹‹é—´çš„ä»»ä½•ä¸¤ä¸ªæ•°å­—ç›¸åŠ éƒ½ä¸ä¼šç­‰äº 10ã€‚</li><li>å› æ­¤ï¼Œè¿™éƒ¨åˆ†çš„é€‰æ‹©æ˜¯å®‰å…¨çš„ï¼Œå¹¶ä¸”ç”±äºæˆ‘ä»¬éœ€è¦æœ€å°å’Œï¼Œæ‰€ä»¥æˆ‘ä»¬ä» 1 å¼€å§‹é€ä¸€å¢åŠ ã€‚</li></ul></li><li><p>**å½“ <code>n</code> å¤§äº <code>target // 2</code>**ï¼š</p><ul><li>å¦‚æœ <code>n</code> å¤§äº <code>target // 2</code>ï¼Œè¿™æ„å‘³ç€ä»…ä»…é€‰æ‹©å°äº <code>target // 2</code> çš„æ•°å­—ä¸è¶³ä»¥å¡«æ»¡æ•°ç»„ã€‚</li><li>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦ç»§ç»­é€‰æ‹©æ›´å¤šçš„æ•°å­—ï¼Œä½†ä¸ºäº†é¿å…å’Œä¸º <code>target</code> çš„ç»„åˆï¼Œæˆ‘ä»¬éœ€è¦ä» <code>target</code> æœ¬èº«å¼€å§‹é€‰æ‹©ã€‚</li><li>æˆ‘ä»¬ç»§ç»­é€ä¸€å¢åŠ ï¼Œç›´åˆ°æ•°ç»„é•¿åº¦è¾¾åˆ° <code>n</code>ã€‚</li></ul></li><li><p><strong>è®¡ç®—æ€»å’Œ</strong>ï¼š</p><ul><li>ç¬¬ä¸€éƒ¨åˆ†æ˜¯ä» 1 åˆ° <code>min(target // 2, n)</code> çš„å’Œã€‚</li><li>ç¬¬äºŒéƒ¨åˆ†ï¼ˆå¦‚æœéœ€è¦ï¼‰æ˜¯ä» <code>target</code> å¼€å§‹ï¼Œé€‰æ‹©å‰©ä¸‹çš„ <code>n - min(target // 2, n)</code> ä¸ªæ•°å­—ã€‚</li><li>æœ€åï¼Œå°†è¿™ä¸¤éƒ¨åˆ†çš„å’ŒåŠ èµ·æ¥ï¼Œå°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„æœ€å°å’Œã€‚</li></ul></li></ol><p>è¿™æ˜¯ä¸€ä¸ªé€šè¿‡æ•°å­¦æ–¹æ³•æ¥è§£å†³é—®é¢˜çš„å…¸å‹ä¾‹å­ï¼Œå®ƒé¿å…äº†å¤æ‚çš„ç¼–ç¨‹é€»è¾‘ï¼Œæä¾›äº†ä¸€ç§æ›´ç®€æ´é«˜æ•ˆçš„è§£å†³æ–¹æ¡ˆã€‚</p><h3 id="ä»£ç -2"><a href="#ä»£ç -2" class="headerlink" title="ä»£ç "></a>ä»£ç </h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">minimumPossibleSum_math_approach</span>(<span class="params">n, target</span>):</span><br><span class="line">    MOD = <span class="number">10</span>**<span class="number">9</span> + <span class="number">7</span></span><br><span class="line">    m = <span class="built_in">min</span>(target // <span class="number">2</span>, n)</span><br><span class="line">    first_half_sum = m * (m + <span class="number">1</span>) // <span class="number">2</span></span><br><span class="line">    remaining = n - m</span><br><span class="line">    second_half_sum = (<span class="number">2</span> * target + remaining - <span class="number">1</span>) * remaining // <span class="number">2</span></span><br><span class="line">    <span class="keyword">return</span> (first_half_sum + second_half_sum) % MOD</span><br></pre></td></tr></tbody></table></figure><h3 id="å¤æ‚åº¦åˆ†æ-2"><a href="#å¤æ‚åº¦åˆ†æ-2" class="headerlink" title="å¤æ‚åº¦åˆ†æ"></a>å¤æ‚åº¦åˆ†æ</h3><ul><li>æ—¶é—´å¤æ‚åº¦ï¼šO(1)ï¼Œå› ä¸ºç»“æœæ˜¯é€šè¿‡ç›´æ¥è®¡ç®—å¾—å‡ºçš„ã€‚</li><li>ç©ºé—´å¤æ‚åº¦ï¼šO(1)ï¼Œåªä½¿ç”¨äº†å›ºå®šæ•°é‡çš„å˜é‡ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> Code Chronicles </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> Leetcode </tag>
            
            <tag> æ¯æ—¥ä¸€é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è·Ÿç€GPTè€å¸ˆå­¦å°èŠï¼šå¦‚ä½•åšä¸€ä¸ªå¥½çš„æ§å“</title>
      <link href="/2024/03/05/Life%20Reflections/%E8%B7%9F%E7%9D%80GPT%E8%80%81%E5%B8%88%E5%AD%A6%E5%B0%8F%E8%81%8A/"/>
      <url>/2024/03/05/Life%20Reflections/%E8%B7%9F%E7%9D%80GPT%E8%80%81%E5%B8%88%E5%AD%A6%E5%B0%8F%E8%81%8A/</url>
      
        <content type="html"><![CDATA[<p>è‹±è¯­å°èŠ (small talk) æ˜¯æ—¥å¸¸ç”Ÿæ´»ä¸­ä¸å¯æˆ–ç¼ºçš„äº¤æµå½¢å¼ï¼Œå®ƒä¸ä»…æœ‰åŠ©äºæ‰“ç ´æ²‰é»˜ï¼Œä¹Ÿèƒ½åœ¨è½»æ¾çš„æ°›å›´ä¸­ä¿ƒè¿›ç†è§£å’Œå‹è°Šã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†ç»“åˆ 10 ä¸ªä¸»é¢˜ï¼Œæä¾›ç›¸å…³çš„è¯æ±‡ã€çŸ­è¯­ï¼Œå¹¶åˆ†äº«ç”Ÿæ´»æ•…äº‹çš„å¼€åœºç™½ã€‚åŒæ—¶ï¼Œå­¦ä¹ å¦‚ä½•æˆä¸ºä¸€åä¼˜ç§€çš„æ§å“ï¼Œé€šè¿‡æé—®å’Œæ¥è¯ï¼Œè®©å¯¹è¯æ›´åŠ æµç•…å’Œæœ‰è¶£ã€‚</p><h3 id="1-æ—…æ¸¸ä½“éªŒ-Travel-Experiences"><a href="#1-æ—…æ¸¸ä½“éªŒ-Travel-Experiences" class="headerlink" title="1. æ—…æ¸¸ä½“éªŒ (Travel Experiences)"></a>1. æ—…æ¸¸ä½“éªŒ (Travel Experiences)</h3><ul><li>è¯æ±‡ï¼šItinerary (è¡Œç¨‹), off the beaten path (äººè¿¹ç½•è‡³), picturesque (å¦‚ç”»çš„), excursion (è¿œè¶³), landmark (åœ°æ ‡)ã€‚</li><li>çŸ­è¯­ï¼šCultural immersion (æ–‡åŒ–æ²‰æµ¸), travel off the beaten path (èµ°ååƒ»çš„è·¯), soak up the atmosphere (æ²‰æµ¸åœ¨æ°”æ°›ä¸­)ã€‚</li><li>æ•…äº‹å¼€åœºï¼š â€œOne place I really enjoyed visiting wasâ€¦â€ (æˆ‘éå¸¸å–œæ¬¢å»çš„ä¸€ä¸ªåœ°æ–¹æ˜¯â€¦)</li><li>è¿½é—®ï¼š â€œThat sounds amazing! What was the most unforgettable part of your trip?â€ (å¬èµ·æ¥å¤ªæ£’äº†ï¼ä½ æ—…è¡Œä¸­æœ€éš¾å¿˜çš„éƒ¨åˆ†æ˜¯ä»€ä¹ˆï¼Ÿ)</li><li>æ¥è¯ï¼š â€œIâ€™ve heard that place is beautiful. Did you take a lot of photos?â€ (æˆ‘å¬è¯´é‚£ä¸ªåœ°æ–¹å¾ˆç¾ã€‚ä½ æ‹äº†å¾ˆå¤šç…§ç‰‡å—ï¼Ÿ)</li></ul><h3 id="2-é£Ÿç‰©ä¸ç¾é£Ÿ-Food-and-Cuisine"><a href="#2-é£Ÿç‰©ä¸ç¾é£Ÿ-Food-and-Cuisine" class="headerlink" title="2. é£Ÿç‰©ä¸ç¾é£Ÿ (Food and Cuisine)"></a>2. é£Ÿç‰©ä¸ç¾é£Ÿ (Food and Cuisine)</h3><ul><li>è¯æ±‡ï¼šGastronomy (ç¾é£Ÿå­¦), palate (å‘³è§‰), savory (å¯å£çš„), gourmet (ç¾é£Ÿå®¶), culinary (çƒ¹é¥ªçš„)ã€‚</li><li>çŸ­è¯­ï¼šAcquired taste (åå¤©å“å‘³), comfort food (å®‰æ…°é£Ÿç‰©), fusion cuisine (èåˆèœè‚´), culinary delights (çƒ¹é¥ªä¹è¶£)ã€‚</li><li>æ•…äº‹å¼€åœºï¼š â€œI recently tried cookingâ€¦â€ (æˆ‘æœ€è¿‘å°è¯•çƒ¹é¥ªâ€¦)</li><li>è¿½é—®ï¼š â€œOh, how did it turn out? What ingredients did you use?â€ (å“¦ï¼Œç»“æœæ€æ ·ï¼Ÿä½ ç”¨äº†å“ªäº›é£Ÿæï¼Ÿ)</li><li>æ¥è¯ï¼š â€œI love trying new recipes too. Do you have any recommendations?â€ (æˆ‘ä¹Ÿå–œæ¬¢å°è¯•æ–°é£Ÿè°±ã€‚ä½ æœ‰ä»€ä¹ˆæ¨èå—ï¼Ÿ)</li></ul><h3 id="3-çˆ±å¥½ä¸å…´è¶£-Hobbies-and-Interests"><a href="#3-çˆ±å¥½ä¸å…´è¶£-Hobbies-and-Interests" class="headerlink" title="3. çˆ±å¥½ä¸å…´è¶£ (Hobbies and Interests)"></a>3. çˆ±å¥½ä¸å…´è¶£ (Hobbies and Interests)</h3><ul><li>è¯æ±‡ï¼šAmateur (ä¸šä½™çˆ±å¥½è€…), pastime (æ¶ˆé£), dabble (æ¶‰çŒ), proficiency (ç†Ÿç»ƒ), knack (è¯€çª)ã€‚</li><li>çŸ­è¯­ï¼šPursue a hobby (è¿½æ±‚ä¸€ä¸ªçˆ±å¥½), hone skills (ç£¨ç»ƒæŠ€èƒ½), leisure activities (ä¼‘é—²æ´»åŠ¨), broaden horizons (å¼€é˜”è§†é‡)ã€‚</li><li>æ•…äº‹å¼€åœºï¼š â€œIn my free time, I like toâ€¦â€ (åœ¨æˆ‘ç©ºé—²çš„æ—¶å€™ï¼Œæˆ‘å–œæ¬¢â€¦)</li><li>è¿½é—®ï¼š â€œThatâ€™s interesting! How did you get started with that hobby?â€ (çœŸæœ‰è¶£ï¼ä½ æ˜¯æ€ä¹ˆå¼€å§‹è¿™ä¸ªçˆ±å¥½çš„ï¼Ÿ)</li><li>æ¥è¯ï¼š â€œIt sounds like a great way to relax. Iâ€™ve been looking for a new hobby myself.â€ (å¬èµ·æ¥æ˜¯æ”¾æ¾çš„å¥½æ–¹å¼ã€‚æˆ‘è‡ªå·±ä¹Ÿåœ¨æ‰¾æ–°çš„çˆ±å¥½ã€‚)</li></ul><h3 id="4-ç”µå½±ã€ç”µè§†èŠ‚ç›®å’Œä¹¦ç±-Movies-TV-Shows-and-Books"><a href="#4-ç”µå½±ã€ç”µè§†èŠ‚ç›®å’Œä¹¦ç±-Movies-TV-Shows-and-Books" class="headerlink" title="4. ç”µå½±ã€ç”µè§†èŠ‚ç›®å’Œä¹¦ç± (Movies, TV Shows, and Books)"></a>4. ç”µå½±ã€ç”µè§†èŠ‚ç›®å’Œä¹¦ç± (Movies, TV Shows, and Books)</h3><ul><li>è¯æ±‡ï¼šPlot (æƒ…èŠ‚), genre (ç±»å‹), protagonist (ä¸»è§’), cliffhanger (æ‚¬å¿µ), screenplay (å‰§æœ¬)ã€‚</li><li>çŸ­è¯­ï¼šTwist in the tale (æ•…äº‹çš„è½¬æŠ˜), page-turner (æ‰£äººå¿ƒå¼¦çš„ä¹¦), critically acclaimed (å¹¿å—å¥½è¯„), binge-watch (è¿ç»­çœ‹å‰§)ã€‚</li><li>æ•…äº‹å¼€åœºï¼š â€œI watched a movie recently, and I found itâ€¦â€ (æˆ‘æœ€è¿‘çœ‹äº†ä¸€éƒ¨ç”µå½±ï¼Œæˆ‘è§‰å¾—å®ƒâ€¦)</li><li>è¿½é—®ï¼š â€œWhat did you like most about it? Any particular scene or character?â€ (ä½ æœ€å–œæ¬¢å®ƒçš„å“ªä¸ªéƒ¨åˆ†ï¼Ÿæœ‰ç‰¹åˆ«å–œæ¬¢çš„åœºæ™¯æˆ–è§’è‰²å—ï¼Ÿ)</li><li>æ¥è¯ï¼š â€œIâ€™ve been looking for something good to watch/read. Would you recommend it?â€ (æˆ‘ä¸€ç›´åœ¨æ‰¾å¥½çœ‹/å¥½è¯»çš„ä¸œè¥¿ã€‚ä½ ä¼šæ¨èå®ƒå—ï¼Ÿ)</li></ul><h3 id="5-å½“å‰äº‹ä»¶-Current-Events"><a href="#5-å½“å‰äº‹ä»¶-Current-Events" class="headerlink" title="5. å½“å‰äº‹ä»¶ (Current Events)"></a>5. å½“å‰äº‹ä»¶ (Current Events)</h3><ul><li>è¯æ±‡ï¼šGeopolitics (åœ°ç¼˜æ”¿æ²»), humanitarian (äººé“ä¸»ä¹‰çš„), legislation (ç«‹æ³•), diplomacy (å¤–äº¤), fiscal (è´¢æ”¿çš„)ã€‚</li><li>çŸ­è¯­ï¼šPolitical turmoil (æ”¿æ²»åŠ¨è¡), economic sanctions (ç»æµåˆ¶è£), diplomatic relations (å¤–äº¤å…³ç³»), social unrest (ç¤¾ä¼šåŠ¨ä¹±)ã€‚</li><li>æ•…äº‹å¼€åœºï¼š â€œI read an interesting news article aboutâ€¦â€ (æˆ‘è¯»åˆ°äº†ä¸€ä¸ªæœ‰è¶£çš„æ–°é—»æ–‡ç« ï¼Œå…³äºâ€¦)</li><li>è¿½é—®ï¼š â€œThat does sound interesting. How do you think it will affect us?â€ (é‚£ç¡®å®å¾ˆæœ‰è¶£ã€‚ä½ è®¤ä¸ºå®ƒä¼šå¦‚ä½•å½±å“æˆ‘ä»¬ï¼Ÿ)</li><li>æ¥è¯ï¼š â€œI read something similar. Itâ€™s fascinating how quickly things are changing.â€ (æˆ‘è¯»è¿‡ç±»ä¼¼çš„ä¸œè¥¿ã€‚äº‹ç‰©å˜åŒ–ä¹‹å¿«çœŸæ˜¯ä»¤äººç€è¿·ã€‚)</li></ul><h3 id="6-æ—¥å¸¸ç”Ÿæ´»ä¸æ—¥ç¨‹-Daily-Life-and-Routine"><a href="#6-æ—¥å¸¸ç”Ÿæ´»ä¸æ—¥ç¨‹-Daily-Life-and-Routine" class="headerlink" title="6. æ—¥å¸¸ç”Ÿæ´»ä¸æ—¥ç¨‹ (Daily Life and Routine)"></a>6. æ—¥å¸¸ç”Ÿæ´»ä¸æ—¥ç¨‹ (Daily Life and Routine)</h3><ul><li>è¯æ±‡ï¼šMundane (å¹³å‡¡çš„), routine (æ—¥å¸¸çš„), chores (æ‚åŠ¡), errand (å·®äº‹), regimen (è§„å¾‹)ã€‚</li><li>çŸ­è¯­ï¼šDaily grind (æ—¥å¸¸çäº‹), run errands (åšæ‚äº‹), stick to a routine (éµå®ˆæ—¥å¸¸), day-to-day life (æ—¥å¸¸ç”Ÿæ´»)ã€‚</li><li>æ•…äº‹å¼€åœºï¼š â€œA typical day for me involvesâ€¦â€ (æˆ‘çš„å…¸å‹ä¸€å¤©åŒ…æ‹¬â€¦)</li><li>è¿½é—®ï¼š â€œSounds like a busy day. What do you enjoy most in your daily routine?â€ (å¬èµ·æ¥æ˜¯å¿™ç¢Œçš„ä¸€å¤©ã€‚ä½ æœ€å–œæ¬¢æ—¥å¸¸ç”Ÿæ´»ä¸­çš„å“ªä¸ªéƒ¨åˆ†ï¼Ÿ)</li><li>æ¥è¯ï¼š â€œI can relate to that. My mornings are pretty similar. Do you have any morning rituals?â€ (æˆ‘èƒ½ç†è§£ã€‚æˆ‘çš„æ—©æ™¨ä¹Ÿå·®ä¸å¤šã€‚ä½ æœ‰ä»€ä¹ˆæ™¨é—´ä»ªå¼å—ï¼Ÿ)</li></ul><h3 id="7-è¯­è¨€å­¦ä¹ -Language-Learning"><a href="#7-è¯­è¨€å­¦ä¹ -Language-Learning" class="headerlink" title="7. è¯­è¨€å­¦ä¹  (Language Learning)"></a>7. è¯­è¨€å­¦ä¹  (Language Learning)</h3><ul><li>è¯æ±‡ï¼šFluency (æµåˆ©), proficiency (ç²¾é€š), bilingual (åŒè¯­çš„), immersion (æ²‰æµ¸å¼), linguistics (è¯­è¨€å­¦)ã€‚</li><li>çŸ­è¯­ï¼šGain proficiency (æé«˜ç†Ÿç»ƒåº¦), language barrier (è¯­è¨€éšœç¢), mother tongue (æ¯è¯­), pick up a language (å­¦ä¹ ä¸€ç§è¯­è¨€)ã€‚</li><li>æ•…äº‹å¼€åœºï¼š â€œOne challenge I face in learning English isâ€¦â€ (æˆ‘åœ¨å­¦ä¹ è‹±è¯­æ—¶é¢ä¸´çš„ä¸€ä¸ªæŒ‘æˆ˜æ˜¯â€¦)</li><li>è¿½é—®ï¼š â€œI see. What strategies are you using to overcome that challenge?â€ (æˆ‘æ˜ç™½äº†ã€‚ä½ ç”¨ä»€ä¹ˆç­–ç•¥æ¥å…‹æœè¿™ä¸ªæŒ‘æˆ˜ï¼Ÿ)</li><li>æ¥è¯ï¼š â€œLearning a language can be tough. Iâ€™m also trying to improve my [language].â€ (å­¦ä¹ ä¸€é—¨è¯­è¨€å¯èƒ½å¾ˆéš¾ã€‚æˆ‘ä¹Ÿåœ¨åŠªåŠ›æé«˜æˆ‘çš„[è¯­è¨€]æ°´å¹³ã€‚)</li></ul><h3 id="8-æ–‡åŒ–å·®å¼‚-Cultural-Differences"><a href="#8-æ–‡åŒ–å·®å¼‚-Cultural-Differences" class="headerlink" title="8. æ–‡åŒ–å·®å¼‚ (Cultural Differences)"></a>8. æ–‡åŒ–å·®å¼‚ (Cultural Differences)</h3><ul><li>è¯æ±‡ï¼šEtiquette (ç¤¼ä»ª), customs (é£ä¿—), heritage (é—äº§), assimilate (åŒåŒ–), diversity (å¤šæ ·æ€§)ã€‚</li><li>çŸ­è¯­ï¼šCultural exchange (æ–‡åŒ–äº¤æµ), societal norms (ç¤¾ä¼šè§„èŒƒ), cross-cultural (è·¨æ–‡åŒ–), traditional values (ä¼ ç»Ÿä»·å€¼)ã€‚</li><li>æ•…äº‹å¼€åœºï¼š â€œOne thing I find different here compared to my home country isâ€¦â€ (æˆ‘å‘ç°è¿™é‡Œå’Œæˆ‘çš„ç¥–å›½ç›¸æ¯”æœ‰ä¸€ç‚¹ä¸åŒæ˜¯â€¦)</li><li>è¿½é—®ï¼š â€œThatâ€™s quite interesting. How do you feel about that difference?â€ (è¿™å¾ˆæœ‰è¶£ã€‚ä½ å¯¹è¿™ç§å·®å¼‚æœ‰ä»€ä¹ˆæ„Ÿè§‰ï¼Ÿ)</li><li>æ¥è¯ï¼š â€œCultural differences are so intriguing. Iâ€™ve noticed something similar when I traveled to [country].â€ (æ–‡åŒ–å·®å¼‚çœŸçš„å¾ˆæœ‰è¶£ã€‚æˆ‘åœ¨å»[å›½å®¶]æ—…è¡Œæ—¶ä¹Ÿæ³¨æ„åˆ°äº†ç±»ä¼¼çš„äº‹æƒ…ã€‚)</li></ul><h3 id="9-ç§‘æŠ€ä¸è¶‹åŠ¿-Technology-and-Trends"><a href="#9-ç§‘æŠ€ä¸è¶‹åŠ¿-Technology-and-Trends" class="headerlink" title="9. ç§‘æŠ€ä¸è¶‹åŠ¿ (Technology and Trends)"></a>9. ç§‘æŠ€ä¸è¶‹åŠ¿ (Technology and Trends)</h3><ul><li>è¯æ±‡ï¼šInnovative (åˆ›æ–°çš„), cutting-edge (å°–ç«¯çš„), algorithm (ç®—æ³•), virtual reality (è™šæ‹Ÿç°å®), automation (è‡ªåŠ¨åŒ–)ã€‚</li><li>çŸ­è¯­ï¼šStay ahead of the curve (ä¿æŒé¢†å…ˆ), technological advancements (æŠ€æœ¯è¿›æ­¥), digital age (æ•°å­—æ—¶ä»£), the latest trend (æœ€æ–°è¶‹åŠ¿)ã€‚</li><li>æ•…äº‹å¼€åœºï¼š â€œIâ€™m curious about howâ€¦â€ (æˆ‘å¯¹â€¦æ„Ÿåˆ°å¥½å¥‡)</li><li>è¿½é—®ï¼š â€œWhy does that interest you? Have you tried it out yourself?â€ (ä¸ºä»€ä¹ˆé‚£ä¼šå¼•èµ·ä½ çš„å…´è¶£ï¼Ÿä½ è‡ªå·±è¯•è¿‡äº†å—ï¼Ÿ)</li><li>æ¥è¯ï¼š â€œTechnology is advancing so fast. Iâ€™m also curious about [specific technology or trend].â€ (ç§‘æŠ€è¿›æ­¥å¤ªå¿«äº†ã€‚æˆ‘ä¹Ÿå¯¹[ç‰¹å®šç§‘æŠ€æˆ–è¶‹åŠ¿]æ„Ÿåˆ°å¥½å¥‡ã€‚)</li></ul><h3 id="10-ä¸ªäººå‘å±•-Personal-Development"><a href="#10-ä¸ªäººå‘å±•-Personal-Development" class="headerlink" title="10. ä¸ªäººå‘å±• (Personal Development)"></a>10. ä¸ªäººå‘å±• (Personal Development)</h3><ul><li>è¯æ±‡ï¼šSelf-improvement (è‡ªæˆ‘æå‡), mindfulness (æ­£å¿µ), resilience (éŸ§æ€§), aspiration (æŠ±è´Ÿ), introspection (åçœ)ã€‚</li><li>çŸ­è¯­ï¼šSet goals (è®¾å®šç›®æ ‡), personal growth(ä¸ªäººæˆé•¿), step out of comfort zone (èµ°å‡ºèˆ’é€‚åŒº), life-long learning (ç»ˆèº«å­¦ä¹ )ã€‚</li><li>æ•…äº‹å¼€åœºï¼š â€œIâ€™ve been trying toâ€¦â€ (æˆ‘ä¸€ç›´åœ¨å°è¯•â€¦)</li><li>è¿½é—®ï¼š â€œThatâ€™s a great goal. How are you planning to achieve it?â€ (é‚£æ˜¯ä¸ªå¾ˆå¥½çš„ç›®æ ‡ã€‚ä½ æ‰“ç®—å¦‚ä½•å®ç°å®ƒï¼Ÿ)</li><li>æ¥è¯ï¼š â€œSelf-improvement is so important. Iâ€™m also working on [your goal or habit].â€ (è‡ªæˆ‘æå‡éå¸¸é‡è¦ã€‚æˆ‘ä¹Ÿåœ¨åŠªåŠ›[ä½ çš„ç›®æ ‡æˆ–ä¹ æƒ¯]ã€‚)</li></ul><p>æˆä¸ºä¸€ä¸ªå¥½çš„æ§å“ä¸ä»…èƒ½ä½¿å¯¹è¯æ›´åŠ æ·±å…¥å’Œæœ‰æ„ä¹‰ï¼Œè¿˜èƒ½å±•ç°ä½ çš„å€¾å¬å’Œç†è§£èƒ½åŠ›ã€‚è¿™äº›é—®é¢˜å’Œè¯„è®ºå¯ä»¥å¸®åŠ©ä½ åœ¨å„ç§è¯é¢˜ä¸­æ›´å¥½åœ°å‚ä¸å’Œç»´æŒè‹±è¯­å¯¹è¯ã€‚è¯•è¯•çœ‹ï¼Œä½ ä¼šå‘ç°æ¯æ¬¡å°èŠéƒ½å……æ»¡æ–°çš„å‘ç°å’Œä¹è¶£ï¼ğŸŒŸğŸ—£ï¸ğŸ’¬</p>]]></content>
      
      
      <categories>
          
          <category> Life Reflections </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Language Learning </tag>
            
            <tag> Small Talk </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€Pythoné¢˜è§£ã€‘100226. åœ¨å¸¦æƒæ ‘ç½‘ç»œä¸­ç»Ÿè®¡å¯è¿æ¥æœåŠ¡å™¨å¯¹æ•°ç›®</title>
      <link href="/2024/03/04/Code%20Chronicles/%E3%80%90Python%E9%A2%98%E8%A7%A3%E3%80%91100226.%20%E5%9C%A8%E5%B8%A6%E6%9D%83%E6%A0%91%E7%BD%91%E7%BB%9C%E4%B8%AD%E7%BB%9F%E8%AE%A1%E5%8F%AF%E8%BF%9E%E6%8E%A5%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AF%B9%E6%95%B0%E7%9B%AE/"/>
      <url>/2024/03/04/Code%20Chronicles/%E3%80%90Python%E9%A2%98%E8%A7%A3%E3%80%91100226.%20%E5%9C%A8%E5%B8%A6%E6%9D%83%E6%A0%91%E7%BD%91%E7%BB%9C%E4%B8%AD%E7%BB%9F%E8%AE%A1%E5%8F%AF%E8%BF%9E%E6%8E%A5%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AF%B9%E6%95%B0%E7%9B%AE/</url>
      
        <content type="html"><![CDATA[<h3 id="é¢˜ç›®ï¼š100226-åœ¨å¸¦æƒæ ‘ç½‘ç»œä¸­ç»Ÿè®¡å¯è¿æ¥æœåŠ¡å™¨å¯¹æ•°ç›®"><a href="#é¢˜ç›®ï¼š100226-åœ¨å¸¦æƒæ ‘ç½‘ç»œä¸­ç»Ÿè®¡å¯è¿æ¥æœåŠ¡å™¨å¯¹æ•°ç›®" class="headerlink" title="é¢˜ç›®ï¼š100226. åœ¨å¸¦æƒæ ‘ç½‘ç»œä¸­ç»Ÿè®¡å¯è¿æ¥æœåŠ¡å™¨å¯¹æ•°ç›®"></a>é¢˜ç›®ï¼š100226. åœ¨å¸¦æƒæ ‘ç½‘ç»œä¸­ç»Ÿè®¡å¯è¿æ¥æœåŠ¡å™¨å¯¹æ•°ç›®</h3><h4 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h4><p>ä½ è¢«ç»™å®šä¸€ä¸ªæœªå®šæ ¹çš„åŠ æƒæ ‘ï¼Œå®ƒæœ‰ <code>n</code> ä¸ªé¡¶ç‚¹ï¼Œä»£è¡¨ä» 0 åˆ° <code>n - 1</code> ç¼–å·çš„æœåŠ¡å™¨ï¼Œä¸€ä¸ªæ•°ç»„ <code>edges</code>ï¼Œå…¶ä¸­ <code>edges[i] = [ai, bi, weighti]</code> ä»£è¡¨é¡¶ç‚¹ <code>ai</code> å’Œ <code>bi</code> ä¹‹é—´çš„åŒå‘è¾¹ï¼Œè¾¹çš„æƒé‡ä¸º <code>weighti</code>ã€‚ä½ è¿˜è¢«ç»™å®šä¸€ä¸ªæ•´æ•° <code>signalSpeed</code>ã€‚</p><p>å¦‚æœæ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼Œä¸¤ä¸ªæœåŠ¡å™¨ <code>a</code> å’Œ <code>b</code> å¯ä»¥é€šè¿‡æœåŠ¡å™¨ <code>c</code> è¿æ¥ï¼š</p><ul><li><code>a &lt; b</code>ï¼Œ<code>a != c</code> ä¸” <code>b != c</code>ã€‚</li><li>ä» <code>c</code> åˆ° <code>a</code> çš„è·ç¦»å¯è¢« <code>signalSpeed</code> æ•´é™¤ã€‚</li><li>ä» <code>c</code> åˆ° <code>b</code> çš„è·ç¦»å¯è¢« <code>signalSpeed</code> æ•´é™¤ã€‚</li><li>ä» <code>c</code> åˆ° <code>b</code> å’Œä» <code>c</code> åˆ° <code>a</code> çš„è·¯å¾„ä¸å…±äº«ä»»ä½•è¾¹ã€‚</li></ul><p>è¿”å›ä¸€ä¸ªæ•´æ•°æ•°ç»„ <code>count</code>ï¼Œé•¿åº¦ä¸º <code>n</code>ï¼Œå…¶ä¸­ <code>count[i]</code> æ˜¯é€šè¿‡æœåŠ¡å™¨ <code>i</code> å¯è¿æ¥çš„æœåŠ¡å™¨å¯¹æ•°ã€‚</p><h4 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h4><p><strong>ç¤ºä¾‹ 1</strong>:</p><p>è¾“å…¥: <code>edges = [[0,1,1],[1,2,5],[2,3,13],[3,4,9],[4,5,2]]</code>, <code>signalSpeed = 1</code><br>è¾“å‡º: <code>[0,4,6,6,4,0]</code><br>è§£é‡Š: ç”±äº <code>signalSpeed</code> ä¸º 1ï¼Œ<code>count[c]</code> ç­‰äºä» <code>c</code> å‡ºå‘ä¸”ä¸å…±äº«ä»»ä½•è¾¹çš„è·¯å¾„å¯¹æ•°ã€‚<br>åœ¨ç»™å®šçš„è·¯å¾„å›¾ä¸­ï¼Œ<code>count[c]</code> ç­‰äº <code>c</code> å·¦ä¾§çš„æœåŠ¡å™¨æ•°ä¹˜ä»¥ <code>c</code> å³ä¾§çš„æœåŠ¡å™¨æ•°ã€‚</p><p><strong>ç¤ºä¾‹ 2</strong>:</p><p>è¾“å…¥: <code>edges = [[0,6,3],[6,5,3],[0,3,1],[3,2,7],[3,1,6],[3,4,2]]</code>, <code>signalSpeed = 3</code><br>è¾“å‡º: <code>[2,0,0,0,0,0,2]</code><br>è§£é‡Š: é€šè¿‡æœåŠ¡å™¨ 0ï¼Œæœ‰ 2 å¯¹å¯è¿æ¥æœåŠ¡å™¨ï¼š(4, 5) å’Œ (4, 6)ã€‚<br>é€šè¿‡æœåŠ¡å™¨ 6ï¼Œæœ‰ 2 å¯¹å¯è¿æ¥æœåŠ¡å™¨ï¼š(4, 5) å’Œ (0, 5)ã€‚<br>å¯ä»¥è¯æ˜ï¼Œé™¤äº† 0 å’Œ 6 ä¹‹å¤–çš„æœåŠ¡å™¨æ— æ³•è¿æ¥ä»»ä½•ä¸¤ä¸ªæœåŠ¡å™¨ã€‚</p><h4 id="é™åˆ¶æ¡ä»¶"><a href="#é™åˆ¶æ¡ä»¶" class="headerlink" title="é™åˆ¶æ¡ä»¶"></a>é™åˆ¶æ¡ä»¶</h4><ul><li><code>2 &lt;= n &lt;= 1000</code></li><li><code>edges.length == n - 1</code></li><li><code>edges[i].length == 3</code></li><li><code>0 &lt;= ai, bi &lt; n</code></li><li><code>1 &lt;= weighti &lt;= 10^6</code></li><li><code>1 &lt;= signalSpeed &lt;= 10^6</code></li><li>è¾“å…¥ä¿è¯ <code>edges</code> è¡¨ç¤ºä¸€ä¸ªæœ‰æ•ˆçš„æ ‘ã€‚</li></ul><hr><h3 id="é—®é¢˜æ¦‚è¿°"><a href="#é—®é¢˜æ¦‚è¿°" class="headerlink" title="é—®é¢˜æ¦‚è¿°"></a>é—®é¢˜æ¦‚è¿°</h3><p>ç»™å®šä¸€ä¸ªè¡¨ç¤ºæœåŠ¡å™¨ç½‘ç»œçš„æ ‘ç»“æ„ã€‚æ¯ä¸ªæœåŠ¡å™¨é€šè¿‡å¸¦æƒé‡çš„è¾¹ä¸å…¶ä»–æœåŠ¡å™¨è¿æ¥ã€‚ç›®æ ‡æ˜¯è®¡ç®—åœ¨æ ‘ä¸­çš„æ¯ä¸ªæœåŠ¡å™¨é€šè¿‡çš„å¯è¿æ¥æœåŠ¡å™¨å¯¹çš„æ•°é‡ï¼Œè¿™äº›æ¡ä»¶ç”±<code>signalSpeed</code>å®šä¹‰ã€‚</p><h3 id="å¯è¿æ¥æœåŠ¡å™¨çš„æ¡ä»¶"><a href="#å¯è¿æ¥æœåŠ¡å™¨çš„æ¡ä»¶" class="headerlink" title="å¯è¿æ¥æœåŠ¡å™¨çš„æ¡ä»¶"></a>å¯è¿æ¥æœåŠ¡å™¨çš„æ¡ä»¶</h3><p>å¦‚æœæ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼Œä¸¤ä¸ªæœåŠ¡å™¨ <code>a</code> å’Œ <code>b</code> å¯ä»¥é€šè¿‡æœåŠ¡å™¨ <code>c</code> è¿æ¥ï¼š</p><ul><li><code>a &lt; b</code></li><li><code>a</code> å’Œ <code>b</code> éƒ½ä¸åŒäº <code>c</code>ã€‚</li><li>ä» <code>c</code> åˆ° <code>a</code> å’Œä» <code>c</code> åˆ° <code>b</code> çš„è·ç¦»éƒ½èƒ½è¢« <code>signalSpeed</code> æ•´é™¤ã€‚</li><li>ä» <code>c</code> åˆ° <code>a</code> å’Œä» <code>c</code> åˆ° <code>b</code> çš„è·¯å¾„ä¸å…±äº«ä»»ä½•è¾¹ã€‚</li></ul><h3 id="è§£å†³æ–¹æ³•"><a href="#è§£å†³æ–¹æ³•" class="headerlink" title="è§£å†³æ–¹æ³•"></a>è§£å†³æ–¹æ³•</h3><ol><li><p><strong>æ ‘è¡¨ç¤º</strong>ï¼šæ ‘ä½¿ç”¨é‚»æ¥è¡¨è¡¨ç¤ºï¼Œæ¯ä¸ªæœåŠ¡å™¨è¿æ¥åˆ°å…¶é‚»å±…ä»¥åŠè¿æ¥è¾¹çš„æƒé‡ã€‚</p></li><li><p><strong>æ·±åº¦ä¼˜å…ˆæœç´¢ï¼ˆDFSï¼‰</strong>ï¼š</p><ul><li>ä½¿ç”¨ä¿®æ”¹åçš„ DFS ç®—æ³•ä»æ¯ä¸ªæœåŠ¡å™¨å¼€å§‹éå†æ ‘ã€‚</li><li>è¯¥ç®—æ³•è®¡ç®—æ‰€æœ‰å…¶ä»–æœåŠ¡å™¨ä¸å½“å‰æœåŠ¡å™¨çš„è·ç¦»ã€‚</li><li>DFS ç¡®ä¿åœ¨è·¯å¾„ä¸­ä¸è€ƒè™‘å…±äº«è¾¹ã€‚</li></ul></li><li><p><strong>è®¡ç®—å¯è¿æ¥å¯¹</strong>ï¼š</p><ul><li>å¯¹äºæ¯ä¸ªæœåŠ¡å™¨ <code>c</code>ï¼Œè¯¥ç®—æ³•è¯†åˆ«é€šè¿‡ç§»é™¤ <code>c</code> å½¢æˆçš„æ‰€æœ‰å¯èƒ½çš„å­æ ‘ã€‚</li><li>å®ƒè®¡ç®—æ¯ä¸ªå­æ ‘ä¸­ä¸ <code>c</code> çš„è·ç¦»èƒ½è¢« <code>signalSpeed</code> æ•´é™¤çš„æœåŠ¡å™¨æ•°é‡ã€‚</li><li>é€šè¿‡æœåŠ¡å™¨ <code>c</code> çš„å¯è¿æ¥å¯¹çš„æ€»æ•°æ˜¯é€šè¿‡è€ƒè™‘æ¥è‡ªä¸åŒå­æ ‘çš„å¯¹çš„æ‰€æœ‰å¯èƒ½ç»„åˆè®¡ç®—å‡ºæ¥çš„ã€‚</li></ul></li></ol><h3 id="Python-å®ç°"><a href="#Python-å®ç°" class="headerlink" title="Python å®ç°"></a>Python å®ç°</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">count_connectable_servers</span>(<span class="params">edges, signal_speed</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">build_tree</span>(<span class="params">edges</span>):</span><br><span class="line">        tree = defaultdict(<span class="built_in">list</span>)</span><br><span class="line">        <span class="keyword">for</span> a, b, weight <span class="keyword">in</span> edges:</span><br><span class="line">            tree[a].append((b, weight))</span><br><span class="line">            tree[b].append((a, weight))</span><br><span class="line">        <span class="keyword">return</span> tree</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">dfs_count_nodes</span>(<span class="params">server, parent, distance</span>):</span><br><span class="line">        <span class="keyword">if</span> distance % signal_speed == <span class="number">0</span>:</span><br><span class="line">            count[<span class="number">0</span>] += <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> neighbor, weight <span class="keyword">in</span> tree[server]:</span><br><span class="line">            <span class="keyword">if</span> neighbor != parent:</span><br><span class="line">                dfs_count_nodes(neighbor, server, distance + weight)</span><br><span class="line"></span><br><span class="line">    n = <span class="built_in">len</span>(edges) + <span class="number">1</span></span><br><span class="line">    tree = build_tree(edges)</span><br><span class="line">    counts = [<span class="number">0</span>] * n</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        subtree_counts = []</span><br><span class="line">        <span class="keyword">for</span> neighbor, weight <span class="keyword">in</span> tree[c]:</span><br><span class="line">            count = [<span class="number">0</span>]</span><br><span class="line">            dfs_count_nodes(neighbor, c, weight)</span><br><span class="line">            subtree_counts.append(count[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(subtree_counts)):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i + <span class="number">1</span>, <span class="built_in">len</span>(subtree_counts)):</span><br><span class="line">                counts[c] += subtree_counts[i] * subtree_counts[j]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> counts</span><br></pre></td></tr></tbody></table></figure><h3 id="å¤æ‚åº¦åˆ†æ"><a href="#å¤æ‚åº¦åˆ†æ" class="headerlink" title="å¤æ‚åº¦åˆ†æ"></a>å¤æ‚åº¦åˆ†æ</h3><ul><li><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼šè¯¥ç®—æ³•å¯¹æ ‘ä¸­çš„æ¯ä¸ªæœåŠ¡å™¨æ‰§è¡Œä¸€æ¬¡ DFSã€‚ç”±äºæ¯æ¡è¾¹åœ¨æ¯æ¬¡ DFS ä¸­è¢«è®¿é—®ä¸€æ¬¡ï¼Œå¹¶ä¸”æœ‰ <code>n</code> ä¸ªæœåŠ¡å™¨ï¼Œæ‰€ä»¥æ€»ä½“æ—¶é—´å¤æ‚åº¦ä¸º O(n^2)ï¼Œå…¶ä¸­ <code>n</code> æ˜¯æœåŠ¡å™¨çš„æ•°é‡ã€‚</li><li><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼šç”±äºå­˜å‚¨æ ‘ç»“æ„å’Œåœ¨ DFS è¿‡ç¨‹ä¸­ä½¿ç”¨çš„è¾…åŠ©æ•°æ®ç»“æ„ï¼Œç©ºé—´å¤æ‚åº¦ä¸º O(n)ã€‚</li></ul><h3 id="æµ‹è¯•ç”¨ä¾‹"><a href="#æµ‹è¯•ç”¨ä¾‹" class="headerlink" title="æµ‹è¯•ç”¨ä¾‹"></a>æµ‹è¯•ç”¨ä¾‹</h3><p>è¯¥è§£å†³æ–¹æ¡ˆå·²ç»é€šè¿‡æä¾›çš„ç¤ºä¾‹å’Œå…¶ä»–è‡ªå®šä¹‰æµ‹è¯•ç”¨ä¾‹è¿›è¡Œäº†æµ‹è¯•ï¼Œä»¥ç¡®ä¿å…¶æ­£ç¡®æ€§ã€‚</p><h3 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h3><p>è¿™ä¸ªè§£å†³æ–¹æ¡ˆæœ‰æ•ˆåœ°è®¡ç®—äº†åœ¨æ ‘å½¢ç½‘ç»œä¸­ï¼Œæ¯ä¸ªæœåŠ¡å™¨é€šè¿‡çš„å¯è¿æ¥æœåŠ¡å™¨å¯¹çš„æ•°é‡ï¼Œè€ƒè™‘åˆ°äº†ä¸ <code>signalSpeed</code> å’Œè¿æ¥è§„åˆ™ç›¸å…³çš„ç»™å®šé™åˆ¶ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Code Chronicles </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> Leetcode </tag>
            
            <tag> åŒå‘¨èµ› </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€Pythoné¢˜è§£ã€‘100232. è¶…è¿‡é˜ˆå€¼çš„æœ€å°‘æ“ä½œæ•° II</title>
      <link href="/2024/03/03/Code%20Chronicles/%E3%80%90Python%E9%A2%98%E8%A7%A3%E3%80%91100232.%20%E8%B6%85%E8%BF%87%E9%98%88%E5%80%BC%E7%9A%84%E6%9C%80%E5%B0%91%E6%93%8D%E4%BD%9C%E6%95%B0%20II/"/>
      <url>/2024/03/03/Code%20Chronicles/%E3%80%90Python%E9%A2%98%E8%A7%A3%E3%80%91100232.%20%E8%B6%85%E8%BF%87%E9%98%88%E5%80%BC%E7%9A%84%E6%9C%80%E5%B0%91%E6%93%8D%E4%BD%9C%E6%95%B0%20II/</url>
      
        <content type="html"><![CDATA[<h3 id="é¢˜ç›®ï¼š100232-è¶…è¿‡é˜ˆå€¼çš„æœ€å°‘æ“ä½œæ•°-II"><a href="#é¢˜ç›®ï¼š100232-è¶…è¿‡é˜ˆå€¼çš„æœ€å°‘æ“ä½œæ•°-II" class="headerlink" title="é¢˜ç›®ï¼š100232. è¶…è¿‡é˜ˆå€¼çš„æœ€å°‘æ“ä½œæ•° II"></a>é¢˜ç›®ï¼š100232. è¶…è¿‡é˜ˆå€¼çš„æœ€å°‘æ“ä½œæ•° II</h3><h3 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p><strong>è¶…è¿‡é˜ˆå€¼çš„æœ€å°‘æ“ä½œæ•° II</strong></p><p>ç»™å®šä¸€ä¸ªä» 0 å¼€å§‹çš„æ•´æ•°æ•°ç»„ <code>nums</code> å’Œä¸€ä¸ªæ•´æ•° <code>k</code>ã€‚ä½ å¯ä»¥è¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š</p><ul><li>é€‰æ‹© <code>nums</code> ä¸­æœ€å°çš„ä¸¤ä¸ªæ•´æ•° <code>x</code> å’Œ <code>y</code>ã€‚</li><li>å°† <code>x</code> å’Œ <code>y</code> ä» <code>nums</code> ä¸­åˆ é™¤ã€‚</li><li>å°† <code>min(x, y) * 2 + max(x, y)</code> æ·»åŠ åˆ°æ•°ç»„ä¸­çš„ä»»æ„ä½ç½®ã€‚</li></ul><p>æ³¨æ„ï¼Œåªæœ‰å½“ <code>nums</code> è‡³å°‘åŒ…å«ä¸¤ä¸ªå…ƒç´ æ—¶ï¼Œä½ æ‰å¯ä»¥æ‰§è¡Œä»¥ä¸Šæ“ä½œã€‚</p><p>ç›®æ ‡æ˜¯ä½¿æ•°ç»„ä¸­çš„æ‰€æœ‰å…ƒç´ éƒ½å¤§äºæˆ–ç­‰äº <code>k</code>ã€‚è¯·è¿”å›å®ç°æ­¤ç›®æ ‡æ‰€éœ€çš„æœ€å°‘æ“ä½œæ¬¡æ•°ã€‚</p><h4 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h4><ol><li><p>ç¤ºä¾‹ 1ï¼š</p><ul><li>è¾“å…¥ï¼š<code>nums = [2,11,10,1,3], k = 10</code></li><li>è¾“å‡ºï¼š<code>2</code></li><li>è§£é‡Šï¼šç¬¬ä¸€æ¬¡æ“ä½œä¸­ï¼Œæˆ‘ä»¬åˆ é™¤å…ƒç´  1 å’Œ 2ï¼Œç„¶åæ·»åŠ  1 _ 2 + 2 åˆ° <code>nums</code> ä¸­ï¼Œ<code>nums</code> å˜ä¸º <code>[4, 11, 10, 3]</code>ã€‚ç¬¬äºŒæ¬¡æ“ä½œä¸­ï¼Œæˆ‘ä»¬åˆ é™¤å…ƒç´  3 å’Œ 4ï¼Œç„¶åæ·»åŠ  3 _ 2 + 4 åˆ° <code>nums</code> ä¸­ï¼Œ<code>nums</code> å˜ä¸º <code>[10, 11, 10]</code>ã€‚æ­¤æ—¶ï¼Œæ•°ç»„ä¸­çš„æ‰€æœ‰å…ƒç´ éƒ½å¤§äºç­‰äº 10ï¼Œæ‰€ä»¥æˆ‘ä»¬åœæ­¢æ“ä½œã€‚éœ€è¦çš„æœ€å°‘æ“ä½œæ¬¡æ•°ä¸º 2ã€‚</li></ul></li><li><p>ç¤ºä¾‹ 2ï¼š</p><ul><li>è¾“å…¥ï¼š<code>nums = [1,1,2,4,9], k = 20</code></li><li>è¾“å‡ºï¼š<code>4</code></li><li>è§£é‡Šï¼šç¬¬ä¸€æ¬¡æ“ä½œåï¼Œ<code>nums</code> å˜ä¸º <code>[2, 4, 9, 3]</code>ã€‚ç¬¬äºŒæ¬¡æ“ä½œåï¼Œ<code>nums</code> å˜ä¸º <code>[7, 4, 9]</code>ã€‚ç¬¬ä¸‰æ¬¡æ“ä½œåï¼Œ<code>nums</code> å˜ä¸º <code>[15, 9]</code>ã€‚ç¬¬å››æ¬¡æ“ä½œåï¼Œ<code>nums</code> å˜ä¸º <code>[33]</code>ã€‚æ­¤æ—¶ï¼Œæ•°ç»„ä¸­çš„æ‰€æœ‰å…ƒç´ éƒ½å¤§äºç­‰äº 20ï¼Œæ‰€ä»¥æˆ‘ä»¬åœæ­¢æ“ä½œã€‚éœ€è¦çš„æœ€å°‘æ“ä½œæ¬¡æ•°ä¸º 4ã€‚</li></ul></li></ol><h4 id="æç¤º"><a href="#æç¤º" class="headerlink" title="æç¤º"></a>æç¤º</h4><ul><li><code>2 &lt;= nums.length &lt;= 2 * 10^5</code></li><li><code>1 &lt;= nums[i] &lt;= 10^9</code></li><li><code>1 &lt;= k &lt;= 10^9</code></li><li>è¾“å…¥ä¿è¯ç­”æ¡ˆä¸€å®šå­˜åœ¨ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€å®šå­˜åœ¨ä¸€ä¸ªæ“ä½œåºåˆ—ä½¿æ•°ç»„ä¸­æ‰€æœ‰å…ƒç´ éƒ½å¤§äºç­‰äº <code>k</code>ã€‚</li></ul><h3 id="è§£å†³ç­–ç•¥"><a href="#è§£å†³ç­–ç•¥" class="headerlink" title="è§£å†³ç­–ç•¥"></a>è§£å†³ç­–ç•¥</h3><p>è¿™ä¸ªé—®é¢˜å¯ä»¥é€šè¿‡è´ªå¿ƒç®—æ³•å’Œæœ€å°å †æ¥é«˜æ•ˆè§£å†³ã€‚æˆ‘ä»¬æ¯æ¬¡ä»æ•°ç»„ä¸­é€‰æ‹©æœ€å°çš„ä¸¤ä¸ªæ•°è¿›è¡Œæ“ä½œï¼Œè¿™æ ·å¯ä»¥æœ€å¿«åœ°å¢åŠ æ•°çš„æ€»å’Œï¼Œæ›´å¿«åœ°è¾¾åˆ°æˆ–è¶…è¿‡é˜ˆå€¼ <code>k</code>ã€‚æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li><p><strong>åˆå§‹åŒ–</strong>: å°†æ•°ç»„è½¬æ¢æˆæœ€å°å †ï¼Œä»¥ä¾¿å¿«é€Ÿæ‰¾åˆ°æœ€å°çš„ä¸¤ä¸ªæ•°ã€‚</p></li><li><p><strong>æ‰§è¡Œæ“ä½œ</strong>: åå¤æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼Œç›´åˆ°æ•°ç»„ä¸­çš„æ‰€æœ‰å…ƒç´ éƒ½å¤§äºæˆ–ç­‰äº <code>k</code>ï¼š</p><ul><li>ä»å †ä¸­å¼¹å‡ºæœ€å°çš„ä¸¤ä¸ªå…ƒç´  <code>x</code> å’Œ <code>y</code>ã€‚</li><li>å°† <code>2 * min(x, y) + max(x, y)</code> æ·»åŠ å›å †ä¸­ã€‚</li><li>è®°å½•æ“ä½œæ¬¡æ•°ã€‚</li></ul></li><li><p><strong>è¿”å›ç»“æœ</strong>: å½“æ‰€æœ‰å…ƒç´ éƒ½å¤§äºæˆ–ç­‰äº <code>k</code> æ—¶ï¼Œè¿”å›æ“ä½œæ¬¡æ•°ã€‚</p></li></ol><h3 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> heapq</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">min_operations_to_reach_k</span>(<span class="params">nums, k</span>):</span><br><span class="line">    <span class="comment"># å°†æ•°ç»„è½¬æ¢æˆæœ€å°å †</span></span><br><span class="line">    heapq.heapify(nums)</span><br><span class="line">    operations = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># å½“æœ€å°çš„å…ƒç´ å°äºkæ—¶ï¼Œç»§ç»­æ“ä½œ</span></span><br><span class="line">    <span class="keyword">while</span> nums[<span class="number">0</span>] &lt; k:</span><br><span class="line">        <span class="comment"># å¦‚æœæ•°ç»„ä¸­åªå‰©ä¸€ä¸ªå…ƒç´ ï¼Œåˆ™æ— æ³•è¿›è¡Œæ“ä½œ</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(nums) &lt; <span class="number">2</span>:</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>  <span class="comment"># è¿”å›-1è¡¨ç¤ºæ— æ³•è¾¾åˆ°ç›®æ ‡</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># å¼¹å‡ºæœ€å°çš„ä¸¤ä¸ªå…ƒç´ </span></span><br><span class="line">        x = heapq.heappop(nums)</span><br><span class="line">        y = heapq.heappop(nums)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å°†æ–°å…ƒç´ æ’å…¥å †ä¸­</span></span><br><span class="line">        heapq.heappush(nums, <span class="number">2</span> * <span class="built_in">min</span>(x, y) + <span class="built_in">max</span>(x, y))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å¢åŠ æ“ä½œè®¡æ•°</span></span><br><span class="line">        operations += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> operations</span><br><span class="line"></span><br><span class="line"><span class="comment"># æµ‹è¯•ä»£ç </span></span><br><span class="line"><span class="built_in">print</span>(min_operations_to_reach_k([<span class="number">2</span>, <span class="number">11</span>, <span class="number">10</span>, <span class="number">1</span>, <span class="number">3</span>], <span class="number">10</span>))  <span class="comment"># åº”ä¸º2</span></span><br><span class="line"><span class="built_in">print</span>(min_operations_to_reach_k([<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">9</span>], <span class="number">20</span>))  <span class="comment"># åº”ä¸º4</span></span><br></pre></td></tr></tbody></table></figure><p>è¿™æ®µä»£ç ä½¿ç”¨ Python çš„ <code>heapq</code> æ¨¡å—æ¥æœ‰æ•ˆç®¡ç†æœ€å°å †ï¼Œç¡®ä¿æ¯æ¬¡éƒ½èƒ½å¿«é€Ÿæ‰¾åˆ°æœ€å°çš„ä¸¤ä¸ªæ•°ã€‚é€šè¿‡è¿™ç§æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥é«˜æ•ˆåœ°è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Code Chronicles </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> Leetcode </tag>
            
            <tag> åŒå‘¨èµ› </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€Pythoné¢˜è§£ã€‘100231. è¶…è¿‡é˜ˆå€¼çš„æœ€å°‘æ“ä½œæ•° I</title>
      <link href="/2024/03/02/Code%20Chronicles/%E3%80%90Python%E9%A2%98%E8%A7%A3%E3%80%91100231.%20%E8%B6%85%E8%BF%87%E9%98%88%E5%80%BC%E7%9A%84%E6%9C%80%E5%B0%91%E6%93%8D%E4%BD%9C%E6%95%B0%20I/"/>
      <url>/2024/03/02/Code%20Chronicles/%E3%80%90Python%E9%A2%98%E8%A7%A3%E3%80%91100231.%20%E8%B6%85%E8%BF%87%E9%98%88%E5%80%BC%E7%9A%84%E6%9C%80%E5%B0%91%E6%93%8D%E4%BD%9C%E6%95%B0%20I/</url>
      
        <content type="html"><![CDATA[<h1 id="è¶…è¿‡é˜ˆå€¼çš„æœ€å°‘æ“ä½œæ•°-I"><a href="#è¶…è¿‡é˜ˆå€¼çš„æœ€å°‘æ“ä½œæ•°-I" class="headerlink" title="è¶…è¿‡é˜ˆå€¼çš„æœ€å°‘æ“ä½œæ•° I"></a>è¶…è¿‡é˜ˆå€¼çš„æœ€å°‘æ“ä½œæ•° I</h1><h2 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h2><p>ç»™å®šä¸€ä¸ªä¸‹æ ‡ä» 0 å¼€å§‹çš„æ•´æ•°æ•°ç»„ <code>nums</code> å’Œä¸€ä¸ªæ•´æ•° <code>k</code>ã€‚åœ¨æ¯æ¬¡æ“ä½œä¸­ï¼Œä½ å¯ä»¥åˆ é™¤ <code>nums</code> ä¸­çš„æœ€å°å…ƒç´ ã€‚ç›®æ ‡æ˜¯é€šè¿‡æœ€å°‘çš„æ“ä½œæ¬¡æ•°ä½¿æ•°ç»„ä¸­çš„æ‰€æœ‰å…ƒç´ éƒ½å¤§äºæˆ–ç­‰äº <code>k</code>ã€‚éœ€è¦è¿”å›å®ç°æ­¤ç›®æ ‡æ‰€éœ€çš„æœ€å°‘æ“ä½œæ¬¡æ•°ã€‚</p><h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><p><strong>ç¤ºä¾‹ 1:</strong></p><ul><li>è¾“å…¥ï¼š<code>nums = [2, 11, 10, 1, 3], k = 10</code></li><li>è¾“å‡ºï¼š<code>3</code></li><li>è§£é‡Šï¼š<ul><li>ç¬¬ä¸€æ¬¡æ“ä½œåï¼Œ<code>nums</code> å˜ä¸º <code>[2, 11, 10, 3]</code>ã€‚</li><li>ç¬¬äºŒæ¬¡æ“ä½œåï¼Œ<code>nums</code> å˜ä¸º <code>[11, 10, 3]</code>ã€‚</li><li>ç¬¬ä¸‰æ¬¡æ“ä½œåï¼Œ<code>nums</code> å˜ä¸º <code>[11, 10]</code>ã€‚</li><li>æ­¤æ—¶ï¼Œæ•°ç»„ä¸­çš„æ‰€æœ‰å…ƒç´ éƒ½å¤§äºç­‰äº <code>10</code>ï¼Œæ‰€ä»¥åœæ­¢æ“ä½œã€‚</li><li>ä½¿æ•°ç»„ä¸­æ‰€æœ‰å…ƒç´ éƒ½å¤§äºç­‰äº <code>10</code> éœ€è¦çš„æœ€å°‘æ“ä½œæ¬¡æ•°ä¸º <code>3</code>ã€‚</li></ul></li></ul><p><strong>ç¤ºä¾‹ 2:</strong></p><ul><li>è¾“å…¥ï¼š<code>nums = [1, 1, 2, 4, 9], k = 1</code></li><li>è¾“å‡ºï¼š<code>0</code></li><li>è§£é‡Šï¼šæ•°ç»„ä¸­çš„æ‰€æœ‰å…ƒç´ éƒ½å¤§äºç­‰äº <code>1</code>ï¼Œæ‰€ä»¥ä¸éœ€è¦å¯¹ <code>nums</code> åšä»»ä½•æ“ä½œã€‚</li></ul><p><strong>ç¤ºä¾‹ 3:</strong></p><ul><li>è¾“å…¥ï¼š<code>nums = [1, 1, 2, 4, 9], k = 9</code></li><li>è¾“å‡ºï¼š<code>4</code></li><li>è§£é‡Šï¼š<code>nums</code> ä¸­åªæœ‰ä¸€ä¸ªå…ƒç´ å¤§äºç­‰äº <code>9</code>ï¼Œæ‰€ä»¥éœ€è¦æ‰§è¡Œ <code>4</code> æ¬¡æ“ä½œã€‚</li></ul><h3 id="æç¤º"><a href="#æç¤º" class="headerlink" title="æç¤º"></a>æç¤º</h3><ul><li><code>1 &lt;= nums.length &lt;= 50</code></li><li><code>1 &lt;= nums[i] &lt;= 10^9</code></li><li><code>1 &lt;= k &lt;= 10^9</code></li><li>è¾“å…¥ä¿è¯è‡³å°‘æœ‰ä¸€ä¸ªæ»¡è¶³ <code>nums[i] &gt;= k</code> çš„ä¸‹æ ‡ <code>i</code> å­˜åœ¨ã€‚</li></ul><h2 id="è§£é¢˜æ€è·¯"><a href="#è§£é¢˜æ€è·¯" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h2><p>è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œé¦–å…ˆéœ€è¦å¯¹æ•°ç»„ <code>nums</code> è¿›è¡Œæ’åºã€‚æ’åºåï¼Œæ•°ç»„ä¸­çš„æœ€å°å…ƒç´ å°†ä½äºæ•°ç»„çš„èµ·å§‹ä½ç½®ã€‚ä»æ•°ç»„çš„æœ€å°ç«¯å¼€å§‹ï¼Œæ¯é‡åˆ°ä¸€ä¸ªå°äº <code>k</code> çš„å…ƒç´ ï¼Œå°±å°†å…¶åˆ é™¤ï¼Œå¹¶å°†æ“ä½œè®¡æ•°å™¨åŠ ä¸€ã€‚å½“é‡åˆ°ç¬¬ä¸€ä¸ªå¤§äºæˆ–ç­‰äº <code>k</code> çš„å…ƒç´ æ—¶ï¼Œåœæ­¢åˆ é™¤æ“ä½œã€‚</p><p>ç»™å®šä¸€ä¸ªä» 0 å¼€å§‹çš„æ•´æ•°æ•°ç»„ <code>nums</code> å’Œä¸€ä¸ªæ•´æ•° <code>k</code>ï¼Œç›®çš„æ˜¯é€šè¿‡æœ€å°‘çš„æ“ä½œæ¬¡æ•°ä½¿æ•°ç»„ä¸­çš„æ‰€æœ‰å…ƒç´ éƒ½å¤§äºæˆ–ç­‰äº <code>k</code>ã€‚æ“ä½œå®šä¹‰ä¸ºåˆ é™¤æ•°ç»„ä¸­çš„æœ€å°å…ƒç´ ã€‚</p><h3 id="ç®—æ³•æ­¥éª¤"><a href="#ç®—æ³•æ­¥éª¤" class="headerlink" title="ç®—æ³•æ­¥éª¤"></a>ç®—æ³•æ­¥éª¤</h3><ol><li>å¯¹æ•°ç»„ <code>nums</code> è¿›è¡Œæ’åºã€‚</li><li>åˆå§‹åŒ–æ“ä½œè®¡æ•°å™¨ä¸º <code>0</code>ã€‚</li><li>éå†æ’åºåçš„æ•°ç»„ï¼Œå¯¹äºæ¯ä¸ªå°äº <code>k</code> çš„å…ƒç´ ï¼Œå¢åŠ æ“ä½œè®¡æ•°ã€‚</li><li>å½“é‡åˆ°ç¬¬ä¸€ä¸ªå¤§äºæˆ–ç­‰äº <code>k</code> çš„å…ƒç´ æ—¶ï¼Œåœæ­¢éå†ã€‚</li><li>è¿”å›æ“ä½œè®¡æ•°ã€‚</li></ol><h3 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><h4 id="ç®—æ³•æ€è·¯"><a href="#ç®—æ³•æ€è·¯" class="headerlink" title="ç®—æ³•æ€è·¯"></a>ç®—æ³•æ€è·¯</h4><ol><li><strong>æ’åºæ•°ç»„</strong>ï¼šé¦–å…ˆå°†æ•°ç»„æ’åºï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿æˆ‘ä»¬æ€»æ˜¯åœ¨æ‰§è¡Œæ“ä½œæ—¶åˆ é™¤æœ€å°çš„å…ƒç´ ã€‚</li><li><strong>è®¡æ•°æ“ä½œ</strong>ï¼šä»æ•°ç»„çš„æœ€å°ç«¯å¼€å§‹ï¼Œå¯¹äºæ¯ä¸ªå°äº <code>k</code> çš„å…ƒç´ ï¼Œæˆ‘ä»¬å°†å…¶åˆ é™¤ï¼Œå¹¶å¢åŠ æ“ä½œè®¡æ•°å™¨ã€‚</li><li><strong>åœæ­¢æ¡ä»¶</strong>ï¼šå½“æ•°ç»„ä¸­æ‰€æœ‰å‰©ä½™çš„å…ƒç´ éƒ½å¤§äºæˆ–ç­‰äº <code>k</code> æ—¶ï¼Œæ“ä½œç»“æŸã€‚</li></ol><h4 id="ç®—æ³•æ­¥éª¤-1"><a href="#ç®—æ³•æ­¥éª¤-1" class="headerlink" title="ç®—æ³•æ­¥éª¤"></a>ç®—æ³•æ­¥éª¤</h4><ol><li>å¯¹æ•°ç»„ <code>nums</code> è¿›è¡Œæ’åºã€‚</li><li>åˆå§‹åŒ–ä¸€ä¸ªæ“ä½œè®¡æ•°å™¨ã€‚</li><li>éå†æ’åºåçš„æ•°ç»„ï¼Œå¯¹äºæ¯ä¸ªå°äº <code>k</code> çš„å…ƒç´ ï¼Œå¢åŠ æ“ä½œè®¡æ•°ã€‚</li><li>å½“é‡åˆ°ç¬¬ä¸€ä¸ªå¤§äºæˆ–ç­‰äº <code>k</code> çš„å…ƒç´ æ—¶ï¼Œåœæ­¢éå†ã€‚</li><li>è¿”å›æ“ä½œè®¡æ•°ã€‚</li></ol><h3 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">min_operations</span>(<span class="params">nums, k</span>):</span><br><span class="line">    <span class="comment"># Sort the array</span></span><br><span class="line">    nums.sort()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Count the number of operations</span></span><br><span class="line">    operations = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> num <span class="keyword">in</span> nums:</span><br><span class="line">        <span class="keyword">if</span> num &lt; k:</span><br><span class="line">            operations += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> operations</span><br></pre></td></tr></tbody></table></figure><h3 id="æµ‹è¯•ç”¨ä¾‹"><a href="#æµ‹è¯•ç”¨ä¾‹" class="headerlink" title="æµ‹è¯•ç”¨ä¾‹"></a>æµ‹è¯•ç”¨ä¾‹</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(min_operations([<span class="number">2</span>, <span class="number">11</span>, <span class="number">10</span>, <span class="number">1</span>, <span class="number">3</span>], <span class="number">10</span>))  <span class="comment"># åº”è¾“å‡º: 3</span></span><br><span class="line"><span class="built_in">print</span>(min_operations([<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">9</span>], <span class="number">1</span>))     <span class="comment"># åº”è¾“å‡º: 0</span></span><br><span class="line"><span class="built_in">print</span>(min_operations([<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">9</span>], <span class="number">9</span>))     <span class="comment"># åº”è¾“å‡º: 4</span></span><br></pre></td></tr></tbody></table></figure><h3 id="å¤æ‚åº¦åˆ†æ"><a href="#å¤æ‚åº¦åˆ†æ" class="headerlink" title="å¤æ‚åº¦åˆ†æ"></a>å¤æ‚åº¦åˆ†æ</h3><ul><li><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼šO(n log n)ï¼Œä¸»è¦ç”±æ’åºæ­¥éª¤å†³å®šã€‚</li><li><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼šO(n) æˆ– O(1)ï¼Œå–å†³äºæ‰€ä½¿ç”¨çš„æ’åºç®—æ³•ã€‚å¦‚æœä½¿ç”¨åŸåœ°æ’åºç®—æ³•ï¼Œç©ºé—´å¤æ‚åº¦å¯ä»¥é™ä½åˆ° O(1)ã€‚</li></ul><h3 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h3><p>è¿™ä¸ªè§£å†³æ–¹æ¡ˆé€šè¿‡æ’åºå’Œç®€å•çš„çº¿æ€§éå†ï¼Œæœ‰æ•ˆåœ°æ‰¾å‡ºäº†å°†æ•°ç»„ä¸­æ‰€æœ‰å…ƒç´ å˜å¾—å¤§äºæˆ–ç­‰äº <code>k</code> æ‰€éœ€çš„æœ€å°‘æ“ä½œæ¬¡æ•°ã€‚å®ƒé€‚ç”¨äºä¸åŒçš„è¾“å…¥åœºæ™¯ï¼Œå¹¶ä¸”åœ¨æ—¶é—´å’Œç©ºé—´æ•ˆç‡æ–¹é¢è¡¨ç°è‰¯å¥½ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Code Chronicles </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> Leetcode </tag>
            
            <tag> åŒå‘¨èµ› </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€Pythoné¢˜è§£ã€‘2369. æ£€æŸ¥æ•°ç»„æ˜¯å¦å­˜åœ¨æœ‰æ•ˆåˆ’åˆ†</title>
      <link href="/2024/03/01/Code%20Chronicles/2369.%20%E6%A3%80%E6%9F%A5%E6%95%B0%E7%BB%84%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8%E6%9C%89%E6%95%88%E5%88%92%E5%88%86/"/>
      <url>/2024/03/01/Code%20Chronicles/2369.%20%E6%A3%80%E6%9F%A5%E6%95%B0%E7%BB%84%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8%E6%9C%89%E6%95%88%E5%88%92%E5%88%86/</url>
      
        <content type="html"><![CDATA[<h1 id="ã€Python-é¢˜è§£ã€‘2369-æ£€æŸ¥æ•°ç»„çš„æœ‰æ•ˆåˆ’åˆ†æ–¹æ³•"><a href="#ã€Python-é¢˜è§£ã€‘2369-æ£€æŸ¥æ•°ç»„çš„æœ‰æ•ˆåˆ’åˆ†æ–¹æ³•" class="headerlink" title="ã€Python é¢˜è§£ã€‘2369. æ£€æŸ¥æ•°ç»„çš„æœ‰æ•ˆåˆ’åˆ†æ–¹æ³•"></a>ã€Python é¢˜è§£ã€‘2369. æ£€æŸ¥æ•°ç»„çš„æœ‰æ•ˆåˆ’åˆ†æ–¹æ³•</h1><h2 id="é¢˜ç›®æ¦‚è¿°"><a href="#é¢˜ç›®æ¦‚è¿°" class="headerlink" title="é¢˜ç›®æ¦‚è¿°"></a>é¢˜ç›®æ¦‚è¿°</h2><p>Leetcode çš„é¢˜ç›® 2369 è¦æ±‚æˆ‘ä»¬æ£€æŸ¥ä¸€ä¸ªæ•´æ•°æ•°ç»„<code>nums</code>æ˜¯å¦å¯ä»¥åˆ’åˆ†ä¸ºä¸€ä¸ªæˆ–å¤šä¸ªæ»¡è¶³ç‰¹å®šæ¡ä»¶çš„è¿ç»­å­æ•°ç»„ã€‚æœ‰æ•ˆçš„åˆ’åˆ†æ¡ä»¶åŒ…æ‹¬ï¼š</p><ul><li>å­æ•°ç»„ç”±ä¸¤ä¸ªç›¸ç­‰çš„å…ƒç´ ç»„æˆï¼Œå¦‚ <code>[2, 2]</code>ã€‚</li><li>å­æ•°ç»„ç”±ä¸‰ä¸ªç›¸ç­‰çš„å…ƒç´ ç»„æˆï¼Œå¦‚ <code>[3, 3, 3]</code>ã€‚</li><li>å­æ•°ç»„ç”±ä¸‰ä¸ªè¿ç»­é€’å¢çš„å…ƒç´ ç»„æˆï¼Œä¸”ç›¸é‚»å…ƒç´ ä¹‹é—´å·®å€¼ä¸º 1ï¼Œå¦‚ <code>[4, 5, 6]</code>ã€‚</li></ul><p>å¦‚æœæ•°ç»„è‡³å°‘å­˜åœ¨ä¸€ç§æœ‰æ•ˆåˆ’åˆ†ï¼Œåˆ™è¿”å›<code>true</code>ï¼›å¦åˆ™è¿”å›<code>false</code>ã€‚</p><h2 id="ç¤ºä¾‹åˆ†æ"><a href="#ç¤ºä¾‹åˆ†æ" class="headerlink" title="ç¤ºä¾‹åˆ†æ"></a>ç¤ºä¾‹åˆ†æ</h2><ul><li>ç¤ºä¾‹ 1ï¼š<code>nums = [4, 4, 4, 5, 6]</code>å¯ä»¥åˆ’åˆ†ä¸º <code>[4, 4]</code> å’Œ <code>[4, 5, 6]</code>ï¼Œå› æ­¤è¿”å›<code>true</code>ã€‚</li><li>ç¤ºä¾‹ 2ï¼š<code>nums = [1, 1, 1, 2]</code>ä¸æ»¡è¶³ä»»ä½•åˆ’åˆ†æ¡ä»¶ï¼Œå› æ­¤è¿”å›<code>false</code>ã€‚</li></ul><h2 id="è§£é¢˜æ€è·¯"><a href="#è§£é¢˜æ€è·¯" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h2><p>é‡‡ç”¨<strong>åŠ¨æ€è§„åˆ’</strong>ç­–ç•¥ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå¸ƒå°”æ•°ç»„<code>dp</code>ï¼Œå…¶ä¸­<code>dp[i]</code>è¡¨ç¤ºæ•°ç»„çš„å‰<code>i</code>ä¸ªå…ƒç´ æ˜¯å¦å¯ä»¥æœ‰æ•ˆåœ°åˆ’åˆ†ã€‚éå†æ•°ç»„ï¼Œå¯¹äºæ¯ä¸ªä½ç½®<code>i</code>ï¼Œå°è¯•ä»¥ä¸‹ä¸‰ç§åˆ’åˆ†æ–¹å¼ï¼š</p><ol><li>å­æ•°ç»„ç”±æœ€åä¸¤ä¸ªç›¸ç­‰çš„å…ƒç´ ç»„æˆã€‚</li><li>å­æ•°ç»„ç”±æœ€åä¸‰ä¸ªç›¸ç­‰çš„å…ƒç´ ç»„æˆã€‚</li><li>å­æ•°ç»„ç”±æœ€åä¸‰ä¸ªè¿ç»­é€’å¢çš„å…ƒç´ ç»„æˆã€‚</li></ol><h2 id="ç®—æ³•æµç¨‹"><a href="#ç®—æ³•æµç¨‹" class="headerlink" title="ç®—æ³•æµç¨‹"></a>ç®—æ³•æµç¨‹</h2><ol><li>åˆå§‹åŒ– dp[0] ä¸º trueï¼Œè¡¨ç¤ºç©ºæ•°ç»„å¯ä»¥æœ‰æ•ˆåˆ’åˆ†ã€‚</li><li>å¯¹äºæ¯ä¸ª iï¼ˆä» 2 å¼€å§‹ï¼‰ï¼Œæ£€æŸ¥æ˜¯å¦å¯ä»¥é€šè¿‡ä¸Šè¿°ä¸‰ç§æ–¹å¼ä¹‹ä¸€å°†æ•°ç»„åˆ’åˆ†åˆ° iã€‚</li><li>æœ€ç»ˆï¼Œdp[n]ï¼ˆå…¶ä¸­ n æ˜¯æ•°ç»„çš„é•¿åº¦ï¼‰ç»™å‡ºäº†æ•´ä¸ªæ•°ç»„æ˜¯å¦å¯ä»¥æœ‰æ•ˆåˆ’åˆ†çš„ç­”æ¡ˆã€‚</li><li>å¦‚æœä»»ä½•ä¸€ç§æ–¹å¼å¯è¡Œï¼Œåˆ™å°†<code>dp[i]</code>è®¾ç½®ä¸º<code>true</code>ã€‚</li></ol><p>å…·ä½“æ¥è®²<br>åˆå§‹åŒ–ï¼š</p><ol><li>åˆå§‹åŒ– dp[0]ä¸º trueï¼Œè¡¨ç¤ºç©ºæ•°ç»„æ˜¯å¯ä»¥è¢«æœ‰æ•ˆåˆ’åˆ†çš„ã€‚</li><li>çŠ¶æ€è½¬ç§»ï¼šå¯¹äºæ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´  nums[i]ï¼ˆä»ç¬¬äºŒä¸ªå…ƒç´ å¼€å§‹ï¼‰ï¼Œè€ƒè™‘ä»¥ä¸‹å‡ ç§æƒ…å†µï¼š<ul><li>å¦‚æœ nums[i]ä¸ nums[i-1]ç›¸ç­‰ï¼Œæ£€æŸ¥ dp[i-2]æ˜¯å¦ä¸º trueã€‚å¦‚æœæ˜¯ï¼Œè¡¨ç¤º[nums[i-1], nums[i]]å¯ä»¥å½¢æˆæœ‰æ•ˆåˆ’åˆ†ï¼Œè®¾ç½® dp[i]ä¸º trueã€‚</li><li>å¦‚æœ nums[i]ã€nums[i-1]å’Œ nums[i-2]ä¸‰è€…ç›¸ç­‰ï¼ŒåŒæ ·æ£€æŸ¥ dp[i-3]ã€‚å¦‚æœ dp[i-3]ä¸º trueï¼Œè¡¨ç¤º[nums[i-2], nums[i-1], nums[i]]å¯ä»¥å½¢æˆæœ‰æ•ˆåˆ’åˆ†ï¼Œè®¾ç½® dp[i]ä¸º trueã€‚</li><li>å¦‚æœ nums[i]ã€nums[i-1]å’Œ nums[i-2]å½¢æˆè¿ç»­é€’å¢åºåˆ—ï¼ˆå³ nums[i]-1 == nums[i-1]ä¸” nums[i-1]-1 == nums[i-2]ï¼‰ï¼Œæ£€æŸ¥ dp[i-3]ã€‚è‹¥ä¸º trueï¼Œåˆ™è®¾ç½® dp[i]ä¸º trueã€‚</li></ul></li><li>ç»“æœåˆ¤æ–­ï¼š<ul><li>æœ€ç»ˆï¼Œæ£€æŸ¥ dp[n]çš„å€¼ï¼ˆå…¶ä¸­ n æ˜¯æ•°ç»„ nums çš„é•¿åº¦ï¼‰ã€‚å¦‚æœ dp[n]ä¸º trueï¼Œåˆ™è¡¨ç¤ºæ•´ä¸ªæ•°ç»„å¯ä»¥è¢«æœ‰æ•ˆåˆ’åˆ†ï¼›å¦åˆ™ï¼Œä¸å¯ä»¥ã€‚</li></ul></li></ol><h2 id="åŠ¨æ€è§„åˆ’å®ç°"><a href="#åŠ¨æ€è§„åˆ’å®ç°" class="headerlink" title="åŠ¨æ€è§„åˆ’å®ç°"></a>åŠ¨æ€è§„åˆ’å®ç°</h2><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">validPartition</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">        n = <span class="built_in">len</span>(nums)</span><br><span class="line">        dp = [<span class="literal">False</span>] * (n + <span class="number">1</span>)</span><br><span class="line">        dp[<span class="number">0</span>] = <span class="literal">True</span>  <span class="comment"># ç©ºæ•°ç»„è§†ä¸ºæœ‰æ•ˆåˆ’åˆ†</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>, n + <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">if</span> nums[i - <span class="number">1</span>] == nums[i - <span class="number">2</span>]:</span><br><span class="line">                dp[i] = dp[i] <span class="keyword">or</span> dp[i - <span class="number">2</span>]</span><br><span class="line">            <span class="keyword">if</span> i &gt; <span class="number">2</span> <span class="keyword">and</span> nums[i - <span class="number">1</span>] == nums[i - <span class="number">2</span>] == nums[i - <span class="number">3</span>]:</span><br><span class="line">                dp[i] = dp[i] <span class="keyword">or</span> dp[i - <span class="number">3</span>]</span><br><span class="line">            <span class="keyword">if</span> i &gt; <span class="number">2</span> <span class="keyword">and</span> nums[i - <span class="number">1</span>] - <span class="number">1</span> == nums[i - <span class="number">2</span>] <span class="keyword">and</span> nums[i - <span class="number">2</span>] - <span class="number">1</span> == nums[i - <span class="number">3</span>]:</span><br><span class="line">                dp[i] = dp[i] <span class="keyword">or</span> dp[i - <span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> dp[n]</span><br></pre></td></tr></tbody></table></figure><h2 id="ç®—æ³•å¤æ‚åº¦åˆ†æ"><a href="#ç®—æ³•å¤æ‚åº¦åˆ†æ" class="headerlink" title="ç®—æ³•å¤æ‚åº¦åˆ†æ"></a>ç®—æ³•å¤æ‚åº¦åˆ†æ</h2><ul><li><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼šO(N)ï¼Œå…¶ä¸­ N æ˜¯æ•°ç»„<code>nums</code>çš„é•¿åº¦ï¼Œéœ€è¦éå†æ•´ä¸ªæ•°ç»„æ¥å¡«å……åŠ¨æ€è§„åˆ’æ•°ç»„ã€‚</li><li><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼šO(N)ï¼Œç”¨äºå­˜å‚¨åŠ¨æ€è§„åˆ’æ•°ç»„<code>dp</code>ï¼Œè®°å½•æ¯ä¸ªä½ç½®çš„åˆ’åˆ†æƒ…å†µã€‚</li></ul><p>é€šè¿‡åŠ¨æ€è§„åˆ’ï¼Œæˆ‘ä»¬æä¾›äº†ä¸€ç§é«˜æ•ˆä¸”ç›´è§‚çš„è§£å†³æ–¹æ¡ˆï¼Œç¡®ä¿ç®—æ³•çš„ä¼˜åŒ–æ€§èƒ½ï¼Œé€‚ç”¨äºç±»ä¼¼çš„æ•°ç»„åˆ’åˆ†é—®é¢˜ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Code Chronicles </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> Leetcode </tag>
            
            <tag> æ¯æ—¥ä¸€é¢˜ </tag>
            
            <tag> åŠ¨æ€è§„åˆ’ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Gorilla LLM å¤§è¯­è¨€æ¨¡å‹ç®€ä»‹</title>
      <link href="/2024/02/28/NLP%20Insights/Gorilla:%20Large%20Language%20Model%20Connected%20with%20Massive%20APIs/"/>
      <url>/2024/02/28/NLP%20Insights/Gorilla:%20Large%20Language%20Model%20Connected%20with%20Massive%20APIs/</url>
      
        <content type="html"><![CDATA[<h1 id="Gorilla-LLM-å¤§è¯­è¨€æ¨¡å‹ç®€ä»‹"><a href="#Gorilla-LLM-å¤§è¯­è¨€æ¨¡å‹ç®€ä»‹" class="headerlink" title="Gorilla LLM å¤§è¯­è¨€æ¨¡å‹ç®€ä»‹"></a>Gorilla LLM å¤§è¯­è¨€æ¨¡å‹ç®€ä»‹</h1><p>ğŸ¦ Gorilla: Large Language Model Connected with Massive APIs<br>Link: <a href="https://gorilla.cs.berkeley.edu/blogs/7_open_functions_v2.html">https://gorilla.cs.berkeley.edu/blogs/7_open_functions_v2.html</a></p><ul><li>Berkeley åŠŸèƒ½è°ƒç”¨æ’è¡Œæ¦œ<a href="https://gorilla.cs.berkeley.edu/leaderboard.html">Berkeley åŠŸèƒ½è°ƒç”¨æ’è¡Œæ¦œ</a></li><li>åœ¨çº¿ä½“éªŒæ¨¡å‹ï¼š<a href="https://gorilla.cs.berkeley.edu/leaderboard.html">Gorilla OpenFunctions-v2 ç½‘ç»œæ¼”ç¤º</a></li><li>é¡¹ç›®è¯¦æƒ…ï¼š<a href="https://github.com/ShishirPatil/gorilla/tree/main/openfunctions">GitHub</a></li><li>æ¨¡å‹ï¼ˆ7B å‚æ•°ï¼‰åœ¨ HuggingFace ä¸Šçš„é¡µé¢ï¼š<a href="https://huggingface.co/gorilla-llm/gorilla-openfunctions-v2">gorilla-llm/gorilla-openfunctions-v2</a></li></ul><h2 id="1-ä¼¯å…‹åˆ©å‡½æ•°è°ƒç”¨æ’è¡Œæ¦œ"><a href="#1-ä¼¯å…‹åˆ©å‡½æ•°è°ƒç”¨æ’è¡Œæ¦œ" class="headerlink" title="1. ä¼¯å…‹åˆ©å‡½æ•°è°ƒç”¨æ’è¡Œæ¦œ"></a>1. ä¼¯å…‹åˆ©å‡½æ•°è°ƒç”¨æ’è¡Œæ¦œ</h2><p>è‡ª 2022 å¹´åº•ä»¥æ¥ï¼Œå¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMsï¼‰å‡­å€Ÿå…¶æ‰§è¡Œé€šç”¨ä»»åŠ¡çš„å¼ºå¤§èƒ½åŠ›ï¼Œæˆä¸ºä¼—äººå…³æ³¨çš„ç„¦ç‚¹ã€‚ä¸ä»…é™äºèŠå¤©åº”ç”¨ï¼Œå°†è¿™äº›æ¨¡å‹åº”ç”¨äºå¼€å‘å„ç±» AI åº”ç”¨å’Œè½¯ä»¶ï¼ˆå¦‚ Langchain, Llama Index, AutoGPT, Voyagerï¼‰å·²æˆä¸ºä¸€ç§è¶‹åŠ¿ã€‚GPT, Gemini, Llama, Mistral ç­‰æ¨¡å‹é€šè¿‡ä¸å¤–éƒ¨ä¸–ç•Œçš„äº¤äº’ï¼Œå¦‚å‡½æ•°è°ƒç”¨å’Œæ‰§è¡Œï¼Œå±•ç°äº†å…¶å·¨å¤§æ½œåŠ›ã€‚</p><p>æˆ‘ä»¬æ¨å‡ºäº†<strong>ä¼¯å…‹åˆ©å‡½æ•°è°ƒç”¨æ’è¡Œæ¦œï¼ˆBFCLï¼‰</strong>ï¼Œè¿™æ˜¯é¦–ä¸ªå…¨é¢ä¸”å¯æ‰§è¡Œçš„ LLMs å‡½æ•°è°ƒç”¨è¯„ä¼°ã€‚ä¸ä¹‹å‰çš„è¯„ä¼°å¦‚ Anyscale å‡½æ•°è°ƒç”¨æ•°æ®é›†ä¸åŒï¼Œæˆ‘ä»¬è€ƒè™‘äº†æ›´å¤šå½¢å¼çš„å‡½æ•°è°ƒç”¨ã€ä¸åŒåœºæ™¯ä¸‹çš„è°ƒç”¨ï¼Œä»¥åŠå‡½æ•°è°ƒç”¨çš„å¯æ‰§è¡Œæ€§ã€‚æˆ‘ä»¬æ ¹æ®å®é™…åº”ç”¨åœºæ™¯æ„å»ºäº†è¿™ä¸ªæ•°æ®é›†ï¼Œæ¶µç›–äº†å¤§å¤šæ•°ç”¨æˆ·å¯èƒ½é‡åˆ°çš„å‡½æ•°è°ƒç”¨ç”¨ä¾‹ï¼Œä¾‹å¦‚åœ¨ AI æ™ºèƒ½ä½“æˆ–ä¼ä¸šå·¥ä½œæµç¨‹ä¸­çš„åº”ç”¨ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬çš„è¯„ä¼°æ•°æ®é›†åŒ…å«äº†ä¸°å¯Œçš„ç±»åˆ«ï¼Œè¦†ç›–äº†å¤šç§è¯­è¨€ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬è¿˜å‘å¸ƒäº† Gorilla-Openfunctions-v2 æ¨¡å‹ï¼Œè¿™æ˜¯ç›®å‰æœ€å…ˆè¿›çš„å¼€æºæ¨¡å‹ï¼Œèƒ½å¤Ÿå¤„ç†å¤šç§ç¼–ç¨‹è¯­è¨€çš„å‡½æ•°è°ƒç”¨ï¼ŒåŒ…æ‹¬å¹¶è¡Œå’Œå¤šé‡å‡½æ•°è°ƒç”¨ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜æä¾›äº†ä¸€é¡¹ç‰¹æ®Šçš„è°ƒè¯•åŠŸèƒ½ï¼Œå³å½“æä¾›çš„å‡½æ•°ä¸ç¬¦åˆä»»åŠ¡è¦æ±‚æ—¶ï¼Œæ¨¡å‹ä¼šè¾“å‡ºâ€œé”™è¯¯æ¶ˆæ¯â€ã€‚</p><p><a href="https://gorilla.cs.berkeley.edu/leaderboard#api-explorer">https://gorilla.cs.berkeley.edu/leaderboard#api-explorer</a></p><h3 id="ä¼¯å…‹åˆ©å‡½æ•°è°ƒç”¨æ’è¡Œæ¦œ-ğŸ†"><a href="#ä¼¯å…‹åˆ©å‡½æ•°è°ƒç”¨æ’è¡Œæ¦œ-ğŸ†" class="headerlink" title="ä¼¯å…‹åˆ©å‡½æ•°è°ƒç”¨æ’è¡Œæ¦œ ğŸ†"></a>ä¼¯å…‹åˆ©å‡½æ•°è°ƒç”¨æ’è¡Œæ¦œ ğŸ†</h3><p>ä¼¯å…‹åˆ©å‡½æ•°è°ƒç”¨</p><p>æ’è¡Œæ¦œï¼ˆBFCLï¼‰æ—¨åœ¨å…¨é¢ç ”ç©¶ä¸åŒ LLMs åœ¨å‡½æ•°è°ƒç”¨èƒ½åŠ›ä¸Šçš„è¡¨ç°ã€‚å®ƒåŒ…å«äº† 2000 ä¸ªåŒ…å«å¤šç§ç¼–ç¨‹è¯­è¨€ï¼ˆPython, Java, JavaScript, REST APIï¼‰çš„é—®é¢˜-å‡½æ•°-ç­”æ¡ˆå¯¹ï¼Œè¦†ç›–äº†å¤šæ ·åŒ–çš„åº”ç”¨é¢†åŸŸå’Œå¤æ‚çš„ç”¨ä¾‹ï¼ˆå¦‚å¤šé‡å‡½æ•°è°ƒç”¨å’Œå¹¶è¡Œå‡½æ•°è°ƒç”¨ï¼‰ã€‚æˆ‘ä»¬è¿˜ç ”ç©¶äº†å‡½æ•°ç›¸å…³æ€§æ£€æµ‹ï¼Œä»¥ç¡®å®šæ¨¡å‹å¯¹ä¸é€‚åˆçš„å‡½æ•°å¦‚ä½•ä½œå‡ºååº”ï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹ä¼šæä¾›â€œé”™è¯¯æ¶ˆæ¯â€ï¼‰ã€‚å…·ä½“æ¥è¯´ï¼ŒBFCL åŒ…æ‹¬äº† 100 ä¸ª Javaã€50 ä¸ª JavaScriptã€70 ä¸ª REST APIã€100 ä¸ª SQL å’Œ 1680 ä¸ª Python çš„å„ç§ç®€å•ã€å¹¶è¡Œã€å¤šé‡ã€å¯æ‰§è¡Œå‡½æ•°è°ƒç”¨åœºæ™¯ä»¥åŠå‡½æ•°ç›¸å…³æ€§æ£€æµ‹ã€‚</p><p>æ’è¡Œæ¦œæ˜¾ç¤ºï¼ŒOpenAI çš„ GPT-4 åœ¨å‡½æ•°è°ƒç”¨è¯„ä¼°ä¸­ä»é¢†å…ˆï¼Œè€Œ Gorilla OpenFunctions-v2ï¼ˆæ¥è‡ª Gorilla LLMï¼‰çš„è¡¨ç°å‡ ä¹ä¸ä¹‹åª²ç¾ã€‚å…¶åæ˜¯ Mistral-medium æ¨¡å‹ï¼ˆæ¥è‡ª Mistral AIï¼‰å’Œ Claude-2.1ï¼ˆæ¥è‡ª Anthropicï¼‰ã€‚è¿™è¯´æ˜ï¼Œä¸€ä¸ªç»è¿‡å¾®è°ƒçš„å¼€æºæ¨¡å‹åœ¨å‡½æ•°è°ƒç”¨ä»»åŠ¡ä¸Šä¹Ÿå¯ä»¥è¾¾åˆ°ä¸ä¸“æœ‰æ¨¡å‹ç›¸è¿‘çš„æ°´å¹³ï¼Œè€Œæ— éœ€è¿›è¡Œå¤æ‚çš„é“¾æ¥ã€‚</p><p>æˆ‘ä»¬è‡´åŠ›äºæ¶µç›–çœŸå®ä¸–ç•Œçš„ç”¨ä¾‹å’Œå¤šæ ·çš„è¯­è¨€ã€‚æœªæ¥ï¼Œæˆ‘ä»¬å°†ç»§ç»­æ‰©å±•æµ‹è¯•é¢†åŸŸï¼Œå¹¶æ¢ç´¢æ›´å¤šåˆ›æ–°ç”¨ä¾‹ã€‚</p><p><img src="https://gorilla.cs.berkeley.edu/assets/img/blog_post_8_Leaderboard.jpg" alt="https://gorilla.cs.berkeley.edu/assets/img/blog_post_8_Leaderboard.jpg"></p><p><em>LLMs åœ¨ä¼¯å…‹åˆ©å‡½æ•°è°ƒç”¨æ’è¡Œæ¦œï¼ˆBFCLï¼‰ä¸Šçš„è¡¨ç°</em></p><p>ä¸ºäº†æ›´æ·±å…¥åœ°åˆ†æå’Œå¯è§†åŒ–ç»“æœï¼Œæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªäº¤äº’å¼çš„å…­è¾¹å½¢å·¥å…·ï¼Œä¾›ç”¨æˆ·æ¯”è¾ƒä¸åŒæ¨¡å‹çš„æ€§èƒ½ã€‚æˆ‘ä»¬å°†æµ‹è¯•åˆ†ä¸º 9 ä¸ªç±»åˆ«ï¼ŒåŒ…æ‹¬å‡½æ•°ä¸ç›¸å…³æ€§æ£€æµ‹ã€AST æ ‘æ£€æŸ¥å’Œæ‰§è¡Œå‡½æ•°è°ƒç”¨æ£€æŸ¥ï¼Œç”¨äºç®€å•ã€å¤šé‡ã€å¹¶è¡Œå¤šåŠŸèƒ½åœºæ™¯ã€‚é€šè¿‡è¿™ä¸ªå·¥å…·ï¼Œæˆ‘ä»¬å¯ä»¥æ¸…æ¥šåœ°çœ‹åˆ°å„ä¸ªæµ‹è¯•ä¸­æ¨¡å‹çš„è¡¨ç°ã€‚åœ¨ç®€å•å•ä¸€å‡½æ•°è°ƒç”¨æ–¹é¢ï¼Œä¸“æœ‰æ¨¡å‹å’Œå¼€æºæ¨¡å‹è¡¨ç°ç±»ä¼¼ã€‚ä½†åœ¨æ¶‰åŠå¤šé‡å’Œå¹¶è¡Œå‡½æ•°è°ƒç”¨æ—¶ï¼ŒGPT ç³»åˆ—æ¨¡å‹çš„è¡¨ç°è¶…è¿‡äº†å¼€æºæ¨¡å‹ã€‚</p><p><img src="https://gorilla.cs.berkeley.edu/assets/img/blog_post_8_Wagon.gif" alt="https://gorilla.cs.berkeley.edu/assets/img/blog_post_8_Wagon.gif"></p><p><em>ä½¿ç”¨ä¼¯å…‹åˆ©å‡½æ•°è°ƒç”¨æ’è¡Œæ¦œï¼ˆBFCLï¼‰å…­è¾¹å½¢å›¾è¿›è¡Œçš„è¯¦ç»†åˆ†æ</em></p><h3 id="æ•°æ®é›†ç»„æˆ"><a href="#æ•°æ®é›†ç»„æˆ" class="headerlink" title="æ•°æ®é›†ç»„æˆ"></a>æ•°æ®é›†ç»„æˆ</h3><p>Gorilla OpenFunctions çš„è¯„ä¼°æ•°æ®é›†å·²ä»æœ€åˆçš„ 100 ä¸ªæ¡ç›®æ‰©å±•åˆ° 1900 ä¸ªã€‚è¯„ä¼°æ•°æ®é›†åœ¨ä»¥ä¸‹æ–¹é¢å±•ç°äº†å¤šæ ·æ€§ï¼š</p><ul><li>å‡½æ•°æ–‡æ¡£é¢†åŸŸ</li><li>å‡½æ•°æ–‡æ¡£å’Œå‡½æ•°è°ƒç”¨é—®ç­”å¯¹çš„æ•°é‡</li><li>ä¸åŒç¼–ç¨‹è¯­è¨€çš„æ•°æ®ç±»å‹</li></ul><p>æˆ‘ä»¬çš„è¯„ä¼° JSON å‡½æ•°æ˜¯ä»ä¸åŒç½‘ç«™æ¥æºæŠ“å–å’Œç”Ÿæˆçš„ã€‚æˆ‘ä»¬ç‰¹æ„åŒ…å«äº†åƒæ•°å­¦ä»£æ•°ã€ä½“è‚²è¶³çƒã€é‡‘èæŠµæŠ¼ç­‰é¢†åŸŸã€‚æˆ‘ä»¬åœ¨è¯„ä¼°ä¸­åŒ…æ‹¬äº† 40 ä¸ªå­é¢†åŸŸçš„å‡½æ•°ï¼Œè¿™ä½¿æˆ‘ä»¬èƒ½å¤Ÿäº†è§£æ¨¡å‹æ€§èƒ½åœ¨æ•°æ®ä¸°å¯Œçš„é¢†åŸŸï¼ˆå¦‚è®¡ç®—å’Œäº‘ï¼‰ä»¥åŠä½“è‚²ã€æ³•å¾‹ç­‰å°ä¼—é¢†åŸŸçš„è¡¨ç°ã€‚</p><p><img src="https://gorilla.cs.berkeley.edu/assets/img/blog_post_8_data_composition.png" alt="https://gorilla.cs.berkeley.edu/assets/img/blog_post_8_data_composition.png"></p><p><em>ä¼¯å…‹åˆ©å‡½æ•°è°ƒç”¨æ’è¡Œæ¦œï¼ˆBFCLï¼‰æ•°æ®ç»„æˆ</em></p><h3 id="è¯„ä¼°ç±»åˆ«-ğŸ“Š"><a href="#è¯„ä¼°ç±»åˆ«-ğŸ“Š" class="headerlink" title="è¯„ä¼°ç±»åˆ« ğŸ“Š"></a>è¯„ä¼°ç±»åˆ« ğŸ“Š</h3><p>æˆ‘ä»¬å°†è¯„ä¼°ä¸»è¦åˆ†ä¸ºä¸¤å¤§ç±»ï¼š</p><ul><li>Pythonï¼šç®€å•å‡½æ•°ã€å¤šé‡å‡½æ•°ã€å¹¶è¡Œå‡½æ•°ã€å¹¶è¡Œå¤šé‡å‡½æ•°</li><li>é Pythonï¼šå‡½æ•°ç›¸å…³æ€§æ£€æµ‹ã€REST APIã€SQLã€Javaã€JavaScript</li></ul><h3 id="Python-è¯„ä¼°"><a href="#Python-è¯„ä¼°" class="headerlink" title="Python è¯„ä¼°"></a>Python è¯„ä¼°</h3><ul><li><strong>ç®€å•å‡½æ•°ï¼š</strong>è¿™ä¸€ç±»åˆ«åŒ…å«äº†æœ€å¸¸è§çš„æ ¼å¼ï¼šç”¨æˆ·æä¾›ä¸€ä¸ª JSON å‡½æ•°æ–‡æ¡£ï¼Œæ¨¡å‹åªè°ƒç”¨å…¶ä¸­ä¸€ä¸ªå‡½æ•°ã€‚</li><li><strong>å¤šé‡å‡½æ•°ï¼š</strong>è¿™ä¸€ç±»åˆ«åŒ…å«äº†éœ€è¦ä» 2-4 ä¸ª JSON å‡½æ•°æ–‡æ¡£ä¸­é€‰æ‹©å¹¶è°ƒç”¨ä¸€ä¸ªå‡½æ•°çš„ç”¨æˆ·é—®é¢˜ã€‚æ¨¡å‹éœ€è¦æ ¹æ®ç”¨æˆ·æä¾›çš„ä¸Šä¸‹æ–‡é€‰æ‹©æœ€åˆé€‚çš„å‡½æ•°ã€‚</li><li><strong>å¹¶è¡Œå‡½æ•°ï¼š</strong>å¹¶è¡Œå‡½æ•°å®šä¹‰ä¸ºä½¿ç”¨ä¸€ä¸ªç”¨æˆ·æŸ¥è¯¢åŒæ—¶è°ƒç”¨å¤šä¸ªå‡½æ•°ã€‚æ¨¡å‹éœ€è¦åˆ¤æ–­éœ€è¦è°ƒç”¨å¤šå°‘ä¸ªå‡½æ•°ï¼Œé—®é¢˜å¯ä»¥æ˜¯å•ä¸ªæˆ–å¤šä¸ªå¥å­ã€‚</li><li><strong>å¹¶è¡Œå¤šé‡å‡½æ•°ï¼š</strong>å¹¶è¡Œå¤šé‡å‡½æ•°æ˜¯å¹¶è¡Œå‡½æ•°å’Œå¤šé‡å‡½æ•°çš„ç»“åˆï¼Œå³æ¨¡å‹è¢«æä¾›äº†å¤šä¸ªå‡½æ•°æ–‡æ¡£ï¼Œæ¯ä¸ªæ–‡æ¡£ä¸­çš„å‡½æ•°å¯èƒ½è¢«è°ƒç”¨ä¸€æ¬¡æˆ–å¤šæ¬¡ã€‚</li></ul><p>æ¯ä¸ªç±»åˆ«éƒ½æœ‰ç›¸åº”çš„å¯æ‰§è¡Œç±»åˆ«ã€‚åœ¨è¿™éƒ¨åˆ†ï¼Œæˆ‘ä»¬æ ¹æ®ä¸€äº›å…è´¹çš„ REST API ç«¯ç‚¹ï¼ˆä¾‹å¦‚è·å–å¤©æ°”ï¼‰å’Œç›´æ¥è®¡ç®—çš„å‡½æ•°ï¼ˆä¾‹å¦‚çº¿æ€§å›å½’ï¼‰ç¼–å†™äº†å‡½æ•°ä»£ç ã€‚å¯æ‰§è¡Œç±»åˆ«æ—¨åœ¨åˆ¤æ–­å‡½æ•°è°ƒç”¨ç”Ÿæˆæ˜¯å¦èƒ½å¤Ÿåœ¨å®é™…åº”ç”¨ä¸­ä½¿ç”¨ã€‚</p><h3 id="é-Python-è¯„ä¼°"><a href="#é-Python-è¯„ä¼°" class="headerlink" title="é Python è¯„ä¼°"></a>é Python è¯„ä¼°</h3><p>é™¤äº†ä¸Šè¿°ä¸»è¦ç±»åˆ«å¤–ï¼Œæˆ‘ä»¬è¿˜åŒ…å«äº†æ›´å…·ä½“çš„ç±»åˆ«æ¥è¯„ä¼°æ¨¡å‹åœ¨ä¸åŒåœºæ™¯ä¸‹çš„è¡¨ç°ï¼Œå¹¶æµ‹è¯•å…¶å¯¹ä¸ç›¸å…³é—®é¢˜å’Œå‡½æ•°æ–‡æ¡£çš„åº”å¯¹èƒ½åŠ›ã€‚</p><ul><li>å‡½æ•°ç›¸å…³æ€§æ£€æµ‹ï¼šè¿™ä¸€ç±»åˆ«è®¾è®¡äº†ä¸€ä¸ªåœºæ™¯ï¼Œå…¶ä¸­æä¾›çš„ä»»ä½•å‡½æ•°éƒ½ä¸ç›¸å…³ï¼Œä¹Ÿä¸åº”è¯¥è¢«è°ƒç”¨ã€‚æˆ‘ä»¬æœŸæœ›æ¨¡å‹çš„è¾“å‡ºæ˜¯æ²¡æœ‰å‡½æ•°è°ƒç”¨ã€‚è¿™ä¸ªåœºæ™¯å¸®åŠ©æˆ‘ä»¬äº†è§£æ¨¡å‹æ˜¯å¦ä¼šåœ¨ç¼ºä¹ç”Ÿæˆå‡½æ•°ä»£ç çš„ä¿¡æ¯æ—¶äº§ç”Ÿé”™è¯¯ã€‚</li><li><strong>REST API</strong>ï¼šç°å®ä¸–ç•Œä¸­çš„å¤§å¤šæ•° API è°ƒç”¨éƒ½æ˜¯ REST API è°ƒç”¨ã€‚Python ä¸»è¦é€šè¿‡ requests.get(), requests.post(), requests.delete()ç­‰æ–¹æ³•åœ¨ python requests åº“ä¸­å®Œæˆ REST API è°ƒç”¨ã€‚</li><li><strong>GET è¯·æ±‚ï¼š</strong>GET è¯·æ±‚æ˜¯ç°å®ä¸–ç•Œä¸­æœ€å¸¸ç”¨çš„ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åŒ…æ‹¬äº†çœŸå®ä¸–ç•Œçš„ GET è¯·æ±‚æ¥æµ‹è¯•æ¨¡å‹ç”Ÿæˆå¯æ‰§è¡Œ REST API è°ƒç”¨çš„èƒ½åŠ›ã€‚æˆ‘ä»¬çš„è¯„ä¼°åŒ…æ‹¬ä¸¤ç§å˜ä½“ï¼šä¸€ç§æ˜¯éœ€è¦åœ¨ URL ä¸­ä¼ é€’å‚æ•°çš„ï¼Œå¦ä¸€ç§æ˜¯éœ€è¦å°†å‚æ•°ä½œä¸ºé”®/å€¼å¯¹æ”¾å…¥ requests.get()çš„ params å’Œ/æˆ– headers ä¸­ã€‚æ¨¡å‹éœ€è¦æ ¹æ®æƒ…å†µå†³å®šå¦‚ä½•è°ƒç”¨ã€‚</li><li><strong>SQLï¼š</strong>SQL è¯„ä¼°æ•°æ®åŒ…æ‹¬æˆ‘ä»¬å®šåˆ¶çš„ sql.execute å‡½æ•°ï¼Œå…¶ä¸­åŒ…å« sql_keyword, table_name, columns å’Œ conditionsã€‚è¿™äº›å‚æ•°æä¾›äº†æ„å»ºç®€å• SQL æŸ¥è¯¢çš„å¿…è¦ä¿¡æ¯ã€‚æˆ‘ä»¬å¸Œæœ›é€šè¿‡å‡½æ•°è°ƒç”¨å¯é åœ°æ„å»ºå’Œä½¿ç”¨ SQL æŸ¥è¯¢ï¼Œè€Œä¸æ˜¯ä¸“é—¨è®­ç»ƒä¸€ä¸ª SQL æ¨¡å‹ã€‚æˆ‘ä»¬çš„è¯„ä¼°æ•°æ®é›†é™åˆ¶äº†åœºæ™¯ï¼Œä»…æ”¯æŒç®€å•çš„å…³é”®è¯ï¼Œå¦‚â€œSELECTâ€, â€œINSERT INTOâ€, â€œUPDATEâ€, â€œDELETEâ€, â€œCREATEâ€ã€‚</li><li><strong>Java + JavaScriptï¼š</strong>å°½ç®¡å¤§å¤šæ•°ç¼–ç¨‹è¯­è¨€çš„å‡½æ•°è°ƒç”¨æ ¼å¼ç›¸åŒï¼Œä½†æ¯ç§ç¼–ç¨‹è¯­è¨€éƒ½æœ‰å…¶ç‰¹æœ‰çš„ç±»å‹ã€‚ä¾‹å¦‚ï¼ŒC æœ‰æŒ‡é’ˆç±»å‹ï¼ŒJava æœ‰ HashMap ç±»å‹ã€‚è¿™ä¸ªæµ‹è¯•ç±»åˆ«çš„ç›®çš„æ˜¯äº†è§£å‡½æ•°è°ƒç”¨æ¨¡å‹å¦‚ä½•æ‰©å±•åˆ°ä¸ä»…ä»…æ˜¯ JSON å’Œ Python ç±»å‹ï¼Œè¿˜åŒ…æ‹¬æ‰€æœ‰ç‰¹å®šäºè¯­è¨€çš„ç±»å‹ã€‚</li></ul><p>è¿™äº›ç±»åˆ«ä½¿æˆ‘ä»¬èƒ½å¤Ÿçœ‹åˆ°ä¸åŒæ¨¡å‹åœ¨ API è°ƒç”¨çš„æµè¡Œç”¨ä¾‹ä¸­çš„è¡¨ç°ï¼Œå¹¶ä¸ºæˆ‘ä»¬æä¾›äº†å…³äºå‡½æ•°è°ƒç”¨æ¨¡å‹æ½œåŠ›çš„æ´å¯Ÿã€‚</p><h3 id="è¯„ä¼°æŒ‡æ ‡-ğŸ“ˆ"><a href="#è¯„ä¼°æŒ‡æ ‡-ğŸ“ˆ" class="headerlink" title="è¯„ä¼°æŒ‡æ ‡ ğŸ“ˆ"></a>è¯„ä¼°æŒ‡æ ‡ ğŸ“ˆ</h3><p>æˆ‘ä»¬ä½¿ç”¨ä¸¤ç§æµè¡Œçš„æ–¹æ³•æ¥è¯„ä¼°æ¨¡å‹ç”Ÿæˆç­”æ¡ˆçš„å‡†ç¡®æ€§ï¼šAST æ£€æŸ¥å™¨å’Œæ‰§è¡Œæ£€æŸ¥å™¨ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œåº”ä½¿ç”¨æ‰§è¡Œæ£€æŸ¥å™¨ï¼Œä½†ç”±äºå¹¶éæ‰€æœ‰ç»“æœéƒ½å®¹æ˜“æ‰§è¡Œï¼ˆå¦‚ Java å‡½æ•°ï¼‰ï¼Œæˆ‘ä»¬ä½¿ç”¨ AST ä½œä¸ºæ‰§è¡Œæ£€æŸ¥å™¨çš„è¡¥å……ã€‚</p><ul><li>æŠ½è±¡è¯­æ³•æ ‘ï¼ˆASTï¼‰æ£€æŸ¥å™¨</li><li>æ‰§è¡Œæ£€æŸ¥å™¨</li></ul><p>AST æ£€æŸ¥ï¼šå¯¹äºå¯æ‰§è¡Œçš„å‡½æ•°è°ƒç”¨ç­”æ¡ˆï¼Œæˆ‘ä»¬ä½¿ç”¨ AST æ ‘è¿›è¡Œè§£æã€‚</p><p>ç¤ºä¾‹ï¼š<code>[calculate_triangle_area(base=10, height=5)]</code></p><p>è§£æï¼š<code>Module(body=[Expr(value=List(elts=[Call(func=Name(id='calculate_triangle_area', ctx=Load()), args=[], keywords=[keyword(arg='base', value=Constant(value=10)), keyword(arg='height', value=Constant(value=5))])], ctx=Load()))], type_ignores=[]) [calculate_triangle_area(base=10, height=5)]</code></p><p>æˆ‘ä»¬ä» AST ä¸­æå–å˜é‡ï¼Œå¹¶æ£€æŸ¥æ¯ä¸ªå‚æ•°æ˜¯å¦åœ¨å¯èƒ½çš„ç­”æ¡ˆä¸­æ‰¾åˆ°å¹¶ç²¾ç¡®åŒ¹é…ã€‚å¯¹äºæ¯ä¸ªå¯èƒ½çš„ç­”æ¡ˆï¼Œåº”æ¥å—çš„ç­”æ¡ˆåŒ…æ‹¬ï¼š</p><ul><li>å¸ƒå°”å€¼ï¼š<ul><li>æˆ‘ä»¬æ£€æŸ¥å¸ƒå°”å€¼çš„ç›´æ¥åŒ¹é…ï¼Œä¸å…è®¸å¯¹å¸ƒå°”å€¼çš„å­—ç¬¦ä¸²ç‰ˆæœ¬æœ‰å®½å®¹ã€‚</li></ul></li><li>æ•´æ•°ã€æµ®ç‚¹æ•°ï¼š<ul><li>ç­”æ¡ˆåº”è¯¥æ˜¯å”¯ä¸€çš„ï¼Œä¾‹å¦‚ [1]</li></ul></li><li>åˆ—è¡¨ï¼š<ul><li>æˆ‘ä»¬æ£€æŸ¥ç²¾ç¡®åŒ¹é…ï¼Œå› æ­¤ä»»ä½•é¡ºåºçš„åˆ—è¡¨éƒ½åº”åŒ¹é…ã€‚[1,2,3]==[2,3,1]</li></ul></li><li>å­—å…¸ï¼š<ul><li>ä¸ºç®€åŒ–ï¼Œæˆ‘ä»¬è·³è¿‡æ£€æŸ¥é€’å½’ AST å­—å…¸ç»“æ„ã€‚</li></ul></li><li>å­—ç¬¦ä¸²ï¼š<ul><li>å¯èƒ½çš„æ—¥æœŸ â€œ20th Juneâ€, â€œ2023-06-20â€, â€œ06/20/2023â€, â€œJun.20,2023â€</li><li>å¯èƒ½çš„ä½ç½® [â€œNew York Cityâ€, â€œNYCâ€]</li><li>å¯èƒ½çš„ä»»ä½•ä¸œè¥¿ [â€œManchester Unitedâ€, â€œMan Unitedâ€, â€œMan Uâ€, â€œMUFCâ€]</li></ul></li></ul><p>ä»¥ä¸‹æ˜¯ä¸€äº›å¯èƒ½çš„ç­”æ¡ˆç¤ºä¾‹ï¼š</p><ul><li><code>{"calculate_triangle_area": {"base": [10], "height": [5], "unit": ["units", "unit"]}}</code></li><li><code>{"predict_house_price": {"bedrooms": [3], "bathrooms": [2], "area": [1800], "location": ["San Francisco", "San Francisco, CA"]}}</code></li></ul><p>è¿™ç§æ£€æŸ¥æœºåˆ¶é€‚ç”¨äºé™¤äº† executable_*å’Œ REST ä¹‹å¤–çš„æ‰€æœ‰å†…å®¹ã€‚</p><p>å¯æ‰§è¡Œæ£€æŸ¥ï¼šå¯¹äº executable_*å’Œ RESTï¼Œæˆ‘ä»¬æœ‰ç›¸åº”çš„å‡½æ•°ï¼Œå¯ä»¥ä¸ºæ¯ä¸ªé—®é¢˜æ‰§è¡Œã€‚å› æ­¤ï¼Œåœ¨æ¨¡å‹ç”Ÿæˆç­”æ¡ˆåï¼Œæˆ‘ä»¬å°†ç›´æ¥æ‰§è¡Œè¿™äº›ç­”æ¡ˆã€‚æœ‰ä¸¤ç§ç±»å‹çš„åŒ¹é…ï¼š</p><ul><li>ç¡®å®šæ€§çš„å¯æ‰§è¡Œè¾“å‡ºï¼šæˆ‘ä»¬æ ¹æ®æˆ‘ä»¬äººç±»æ‰§è¡Œçš„ç»“æœæ£€æŸ¥ç²¾ç¡®åŒ¹é…ã€‚</li><li>éç¡®å®šæ€§å’Œç°å®ä¸–ç•Œç›¸å…³çš„å¯æ‰§è¡Œè¾“å‡ºï¼šæˆ‘ä»¬æ£€æŸ¥å…¶å“åº”ç±»å‹å’Œå“åº” JSON é”®çš„ä¸€è‡´æ€§ï¼Œçœ‹çœ‹å€¼æ˜¯å¦æ˜¯æˆ‘ä»¬æœŸæœ›çœ‹åˆ°çš„ã€‚</li></ul><h3 id="æç¤º"><a href="#æç¤º" class="headerlink" title="æç¤º"></a>æç¤º</h3><p>æˆ‘ä»¬æä¾›äº†ç”¨äºè¯„ä¼°æˆ‘ä»¬çš„ä¸“æœ‰å’Œå¼€æºæ¨¡å‹çš„æ‰€æœ‰æç¤ºã€‚å¯¹äºå‡½æ•°è°ƒç”¨æ¨¡å‹ï¼Œæˆ‘ä»¬æ²¡æœ‰æä¾›ä»»ä½•ç³»ç»Ÿæç¤ºï¼Œè€Œæ˜¯ç›´æ¥å¯ç”¨å‡½æ•°è°ƒç”¨æ¨¡å¼å¹¶æ”¾ç½®å‡½æ•°å®šä¹‰ã€‚å¯¹äºèŠå¤©æ¨¡å‹ï¼Œæˆ‘ä»¬æä¾›äº†æ˜ç¡®çš„ç³»ç»Ÿæ¶ˆæ¯ã€‚</p><ol><li><p>å¯¹äºæ‰€æœ‰å‡½æ•°è°ƒç”¨æ¨¡å‹ï¼Œæˆ‘ä»¬ç›´æ¥å¯ç”¨å‡½æ•°è°ƒç”¨æ¨¡å¼å¹¶æ”¾ç½®å‡½æ•°å®šä¹‰ã€‚</p></li><li><p>å¯¹äºèŠå¤©æ¨¡å‹ï¼Œæˆ‘ä»¬æä¾›äº†æ˜ç¡®çš„ç³»ç»Ÿæ¶ˆæ¯ï¼š</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">SYSTEM_PROMPT_FOR_CHAT_MODEL = """"</span><br><span class="line">ä½ æ˜¯ä¸€ä¸ªç¼–å†™å‡½æ•°çš„ä¸“å®¶ã€‚ä½ ä¼šæ”¶åˆ°ä¸€ä¸ªé—®é¢˜å’Œä¸€ç³»åˆ—å¯èƒ½çš„å‡½æ•°ã€‚</span><br><span class="line">æ ¹æ®é—®é¢˜ï¼Œä½ éœ€è¦è¿›è¡Œä¸€ä¸ªæˆ–å¤šä¸ªå‡½æ•°/å·¥å…·è°ƒç”¨æ¥å®ç°ç›®çš„ã€‚</span><br><span class="line">å¦‚æœæ²¡æœ‰ä¸€ä¸ªå‡½æ•°å¯ä»¥ä½¿ç”¨ï¼Œè¯·æŒ‡å‡ºã€‚å¦‚æœç»™å®šé—®é¢˜ç¼ºå°‘å‡½æ•°æ‰€éœ€çš„å‚æ•°ï¼Œ</span><br><span class="line">ä¹Ÿè¯·æŒ‡å‡ºã€‚ä½ åº”è¯¥åªåœ¨å·¥å…·è°ƒç”¨éƒ¨åˆ†è¿”å›å‡½æ•°è°ƒç”¨ã€‚</span><br><span class="line">"""</span><br><span class="line"></span><br><span class="line">SYSTEM_PROMPT_FOR_CHAT_MODEL = """"</span><br><span class="line">You are an expert in composing functions. You are given a question and a set of possible functions.</span><br><span class="line">Based on the question, you will need to make one or more function/tool calls to achieve the purpose.</span><br><span class="line">If none of the function can be used, point it out. If the given question lacks the parameters required by the function,</span><br><span class="line">also point it out. You should only return the function call in tools call sections.</span><br><span class="line">"""</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">USER_MESSAGE_FOR_CHAT_MODEL = "Questions:{user_prompt}\\nè¿™é‡Œæ˜¯ä¸€ç³»åˆ—ä½ å¯ä»¥è°ƒç”¨çš„JSONæ ¼å¼å‡½æ•°åˆ—è¡¨:\\n{functions}. å¦‚æœä½ å†³å®šè¿”å›å‡½æ•°è°ƒç”¨ï¼Œä¸å¾—åŒ…å«å…¶ä»–æ–‡æœ¬ã€‚"</span><br><span class="line">USER_MESSAGE_FOR_CHAT_MODEL = "Questions:{user_prompt}\nHere is a list of functions in JSON format that you can invoke:\n{functions}. Should you decide to return the function call(s), NO other text MUST be included."</span><br></pre></td></tr></tbody></table></figure></li></ol><h3 id="å¸¸è§é”™è¯¯"><a href="#å¸¸è§é”™è¯¯" class="headerlink" title="å¸¸è§é”™è¯¯"></a>å¸¸è§é”™è¯¯</h3><p>é€šè¿‡æˆ‘ä»¬çš„åŸºå‡†æµ‹è¯• BFCLï¼Œæˆ‘ä»¬èƒ½å¤Ÿè¯†åˆ« LLMs åœ¨ç”Ÿæˆå‡½æ•°è°ƒç”¨æ—¶æ‰€çŠ¯çš„ä¸€äº›å¸¸è§é”™è¯¯ã€‚è¿™äº›é”™è¯¯æ­ç¤ºäº†å½“å‰æ¨¡å‹çš„å±€é™æ€§ï¼Œå¹¶ä¸ºå¦‚ä½•æ”¹è¿›</p><p>å®ƒä»¬æä¾›äº†æ´å¯Ÿã€‚</p><ol><li><p>GPT çš„å‡½æ•°æ–‡æ¡£éš¾ä»¥æ ¼å¼åŒ–ï¼Œå…¶ç±»å‹åœ¨ç°å®ä¸–ç•Œåœºæ™¯ä¸­å—åˆ°é™åˆ¶ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬éœ€è¦å°† float æ‰‹åŠ¨è½¬æ¢ä¸º numberï¼Œä»¥ä½¿å‡½æ•°ä¸ OpenAI å…¼å®¹ã€‚æ­¤å¤–ï¼Œæ•°å­—ç›¸æ¯” float åœ¨ç²¾åº¦å’Œç±»å‹ä¸€è‡´æ€§æ–¹é¢ä¿¡æ¯ä¼ é€’è¾ƒå°‘ã€‚</p><p>åœ¨ Gorilla Openfunctions-v2 ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ä¸é™åˆ¶å‚æ•°ç±»å‹æ¥æé«˜å‡½æ•°æ–‡æ¡£çš„çµæ´»æ€§ã€‚æ¢è¨€ä¹‹ï¼Œç”¨æˆ·å¯ä»¥æä¾› Tupleã€Floatï¼Œç”šè‡³ Java ä¸­çš„ç‰¹å®šç±»å‹ï¼Œå¦‚ HashMap å’Œ LinkedListã€‚</p></li><li><p>GPT åœ¨éœ€è¦æŸç§éšå¼è½¬æ¢çš„å‚æ•°åœºæ™¯ä¸­è¡¨ç°ä¸ä½³ã€‚ä¾‹å¦‚ï¼Œå½“å‚æ•°ä¸æ˜¯ç›´æ¥åœ¨ç”¨æˆ·é—®é¢˜ä¸­ç»™å‡ºæ—¶ã€‚</p><figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">"Function"</span><span class="punctuation">:</span></span><br><span class="line"><span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"finance.predict_future_value"</span><span class="punctuation">,</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="attr">"parameters"</span><span class="punctuation">:</span></span><br><span class="line">    <span class="punctuation">{</span></span><br><span class="line">        <span class="attr">"type"</span><span class="punctuation">:</span> <span class="string">"object"</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"properties"</span><span class="punctuation">:</span></span><br><span class="line">        <span class="punctuation">{</span></span><br><span class="line">            <span class="attr">"present_value"</span><span class="punctuation">:</span></span><br><span class="line">            <span class="punctuation">{</span></span><br><span class="line">                <span class="attr">"type"</span><span class="punctuation">:</span> <span class="string">"number"</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">"description"</span><span class="punctuation">:</span> <span class="string">"The present value of the investment."</span></span><br><span class="line">            <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">            <span class="attr">"annual_interest_rate"</span><span class="punctuation">:</span></span><br><span class="line">            <span class="punctuation">{</span></span><br><span class="line">                <span class="attr">"type"</span><span class="punctuation">:</span> <span class="string">"number"</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">"description"</span><span class="punctuation">:</span> <span class="string">"The annual interest rate of the investment."</span></span><br><span class="line">            <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">            <span class="attr">"compounding_periods_per_year"</span><span class="punctuation">:</span></span><br><span class="line">            <span class="punctuation">{</span></span><br><span class="line">                <span class="attr">"type"</span><span class="punctuation">:</span> <span class="string">"integer"</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">"description"</span><span class="punctuation">:</span> <span class="string">"The number of times that interest is compounded per year."</span><span class="punctuation">,</span></span><br><span class="line">            <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"time_years"</span><span class="punctuation">:</span></span><br><span class="line">            <span class="punctuation">{</span></span><br><span class="line">                <span class="attr">"type"</span><span class="punctuation">:</span> <span class="string">"integer"</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">"description"</span><span class="punctuation">:</span> <span class="string">"The investment horizon in years."</span></span><br><span class="line">            <span class="punctuation">}</span></span><br><span class="line">            ...</span><br><span class="line">        <span class="punctuation">}</span></span><br><span class="line">        <span class="attr">"required"</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">"present_value"</span><span class="punctuation">,</span> <span class="string">"annual_interest_rate"</span><span class="punctuation">,</span> <span class="string">"time_years"</span><span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">}</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure><p>Questions : Predict the future value of a $5000 investment with an annual interest rate of 5% in 3 years with monthly compounding.</p><figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GPT<span class="number">-4</span> output<span class="punctuation">:</span></span><br><span class="line"><span class="punctuation">[</span><span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"finance.predict_future_value"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"parameters"</span><span class="punctuation">:</span></span><br><span class="line">    <span class="punctuation">{</span></span><br><span class="line">        <span class="attr">"present_value"</span><span class="punctuation">:</span> <span class="number">5000</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"annual_interest_rate"</span><span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"compounding_periods_per_year"</span><span class="punctuation">:</span> <span class="number">12</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"time_years"</span><span class="punctuation">:</span> <span class="number">3</span></span><br><span class="line">    <span class="punctuation">}</span></span><br><span class="line"><span class="punctuation">}</span><span class="punctuation">]</span></span><br></pre></td></tr></tbody></table></figure><figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Gorilla-openfunctions-v2 output<span class="punctuation">:</span></span><br><span class="line"><span class="punctuation">[</span><span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"finance.predict_future_value"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"parameters"</span><span class="punctuation">:</span></span><br><span class="line">    <span class="punctuation">{</span></span><br><span class="line">        <span class="attr">"present_value"</span><span class="punctuation">:</span> <span class="number">5000</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"annual_interest_rate"</span><span class="punctuation">:</span> <span class="number">0.05</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"compounding_periods_per_year"</span><span class="punctuation">:</span> <span class="number">12</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"time_years"</span><span class="punctuation">:</span> <span class="number">3</span></span><br><span class="line">    <span class="punctuation">}</span></span><br><span class="line"><span class="punctuation">}</span><span class="punctuation">]</span></span><br></pre></td></tr></tbody></table></figure></li><li><p>èŠå¤©æ¨¡å‹å€¾å‘äºç”Ÿæˆæ ¼å¼é”™è¯¯çš„å‡½æ•°è°ƒç”¨ï¼Œå…¶ä¸­å‚æ•°å¯ä»¥æå–ä½†æ— æ³•æ‰§è¡Œã€‚</p><p>mistral-medium ç”Ÿæˆçš„ç»“æœç¤ºä¾‹å¦‚ä¸‹ï¼š<code>solve_quadratic_equation(a=2, b=6, c=5)</code>ã€‚é€šè¿‡ gorilla-openfunctions-v2ï¼Œæˆ‘ä»¬èƒ½å¤Ÿç›´æ¥è¾“å‡º<code>solve_quadratic_equation(a=3, b=2, c=1)</code>ï¼Œè¯¥ç»“æœåœ¨æ¥æ”¶åå³å¯æ‰§è¡Œã€‚</p></li><li><p>REST API è°ƒç”¨ä¸ä¸€è‡´ï¼šä¾‹å¦‚ï¼ŒæŸäº›æƒ…å†µä¸‹æ¨¡å‹å¯èƒ½æ— æ³•æ­£ç¡®ç”Ÿæˆ API è°ƒç”¨çš„ URL æˆ–å‚æ•°ã€‚</p></li></ol><h3 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h3><p>æˆ‘ä»¬é€šè¿‡ Gorilla Open Functions æ’è¡Œæ¦œå¯¹ LLMs å‡½æ•°è°ƒç”¨è¿›è¡Œäº†å…¨é¢å’Œç³»ç»Ÿæ€§çš„è¯„ä¼°ã€‚ç ”ç©¶è¡¨æ˜ï¼Œåœ¨ä¸æ¶‰åŠå¤æ‚è§„åˆ’å’Œé“¾å¼å‡½æ•°è°ƒç”¨çš„ç®€å•å‡½æ•°è°ƒç”¨æ–¹é¢ï¼Œç»è¿‡å¾®è°ƒçš„å¼€æºæ¨¡å‹å¯ä»¥ä¸ä¸“æœ‰æ¨¡å‹ç›¸åª²ç¾ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜æ¨å‡ºäº† Gorilla Open Functions v2ï¼Œè¿™æ˜¯ä¸€ä¸ªå¼€æºæ¨¡å‹ï¼Œå¯ä»¥å¸®åŠ©ç”¨æˆ·é€šè¿‡å‡½æ•°è°ƒç”¨æ„å»º AI åº”ç”¨ï¼Œå¹¶å®ç°ä¸ json å…¼å®¹çš„è¾“å‡ºäº¤äº’ã€‚</p><p>æˆ‘ä»¬å¸Œæœ›æ‚¨å–œæ¬¢è¿™ç¯‡åšå®¢æ–‡ç« ã€‚æ¬¢è¿æ‚¨åœ¨<a href="https://discord.gg/SwTyuTAxX3">Discord</a>ã€<a href="https://twitter.com/shishirpatil_/status/1661780076277678082">Twitter (#GorillaLLM)</a>å’Œ<a href="https://github.com/ShishirPatil/gorilla/">GitHub</a>ä¸Šåˆ†äº«æ‚¨çš„æƒ³æ³•ã€‚</p><p>å¦‚æœæ‚¨æƒ³å¼•ç”¨ Gorillaï¼š</p><figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@misc<span class="punctuation">{</span>berkeley-function-calling-leaderboard<span class="punctuation">,</span></span><br><span class="line">  title=<span class="punctuation">{</span>Berkeley Function Calling Leaderboard<span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">  author=<span class="punctuation">{</span>Fanjia Yan and Huanzhi Mao and Charlie Cheng-Jie Ji and Tianjun Zhang and Shishir G. Patil and Ion Stoica and Joseph E. Gonzalez<span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">  howpublished=<span class="punctuation">{</span>\url<span class="punctuation">{</span>https<span class="punctuation">:</span><span class="comment">//gorilla.cs.berkeley.edu/blogs/8_berkeley_function_calling_leaderboard.html}},</span></span><br><span class="line">  year=<span class="punctuation">{</span><span class="number">2024</span><span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure><h2 id="2-Gorilla-OpenFunctions-v2"><a href="#2-Gorilla-OpenFunctions-v2" class="headerlink" title="2. Gorilla OpenFunctions v2"></a>2. Gorilla OpenFunctions v2</h2><p><img src="https://gorilla.cs.berkeley.edu/assets/img/blog_post_7_demo.gif" alt="https://gorilla.cs.berkeley.edu/assets/img/blog_post_7_demo.gif"></p><p><em>Gorilla OpenFunctions-v2ï¼åœ¨å¼€æºæ¨¡å‹ä¸­æŠ€æœ¯é¢†å…ˆï¼ˆSoTAï¼‰ï¼Œä¸å•†ä¸šæ¨¡å‹åª²ç¾ã€‚</em></p><p>Gorilla OpenFunctions çš„æœ€æ–°ç‰ˆæœ¬â€”â€”ç‰ˆæœ¬ 2ï¼Œå¸¦æ¥äº†å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰åœ¨å¼€æºç¤¾åŒºä¸­å‡½æ•°è°ƒç”¨æ–¹é¢çš„é‡å¤§è¿›å±•ã€‚ä½œä¸ºå‰ä¸€ç‰ˆæœ¬çš„å‡çº§æ›¿ä»£ï¼ŒGorilla OpenFunctions-v2 ä¸ä»…ä¿æŒäº†å¼€æºç²¾ç¥ï¼Œè¿˜å¼•å…¥äº†ä»¤äººå…´å¥‹çš„æ–°åŠŸèƒ½ã€‚è¿™åŒ…æ‹¬æ”¯æŒ Pythonã€Javaã€JavaScript å’Œ REST API ç­‰</p><p>å¤šç§ç¼–ç¨‹è¯­è¨€â€”â€”è¿™åœ¨å¼€æºå’Œé—­æºæ¨¡å‹ä¸­éƒ½æ˜¯é¦–æ¬¡ï¼›åŒæ—¶å…·å¤‡å¤„ç†å¤šä¸ªå’Œå¹¶è¡Œå‡½æ•°è°ƒç”¨çš„èƒ½åŠ›ï¼Œä»¥åŠåˆ¤æ–­å‡½æ•°ç›¸å…³æ€§çš„èƒ½åŠ›ã€‚è¿™æ¬¡æ›´æ–°å·©å›ºäº† gorilla-openfunctions-v2 åœ¨ LLM é¢†åŸŸä¸­å‡½æ•°è°ƒç”¨èƒ½åŠ›çš„é¢†å…ˆåœ°ä½ã€‚è€Œä¸”ï¼Œè¿™ç§å³æ’å³ç”¨çš„æ›´æ–°æ–¹å¼ä½¿å¾— OpenFunctions å¯ä»¥è½»æ¾é›†æˆåˆ°å„ç§åº”ç”¨ä¸­ï¼Œä»ç¤¾äº¤åª’ä½“å¹³å°å¦‚ Instagram åˆ°é€è´§æœåŠ¡å¦‚ Doordashï¼Œè¿˜æœ‰åŒ…æ‹¬ Google Calendar å’Œ Stripe ç­‰å®ç”¨å·¥å…·ã€‚</p><h3 id="æ–°åŠŸèƒ½é€Ÿè§ˆ-ğŸš€"><a href="#æ–°åŠŸèƒ½é€Ÿè§ˆ-ğŸš€" class="headerlink" title="æ–°åŠŸèƒ½é€Ÿè§ˆ!! ğŸš€"></a>æ–°åŠŸèƒ½é€Ÿè§ˆ!! ğŸš€</h3><p>æˆ‘ä»¬åœ¨ OpenFunctions-v2 ä¸­æ¨å‡ºçš„äº”ä¸ªæ¿€åŠ¨äººå¿ƒçš„æ–°åŠŸèƒ½åŒ…æ‹¬ï¼š</p><p><img src="https://gorilla.cs.berkeley.edu/assets/img/blog_post_7_open_function_v2_features.png" alt="https://gorilla.cs.berkeley.edu/assets/img/blog_post_7_open_function_v2_features.png"></p><ul><li><strong>æ”¯æŒæ›´å¤šæ•°æ®ç±»å‹ï¼š</strong> Gorilla Open Functions v2 ç°åœ¨èƒ½æ”¯æŒå¤šç§è¯­è¨€ï¼Œå¹¶æ‰©å±•äº†å¯¹å‡½æ•°è°ƒç”¨ä¸­å‚æ•°ç±»å‹çš„æ”¯æŒã€‚ä¾‹å¦‚ï¼Œå¯¹äº Pythonï¼Œæ”¯æŒçš„ç±»å‹åŒ…æ‹¬<code>[string, number, boolean, list, tuple, dict, any]</code>ï¼›Java å’Œ Javascript åŒæ ·æ”¯æŒä¸°å¯Œçš„ç±»å‹ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼ŒOpenAI å’Œè®¸å¤šå…¶ä»–å…¬å¸ä»…æ”¯æŒ JSON æ¨¡å¼ï¼Œå³<code>[string, number, integer, object, array, boolean]</code>ã€‚è¿™ç§å¯¹ç±»å‹çš„åŸç”Ÿæ”¯æŒæ„å‘³ç€æ‚¨ç°åœ¨å¯ä»¥æ›´æ–¹ä¾¿åœ°ä½¿ç”¨ openfunctions-v2ã€‚</li><li><strong>æ”¯æŒå¹¶è¡Œå’Œå¤šåŠŸèƒ½ï¼š</strong> å¯ä»¥å¤„ç†å¹¶è¡Œå’Œå¤šåŠŸèƒ½è°ƒç”¨ã€‚åœ¨å¤šåŠŸèƒ½åœºæ™¯ä¸­ï¼Œç”¨æˆ·å¯ä»¥åœ¨ä¸ç¡®å®šå“ªä¸ªåŠŸèƒ½æœ€åˆé€‚æ—¶è¾“å…¥å¤šä¸ªåŠŸèƒ½ï¼›Gorilla æ¨¡å‹å°†ä»ä¸­é€‰æ‹©ä¸€ä¸ªæˆ–å¤šä¸ªï¼ˆæˆ–ä¸é€‰æ‹©ï¼‰æ¥å“åº”ç”¨æˆ·çš„è¯·æ±‚ã€‚åœ¨å¹¶è¡ŒåŠŸèƒ½ä¸­ï¼Œå¯ä»¥é€šè¿‡å¤šæ¬¡è°ƒç”¨åŒä¸€åŠŸèƒ½æ¥å“åº”ç”¨æˆ·çš„æç¤ºã€‚Gorilla æ¨¡å‹ä¸ä»…åŒæ—¶æ”¯æŒè¿™ä¸¤ç§æ¨¡å¼ï¼Œè¿˜èƒ½å°†å®ƒä»¬çš„ä¼˜åŠ¿ç»“åˆèµ·æ¥ã€‚</li><li><strong>åŠŸèƒ½ç›¸å…³æ€§æ£€æµ‹ï¼š</strong> åœ¨æ²¡æœ‰æä¾›åŠŸèƒ½æˆ–ç›¸å…³åŠŸèƒ½çš„æƒ…å†µä¸‹å‡å°‘é”™è¯¯å“åº”ã€‚Gorilla openfunctions v2 ç°åœ¨èƒ½è‡ªåŠ¨åˆ¤æ–­æä¾›ç»™æ¨¡å‹çš„åŠŸèƒ½æ˜¯å¦èƒ½å¤Ÿè§£å†³ç”¨æˆ·çš„é—®é¢˜ã€‚è¯†åˆ«åˆ°è¿™ä¸€ç‚¹åï¼ŒLLM ä¼šå‘ç”¨æˆ·å±•ç¤ºä¸€ä¸ªé”™è¯¯ä¿¡æ¯ï¼Œæä¾›æ›´å¤šå¸®åŠ©ã€‚</li><li><strong>å¢å¼ºçš„ RESTful API èƒ½åŠ›ï¼š</strong> æå‡äº†æ ¼å¼åŒ– RESTful API è°ƒç”¨çš„èƒ½åŠ›ã€‚RESTful API å¹¿æ³›åº”ç”¨äºç½‘ç»œä¸­ï¼Œä¸ºè®¸å¤šæµè¡Œçš„è½¯ä»¶æœåŠ¡ï¼ˆå¦‚ Slackã€PayPal ç­‰ï¼‰æä¾›æ”¯æŒã€‚æˆ‘ä»¬çš„æ¨¡å‹ç»è¿‡ç‰¹æ®Šè®­ç»ƒï¼Œèƒ½å¤Ÿé«˜è´¨é‡åœ°å¤„ç† RESTful API è°ƒç”¨ã€‚</li></ul><p>å¿«é€Ÿé“¾æ¥ï¼š</p><ul><li>å…¶ä»–åŠŸèƒ½è°ƒç”¨æ¨¡å‹çš„è¡¨ç°ï¼š<a href="https://gorilla.cs.berkeley.edu/leaderboard.html">Berkeley åŠŸèƒ½è°ƒç”¨æ’è¡Œæ¦œ</a></li><li>åœ¨çº¿ä½“éªŒæ¨¡å‹ï¼š<a href="https://gorilla.cs.berkeley.edu/leaderboard.html">Gorilla OpenFunctions-v2 ç½‘ç»œæ¼”ç¤º</a></li><li>é¡¹ç›®è¯¦æƒ…ï¼š<a href="https://github.com/ShishirPatil/gorilla/tree/main/openfunctions">GitHub</a></li><li>æ¨¡å‹ï¼ˆ7B å‚æ•°ï¼‰åœ¨ HuggingFace ä¸Šçš„é¡µé¢ï¼š<a href="https://huggingface.co/gorilla-llm/gorilla-openfunctions-v2">gorilla-llm/gorilla-openfunctions-v2</a></li></ul><h3 id="åœ¨æ‚¨çš„åº”ç”¨ä¸­é›†æˆ-OpenFunctions-v2-ğŸ”¨"><a href="#åœ¨æ‚¨çš„åº”ç”¨ä¸­é›†æˆ-OpenFunctions-v2-ğŸ”¨" class="headerlink" title="åœ¨æ‚¨çš„åº”ç”¨ä¸­é›†æˆ OpenFunctions-v2 ğŸ”¨"></a>åœ¨æ‚¨çš„åº”ç”¨ä¸­é›†æˆ OpenFunctions-v2 ğŸ”¨</h3><p>ä½¿ç”¨ Gorilla OpenFunctions-v2 éå¸¸ç®€å•ï¼š</p><ol><li>ä¸ºäº†ä¾¿äºå¿«é€ŸåŸå‹å¼€å‘ï¼Œæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªæ‰˜ç®¡çš„ Gorilla Openfunctions-v2 æ¨¡å‹ä¾›æ¨ç†ä½¿ç”¨ã€‚æ‚¨ä¹Ÿå¯ä»¥åœ¨æœ¬åœ°è¿è¡Œå®ƒï¼Œæˆ–é€šè¿‡ HuggingFace çš„é¡µé¢è‡ªè¡Œæ‰˜ç®¡ã€‚ä»¥ä¸‹ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•è°ƒç”¨æ‰˜ç®¡çš„ gorilla openfunctions v2 æ¨¡å‹ï¼š</li></ol><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> openai</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_gorilla_response</span>(<span class="params">prompt=<span class="string">""</span>, model=<span class="string">"gorilla-openfunctions-v2"</span>, functions=[]</span>):</span><br><span class="line">    openai.api_key = <span class="string">"EMPTY"</span>  <span class="comment"># ç”±UC Berkeleyå…è´¹æ‰˜ç®¡ â¤ï¸</span></span><br><span class="line">    openai.api_base = <span class="string">"&lt;http://luigi.millennium.berkeley.edu:8000/v1&gt;"</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">    completion = openai.ChatCompletion.create(</span><br><span class="line">        model=<span class="string">"gorilla-openfunctions-v2"</span>,</span><br><span class="line">        temperature=<span class="number">0.0</span>,</span><br><span class="line">        messages=[{<span class="string">"role"</span>: <span class="string">"user"</span>, <span class="string">"content"</span>: prompt}],</span><br><span class="line">        functions=functions,</span><br><span class="line">    )</span><br><span class="line">    <span class="comment"># completion.choices[0].message.content, å‡½æ•°è°ƒç”¨çš„å­—ç¬¦ä¸²æ ¼å¼</span></span><br><span class="line">    <span class="comment"># completion.choices[0].message.functionsl, å‡½æ•°è°ƒç”¨çš„Jsonæ ¼å¼</span></span><br><span class="line">    <span class="keyword">return</span> completion.choices[<span class="number">0</span>]</span><br></pre></td></tr></tbody></table></figure><ol><li>å‘æ¨¡å‹æé—®ï¼š<br><code>æ³¢å£«é¡¿å’Œæ—§é‡‘å±±çš„å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ</code></li><li>æ ¼å¼åŒ–æ‚¨çš„åŠŸèƒ½è°ƒç”¨ï¼šæ¨¡å‹å°†æ ¹æ®æ‚¨çš„è¯·æ±‚è¿”å›åŠŸèƒ½è°ƒç”¨ã€‚</li></ol><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">query = <span class="string">"æ³¢å£«é¡¿å’Œæ—§é‡‘å±±çš„å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ"</span></span><br><span class="line">functions = [</span><br><span class="line">    {</span><br><span class="line">        <span class="string">"name"</span>: <span class="string">"get_current_weather"</span>,</span><br><span class="line">        <span class="string">"description"</span>: <span class="string">"è·å–æŒ‡å®šåœ°ç‚¹çš„å½“å‰å¤©æ°”"</span>,</span><br><span class="line">        <span class="string">"parameters"</span>: {</span><br><span class="line">            <span class="string">"type"</span>: <span class="string">"object"</span>,</span><br><span class="line">            <span class="string">"properties"</span>: {</span><br><span class="line">                <span class="string">"location"</span>: {</span><br><span class="line">                    <span class="string">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">                    <span class="string">"description"</span>: <span class="string">"åŸå¸‚å’Œå·ï¼Œæ¯”å¦‚æ—§é‡‘å±±ï¼ŒCA"</span>,</span><br><span class="line">                },</span><br><span class="line">                <span class="string">"unit"</span>: {<span class="string">"type"</span>: <span class="string">"string"</span>, <span class="string">"enum"</span>: [<span class="string">"celsius"</span>, <span class="string">"fahrenheit"</span>]},</span><br><span class="line">            },</span><br><span class="line">            <span class="string">"required"</span>: [<span class="string">"location"</span>],</span><br><span class="line">        },</span><br><span class="line">    }</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure><ol><li>è·å–æ‚¨çš„åŠŸèƒ½è°ƒç”¨ï¼šæ¨¡å‹å°†æ ¹æ®æ‚¨çš„è¯·æ±‚è¿”å›ä¸€ä¸ª Python åŠŸèƒ½è°ƒç”¨ã€‚<br>è¿™ä¸ºå¼€å‘äººå‘˜å’Œéå¼€å‘äººå‘˜æä¾›äº†ä¾¿åˆ©ï¼Œä½¿ä»–ä»¬èƒ½å¤Ÿåˆ©ç”¨å¤æ‚åŠŸèƒ½è€Œæ— éœ€ç¼–å†™å¤§é‡ä»£ç ã€‚</li></ol><p>è¾“å…¥ï¼š</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">get_gorilla_response(prompt=query, functions=[functions])</span><br></pre></td></tr></tbody></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[get_current_weather(location=<span class="string">'Boston, MA'</span>), get_current_weather(location=<span class="string">'San Francisco, CA'</span>)]</span><br></pre></td></tr></tbody></table></figure><p>é€šè¿‡ä¸Šé¢çš„ç¤ºä¾‹ï¼Œæ‚¨å¯ä»¥åˆ©ç”¨ Gorilla OpenFunctions-v2 ç”Ÿæˆæ ¼å¼è‰¯å¥½çš„è¾“å‡ºï¼Œæˆ–ç”¨æ‚¨è‡ªå·±çš„å®šä¹‰è°ƒç”¨å‡½æ•°ï¼ç„¶åï¼Œæ‚¨å¯ä»¥åœ¨æ‚¨çš„åº”ç”¨ç¨‹åºå’ŒèŠå¤©æœºå™¨äººä¸­è‡ªç”±åœ°ä½¿ç”¨è¿™äº›åŠŸèƒ½ï¼</p><p>æ³¨æ„ï¼šGorilla ç›®å‰ä»…æ”¯æŒ<code>openai==0.28.1</code>ç‰ˆæœ¬çš„æ‰˜ç®¡ç«¯ç‚¹ã€‚æˆ‘ä»¬å¾ˆå¿«å°†å‡çº§ä»¥æ”¯æŒ<code>openai==1.xx</code>ç‰ˆæœ¬ï¼Œå±Šæ—¶<code>functions</code>å°†è¢«<code>tool_calls</code>æ›¿æ¢ã€‚</p><h3 id="Berkeley-åŠŸèƒ½è°ƒç”¨æ’è¡Œæ¦œä¸Šçš„è¡¨ç°-ğŸ”¥"><a href="#Berkeley-åŠŸèƒ½è°ƒç”¨æ’è¡Œæ¦œä¸Šçš„è¡¨ç°-ğŸ”¥" class="headerlink" title="Berkeley åŠŸèƒ½è°ƒç”¨æ’è¡Œæ¦œä¸Šçš„è¡¨ç° ğŸ”¥"></a>Berkeley åŠŸèƒ½è°ƒç”¨æ’è¡Œæ¦œä¸Šçš„è¡¨ç° ğŸ”¥</h3><p><img src="https://gorilla.cs.berkeley.edu/assets/img/blog_post_7_open_function_v2_summary.png" alt="https://gorilla.cs.berkeley.edu/assets/img/blog_post_7_open_function_v2_summary.png"></p><p><em>æˆ‘ä»¬åœ¨ Berkeley åŠŸèƒ½è°ƒç”¨æ’è¡Œæ¦œä¸Šè¿›è¡Œäº†å…¨é¢å’Œè¯¦å°½çš„è¯„ä¼°ï¼Œæˆ‘ä»¬çš„æ¨¡å‹ä¸ç›®å‰æŠ€æœ¯æœ€å…ˆè¿›çš„ GPT-4-1106 é¢„è§ˆç‰ˆä»¥åŠ GPT-4 å’Œ GPT-3.5-turbo åŠŸèƒ½è°ƒç”¨ç‰¹æ€§è¿›è¡Œäº†å¯¹æ¯”ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜å°†æˆ‘ä»¬çš„æ¨¡å‹ä¸å…¶ä»–å¼€æºæ¨¡å‹è¿›è¡Œäº†æ¯”è¾ƒï¼Œå±•ç¤ºäº†å…¶ä¼˜è¶Šæ€§èƒ½ã€‚æˆ‘ä»¬çš„è¯„ä¼°æ¶µç›–äº†æ¥è‡ªä¸åŒé¢†åŸŸï¼ˆåŒ…æ‹¬æ—…æ¸¸ã€é‡‘èã€å®‰æ’ä¼šè®®ç­‰ï¼‰å’Œè¯­è¨€ï¼ˆjavaã€javascriptã€pythonã€restAPIï¼‰çš„ 2000 å¤šä¸ªä¸åŒçš„æŸ¥è¯¢å’Œ API æ–‡æ¡£å¯¹ã€‚</em></p><p>è¦æ·±å…¥äº†è§£æˆ‘ä»¬çš„æ¨¡å‹åœ¨æ¯ä¸ªç±»åˆ«ä¸­çš„è¡¨ç°ï¼Œè¯·å‚é˜…ä¸‹é¢ Berkeley åŠŸèƒ½è°ƒç”¨æ’è¡Œæ¦œä¸­çš„è¯¦ç»†è¡¨æ ¼ã€‚ä¸ç›®å‰æŠ€æœ¯æœ€å…ˆè¿›çš„ GPT-4 åŠŸèƒ½è°ƒç”¨ç›¸æ¯”ï¼ŒGorilla OpenFunctions-v2 åœ¨ Python ä¸­çš„ç®€å•åŠŸèƒ½è°ƒç”¨ç±»åˆ«è¡¨ç°æ›´ä¼˜ï¼Œä½†åœ¨æ¶‰åŠå¤šä¸ªå’Œå¹¶è¡ŒåŠŸèƒ½çš„åŠŸèƒ½è°ƒç”¨ä¸Šè¡¨ç°ä¸å¦‚ GPT-4ã€‚è¿™ä¸€æ–°ç‰¹æ€§å¯¹æˆ‘ä»¬å’Œæ•´ä¸ªå¼€æºç¤¾åŒºæ¥è¯´ä»æ˜¯ä¸€ä¸ªä»¤äººå…´å¥‹çš„ç ”ç©¶é¢†åŸŸã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼Œæˆ‘ä»¬çš„æ¨¡å‹æä¾›äº†éå¸¸ç¨³å®šçš„å¯æ‰§è¡ŒåŠŸèƒ½è°ƒç”¨ - è¿™äº›åŠŸèƒ½è°ƒç”¨æ˜¯é€šè¿‡å®é™…æ‰§è¡Œæ¥è¯„ä¼°çš„ï¼Œæ— éœ€ä»»ä½•å¹²é¢„ã€‚ä¸å‡ºæ‰€æ–™ï¼Œç»è¿‡è®­ç»ƒçš„ Gorilla æ¨¡å‹åœ¨é™¤ Python ä»¥å¤–çš„ç¼–ç¨‹è¯­è¨€ï¼ˆå¦‚ Javaã€Javascript å’Œ REST APIï¼‰ä¸Šçš„åŠŸèƒ½è°ƒç”¨ä¸Šèƒœè¿‡äº† GPT-4ã€‚å¯¹äº REST APIï¼Œæˆ‘ä»¬çš„æ¨¡å‹æä¾›äº†æ›´ç¨³å®šçš„è¾“å‡ºï¼Œå…¶ä¸­åŒ…æ‹¬äº†æ‰€æœ‰å¿…éœ€çš„å­—æ®µï¼ŒåŒ…æ‹¬<strong>url</strong>ã€<strong>params</strong>å’Œ<strong>header</strong>ï¼Œä½¿æˆ‘ä»¬çš„æ¨¡å‹éå¸¸é€‚åˆç«‹å³é‡‡ç”¨ã€‚</p><p><img src="https://gorilla.cs.berkeley.edu/assets/img/blog_post_7_open_function_v2_leaderboard.png" alt="https://gorilla.cs.berkeley.edu/assets/img/blog_post_7_open_function_v2_leaderboard.png"></p><p><em>å·¦ä¾§æ˜¯ GPT-4 ç”Ÿæˆçš„ï¼Œå³ä¾§æ˜¯ openfunctions-v2 ç”Ÿæˆçš„ã€‚ä»ä¸Šé¢çš„é”™è¯¯ä¸­å¯ä»¥çœ‹å‡ºï¼Œå½“ GPT-4 åŠŸèƒ½è°ƒç”¨å¤„ç†æ¶‰åŠå¤æ‚å‚æ•°ç»“æ„ï¼ˆä¾‹å¦‚å­—å…¸ä¸­çš„å­—å…¸ï¼‰å¹¶å¸¦æœ‰é»˜è®¤å€¼çš„åŠŸèƒ½æ—¶ï¼Œè¯¥æ¨¡å‹å¾€å¾€ä¼šé‡åˆ°éº»çƒ¦ï¼Œå°¤å…¶æ˜¯åœ¨è§£æé»˜è®¤å€¼æ–¹é¢ã€‚ä¸å…¶è¯´æ˜¯ä¸€ç§è¾¹ç¼˜æƒ…å†µï¼Œä¸å¦‚è¯´ä¸Šé¢çš„ç¤ºä¾‹æ˜¯ REST API çš„ä¸€ä¸ªå¸¸è§èŒƒä¾‹ã€‚</em></p><h3 id="OpenFunctions-æ•°æ®ç»„æˆä¸è®­ç»ƒ-ğŸ•"><a href="#OpenFunctions-æ•°æ®ç»„æˆä¸è®­ç»ƒ-ğŸ•" class="headerlink" title="OpenFunctions æ•°æ®ç»„æˆä¸è®­ç»ƒ ğŸ•"></a>OpenFunctions æ•°æ®ç»„æˆä¸è®­ç»ƒ ğŸ•</h3><p>Gorilla openfunctions v2 æ˜¯ä¸€ä¸ªåŸºäº\[deepseek-coder-7b-instruct-v1.5\]å¤§è¯­è¨€æ¨¡å‹è¿›ä¸€æ­¥è®­ç»ƒçš„ 7B å‚æ•°æ¨¡å‹ã€‚ä¸ºäº†è®­ç»ƒè¯¥æ¨¡å‹ï¼Œæˆ‘ä»¬ä»ä¸‰ä¸ªä¸åŒæ¥æºæ”¶é›†äº†å…±è®¡ 65,283 ä¸ªé—®é¢˜-åŠŸèƒ½-ç­”æ¡ˆå¯¹ï¼šPython åŒ…ï¼ˆ19,353ï¼‰ã€Java å­˜å‚¨åº“ï¼ˆ16,586ï¼‰ã€Javascript å­˜å‚¨åº“ï¼ˆ4,245ï¼‰ã€å…¬å…± APIï¼ˆ6,009ï¼‰ä»¥åŠæ¥è‡ªå„ç§äº‘æä¾›å•†çš„å‘½ä»¤è¡Œå·¥å…·ï¼ˆ19,090ï¼‰ã€‚æ•°æ®ç»„æˆå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p>åœ¨æ•°æ®æ”¶é›†ä¹‹åï¼Œæˆ‘ä»¬è¿›è¡Œäº†å››æ¬¡æ•°æ®å¢å¼ºï¼Œä»¥æé«˜æˆ‘ä»¬çš„è®­ç»ƒæ•°æ®é›†çš„å¤šæ ·æ€§ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬æ›´æ”¹äº†å‡½æ•°åç§°ï¼Œè¿™å¯¹äºç¡®ä¿æ¨¡å‹ä¸ä¼šâ€œè®°ä½â€API æ˜ å°„è‡³å…³é‡è¦ã€‚å…¶æ¬¡ï¼Œæˆ‘ä»¬æ·»åŠ äº†éšæœºé€‰æ‹©çš„ã€æ•°é‡ä¸ç­‰çš„å‡½æ•°ï¼Œä½¿æˆ‘ä»¬çš„æ•°æ®é›†ä¸å¹¶è¡Œå‡½æ•°å…¼å®¹ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä»ç®€å•çš„å‡½æ•°ä¸­ç”Ÿæˆå¤šåŠŸèƒ½æ•°æ®é›†ã€‚ç¬¬ä¸‰ï¼Œæˆ‘ä»¬é‡‡ç”¨æ‰°åŠ¨æç¤ºçš„ç­–ç•¥æ¥ç”Ÿæˆå¹¶è¡ŒåŠŸèƒ½çš„åœºæ™¯ï¼Œå¹¶å°†å…¶æ‰©å±•åˆ°åŒæ—¶åŒ…æ‹¬å¤šåŠŸèƒ½å’Œå¹¶è¡ŒåŠŸèƒ½ã€‚æœ€åï¼Œæˆ‘ä»¬è¿˜åŒ…å«äº†ä¸€äº›åŠŸèƒ½åœ¨è¾“å…¥æ—¶ä¸è¶³ä»¥è§£å†³ä»»åŠ¡çš„æ•°æ®é›†éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†è¿™äº›æ ‡è®°ä¸ºâ€œç›¸å…³æ€§æ£€æµ‹â€åœºæ™¯ã€‚ä¸å¤§å¤šæ•° LLM è®­ç»ƒä¸€æ ·ï¼Œæˆ‘ä»¬å¯¹æ¯ç§æ•°æ®å¢å¼ºçš„ç¨‹åº¦è¿›è¡Œäº†å¹¿æ³›çš„å˜åŒ–ï¼Œä»¥è®­ç»ƒå‡ºä¸€ä¸ªå¥å£®çš„æ¨¡å‹ã€‚</p><ul><li><strong>å‡½æ•°åç§°å˜æ¢ï¼š</strong> æˆ‘ä»¬é€šè¿‡ä½¿ç”¨ä¸åŒçš„å‡½æ•°åç§°æ¥å¢å¼ºåŸå§‹çš„é—®é¢˜-åŠŸèƒ½-ç­”æ¡ˆå¯¹ï¼Œé¿å…æ¨¡å‹è®°ä½å‡½æ•°åç§°å’Œé—®é¢˜ä¹‹é—´çš„ç›¸å…³æ€§ï¼ˆä¾‹å¦‚ï¼Œâ€œuberâ€API ç”¨äºäº¤é€šï¼‰ã€‚<br><code>query + [{'name': 'func1', 'description': 'order takeout'}] -&gt; ans1 =&gt; query + [{'name': 'func2', 'description': 'order takeout'}] -&gt; [ans2]</code></li><li><strong>å¹¶è¡ŒåŠŸèƒ½å˜æ¢ï¼š</strong> ä¸ºäº†å¤„ç†é€‰æ‹©å¤šä¸ªåŠŸèƒ½æ¥å›ç­”ç”¨æˆ·è¯·æ±‚çš„æ›´å¤æ‚æƒ…å†µï¼Œæˆ‘ä»¬æ›´æ”¹äº†åŸå§‹é—®é¢˜ä»¥è¦æ±‚å¤šä¸ªè¾“å‡ºã€‚<br><code>query + [{'name': 'func1', 'description': 'order takeout'}] -&gt; ans1 =&gt; query + [{'name': 'func1', 'description': 'order takeout'}, {'name': 'func2', 'description': 'get weather'}] -&gt; [ans1]</code></li><li><strong>å¤šåŠŸèƒ½å˜æ¢ï¼š</strong> åœ¨è®­ç»ƒä¸­åŒ…å«å¤šä¸ªåŠŸèƒ½è°ƒç”¨çš„åŸå§‹åŠŸèƒ½å˜æ¢ï¼Œä½¿æ¨¡å‹å­¦ä¹ é€‰æ‹©ä½¿ç”¨å“ªä¸ªåŠŸèƒ½è°ƒç”¨ã€‚<br><code>query1 + [{'name': 'func1', 'description': 'order takeout'}] -&gt; ans1 =&gt; query2 + [{'name': 'func1', 'description': 'order takeout'}] -&gt; [ans1, ans2]</code></li><li><strong>å¹¶è¡Œå¤šåŠŸèƒ½å˜æ¢ï¼š</strong> ä¸Šè¿°å¹¶è¡Œå’Œå¤šåŠŸèƒ½å˜æ¢çš„ç»“åˆã€‚<br><code>query1 + [{'name': 'func1', 'description': 'order takeout'}] -&gt; ans1 =&gt; query2 + [{'name': 'func1', 'description': 'order takeout'}, {'name': 'func2', 'description': 'get weather'}] -&gt; [ans1, ans2]</code></li><li><strong>åŠŸèƒ½ç›¸å…³æ€§æ£€æµ‹å˜æ¢ï¼š</strong> æˆ‘ä»¬è¿˜åŒ…å«äº†ä¸€äº›åœ¨è¾“å…¥æ—¶æä¾›çš„åŠŸèƒ½æ— æ³•è§£å†³ä»»åŠ¡çš„æ•°æ®é›†éƒ¨åˆ†ã€‚æˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œç›¸å…³æ€§æ£€æµ‹â€ã€‚<br><code>query1 + [{'name': 'func1', 'description': 'order takeout'}] -&gt; ans1 =&gt; query2 + [{'name': 'func1', 'description': 'order takeout'}] -&gt; [Error, the function cannot solve the question.]</code></li></ul><p>åœ¨æ•´ä¸ªæ•°æ®å¢å¼ºä¹‹åï¼Œæˆ‘ä»¬è¿˜ä½¿ç”¨ Rouge å¾—åˆ†è¿›è¡Œäº†æ•°æ®å»é‡ï¼Œè¿™å·²ç»æˆä¸ºæ ‡å‡†åšæ³•ã€‚</p><h3 id="ç»“è®º-1"><a href="#ç»“è®º-1" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h3><p>æˆ‘ä»¬å¾ˆé«˜å…´å‘å¸ƒ<code>gorilla-openfunctions-v2</code>ï¼Œè¿™æ˜¯ä¸€ä¸ªåœ¨ Deepseek-Coder-7B-Instruct-v1.5 å¤§è¯­è¨€æ¨¡å‹åŸºç¡€ä¸Šè®­ç»ƒçš„ 7B å‚æ•°æ¨¡å‹ã€‚å®ƒæ¥æ”¶ç”¨æˆ·çš„æç¤ºå’Œå¤šä¸ª API è°ƒç”¨ï¼Œå¹¶è¿”å›å¸¦æœ‰æ­£ç¡®å‚æ•°çš„åŠŸèƒ½ã€‚OpenFunctions æ‰©å±•äº†å¯¹ Pythonã€Java å’Œ JavaScript ä»¥åŠ RESTful API ä¸­å‚æ•°ç±»å‹çš„åŸç”Ÿæ”¯æŒã€‚æ¬²äº†è§£æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹æˆ‘ä»¬åœ¨ Berkeley åŠŸèƒ½è°ƒç”¨æ’è¡Œæ¦œä¸Šçš„åšå®¢è¯„ä¼°ï¼Œä»¥åŠæˆ‘ä»¬ GitHub é¡µé¢ä¸Šçš„æ¨¡å‹ã€‚åšå®¢ä¸­çš„æ‰€æœ‰ç»“æœéƒ½æ˜¯ä½¿ç”¨<code>gorilla-openfunctions-v2</code>ç”Ÿæˆçš„ã€‚</p><p>Licensing:</p><p>Gorilla OpenFunctions v2 is distributed under the Apache 2.0 license. This software incorporates elements from the Deepseek model. Consequently, the licensing of Gorilla OpenFunctions v2 adheres to the Apache 2.0 license, with additional terms as outlined in Appendix A of the Deepseek license.</p><hr><p>æˆ‘ä»¬å¸Œæœ›æ‚¨å–œæ¬¢è¿™ç¯‡åšå®¢æ–‡ç« ã€‚æ¬¢è¿æ‚¨åœ¨<a href="https://discord.gg/3apqwwME">Discord</a>ã€Twitter (#GorillaLLM)å’Œ<a href="https://github.com/ShishirPatil/gorilla/">GitHub</a>ä¸Šä¸æˆ‘ä»¬åˆ†äº«æ‚¨çš„æƒ³æ³•ã€‚</p><p>å¦‚æœæ‚¨æƒ³å¼•ç”¨ Gorillaï¼š</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@inproceedings{gorilla-openfunctions-v2,</span></span><br><span class="line">  title={Gorilla OpenFunctions v2},</span><br><span class="line">  author={Charlie Cheng-Jie Ji, Huanzhi Mao, Fanjia Yan, Shishir G. Patil, Tianjun Zhang, Ion Stoica, Joseph E. Gonzalez},</span><br><span class="line">  year={<span class="number">2024</span>},</span><br><span class="line">  howpublished={\url{https://gorilla.cs.berkeley.edu//blogs/7_open_functions_v2.html}},</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>]]></content>
      
      
      <categories>
          
          <category> NLP Insights </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LLM </tag>
            
            <tag> Agent </tag>
            
            <tag> Tool Use </tag>
            
            <tag> Gorilla </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>FastChat Training Script Code Analysis - Train.py ã€FastChat Series Part 1ã€‘</title>
      <link href="/2024/02/27/NLP%20Insights/FastChat%20Training%20Script%20Code%20Analysis%20-%20Train.py%20%E3%80%90FastChat%20Series%20Part%201%E3%80%91/"/>
      <url>/2024/02/27/NLP%20Insights/FastChat%20Training%20Script%20Code%20Analysis%20-%20Train.py%20%E3%80%90FastChat%20Series%20Part%201%E3%80%91/</url>
      
        <content type="html"><![CDATA[<h1 id="FastChat-Training-Script-Code-Analysis-Train-py-ã€FastChat-Series-Part-1ã€‘"><a href="#FastChat-Training-Script-Code-Analysis-Train-py-ã€FastChat-Series-Part-1ã€‘" class="headerlink" title="FastChat Training Script Code Analysis - Train.py ã€FastChat Series Part 1ã€‘"></a>FastChat Training Script Code Analysis - Train.py ã€FastChat Series Part 1ã€‘</h1><p>In this article, we delve into the train.py script of FastChat (<a href="https://github.com/lm-sys/FastChat">https://github.com/lm-sys/FastChat</a>) (<a href="https://github.com/lm-sys/FastChat/blob/main/fastchat/train/train.py">https://github.com/lm-sys/FastChat/blob/main/fastchat/train/train.py</a>), a key component for training and optimizing large language models (LLMs). FastChat is an advanced open-source platform focused on developing, deploying, and evaluating chatbots based on LLMs. The platform not only supports top-tier models like Vicuna and MT-Bench but also includes a distributed multi-model service system equipped with a Web UI and RESTful API compatible with OpenAI, enabling efficient training and evaluation of models.</p><p>We provide a detailed analysis of the train.py scriptâ€™s source code. This script is a training script for natural language processing models based on the transformers library, covering critical steps such as data preprocessing, model training, and saving. Our goal is to offer a detailed explanation of each class and function in train.py, including their functionality and role in the overall training process.</p><h2 id="1-Importing-Modules"><a href="#1-Importing-Modules" class="headerlink" title="1. Importing Modules"></a>1. Importing Modules</h2><h3 id="1-Built-in-Modules"><a href="#1-Built-in-Modules" class="headerlink" title="1. Built-in Modules"></a>1. Built-in Modules</h3><p>These are standard library modules that come with Python and donâ€™t require additional installation.</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> dataclasses <span class="keyword">import</span> dataclass, field</span><br></pre></td></tr></tbody></table></figure><p>Imports Pythonâ€™s <code>dataclasses</code> module for creating classes with default values.</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br></pre></td></tr></tbody></table></figure><p>Imports the <code>json</code> module for handling JSON format data.</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br></pre></td></tr></tbody></table></figure><p>Imports the <code>math</code> module for mathematical operations.</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pathlib</span><br></pre></td></tr></tbody></table></figure><p>Imports the <code>pathlib</code> module for handling file paths.</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Dict</span>, <span class="type">Optional</span>, <span class="type">Sequence</span></span><br></pre></td></tr></tbody></table></figure><p>Imports the <code>typing</code> module for type annotations.</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br></pre></td></tr></tbody></table></figure><h3 id="2-Dependency-Libraries"><a href="#2-Dependency-Libraries" class="headerlink" title="2. Dependency Libraries"></a>2. Dependency Libraries</h3><p>These are external libraries typically installed via a package manager like pip.<br>Imports the <code>numpy</code> library, commonly used for scientific computing.</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br></pre></td></tr></tbody></table></figure><p>Imports <code>PyTorch</code>, a popular deep learning framework.</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> torch.utils.data <span class="keyword">import</span> Dataset</span><br></pre></td></tr></tbody></table></figure><p>Imports <code>Dataset</code> from <code>torch</code> for creating custom datasets.</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> transformers</span><br></pre></td></tr></tbody></table></figure><p>Imports the <code>transformers</code> library, a popular natural language processing library.</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> Trainer</span><br></pre></td></tr></tbody></table></figure><p>Imports <code>Trainer</code> from <code>transformers</code> for training models.</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> transformers.trainer_pt_utils <span class="keyword">import</span> LabelSmoother</span><br></pre></td></tr></tbody></table></figure><p>Imports <code>LabelSmoother</code> from <code>transformers</code> for label smoothing.</p><h3 id="3-Project-Specific-Functions"><a href="#3-Project-Specific-Functions" class="headerlink" title="3. Project-Specific Functions"></a>3. Project-Specific Functions</h3><p>These are functions or classes custom-implemented in the Fast Chat project.</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastchat.conversation <span class="keyword">import</span> SeparatorStyle</span><br></pre></td></tr></tbody></table></figure><p>Imports <code>SeparatorStyle</code> from the <code>fastchat</code> package for defining conversation separator styles. The <code>SeparatorStyle</code> class is an enumeration class created using Pythonâ€™s <code>enum</code> module, defining a series of separator styles. Enumerations are a programming concept used to define a named set of constants, making code clearer and more maintainable.</p><p>In the <code>SeparatorStyle</code> class, each member represents a specific style of separator. These styles are often used in text processing, especially in scenarios where different sections or elements need to be distinguished. For instance, in handling dialog or textual data, different methods might be needed to differentiate between user input and machine responses.</p><p>Regarding the use of the <code>auto()</code> function:</p><ul><li><code>auto()</code> is a special function provided by Pythonâ€™s <code>enum</code> module. It automatically assigns a unique value to each member in an enumeration class.</li><li>Without using <code>auto()</code>, you would need to manually assign a unique value to each enumeration member. <code>auto()</code> simplifies this process by letting Python handle the assignment of these values automatically.</li><li>The values assigned by <code>auto()</code> are usually integers, starting from 1 and increasing sequentially.</li></ul><p>In the case of the <code>SeparatorStyle</code> class, <code>auto()</code> is used to automatically assign a unique integer value to each type of separator style. For example, <code>ADD_COLON_SINGLE</code>, <code>ADD_COLON_TWO</code>, etc., will be given different integer values.</p><p>The names of each enumeration member (such as <code>ADD_COLON_SINGLE</code>, <code>NO_COLON_SINGLE</code>, etc.) typically describe the characteristics of that separator style. For instance, <code>ADD_COLON_SINGLE</code> might represent adding a colon as a separator after a certain element, whereas <code>NO_COLON_SINGLE</code> means no colon is added.</p><p>This approach makes referencing and handling these separator styles in the code more convenient and clear. For example, different separator styles can be chosen based on different scenarios or requirements without having to remember their specific values.</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastchat.model.model_adapter <span class="keyword">import</span> get_conversation_template</span><br></pre></td></tr></tbody></table></figure><p>Imports <code>get_conversation_template</code> from the <code>fastchat</code> package for obtaining conversation templates. In this code segment, the call logic primarily involves obtaining the default conversation template for a specific model. The call chain is as follows:</p><ol><li><p><strong>Starting Call - <code>get_conversation_template(model_path: str)</code></strong></p><ul><li>This function is the starting point of the call chain. It accepts a parameter <code>model_path</code>, specifying the path of the model.</li><li>The purpose of this function is to obtain the default conversation template for the given model path.</li></ul></li><li><p><strong>Call <code>get_model_adapter(model_path: str)</code></strong></p><ul><li>The <code>get_conversation_template</code> function first calls <code>get_model_adapter</code>, passing in the model path.</li><li>The purpose of <code>get_model_adapter</code> is to find and return a suitable <code>BaseModelAdapter</code> object for the provided model path.</li><li>This function first tries to match the basename of <code>model_path</code>. If no match is found, it tries the full path.</li><li>If a suitable adapter is found, it is returned; otherwise, a <code>ValueError</code> is thrown.</li></ul></li><li><p><strong>Execute <code>BaseModelAdapter.get_default_conv_template(model_path: str)</code></strong></p><ul><li>Once the appropriate model adapter is obtained, <code>get_conversation_template</code> retrieves the default conversation template by calling the <code>get_default_conv_template</code> method of that adapter.</li><li>Note that this method is defined in the <code>BaseModelAdapter</code> class but might be overridden in subclasses.</li></ul></li><li><p><strong>Call <code>get_conv_template(name: str)</code></strong></p><ul><li>Inside the <code>get_default_conv_template</code> method, it calls the <code>get_conv_template</code> function, usually passing a predefined template name like <code>"one_shot"</code>.</li><li>The purpose of <code>get_conv_template</code> is to retrieve a specified nameâ€™s template from the global registry of conversation templates <code>conv_templates</code>.</li></ul></li><li><p><strong>Obtain and Return a <code>Conversation</code> Object</strong></p><ul><li>The <code>get_conv_template</code> function returns an instance of the <code>Conversation</code> class, usually copied from the <code>conv_templates</code> dictionary.</li><li>Finally, this <code>Conversation</code> instance is returned to the original call site of <code>get_conversation_template</code>.</li></ul></li></ol><p>Summarizing the call chain:</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">get_conversation_template(model_path)</span><br><span class="line">  -&gt; get_model_adapter(model_path)</span><br><span class="line">  -&gt; [BaseModelAdapter].get_default_conv_template(model_path)</span><br><span class="line">    -&gt; get_conv_template(name)</span><br><span class="line">      -&gt; Return Conversation Object</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p>In this process, the code navigates through a series of function calls to find a suitable model adapter based on the provided model path and retrieve a specific conversation template from it. This design pattern allows flexibility in providing different conversation templates for different models, enhancing the reusability and extensibility of the code.</p><hr><h2 id="2-Configuration-Classes"><a href="#2-Configuration-Classes" class="headerlink" title="2. Configuration Classes"></a>2. Configuration Classes</h2><p>These classes are defined using Pythonâ€™s <code>dataclass</code> decorator and are mainly used for storing configurations and parameters. These classes usually do not contain complex methods or logic but are used to define and store data structures. These classes include:</p><ul><li><code>ModelArguments</code>: Stores parameters related to the model, like model path, trust in remote code, etc.</li><li><code>DataArguments</code>: Stores parameters related to data, like data path, evaluation data path, and whether to use lazy preprocessing.</li><li><code>TrainingArguments</code>: Stores parameters related to training, like cache directory, optimizer type, model maximum length, etc. This class extends <code>transformers.TrainingArguments</code> and adds some custom parameters.</li></ul><p>These classes are mainly used to simplify and organize parameter management in the code, making parameter modification and access more convenient.</p><h3 id="1-ModelArguments-Class"><a href="#1-ModelArguments-Class" class="headerlink" title="1. ModelArguments Class"></a>1. ModelArguments Class</h3><h4 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h4><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@dataclass</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ModelArguments</span>:</span><br><span class="line">    model_name_or_path: <span class="type">Optional</span>[<span class="built_in">str</span>] = field(default=<span class="string">"facebook/opt-125m"</span>)</span><br><span class="line">    trust_remote_code: <span class="built_in">bool</span> = field(</span><br><span class="line">        default=<span class="literal">False</span>,</span><br><span class="line">        metadata={</span><br><span class="line">            <span class="string">"help"</span>: <span class="string">"Whether or not to allow for custom models defined on the Hub in their own modeling files"</span></span><br><span class="line">        },</span><br><span class="line">    )</span><br><span class="line">    padding_side: <span class="built_in">str</span> = field(</span><br><span class="line">        default=<span class="string">"right"</span>, metadata={<span class="string">"help"</span>: <span class="string">"The padding side in tokenizer"</span>}</span><br><span class="line">    )</span><br></pre></td></tr></tbody></table></figure><h4 id="Explanation"><a href="#Explanation" class="headerlink" title="Explanation"></a>Explanation</h4><p><code>ModelArguments</code> is a data class (<code>dataclass</code>) used for storing model-related configuration parameters.<br><strong>Attributes:</strong></p><ol><li><code>model_name_or_path</code>: Specifies the name or path of the pretrained model.</li><li><code>trust_remote_code</code>: Whether to allow custom models that have their modeling files defined on the Hub.</li><li><code>padding_side</code>: Specifies the padding side in the tokenizer, typically right or left padding.</li></ol><details><summary> Introduction to `@dataclass` decorator, click to expand </summary>`@dataclass` is a decorator used to automate the generation of special methods like `__init__()`, `__repr__()`, `__eq__()` etc., thus simplifying the writing of data classes. This decorator is part of Python 3.7 and is in the `dataclasses` module.<p>When you use <code>@dataclass</code> before a class definition, Python automatically adds some special methods based on the fields defined in the class. This is very useful for creating classes that store a small amount of data but do not need complex methods.</p><p>Specifically, using <code>@dataclass</code>:</p><ol><li><p><strong>Automatically generates a constructor (<code>__init__</code> method)</strong>: Python creates an <code>__init__</code> method automatically based on the fields defined in the class, so you donâ€™t need to manually write this method to initialize your class instances.</p></li><li><p><strong>Automatically generates a <code>__repr__</code> method</strong>: This makes printing the class instances provide a more readable string representation, usually including the class name and its fields and their values.</p></li><li><p><strong>Automatically generates an <code>__eq__</code> method</strong>: This allows you to use the <code>==</code> operator to compare two instances of the class, comparing the values of the instance fields.</p></li><li><p><strong>Support for type annotations</strong>: When defining fields, you can use type annotations, which not only help with clarity of code but can also be checked for type correctness using some tools.</p></li></ol><p>In the case of the <code>ModelArguments</code> class, the <code>@dataclass</code> decorator will generate the above-mentioned methods. This means you can easily create an instance of <code>ModelArguments</code>, and when printing or comparing these instances, you will get the expected behavior.</p><p>For example, when you create an instance of <code>ModelArguments</code>:</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">args = ModelArguments()</span><br></pre></td></tr></tbody></table></figure><p>This will call the automatically generated <code>__init__</code> method, using the default values â€œfacebook/opt-125mâ€ for <code>model_name_or_path</code>, <code>False</code> for <code>trust_remote_code</code>, and â€œrightâ€ for <code>padding_side</code>.</p><p>When you print this instance:</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(args)</span><br></pre></td></tr></tbody></table></figure><p>This will call the automatically generated <code>__repr__</code> method, showing a detailed view of the class instance, like <code>ModelArguments(model_name_or_path="facebook/opt-125m", trust_remote_code=False, padding_side="right")</code>.</p><p>Thus, the <code>@dataclass</code> decorator simplifies the process of creating classes, making the code more concise and maintainable.</p><p>Overall, the <code>@dataclass</code> decorator is a convenient tool provided by Python for quickly creating classes mainly used for storing data.</p></details><h3 id="2-DataArguments-Class"><a href="#2-DataArguments-Class" class="headerlink" title="2. DataArguments Class"></a>2. DataArguments Class</h3><h4 id="Code-1"><a href="#Code-1" class="headerlink" title="Code"></a>Code</h4><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@dataclass</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DataArguments</span>:</span><br><span class="line">    data_path: <span class="built_in">str</span> = field(</span><br><span class="line">        default=<span class="literal">None</span>, metadata={<span class="string">"help"</span>: <span class="string">"Path to the training data."</span>}</span><br><span class="line">    )</span><br><span class="line">    eval_data_path: <span class="built_in">str</span> = field(</span><br><span class="line">        default=<span class="literal">None</span>, metadata={<span class="string">"help"</span>: <span class="string">"Path to the evaluation data."</span>}</span><br><span class="line">    )</span><br><span class="line">    lazy_preprocess: <span class="built_in">bool</span> = <span class="literal">False</span></span><br></pre></td></tr></tbody></table></figure><h4 id="Explanation-1"><a href="#Explanation-1" class="headerlink" title="Explanation"></a>Explanation</h4><p><strong>DataArguments Class</strong></p><ul><li><code>DataArguments</code> is also a data class used for storing data-related configuration parameters.</li><li>Attributes:<ul><li><code>data_path</code>: Path to the training data.</li><li><code>eval_data_path</code>: Path to the evaluation data.</li><li><code>lazy_preprocess</code>: Whether to use lazy loading for data preprocessing, i.e., load and process data as needed.</li></ul></li></ul><h3 id="3-TrainingArguments-Class"><a href="#3-TrainingArguments-Class" class="headerlink" title="3. TrainingArguments Class"></a>3. TrainingArguments Class</h3><h4 id="Code-2"><a href="#Code-2" class="headerlink" title="Code"></a>Code</h4><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@dataclass</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TrainingArguments</span>(transformers.TrainingArguments):</span><br><span class="line">    cache_dir: <span class="type">Optional</span>[<span class="built_in">str</span>] = field(default=<span class="literal">None</span>)</span><br><span class="line">    optim: <span class="built_in">str</span> = field(default=<span class="string">"adamw_torch"</span>)</span><br><span class="line">    model_max_length: <span class="built_in">int</span> = field(</span><br><span class="line">        default=<span class="number">512</span>,</span><br><span class="line">        metadata={</span><br><span class="line">            <span class="string">"help"</span>: <span class="string">"Maximum sequence length. Sequences will be right padded (and possibly truncated)."</span></span><br><span class="line">        },</span><br><span class="line">    )</span><br></pre></td></tr></tbody></table></figure><h4 id="Explanation-2"><a href="#Explanation-2" class="headerlink" title="Explanation"></a>Explanation</h4><p><code>TrainingArguments</code> class extends <code>transformers.TrainingArguments</code>.</p><ol><li><p><strong>TrainingArguments Class</strong></p><ul><li><code>TrainingArguments</code> is a data class that, by extending <code>transformers.TrainingArguments</code>, gains the capability to handle training parameters.</li><li>Attributes defined in <code>TrainingArguments</code>:<ul><li><code>cache_dir</code>: Specifies the directory path for caching the model and tokenizer.</li><li><code>optim</code>: Defines the type of optimizer to use, like <code>'adamw_torch'</code>.</li><li><code>model_max_length</code>: Specifies the maximum sequence length the model can handle.</li></ul></li></ul></li><li><p><strong>transformers.TrainingArguments Class</strong></p><ul><li><code>transformers.TrainingArguments</code> is a class in the transformers library that is used for configuring various parameters in the model training process.</li><li>This class contains a plethora of attributes for controlling the training process, such as:<ul><li><code>output_dir</code>: Specifies the directory to save the model and training results.</li><li><code>num_train_epochs</code>: Number of training epochs.</li><li><code>per_device_train_batch_size</code>: Batch size per device for training.</li><li><code>save_steps</code>: Steps interval for saving the model.</li><li><code>evaluation_strategy</code>: Strategy for evaluating the model, like at the end of each epoch.</li><li><code>learning_rate</code>: Learning rate.</li><li><code>warmup_steps</code>: Steps used for warmup in the learning rate schedule.</li></ul></li><li><code>transformers.TrainingArguments</code> also</li></ul></li></ol><p> contains many other parameters for fine-tuning the training process, including logging, model saving strategies, learning rate scheduling, and more.</p><p>By extending <code>transformers.TrainingArguments</code>, the <code>TrainingArguments</code> class not only inherits all these training parameter configurations but can also add some custom training parameters, like in this case <code>cache_dir</code>, <code>optim</code>, and <code>model_max_length</code>. This approach enhances code reusability and flexibility, allowing you to adjust and extend training configurations as per the specific requirements of your project.</p><h2 id="3-Functional-Utility-Functions"><a href="#3-Functional-Utility-Functions" class="headerlink" title="3. Functional Utility Functions"></a>3. Functional Utility Functions</h2><h3 id="1-rank0-print-args"><a href="#1-rank0-print-args" class="headerlink" title="1. rank0_print(*args)"></a>1. rank0_print(*args)</h3><h4 id="Code-3"><a href="#Code-3" class="headerlink" title="Code"></a>Code</h4><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">local_rank = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rank0_print</span>(<span class="params">*args</span>):</span><br><span class="line">    <span class="keyword">if</span> local_rank == <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(*args)</span><br></pre></td></tr></tbody></table></figure><h4 id="Explanation-3"><a href="#Explanation-3" class="headerlink" title="Explanation"></a>Explanation</h4><p>Defines a global variable local_rank for distributed training.<br>Defines a function rank0_print to print information only if local_rank is 0, used for controlling output in distributed training. This way, repetitive printing of the same information across multiple nodes is avoided, making the output clearer and more concise.</p><ul><li>Used to print information only on the main node (rank 0) in a distributed training environment.</li><li>Parameters: A variable number of arguments for printing.</li></ul><h3 id="2-trainer-save-model-safe-trainer-transformers-Trainer"><a href="#2-trainer-save-model-safe-trainer-transformers-Trainer" class="headerlink" title="2. trainer_save_model_safe(trainer: transformers.Trainer)"></a>2. <code>trainer_save_model_safe(trainer: transformers.Trainer)</code></h3><h4 id="Code-4"><a href="#Code-4" class="headerlink" title="Code"></a>Code</h4><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">trainer_save_model_safe</span>(<span class="params">trainer: transformers.Trainer</span>):</span><br><span class="line">    <span class="keyword">from</span> torch.distributed.fsdp <span class="keyword">import</span> FullyShardedDataParallel <span class="keyword">as</span> FSDP</span><br><span class="line">    <span class="keyword">from</span> torch.distributed.fsdp <span class="keyword">import</span> StateDictType, FullStateDictConfig</span><br><span class="line"></span><br><span class="line">    save_policy = FullStateDictConfig(offload_to_cpu=<span class="literal">True</span>, rank0_only=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">with</span> FSDP.state_dict_type(</span><br><span class="line">        trainer.model, StateDictType.FULL_STATE_DICT, save_policy</span><br><span class="line">    ):</span><br><span class="line">        trainer.save_model()</span><br></pre></td></tr></tbody></table></figure><p>The function <code>trainer_save_model_safe(trainer: transformers.Trainer)</code> aims to safely save models trained with the PyTorch distributed framework. Letâ€™s delve into the details of this function and its key components.</p><h4 id="Explanation-4"><a href="#Explanation-4" class="headerlink" title="Explanation"></a>Explanation</h4><ol><li><p>Parameters:</p><ul><li><code>trainer</code>: An instance of <code>transformers.Trainer</code>. This class is one of the core components of the Hugging Face Transformers library, used for training and evaluating models.</li></ul></li><li><p>Functionality:</p><ul><li>The main purpose of this function is to safely save models in a distributed training environment. It particularly considers the model saving strategy when using Fully Sharded Data Parallel (FSDP).</li></ul></li><li><p>FSDP</p><ul><li><strong>FullyShardedDataParallel (FSDP)</strong><ul><li>This is a component of PyTorchâ€™s distributed training framework. FSDP helps reduce memory usage on each GPU by sharding model parameters across multiple GPUs, allowing the training of larger models.</li><li>In this context, FSDP is primarily used for handling and saving model states in distributed training.</li></ul></li><li><strong>StateDictType</strong><ul><li>This is an enumeration type that defines how to save the modelâ€™s state dictionary. In FSDP environments, saving and loading model states might require special handling.</li></ul></li><li><strong>FullStateDictConfig</strong><ul><li>This class configures parameters for saving the full state dictionary. Itâ€™s part of FSDPâ€™s functionality and is used to control how the model state is saved.</li></ul></li></ul></li><li><p>Function Implementation</p><ul><li><strong>Setting Save Policy</strong><ul><li><code>save_policy = FullStateDictConfig(offload_to_cpu=True, rank0_only=True)</code> creates a save policy. Here, two key parameters are specified:<ul><li><code>offload_to_cpu</code>: Offload model parameters to CPU before saving the state dictionary, which helps reduce GPU memory usage.</li><li><code>rank0_only</code>: Save the model only on rank 0 (usually the main node). In distributed training, this avoids saving the same model copy on every node, saving storage space.</li></ul></li></ul></li><li><strong>Saving the Model</strong><ul><li>Using the <code>with FSDP.state_dict_type(trainer.model, StateDictType.FULL_STATE_DICT, save_policy)</code> context manager, the type and policy for saving the modelâ€™s state dictionary are set.</li><li>Within this context, <code>trainer.save_model()</code> is called to save the model. Due to the <code>save_policy</code>, the model is saved securely following the specified configuration.</li></ul></li></ul></li></ol><p>The function <code>trainer_save_model_safe</code> encapsulates a safe model saving logic, particularly for scenarios involving PyTorchâ€™s FSDP in distributed training. It ensures that only a complete model state is saved on one node and offloads model parameters to CPU before saving, optimizing memory usage and storage efficiency. This is crucial for training large models and managing large-scale distributed training environments.</p><h3 id="3-preprocess-sources-tokenizer-transformers-PreTrainedTokenizer-gt-Dict"><a href="#3-preprocess-sources-tokenizer-transformers-PreTrainedTokenizer-gt-Dict" class="headerlink" title="3.preprocess(sources,tokenizer: transformers.PreTrainedTokenizer) -> Dict"></a>3.<code>preprocess(sources,tokenizer: transformers.PreTrainedTokenizer) -&gt; Dict</code></h3><h4 id="Code-5"><a href="#Code-5" class="headerlink" title="Code"></a>Code</h4><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">preprocess</span>(<span class="params"></span></span><br><span class="line"><span class="params">    sources,</span></span><br><span class="line"><span class="params">    tokenizer: transformers.PreTrainedTokenizer,</span></span><br><span class="line"><span class="params"></span>) -&gt; <span class="type">Dict</span>:</span><br><span class="line">    conv = get_conversation_template(<span class="string">"vicuna"</span>)</span><br><span class="line">    roles = {<span class="string">"human"</span>: conv.roles[<span class="number">0</span>], <span class="string">"gpt"</span>: conv.roles[<span class="number">1</span>]}</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Apply prompt templates</span></span><br><span class="line">    conversations = []</span><br><span class="line">    <span class="keyword">for</span> i, source <span class="keyword">in</span> <span class="built_in">enumerate</span>(sources):</span><br><span class="line">        <span class="keyword">if</span> roles[source[<span class="number">0</span>][<span class="string">"from"</span>]] != conv.roles[<span class="number">0</span>]:</span><br><span class="line">            <span class="comment"># Skip the first one if it is not from human</span></span><br><span class="line">            source = source[<span class="number">1</span>:]</span><br><span class="line"></span><br><span class="line">        conv.messages = []</span><br><span class="line">        <span class="keyword">for</span> j, sentence <span class="keyword">in</span> <span class="built_in">enumerate</span>(source):</span><br><span class="line">            role = roles[sentence[<span class="string">"from"</span>]]</span><br><span class="line">            <span class="keyword">assert</span> role == conv.roles[j % <span class="number">2</span>], <span class="string">f"<span class="subst">{i}</span>"</span></span><br><span class="line">            conv.append_message(role, sentence[<span class="string">"value"</span>])</span><br><span class="line">        conversations.append(conv.get_prompt())</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Tokenize conversations</span></span><br><span class="line">    input_ids = tokenizer(</span><br><span class="line">        conversations,</span><br><span class="line">        return_tensors=<span class="string">"pt"</span>,</span><br><span class="line">        padding=<span class="string">"max_length"</span>,</span><br><span class="line">        max_length=tokenizer.model_max_length,</span><br><span class="line">        truncation=<span class="literal">True</span>,</span><br><span class="line">    ).input_ids</span><br><span class="line">    targets = input_ids.clone()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">assert</span> conv.sep_style == SeparatorStyle.ADD_COLON_TWO</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Mask targets. Only compute loss on the assistant outputs.</span></span><br><span class="line">    sep = conv.sep + conv.roles[<span class="number">1</span>] + <span class="string">": "</span></span><br><span class="line">    <span class="keyword">for</span> conversation, target <span class="keyword">in</span> <span class="built_in">zip</span>(conversations, targets):</span><br><span class="line">        total_len = <span class="built_in">int</span>(target.ne(tokenizer.pad_token_id).<span class="built_in">sum</span>())</span><br><span class="line"></span><br><span class="line">        turns = conversation.split(conv.sep2)</span><br><span class="line">        cur_len = <span class="number">1</span></span><br><span class="line">        target[:cur_len] = IGNORE_TOKEN_ID</span><br><span class="line">        <span class="keyword">for</span> i, turn <span class="keyword">in</span> <span class="built_in">enumerate</span>(turns):</span><br><span class="line">            <span class="keyword">if</span> turn == <span class="string">""</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            turn_len = <span class="built_in">len</span>(tokenizer(turn).input_ids)</span><br><span class="line"></span><br><span class="line">            parts = turn.split(sep)</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(parts) != <span class="number">2</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            parts[<span class="number">0</span>] += sep</span><br><span class="line">            <span class="comment"># "-2" is hardcoded for the Llama tokenizer to make the offset correct.</span></span><br><span class="line">            instruction_len = <span class="built_in">len</span>(tokenizer(parts[<span class="number">0</span>]).input_ids) - <span class="number">2</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> i != <span class="number">0</span> <span class="keyword">and</span> <span class="keyword">not</span> tokenizer.legacy:</span><br><span class="line">                <span class="comment"># The legacy and non-legacy modes handle special tokens differently</span></span><br><span class="line">                instruction_len -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># Ignore the user instructions</span></span><br><span class="line">            target[cur_len : cur_len + instruction_len] = IGNORE_TOKEN_ID</span><br><span class="line">            cur_len += turn_len</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> i != <span class="number">0</span> <span class="keyword">and</span> <span class="keyword">not</span> tokenizer.legacy:</span><br><span class="line">                <span class="comment"># The legacy and non-legacy modes handle special tokens differently</span></span><br><span class="line">                cur_len -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        target[cur_len:] = IGNORE_TOKEN_ID</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="literal">False</span>:  <span class="comment"># Inspect and check the correctness of masking</span></span><br><span class="line">            z = target.clone()</span><br><span class="line">            z = torch.where(z == IGNORE_TOKEN_ID, tokenizer.unk_token_id, z)</span><br><span class="line">            rank0_print(tokenizer.decode(z))</span><br><span class="line">            exit()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> cur_len &lt; tokenizer.model_max_length:</span><br><span class="line">           </span><br><span class="line"></span><br><span class="line"> <span class="keyword">if</span> cur_len != total_len:</span><br><span class="line">                target[:] = IGNORE_TOKEN_ID</span><br><span class="line">                rank0_print(</span><br><span class="line">                    <span class="string">f"WARNING: tokenization mismatch: <span class="subst">{cur_len}</span> vs. <span class="subst">{total_len}</span>."</span></span><br><span class="line">                    <span class="string">f" #turn = <span class="subst">{<span class="built_in">len</span>(turns) - <span class="number">1</span>}</span>. (ignored)"</span></span><br><span class="line">                )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">dict</span>(</span><br><span class="line">        input_ids=input_ids,</span><br><span class="line">        labels=targets,</span><br><span class="line">        attention_mask=input_ids.ne(tokenizer.pad_token_id),</span><br><span class="line">    )</span><br></pre></td></tr></tbody></table></figure><p>The function <code>preprocess(sources, tokenizer: transformers.PreTrainedTokenizer) -&gt; Dict</code> is intended for preprocessing dialogue data to be suitable for training machine learning models. This function can be broken down into several main parts for a more detailed explanation:</p><h4 id="1-Obtaining-Conversation-Templates-and-Role-Definitions"><a href="#1-Obtaining-Conversation-Templates-and-Role-Definitions" class="headerlink" title="1. Obtaining Conversation Templates and Role Definitions"></a>1. Obtaining Conversation Templates and Role Definitions</h4><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">conv = get_conversation_template(<span class="string">"vicuna"</span>)</span><br><span class="line">roles = {<span class="string">"human"</span>: conv.roles[<span class="number">0</span>], <span class="string">"gpt"</span>: conv.roles[<span class="number">1</span>]}</span><br></pre></td></tr></tbody></table></figure><ul><li><strong>Functionality</strong>: Initializes conversation templates and defines the roles of dialogue participants.</li><li><strong>Implementation</strong>:<ul><li><code>conv = get_conversation_template("vicuna")</code> obtains the conversation template for a specified model (e.g., â€œvicunaâ€).</li><li>The <code>roles</code> dictionary maps â€œhumanâ€ and â€œgptâ€ to the roles defined in the conversation template.</li></ul></li><li><strong>Example</strong>:<ul><li>If the conversation template is for â€œvicunaâ€, then <code>roles</code> might map â€œhumanâ€ to â€œuserâ€ and â€œgptâ€ to â€œassistantâ€. For example, <code>{'human': 'USER', 'gpt': 'ASSISTANT'}</code>.</li></ul></li></ul><h4 id="2-Applying-Prompt-Templates"><a href="#2-Applying-Prompt-Templates" class="headerlink" title="2. Applying Prompt Templates"></a>2. Applying Prompt Templates</h4><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Apply prompt templates</span></span><br><span class="line">conversations = []</span><br><span class="line"><span class="keyword">for</span> i, source <span class="keyword">in</span> <span class="built_in">enumerate</span>(sources):</span><br><span class="line">    <span class="keyword">if</span> roles[source[<span class="number">0</span>][<span class="string">"from"</span>]] != conv.roles[<span class="number">0</span>]:</span><br><span class="line">        <span class="comment"># Skip the first one if it is not from human</span></span><br><span class="line">        source = source[<span class="number">1</span>:]</span><br><span class="line"></span><br><span class="line">    conv.messages = []</span><br><span class="line">    <span class="keyword">for</span> j, sentence <span class="keyword">in</span> <span class="built_in">enumerate</span>(source):</span><br><span class="line">        role = roles[sentence[<span class="string">"from"</span>]]</span><br><span class="line">        <span class="keyword">assert</span> role == conv.roles[j % <span class="number">2</span>], <span class="string">f"<span class="subst">{i}</span>"</span></span><br><span class="line">        conv.append_message(role, sentence[<span class="string">"value"</span>])</span><br><span class="line">    conversations.append(conv.get_prompt())</span><br></pre></td></tr></tbody></table></figure><ul><li><strong>Functionality</strong>: Applies prompt templates to source data to construct dialogues.</li><li><strong>Implementation</strong>:<ul><li>Iterates through <code>sources</code> (original dialogue data), transforming each dialogue source into a conversation in template format.</li><li>If the first part of a dialogue is not initiated by the â€œhumanâ€ role, it skips that part.</li><li>Assigns a role to each sentence and adds it to the conversation template.</li><li>Ultimately, each processed dialogue is added to the <code>conversations</code> list.</li></ul></li><li><strong>Example</strong>:<ul><li>Suppose we have a source which is the first item in dummy input: <code>python source = [{'from': 'human', 'value': 'Who are you?'}, {'from': 'gpt', 'value': 'I am Vicuna, a language model trained by researchers from Large Model Systems Organization (LMSYS).'}, {'from': 'human', 'value': 'Have a nice day!'}, {'from': 'gpt', 'value': 'You too!'}]</code></li><li><code>conversations</code> under the Vicuna template, using <code>SeparatorStyle.ADD_COLON_TWO</code> as the separator style, might look like [â€œA chat between a curious user and an artificial intelligence assistant. The assistant gives helpful, detailed, and polite answers to the userâ€™s questions. USER: Who are you? ASSISTANT: I am Vicuna, a language model trained by researchers from Large Model Systems Organization (LMSYS).USER: Have a nice day! ASSISTANT: You too!â€œ]</li><li><details><summary> Implementation of get_prompt </summary>The `get_prompt` method implementation varies depending on the `SeparatorStyle`. Below is a table detailing the `get_prompt` method for various styles, along with English examples:<table><thead><tr><th>Separator Style (<code>SeparatorStyle</code>)</th><th>Description</th><th>Example</th></tr></thead><tbody><tr><td><code>ADD_COLON_SINGLE</code></td><td>Adds a colon and separator after each message.</td><td>USER: Hello there!\nASSISTANT: Hi, how can I help?\n</td></tr><tr><td><code>ADD_COLON_TWO</code></td><td>Uses two alternating separators, usually between different roles.</td><td>USER: Whatâ€™s the weather?\nASSISTANT: Itâ€™s sunny today.\n\n</td></tr><tr><td><code>ADD_COLON_SPACE_SINGLE</code></td><td>Adds a colon, space, and separator after each message.</td><td>USER: Can you book a flight?\nASSISTANT: Sure, where to?\n</td></tr><tr><td><code>NO_COLON_SINGLE</code></td><td>Messages directly follow roles without a colon, followed by a separator.</td><td>USERWhat are you doing?\nASSISTANTIâ€™m here to assist you.\n</td></tr><tr><td><code>NO_COLON_TWO</code></td><td>No colons, with two alternating separators.</td><td>USERHowâ€™s the project going?\nASSISTANTItâ€™s on track.\n\n</td></tr><tr><td><code>ADD_NEW_LINE_SINGLE</code></td><td>Each message is preceded by a newline, followed by a separator.</td><td>USER\nHow can I reset my password?\nASSISTANT\nYou can reset it via email.\n</td></tr><tr><td><code>RWKV</code></td><td>Special format, usually for specific models.</td><td>USER: What is AI?\n\nASSISTANT: AI stands for Artificial Intelligence.\n\n</td></tr><tr><td><code>LLAMA2</code></td><td>Special label format for specific models.</td><td>[INST] USER How does blockchain work?\nASSISTANT It is a distributed ledger.\n\n</td></tr><tr><td><code>CHATGLM</code></td><td>Specific format for <code>CHATGLM</code> model.</td><td>[Round 1]\nUSER: Tell me a joke.\nASSISTANT: Why did the chicken cross the road?\n</td></tr><tr><td><code>CHATML</code></td><td>Similar to <code>CHATGLM</code>, but with newlines before and after each message.</td><td>USER\nDo you like music?\n\nASSISTANT\nYes, I enjoy many genres.\n\n</td></tr><tr><td><code>CHATGLM3</code></td><td>Format for <code>CHATGLM3</code> model.</td><td>USER\nCan you play chess?\nASSISTANTYes, I can play.\n</td></tr><tr><td><code>CHATINTERN</code></td><td>Format for <code>CHATINTERN</code> model, using special markers.</td><td><s>USER:Where is the nearest ATM?<s>\nASSISTANT:Itâ€™s next to the post office.\n</s></s></td></tr><tr><td><code>DOLLY</code></td><td>Specific format for <code>DOLLY</code> model.</td><td>USER:\nWhat is quantum computing?\nASSISTANT:\nIt involves computation using quantum-mechanical phenomena.\n\n</td></tr><tr><td><code>PHOENIX</code></td><td>For <code>PHOENIX</code> model, messages are wrapped in special markers.</td><td>USER: <s>How to bake a cake?</s>\nASSISTANT: <s>You need flour, sugar, and eggs.</s>\n</td></tr><tr><td><code>ROBIN</code></td><td>Similar to <code>ADD_NEW_LINE_SINGLE</code>, but with a newline after roles.</td><td>USER:\nIs AI dangerous?\nASSISTANT:\nIt depends on how itâ€™s used.\n</td></tr><tr><td></td><td></td><td></td></tr></tbody></table></details></li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> NLP Insights </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LLM </tag>
            
            <tag> FastChat </tag>
            
            <tag> Train </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>FastChat è®­ç»ƒè„šæœ¬ä»£ç é€è¡Œè§£æ-Train.py ã€FastChat ç³»åˆ—ç¬¬ 1 ç¯‡ã€‘</title>
      <link href="/2024/02/27/NLP%20Insights/FastChat%20%E8%AE%AD%E7%BB%83%E8%84%9A%E6%9C%AC%E4%BB%A3%E7%A0%81%E9%80%90%E8%A1%8C%E8%A7%A3%E6%9E%90-Train.py%20%E3%80%90FastChat%20%E7%B3%BB%E5%88%97%E7%AC%AC%201%20%E7%AF%87%E3%80%91/"/>
      <url>/2024/02/27/NLP%20Insights/FastChat%20%E8%AE%AD%E7%BB%83%E8%84%9A%E6%9C%AC%E4%BB%A3%E7%A0%81%E9%80%90%E8%A1%8C%E8%A7%A3%E6%9E%90-Train.py%20%E3%80%90FastChat%20%E7%B3%BB%E5%88%97%E7%AC%AC%201%20%E7%AF%87%E3%80%91/</url>
      
        <content type="html"><![CDATA[<h1 id="FastChat-è®­ç»ƒè„šæœ¬ä»£ç é€è¡Œè§£æ-Train-py-ã€FastChat-ç³»åˆ—ç¬¬-1-ç¯‡ã€‘"><a href="#FastChat-è®­ç»ƒè„šæœ¬ä»£ç é€è¡Œè§£æ-Train-py-ã€FastChat-ç³»åˆ—ç¬¬-1-ç¯‡ã€‘" class="headerlink" title="FastChat è®­ç»ƒè„šæœ¬ä»£ç é€è¡Œè§£æ-Train.py ã€FastChat ç³»åˆ—ç¬¬ 1 ç¯‡ã€‘"></a>FastChat è®­ç»ƒè„šæœ¬ä»£ç é€è¡Œè§£æ-Train.py ã€FastChat ç³»åˆ—ç¬¬ 1 ç¯‡ã€‘</h1><p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢è®¨ <a href="https://github.com/lm-sys/FastChat">FastChat</a> çš„ <code>train.py</code> è„šæœ¬ï¼Œè¿™æ˜¯ä¸€ä¸ªç”¨äºè®­ç»ƒå’Œä¼˜åŒ–å¤§å‹è¯­è¨€æ¨¡å‹çš„å…³é”®ç»„ä»¶ã€‚FastChat æ˜¯ä¸€ä¸ªå…ˆè¿›çš„å¼€æºå¹³å°ï¼Œä¸“æ³¨äºå¼€å‘ã€éƒ¨ç½²å’Œè¯„ä¼°åŸºäºå¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰çš„èŠå¤©æœºå™¨äººã€‚è¯¥å¹³å°ä¸ä»…æä¾›å¯¹é¡¶å°–æ¨¡å‹å¦‚ Vicuna å’Œ MT-Bench çš„æ”¯æŒï¼Œè¿˜åŒ…æ‹¬ä¸€ä¸ªåˆ†å¸ƒå¼çš„å¤šæ¨¡å‹æœåŠ¡ç³»ç»Ÿï¼Œé…å¤‡äº† Web UI å’Œä¸ OpenAI å…¼å®¹çš„ RESTful APIï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿé«˜æ•ˆåœ°è®­ç»ƒå’Œè¯„ä¼°ä»–ä»¬çš„æ¨¡å‹ã€‚</p><p>æœ¬æ–‡çš„æ·±å…¥åˆ†æå°†èšç„¦äº <code>train.py</code> è„šæœ¬çš„æºä»£ç ã€‚è¿™ä¸ªè„šæœ¬æ˜¯åŸºäº transformers åº“çš„è‡ªç„¶è¯­è¨€å¤„ç†æ¨¡å‹è®­ç»ƒè„šæœ¬ï¼Œæ¶µç›–äº†æ•°æ®é¢„å¤„ç†ã€æ¨¡å‹è®­ç»ƒå’Œä¿å­˜ç­‰å…³é”®æ­¥éª¤ã€‚æˆ‘ä»¬æ—¨åœ¨æä¾›å¯¹ <code>train.py</code> ä¸­æ¯ä¸ªç±»å’Œå‡½æ•°çš„è¯¦ç»†è§£é‡Šï¼ŒåŒ…æ‹¬å®ƒä»¬çš„åŠŸèƒ½å’Œåœ¨æ•´ä¸ªè®­ç»ƒè¿‡ç¨‹ä¸­çš„ä½œç”¨ã€‚</p><h2 id="1-å¯¼å…¥æ¨¡å—"><a href="#1-å¯¼å…¥æ¨¡å—" class="headerlink" title="1. å¯¼å…¥æ¨¡å—"></a>1. å¯¼å…¥æ¨¡å—</h2><h3 id="1-å†…ç½®æ¨¡å—"><a href="#1-å†…ç½®æ¨¡å—" class="headerlink" title="1. å†…ç½®æ¨¡å—"></a>1. å†…ç½®æ¨¡å—</h3><p>è¿™äº›æ˜¯ Python è‡ªå¸¦çš„æ ‡å‡†åº“æ¨¡å—ï¼Œæ— éœ€é¢å¤–å®‰è£…ã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> dataclasses <span class="keyword">import</span> dataclass, field</span><br></pre></td></tr></tbody></table></figure><p>å¯¼å…¥ Python çš„<code>dataclasses</code>æ¨¡å—ï¼Œç”¨äºåˆ›å»ºå¸¦æœ‰é»˜è®¤å€¼çš„ç±»ã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br></pre></td></tr></tbody></table></figure><p>å¯¼å…¥<code>json</code>æ¨¡å—ï¼Œç”¨äºå¤„ç† JSON æ ¼å¼çš„æ•°æ®ã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br></pre></td></tr></tbody></table></figure><p>å¯¼å…¥<code>math</code>æ¨¡å—ï¼Œç”¨äºæ•°å­¦è¿ç®—ã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pathlib</span><br></pre></td></tr></tbody></table></figure><p>å¯¼å…¥<code>pathlib</code>æ¨¡å—ï¼Œç”¨äºå¤„ç†æ–‡ä»¶è·¯å¾„ã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Dict</span>, <span class="type">Optional</span>, <span class="type">Sequence</span></span><br></pre></td></tr></tbody></table></figure><p>å¯¼å…¥<code>typing</code>æ¨¡å—ï¼Œç”¨äºç±»å‹æ³¨è§£ã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br></pre></td></tr></tbody></table></figure><h3 id="2-ä¾èµ–åº“"><a href="#2-ä¾èµ–åº“" class="headerlink" title="2. ä¾èµ–åº“"></a>2. ä¾èµ–åº“</h3><p>è¿™äº›æ˜¯å¤–éƒ¨å®‰è£…çš„ä¾èµ–åº“ï¼Œé€šå¸¸é€šè¿‡åŒ…ç®¡ç†å™¨å¦‚ pip å®‰è£…ã€‚<br>å¯¼å…¥<code>numpy</code>åº“ï¼Œä¸€ä¸ªå¸¸ç”¨çš„ç§‘å­¦è®¡ç®—åº“ã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br></pre></td></tr></tbody></table></figure><p>å¯¼å…¥<code>PyTorch</code>ï¼Œä¸€ä¸ªæµè¡Œçš„æ·±åº¦å­¦ä¹ æ¡†æ¶ã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> torch.utils.data <span class="keyword">import</span> Dataset</span><br></pre></td></tr></tbody></table></figure><p>ä»<code>torch</code>ä¸­å¯¼å…¥<code>Dataset</code>ï¼Œç”¨äºåˆ›å»ºè‡ªå®šä¹‰æ•°æ®é›†ã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> transformers</span><br></pre></td></tr></tbody></table></figure><p>å¯¼å…¥<code>transformers</code>åº“ï¼Œä¸€ä¸ªæµè¡Œçš„è‡ªç„¶è¯­è¨€å¤„ç†åº“ã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> Trainer</span><br></pre></td></tr></tbody></table></figure><p>ä»<code>transformers</code>ä¸­å¯¼å…¥<code>Trainer</code>ï¼Œç”¨äºè®­ç»ƒæ¨¡å‹ã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> transformers.trainer_pt_utils <span class="keyword">import</span> LabelSmoother</span><br></pre></td></tr></tbody></table></figure><p>ä»<code>transformers</code>ä¸­å¯¼å…¥<code>LabelSmoother</code>ï¼Œç”¨äºæ ‡ç­¾å¹³æ»‘ã€‚</p><h3 id="3-é¡¹ç›®ç‰¹å®šå‡½æ•°"><a href="#3-é¡¹ç›®ç‰¹å®šå‡½æ•°" class="headerlink" title="3. é¡¹ç›®ç‰¹å®šå‡½æ•°"></a>3. é¡¹ç›®ç‰¹å®šå‡½æ•°</h3><p>è¿™äº›æ˜¯åœ¨ Fast Chat é¡¹ç›®ä¸­è‡ªå®šä¹‰å®ç°çš„å‡½æ•°æˆ–ç±»ã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastchat.conversation <span class="keyword">import</span> SeparatorStyle</span><br><span class="line"></span><br><span class="line"><span class="comment">## code from FastChat/fastchat/conversation.py</span></span><br><span class="line">    <span class="string">"""Separator styles."""</span></span><br><span class="line"></span><br><span class="line">    ADD_COLON_SINGLE = auto()</span><br><span class="line">    ADD_COLON_TWO = auto()</span><br><span class="line">    ADD_COLON_SPACE_SINGLE = auto()</span><br><span class="line">    NO_COLON_SINGLE = auto()</span><br><span class="line">    NO_COLON_TWO = auto()</span><br><span class="line">    ADD_NEW_LINE_SINGLE = auto()</span><br><span class="line">    LLAMA2 = auto()</span><br><span class="line">    CHATGLM = auto()</span><br><span class="line">    CHATML = auto()</span><br><span class="line">    CHATINTERN = auto()</span><br><span class="line">    DOLLY = auto()</span><br><span class="line">    RWKV = auto()</span><br><span class="line">    PHOENIX = auto()</span><br><span class="line">    ROBIN = auto()</span><br><span class="line">    FALCON_CHAT = auto()</span><br><span class="line">    CHATGLM3 = auto()</span><br><span class="line">    DEEPSEEK_CHAT = auto()</span><br><span class="line">    METAMATH = auto()</span><br><span class="line">    YUAN2 = auto()</span><br></pre></td></tr></tbody></table></figure><p>ä»<code>fastchat</code>åŒ…å¯¼å…¥<code>SeparatorStyle</code>ï¼Œç”¨äºå®šä¹‰å¯¹è¯åˆ†éš”ç¬¦é£æ ¼ã€‚<code>SeparatorStyle</code> ç±»æ˜¯ä¸€ä¸ªä½¿ç”¨ Python çš„ <code>enum</code> æ¨¡å—åˆ›å»ºçš„æšä¸¾ç±»ï¼Œç”¨äºå®šä¹‰ä¸€ç³»åˆ—çš„åˆ†éš”ç¬¦æ ·å¼ã€‚æšä¸¾ï¼ˆEnumerationï¼‰æ˜¯ä¸€ç§ç¼–ç¨‹æ¦‚å¿µï¼Œç”¨äºå®šä¹‰ä¸€ç»„å‘½åçš„å¸¸æ•°ï¼Œä½¿ä»£ç æ›´åŠ æ¸…æ™°å’Œæ˜“äºç»´æŠ¤ã€‚</p><p>åœ¨ <code>SeparatorStyle</code> ç±»ä¸­ï¼Œæ¯ä¸ªæˆå‘˜ä»£è¡¨ä¸€ç§ç‰¹å®šçš„åˆ†éš”ç¬¦æ ·å¼ã€‚è¿™äº›æ ·å¼é€šå¸¸ç”¨äºæ–‡æœ¬å¤„ç†ä¸­ï¼Œç‰¹åˆ«æ˜¯åœ¨éœ€è¦åŒºåˆ†ä¸åŒéƒ¨åˆ†æˆ–å…ƒç´ çš„æƒ…å†µä¸‹ã€‚ä¾‹å¦‚ï¼Œåœ¨å¤„ç†å¯¹è¯æˆ–æ–‡æœ¬æ•°æ®æ—¶ï¼Œå¯èƒ½éœ€è¦ä¸åŒçš„æ–¹å¼æ¥åŒºåˆ†ç”¨æˆ·è¾“å…¥å’Œæœºå™¨å›å¤ã€‚</p><p>å…³äº <code>auto()</code> å‡½æ•°çš„ä½¿ç”¨ï¼š</p><ul><li><code>auto()</code> æ˜¯ Python <code>enum</code> æ¨¡å—æä¾›çš„ä¸€ä¸ªç‰¹æ®Šå‡½æ•°ã€‚å®ƒåœ¨æšä¸¾ç±»ä¸­è‡ªåŠ¨åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„å€¼ç»™æ¯ä¸ªæˆå‘˜ã€‚</li><li>åœ¨ä¸ä½¿ç”¨ <code>auto()</code> çš„æƒ…å†µä¸‹ï¼Œä½ éœ€è¦æ‰‹åŠ¨ä¸ºæ¯ä¸ªæšä¸¾æˆå‘˜æŒ‡å®šä¸€ä¸ªå”¯ä¸€çš„å€¼ã€‚ä½¿ç”¨ <code>auto()</code> å¯ä»¥ç®€åŒ–è¿™ä¸ªè¿‡ç¨‹ï¼Œè®© Python è‡ªåŠ¨å¤„ç†è¿™äº›å€¼çš„åˆ†é…ã€‚</li><li><code>auto()</code> åˆ†é…çš„å€¼é€šå¸¸æ˜¯æ•´æ•°ï¼Œä» 1 å¼€å§‹ä¾æ¬¡é€’å¢ã€‚</li></ul><p>å…·ä½“åˆ° <code>SeparatorStyle</code> ç±»ï¼Œ<code>auto()</code> è¢«ç”¨æ¥ä¸ºæ¯ç§åˆ†éš”ç¬¦æ ·å¼è‡ªåŠ¨åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„æ•´æ•°å€¼ã€‚ä¾‹å¦‚ï¼Œ<code>ADD_COLON_SINGLE</code>ã€<code>ADD_COLON_TWO</code> ç­‰å°†åˆ†åˆ«è¢«èµ‹äºˆä¸åŒçš„æ•´æ•°å€¼ã€‚</p><p>æ¯ä¸ªæšä¸¾æˆå‘˜çš„åç§°ï¼ˆå¦‚ <code>ADD_COLON_SINGLE</code>ã€<code>NO_COLON_SINGLE</code> ç­‰ï¼‰é€šå¸¸æè¿°äº†è¯¥åˆ†éš”ç¬¦æ ·å¼çš„ç‰¹ç‚¹ã€‚ä¾‹å¦‚ï¼Œ<code>ADD_COLON_SINGLE</code> å¯èƒ½è¡¨ç¤ºåœ¨æŸä¸ªå…ƒç´ åæ·»åŠ ä¸€ä¸ªå†’å·ä½œä¸ºåˆ†éš”ç¬¦ï¼Œè€Œ <code>NO_COLON_SINGLE</code> åˆ™è¡¨ç¤ºä¸æ·»åŠ å†’å·ã€‚</p><p>è¿™ç§æ–¹å¼ä½¿å¾—åœ¨ä»£ç ä¸­å¼•ç”¨å’Œå¤„ç†è¿™äº›åˆ†éš”ç¬¦æ ·å¼å˜å¾—æ›´åŠ æ–¹ä¾¿å’Œæ¸…æ™°ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥æ ¹æ®ä¸åŒçš„åœºæ™¯æˆ–éœ€æ±‚é€‰æ‹©ä½¿ç”¨ä¸åŒçš„åˆ†éš”ç¬¦æ ·å¼ï¼Œè€Œæ— éœ€è®°ä½å®ƒä»¬å¯¹åº”çš„å…·ä½“å€¼ã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastchat.model.model_adapter <span class="keyword">import</span> get_conversation_template</span><br><span class="line"></span><br><span class="line"><span class="comment">## code from FastChat/fastchat/model/model_adapter.py</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_conversation_template</span>(<span class="params">model_path: <span class="built_in">str</span></span>) -&gt; Conversation:</span><br><span class="line">    <span class="string">"""Get the default conversation template."""</span></span><br><span class="line">    adapter = get_model_adapter(model_path)</span><br><span class="line">    <span class="keyword">return</span> adapter.get_default_conv_template(model_path)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## code from FastChat/fastchat/model/model_adapter.py</span></span><br><span class="line"><span class="meta">@cache</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_model_adapter</span>(<span class="params">model_path: <span class="built_in">str</span></span>) -&gt; BaseModelAdapter:</span><br><span class="line">    <span class="string">"""Get a model adapter for a model_path."""</span></span><br><span class="line">    model_path_basename = os.path.basename(os.path.normpath(model_path))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Try the basename of model_path at first</span></span><br><span class="line">    <span class="keyword">for</span> adapter <span class="keyword">in</span> model_adapters:</span><br><span class="line">        <span class="keyword">if</span> adapter.<span class="keyword">match</span>(model_path_basename) <span class="keyword">and</span> <span class="built_in">type</span>(adapter) != BaseModelAdapter:</span><br><span class="line">            <span class="keyword">return</span> adapter</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Then try the full path</span></span><br><span class="line">    <span class="keyword">for</span> adapter <span class="keyword">in</span> model_adapters:</span><br><span class="line">        <span class="keyword">if</span> adapter.<span class="keyword">match</span>(model_path):</span><br><span class="line">            <span class="keyword">return</span> adapter</span><br><span class="line"></span><br><span class="line">    <span class="keyword">raise</span> ValueError(<span class="string">f"No valid model adapter for <span class="subst">{model_path}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## code from FastChat/fastchat/model/model_adapter.py</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_default_conv_template</span>(<span class="params">self, model_path: <span class="built_in">str</span></span>) -&gt; Conversation:</span><br><span class="line">        <span class="keyword">return</span> get_conv_template(<span class="string">"one_shot"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## code from FastChat/fastchat/conversation.py</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_conv_template</span>(<span class="params">name: <span class="built_in">str</span></span>) -&gt; Conversation:</span><br><span class="line">    <span class="string">"""Get a conversation template."""</span></span><br><span class="line">    <span class="keyword">return</span> conv_templates[name].copy()</span><br><span class="line"></span><br><span class="line"><span class="comment">## code from FastChat/fastchat/conversation.py</span></span><br><span class="line"><span class="comment"># A global registry for all conversation templates</span></span><br><span class="line">conv_templates: <span class="type">Dict</span>[<span class="built_in">str</span>, Conversation] = {}</span><br></pre></td></tr></tbody></table></figure><p>ä»<code>fastchat</code>åŒ…å¯¼å…¥<code>get_conversation_template</code>ï¼Œç”¨äºè·å–å¯¹è¯æ¨¡æ¿ã€‚<br>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œè°ƒç”¨é€»è¾‘ä¸»è¦æ¶‰åŠåˆ°è·å–ç‰¹å®šæ¨¡å‹çš„é»˜è®¤å¯¹è¯æ¨¡æ¿ã€‚è°ƒç”¨é“¾è·¯å¦‚ä¸‹ï¼š</p><ol><li><p><strong>èµ·å§‹è°ƒç”¨ - <code>get_conversation_template(model_path: str)</code></strong></p><ul><li>è¿™ä¸ªå‡½æ•°æ˜¯è°ƒç”¨é“¾çš„èµ·ç‚¹ã€‚å®ƒæ¥æ”¶ä¸€ä¸ªå‚æ•° <code>model_path</code>ï¼Œç”¨äºæŒ‡å®šæ¨¡å‹çš„è·¯å¾„ã€‚</li><li>è¿™ä¸ªå‡½æ•°çš„ç›®çš„æ˜¯è·å–ç»™å®šæ¨¡å‹è·¯å¾„çš„é»˜è®¤å¯¹è¯æ¨¡æ¿ã€‚</li></ul></li><li><p><strong>è°ƒç”¨ <code>get_model_adapter(model_path: str)</code></strong></p><ul><li><code>get_conversation_template</code> å‡½æ•°é¦–å…ˆè°ƒç”¨ <code>get_model_adapter</code>ï¼Œä¼ å…¥æ¨¡å‹è·¯å¾„ã€‚</li><li><code>get_model_adapter</code> çš„ç›®çš„æ˜¯æ ¹æ®æä¾›çš„æ¨¡å‹è·¯å¾„ï¼Œæ‰¾åˆ°å¹¶è¿”å›ä¸€ä¸ªé€‚åˆè¯¥æ¨¡å‹çš„ <code>BaseModelAdapter</code> å¯¹è±¡ã€‚</li><li>è¿™ä¸ªå‡½æ•°é¦–å…ˆå°è¯•åŒ¹é… <code>model_path</code> çš„åŸºæœ¬åç§°ï¼ˆbasenameï¼‰ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°åŒ¹é…é¡¹ï¼Œå®ƒä¼šå°è¯•åŒ¹é…å®Œæ•´çš„è·¯å¾„ã€‚</li><li>å¦‚æœæ‰¾åˆ°åˆé€‚çš„é€‚é…å™¨ï¼Œåˆ™è¿”å›è¯¥é€‚é…å™¨ï¼›å¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™æŠ›å‡ºä¸€ä¸ª <code>ValueError</code>ã€‚</li></ul></li><li><p><strong>æ‰§è¡Œ <code>BaseModelAdapter.get_default_conv_template(model_path: str)</code></strong></p><ul><li>åœ¨è·å–åˆ°é€‚å½“çš„æ¨¡å‹é€‚é…å™¨åï¼Œ<code>get_conversation_template</code> é€šè¿‡è°ƒç”¨è¯¥é€‚é…å™¨çš„ <code>get_default_conv_template</code> æ–¹æ³•æ¥è·å–é»˜è®¤çš„å¯¹è¯æ¨¡æ¿ã€‚</li><li>æ³¨æ„è¿™ä¸ªæ–¹æ³•åœ¨ <code>BaseModelAdapter</code> ç±»ä¸­å®šä¹‰ï¼Œä½†å¯èƒ½åœ¨å­ç±»ä¸­è¢«é‡å†™ã€‚</li></ul></li><li><p><strong>è°ƒç”¨ <code>get_conv_template(name: str)</code></strong></p><ul><li>åœ¨ <code>get_default_conv_template</code> æ–¹æ³•å†…éƒ¨ï¼Œå®ƒè°ƒç”¨ <code>get_conv_template</code> å‡½æ•°ï¼Œé€šå¸¸ä¼ å…¥ä¸€ä¸ªé¢„å®šä¹‰çš„æ¨¡æ¿åç§°ï¼Œæ¯”å¦‚ <code>"one_shot"</code>ã€‚</li><li><code>get_conv_template</code> çš„ä½œç”¨æ˜¯ä»å…¨å±€æ³¨å†Œçš„å¯¹è¯æ¨¡æ¿å­—å…¸ <code>conv_templates</code> ä¸­è·å–æŒ‡å®šåç§°çš„æ¨¡æ¿ã€‚</li></ul></li><li><p><strong>è·å–å¹¶è¿”å› <code>Conversation</code> å¯¹è±¡</strong></p><ul><li><code>get_conv_template</code> å‡½æ•°è¿”å› <code>Conversation</code> ç±»çš„ä¸€ä¸ªå®ä¾‹ï¼Œè¿™é€šå¸¸æ˜¯ä» <code>conv_templates</code> å­—å…¸ä¸­å¤åˆ¶å¾—åˆ°çš„ã€‚</li><li>æœ€ç»ˆï¼Œè¿™ä¸ª <code>Conversation</code> å®ä¾‹è¢«è¿”å›åˆ°æœ€åˆè°ƒç”¨ <code>get_conversation_template</code> çš„åœ°æ–¹ã€‚</li></ul></li></ol><p>æ€»ç»“è°ƒç”¨é“¾è·¯ï¼š</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">get_conversation_template(model_path)</span><br><span class="line">  -&gt; get_model_adapter(model_path)</span><br><span class="line">  -&gt; [BaseModelAdapter].get_default_conv_template(model_path)</span><br><span class="line">    -&gt; get_conv_template(name)</span><br><span class="line">      -&gt; è¿”å› Conversation å¯¹è±¡</span><br></pre></td></tr></tbody></table></figure><p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä»£ç é€šè¿‡ä¸€ç³»åˆ—å‡½æ•°è°ƒç”¨ï¼Œæ ¹æ®æä¾›çš„æ¨¡å‹è·¯å¾„ï¼Œæ‰¾åˆ°ç›¸åº”çš„æ¨¡å‹é€‚é…å™¨ï¼Œå¹¶ä»ä¸­è·å–ç‰¹å®šçš„å¯¹è¯æ¨¡æ¿ã€‚è¿™ç§è®¾è®¡æ¨¡å¼å…è®¸çµæ´»åœ°ä¸ºä¸åŒçš„æ¨¡å‹æä¾›ä¸åŒçš„å¯¹è¯æ¨¡æ¿ï¼Œä»è€Œæé«˜äº†ä»£ç çš„å¯é‡ç”¨æ€§å’Œå¯æ‰©å±•æ€§ã€‚</p><hr><h2 id="2-é…ç½®ç±»"><a href="#2-é…ç½®ç±»" class="headerlink" title="2. é…ç½®ç±»"></a>2. é…ç½®ç±»</h2><p>è¿™äº›ç±»æ˜¯ä½¿ç”¨ Python çš„ <code>dataclass</code> è£…é¥°å™¨å®šä¹‰çš„ï¼Œä¸»è¦ç”¨äºå­˜å‚¨é…ç½®å’Œå‚æ•°ã€‚è¿™äº›ç±»é€šå¸¸ä¸åŒ…å«å¤æ‚çš„æ–¹æ³•æˆ–é€»è¾‘ï¼Œè€Œæ˜¯ç”¨äºå®šä¹‰å’Œå­˜å‚¨æ•°æ®ç»“æ„ã€‚è¿™äº›ç±»åŒ…æ‹¬ï¼š</p><ul><li><code>ModelArguments</code>: å­˜å‚¨ä¸æ¨¡å‹ç›¸å…³çš„å‚æ•°ï¼Œå¦‚æ¨¡å‹è·¯å¾„ã€è¿œç¨‹ä»£ç ä¿¡ä»»ç­‰ã€‚</li><li><code>DataArguments</code>: å­˜å‚¨ä¸æ•°æ®ç›¸å…³çš„å‚æ•°ï¼Œå¦‚æ•°æ®è·¯å¾„ã€è¯„ä¼°æ•°æ®è·¯å¾„ä»¥åŠæ˜¯å¦ä½¿ç”¨æ‡’åŠ è½½é¢„å¤„ç†ã€‚</li><li><code>TrainingArguments</code>: å­˜å‚¨ä¸è®­ç»ƒç›¸å…³çš„å‚æ•°ï¼Œå¦‚ç¼“å­˜ç›®å½•ã€ä¼˜åŒ–å™¨ç±»å‹ã€æ¨¡å‹æœ€å¤§é•¿åº¦ç­‰ã€‚è¿™ä¸ªç±»ç»§æ‰¿è‡ª <code>transformers.TrainingArguments</code>ï¼Œå¢åŠ äº†ä¸€äº›è‡ªå®šä¹‰å‚æ•°ã€‚</li></ul><p>è¿™äº›ç±»ä¸»è¦ç”¨äºç®€åŒ–å’Œç»„ç»‡ä»£ç ä¸­çš„å‚æ•°ç®¡ç†ï¼Œä½¿å¾—å‚æ•°çš„ä¿®æ”¹å’Œè®¿é—®æ›´åŠ æ–¹ä¾¿ã€‚</p><h3 id="1-ModelArguments-ç±»"><a href="#1-ModelArguments-ç±»" class="headerlink" title="1. ModelArguments ç±»"></a>1. ModelArguments ç±»</h3><h4 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h4><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@dataclass</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ModelArguments</span>:</span><br><span class="line">    model_name_or_path: <span class="type">Optional</span>[<span class="built_in">str</span>] = field(default=<span class="string">"facebook/opt-125m"</span>)</span><br><span class="line">    trust_remote_code: <span class="built_in">bool</span> = field(</span><br><span class="line">        default=<span class="literal">False</span>,</span><br><span class="line">        metadata={</span><br><span class="line">            <span class="string">"help"</span>: <span class="string">"Whether or not to allow for custom models defined on the Hub in their own modeling files"</span></span><br><span class="line">        },</span><br><span class="line">    )</span><br><span class="line">    padding_side: <span class="built_in">str</span> = field(</span><br><span class="line">        default=<span class="string">"right"</span>, metadata={<span class="string">"help"</span>: <span class="string">"The padding side in tokenizer"</span>}</span><br><span class="line">    )</span><br></pre></td></tr></tbody></table></figure><h4 id="Explanation"><a href="#Explanation" class="headerlink" title="Explanation"></a>Explanation</h4><p><code>ModelArguments</code> æ˜¯ä¸€ä¸ªæ•°æ®ç±»ï¼ˆ<code>dataclass</code>ï¼‰ï¼Œç”¨äºå­˜å‚¨ä¸æ¨¡å‹ç›¸å…³çš„é…ç½®å‚æ•°ã€‚<br><strong>å±æ€§ï¼š</strong></p><ol><li><code>model_name_or_path</code>: æŒ‡å®šé¢„è®­ç»ƒæ¨¡å‹çš„åç§°æˆ–è·¯å¾„ã€‚</li><li><code>trust_remote_code</code>: æ˜¯å¦å…è®¸ä½¿ç”¨è‡ªå®šä¹‰æ¨¡å‹ï¼Œè¿™äº›æ¨¡å‹åœ¨ Hub ä¸Šæœ‰è‡ªå·±çš„æ¨¡å‹æ–‡ä»¶ã€‚</li><li><code>padding_side</code>: æŒ‡å®šåœ¨åˆ†è¯å™¨ï¼ˆ<code>tokenizer</code>ï¼‰ä¸­ä½¿ç”¨çš„å¡«å……æ–¹å¼ï¼Œé€šå¸¸æ˜¯å·¦å¡«å……æˆ–å³å¡«å……ã€‚</li></ol><details><summary> `@dataclass`è£…é¥°å™¨çš„ä»‹ç»ï¼Œç‚¹å‡»å±•å¼€</summary>`@dataclass` æ˜¯ä¸€ä¸ªè£…é¥°å™¨ï¼Œç”¨äºè‡ªåŠ¨åŒ–ç”Ÿæˆç‰¹æ®Šæ–¹æ³•ï¼Œå¦‚ `__init__()`ã€`__repr__()`ã€`__eq__()` ç­‰ï¼Œä»è€Œç®€åŒ–æ•°æ®ç±»çš„ç¼–å†™ã€‚è¿™ä¸ªè£…é¥°å™¨æ˜¯ Python 3.7 ä¸­å¼•å…¥çš„ä¸€éƒ¨åˆ†ï¼Œå±äº `dataclasses` æ¨¡å—ã€‚<p>å½“ä½ åœ¨ä¸€ä¸ªç±»å®šä¹‰å‰ä½¿ç”¨ <code>@dataclass</code> è£…é¥°å™¨æ—¶ï¼ŒPython ä¼šè‡ªåŠ¨ä¸ºè¿™ä¸ªç±»æ·»åŠ ä¸€äº›ç”±å±æ€§å®šä¹‰çš„ç‰¹æ®Šæ–¹æ³•ã€‚è¿™å¯¹äºåˆ›å»ºå­˜å‚¨å°‘é‡æ•°æ®ä½†ä¸éœ€è¦å¤æ‚æ–¹æ³•çš„ç±»éå¸¸æœ‰ç”¨ã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œä½¿ç”¨ <code>@dataclass</code> æ—¶ï¼š</p><ol><li><p><strong>è‡ªåŠ¨ç”Ÿæˆæ„é€ å‡½æ•°ï¼ˆ<code>__init__</code> æ–¹æ³•ï¼‰</strong>ï¼šPython ä¼šæ ¹æ®ç±»ä¸­å®šä¹‰çš„å­—æ®µè‡ªåŠ¨åˆ›å»ºä¸€ä¸ª <code>__init__</code> æ–¹æ³•ï¼Œè¿™æ ·ä½ å°±ä¸éœ€è¦æ‰‹åŠ¨ç¼–å†™è¿™ä¸ªæ–¹æ³•æ¥åˆå§‹åŒ–ç±»çš„å®ä¾‹äº†ã€‚</p></li><li><p><strong>è‡ªåŠ¨ç”Ÿæˆ <code>__repr__</code> æ–¹æ³•</strong>ï¼šè¿™ä½¿å¾—æ‰“å°ç±»çš„å®ä¾‹æ—¶èƒ½å¤Ÿå¾—åˆ°æ›´å…·å¯è¯»æ€§çš„å­—ç¬¦ä¸²è¡¨ç¤ºï¼Œé€šå¸¸åŒ…å«ç±»åå’Œå…¶ä¸­çš„å­—æ®µåŠå…¶å€¼ã€‚</p></li><li><p><strong>è‡ªåŠ¨ç”Ÿæˆ <code>__eq__</code> æ–¹æ³•</strong>ï¼šè¿™ä½¿å¾—å¯ä»¥ä½¿ç”¨ <code>==</code> æ“ä½œç¬¦æ¥æ¯”è¾ƒä¸¤ä¸ªç±»çš„å®ä¾‹ï¼Œæ¯”è¾ƒçš„æ˜¯å®ä¾‹ä¸­å­—æ®µçš„å€¼ã€‚</p></li><li><p><strong>æ”¯æŒç±»å‹æ³¨è§£</strong>ï¼šåœ¨å®šä¹‰å­—æ®µæ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ç±»å‹æ³¨è§£ï¼Œè¿™ä¸ä»…æœ‰åŠ©äºä»£ç æ¸…æ™°æ€§ï¼Œè¿˜å¯ä»¥é€šè¿‡ä¸€äº›å·¥å…·è¿›è¡Œç±»å‹æ£€æŸ¥ã€‚</p></li></ol><p>åœ¨<code>ModelArguments</code>ç±»çš„ä¾‹å­ä¸­ï¼Œ<code>@dataclass</code>è£…é¥°å™¨ä¼šä¸ºè¿™ä¸ªç±»ç”Ÿæˆä¸Šè¿°çš„æ–¹æ³•ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥å¾ˆæ–¹ä¾¿åœ°åˆ›å»º<code>ModelArguments</code>çš„å®ä¾‹ï¼Œå¹¶åœ¨æ‰“å°æˆ–æ¯”è¾ƒè¿™äº›å®ä¾‹æ—¶å¾—åˆ°é¢„æœŸçš„è¡Œä¸ºã€‚</p><p>ä¾‹å¦‚ï¼Œå½“ä½ åˆ›å»ºä¸€ä¸ª<code>ModelArguments</code>å®ä¾‹æ—¶ï¼š</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">args = ModelArguments()</span><br></pre></td></tr></tbody></table></figure><p>è¿™å°†è°ƒç”¨è‡ªåŠ¨ç”Ÿæˆçš„<code>__init__</code>æ–¹æ³•ï¼Œä½¿ç”¨é»˜è®¤å€¼â€facebook/opt-125mâ€ä¸º<code>model_name_or_path</code>ã€<code>False</code>ä¸º<code>trust_remote_code</code>å’Œâ€rightâ€ä¸º<code>padding_side</code>ã€‚</p><p>å½“ä½ æ‰“å°è¿™ä¸ªå®ä¾‹ï¼š</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(args)</span><br></pre></td></tr></tbody></table></figure><p>è¿™å°†è°ƒç”¨è‡ªåŠ¨ç”Ÿæˆçš„<code>__repr__</code>æ–¹æ³•ï¼Œæ˜¾ç¤ºç±»å®ä¾‹çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¦‚<code>ModelArguments(model_name_or_path="facebook/opt-125m", trust_remote_code=False, padding_side="right")</code>ã€‚</p><p>è¿™æ ·ï¼Œ<code>@dataclass</code>è£…é¥°å™¨ç®€åŒ–äº†ç±»çš„åˆ›å»ºè¿‡ç¨‹ï¼Œä½¿å¾—ä»£ç æ›´åŠ ç®€æ´å’Œæ˜“äºç»´æŠ¤ã€‚</p><p>æ€»çš„æ¥è¯´ï¼Œ<code>@dataclass</code> è£…é¥°å™¨æ˜¯ Python æä¾›çš„ä¸€ä¸ªä¾¿æ·å·¥å…·ï¼Œç”¨äºå¿«é€Ÿåˆ›å»ºä¸»è¦ç”¨äºå­˜å‚¨æ•°æ®çš„ç±»ã€‚</p></details><h3 id="2-DataArguments-ç±»"><a href="#2-DataArguments-ç±»" class="headerlink" title="2. DataArguments ç±»"></a>2. DataArguments ç±»</h3><h4 id="Code-1"><a href="#Code-1" class="headerlink" title="Code"></a>Code</h4><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@dataclass</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DataArguments</span>:</span><br><span class="line">    data_path: <span class="built_in">str</span> = field(</span><br><span class="line">        default=<span class="literal">None</span>, metadata={<span class="string">"help"</span>: <span class="string">"Path to the training data."</span>}</span><br><span class="line">    )</span><br><span class="line">    eval_data_path: <span class="built_in">str</span> = field(</span><br><span class="line">        default=<span class="literal">None</span>, metadata={<span class="string">"help"</span>: <span class="string">"Path to the evaluation data."</span>}</span><br><span class="line">    )</span><br><span class="line">    lazy_preprocess: <span class="built_in">bool</span> = <span class="literal">False</span></span><br></pre></td></tr></tbody></table></figure><h4 id="Explanation-1"><a href="#Explanation-1" class="headerlink" title="Explanation"></a>Explanation</h4><p><strong>DataArguments ç±»</strong></p><ul><li><code>DataArguments</code> ä¹Ÿæ˜¯ä¸€ä¸ªæ•°æ®ç±»ï¼Œç”¨äºå­˜å‚¨æ•°æ®ç›¸å…³çš„é…ç½®å‚æ•°ã€‚</li><li>å±æ€§ï¼š<ul><li><code>data_path</code>: è®­ç»ƒæ•°æ®çš„è·¯å¾„ã€‚</li><li><code>eval_data_path</code>: è¯„ä¼°æ•°æ®çš„è·¯å¾„ã€‚</li><li><code>lazy_preprocess</code>: æ˜¯å¦åœ¨æ•°æ®é¢„å¤„ç†æ—¶ä½¿ç”¨å»¶è¿ŸåŠ è½½ï¼Œå³åœ¨éœ€è¦æ—¶æ‰åŠ è½½å’Œå¤„ç†æ•°æ®ã€‚</li></ul></li></ul><h3 id="3-TrainingArguments-ç±»"><a href="#3-TrainingArguments-ç±»" class="headerlink" title="3. TrainingArguments ç±»"></a>3. TrainingArguments ç±»</h3><h4 id="Code-2"><a href="#Code-2" class="headerlink" title="Code"></a>Code</h4><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@dataclass</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TrainingArguments</span>(transformers.TrainingArguments):</span><br><span class="line">    cache_dir: <span class="type">Optional</span>[<span class="built_in">str</span>] = field(default=<span class="literal">None</span>)</span><br><span class="line">    optim: <span class="built_in">str</span> = field(default=<span class="string">"adamw_torch"</span>)</span><br><span class="line">    model_max_length: <span class="built_in">int</span> = field(</span><br><span class="line">        default=<span class="number">512</span>,</span><br><span class="line">        metadata={</span><br><span class="line">            <span class="string">"help"</span>: <span class="string">"Maximum sequence length. Sequences will be right padded (and possibly truncated)."</span></span><br><span class="line">        },</span><br><span class="line">    )</span><br></pre></td></tr></tbody></table></figure><h4 id="Explanation-2"><a href="#Explanation-2" class="headerlink" title="Explanation"></a>Explanation</h4><p><code>TrainingArguments</code> ç±»ç»§æ‰¿è‡ª <code>transformers.TrainingArguments</code>ã€‚ã€‚</p><ol><li><p><strong>TrainingArguments ç±»</strong></p><ul><li><code>TrainingArguments</code> æ˜¯ä¸€ä¸ªæ•°æ®ç±»ï¼Œå®ƒé€šè¿‡ç»§æ‰¿ <code>transformers.TrainingArguments</code>ï¼Œè·å¾—äº†å¤„ç†è®­ç»ƒå‚æ•°çš„èƒ½åŠ›ã€‚</li><li>åœ¨ <code>TrainingArguments</code> ä¸­å®šä¹‰çš„å±æ€§ï¼š<ul><li><code>cache_dir</code>: ç”¨äºæŒ‡å®šæ¨¡å‹å’Œåˆ†è¯å™¨ç¼“å­˜çš„ç›®å½•è·¯å¾„ã€‚</li><li><code>optim</code>: å®šä¹‰äº†è¦ä½¿ç”¨çš„ä¼˜åŒ–å™¨ç±»å‹ï¼Œä¾‹å¦‚ <code>'adamw_torch'</code>ã€‚</li><li><code>model_max_length</code>: æŒ‡å®šæ¨¡å‹èƒ½å¤„ç†çš„æœ€å¤§åºåˆ—é•¿åº¦ã€‚</li></ul></li></ul></li><li><p><strong>transformers.TrainingArguments ç±»</strong></p><ul><li><code>transformers.TrainingArguments</code> æ˜¯ <code>transformers</code> åº“ä¸­çš„ä¸€ä¸ªç±»ï¼Œç”¨äºé…ç½®æ¨¡å‹è®­ç»ƒè¿‡ç¨‹ä¸­çš„å„ç§å‚æ•°ã€‚</li><li>è¿™ä¸ªç±»åŒ…å«å¤§é‡çš„å±æ€§ï¼Œç”¨äºæ§åˆ¶è®­ç»ƒè¿‡ç¨‹ï¼Œä¾‹å¦‚ï¼š<ul><li><code>output_dir</code>: æŒ‡å®šä¿å­˜æ¨¡å‹å’Œè®­ç»ƒç»“æœçš„ç›®å½•ã€‚</li><li><code>num_train_epochs</code>: è®­ç»ƒçš„è½®æ•°ï¼ˆepochsï¼‰ã€‚</li><li><code>per_device_train_batch_size</code>: æ¯ä¸ªè®¾å¤‡ä¸Šçš„è®­ç»ƒæ‰¹æ¬¡å¤§å°ã€‚</li><li><code>save_steps</code>: ä¿å­˜æ¨¡å‹çš„æ­¥æ•°é—´éš”ã€‚</li><li><code>evaluation_strategy</code>: è¯„ä¼°æ¨¡å‹çš„ç­–ç•¥ï¼Œå¦‚åœ¨æ¯ä¸ª epoch ç»“æŸæ—¶è¿›è¡Œè¯„ä¼°ã€‚</li><li><code>learning_rate</code>: å­¦ä¹ ç‡ã€‚</li><li><code>warmup_steps</code>: åœ¨å­¦ä¹ ç‡è°ƒåº¦ä¸­ç”¨äºé¢„çƒ­çš„æ­¥æ•°ã€‚</li></ul></li><li><code>transformers.TrainingArguments</code> è¿˜åŒ…å«äº†è®¸å¤šå…¶ä»–å‚æ•°ï¼Œç”¨äºå¾®è°ƒè®­ç»ƒè¿‡ç¨‹ï¼ŒåŒ…æ‹¬æ—¥å¿—è®°å½•ã€æ¨¡å‹ä¿å­˜ç­–ç•¥ã€å­¦ä¹ ç‡è°ƒåº¦ç­‰ã€‚</li></ul></li></ol><p>é€šè¿‡ç»§æ‰¿ <code>transformers.TrainingArguments</code>ï¼Œ<code>TrainingArguments</code> ç±»ä¸ä»…ç»§æ‰¿äº†æ‰€æœ‰è¿™äº›è®­ç»ƒå‚æ•°çš„é…ç½®èƒ½åŠ›ï¼Œè€Œä¸”è¿˜å¯ä»¥æ·»åŠ ä¸€äº›è‡ªå®šä¹‰çš„è®­ç»ƒå‚æ•°ï¼Œå¦‚æœ¬ä¾‹ä¸­çš„ <code>cache_dir</code>ã€<code>optim</code> å’Œ <code>model_max_length</code>ã€‚è¿™ç§åšæ³•æé«˜äº†ä»£ç çš„å¯å¤ç”¨æ€§å’Œçµæ´»æ€§ï¼Œä½¿å¾—æ‚¨å¯ä»¥æ ¹æ®é¡¹ç›®çš„å…·ä½“éœ€æ±‚è°ƒæ•´å’Œæ‰©å±•è®­ç»ƒé…ç½®ã€‚</p><h2 id="3-åŠŸèƒ½å‹å‡½æ•°-Functional-Utility-Functions"><a href="#3-åŠŸèƒ½å‹å‡½æ•°-Functional-Utility-Functions" class="headerlink" title="3.åŠŸèƒ½å‹å‡½æ•° (Functional Utility Functions)"></a>3.åŠŸèƒ½å‹å‡½æ•° (Functional Utility Functions)</h2><h3 id="1-rank0-print-args"><a href="#1-rank0-print-args" class="headerlink" title="1. rank0_print(*args)"></a>1. rank0_print(*args)</h3><h4 id="Code-3"><a href="#Code-3" class="headerlink" title="Code"></a>Code</h4><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">local_rank = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rank0_print</span>(<span class="params">*args</span>):</span><br><span class="line">    <span class="keyword">if</span> local_rank == <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(*args)</span><br></pre></td></tr></tbody></table></figure><h4 id="Explanation-3"><a href="#Explanation-3" class="headerlink" title="Explanation"></a>Explanation</h4><p>å®šä¹‰ä¸€ä¸ªå…¨å±€å˜é‡ local_rankï¼Œç”¨äºåˆ†å¸ƒå¼è®­ç»ƒã€‚<br>å®šä¹‰ä¸€ä¸ªå‡½æ•° rank0_printï¼Œåªåœ¨ local_rank ä¸º 0 æ—¶æ‰“å°ä¿¡æ¯ï¼Œç”¨äºåˆ†å¸ƒå¼è®­ç»ƒä¸­çš„ä¿¡æ¯è¾“å‡ºæ§åˆ¶ã€‚è¿™æ ·å¯ä»¥é¿å…åœ¨å¤šä¸ªèŠ‚ç‚¹ä¸Šé‡å¤æ‰“å°ç›¸åŒçš„ä¿¡æ¯ï¼Œä½¿å¾—è¾“å‡ºæ›´åŠ æ¸…æ™°å’Œç®€æ´ã€‚</p><ul><li>ç”¨äºåªåœ¨åˆ†å¸ƒå¼è®­ç»ƒç¯å¢ƒä¸­çš„ä¸»èŠ‚ç‚¹ï¼ˆrank 0ï¼‰ä¸Šæ‰“å°ä¿¡æ¯ã€‚</li><li>å‚æ•°ï¼šå¯å˜æ•°é‡çš„å‚æ•°ï¼Œç”¨äºæ‰“å°ã€‚</li></ul><h3 id="2-trainer-save-model-safe-trainer-transformers-Trainer"><a href="#2-trainer-save-model-safe-trainer-transformers-Trainer" class="headerlink" title="2. trainer_save_model_safe(trainer: transformers.Trainer)"></a>2. <code>trainer_save_model_safe(trainer: transformers.Trainer)</code></h3><h4 id="Code-4"><a href="#Code-4" class="headerlink" title="Code"></a>Code</h4><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">trainer_save_model_safe</span>(<span class="params">trainer: transformers.Trainer</span>):</span><br><span class="line">    <span class="keyword">from</span> torch.distributed.fsdp <span class="keyword">import</span> FullyShardedDataParallel <span class="keyword">as</span> FSDP</span><br><span class="line">    <span class="keyword">from</span> torch.distributed.fsdp <span class="keyword">import</span> StateDictType, FullStateDictConfig</span><br><span class="line"></span><br><span class="line">    save_policy = FullStateDictConfig(offload_to_cpu=<span class="literal">True</span>, rank0_only=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">with</span> FSDP.state_dict_type(</span><br><span class="line">        trainer.model, StateDictType.FULL_STATE_DICT, save_policy</span><br><span class="line">    ):</span><br><span class="line">        trainer.save_model()</span><br></pre></td></tr></tbody></table></figure><p>å‡½æ•° <code>trainer_save_model_safe(trainer: transformers.Trainer)</code> æ—¨åœ¨å®‰å…¨åœ°ä¿å­˜ä½¿ç”¨ PyTorch åˆ†å¸ƒå¼æ¡†æ¶è®­ç»ƒçš„æ¨¡å‹ã€‚è®©æˆ‘ä»¬è¯¦ç»†äº†è§£æ­¤å‡½æ•°åŠå…¶æ¶‰åŠçš„å…³é”®ç»„ä»¶ã€‚</p><h4 id="Explanation-4"><a href="#Explanation-4" class="headerlink" title="Explanation"></a>Explanation</h4><ol><li>å‚æ•°ï¼š</li></ol><ul><li><code>trainer</code>: <code>transformers.Trainer</code> çš„å®ä¾‹ã€‚è¿™ä¸ªç±»æ˜¯ Hugging Face Transformers åº“çš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ï¼Œç”¨äºè®­ç»ƒå’Œè¯„ä¼°æ¨¡å‹ã€‚</li></ul><ol start="2"><li>åŠŸèƒ½ï¼š</li></ol><ul><li>æ­¤å‡½æ•°çš„ä¸»è¦ç›®çš„æ˜¯åœ¨åˆ†å¸ƒå¼è®­ç»ƒç¯å¢ƒä¸­å®‰å…¨åœ°ä¿å­˜æ¨¡å‹ã€‚å®ƒç‰¹åˆ«è€ƒè™‘äº†ä½¿ç”¨ <code>FullyShardedDataParallel</code> (FSDP) è¿›è¡Œè®­ç»ƒæ—¶çš„æ¨¡å‹ä¿å­˜ç­–ç•¥ã€‚</li></ul><ol start="3"><li>FSDP</li></ol><ul><li><strong>FullyShardedDataParallel (FSDP)</strong><ul><li>è¿™æ˜¯ PyTorch åˆ†å¸ƒå¼è®­ç»ƒæ¡†æ¶çš„ä¸€ä¸ªç»„ä»¶ã€‚FSDP é€šè¿‡å°†æ¨¡å‹å‚æ•°åˆ†ç‰‡åˆ°å¤šä¸ª GPU ä¸Šæ¥å‡å°‘æ¯ä¸ª GPU çš„å†…å­˜å ç”¨ï¼Œä»è€Œå®ç°æ›´å¤§æ¨¡å‹çš„è®­ç»ƒã€‚</li><li>åœ¨æ­¤åœºæ™¯ä¸­ï¼ŒFSDP ä¸»è¦ç”¨äºå¤„ç†å’Œä¿å­˜åˆ†å¸ƒå¼è®­ç»ƒä¸­çš„æ¨¡å‹çŠ¶æ€ã€‚</li></ul></li><li><strong>StateDictType</strong><ul><li>è¿™æ˜¯ä¸€ä¸ªæšä¸¾ç±»å‹ï¼Œå®šä¹‰äº†å¦‚ä½•ä¿å­˜æ¨¡å‹çš„çŠ¶æ€å­—å…¸ï¼ˆstate dictï¼‰ã€‚åœ¨ FSDP ç¯å¢ƒä¸­ï¼Œä¿å­˜å’ŒåŠ è½½æ¨¡å‹çŠ¶æ€å¯èƒ½éœ€è¦ç‰¹æ®Šçš„å¤„ç†ã€‚</li></ul></li><li><strong>FullStateDictConfig</strong><ul><li>è¿™ä¸ªç±»ç”¨äºé…ç½®ä¿å­˜å®Œæ•´çŠ¶æ€å­—å…¸æ—¶çš„å‚æ•°ã€‚å®ƒæ˜¯ FSDP åŠŸèƒ½çš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºæ§åˆ¶å¦‚ä½•ä¿å­˜æ¨¡å‹çŠ¶æ€ã€‚</li></ul></li></ul><ol start="4"><li>å‡½æ•°å®ç°</li></ol><ul><li><strong>è®¾ç½®ä¿å­˜ç­–ç•¥</strong><ul><li><code>save_policy = FullStateDictConfig(offload_to_cpu=True, rank0_only=True)</code> åˆ›å»ºäº†ä¸€ä¸ªä¿å­˜ç­–ç•¥ã€‚è¿™é‡ŒæŒ‡å®šä¸¤ä¸ªå…³é”®å‚æ•°ï¼š<ul><li><code>offload_to_cpu</code>: åœ¨ä¿å­˜çŠ¶æ€å­—å…¸ä¹‹å‰ï¼Œå°†æ¨¡å‹å‚æ•°å¸è½½åˆ° CPUï¼Œè¿™æœ‰åŠ©äºå‡å°‘ GPU å†…å­˜çš„ä½¿ç”¨ã€‚</li><li><code>rank0_only</code>: åªåœ¨ rank 0ï¼ˆé€šå¸¸æ˜¯ä¸»èŠ‚ç‚¹ï¼‰ä¸Šä¿å­˜æ¨¡å‹ã€‚åœ¨åˆ†å¸ƒå¼è®­ç»ƒä¸­ï¼Œè¿™å¯ä»¥é¿å…æ¯ä¸ªèŠ‚ç‚¹éƒ½ä¿å­˜ç›¸åŒçš„æ¨¡å‹å‰¯æœ¬ï¼ŒèŠ‚çœå­˜å‚¨ç©ºé—´ã€‚</li></ul></li></ul></li><li><strong>ä¿å­˜æ¨¡å‹</strong><ul><li>ä½¿ç”¨ <code>with FSDP.state_dict_type(trainer.model, StateDictType.FULL_STATE_DICT, save_policy)</code> ä¸Šä¸‹æ–‡ç®¡ç†å™¨è®¾ç½®æ¨¡å‹ä¿å­˜çš„çŠ¶æ€å­—å…¸ç±»å‹å’Œç­–ç•¥ã€‚</li><li>åœ¨è¿™ä¸ªä¸Šä¸‹æ–‡å†…ï¼Œè°ƒç”¨ <code>trainer.save_model()</code> æ¥ä¿å­˜æ¨¡å‹ã€‚ç”±äºä½¿ç”¨äº† <code>save_policy</code>ï¼Œæ¨¡å‹å°†æ ¹æ®ä¸Šè¿°é…ç½®å®‰å…¨åœ°ä¿å­˜ã€‚</li></ul></li></ul><p>å‡½æ•° <code>trainer_save_model_safe</code> å°è£…äº†ä¸€ä¸ªå®‰å…¨çš„æ¨¡å‹ä¿å­˜é€»è¾‘ï¼Œç‰¹åˆ«æ˜¯é’ˆå¯¹ä½¿ç”¨ PyTorch çš„ FSDP è¿›è¡Œåˆ†å¸ƒå¼è®­ç»ƒçš„åœºæ™¯ã€‚å®ƒç¡®ä¿äº†åªåœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸Šä¿å­˜å®Œæ•´çš„æ¨¡å‹çŠ¶æ€ï¼Œå¹¶ä¸”åœ¨ä¿å­˜ä¹‹å‰å°†æ¨¡å‹å‚æ•°è½¬ç§»åˆ° CPUï¼Œä»è€Œä¼˜åŒ–å†…å­˜ä½¿ç”¨å’Œå­˜å‚¨æ•ˆç‡ã€‚è¿™å¯¹äºè®­ç»ƒå¤§å‹æ¨¡å‹å’Œç®¡ç†å¤§è§„æ¨¡åˆ†å¸ƒå¼è®­ç»ƒç¯å¢ƒè‡³å…³é‡è¦ã€‚</p><h3 id="3-preprocess-sources-tokenizer-transformers-PreTrainedTokenizer-gt-Dict"><a href="#3-preprocess-sources-tokenizer-transformers-PreTrainedTokenizer-gt-Dict" class="headerlink" title="3.preprocess(sources,tokenizer: transformers.PreTrainedTokenizer) -> Dict"></a>3.<code>preprocess(sources,tokenizer: transformers.PreTrainedTokenizer) -&gt; Dict</code></h3><h4 id="Code-5"><a href="#Code-5" class="headerlink" title="Code"></a>Code</h4><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">preprocess</span>(<span class="params"></span></span><br><span class="line"><span class="params">    sources,</span></span><br><span class="line"><span class="params">    tokenizer: transformers.PreTrainedTokenizer,</span></span><br><span class="line"><span class="params"></span>) -&gt; <span class="type">Dict</span>:</span><br><span class="line">    conv = get_conversation_template(<span class="string">"vicuna"</span>)</span><br><span class="line">    roles = {<span class="string">"human"</span>: conv.roles[<span class="number">0</span>], <span class="string">"gpt"</span>: conv.roles[<span class="number">1</span>]}</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Apply prompt templates</span></span><br><span class="line">    conversations = []</span><br><span class="line">    <span class="keyword">for</span> i, source <span class="keyword">in</span> <span class="built_in">enumerate</span>(sources):</span><br><span class="line">        <span class="keyword">if</span> roles[source[<span class="number">0</span>][<span class="string">"from"</span>]] != conv.roles[<span class="number">0</span>]:</span><br><span class="line">            <span class="comment"># Skip the first one if it is not from human</span></span><br><span class="line">            source = source[<span class="number">1</span>:]</span><br><span class="line"></span><br><span class="line">        conv.messages = []</span><br><span class="line">        <span class="keyword">for</span> j, sentence <span class="keyword">in</span> <span class="built_in">enumerate</span>(source):</span><br><span class="line">            role = roles[sentence[<span class="string">"from"</span>]]</span><br><span class="line">            <span class="keyword">assert</span> role == conv.roles[j % <span class="number">2</span>], <span class="string">f"<span class="subst">{i}</span>"</span></span><br><span class="line">            conv.append_message(role, sentence[<span class="string">"value"</span>])</span><br><span class="line">        conversations.append(conv.get_prompt())</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Tokenize conversations</span></span><br><span class="line">    input_ids = tokenizer(</span><br><span class="line">        conversations,</span><br><span class="line">        return_tensors=<span class="string">"pt"</span>,</span><br><span class="line">        padding=<span class="string">"max_length"</span>,</span><br><span class="line">        max_length=tokenizer.model_max_length,</span><br><span class="line">        truncation=<span class="literal">True</span>,</span><br><span class="line">    ).input_ids</span><br><span class="line">    targets = input_ids.clone()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">assert</span> conv.sep_style == SeparatorStyle.ADD_COLON_TWO</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Mask targets. Only compute loss on the assistant outputs.</span></span><br><span class="line">    sep = conv.sep + conv.roles[<span class="number">1</span>] + <span class="string">": "</span></span><br><span class="line">    <span class="keyword">for</span> conversation, target <span class="keyword">in</span> <span class="built_in">zip</span>(conversations, targets):</span><br><span class="line">        total_len = <span class="built_in">int</span>(target.ne(tokenizer.pad_token_id).<span class="built_in">sum</span>())</span><br><span class="line"></span><br><span class="line">        turns = conversation.split(conv.sep2)</span><br><span class="line">        cur_len = <span class="number">1</span></span><br><span class="line">        target[:cur_len] = IGNORE_TOKEN_ID</span><br><span class="line">        <span class="keyword">for</span> i, turn <span class="keyword">in</span> <span class="built_in">enumerate</span>(turns):</span><br><span class="line">            <span class="keyword">if</span> turn == <span class="string">""</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            turn_len = <span class="built_in">len</span>(tokenizer(turn).input_ids)</span><br><span class="line"></span><br><span class="line">            parts = turn.split(sep)</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(parts) != <span class="number">2</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            parts[<span class="number">0</span>] += sep</span><br><span class="line">            <span class="comment"># "-2" is hardcoded for the Llama tokenizer to make the offset correct.</span></span><br><span class="line">            instruction_len = <span class="built_in">len</span>(tokenizer(parts[<span class="number">0</span>]).input_ids) - <span class="number">2</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> i != <span class="number">0</span> <span class="keyword">and</span> <span class="keyword">not</span> tokenizer.legacy:</span><br><span class="line">                <span class="comment"># The legacy and non-legacy modes handle special tokens differently</span></span><br><span class="line">                instruction_len -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># Ignore the user instructions</span></span><br><span class="line">            target[cur_len : cur_len + instruction_len] = IGNORE_TOKEN_ID</span><br><span class="line">            cur_len += turn_len</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> i != <span class="number">0</span> <span class="keyword">and</span> <span class="keyword">not</span> tokenizer.legacy:</span><br><span class="line">                <span class="comment"># The legacy and non-legacy modes handle special tokens differently</span></span><br><span class="line">                cur_len -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        target[cur_len:] = IGNORE_TOKEN_ID</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="literal">False</span>:  <span class="comment"># Inspect and check the correctness of masking</span></span><br><span class="line">            z = target.clone()</span><br><span class="line">            z = torch.where(z == IGNORE_TOKEN_ID, tokenizer.unk_token_id, z)</span><br><span class="line">            rank0_print(tokenizer.decode(z))</span><br><span class="line">            exit()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> cur_len &lt; tokenizer.model_max_length:</span><br><span class="line">            <span class="keyword">if</span> cur_len != total_len:</span><br><span class="line">                target[:] = IGNORE_TOKEN_ID</span><br><span class="line">                rank0_print(</span><br><span class="line">                    <span class="string">f"WARNING: tokenization mismatch: <span class="subst">{cur_len}</span> vs. <span class="subst">{total_len}</span>."</span></span><br><span class="line">                    <span class="string">f" #turn = <span class="subst">{<span class="built_in">len</span>(turns) - <span class="number">1</span>}</span>. (ignored)"</span></span><br><span class="line">                )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">dict</span>(</span><br><span class="line">        input_ids=input_ids,</span><br><span class="line">        labels=targets,</span><br><span class="line">        attention_mask=input_ids.ne(tokenizer.pad_token_id),</span><br><span class="line">    )</span><br></pre></td></tr></tbody></table></figure><p>å‡½æ•° <code>preprocess(sources, tokenizer: transformers.PreTrainedTokenizer) -&gt; Dict</code> ç”¨äºé¢„å¤„ç†å¯¹è¯æ•°æ®ï¼Œä½¿å…¶é€‚ç”¨äºæœºå™¨å­¦ä¹ æ¨¡å‹çš„è®­ç»ƒã€‚è¿™ä¸ªå‡½æ•°å¯ä»¥åˆ†ä¸ºå‡ ä¸ªä¸»è¦éƒ¨åˆ†è¿›è¡Œè¯¦ç»†ä»‹ç»ï¼š</p><h4 id="1-è·å–å¯¹è¯æ¨¡æ¿å’Œè§’è‰²å®šä¹‰"><a href="#1-è·å–å¯¹è¯æ¨¡æ¿å’Œè§’è‰²å®šä¹‰" class="headerlink" title="1. è·å–å¯¹è¯æ¨¡æ¿å’Œè§’è‰²å®šä¹‰"></a>1. è·å–å¯¹è¯æ¨¡æ¿å’Œè§’è‰²å®šä¹‰</h4><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">conv = get_conversation_template(<span class="string">"vicuna"</span>)</span><br><span class="line">roles = {<span class="string">"human"</span>: conv.roles[<span class="number">0</span>], <span class="string">"gpt"</span>: conv.roles[<span class="number">1</span>]}</span><br></pre></td></tr></tbody></table></figure><ul><li><strong>åŠŸèƒ½</strong>: åˆå§‹åŒ–å¯¹è¯æ¨¡æ¿å’Œå®šä¹‰å¯¹è¯å‚ä¸è€…çš„è§’è‰²ã€‚</li><li><strong>å®ç°</strong>:<ul><li><code>conv = get_conversation_template("vicuna")</code> è·å–æŒ‡å®šæ¨¡å‹ï¼ˆå¦‚ â€œvicunaâ€ï¼‰çš„å¯¹è¯æ¨¡æ¿ã€‚</li><li><code>roles</code> å­—å…¸å°† â€œhumanâ€ å’Œ â€œgptâ€ åˆ†åˆ«æ˜ å°„åˆ°å¯¹è¯æ¨¡æ¿ä¸­å®šä¹‰çš„è§’è‰²ã€‚</li></ul></li><li><strong>ç¤ºä¾‹</strong>:<ul><li>å¦‚æœå¯¹è¯æ¨¡æ¿æ˜¯ â€œvicunaâ€ï¼Œåˆ™ <code>roles</code> å¯èƒ½æ˜¯ <code>{"human": "user", "gpt": "assistant"}</code>ã€‚<ul><li><code>conv = get_conversation_template("vicuna")</code> å¾—åˆ°çš„æ¨¡æ¿å¦‚ä¸‹ï¼š<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Conversation(name=<span class="string">'vicuna_v1.1'</span>, system_template=<span class="string">'{system_message}'</span>, system_message=<span class="string">"A chat between a curious user and an artificial intelligence assistant. The assistant gives helpful, detailed, and polite answers to the user's questions."</span>, roles=(<span class="string">'USER'</span>, <span class="string">'ASSISTANT'</span>), messages=[], offset=<span class="number">0</span>, sep_style=&lt;SeparatorStyle.ADD_COLON_TWO: <span class="number">2</span>&gt;, sep=<span class="string">' '</span>, sep2=<span class="string">'&lt;/s&gt;'</span>, stop_str=<span class="literal">None</span>, stop_token_ids=<span class="literal">None</span>)</span><br></pre></td></tr></tbody></table></figure></li><li><code>roles</code> å°† â€œhumanâ€ æ˜ å°„åˆ° â€œUSERâ€ï¼Œå°† â€œgptâ€ æ˜ å°„åˆ° â€œASSISTANTâ€ã€‚<code>{'human': 'USER', 'gpt': 'ASSISTANT'}</code></li></ul></li></ul></li></ul><h4 id="2-prompt-æ¨¡æ¿"><a href="#2-prompt-æ¨¡æ¿" class="headerlink" title="2. prompt æ¨¡æ¿"></a>2. prompt æ¨¡æ¿</h4><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Apply prompt templates</span></span><br><span class="line">conversations = []</span><br><span class="line"><span class="keyword">for</span> i, source <span class="keyword">in</span> <span class="built_in">enumerate</span>(sources):</span><br><span class="line">    <span class="keyword">if</span> roles[source[<span class="number">0</span>][<span class="string">"from"</span>]] != conv.roles[<span class="number">0</span>]:</span><br><span class="line">        <span class="comment"># Skip the first one if it is not from human</span></span><br><span class="line">        source = source[<span class="number">1</span>:]</span><br><span class="line"></span><br><span class="line">    conv.messages = []</span><br><span class="line">    <span class="keyword">for</span> j, sentence <span class="keyword">in</span> <span class="built_in">enumerate</span>(source):</span><br><span class="line">        role = roles[sentence[<span class="string">"from"</span>]]</span><br><span class="line">        <span class="keyword">assert</span> role == conv.roles[j % <span class="number">2</span>], <span class="string">f"<span class="subst">{i}</span>"</span></span><br><span class="line">        conv.append_message(role, sentence[<span class="string">"value"</span>])</span><br><span class="line">    conversations.append(conv.get_prompt())</span><br></pre></td></tr></tbody></table></figure><ul><li><p><strong>åŠŸèƒ½</strong>: ä¸ºæºæ•°æ®åº”ç”¨æç¤ºæ¨¡æ¿ï¼Œæ„å»ºå¯¹è¯ã€‚</p></li><li><p><strong>å®ç°</strong>:</p><ul><li>éå† <code>sources</code>ï¼ˆåŸå§‹å¯¹è¯æ•°æ®ï¼‰ï¼Œå°†æ¯ä¸ªå¯¹è¯æºè½¬æ¢ä¸ºæ¨¡æ¿æ ¼å¼çš„å¯¹è¯ã€‚</li><li>å¦‚æœå¯¹è¯çš„ç¬¬ä¸€éƒ¨åˆ†ä¸æ˜¯ â€œhumanâ€ è§’è‰²å‘èµ·ï¼Œåˆ™è·³è¿‡è¯¥éƒ¨åˆ†ã€‚</li><li>ä¸ºæ¯ä¸ªå¥å­æŒ‡å®šè§’è‰²ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°å¯¹è¯æ¨¡æ¿ä¸­ã€‚</li><li>æœ€ç»ˆï¼Œæ¯ä¸ªå¤„ç†åçš„å¯¹è¯è¢«æ·»åŠ åˆ° <code>conversations</code> åˆ—è¡¨ä¸­ã€‚</li></ul></li><li><p><strong>ç¤ºä¾‹</strong>:</p><ul><li>å‡å¦‚æˆ‘ä»¬çš„ source æ˜¯ dummy input ä¸­çš„ç¬¬ä¸€æ¡æ•°æ®:<br><code>python source = [{'from': 'human', 'value': 'Who are you?'}, {'from': 'gpt', 'value': 'I am Vicuna, a language model trained by researchers from Large Model Systems Organization (LMSYS).'}, {'from': 'human', 'value': 'Have a nice day!'}, {'from': 'gpt', 'value': 'You too!'}]</code></li><li><code>conversations</code> åœ¨ Vicuna template ä¸‹,æˆ‘ä»¬ä¼šä½¿ç”¨<code>SeparatorStyle.ADD_COLON_TWO</code>ä½œä¸ºåˆ†éš”ç¬¦é£æ ¼ï¼Œæ„æˆçš„æ•°æ®å¯èƒ½æ˜¯ [â€œA chat between a curious user and an artificial intelligence assistant. The assistant gives helpful, detailed, and polite answers to the userâ€™s questions. USER: Who are you? ASSISTANT: I am Vicuna, a language model trained by researchers from Large Model Systems Organization (LMSYS).USER: Have a nice day! ASSISTANT: You too!â€œ]</li><li><details><summary> get_promptçš„å®ç° </summary>`get_prompt` æ–¹æ³•çš„å®ç°æ ¹æ®ä¸åŒçš„ `SeparatorStyle` æœ‰ç€ä¸åŒçš„è¡Œä¸ºã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªè¡¨æ ¼ï¼Œè¯¦ç»†ä»‹ç»äº†å„ç§é£æ ¼çš„ `get_prompt` æ–¹æ³•ï¼Œä»¥åŠå¯¹åº”çš„è‹±æ–‡ç¤ºä¾‹ï¼š<table><thead><tr><th>åˆ†éš”ç¬¦é£æ ¼ (<code>SeparatorStyle</code>)</th><th>æè¿°</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>ADD_COLON_SINGLE</code></td><td>åœ¨æ¯ä¸ªæ¶ˆæ¯ååŠ å†’å·å’Œåˆ†éš”ç¬¦ã€‚</td><td>USER: Hello there!\nASSISTANT: Hi, how can I help?\n</td></tr><tr><td><code>ADD_COLON_TWO</code></td><td>ä½¿ç”¨ä¸¤ç§åˆ†éš”ç¬¦äº¤æ›¿ï¼Œé€šå¸¸åœ¨ä¸åŒè§’è‰²ä¹‹é—´åˆ‡æ¢ã€‚</td><td>USER: Whatâ€™s the weather?\nASSISTANT: Itâ€™s sunny today.\n\n</td></tr><tr><td><code>ADD_COLON_SPACE_SINGLE</code></td><td>æ¶ˆæ¯ååŠ å†’å·ã€ç©ºæ ¼å’Œåˆ†éš”ç¬¦ã€‚</td><td>USER: Can you book a flight?\nASSISTANT: Sure, where to?\n</td></tr><tr><td><code>NO_COLON_SINGLE</code></td><td>æ¶ˆæ¯ç›´æ¥è·Ÿåœ¨è§’è‰²åï¼Œä¸åŠ å†’å·ï¼Œåæ¥åˆ†éš”ç¬¦ã€‚</td><td>USERWhat are you doing?\nASSISTANTIâ€™m here to assist you.\n</td></tr><tr><td><code>NO_COLON_TWO</code></td><td>æ— å†’å·ï¼Œä½¿ç”¨ä¸¤ç§åˆ†éš”ç¬¦äº¤æ›¿ã€‚</td><td>USERHowâ€™s the project going?\nASSISTANTItâ€™s on track.\n\n</td></tr><tr><td><code>ADD_NEW_LINE_SINGLE</code></td><td>æ¯æ¡æ¶ˆæ¯å‰æ¢è¡Œï¼Œæ¶ˆæ¯ååŠ åˆ†éš”ç¬¦ã€‚</td><td>USER\nHow can I reset my password?\nASSISTANT\nYou can reset it via email.\n</td></tr><tr><td><code>RWKV</code></td><td>ç‰¹æ®Šæ ¼å¼ï¼Œé€šå¸¸ç”¨äºç‰¹å®šæ¨¡å‹ã€‚</td><td>USER: What is AI?\n\nASSISTANT: AI stands for Artificial Intelligence.\n\n</td></tr><tr><td><code>LLAMA2</code></td><td>ç‰¹æ®Šæ ‡ç­¾æ ¼å¼ï¼Œé’ˆå¯¹ç‰¹å®šæ¨¡å‹ã€‚</td><td>[INST] USER How does blockchain work?\nASSISTANT It is a distributed ledger.\n\n</td></tr><tr><td><code>CHATGLM</code></td><td>ç‰¹å®šäº <code>CHATGLM</code> æ¨¡å‹çš„æ ¼å¼ã€‚</td><td>[Round 1]\nUSER: Tell me a joke.\nASSISTANT: Why did the chicken cross the road?\n</td></tr><tr><td><code>CHATML</code></td><td>ç±»ä¼¼ <code>CHATGLM</code>ï¼Œä½†æ¯æ¡æ¶ˆæ¯å‰åéƒ½æœ‰æ¢è¡Œã€‚</td><td>USER\nDo you like music?\n\nASSISTANT\nYes, I enjoy many genres.\n\n</td></tr><tr><td><code>CHATGLM3</code></td><td>é€‚ç”¨äº <code>CHATGLM3</code> æ¨¡å‹çš„æ ¼å¼ã€‚</td><td>USER\nCan you play chess?\nASSISTANTYes, I can play.\n</td></tr><tr><td><code>CHATINTERN</code></td><td>é€‚ç”¨äº <code>CHATINTERN</code> æ¨¡å‹çš„æ ¼å¼ï¼Œä½¿ç”¨ç‰¹æ®Šæ ‡è®°ã€‚</td><td><s>USER:Where is the nearest ATM?<s>\nASSISTANT:Itâ€™s next to the post office.\n</s></s></td></tr><tr><td><code>DOLLY</code></td><td>ç‰¹å®šäº <code>DOLLY</code> æ¨¡å‹çš„æ ¼å¼ã€‚</td><td>USER:\nWhat is quantum computing?\nASSISTANT:\nIt involves computation using quantum-mechanical phenomena.\n\n</td></tr><tr><td><code>PHOENIX</code></td><td>é€‚ç”¨äº <code>PHOENIX</code> æ¨¡å‹ï¼Œæ¶ˆæ¯è¢«ç‰¹æ®Šæ ‡è®°åŒ…è£¹ã€‚</td><td>USER: <s>How to bake a cake?</s>\nASSISTANT: <s>You need flour, sugar, and eggs.</s>\n</td></tr><tr><td><code>ROBIN</code></td><td>ç±»ä¼¼ <code>ADD_NEW_LINE_SINGLE</code>ï¼Œä½†è§’è‰²åæœ‰æ¢è¡Œã€‚</td><td>USER:\nIs AI dangerous?\nASSISTANT:\nIt depends on how itâ€™s used.\n</td></tr><tr><td><code>FALCON_CHAT</code></td><td>ç±»ä¼¼ <code>ADD_COLON_SINGLE</code>ï¼Œä½†å¯é€‚ç”¨äº <code>FALCON</code> æ¨¡å‹ã€‚</td><td>USER: What is the capital of France?\nASSISTANT: Itâ€™s Paris.\n</td></tr><tr><td><code>METAMATH</code></td><td>å¯¹è¯ä¸­ä½¿ç”¨ç‰¹æ®Šå‰ç¼€å’Œåç¼€ï¼Œé€‚ç”¨äº <code>METAMATH</code> æ¨¡å‹ã€‚</td><td>USER:\nWhat is 2+2?\n: Itâ€™s 4\n</td></tr><tr><td><code>DEEPSEEK_CHAT</code></td><td>é€‚ç”¨äº <code>DEEPSEEK</code> æ¨¡å‹çš„ç‰¹å®šæ ¼å¼ã€‚</td><td>USER: Whatâ€™s your favorite color?\nASSISTANT: I like blue.\n\n</td></tr><tr><td><code>YUAN2</code></td><td>é€‚ç”¨äº <code>YUAN2</code> æ¨¡å‹ï¼Œç‰¹æ®Šçš„åˆ†éš”ç¬¦åº”ç”¨ã€‚</td><td>How are you today?<n>Iâ€™m fine, thank you!<n></n></n></td></tr></tbody></table>æ¯ç§é£æ ¼éƒ½æœ‰å…¶ç‰¹å®šçš„æ ¼å¼ï¼Œè¿™åœ¨å¤„ç†ä¸ä¸åŒæ¨¡å‹æˆ–ä»»åŠ¡ç›¸å…³çš„å¯¹è¯æ•°æ®æ—¶éå¸¸é‡è¦ã€‚é€šè¿‡ <code>get_prompt</code> æ–¹æ³•çš„ä¸åŒå®ç°ï¼Œå¯ä»¥çµæ´»åœ°é€‚åº”å„ç§éœ€æ±‚ï¼Œä½¿å¯¹è¯ç”Ÿæˆæˆ–å¤„ç†æ›´åŠ å‡†ç¡®å’Œé«˜æ•ˆã€‚</details></li></ul></li></ul><h4 id="3-å¯¹è¯çš„åˆ†è¯"><a href="#3-å¯¹è¯çš„åˆ†è¯" class="headerlink" title="3. å¯¹è¯çš„åˆ†è¯"></a>3. å¯¹è¯çš„åˆ†è¯</h4><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Tokenize conversations</span></span><br><span class="line">input_ids = tokenizer(</span><br><span class="line">    conversations,</span><br><span class="line">    return_tensors=<span class="string">"pt"</span>,</span><br><span class="line">    padding=<span class="string">"max_length"</span>,</span><br><span class="line">    max_length=tokenizer.model_max_length,</span><br><span class="line">    truncation=<span class="literal">True</span>,</span><br><span class="line">).input_ids</span><br><span class="line">targets = input_ids.clone()</span><br></pre></td></tr></tbody></table></figure><ul><li><p><strong>åŠŸèƒ½</strong>: æ–‡æœ¬å¯¹è¯é¦–å…ˆè¢«åˆ†è¯å¤„ç†ï¼Œè½¬æ¢æˆæ¨¡å‹èƒ½å¤Ÿå¤„ç†çš„æ•°å€¼åºåˆ—ã€‚ç„¶åï¼Œè¿™äº›åºåˆ—è¢«å…‹éš†ä»¥å½¢æˆåˆå§‹çš„è®­ç»ƒç›®æ ‡ã€‚è¿™æ ·åšçš„ç›®çš„æ˜¯ä¸ºäº†åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­æä¾›ä¸€ä¸ªåŸºå‡†ï¼ŒæŒ‡å¯¼æ¨¡å‹å­¦ä¹ ç”Ÿæˆæ­£ç¡®çš„è¾“å‡ºã€‚åœ¨åç»­æ­¥éª¤ä¸­ï¼Œè¿™äº›ç›®æ ‡å¯èƒ½ä¼šæ ¹æ®ç‰¹å®šçš„è®­ç»ƒç›®æ ‡è¿›è¡Œè°ƒæ•´ã€‚</p></li><li><p><strong>å®ç°</strong>ï¼š</p><ul><li><code>tokenizer</code> å‡½æ•°æ¥æ”¶æ–‡æœ¬åˆ—è¡¨ï¼ˆè¿™é‡Œæ˜¯ <code>conversations</code>ï¼‰ï¼Œå¹¶è¿”å›ä¸€ä¸ªåŒ…å«æ•°å€¼åŒ–è¡¨ç¤ºçš„ <code>input_ids</code>ã€‚<ul><li><code>return_tensors="pt"</code> æŒ‡å®šè¿”å›çš„æ•°æ®ç±»å‹ä¸º PyTorch å¼ é‡ã€‚</li><li><code>padding="max_length"</code> å’Œ <code>max_length=tokenizer.model_max_length</code> ç¡®ä¿æ‰€æœ‰è¾“å…¥é•¿åº¦ç»Ÿä¸€ï¼Œä¸è¶³çš„éƒ¨åˆ†ä½¿ç”¨å¡«å……ã€‚</li><li><code>truncation=True</code> è¡¨ç¤ºå¦‚æœè¾“å…¥è¿‡é•¿ï¼Œå°†å…¶æˆªæ–­åˆ°æœ€å¤§é•¿åº¦ã€‚</li></ul></li><li>åœ¨è®­ç»ƒæœŸé—´ï¼Œæ¨¡å‹éœ€è¦çŸ¥é“æœŸæœ›çš„è¾“å‡ºä»¥è®¡ç®—æŸå¤±å’Œè¿›è¡Œåå‘ä¼ æ’­ã€‚è¿™äº›æœŸæœ›çš„è¾“å‡ºè¢«ç§°ä¸º â€œtargetsâ€ã€‚<code>targets = input_ids.clone()</code> è¡¨ç¤ºåˆ›å»º <code>input_ids</code> çš„ä¸€ä¸ªå‰¯æœ¬ä½œä¸ºåˆå§‹çš„ç›®æ ‡ã€‚<ul><li>ä¹‹æ‰€ä»¥éœ€è¦å…‹éš† <code>input_ids</code>ï¼Œæ˜¯å› ä¸ºåœ¨è®¸å¤šè¯­è¨€æ¨¡å‹è®­ç»ƒä»»åŠ¡ä¸­ï¼ˆç‰¹åˆ«æ˜¯åƒè‡ªå›å½’æ¨¡å‹è¿™æ ·çš„ç”Ÿæˆä»»åŠ¡ï¼‰ï¼Œæ¨¡å‹çš„ç›®æ ‡è¾“å‡ºå¾€å¾€ä¸è¾“å…¥éå¸¸ç›¸ä¼¼ï¼Œä½†åœ¨æŸäº›ç»†èŠ‚ä¸Šå­˜åœ¨å·®å¼‚ã€‚</li><li>åœ¨åç»­æ­¥éª¤ä¸­ï¼Œè¿™ä¸ª <code>targets</code> å¯èƒ½ä¼šæ ¹æ®ç‰¹å®šçš„è®­ç»ƒéœ€æ±‚è¿›ä¸€æ­¥ä¿®æ”¹æˆ–æ©ç ï¼ˆä¾‹å¦‚ï¼Œåœ¨å¯¹è¯ä»»åŠ¡ä¸­ï¼Œå¯èƒ½åªå¯¹æ¨¡å‹ç”Ÿæˆçš„å›å¤éƒ¨åˆ†è®¡ç®—æŸå¤±ï¼Œè€Œä¸æ˜¯æ•´ä¸ªå¯¹è¯ï¼‰ã€‚</li></ul></li></ul></li></ul><h4 id="4-ç›®æ ‡æ©ç "><a href="#4-ç›®æ ‡æ©ç " class="headerlink" title="4. ç›®æ ‡æ©ç "></a>4. ç›®æ ‡æ©ç </h4><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Mask targets. Only compute loss on the assistant outputs.</span></span><br><span class="line">sep = conv.sep + conv.roles[<span class="number">1</span>] + <span class="string">": "</span></span><br><span class="line"><span class="keyword">for</span> conversation, target <span class="keyword">in</span> <span class="built_in">zip</span>(conversations, targets):</span><br><span class="line">    total_len = <span class="built_in">int</span>(target.ne(tokenizer.pad_token_id).<span class="built_in">sum</span>())</span><br><span class="line"></span><br><span class="line">    turns = conversation.split(conv.sep2)</span><br><span class="line">    cur_len = <span class="number">1</span></span><br><span class="line">    target[:cur_len] = IGNORE_TOKEN_ID</span><br><span class="line">    <span class="keyword">for</span> i, turn <span class="keyword">in</span> <span class="built_in">enumerate</span>(turns):</span><br><span class="line">        <span class="keyword">if</span> turn == <span class="string">""</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        turn_len = <span class="built_in">len</span>(tokenizer(turn).input_ids)</span><br><span class="line"></span><br><span class="line">        parts = turn.split(sep)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(parts) != <span class="number">2</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        parts[<span class="number">0</span>] += sep</span><br><span class="line">        <span class="comment"># "-2" is hardcoded for the Llama tokenizer to make the offset correct.</span></span><br><span class="line">        instruction_len = <span class="built_in">len</span>(tokenizer(parts[<span class="number">0</span>]).input_ids) - <span class="number">2</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> i != <span class="number">0</span> <span class="keyword">and</span> <span class="keyword">not</span> tokenizer.legacy:</span><br><span class="line">            <span class="comment"># The legacy and non-legacy modes handle special tokens differently</span></span><br><span class="line">            instruction_len -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Ignore the user instructions</span></span><br><span class="line">        target[cur_len : cur_len + instruction_len] = IGNORE_TOKEN_ID</span><br><span class="line">        cur_len += turn_len</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> i != <span class="number">0</span> <span class="keyword">and</span> <span class="keyword">not</span> tokenizer.legacy:</span><br><span class="line">            <span class="comment"># The legacy and non-legacy modes handle special tokens differently</span></span><br><span class="line">            cur_len -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    target[cur_len:] = IGNORE_TOKEN_ID</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="literal">False</span>:  <span class="comment"># Inspect and check the correctness of masking</span></span><br><span class="line">        z = target.clone()</span><br><span class="line">        z = torch.where(z == IGNORE_TOKEN_ID, tokenizer.unk_token_id, z)</span><br><span class="line">        rank0_print(tokenizer.decode(z))</span><br><span class="line">        exit()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> cur_len &lt; tokenizer.model_max_length:</span><br><span class="line">        <span class="keyword">if</span> cur_len != total_len:</span><br><span class="line">            target[:] = IGNORE_TOKEN_ID</span><br><span class="line">            rank0_print(</span><br><span class="line">                <span class="string">f"WARNING: tokenization mismatch: <span class="subst">{cur_len}</span> vs. <span class="subst">{total_len}</span>."</span></span><br><span class="line">                <span class="string">f" #turn = <span class="subst">{<span class="built_in">len</span>(turns) - <span class="number">1</span>}</span>. (ignored)"</span></span><br><span class="line">            )</span><br></pre></td></tr></tbody></table></figure><ul><li><p><strong>åŠŸèƒ½</strong>: å¯¹ç›®æ ‡è¾“å‡ºè¿›è¡Œæ©ç å¤„ç†ï¼Œä»¥ä¾¿æ¨¡å‹åªå¯¹ç‰¹å®šè¾“å‡ºè®¡ç®—æŸå¤±ã€‚ç›®æ ‡æ˜¯å¯¹ç”Ÿæˆçš„ targetsï¼ˆå³æ¨¡å‹çš„è¾“å‡ºæ ‡ç­¾ï¼‰è¿›è¡Œæ©ç å¤„ç†ã€‚è¿™æ˜¯ä¸ºäº†ç¡®ä¿åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­åªå¯¹åŠ©æ‰‹ï¼ˆassistantï¼‰çš„è¾“å‡ºè®¡ç®—æŸå¤±ï¼Œè€Œä¸æ˜¯æ•´ä¸ªå¯¹è¯ã€‚</p></li><li><p><strong>å®ç°</strong>ï¼š</p><ul><li><code>sep = conv.sep + conv.roles[1] + ": "</code> å®šä¹‰äº†ç”¨äºè¯†åˆ«åŠ©æ‰‹å›å¤çš„åˆ†éš”ç¬¦ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>sep</code> å¯èƒ½æ˜¯ â€œ\n\nAssistant: â€œã€‚</li><li>å¾ªç¯éå†æ¯ä¸ªå¤„ç†åçš„å¯¹è¯ (<code>conversation</code>) åŠå…¶å¯¹åº”çš„ç›®æ ‡ (<code>target</code>)ã€‚</li><li><code>total_len</code> æ˜¯å½“å‰ç›®æ ‡åºåˆ—ä¸­éå¡«å……ï¼ˆpaddingï¼‰éƒ¨åˆ†çš„é•¿åº¦ã€‚</li><li><code>turns</code> æ˜¯å°†å¯¹è¯æ ¹æ® <code>conv.sep2</code> åˆ†éš”æˆä¸åŒè½®æ¬¡çš„åˆ—è¡¨ã€‚</li></ul></li></ul><ol><li>å¯¹æ¯ä¸ªè½®æ¬¡è¿›è¡Œå¤„ç†</li></ol><ul><li>æ¯ä¸ªè½®æ¬¡ï¼ˆturnï¼‰åŒ…å«ç”¨æˆ·å’ŒåŠ©æ‰‹çš„æ¶ˆæ¯ã€‚</li><li>ä½¿ç”¨ <code>tokenizer(turn)</code> å°†æ¯ä¸ªè½®æ¬¡çš„æ–‡æœ¬è½¬æ¢ä¸ºæ¨¡å‹èƒ½ç†è§£çš„ ID åºåˆ—ã€‚</li><li>é€šè¿‡ <code>parts = turn.split(sep)</code> åˆ†ç¦»ç”¨æˆ·å’ŒåŠ©æ‰‹çš„æ¶ˆæ¯ã€‚</li><li><code>instruction_len</code> æ˜¯ç”¨æˆ·æ¶ˆæ¯éƒ¨åˆ†çš„é•¿åº¦ï¼ˆåœ¨æŸäº›æƒ…å†µä¸‹éœ€è¦è°ƒæ•´ï¼Œæ¯”å¦‚ <code>-2</code> æ˜¯ä¸ºäº†é€‚åº”ç‰¹å®šçš„åˆ†è¯å™¨ï¼‰ã€‚</li></ul><ol start="2"><li>æ©ç ç›®æ ‡</li></ol><ul><li><code>target[cur_len : cur_len + instruction_len] = IGNORE_TOKEN_ID</code> å°†ç”¨æˆ·æ¶ˆæ¯éƒ¨åˆ†çš„ç›®æ ‡ ID æ›¿æ¢ä¸º <code>IGNORE_TOKEN_ID</code>ï¼Œè¿™æ„å‘³ç€åœ¨è®¡ç®—æŸå¤±æ—¶ä¼šå¿½ç•¥è¿™éƒ¨åˆ†ã€‚</li><li><code>cur_len</code> ç”¨äºè·Ÿè¸ªå½“å‰å¤„ç†åˆ°çš„ä½ç½®ã€‚</li><li>æ¯å¤„ç†å®Œä¸€ä¸ªè½®æ¬¡ï¼Œæ›´æ–° <code>cur_len</code>ã€‚</li></ul><ol start="3"><li>æœ€ç»ˆå¤„ç†</li></ol><ul><li><code>target[cur_len:] = IGNORE_TOKEN_ID</code> ç¡®ä¿åœ¨æœ€åä¸€ä¸ªè½®æ¬¡ä¹‹åçš„æ‰€æœ‰å†…å®¹éƒ½è¢«å¿½ç•¥ã€‚</li><li>å¦‚æœ <code>cur_len</code> å°äº <code>tokenizer.model_max_length</code>ï¼Œä½†ä¸ç­‰äº <code>total_len</code>ï¼Œåˆ™è¡¨ç¤ºæœ‰ä¸ä¸€è‡´æ€§ï¼Œæ­¤æ—¶ä¼šå‘å‡ºè­¦å‘Šï¼Œå¹¶å°†æ•´ä¸ªç›®æ ‡åºåˆ—è®¾ç½®ä¸º <code>IGNORE_TOKEN_ID</code>ã€‚</li></ul><h4 id="5-è¿”å›å¤„ç†åçš„æ•°æ®"><a href="#5-è¿”å›å¤„ç†åçš„æ•°æ®" class="headerlink" title="5. è¿”å›å¤„ç†åçš„æ•°æ®"></a>5. è¿”å›å¤„ç†åçš„æ•°æ®</h4><ul><li><strong>åŠŸèƒ½</strong>: è¿”å›é¢„å¤„ç†åçš„æ•°æ®ï¼ŒåŒ…æ‹¬è¾“å…¥ IDã€ç›®æ ‡æ ‡ç­¾å’Œæ³¨æ„åŠ›æ©ç ã€‚</li><li><strong>å®ç°</strong>:<ul><li>è¿”å›ä¸€ä¸ªå­—å…¸ï¼ŒåŒ…å« <code>input_ids</code>ï¼ˆæ¨¡å‹è¾“å…¥ï¼‰ã€<code>labels</code>ï¼ˆè®­ç»ƒç›®æ ‡ï¼‰å’Œ <code>attention_mask</code>ï¼ˆæŒ‡ç¤ºå“ªäº›éƒ¨åˆ†æ˜¯æœ‰æ•ˆè¾“å…¥çš„æ©ç ï¼‰ã€‚</li></ul></li></ul><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>è¿™ä¸ª <code>preprocess</code> å‡½æ•°é€šè¿‡å°†åŸå§‹æ–‡æœ¬æ•°æ®è½¬æ¢ä¸ºæ¨¡å‹å¯ä»¥ç†è§£çš„æ ¼å¼ï¼Œä¸ºè®­ç»ƒå‡†å¤‡æ•°æ®ã€‚å®ƒæ¶µç›–äº†ä»æ–‡æœ¬å¤„ç†åˆ°åˆ†è¯ï¼Œå†åˆ°ç›®æ ‡æ©ç çš„æ•´ä¸ªé¢„å¤„ç†æµç¨‹ã€‚è¿™ä¸ªè¿‡ç¨‹å¯¹äºä»»ä½•åŸºäºå¯¹è¯çš„è‡ªç„¶è¯­è¨€å¤„ç†ä»»åŠ¡è‡³å…³é‡è¦ï¼Œç‰¹åˆ«æ˜¯åœ¨éœ€è¦æ¨¡å‹ä¸“æ³¨äºå¯¹ç‰¹å®šéƒ¨åˆ†çš„å“åº”æ—¶ã€‚</p><h2 id="4-æ•°æ®é›†ç±»"><a href="#4-æ•°æ®é›†ç±»" class="headerlink" title="4. æ•°æ®é›†ç±»"></a>4. æ•°æ®é›†ç±»</h2><p>è¿™äº›ç±»ç»§æ‰¿è‡ª PyTorch çš„ <code>Dataset</code> ç±»ï¼Œå¹¶ä¸”æ˜¯ä¸ºç‰¹å®šçš„æ•°æ®å¤„ç†ä»»åŠ¡å®šåˆ¶çš„ã€‚è¿™äº›ç±»åŒ…å«å…·ä½“çš„æ–¹æ³•æ¥å¤„ç†å’Œå‡†å¤‡æ•°æ®ï¼Œä»¥ä¾¿ç”¨äºæ¨¡å‹è®­ç»ƒã€‚è¿™äº›ç±»åŒ…æ‹¬ï¼š</p><ul><li><code>SupervisedDataset</code>: ç”¨äºæœ‰ç›‘ç£å­¦ä¹ çš„æ•°æ®é›†ã€‚å®ƒå¤„ç†åŸå§‹æ•°æ®ï¼Œå°†å…¶è½¬æ¢ä¸ºé€‚åˆæ¨¡å‹è®­ç»ƒçš„æ ¼å¼ã€‚</li><li><code>LazySupervisedDataset</code>: ç±»ä¼¼äº <code>SupervisedDataset</code>ï¼Œä½†ä½¿ç”¨æ‡’åŠ è½½æ–¹å¼å¤„ç†æ•°æ®ã€‚è¿™æ„å‘³ç€æ•°æ®åªåœ¨éœ€è¦æ—¶æ‰è¢«åŠ è½½å’Œå¤„ç†ï¼Œè¿™å¯¹äºå¤„ç†å¤§å‹æ•°æ®é›†ç‰¹åˆ«æœ‰ç”¨ã€‚</li></ul><p>è¿™äº›ç±»é€šå¸¸åŒ…å« <code>__init__</code>, <code>__len__</code>, å’Œ <code>__getitem__</code> æ–¹æ³•ï¼Œåˆ†åˆ«ç”¨äºåˆå§‹åŒ–æ•°æ®é›†ã€è·å–æ•°æ®é›†å¤§å°å’Œæ£€ç´¢ç‰¹å®šç´¢å¼•çš„æ•°æ®ã€‚è¿™æ ·çš„è®¾è®¡æ¨¡å¼ä½¿å¾—æ•°æ®é›†å¯ä»¥è½»æ¾åœ°ä¸ PyTorch çš„ DataLoader é…åˆä½¿ç”¨ï¼Œä»è€Œå®ç°é«˜æ•ˆçš„æ•°æ®åŠ è½½å’Œæ‰¹å¤„ç†ã€‚</p><h3 id="1-SupervisedDataset-ç±»"><a href="#1-SupervisedDataset-ç±»" class="headerlink" title="1. SupervisedDataset ç±»"></a>1. SupervisedDataset ç±»</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SupervisedDataset</span>(<span class="title class_ inherited__">Dataset</span>):</span><br><span class="line">    <span class="string">"""Dataset for supervised fine-tuning."""</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, raw_data, tokenizer: transformers.PreTrainedTokenizer</span>):</span><br><span class="line">        <span class="built_in">super</span>(SupervisedDataset, self).__init__()</span><br><span class="line"></span><br><span class="line">        rank0_print(<span class="string">"Formatting inputs..."</span>)</span><br><span class="line">        sources = [example[<span class="string">"conversations"</span>] <span class="keyword">for</span> example <span class="keyword">in</span> raw_data]</span><br><span class="line">        data_dict = preprocess(sources, tokenizer)</span><br><span class="line"></span><br><span class="line">        self.input_ids = data_dict[<span class="string">"input_ids"</span>]</span><br><span class="line">        self.labels = data_dict[<span class="string">"labels"</span>]</span><br><span class="line">        self.attention_mask = data_dict[<span class="string">"attention_mask"</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__len__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(self.input_ids)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__getitem__</span>(<span class="params">self, i</span>) -&gt; <span class="type">Dict</span>[<span class="built_in">str</span>, torch.Tensor]:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">dict</span>(</span><br><span class="line">            input_ids=self.input_ids[i],</span><br><span class="line">            labels=self.labels[i],</span><br><span class="line">            attention_mask=self.attention_mask[i],</span><br><span class="line">        )</span><br></pre></td></tr></tbody></table></figure><p><code>SupervisedDataset</code> ç±»æ˜¯ä¸€ä¸ªç”¨äºæœ‰ç›‘ç£å­¦ä¹ çš„æ•°æ®é›†ç±»ï¼Œç‰¹åˆ«æ˜¯ä¸ºäº†å¾®è°ƒï¼ˆfine-tuningï¼‰ä»»åŠ¡è®¾è®¡ã€‚è¿™ä¸ªç±»ç»§æ‰¿è‡ª PyTorch çš„ <code>Dataset</code> ç±»ï¼Œå¹¶é‡å†™äº†å…¶æ–¹æ³•ä»¥é€‚åº”ç‰¹å®šçš„æ•°æ®å¤„ç†éœ€æ±‚ã€‚ä¸‹é¢æ˜¯å¯¹è¿™ä¸ªç±»çš„è¯¦ç»†ä»‹ç»ï¼š<code>SupervisedDataset</code> ç±»æä¾›äº†ä¸€ç§ç»“æ„åŒ–å’Œé«˜æ•ˆçš„æ–¹æ³•æ¥å¤„ç†å’ŒåŠ è½½ç”¨äºæœ‰ç›‘ç£å­¦ä¹ çš„å¯¹è¯æ•°æ®ã€‚å®ƒéµå¾ª PyTorch æ•°æ®é›†ï¼ˆ<code>Dataset</code>ï¼‰çš„æ ‡å‡†ç»“æ„ï¼Œä½¿å¾—ä¸ PyTorch çš„æ•°æ®åŠ è½½å™¨ï¼ˆ<code>DataLoader</code>ï¼‰ç­‰å…¶ä»–ç»„ä»¶å…¼å®¹ï¼Œä»è€Œæ–¹ä¾¿åœ¨è®­ç»ƒå¾ªç¯ä¸­ä½¿ç”¨ã€‚é€šè¿‡é¢„å¤„ç†æ­¥éª¤ï¼Œè¯¥ç±»ç¡®ä¿æ•°æ®ä»¥é€‚å½“çš„æ ¼å¼æä¾›ç»™æ¨¡å‹ï¼Œä»¥ä¾¿è¿›è¡Œæœ‰æ•ˆçš„è®­ç»ƒã€‚</p><ul><li><strong>ç±»å</strong>: <code>SupervisedDataset</code></li><li><strong>ç»§æ‰¿</strong>: <code>Dataset</code>ï¼ˆæ¥è‡ª PyTorchï¼‰</li><li><strong>ç›®çš„</strong>: ç”¨äºæœ‰ç›‘ç£çš„æ¨¡å‹å¾®è°ƒä»»åŠ¡ã€‚</li></ul><h4 id="1-1-init-self-raw-data-tokenizer-transformers-PreTrainedTokenizer"><a href="#1-1-init-self-raw-data-tokenizer-transformers-PreTrainedTokenizer" class="headerlink" title="1.1 __init__(self, raw_data, tokenizer: transformers.PreTrainedTokenizer)"></a>1.1 <code>__init__(self, raw_data, tokenizer: transformers.PreTrainedTokenizer)</code></h4><ul><li><strong>è°ƒç”¨æ—¶æœº</strong>ï¼šåˆ›å»º <code>SupervisedDataset</code> ç±»çš„å®ä¾‹æ—¶ã€‚è¿™é€šå¸¸å‘ç”Ÿåœ¨å‡†å¤‡è®­ç»ƒæ•°æ®é›†çš„é˜¶æ®µï¼Œå½“ä½ åˆ›å»ºæ•°æ®åŠ è½½å™¨ï¼ˆDataLoaderï¼‰ä¹‹å‰ã€‚</li><li><strong>åŠŸèƒ½</strong>ï¼šåˆå§‹åŒ–æ•°æ®é›†å®ä¾‹ï¼Œå¤„ç†åŸå§‹å¯¹è¯æ•°æ®ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºæ¨¡å‹å¯ä»¥ç†è§£çš„æ ¼å¼ã€‚</li><li><strong>å‚æ•°</strong>ï¼š<ul><li><code>raw_data</code>ï¼šåŒ…å«å¯¹è¯æ•°æ®çš„åˆ—è¡¨æˆ–ç±»ä¼¼ç»“æ„ã€‚</li><li><code>tokenizer</code>ï¼šä¸€ä¸ªé¢„è®­ç»ƒçš„åˆ†è¯å™¨å®ä¾‹ï¼Œç”¨äºå°†æ–‡æœ¬è½¬æ¢ä¸ºæ¨¡å‹å¯ä»¥å¤„ç†çš„æ ¼å¼ã€‚</li></ul></li><li><strong>è¿”å›å€¼</strong>ï¼šæ— è¿”å›å€¼ï¼Œä½†æ­¤æ–¹æ³•ä¼šè®¾ç½® <code>input_ids</code>ã€<code>labels</code> å’Œ <code>attention_mask</code> ä½œä¸ºç±»çš„å†…éƒ¨çŠ¶æ€ã€‚</li><li><strong>å®ç°ç»†èŠ‚</strong>:<ul><li>ä½¿ç”¨åˆ—è¡¨æ¨å¯¼å¼ä» <code>raw_data</code> ä¸­æå–æ¯ä¸ªæ ·æœ¬çš„å¯¹è¯å†…å®¹ã€‚</li><li>è°ƒç”¨ <code>preprocess</code> å‡½æ•°å¤„ç†è¿™äº›å¯¹è¯ï¼Œå°†å…¶è½¬æ¢ä¸ºé€‚åˆæ¨¡å‹è¾“å…¥çš„æ ¼å¼ã€‚</li><li>ä»è¿”å›çš„ <code>data_dict</code> ä¸­æå– <code>input_ids</code>ï¼ˆæ¨¡å‹è¾“å…¥ IDï¼‰ã€<code>labels</code>ï¼ˆç›®æ ‡æ ‡ç­¾ï¼‰å’Œ <code>attention_mask</code>ï¼ˆæ³¨æ„åŠ›æ©ç ï¼‰ã€‚</li></ul></li></ul><h4 id="1-2-len-self"><a href="#1-2-len-self" class="headerlink" title="1.2 __len__(self)"></a>1.2 <code>__len__(self)</code></h4><ul><li><strong>è°ƒç”¨æ—¶æœº</strong>ï¼šå½“éœ€è¦è·å–æ•°æ®é›†å¤§å°æ—¶ï¼Œä¾‹å¦‚åœ¨è®¾ç½®æ•°æ®åŠ è½½å™¨æ—¶ï¼Œæˆ–è€…åœ¨è®­ç»ƒå¾ªç¯ä¸­è¿­ä»£æ•°æ®é›†æ—¶ã€‚</li><li><strong>åŠŸèƒ½</strong>ï¼šè¿”å›æ•°æ®é›†ä¸­çš„æ ·æœ¬æ•°é‡ã€‚</li><li><strong>è¿”å›å€¼</strong>ï¼šä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæ•°æ®é›†ä¸­çš„æ ·æœ¬æ•°é‡ã€‚</li><li><strong>å®ç°</strong>: ç›´æ¥è¿”å› <code>input_ids</code> çš„é•¿åº¦ï¼Œå³æ ·æœ¬çš„æ•°é‡ã€‚</li></ul><h4 id="1-3-getitem-self-i"><a href="#1-3-getitem-self-i" class="headerlink" title="1.3 __getitem__(self, i)"></a>1.3 <code>__getitem__(self, i)</code></h4><ul><li><strong>è°ƒç”¨æ—¶æœº</strong>ï¼šåœ¨æ•°æ®åŠ è½½å™¨è¯·æ±‚æ•°æ®é›†çš„ç‰¹å®šæ ·æœ¬æ—¶ï¼Œè¿™é€šå¸¸å‘ç”Ÿåœ¨è®­ç»ƒæˆ–è¯„ä¼°å¾ªç¯çš„æ¯ä¸ªè¿­ä»£ä¸­ã€‚</li><li><strong>åŠŸèƒ½</strong>ï¼šè·å–æŒ‡å®šç´¢å¼• <code>i</code> å¤„çš„æ•°æ®æ ·æœ¬ã€‚</li><li><strong>å‚æ•°</strong>ï¼š<ul><li><code>i</code>ï¼šæ‰€è¯·æ±‚æ ·æœ¬çš„ç´¢å¼•ã€‚</li></ul></li><li><strong>è¿”å›å€¼</strong>ï¼šä¸€ä¸ªå­—å…¸ï¼ŒåŒ…å«ç´¢å¼• <code>i</code> å¤„æ ·æœ¬çš„ <code>input_ids</code>ã€<code>labels</code> å’Œ <code>attention_mask</code>ã€‚è¿™äº›æ˜¯ PyTorch å¼ é‡ï¼ˆ<code>torch.Tensor</code>ï¼‰ï¼Œé€‚ç”¨äºæ¨¡å‹çš„è®­ç»ƒæˆ–è¯„ä¼°ã€‚</li></ul><p>åœ¨æœ‰ç›‘ç£å­¦ä¹ çš„åœºæ™¯ä¸­ï¼Œ<code>SupervisedDataset</code> ç±»æ‰®æ¼”ç€æ•°æ®é¢„å¤„ç†å’Œå°è£…çš„è§’è‰²ï¼Œç¡®ä¿æ•°æ®ä»¥æ­£ç¡®çš„æ ¼å¼æä¾›ç»™æ¨¡å‹ã€‚<code>__init__</code> æ–¹æ³•åœ¨æ•°æ®é›†å®ä¾‹åŒ–æ—¶è°ƒç”¨ï¼Œè´Ÿè´£æ•°æ®çš„åˆå§‹åŒ–å’Œé¢„å¤„ç†ã€‚<code>__len__</code> å’Œ <code>__getitem__</code> æ–¹æ³•åˆ™åœ¨è®­ç»ƒå’Œè¯„ä¼°è¿‡ç¨‹ä¸­è¢«é¢‘ç¹è°ƒç”¨ï¼Œåˆ†åˆ«ç”¨äºè·å–æ•°æ®é›†çš„å¤§å°å’Œæå–ç‰¹å®šçš„æ•°æ®æ ·æœ¬ã€‚è¿™äº›æ–¹æ³•çš„è®¾è®¡å’Œå®ç°ä½¿å¾— <code>SupervisedDataset</code> ç±»å¯ä»¥æ— ç¼åœ°ä¸ PyTorch çš„å…¶ä»–æ•°æ®å¤„ç†å’Œè®­ç»ƒå·¥å…·é›†æˆã€‚</p><h3 id="2-LazySupervisedDataset-ç±»"><a href="#2-LazySupervisedDataset-ç±»" class="headerlink" title="2. LazySupervisedDataset ç±»"></a>2. LazySupervisedDataset ç±»</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">LazySupervisedDataset</span>(<span class="title class_ inherited__">Dataset</span>):</span><br><span class="line">    <span class="string">"""Dataset for supervised fine-tuning."""</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, raw_data, tokenizer: transformers.PreTrainedTokenizer</span>):</span><br><span class="line">        <span class="built_in">super</span>(LazySupervisedDataset, self).__init__()</span><br><span class="line">        self.tokenizer = tokenizer</span><br><span class="line"></span><br><span class="line">        rank0_print(<span class="string">"Formatting inputs...Skip in lazy mode"</span>)</span><br><span class="line">        self.tokenizer = tokenizer</span><br><span class="line">        self.raw_data = raw_data</span><br><span class="line">        self.cached_data_dict = {}</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__len__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(self.raw_data)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__getitem__</span>(<span class="params">self, i</span>) -&gt; <span class="type">Dict</span>[<span class="built_in">str</span>, torch.Tensor]:</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> self.cached_data_dict:</span><br><span class="line">            <span class="keyword">return</span> self.cached_data_dict[i]</span><br><span class="line"></span><br><span class="line">        ret = preprocess([self.raw_data[i][<span class="string">"conversations"</span>]], self.tokenizer)</span><br><span class="line">        ret = <span class="built_in">dict</span>(</span><br><span class="line">            input_ids=ret[<span class="string">"input_ids"</span>][<span class="number">0</span>],</span><br><span class="line">            labels=ret[<span class="string">"labels"</span>][<span class="number">0</span>],</span><br><span class="line">            attention_mask=ret[<span class="string">"attention_mask"</span>][<span class="number">0</span>],</span><br><span class="line">        )</span><br><span class="line">        self.cached_data_dict[i] = ret</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ret</span><br></pre></td></tr></tbody></table></figure><p><code>LazySupervisedDataset</code> ç±»æ˜¯å¦ä¸€ç§æ•°æ®é›†å®ç°ï¼Œç”¨äºæœ‰ç›‘ç£çš„æ¨¡å‹å¾®è°ƒã€‚ä¸ <code>SupervisedDataset</code> ç›¸æ¯”ï¼Œå®ƒé‡‡ç”¨äº†ä¸€ç§â€œæ‡’åŠ è½½â€ï¼ˆlazy loadingï¼‰çš„ç­–ç•¥ã€‚ä»¥ä¸‹æ˜¯å¯¹è¯¥ç±»çš„è¯¦ç»†è§£é‡Šï¼Œä»¥åŠå®ƒä¸éæ‡’åŠ è½½ç‰ˆæœ¬çš„æ¯”è¾ƒã€‚</p><h4 id="2-1-init-self-raw-data-tokenizer-transformers-PreTrainedTokenizer"><a href="#2-1-init-self-raw-data-tokenizer-transformers-PreTrainedTokenizer" class="headerlink" title="2.1 __init__(self, raw_data, tokenizer: transformers.PreTrainedTokenizer)"></a>2.1 <code>__init__(self, raw_data, tokenizer: transformers.PreTrainedTokenizer)</code></h4><ul><li><strong>ä½œç”¨</strong>ï¼šåˆå§‹åŒ– <code>LazySupervisedDataset</code> å®ä¾‹ã€‚</li><li><strong>å®ç°ç»†èŠ‚</strong>ï¼š<ul><li>å°†åŸå§‹æ•°æ® (<code>raw_data</code>) å’Œåˆ†è¯å™¨ (<code>tokenizer</code>) ä¿å­˜ä¸ºç±»çš„å±æ€§ã€‚</li><li>åˆå§‹åŒ–ä¸€ä¸ªç©ºå­—å…¸ <code>cached_data_dict</code>ï¼Œç”¨äºç¼“å­˜å·²å¤„ç†çš„æ•°æ®ã€‚</li></ul></li><li><strong>ä¸ <code>SupervisedDataset</code> çš„å·®å¼‚</strong>ï¼š<ul><li>åœ¨ <code>LazySupervisedDataset</code> ä¸­ï¼ŒåŸå§‹æ•°æ®ä¸æ˜¯åœ¨åˆå§‹åŒ–æ—¶ç«‹å³å¤„ç†ï¼Œè€Œæ˜¯å­˜å‚¨åŸå§‹å½¢å¼ä»¥ä¾¿ç¨åå¤„ç†ã€‚</li><li><code>cached_data_dict</code> ç”¨äºç¼“å­˜æŒ‰éœ€å¤„ç†çš„æ•°æ®ï¼Œä»¥é¿å…é‡å¤å¤„ç†ã€‚</li></ul></li></ul><h4 id="2-2-len-self"><a href="#2-2-len-self" class="headerlink" title="2.2 __len__(self)"></a>2.2 <code>__len__(self)</code></h4><ul><li><p><strong>ä½œç”¨</strong>ï¼šè¿”å›æ•°æ®é›†ä¸­çš„æ ·æœ¬æ•°é‡ã€‚</p></li><li><p><strong>å®ç°</strong>ï¼šç›´æ¥è¿”å›åŸå§‹æ•°æ® (<code>raw_data</code>) çš„é•¿åº¦ã€‚</p></li><li><p><strong>ä¸ <code>SupervisedDataset</code> çš„å·®å¼‚</strong>ï¼š</p><ul><li><p>åœ¨ <code>LazySupervisedDataset</code> ç±»ä¸­ï¼Œ<code>__len__</code> æ–¹æ³•ç¡®å®è¿”å›çš„æ˜¯æ•°æ®é›†ä¸­æ ·æœ¬çš„æ•°é‡ï¼Œä½†æ˜¯è¿™é‡Œçš„â€œæ ·æœ¬æ•°é‡â€æ˜¯æŒ‡åŸå§‹æ•°æ® (<code>raw_data</code>) ä¸­çš„æ ·æœ¬æ•°é‡ï¼Œè€Œä¸æ˜¯å¤„ç†åçš„æ•°æ®çš„æ•°é‡ã€‚ç”±äº <code>LazySupervisedDataset</code> é‡‡ç”¨æ‡’åŠ è½½ç­–ç•¥ï¼Œæ•°æ®åœ¨åˆå§‹åŒ–æ—¶å¹¶æœªè¢«å¤„ç†ï¼Œå› æ­¤ <code>__len__</code> æ–¹æ³•åŸºäºåŸå§‹æ•°æ®è®¡ç®—é•¿åº¦æ˜¯åˆç†çš„ã€‚</p></li><li><p>è¿™æ„å‘³ç€å³ä¾¿æ•°æ®å°šæœªè¢«è½¬æ¢ä¸ºæ¨¡å‹å¯ç”¨çš„æ ¼å¼ï¼Œ<code>__len__</code> æ–¹æ³•ä»èƒ½å‡†ç¡®åæ˜ æ•°æ®é›†ä¸­å¾…å¤„ç†æ ·æœ¬çš„æ•°é‡ã€‚è¿™ä¸ <code>SupervisedDataset</code> çš„ä¸»è¦åŒºåˆ«åœ¨äºåè€…åœ¨åˆå§‹åŒ–æ—¶å°±å¯¹æ‰€æœ‰æ•°æ®è¿›è¡Œé¢„å¤„ç†ï¼Œå› æ­¤å…¶ <code>__len__</code> æ–¹æ³•è¿”å›çš„æ˜¯å·²å¤„ç†æ•°æ®çš„æ•°é‡ã€‚è€Œåœ¨ <code>LazySupervisedDataset</code> ä¸­ï¼Œæ•°æ®å¤„ç†æ˜¯æŒ‰éœ€è¿›è¡Œçš„ï¼Œå› æ­¤ <code>__len__</code> è¿”å›çš„æ˜¯åŸå§‹æ•°æ®ä¸­çš„æ ·æœ¬æ•°ã€‚</p></li></ul></li></ul><h4 id="getitem-self-i"><a href="#getitem-self-i" class="headerlink" title="__getitem__(self, i)"></a><code>__getitem__(self, i)</code></h4><ul><li><strong>ä½œç”¨</strong>ï¼šæŒ‰éœ€è·å–å¹¶å¤„ç†æŒ‡å®šç´¢å¼• <code>i</code> å¤„çš„æ•°æ®æ ·æœ¬ã€‚</li><li><strong>å®ç°ç»†èŠ‚</strong>ï¼š<ul><li>é¦–å…ˆæ£€æŸ¥ç´¢å¼• <code>i</code> æ˜¯å¦åœ¨ç¼“å­˜ <code>cached_data_dict</code> ä¸­ã€‚</li><li>å¦‚æœæ˜¯ï¼Œåˆ™ç›´æ¥è¿”å›ç¼“å­˜çš„æ•°æ®ï¼›å¦‚æœä¸æ˜¯ï¼Œåˆ™å¤„ç†åŸå§‹æ•°æ®ä¸­ç´¢å¼• <code>i</code> å¤„çš„æ ·æœ¬ï¼Œå¹¶å°†å¤„ç†åçš„ç»“æœæ·»åŠ åˆ°ç¼“å­˜ä¸­ã€‚</li><li>è¿”å›ä¸€ä¸ªåŒ…å« <code>input_ids</code>ã€<code>labels</code> å’Œ <code>attention_mask</code> çš„å­—å…¸ã€‚</li></ul></li><li><strong>ä¸ <code>SupervisedDataset</code> çš„å·®å¼‚</strong>ï¼š<ul><li><code>LazySupervisedDataset</code> åœ¨ <code>__getitem__</code> è¢«è°ƒç”¨æ—¶æ‰å¤„ç†æ•°æ®ï¼Œè€Œ <code>SupervisedDataset</code> åœ¨åˆå§‹åŒ–æ—¶å°±å¤„ç†æ‰€æœ‰æ•°æ®ã€‚</li><li><code>LazySupervisedDataset</code> ä½¿ç”¨ç¼“å­˜æ¥é¿å…é‡å¤å¤„ç†åŒä¸€æ ·æœ¬ï¼Œè€Œ <code>SupervisedDataset</code> ä¸éœ€è¦è¿™ç§æœºåˆ¶ï¼Œå› ä¸ºæ‰€æœ‰æ•°æ®åœ¨åˆå§‹åŒ–æ—¶å°±å·²ç»è¢«å¤„ç†ã€‚</li></ul></li></ul><h4 id="æ‡’åŠ è½½-vs-éæ‡’åŠ è½½"><a href="#æ‡’åŠ è½½-vs-éæ‡’åŠ è½½" class="headerlink" title="æ‡’åŠ è½½ vs éæ‡’åŠ è½½"></a>æ‡’åŠ è½½ vs éæ‡’åŠ è½½</h4><ul><li><strong>æ‡’åŠ è½½ï¼ˆLazy Loadingï¼‰</strong>ï¼š<ul><li><strong>ä¼˜ç‚¹</strong>ï¼šå‡å°‘å†…å­˜å ç”¨ï¼Œå› ä¸ºåªæœ‰éœ€è¦æ—¶æ‰å¤„ç†æ•°æ®ã€‚å¯¹äºå¤§å‹æ•°æ®é›†éå¸¸æœ‰ç”¨ã€‚</li><li><strong>ç¼ºç‚¹</strong>ï¼šå¯èƒ½å¢åŠ è®­ç»ƒæ—¶çš„æ•°æ®åŠ è½½æ—¶é—´ï¼Œå°¤å…¶æ˜¯å½“ç¼“å­˜æœªå‘½ä¸­æ—¶ã€‚</li></ul></li><li><strong>éæ‡’åŠ è½½ï¼ˆEager Loadingï¼‰</strong>ï¼š<ul><li><strong>ä¼˜ç‚¹</strong>ï¼šåœ¨è®­ç»ƒå¼€å§‹å‰ä¸€æ¬¡æ€§å¤„ç†æ‰€æœ‰æ•°æ®ï¼Œå¯ä»¥å‡å°‘è®­ç»ƒè¿‡ç¨‹ä¸­çš„å»¶è¿Ÿã€‚</li><li><strong>ç¼ºç‚¹</strong>ï¼šéœ€è¦æ›´å¤šçš„åˆå§‹å†…å­˜æ¥å­˜å‚¨å¤„ç†åçš„æ‰€æœ‰æ•°æ®ï¼Œå¯¹äºéå¸¸å¤§çš„æ•°æ®é›†å¯èƒ½ä¸å®ç”¨ã€‚</li></ul></li></ul><h3 id="3-make-supervised-data-module-å‡½æ•°"><a href="#3-make-supervised-data-module-å‡½æ•°" class="headerlink" title="3. make_supervised_data_module å‡½æ•°"></a>3. <code>make_supervised_data_module</code> å‡½æ•°</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">make_supervised_data_module</span>(<span class="params"></span></span><br><span class="line"><span class="params">    tokenizer: transformers.PreTrainedTokenizer, data_args</span></span><br><span class="line"><span class="params"></span>) -&gt; <span class="type">Dict</span>:</span><br><span class="line">    <span class="string">"""Make dataset and collator for supervised fine-tuning."""</span></span><br><span class="line">    dataset_cls = (</span><br><span class="line">        LazySupervisedDataset <span class="keyword">if</span> data_args.lazy_preprocess <span class="keyword">else</span> SupervisedDataset</span><br><span class="line">    )</span><br><span class="line">    rank0_print(<span class="string">"Loading data..."</span>)</span><br><span class="line"></span><br><span class="line">    train_json = json.load(<span class="built_in">open</span>(data_args.data_path, <span class="string">"r"</span>))</span><br><span class="line">    train_dataset = dataset_cls(train_json, tokenizer=tokenizer)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> data_args.eval_data_path:</span><br><span class="line">        eval_json = json.load(<span class="built_in">open</span>(data_args.eval_data_path, <span class="string">"r"</span>))</span><br><span class="line">        eval_dataset = dataset_cls(eval_json, tokenizer=tokenizer)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        eval_dataset = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">dict</span>(train_dataset=train_dataset, eval_dataset=eval_dataset)</span><br></pre></td></tr></tbody></table></figure><p>å‡½æ•° <code>make_supervised_data_module</code> çš„ç›®çš„æ˜¯ä¸ºæœ‰ç›‘ç£çš„æ¨¡å‹å¾®è°ƒåˆ›å»ºæ•°æ®é›†å’Œæ•°æ®æ•´ç†å™¨ï¼ˆcollatorï¼‰ã€‚è¿™ä¸ªå‡½æ•°æ ¹æ®æä¾›çš„å‚æ•°æ„å»ºé€‚åˆè®­ç»ƒå’Œè¯„ä¼°çš„æ•°æ®é›†ã€‚ä¸‹é¢æ˜¯å¯¹è¿™ä¸ªå‡½æ•°çš„è¶…çº§è¯¦ç»†è§£é‡Šï¼š</p><h3 id="å‡½æ•°ç­¾å"><a href="#å‡½æ•°ç­¾å" class="headerlink" title="å‡½æ•°ç­¾å"></a>å‡½æ•°ç­¾å</h3><ul><li><strong>å‡½æ•°å</strong>ï¼š<code>make_supervised_data_module</code></li><li><strong>å‚æ•°</strong>ï¼š<ul><li><code>tokenizer</code>: <code>transformers.PreTrainedTokenizer</code> çš„å®ä¾‹ï¼Œç”¨äºæ–‡æœ¬çš„åˆ†è¯å¤„ç†ã€‚</li><li><code>data_args</code>: åŒ…å«æ•°æ®ç›¸å…³è®¾ç½®çš„å¯¹è±¡ï¼Œé€šå¸¸åŒ…æ‹¬æ•°æ®æ–‡ä»¶è·¯å¾„ç­‰ä¿¡æ¯ã€‚</li></ul></li><li><strong>è¿”å›å€¼</strong>ï¼šä¸€ä¸ªå­—å…¸ï¼ŒåŒ…å«è®­ç»ƒå’Œè¯„ä¼°æ•°æ®é›†ã€‚</li></ul><h3 id="å‡½æ•°å®ç°ç»†èŠ‚"><a href="#å‡½æ•°å®ç°ç»†èŠ‚" class="headerlink" title="å‡½æ•°å®ç°ç»†èŠ‚"></a>å‡½æ•°å®ç°ç»†èŠ‚</h3><h4 id="1-é€‰æ‹©æ•°æ®é›†ç±»"><a href="#1-é€‰æ‹©æ•°æ®é›†ç±»" class="headerlink" title="1. é€‰æ‹©æ•°æ®é›†ç±»"></a>1. é€‰æ‹©æ•°æ®é›†ç±»</h4><ul><li>æ ¹æ® <code>data_args.lazy_preprocess</code> çš„å€¼é€‰æ‹©ä½¿ç”¨ <code>LazySupervisedDataset</code> è¿˜æ˜¯ <code>SupervisedDataset</code> ç±»ã€‚<ul><li>å¦‚æœ <code>data_args.lazy_preprocess</code> ä¸º <code>True</code>ï¼Œåˆ™ä½¿ç”¨ <code>LazySupervisedDataset</code> å®ç°æ‡’åŠ è½½ã€‚</li><li>å¦åˆ™ï¼Œä½¿ç”¨ <code>SupervisedDataset</code> è¿›è¡Œé¢„åŠ è½½ã€‚</li></ul></li><li>è¿™ä¸€é€‰æ‹©å½±å“æ•°æ®çš„åŠ è½½æ–¹å¼ï¼Œå³æ•°æ®æ˜¯ä¸€æ¬¡æ€§å…¨éƒ¨åŠ è½½å¹¶é¢„å¤„ç†ï¼Œè¿˜æ˜¯æŒ‰éœ€åŠ è½½å’Œå¤„ç†ã€‚</li></ul><h4 id="2-åŠ è½½è®­ç»ƒæ•°æ®"><a href="#2-åŠ è½½è®­ç»ƒæ•°æ®" class="headerlink" title="2. åŠ è½½è®­ç»ƒæ•°æ®"></a>2. åŠ è½½è®­ç»ƒæ•°æ®</h4><ul><li>ä½¿ç”¨ <code>json.load(open(data_args.data_path, "r"))</code> åŠ è½½è®­ç»ƒæ•°æ®ã€‚<ul><li>è¿™é‡Œå‡è®¾è®­ç»ƒæ•°æ®ä»¥ JSON æ ¼å¼å­˜å‚¨ï¼Œå¹¶ä¸” <code>data_args.data_path</code> åŒ…å«äº†æ•°æ®æ–‡ä»¶çš„è·¯å¾„ã€‚</li></ul></li><li>åˆ›å»ºè®­ç»ƒæ•°æ®é›† <code>train_dataset</code> å®ä¾‹ï¼Œä¼ å…¥åŠ è½½çš„è®­ç»ƒæ•°æ®å’Œåˆ†è¯å™¨ã€‚</li></ul><h4 id="3-åŠ è½½è¯„ä¼°æ•°æ®ï¼ˆå¦‚æœæä¾›ï¼‰"><a href="#3-åŠ è½½è¯„ä¼°æ•°æ®ï¼ˆå¦‚æœæä¾›ï¼‰" class="headerlink" title="3. åŠ è½½è¯„ä¼°æ•°æ®ï¼ˆå¦‚æœæä¾›ï¼‰"></a>3. åŠ è½½è¯„ä¼°æ•°æ®ï¼ˆå¦‚æœæä¾›ï¼‰</h4><ul><li>æ£€æŸ¥æ˜¯å¦æä¾›äº†è¯„ä¼°æ•°æ®è·¯å¾„ <code>data_args.eval_data_path</code>ã€‚<ul><li>å¦‚æœæä¾›ï¼ŒåŒæ ·ä½¿ç”¨ <code>json.load</code> åŠ è½½è¯„ä¼°æ•°æ®ã€‚</li><li>åˆ›å»ºè¯„ä¼°æ•°æ®é›† <code>eval_dataset</code> å®ä¾‹ã€‚</li></ul></li><li>å¦‚æœæ²¡æœ‰æä¾›è¯„ä¼°æ•°æ®è·¯å¾„ï¼Œå°† <code>eval_dataset</code> è®¾ç½®ä¸º <code>None</code>ã€‚</li></ul><h4 id="4-è¿”å›ç»“æœ"><a href="#4-è¿”å›ç»“æœ" class="headerlink" title="4. è¿”å›ç»“æœ"></a>4. è¿”å›ç»“æœ</h4><ul><li>è¿”å›ä¸€ä¸ªå­—å…¸ï¼ŒåŒ…å«ä¸¤ä¸ªé”®ï¼š<code>train_dataset</code> å’Œ <code>eval_dataset</code>ã€‚<ul><li><code>train_dataset</code> å¯¹åº”è®­ç»ƒæ•°æ®é›†å®ä¾‹ã€‚</li><li><code>eval_dataset</code> å¯¹åº”è¯„ä¼°æ•°æ®é›†å®ä¾‹ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ã€‚</li></ul></li></ul><h2 id="5-è®­ç»ƒæµç¨‹"><a href="#5-è®­ç»ƒæµç¨‹" class="headerlink" title="5. è®­ç»ƒæµç¨‹"></a>5. è®­ç»ƒæµç¨‹</h2><p>äº†è§£äº†ï¼Œæˆ‘å°†ä¸º <code>train()</code> å‡½æ•°ä¸­æ¯è¡Œä»£ç æä¾›æ›´è¯¦ç»†çš„è§£é‡Šï¼š</p><h3 id="è§£æå‘½ä»¤è¡Œå‚æ•°"><a href="#è§£æå‘½ä»¤è¡Œå‚æ•°" class="headerlink" title="è§£æå‘½ä»¤è¡Œå‚æ•°"></a>è§£æå‘½ä»¤è¡Œå‚æ•°</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">parser = transformers.HfArgumentParser((ModelArguments, DataArguments, TrainingArguments))</span><br></pre></td></tr></tbody></table></figure><ul><li>åˆ›å»ºä¸€ä¸ª <code>HfArgumentParser</code> å®ä¾‹ï¼Œè¿™æ˜¯ä¸€ä¸ªå¸®åŠ©è§£æå‘½ä»¤è¡Œå‚æ•°çš„å·¥å…·ï¼Œç‰¹åˆ«ç”¨äºå¤„ç† Hugging Face transformers åº“ä¸­çš„å‚æ•°ã€‚</li></ul><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">model_args, data_args, training_args = parser.parse_args_into_dataclasses()</span><br></pre></td></tr></tbody></table></figure><ul><li>è§£æå‘½ä»¤è¡Œå‚æ•°å¹¶å°†å®ƒä»¬æ˜ å°„åˆ°ä¸‰ä¸ªæ•°æ®ç±» (<code>ModelArguments</code>, <code>DataArguments</code>, <code>TrainingArguments</code>) çš„å®ä¾‹ä¸­ã€‚</li></ul><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">local_rank = training_args.local_rank</span><br></pre></td></tr></tbody></table></figure><ul><li><code>local_rank</code> ç”¨äºæ ‡è¯†åˆ†å¸ƒå¼è®­ç»ƒä¸­çš„è¿›ç¨‹ç¼–å·ã€‚<code>training_args.local_rank</code> è·å–è¿™ä¸ªç¼–å·ã€‚</li></ul><h3 id="è®¾ç½®æ¨¡å‹é…ç½®"><a href="#è®¾ç½®æ¨¡å‹é…ç½®" class="headerlink" title="è®¾ç½®æ¨¡å‹é…ç½®"></a>è®¾ç½®æ¨¡å‹é…ç½®</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">config = transformers.AutoConfig.from_pretrained(</span><br><span class="line">    model_args.model_name_or_path,</span><br><span class="line">    cache_dir=training_args.cache_dir,</span><br><span class="line">    trust_remote_code=model_args.trust_remote_code,</span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure><ul><li>ä»é¢„è®­ç»ƒæ¨¡å‹çš„é…ç½®åˆ›å»º <code>AutoConfig</code> å®ä¾‹ã€‚å®ƒè‡ªåŠ¨åŠ è½½ä¸ç‰¹å®šæ¨¡å‹ç›¸å…³çš„é…ç½®ã€‚</li><li><code>model_args.model_name_or_path</code>: æŒ‡å®šæ¨¡å‹çš„åç§°æˆ–è·¯å¾„ã€‚</li><li><code>cache_dir=training_args.cache_dir</code>: æŒ‡å®šç¼“å­˜ç›®å½•ã€‚</li><li><code>trust_remote_code=model_args.trust_remote_code</code>: æŒ‡å®šæ˜¯å¦ä¿¡ä»»ä»è¿œç¨‹ä¸‹è½½çš„ä»£ç ã€‚</li></ul><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">orig_ctx_len = <span class="built_in">getattr</span>(config, <span class="string">"max_position_embeddings"</span>, <span class="literal">None</span>)</span><br></pre></td></tr></tbody></table></figure><ul><li>ä½¿ç”¨ <code>getattr</code> å‡½æ•°ä»é…ç½®ä¸­è·å– <code>max_position_embeddings</code> å±æ€§ï¼Œè¯¥å±æ€§æŒ‡ç¤ºæ¨¡å‹çš„æœ€å¤§ä½ç½®åµŒå…¥æ•°ï¼ˆå³æ¨¡å‹èƒ½å¤„ç†çš„æœ€å¤§åºåˆ—é•¿åº¦ï¼‰ã€‚å¦‚æœä¸å­˜åœ¨è¯¥å±æ€§ï¼Œåˆ™è¿”å› <code>None</code>ã€‚<code>getattr</code> æ˜¯ä¸€ä¸ª Python å†…ç½®å‡½æ•°ï¼Œç”¨äºè·å–å¯¹è±¡çš„å±æ€§å€¼ã€‚å¦‚æœå±æ€§ä¸å­˜åœ¨ï¼Œè¿”å›ç¬¬ä¸‰ä¸ªå‚æ•°æŒ‡å®šçš„é»˜è®¤å€¼ï¼ˆæ­¤å¤„ä¸º <code>None</code>ï¼‰ã€‚</li><li><code>orig_ctx_len</code> å­˜å‚¨æ¨¡å‹é…ç½®ä¸­çš„ <code>max_position_embeddings</code> å±æ€§å€¼ï¼Œå³æ¨¡å‹å¯ä»¥å¤„ç†çš„æœ€å¤§ä½ç½®åµŒå…¥æ•°ï¼ˆé€šå¸¸ä¸æœ€å¤§åºåˆ—é•¿åº¦ç›¸å…³ï¼‰ã€‚</li></ul><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> orig_ctx_len <span class="keyword">and</span> training_args.model_max_length &gt; orig_ctx_len:</span><br><span class="line">    scaling_factor = <span class="built_in">float</span>(math.ceil(training_args.model_max_length / orig_ctx_len))</span><br><span class="line">    config.rope_scaling = {<span class="string">"type"</span>: <span class="string">"linear"</span>, <span class="string">"factor"</span>: scaling_factor}</span><br></pre></td></tr></tbody></table></figure><ul><li>å¦‚æœæä¾›çš„æ¨¡å‹æœ€å¤§é•¿åº¦ (<code>training_args.model_max_length</code>) è¶…è¿‡äº†åŸå§‹æ¨¡å‹çš„æœ€å¤§é•¿åº¦ (<code>orig_ctx_len</code>)ï¼Œåˆ™è®¡ç®—ä¸€ä¸ªç¼©æ”¾å› å­ä»¥è¿›è¡Œä½ç½®ç¼–ç çš„è°ƒæ•´ã€‚è¿™é€šå¸¸ç”¨äºå¤„ç†è¶…å‡ºé¢„è®­ç»ƒæ¨¡å‹åŸå§‹è®¾è®¡çš„åºåˆ—é•¿åº¦ã€‚</li><li><code>rope_scaling</code> ç”¨äºè°ƒæ•´ç›¸å¯¹ä½ç½®ç¼–ç ã€‚</li><li><code>scaling_factor</code> å’Œ RoPE ç¼©æ”¾<ul><li>å¦‚æœæ¨¡å‹çš„æœ€å¤§é•¿åº¦è¶…è¿‡åŸå§‹é…ç½®çš„æœ€å¤§é•¿åº¦ï¼Œ<code>scaling_factor</code> è¢«ç”¨æ¥è®¡ç®—ç¼©æ”¾å› å­ã€‚</li><li>è¿™æ¶‰åŠåˆ° Rotary Positional Embeddingï¼ˆRoPEï¼‰çš„æ¦‚å¿µï¼Œå³åœ¨ä½ç½®åµŒå…¥ä¸­ä½¿ç”¨çš„æŠ€æœ¯ï¼Œå¯ä»¥éšåºåˆ—é•¿åº¦çº¿æ€§ç¼©æ”¾ã€‚</li><li>ç¼©æ”¾å› å­ç”¨äºè°ƒæ•´ä½ç½®åµŒå…¥ï¼Œä½¿å…¶é€‚åº”æ›´é•¿çš„åºåˆ—ã€‚</li></ul></li></ul><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">config.use_cache = <span class="literal">False</span></span><br></pre></td></tr></tbody></table></figure><ul><li>ç¦ç”¨æ¨¡å‹åœ¨å‰å‘ä¼ æ’­æ—¶ç¼“å­˜ä¸­é—´è®¡ç®—ç»“æœçš„åŠŸèƒ½ï¼Œè¿™æœ‰åŠ©äºå‡å°‘å†…å­˜æ¶ˆè€—ã€‚è¿™ä¸ªè®¾ç½®å‘Šè¯‰æ¨¡å‹åœ¨å‰å‘ä¼ æ’­æ—¶ä¸ä½¿ç”¨æˆ–ä¿å­˜ç¼“å­˜ã€‚</li></ul><h3 id="åŠ è½½æ¨¡å‹å’Œåˆ†è¯å™¨"><a href="#åŠ è½½æ¨¡å‹å’Œåˆ†è¯å™¨" class="headerlink" title="åŠ è½½æ¨¡å‹å’Œåˆ†è¯å™¨"></a>åŠ è½½æ¨¡å‹å’Œåˆ†è¯å™¨</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">model = transformers.AutoModelForCausalLM.from_pretrained(</span><br><span class="line">    model_args.model_name_or_path,</span><br><span class="line">    config=config,</span><br><span class="line">    cache_dir=training_args.cache_dir,</span><br><span class="line">    trust_remote_code=model_args.trust_remote_code,</span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure><ul><li>åŠ è½½é¢„è®­ç»ƒçš„å› æœè¯­è¨€æ¨¡å‹ï¼ˆCausal Language Modelï¼‰ã€‚è¿™ç±»æ¨¡å‹é€šå¸¸ç”¨äºç”Ÿæˆä»»åŠ¡ã€‚</li><li><code>trust_remote_code</code>è¿™ä¸ªå‚æ•°ç”¨äºç¡®å®šæ˜¯å¦ä¿¡ä»»ä»è¿œç¨‹ï¼ˆå¦‚ Hugging Face Hubï¼‰åŠ è½½çš„è‡ªå®šä¹‰æ¨¡å‹ä»£ç ã€‚</li><li><code>cache_dir=training_args.cache_dir</code><ul><li>æŒ‡å®šä¸‹è½½å’Œç¼“å­˜é¢„è®­ç»ƒæ¨¡å‹å’Œåˆ†è¯å™¨çš„ç›®å½•ã€‚</li><li>å¦‚æœæŒ‡å®šï¼Œæ¨¡å‹å’Œåˆ†è¯å™¨å°†ä»è¿™ä¸ªç›®å½•åŠ è½½ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œå°†ä»è¿œç¨‹ä¸‹è½½å¹¶ç¼“å­˜åˆ°æ­¤ç›®å½•ã€‚</li></ul></li></ul><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">tokenizer = transformers.AutoTokenizer.from_pretrained(</span><br><span class="line">    model_args.model_name_or_path,</span><br><span class="line">    cache_dir=training_args.cache_dir,</span><br><span class="line">    model_max_length=training_args.model_max_length,</span><br><span class="line">    padding_side=model_args.padding_side,</span><br><span class="line">    use_fast=<span class="literal">False</span>,</span><br><span class="line">    trust_remote_code=model_args.trust_remote_code,</span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure><ul><li>åŠ è½½ä¸æ¨¡å‹å¯¹åº”çš„åˆ†è¯å™¨ã€‚</li><li><code>use_fast=False</code>: è¡¨ç¤ºä¸ä½¿ç”¨å¿«é€Ÿåˆ†è¯å™¨ï¼Œå¿«é€Ÿåˆ†è¯å™¨é€šå¸¸æ˜¯åŸºäº Rust çš„åˆ†è¯å™¨ï¼Œæä¾›æ›´é«˜æ•ˆçš„åˆ†è¯å¤„ç†ã€‚</li><li><code>padding_side=model_args.padding_side</code>: æŒ‡å®šå¡«å……ï¼ˆpaddingï¼‰åº”è¯¥å‘ç”Ÿåœ¨åºåˆ—çš„å“ªä¸€ä¾§ã€‚</li></ul><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> tokenizer.pad_token != tokenizer.unk_token:</span><br><span class="line">    tokenizer.pad_token = tokenizer.unk_token</span><br></pre></td></tr></tbody></table></figure><ul><li>å°†åˆ†è¯å™¨çš„å¡«å……ä»¤ç‰Œè®¾ç½®ä¸ºæœªçŸ¥ä»¤ç‰Œï¼ˆ<code>unk_token</code>ï¼‰ï¼Œå¦‚æœå®ƒä»¬ä¸ä¸€è‡´çš„è¯ã€‚è¿™æ˜¯å› ä¸ºæŸäº›æ¨¡å‹éœ€è¦åœ¨å¡«å……ä½ç½®ä½¿ç”¨ç‰¹å®šçš„ä»¤ç‰Œã€‚</li></ul><h3 id="åŠ è½½æ•°æ®"><a href="#åŠ è½½æ•°æ®" class="headerlink" title="åŠ è½½æ•°æ®"></a>åŠ è½½æ•°æ®</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data_module = make_supervised_data_module(tokenizer=tokenizer, data_args=data_args)</span><br></pre></td></tr></tbody></table></figure><ul><li>è°ƒç”¨ <code>make_supervised_data_module</code> å‡½æ•°ï¼Œä¸ºè®­ç»ƒå’Œè¯„ä¼°å‡†å¤‡æ•°æ®é›†ã€‚è¿™ä¸ªå‡½æ•°ä¼šæ ¹æ® <code>data_args</code> ä¸­çš„è®¾ç½®ï¼Œé€‰æ‹©ä½¿ç”¨æ‡’åŠ è½½æˆ–é¢„åŠ è½½çš„æ–¹å¼å¤„ç†æ•°æ®ã€‚</li></ul><h3 id="åˆå§‹åŒ–å¹¶å¯åŠ¨è®­ç»ƒå™¨"><a href="#åˆå§‹åŒ–å¹¶å¯åŠ¨è®­ç»ƒå™¨" class="headerlink" title="åˆå§‹åŒ–å¹¶å¯åŠ¨è®­ç»ƒå™¨"></a>åˆå§‹åŒ–å¹¶å¯åŠ¨è®­ç»ƒå™¨</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">trainer = Trainer(</span><br><span class="line">    model=model, tokenizer=tokenizer, args=training_args, **data_module</span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure><ul><li>åˆå§‹åŒ– <code>Trainer</code> å¯¹è±¡ï¼Œä¼ å…¥æ¨¡å‹ã€åˆ†è¯å™¨ã€è®­ç»ƒå‚æ•°ä»¥åŠé€šè¿‡ <code>make_supervised_data_module</code> å‡½æ•°å‡†å¤‡å¥½çš„æ•°æ®ã€‚</li></ul><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="built_in">list</span>(pathlib.Path(training_args.output_dir).glob(<span class="string">"checkpoint-*"</span>)):</span><br><span class="line">    trainer.train(resume_from_checkpoint=<span class="literal">True</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    trainer.train()</span><br></pre></td></tr></tbody></table></figure><ul><li>æ£€æŸ¥æ˜¯å¦å­˜åœ¨è®­ç»ƒæ£€æŸ¥ç‚¹ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™ä»æ£€æŸ¥ç‚¹æ¢å¤è®­ç»ƒï¼›å¦‚æœä¸å­˜åœ¨ï¼Œå¼€å§‹æ–°çš„è®­ç»ƒè¿‡ç¨‹ã€‚</li></ul><h3 id="ä¿å­˜æ¨¡å‹"><a href="#ä¿å­˜æ¨¡å‹" class="headerlink" title="ä¿å­˜æ¨¡å‹"></a>ä¿å­˜æ¨¡å‹</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">model.config.use_cache = <span class="literal">True</span></span><br><span class="line">trainer.save_state()</span><br></pre></td></tr></tbody></table></figure><ul><li>å¯ç”¨æ¨¡å‹çš„ç¼“å­˜å¹¶ä¿å­˜è®­ç»ƒå™¨çš„çŠ¶æ€ã€‚</li></ul><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> trainer.is_deepspeed_enabled:</span><br><span class="line">    trainer.save_model()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    trainer_save_model_safe(trainer)</span><br></pre></td></tr></tbody></table></figure><ul><li>æ£€æŸ¥æ˜¯å¦å¯ç”¨äº† DeepSpeedã€‚å¦‚æœå¯ç”¨äº†ï¼Œåˆ™ä½¿ç”¨ <code>trainer.save_model()</code> ä¿å­˜æ¨¡å‹ã€‚å¦‚æœæ²¡æœ‰å¯ç”¨ DeepSpeedï¼Œåˆ™ä½¿ç”¨ <code>trainer_save_model_safe</code> å®‰å…¨åœ°ä¿å­˜æ¨¡å‹ï¼Œç‰¹åˆ«æ˜¯åœ¨ä½¿ç”¨åˆ†å¸ƒå¼è®­ç»ƒæ—¶ã€‚</li></ul><h3 id="Trainer-ç±»è§£é‡Š"><a href="#Trainer-ç±»è§£é‡Š" class="headerlink" title="Trainer ç±»è§£é‡Š"></a>Trainer ç±»è§£é‡Š</h3><p><code>Trainer</code> æ˜¯ Hugging Face Transformers åº“æä¾›çš„ä¸€ä¸ªç±»ï¼Œç”¨äºå°è£…æ¨¡å‹çš„è®­ç»ƒé€»è¾‘ã€‚ä»¥ä¸‹æ˜¯å¯¹ <code>Trainer</code> ç±»çš„åŠŸèƒ½çš„è¯¦ç»†ä»‹ç»ï¼š</p><ul><li><p><strong>æ¨¡å‹è®­ç»ƒä¸è¯„ä¼°</strong>ï¼š<code>Trainer</code> ç±»è´Ÿè´£è®¾ç½®å’Œæ‰§è¡Œæ¨¡å‹çš„è®­ç»ƒå’Œè¯„ä¼°è¿‡ç¨‹ã€‚å®ƒè‡ªåŠ¨å¤„ç†æ•°æ®çš„æ‰¹å¤„ç†ã€æ¢¯åº¦è®¡ç®—ã€ä¼˜åŒ–å™¨æ­¥éª¤å’Œè®¾å¤‡ç®¡ç†ç­‰ä»»åŠ¡ã€‚</p></li><li><p><strong>å‚æ•°</strong>ï¼šåœ¨åˆå§‹åŒ–æ—¶ï¼Œ<code>Trainer</code> æ¥å—å¤šç§å‚æ•°ï¼ŒåŒ…æ‹¬æ¨¡å‹ï¼ˆ<code>model</code>ï¼‰ã€åˆ†è¯å™¨ï¼ˆ<code>tokenizer</code>ï¼‰ã€è®­ç»ƒå‚æ•°ï¼ˆå¦‚å­¦ä¹ ç‡ã€æ‰¹å¤§å°ç­‰ï¼Œé€šè¿‡ <code>training_args</code> ä¼ å…¥ï¼‰å’Œæ•°æ®é›†ã€‚</p></li><li><p><strong>çµæ´»æ€§å’Œé«˜çº§åŠŸèƒ½</strong>ï¼š<code>Trainer</code> æ”¯æŒå¤šç§è®­ç»ƒè®¾ç½®ï¼Œå¦‚å¤š GPU è®­ç»ƒã€æ··åˆç²¾åº¦è®­ç»ƒå’Œ TPU è®­ç»ƒã€‚å®ƒè¿˜æ”¯æŒè‡ªå®šä¹‰å›è°ƒå‡½æ•°ï¼Œç”¨äºåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­æ‰§è¡Œç‰¹å®šæ“ä½œã€‚</p></li><li><p><strong>ç®€åŒ– API</strong>ï¼š<code>Trainer</code> ç±»æä¾›äº†ä¸€ä¸ªç®€åŒ–çš„ APIï¼Œä½¿å¾—ç”¨æˆ·å¯ä»¥ç”¨å‡ è¡Œä»£ç é…ç½®å’Œè¿è¡Œæ¨¡å‹è®­ç»ƒã€‚å®ƒæŠ½è±¡äº†è®¸å¤šåº•å±‚ç»†èŠ‚ï¼Œä½¿å¾—ç”¨æˆ·å¯ä»¥ä¸“æ³¨äºæ¨¡å‹çš„æ„å»ºå’Œè®­ç»ƒç­–ç•¥ã€‚</p></li><li><p><strong>æ£€æŸ¥ç‚¹å’Œæ¢å¤</strong>ï¼š<code>Trainer</code> æ”¯æŒä¿å­˜å’ŒåŠ è½½æ£€æŸ¥ç‚¹ï¼Œè¿™æ„å‘³ç€è®­ç»ƒè¿‡ç¨‹å¯ä»¥åœ¨ä¸­æ–­åä»ä¸Šæ¬¡ä¿å­˜çš„çŠ¶æ€æ¢å¤ã€‚</p></li></ul><p>æ€»ä½“æ¥è¯´ï¼Œ<code>Trainer</code> ç±»æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§ä¸”çµæ´»çš„å·¥å…·ï¼Œä¸ºè®­ç»ƒå¤æ‚çš„ Transformer æ¨¡å‹æä¾›äº†ä¾¿åˆ©å’Œé«˜æ•ˆæ€§ã€‚</p><h2 id="6-run-bash"><a href="#6-run-bash" class="headerlink" title="6. run bash"></a>6. run bash</h2><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">torchrun --nproc_per_node=8 --master_port=20001 fastchat/train/train.py \</span><br><span class="line">    --model_name_or_path ~/vicuna-7b-v1.5-16k  \</span><br><span class="line">    --data_path data/dummy_conversation.json \</span><br><span class="line">    --fp16 True \</span><br><span class="line">    --output_dir output_vicuna \</span><br><span class="line">    --num_train_epochs 3 \</span><br><span class="line">    --per_device_train_batch_size 8 \</span><br><span class="line">    --per_device_eval_batch_size 1 \</span><br><span class="line">    --gradient_accumulation_steps 1 \</span><br><span class="line">    --evaluation_strategy <span class="string">"no"</span> \</span><br><span class="line">    --save_strategy <span class="string">"steps"</span> \</span><br><span class="line">    --save_steps 1200 \</span><br><span class="line">    --save_total_limit 10 \</span><br><span class="line">    --learning_rate 2e-5 \</span><br><span class="line">    --weight_decay 0. \</span><br><span class="line">    --warmup_ratio 0.03 \</span><br><span class="line">    --lr_scheduler_type <span class="string">"cosine"</span> \</span><br><span class="line">    --logging_steps 1 \</span><br><span class="line">    --fsdp <span class="string">"full_shard auto_wrap"</span> \</span><br><span class="line">    --fsdp_transformer_layer_cls_to_wrap <span class="string">'LlamaDecoderLayer'</span> \</span><br><span class="line">    --model_max_length 2048 \</span><br><span class="line">    --gradient_checkpointing True \</span><br><span class="line">    --lazy_preprocess True</span><br></pre></td></tr></tbody></table></figure><h3 id="torchrun"><a href="#torchrun" class="headerlink" title="torchrun"></a>torchrun</h3><p><code>torchrun</code> æ˜¯ PyTorch æä¾›çš„ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºå¯åŠ¨åˆ†å¸ƒå¼è®­ç»ƒã€‚å®ƒæ˜¯ <code>torch.distributed.launch</code> æ¨¡å—çš„ä¸€éƒ¨åˆ†ï¼Œæ—¨åœ¨ç®€åŒ–åœ¨å¤šä¸ªè¿›ç¨‹ä¸Šè¿è¡Œ PyTorch ç¨‹åºçš„è¿‡ç¨‹ã€‚ä»¥ä¸‹æ˜¯å¯¹ <code>torchrun</code> ä¸­ä½¿ç”¨çš„å‚æ•°çš„è¯¦ç»†è§£é‡Šï¼š</p><ol><li><p><code>--nproc_per_node=8</code></p><ul><li><code>--nproc_per_node</code> æŒ‡å®šæ¯ä¸ªèŠ‚ç‚¹ï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹é€šå¸¸æ˜¯ä¸€å°æœºå™¨ï¼‰ä¸Šè¦å¯åŠ¨çš„è¿›ç¨‹æ•°ã€‚è¿™é‡Œè®¾ç½®ä¸º 8ï¼Œæ„å‘³ç€åœ¨å½“å‰èŠ‚ç‚¹ä¸Šå°†å¯åŠ¨ 8 ä¸ªè®­ç»ƒè¿›ç¨‹ã€‚</li><li>ä½œç”¨ï¼šç”¨äºæ§åˆ¶æ¯ä¸ªèŠ‚ç‚¹ä¸Šçš„å¹¶è¡Œåº¦ã€‚åœ¨å¤š GPU ç³»ç»Ÿä¸­ï¼Œè¿™é€šå¸¸ç­‰äº GPU çš„æ•°é‡ã€‚</li></ul></li><li><p><code>--master_port=20001</code></p><ul><li><code>--master_port</code> æŒ‡å®šä¸»èŠ‚ç‚¹ç”¨äºé€šä¿¡çš„ç«¯å£ã€‚è¿™é‡Œè®¾ç½®ä¸º 20001ã€‚</li><li>ä½œç”¨ï¼šåœ¨åˆ†å¸ƒå¼è®­ç»ƒä¸­ï¼Œä¸åŒè¿›ç¨‹éœ€è¦é€šè¿‡ç½‘ç»œè¿›è¡Œé€šä¿¡ã€‚è¿™ä¸ªå‚æ•°æŒ‡å®šäº†ç”¨äºè¿›ç¨‹é—´é€šä¿¡çš„ç«¯å£ã€‚</li></ul></li><li><p><code>fastchat/train/train.py</code></p><ul><li>è¿™ä¸æ˜¯ <code>torchrun</code> çš„å‚æ•°ï¼Œè€Œæ˜¯æŒ‡å®šäº†è¦æ‰§è¡Œçš„ Python è„šæœ¬ï¼Œå³è®­ç»ƒè„šæœ¬çš„è·¯å¾„ã€‚</li></ul></li></ol><p>åœ¨åˆ†å¸ƒå¼è®­ç»ƒä¸­ï¼Œ<code>torchrun</code> è´Ÿè´£åœ¨æ¯ä¸ªè¿›ç¨‹ä¸­æ­£ç¡®åœ°è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œå¦‚ <code>LOCAL_RANK</code>ï¼ˆå½“å‰è¿›ç¨‹åœ¨å…¶èŠ‚ç‚¹ä¸Šçš„æ’åï¼‰ã€<code>WORLD_SIZE</code>ï¼ˆæ€»è¿›ç¨‹æ•°ï¼‰å’Œ <code>RANK</code>ï¼ˆå…¨å±€è¿›ç¨‹æ’åï¼‰ã€‚è¿™äº›ç¯å¢ƒå˜é‡å¯¹äºä½¿ç”¨ PyTorch åˆ†å¸ƒå¼åŒ…ï¼ˆå¦‚ <code>torch.distributed</code>ï¼‰è¿›è¡Œæœ‰æ•ˆé€šä¿¡è‡³å…³é‡è¦ã€‚</p><h3 id="ä½¿ç”¨ç¤ºä¾‹"><a href="#ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="ä½¿ç”¨ç¤ºä¾‹"></a>ä½¿ç”¨ç¤ºä¾‹</h3><p>å‡è®¾æ‚¨æœ‰ä¸€å°æ‹¥æœ‰ 8 ä¸ª GPU çš„æœºå™¨ï¼Œæ‚¨æƒ³åœ¨æ‰€æœ‰ GPU ä¸Šå¹¶è¡Œè¿è¡Œè®­ç»ƒã€‚ä½¿ç”¨ <code>torchrun</code>ï¼Œæ‚¨çš„å‘½ä»¤å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">torchrun --nproc_per_node=8 --master_port=20001 fastchat/train/train.py --å…¶ä»–å‚æ•°</span><br></pre></td></tr></tbody></table></figure><p>è¿™ä¸ªå‘½ä»¤ä¼šåœ¨æ¯ä¸ª GPU ä¸Šå¯åŠ¨ä¸€ä¸ªè®­ç»ƒè¿›ç¨‹ï¼Œæ¯ä¸ªè¿›ç¨‹è¿è¡Œ <code>train.py</code> è„šæœ¬ï¼Œå¹¶ä¸”æ‰€æœ‰è¿›ç¨‹èƒ½å¤Ÿé€šè¿‡åˆ†å¸ƒå¼é€šä¿¡æœ‰æ•ˆåä½œã€‚</p><p><code>torchrun</code> æ˜¯åˆ†å¸ƒå¼è®­ç»ƒçš„å…³é”®å·¥å…·ï¼Œå®ƒç®€åŒ–äº†åœ¨å¤šä¸ªè¿›ç¨‹ä¸Šå¯åŠ¨ PyTorch ç¨‹åºçš„æµç¨‹ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤š GPU ç¯å¢ƒä¸­ã€‚é€šè¿‡è‡ªåŠ¨è®¾ç½®å¿…è¦çš„ç¯å¢ƒå˜é‡ï¼Œ<code>torchrun</code> ä½¿å¾—å®ç°å’Œè¿è¡Œåˆ†å¸ƒå¼è®­ç»ƒå˜å¾—æ›´åŠ å®¹æ˜“å’Œå¯é ã€‚</p><h3 id="2-å‚æ•°"><a href="#2-å‚æ•°" class="headerlink" title="2. å‚æ•°"></a>2. å‚æ•°</h3><ol><li><p><code>--model_name_or_path</code></p><ul><li>å¯ä»¥æ˜¯é¢„è®­ç»ƒæ¨¡å‹çš„å®˜æ–¹åç§°ï¼ˆå¦‚ â€œbert-base-uncasedâ€ï¼‰ã€è‡ªå®šä¹‰è®­ç»ƒçš„æ¨¡å‹è·¯å¾„æˆ– Hugging Face Model Hub ä¸Šçš„æ¨¡å‹ã€‚</li><li>ä½œç”¨ï¼šæŒ‡å®šç”¨äºè®­ç»ƒçš„æ¨¡å‹ã€‚</li></ul></li><li><p><code>--data_path</code></p><ul><li>è·¯å¾„å¯ä»¥æ˜¯æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸Šçš„è·¯å¾„ã€‚</li><li>ä½œç”¨ï¼šæŒ‡å®šè®­ç»ƒä½¿ç”¨çš„æ•°æ®æ–‡ä»¶ã€‚</li></ul></li><li><p><code>--fp16</code></p><ul><li>å¯å–å€¼ä¸º True æˆ– Falseã€‚</li><li>ä½œç”¨ï¼šå¯ç”¨æˆ–ç¦ç”¨æ··åˆç²¾åº¦è®­ç»ƒï¼Œä»¥æé«˜è®­ç»ƒé€Ÿåº¦å’Œé™ä½æ˜¾å­˜ä½¿ç”¨ã€‚</li></ul></li><li><p><code>--output_dir</code></p><ul><li>ä»»ä½•æœ‰æ•ˆçš„æ–‡ä»¶è·¯å¾„ã€‚</li><li>ä½œç”¨ï¼šæŒ‡å®šè¾“å‡ºç›®å½•ï¼Œç”¨äºä¿å­˜è®­ç»ƒè¿‡ç¨‹ä¸­äº§ç”Ÿçš„æ–‡ä»¶ã€‚</li></ul></li><li><p><code>--num_train_epochs</code></p><ul><li>ä»»ä½•æ­£æ•´æ•°ã€‚</li><li>ä½œç”¨ï¼šæŒ‡å®šè®­ç»ƒçš„è½®æ¬¡ã€‚</li></ul></li><li><p><code>--per_device_train_batch_size</code> å’Œ <code>--per_device_eval_batch_size</code></p><ul><li>ä»»ä½•æ­£æ•´æ•°ã€‚</li><li>ä½œç”¨ï¼šåˆ†åˆ«æŒ‡å®šæ¯ä¸ªè®¾å¤‡ä¸Šçš„è®­ç»ƒå’Œè¯„ä¼°æ‰¹æ¬¡å¤§å°ã€‚</li></ul></li><li><p><code>--gradient_accumulation_steps</code></p><ul><li>ä»»ä½•æ­£æ•´æ•°ã€‚</li><li>ä½œç”¨ï¼šæŒ‡å®šæ¢¯åº¦ç´¯ç§¯çš„æ­¥éª¤æ•°ï¼Œç”¨äºåœ¨æœ‰é™çš„æ˜¾å­˜ä¸‹å¢åŠ æœ‰æ•ˆçš„æ‰¹æ¬¡å¤§å°ã€‚</li></ul></li><li><p><code>--evaluation_strategy</code></p><ul><li>å¯å–å€¼åŒ…æ‹¬ â€œnoâ€ã€â€stepsâ€ã€â€epochâ€ã€‚</li><li>ä½œç”¨ï¼šæŒ‡å®šè¯„ä¼°çš„ç­–ç•¥ï¼Œå¦‚æ¯ä¸ª epoch æˆ–ç‰¹å®šæ­¥æ•°åè¿›è¡Œè¯„ä¼°ï¼Œæˆ–ä¸è¿›è¡Œè¯„ä¼°ã€‚</li></ul></li><li><p><code>--save_strategy</code></p><ul><li>å¯å–å€¼åŒ…æ‹¬ â€œnoâ€ã€â€stepsâ€ã€â€epochâ€ã€‚</li><li>ä½œç”¨ï¼šæŒ‡å®šæ¨¡å‹ä¿å­˜çš„ç­–ç•¥ã€‚</li></ul></li><li><p><code>--save_steps</code> å’Œ <code>--save_total_limit</code></p><ul><li><code>--save_steps</code> å–ä»»ä½•æ­£æ•´æ•°ã€‚</li><li><code>--save_total_limit</code> å–ä»»ä½•æ­£æ•´æ•°æˆ– Noneã€‚</li><li>ä½œç”¨ï¼šåˆ†åˆ«æŒ‡å®šä¿å­˜æ¨¡å‹çš„æ­¥æ•°é—´éš”å’Œæœ€å¤§ä¿å­˜çš„æ£€æŸ¥ç‚¹æ•°é‡ã€‚</li></ul></li><li><p><code>--learning_rate</code></p><ul><li>ä»»ä½•æ­£æµ®ç‚¹æ•°ã€‚</li><li>ä½œç”¨ï¼šæŒ‡å®šä¼˜åŒ–å™¨çš„å­¦ä¹ ç‡ã€‚</li></ul></li><li><p><code>--weight_decay</code></p><ul><li>ä»»ä½•éè´Ÿæµ®ç‚¹æ•°ã€‚</li><li>ä½œç”¨ï¼šæŒ‡å®šæƒé‡è¡°å‡ï¼Œç”¨äºæ­£åˆ™åŒ–ã€‚</li></ul></li><li><p><code>--warmup_ratio</code></p><ul><li>ä»»ä½•éè´Ÿæµ®ç‚¹æ•°ï¼Œé€šå¸¸åœ¨ 0 åˆ° 1 ä¹‹é—´ã€‚</li><li>ä½œç”¨ï¼šæŒ‡å®šé¢„çƒ­çš„æ¯”ä¾‹ï¼Œå³å­¦ä¹ ç‡åœ¨åˆå§‹é˜¶æ®µé€æ¸å¢åŠ çš„è¿‡ç¨‹ã€‚</li></ul></li><li><p><code>--lr_scheduler_type</code></p><ul><li>å¯å–å€¼å¦‚ â€œlinearâ€ã€â€cosineâ€ã€â€cosine_with_restartsâ€ã€â€polynomialâ€ ç­‰ã€‚</li><li>ä½œç”¨ï¼šæŒ‡å®šå­¦ä¹ ç‡è°ƒåº¦å™¨çš„ç±»å‹ã€‚</li></ul></li><li><p><code>--logging_steps</code></p><ul><li>ä»»ä½•æ­£æ•´æ•°ã€‚</li><li>ä½œç”¨ï¼šæŒ‡å®šè®°å½•æ—¥å¿—çš„æ­¥æ•°é—´éš”ã€‚</li></ul></li><li><p><code>--fsdp</code></p><ul><li>å¯å–å€¼å¦‚ â€œfull_shardâ€ã€â€auto_wrapâ€ ç­‰ï¼Œæˆ–å®ƒä»¬çš„ç»„åˆã€‚</li><li>ä½œç”¨ï¼šæŒ‡å®šä½¿ç”¨å…¨åˆ†ç‰‡æ•°æ®å¹¶è¡Œï¼ˆFully Sharded Data Parallelï¼‰çš„é…ç½®ã€‚</li></ul></li><li><p><code>--fsdp_transformer_layer_cls_to_wrap</code></p><ul><li>æŒ‡å®šè¦åœ¨ FSDP ä¸­åŒ…è£…çš„ç‰¹å®šå±‚çš„ç±»åã€‚</li><li>ä½œç”¨ï¼šé’ˆå¯¹å¤§å‹æ¨¡å‹çš„åˆ†å¸ƒå¼è®­ç»ƒè¿›è¡Œä¼˜åŒ–ã€‚</li></ul></li><li><p><code>--model_max_length</code></p><ul><li>ä»»ä½•æ­£æ•´æ•°ã€‚</li><li>ä½œç”¨ï¼šæŒ‡å®šæ¨¡å‹å¤„ç†çš„æœ€å¤§åºåˆ—é•¿åº¦ã€‚</li></ul></li><li><p><code>--gradient_checkpointing</code></p><ul><li>å¯å–å€¼ä¸º True æˆ– Falseã€‚</li><li>ä½œç”¨ï¼šå¯ç”¨æˆ–ç¦ç”¨æ¢¯åº¦æ£€æŸ¥ç‚¹ï¼Œä»¥å‡å°‘æ˜¾å­˜ä½¿ç”¨ã€‚</li></ul></li><li><p><code>--lazy_preprocess</code></p><ul><li>å¯å–å€¼ä¸º True æˆ– Falseã€‚</li><li>ä½œç”¨ï¼šå¯ç”¨æˆ–ç¦ç”¨æ‡’åŠ è½½é¢„å¤„ç†ï¼Œå³æŒ‰éœ€åŠ è½½å’Œå¤„ç†æ•°æ®ã€‚</li></ul></li></ol><p>è¿™äº›å‚æ•°å…±åŒæ„æˆäº†ä¸€ä¸ªå¤æ‚çš„è®­ç»ƒé…ç½®ï¼Œå…è®¸ç”¨æˆ·æ ¹æ®ç‰¹å®šéœ€æ±‚çµæ´»è°ƒæ•´æ¨¡å‹è®­ç»ƒè¿‡ç¨‹ã€‚</p><h2 id="7-æ€»ç»“"><a href="#7-æ€»ç»“" class="headerlink" title="7. æ€»ç»“"></a>7. æ€»ç»“</h2><p>éšç€æœ¬æ–‡çš„ç»“æŸï¼Œæˆ‘ä»¬å®Œæˆäº†å¯¹ FastChat å¹³å°ä¸­ train.py è„šæœ¬çš„æ·±å…¥è§£æï¼Œè¿™åªæ˜¯æˆ‘ä»¬ç³»åˆ—æŠ€æœ¯åšå®¢ä¸­çš„ç¬¬ä¸€éƒ¨åˆ†ã€‚åœ¨è¿™ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬èšç„¦äº train.py è„šæœ¬çš„ç»“æ„å’ŒåŠŸèƒ½ï¼Œæ¶µç›–äº†ä»æ•°æ®é¢„å¤„ç†åˆ°æ¨¡å‹è®­ç»ƒå’Œä¿å­˜ç­‰å…³é”®æ­¥éª¤ã€‚é€šè¿‡è¿™æ¬¡è§£æï¼Œè¯»è€…ä¸ä»…èƒ½å¤Ÿæ›´å¥½åœ°ç†è§£ FastChat å¹³å°çš„å·¥ä½œåŸç†ï¼Œè¿˜èƒ½è·å¾—å¦‚ä½•æœ‰æ•ˆåˆ©ç”¨è¿™ä¸ªå·¥å…·è¿›è¡Œå¤§å‹è¯­è¨€æ¨¡å‹è®­ç»ƒçš„å®è´µçŸ¥è¯†ã€‚</p><p>éšç€æˆ‘ä»¬æŠ€æœ¯åšå®¢ç³»åˆ—çš„ä¸æ–­å±•å¼€ï¼Œæˆ‘ä»¬å°†ç»§ç»­æ·±å…¥æ¢ç´¢ FastChat çš„å…¶ä»–ç»„ä»¶å’ŒåŠŸèƒ½ã€‚æ¥ä¸‹æ¥çš„æ–‡ç« å°†è¿›ä¸€æ­¥æ‹“å±•æˆ‘ä»¬çš„è®¨è®ºèŒƒå›´ï¼Œæ¶‰åŠåˆ°æ›´å¤šé«˜çº§åŠŸèƒ½å’Œå®é™…åº”ç”¨åœºæ™¯ã€‚æˆ‘ä»¬æœŸæœ›è¿™äº›å†…å®¹èƒ½å¤Ÿä¸ºå¯¹ AI å’Œæœºå™¨å­¦ä¹ æ„Ÿå…´è¶£çš„è¯»è€…æä¾›æ›´å…¨é¢ã€æ·±å…¥çš„è§è§£ã€‚</p><p>æœ€åï¼Œæˆ‘ä»¬é¼“åŠ±è¯»è€…æŒç»­å…³æ³¨æˆ‘ä»¬çš„åšå®¢ï¼Œä»¥è·å–å…³äº FastChat åŠå…¶åœ¨å¤§å‹è¯­è¨€æ¨¡å‹è®­ç»ƒé¢†åŸŸåº”ç”¨çš„æœ€æ–°ä¿¡æ¯å’Œåˆ†æã€‚æ— è®ºæ‚¨æ˜¯è¯¥é¢†åŸŸçš„ä¸“å®¶è¿˜æ˜¯åˆå­¦è€…ï¼Œæˆ‘ä»¬ç›¸ä¿¡è¿™ä¸ªç³»åˆ—å°†ä¸ºæ‚¨æä¾›ä»·å€¼å’Œå¯å‘ã€‚æ•¬è¯·æœŸå¾…æˆ‘ä»¬ä¸‹ä¸€ç¯‡æ–‡ç« çš„å‘å¸ƒï¼Œå®ƒå°†ä¸ºæ‚¨æ­å¼€ FastChat æ›´å¤šä»¤äººå…´å¥‹çš„é¢çº±ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> NLP Insights </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LLM </tag>
            
            <tag> FastChat </tag>
            
            <tag> Train </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è‹±è¯­å­¦ä¹ æ—¥è®°ï¼šDe Facto</title>
      <link href="/2024/02/26/Life%20Reflections/%E8%8B%B1%E8%AF%AD%E5%AD%A6%E4%B9%A0%E6%97%A5%E8%AE%B0%EF%BC%9ADe%20Facto/"/>
      <url>/2024/02/26/Life%20Reflections/%E8%8B%B1%E8%AF%AD%E5%AD%A6%E4%B9%A0%E6%97%A5%E8%AE%B0%EF%BC%9ADe%20Facto/</url>
      
        <content type="html"><![CDATA[<p>å¤§å®¶å¥½ï¼ğŸŒ ä»Šå¤©æˆ‘ä»¬è¦æ¢è®¨ä¸€ä¸ªåœ¨è‹±è¯­å¯¹è¯å’Œå†™ä½œä¸­å¸¸è§çš„çŸ­è¯­ï¼š<strong>de facto</strong></p><h3 id="ç†è§£-â€œDe-Factoâ€"><a href="#ç†è§£-â€œDe-Factoâ€" class="headerlink" title="ç†è§£ â€œDe Factoâ€"></a>ç†è§£ â€œDe Factoâ€</h3><ol><li><p><strong>å«ä¹‰</strong>ï¼šâ€™De factoâ€™ è¿™ä¸ªçŸ­è¯­ç”¨æ¥æè¿°ä¸€äº›å®é™…ä¸Šå­˜åœ¨çš„äº‹ç‰©ï¼Œå³ä½¿å®ƒä»¬æ²¡æœ‰è¢«å®˜æ–¹è®¤å¯æˆ–æ³•å¾‹ç¡®ç«‹ã€‚å°±åƒæ˜¯åœ¨è¯´â€œå®é™…ä¸Šâ€æˆ–â€œå®è·µä¸­â€ï¼Œè€Œä¸æ˜¯â€œç†è®ºä¸Šâ€æˆ–â€œå®˜æ–¹ä¸Šâ€ã€‚</p></li><li><p><strong>è¯æº</strong>ï¼šè¿™ä¸ªçŸ­è¯­æœ‰ç€éå¸¸æœ‰è¶£çš„å†å²ã€‚å®ƒæºè‡ªæ‹‰ä¸è¯­ï¼Œå…¶ä¸­ â€˜deâ€™ æ„ä¸º â€˜æ¥è‡ªâ€™ï¼Œâ€™factoâ€™ æ„å‘³ç€ â€˜äº‹å®â€™ã€‚éšç€æ—¶é—´çš„æ¨ç§»ï¼Œå®ƒè¢«è‹±è¯­é‡‡çº³ï¼Œå¹¶ä¿ç•™äº†ä»æ‹‰ä¸è¯­ä¸­åŸå§‹çš„ç²¾é«“ã€‚</p></li></ol><h3 id="ä¾‹å¥"><a href="#ä¾‹å¥" class="headerlink" title="ä¾‹å¥"></a>ä¾‹å¥</h3><ul><li>ğŸŒŸ <em>In many organizations, there is a <strong>de facto</strong> leader who isnâ€™t officially the boss but is respected and followed by the team.</em></li><li>ğŸŒŸ <em>While English is the <strong>de facto</strong> language of international business, itâ€™s not the official language in many countries where itâ€™s widely spoken.</em></li><li>ğŸŒŸ <em>The museum, though not formally recognized, acts as the <strong>de facto</strong> cultural center of the small town.</em></li></ul><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>â€˜De factoâ€™ è¿™ä¸ªæœ¯è¯­æ˜¯ä¸€ç§å¾®å¦™ä½†å¼ºå¤§çš„æ–¹å¼ï¼Œç”¨æ¥æè¿°æƒ…å†µçš„ç°å®ï¼ŒåŒºåˆ«äºå…¶å®˜æ–¹æˆ–æ³•å¾‹åœ°ä½ã€‚å°†è¿™æ ·çš„çŸ­è¯­çº³å…¥ä½ çš„è¯­è¨€åº“ä¸ä»…ä¸°å¯Œäº†ä½ çš„è¯æ±‡ï¼Œè¿˜å¢å¼ºäº†ä½ è¡¨è¾¾ç»†å¾®æƒ³æ³•çš„èƒ½åŠ›ã€‚ç»§ç»­æ¢ç´¢å¹¶æ‹¥æŠ±è¯­è¨€çš„ç¾å¦™å§ï¼ğŸ“šğŸ’¬</p><p>è®°ä½ï¼Œè¯­è¨€æ˜¯ä¸€æ®µæ—…ç¨‹ï¼Œä¸æ˜¯ç»ˆç‚¹ã€‚ç¥å­¦ä¹ æ„‰å¿«ï¼Œæˆ‘ä»¬ä¸‹æ¬¡è§ï¼ğŸš€ğŸŒŸ</p>]]></content>
      
      
      <categories>
          
          <category> Life Reflections </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Language Learning </tag>
            
            <tag> English Vocabulary </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>De Facto: Unveiling the Power of an Intriguing Phrase</title>
      <link href="/2024/02/26/Life%20Reflections/De%20Facto:%20Unveiling%20the%20Power%20of%20an%20Intriguing%20Phrase%20/"/>
      <url>/2024/02/26/Life%20Reflections/De%20Facto:%20Unveiling%20the%20Power%20of%20an%20Intriguing%20Phrase%20/</url>
      
        <content type="html"><![CDATA[<p>Hello, language enthusiasts! ğŸŒ Today, weâ€™re diving into a fascinating phrase that often pops up in English conversations and writings: <strong>de facto</strong>. Letâ€™s explore its meaning, origins, and how to use it effectively in sentences. Whether youâ€™re a language learner or a word nerd, youâ€™ll find this exploration both enlightening and fun! âœ¨</p><h3 id="Understanding-â€œDe-Factoâ€"><a href="#Understanding-â€œDe-Factoâ€" class="headerlink" title="Understanding â€œDe Factoâ€"></a>Understanding â€œDe Factoâ€</h3><ol><li><p><strong>Meaning</strong>: The term â€˜de factoâ€™ is used to describe something that exists in reality, even if itâ€™s not officially recognized or legally established. Itâ€™s like saying â€œin practiceâ€ or â€œin actuality,â€ as opposed to â€œin theoryâ€ or â€œofficially.â€</p></li><li><p><strong>Origins</strong>: This phrase has an interesting journey. It comes from Latin, where â€˜deâ€™ means â€˜fromâ€™ and â€˜factoâ€™ means â€˜fact.â€™ Over time, itâ€™s been adopted into English, retaining its original essence from Latin.</p></li></ol><h3 id="Examples-in-Sentences"><a href="#Examples-in-Sentences" class="headerlink" title="Examples in Sentences"></a>Examples in Sentences</h3><ul><li>ğŸŒŸ <em>In many organizations, there is a <strong>de facto</strong> leader who isnâ€™t officially the boss but is respected and followed by the team.</em></li><li>ğŸŒŸ <em>While English is the <strong>de facto</strong> language of international business, itâ€™s not the official language in many countries where itâ€™s widely spoken.</em></li><li>ğŸŒŸ <em>The museum, though not formally recognized, acts as the <strong>de facto</strong> cultural center of the small town.</em></li></ul><h3 id="Wrapping-Up"><a href="#Wrapping-Up" class="headerlink" title="Wrapping Up"></a>Wrapping Up</h3><p>The term â€˜de factoâ€™ is a subtle but powerful way to describe the reality of a situation, distinguishing it from its official or legal status. Incorporating such phrases into your language arsenal not only enriches your vocabulary but also enhances your ability to express nuanced ideas. Keep exploring and embracing the beauty of language! ğŸ“šğŸ’¬</p><p>Remember, language is a journey, not a destination. Happy learning, and see you in the next post! ğŸš€ğŸŒŸ</p>]]></content>
      
      
      <categories>
          
          <category> Life Reflections </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Language Learning </tag>
            
            <tag> English Vocabulary </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è‹±è¯­å­¦ä¹ æ—¥è®°ï¼šæ¢ç´¢é‡‘èæœ¯è¯­ &#39;Giro Date&#39;</title>
      <link href="/2024/02/21/Life%20Reflections/%E8%8B%B1%E8%AF%AD%E5%AD%A6%E4%B9%A0%E6%97%A5%E8%AE%B0%EF%BC%9A%E6%8E%A2%E7%B4%A2%E9%87%91%E8%9E%8D%E6%9C%AF%E8%AF%AD%20&#39;Giro%20Date&#39;/"/>
      <url>/2024/02/21/Life%20Reflections/%E8%8B%B1%E8%AF%AD%E5%AD%A6%E4%B9%A0%E6%97%A5%E8%AE%B0%EF%BC%9A%E6%8E%A2%E7%B4%A2%E9%87%91%E8%9E%8D%E6%9C%AF%E8%AF%AD%20&#39;Giro%20Date&#39;/</url>
      
        <content type="html"><![CDATA[<p>ä»Šå¤©çš„è‹±è¯­å­¦ä¹ ä¹‹æ—…ä¸­ï¼Œæˆ‘é‡åˆ°äº†ä¸€ä¸ªæœ‰è¶£çš„é‡‘èæœ¯è¯­ï¼šâ€œGiro dateâ€ã€‚è¿™ä¸ªæ¢ç´¢è¿‡ç¨‹ä¸ä»…ä¸°å¯Œäº†æˆ‘çš„è¯æ±‡ï¼Œè¿˜åŠ æ·±äº†æˆ‘å¯¹è‹±è¯­ä¸­é‡‘èæ¦‚å¿µçš„ç†è§£ã€‚è®©æˆ‘å’Œä½ åˆ†äº«ä¸€ä¸‹æˆ‘æ˜¯å¦‚ä½•åˆ†æè¿™ä¸ªæœ¯è¯­åŠå…¶åœ¨é‡‘èä¸–ç•Œä¸­çš„é‡è¦æ€§ã€‚</p><h3 id="å‘ç°è¯æº-ğŸŒ"><a href="#å‘ç°è¯æº-ğŸŒ" class="headerlink" title="å‘ç°è¯æº ğŸŒ"></a>å‘ç°è¯æº ğŸŒ</h3><ul><li><strong>æ„å¤§åˆ©è¯­æ ¹æº</strong>: æˆ‘çš„ç ”ç©¶å‘ç° â€˜Giroâ€™ æ¥è‡ªæ„å¤§åˆ©è¯­å•è¯ â€œgirareâ€ï¼Œæ„å‘³ç€è½¬è´¦æˆ–æ”¯ä»˜ã€‚</li><li><strong>é‡‘èè¯­å¢ƒ</strong>: åœ¨é‡‘èé¢†åŸŸä¸­ï¼Œâ€™giroâ€™ é€šå¸¸æŒ‡çš„æ˜¯é€šè¿‡é“¶è¡Œæˆ–å…¶ä»–é‡‘èæœºæ„çš„è½¬è´¦ã€‚</li></ul><h3 id="å­¦ä¹ å…¶ç”¨æ³•-ğŸ’¡"><a href="#å­¦ä¹ å…¶ç”¨æ³•-ğŸ’¡" class="headerlink" title="å­¦ä¹ å…¶ç”¨æ³• ğŸ’¡"></a>å­¦ä¹ å…¶ç”¨æ³• ğŸ’¡</h3><ul><li><strong>å®šä¹‰</strong>: åœ¨é‡‘èäº¤æ˜“ä¸­ï¼Œâ€™Giro dateâ€™ ç‰¹æŒ‡æ”¯ä»˜æˆ–ç»“ç®—æ—¥æœŸã€‚</li><li><strong>é“¶è¡Œä¸šé‡è¦æ€§</strong>: è¿™æ˜¯ä¸€ä¸ªé¢„å®šçš„æ—¥æœŸï¼Œèµ„é‡‘é¢„æœŸåœ¨æ­¤æ—¥æœŸè¢«æ”¯ä»˜æˆ–ç»“ç®—ã€‚</li></ul><h3 id="å®é™…åº”ç”¨-ğŸ“˜"><a href="#å®é™…åº”ç”¨-ğŸ“˜" class="headerlink" title="å®é™…åº”ç”¨ ğŸ“˜"></a>å®é™…åº”ç”¨ ğŸ“˜</h3><ul><li><strong>å‘ç¥¨æ”¯ä»˜æ—¥æœŸ</strong>: â€œPlease ensure that the giro date for the invoice is set to the 25th of this month.â€ï¼ˆè¯·ç¡®ä¿å‘ç¥¨çš„æ”¯ä»˜æ—¥æœŸè®¾ä¸ºæœ¬æœˆ25æ—¥ã€‚ï¼‰</li><li><strong>è´·æ¬¾è¿˜æ¬¾æ—¥æœŸ</strong>: â€œThe giro date for the loan repayment is automatically set for the 1st of each month.â€ï¼ˆè´·æ¬¾è¿˜æ¬¾çš„æ”¯ä»˜æ—¥æœŸè‡ªåŠ¨è®¾å®šä¸ºæ¯æœˆçš„ç¬¬ä¸€å¤©ã€‚ï¼‰</li></ul><p>è¿™äº›ä¾‹å­å¸®åŠ©æˆ‘å·©å›ºäº†å¯¹è¿™ä¸ªæœ¯è¯­çš„ç†è§£ï¼Œå±•ç¤ºäº†å®ƒåœ¨é“¶è¡Œä¸šåŠ¡ã€è´¢åŠ¡ç®¡ç†å’Œè´¦åŠ¡å¤„ç†ä¸­çš„ç”¨é€”ã€‚</p><h3 id="åæ€ä¸å‰è¡Œ-ğŸŒŸ"><a href="#åæ€ä¸å‰è¡Œ-ğŸŒŸ" class="headerlink" title="åæ€ä¸å‰è¡Œ ğŸŒŸ"></a>åæ€ä¸å‰è¡Œ ğŸŒŸ</h3><p>éšæˆ‘ç»§ç»­åœ¨è‹±è¯­å­¦ä¹ çš„è¿·äººä¸–ç•Œä¸­æ—…è¡Œï¼Œæ¯ä¸€ä¸ªæœ¯è¯­éƒ½è§£é”äº†æ–°çš„çŸ¥è¯†å’Œç†è§£ï¼ğŸ“šâœ¨</p>]]></content>
      
      
      <categories>
          
          <category> Life Reflections </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Language Learning </tag>
            
            <tag> English Vocabulary </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>English Learning Journey: Unraveling the Term &#39;Giro Date&#39;</title>
      <link href="/2024/02/21/Life%20Reflections/English%20Learning%20Journey:%20Unraveling%20the%20Term%20&#39;Giro%20Date&#39;/"/>
      <url>/2024/02/21/Life%20Reflections/English%20Learning%20Journey:%20Unraveling%20the%20Term%20&#39;Giro%20Date&#39;/</url>
      
        <content type="html"><![CDATA[<p>Today in my English learning journey, I encountered an intriguing financial term: â€œGiro dateâ€. This exploration not only expanded my vocabulary but also deepened my understanding of financial concepts in English. Let me share with you how I dissected this term and its relevance in the financial world.</p><h3 id="Discovering-the-Origin-ğŸŒ"><a href="#Discovering-the-Origin-ğŸŒ" class="headerlink" title="Discovering the Origin ğŸŒ"></a>Discovering the Origin ğŸŒ</h3><ul><li><strong>Italian Roots</strong>: My research revealed that â€˜Giroâ€™ originates from the Italian word â€œgirare,â€ meaning to transfer or pay. </li><li><strong>Financial Context</strong>: In the realm of finance, â€˜giroâ€™ typically refers to a bank or institutional transfer.</li></ul><h3 id="Learning-the-Usage-ğŸ’¡"><a href="#Learning-the-Usage-ğŸ’¡" class="headerlink" title="Learning the Usage ğŸ’¡"></a>Learning the Usage ğŸ’¡</h3><ul><li><strong>Definition</strong>: In financial transactions, â€˜Giro dateâ€™ specifically denotes the payment or settlement date.</li><li><strong>Banking Significance</strong>: Itâ€™s a predetermined date when funds are expected to be paid or settled.</li></ul><h3 id="Applying-it-in-Context-ğŸ“˜"><a href="#Applying-it-in-Context-ğŸ“˜" class="headerlink" title="Applying it in Context ğŸ“˜"></a>Applying it in Context ğŸ“˜</h3><ul><li><strong>Invoice Payment Date</strong>: I practiced using the term in a sentence: â€œPlease ensure that the giro date for the invoice is set to the 25th of this month.â€</li><li><strong>Loan Repayment Date</strong>: Another example I came up with was, â€œThe giro date for the loan repayment is automatically set for the 1st of each month.â€</li></ul><p>These examples helped cement the term in my mind, illustrating its use in banking, financial management, and account processing.</p><h3 id="Reflections-and-Forward-Steps-ğŸŒŸ"><a href="#Reflections-and-Forward-Steps-ğŸŒŸ" class="headerlink" title="Reflections and Forward Steps ğŸŒŸ"></a>Reflections and Forward Steps ğŸŒŸ</h3><p>Understanding â€˜Giro dateâ€™ was not just about adding a new word to my vocabulary; it was about comprehending a concept that plays a vital role in financial transactions. This learning experience has made me appreciate the nuances of financial English and motivated me to delve deeper into industry-specific terminology.</p><p>Join me as I continue my journey through the fascinating world of English language learning, where every term unlocks new knowledge and understanding! ğŸ“šâœ¨</p>]]></content>
      
      
      <categories>
          
          <category> Life Reflections </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Language Learning </tag>
            
            <tag> English Vocabulary </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>How to Resolve SSH Key Issues with Multiple Git Services</title>
      <link href="/2024/02/19/Debugging%20Diaries/How%20to%20Resolve%20SSH%20Key%20Issues%20with%20Multiple%20Git%20Services/"/>
      <url>/2024/02/19/Debugging%20Diaries/How%20to%20Resolve%20SSH%20Key%20Issues%20with%20Multiple%20Git%20Services/</url>
      
        <content type="html"><![CDATA[<h1 id="How-to-Resolve-SSH-Key-Issues-with-Multiple-Git-Services-ğŸ—ï¸"><a href="#How-to-Resolve-SSH-Key-Issues-with-Multiple-Git-Services-ğŸ—ï¸" class="headerlink" title="How to Resolve SSH Key Issues with Multiple Git Services ğŸ—ï¸"></a>How to Resolve SSH Key Issues with Multiple Git Services ğŸ—ï¸</h1><p>When using Git with different Git services such as GitHub and GitLab, you may encounter SSH key issues. This article will guide you on how to set up and configure SSH keys so that you can work smoothly with multiple services simultaneously.</p><h2 id="1-Generate-SSH-Keys-ğŸ”‘"><a href="#1-Generate-SSH-Keys-ğŸ”‘" class="headerlink" title="1. Generate SSH Keys ğŸ”‘"></a>1. Generate SSH Keys ğŸ”‘</h2><p>First, generate a separate SSH key for each Git service.</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -b 4096 -C <span class="string">"your_email@example.com"</span></span><br></pre></td></tr></tbody></table></figure><p>When generating the keys, save each key with a different filename, for example, <code>id_rsa_github</code> and <code>id_rsa_gitlab</code>.</p><h2 id="2-Add-SSH-Keys-to-Git-Services-ğŸŒ"><a href="#2-Add-SSH-Keys-to-Git-Services-ğŸŒ" class="headerlink" title="2. Add SSH Keys to Git Services ğŸŒ"></a>2. Add SSH Keys to Git Services ğŸŒ</h2><p>Log in to your GitHub and GitLab accounts, then add the generated public keys (<code>.pub</code> files) to the SSH key sections of each respective account.</p><h2 id="3-Configure-SSH-âš™ï¸"><a href="#3-Configure-SSH-âš™ï¸" class="headerlink" title="3. Configure SSH âš™ï¸"></a>3. Configure SSH âš™ï¸</h2><p>Create or edit the <code>~/.ssh/config</code> file to configure different SSH keys for each service.</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># GitHub</span></span><br><span class="line">Host github.com</span><br><span class="line">  HostName github.com</span><br><span class="line">  User git</span><br><span class="line">  IdentityFile ~/.ssh/id_rsa_github</span><br><span class="line"></span><br><span class="line"><span class="comment"># GitLab</span></span><br><span class="line">Host gitlab.com</span><br><span class="line">  HostName gitlab.com</span><br><span class="line">  User git</span><br><span class="line">  IdentityFile ~/.ssh/id_rsa_gitlab</span><br></pre></td></tr></tbody></table></figure><p>If your company uses a custom GitLab instance, add a separate configuration block for it.</p><h2 id="4-Test-SSH-Connections-ğŸ§ª"><a href="#4-Test-SSH-Connections-ğŸ§ª" class="headerlink" title="4. Test SSH Connections ğŸ§ª"></a>4. Test SSH Connections ğŸ§ª</h2><p>Test if you can successfully connect to each service via SSH.</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh -T git@github.com</span><br><span class="line">ssh -T git@gitlab.com</span><br></pre></td></tr></tbody></table></figure><h2 id="5-Handling-Common-Errors-â—"><a href="#5-Handling-Common-Errors-â—" class="headerlink" title="5. Handling Common Errors â—"></a>5. Handling Common Errors â—</h2><p>If you encounter errors such as â€œPermission denied (publickey)â€, check the following:</p><ul><li>Ensure SSH keys are correctly added to the respective Git services.</li><li>Verify if the <code>~/.ssh/config</code> file is configured correctly.</li><li>Use the <code>ssh-add</code> command to ensure SSH keys are loaded into the SSH Agent.</li></ul><h2 id="6-Common-Issues-and-Solutions-ğŸ’¡"><a href="#6-Common-Issues-and-Solutions-ğŸ’¡" class="headerlink" title="6. Common Issues and Solutions ğŸ’¡"></a>6. Common Issues and Solutions ğŸ’¡</h2><ul><li><strong>Multiple GitLab Instances</strong>: If you use a custom GitLab instance along with GitLab.com, ensure they are separately configured in the SSH <code>config</code> file.</li><li><strong>Network Issues</strong>: Check if any network settings (like proxies, VPNs) might affect SSH connections.</li></ul><hr><p>By following the above steps, you should be able to resolve most SSH key-related issues, especially when dealing with multiple Git services. If you have further questions or specific scenarios, feel free to ask in the comments. ğŸš€âœ¨</p>]]></content>
      
      
      <categories>
          
          <category> Debugging Diaries </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IssueFix </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•è§£å†³å¤šä¸ª Git æœåŠ¡çš„ SSH å¯†é’¥é—®é¢˜</title>
      <link href="/2024/02/19/Debugging%20Diaries/%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E5%A4%9A%E4%B8%AA%20Git%20%E6%9C%8D%E5%8A%A1%E7%9A%84%20SSH%20%E5%AF%86%E9%92%A5%E9%97%AE%E9%A2%98/"/>
      <url>/2024/02/19/Debugging%20Diaries/%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E5%A4%9A%E4%B8%AA%20Git%20%E6%9C%8D%E5%8A%A1%E7%9A%84%20SSH%20%E5%AF%86%E9%92%A5%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h1 id="å¦‚ä½•è§£å†³å¤šä¸ª-Git-æœåŠ¡çš„-SSH-å¯†é’¥é—®é¢˜-ğŸ—ï¸"><a href="#å¦‚ä½•è§£å†³å¤šä¸ª-Git-æœåŠ¡çš„-SSH-å¯†é’¥é—®é¢˜-ğŸ—ï¸" class="headerlink" title="å¦‚ä½•è§£å†³å¤šä¸ª Git æœåŠ¡çš„ SSH å¯†é’¥é—®é¢˜ ğŸ—ï¸"></a>å¦‚ä½•è§£å†³å¤šä¸ª Git æœåŠ¡çš„ SSH å¯†é’¥é—®é¢˜ ğŸ—ï¸</h1><p>åœ¨ä½¿ç”¨ Git å’Œä¸åŒçš„ Git æœåŠ¡ï¼ˆå¦‚ GitHub å’Œ GitLabï¼‰æ—¶ï¼Œå¯èƒ½ä¼šé‡åˆ° SSH å¯†é’¥çš„é—®é¢˜ã€‚æœ¬æ–‡å°†æŒ‡å¯¼ä½ å¦‚ä½•è®¾ç½®å’Œé…ç½® SSH å¯†é’¥ï¼Œä»¥ä¾¿å¯ä»¥åŒæ—¶ä¸å¤šä¸ªæœåŠ¡é¡ºåˆ©å·¥ä½œã€‚</p><h2 id="1-ç”Ÿæˆ-SSH-å¯†é’¥-ğŸ”‘"><a href="#1-ç”Ÿæˆ-SSH-å¯†é’¥-ğŸ”‘" class="headerlink" title="1. ç”Ÿæˆ SSH å¯†é’¥ ğŸ”‘"></a>1. ç”Ÿæˆ SSH å¯†é’¥ ğŸ”‘</h2><p>é¦–å…ˆï¼Œä¸ºæ¯ä¸ª Git æœåŠ¡ç”Ÿæˆä¸€ä¸ªç‹¬ç«‹çš„ SSH å¯†é’¥ã€‚</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -b 4096 -C <span class="string">"your_email@example.com"</span></span><br></pre></td></tr></tbody></table></figure><p>åœ¨ç”Ÿæˆå¯†é’¥æ—¶ï¼Œå°†æ¯ä¸ªå¯†é’¥ä¿å­˜ä¸ºä¸åŒçš„æ–‡ä»¶åï¼Œä¾‹å¦‚ <code>id_rsa_github</code> å’Œ <code>id_rsa_gitlab</code>ã€‚</p><h2 id="2-å°†-SSH-å¯†é’¥æ·»åŠ åˆ°-Git-æœåŠ¡-ğŸŒ"><a href="#2-å°†-SSH-å¯†é’¥æ·»åŠ åˆ°-Git-æœåŠ¡-ğŸŒ" class="headerlink" title="2. å°† SSH å¯†é’¥æ·»åŠ åˆ° Git æœåŠ¡ ğŸŒ"></a>2. å°† SSH å¯†é’¥æ·»åŠ åˆ° Git æœåŠ¡ ğŸŒ</h2><p>ç™»å½•åˆ°ä½ çš„ GitHub å’Œ GitLab è´¦æˆ·ï¼Œç„¶åå°†ç”Ÿæˆçš„å…¬é’¥ï¼ˆ<code>.pub</code> æ–‡ä»¶ï¼‰æ·»åŠ åˆ°å„è‡ªè´¦æˆ·çš„ SSH å¯†é’¥éƒ¨åˆ†ã€‚</p><h2 id="3-é…ç½®-SSH-âš™ï¸"><a href="#3-é…ç½®-SSH-âš™ï¸" class="headerlink" title="3. é…ç½® SSH âš™ï¸"></a>3. é…ç½® SSH âš™ï¸</h2><p>åˆ›å»ºæˆ–ç¼–è¾‘ <code>~/.ssh/config</code> æ–‡ä»¶ï¼Œä¸ºæ¯ä¸ªæœåŠ¡é…ç½®ä¸åŒçš„ SSH å¯†é’¥ã€‚</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># GitHub</span></span><br><span class="line">Host github.com</span><br><span class="line">  HostName github.com</span><br><span class="line">  User git</span><br><span class="line">  IdentityFile ~/.ssh/id_rsa_github</span><br><span class="line"></span><br><span class="line"><span class="comment"># GitLab</span></span><br><span class="line">Host gitlab.com</span><br><span class="line">  HostName gitlab.com</span><br><span class="line">  User git</span><br><span class="line">  IdentityFile ~/.ssh/id_rsa_gitlab</span><br></pre></td></tr></tbody></table></figure><p>å¦‚æœä½ çš„å…¬å¸ä½¿ç”¨è‡ªå®šä¹‰çš„ GitLab å®ä¾‹ï¼Œè¯·ä¸ºå…¶æ·»åŠ ä¸€ä¸ªå•ç‹¬çš„é…ç½®å—ã€‚</p><h2 id="4-æµ‹è¯•-SSH-è¿æ¥-ğŸ§ª"><a href="#4-æµ‹è¯•-SSH-è¿æ¥-ğŸ§ª" class="headerlink" title="4. æµ‹è¯• SSH è¿æ¥ ğŸ§ª"></a>4. æµ‹è¯• SSH è¿æ¥ ğŸ§ª</h2><p>æµ‹è¯•æ˜¯å¦èƒ½æˆåŠŸé€šè¿‡ SSH è¿æ¥åˆ°æ¯ä¸ªæœåŠ¡ã€‚</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh -T git@github.com</span><br><span class="line">ssh -T git@gitlab.com</span><br></pre></td></tr></tbody></table></figure><h2 id="5-å¤„ç†å¸¸è§é”™è¯¯-â—"><a href="#5-å¤„ç†å¸¸è§é”™è¯¯-â—" class="headerlink" title="5. å¤„ç†å¸¸è§é”™è¯¯ â—"></a>5. å¤„ç†å¸¸è§é”™è¯¯ â—</h2><p>å¦‚æœé‡åˆ°é”™è¯¯ï¼Œå¦‚ â€œPermission denied (publickey)â€ï¼Œè¯·æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ul><li>ç¡®è®¤ SSH å¯†é’¥æ˜¯å¦å·²æ­£ç¡®æ·»åŠ åˆ°ç›¸åº”çš„ Git æœåŠ¡ã€‚</li><li>æ£€æŸ¥ <code>~/.ssh/config</code> æ–‡ä»¶æ˜¯å¦æ­£ç¡®é…ç½®ã€‚</li><li>ä½¿ç”¨ <code>ssh-add</code> å‘½ä»¤ç¡®ä¿ SSH å¯†é’¥å·²åŠ è½½åˆ° SSH Agentã€‚</li></ul><h2 id="6-å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ-ğŸ’¡"><a href="#6-å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ-ğŸ’¡" class="headerlink" title="6. å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ ğŸ’¡"></a>6. å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ ğŸ’¡</h2><ul><li><strong>å¤šä¸ª GitLab å®ä¾‹</strong>ï¼šå¦‚æœä½ ä½¿ç”¨äº†å…¬å¸çš„è‡ªå®šä¹‰ GitLab å®ä¾‹å’Œ GitLab.comï¼Œè¯·ç¡®ä¿ SSH <code>config</code> æ–‡ä»¶ä¸­å®ƒä»¬çš„é…ç½®æ˜¯åˆ†å¼€çš„ã€‚</li><li><strong>ç½‘ç»œé—®é¢˜</strong>ï¼šæ£€æŸ¥æ˜¯å¦æœ‰ç½‘ç»œè®¾ç½®ï¼ˆå¦‚ä»£ç†ã€VPNï¼‰å¯èƒ½å½±å“ SSH è¿æ¥ã€‚</li></ul><hr><p>é€šè¿‡éµå¾ªä»¥ä¸Šæ­¥éª¤ï¼Œä½ åº”è¯¥èƒ½å¤Ÿè§£å†³å¤§éƒ¨åˆ†ä¸ SSH å¯†é’¥ç›¸å…³çš„é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†å¤šä¸ª Git æœåŠ¡æ—¶ã€‚å¦‚æœæœ‰è¿›ä¸€æ­¥çš„é—®é¢˜æˆ–è€…ç‰¹æ®Šæƒ…å†µï¼Œæ¬¢è¿åœ¨è¯„è®ºä¸­æå‡ºã€‚ ğŸš€âœ¨</p>]]></content>
      
      
      <categories>
          
          <category> Debugging Diaries </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IssueFix </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç†è§£å¤§å‹è¯­è¨€æ¨¡å‹ä¸­Fine-tuningå’ŒFurther Pretrainingçš„åŒºåˆ«</title>
      <link href="/2024/02/19/NLP%20Insights/%E7%90%86%E8%A7%A3%E5%A4%A7%E5%9E%8B%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E4%B8%ADFine-tuning%E5%92%8CFurther%20Pretraining%E7%9A%84%E5%8C%BA%E5%88%AB/"/>
      <url>/2024/02/19/NLP%20Insights/%E7%90%86%E8%A7%A3%E5%A4%A7%E5%9E%8B%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E4%B8%ADFine-tuning%E5%92%8CFurther%20Pretraining%E7%9A%84%E5%8C%BA%E5%88%AB/</url>
      
        <content type="html"><![CDATA[<h1 id="ç†è§£å¤§å‹è¯­è¨€æ¨¡å‹ä¸­-Fine-tuning-å’Œ-Further-Pretraining-çš„åŒºåˆ«"><a href="#ç†è§£å¤§å‹è¯­è¨€æ¨¡å‹ä¸­-Fine-tuning-å’Œ-Further-Pretraining-çš„åŒºåˆ«" class="headerlink" title="ç†è§£å¤§å‹è¯­è¨€æ¨¡å‹ä¸­ Fine-tuning å’Œ Further Pretraining çš„åŒºåˆ«"></a>ç†è§£å¤§å‹è¯­è¨€æ¨¡å‹ä¸­ Fine-tuning å’Œ Further Pretraining çš„åŒºåˆ«</h1><p>åœ¨è‡ªç„¶è¯­è¨€å¤„ç†ï¼ˆNLPï¼‰é¢†åŸŸï¼Œå¤§å‹è¯­è¨€æ¨¡å‹ï¼Œå¦‚ GPT å’Œ BERT çš„å‡ºç°ï¼Œå½»åº•æ”¹å˜äº†æˆ‘ä»¬å¤„ç†æ–‡æœ¬åˆ†ç±»ã€æƒ…æ„Ÿåˆ†æå’Œé—®ç­”ç­‰ä»»åŠ¡çš„æ–¹å¼ã€‚åœ¨è¿™äº›æ¨¡å‹çš„åº”ç”¨ä¸­ï¼ŒFine-tuningï¼ˆå¾®è°ƒï¼‰å’Œ Further Pretrainingï¼ˆè¿›ä¸€æ­¥é¢„è®­ç»ƒï¼‰æ˜¯ä¸¤ç§å…³é”®æŠ€æœ¯ã€‚è™½ç„¶å®ƒä»¬çœ‹èµ·æ¥ç›¸ä¼¼ï¼Œä½†å®é™…ä¸ŠæœåŠ¡äº NLP æµç¨‹ä¸­çš„ä¸åŒéœ€æ±‚å’Œåœºæ™¯ã€‚</p><h2 id="ä»€ä¹ˆæ˜¯-Fine-tuningï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯-Fine-tuningï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ Fine-tuningï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ Fine-tuningï¼Ÿ</h2><p>Fine-tuning æ˜¯æŒ‡åœ¨ç‰¹å®šä»»åŠ¡çš„æ•°æ®é›†ä¸Šè¿›ä¸€æ­¥è®­ç»ƒï¼ˆæˆ–â€œå¾®è°ƒâ€ï¼‰ä¸€ä¸ªé¢„è®­ç»ƒå¥½çš„æ¨¡å‹çš„è¿‡ç¨‹ã€‚è¿™ç§æ–¹æ³•åœ¨æ•°æ®é›†ç›¸å¯¹è¾ƒå°ä½†æ ‡æ³¨è‰¯å¥½çš„æƒ…å†µä¸‹ç‰¹åˆ«æœ‰æ•ˆã€‚</p><h3 id="ç¤ºä¾‹åœºæ™¯ï¼šæƒ…æ„Ÿåˆ†æ"><a href="#ç¤ºä¾‹åœºæ™¯ï¼šæƒ…æ„Ÿåˆ†æ" class="headerlink" title="ç¤ºä¾‹åœºæ™¯ï¼šæƒ…æ„Ÿåˆ†æ"></a>ç¤ºä¾‹åœºæ™¯ï¼šæƒ…æ„Ÿåˆ†æ</h3><p>å‡è®¾ä½ æœ‰ä¸€ç»„ç”µå½±è¯„è®ºæ•°æ®ï¼Œæ¯æ¡è¯„è®ºéƒ½æ ‡è®°äº†æ­£é¢æˆ–è´Ÿé¢æƒ…æ„Ÿã€‚ä½ æƒ³åˆ›å»ºä¸€ä¸ªæ¨¡å‹æ¥é¢„æµ‹è¯„è®ºçš„æƒ…æ„Ÿã€‚</p><h4 id="Python-ä»£ç ç¤ºä¾‹ï¼ˆä½¿ç”¨-PyTorch-å’Œ-HuggingFace-çš„-Transformersï¼‰"><a href="#Python-ä»£ç ç¤ºä¾‹ï¼ˆä½¿ç”¨-PyTorch-å’Œ-HuggingFace-çš„-Transformersï¼‰" class="headerlink" title="Python ä»£ç ç¤ºä¾‹ï¼ˆä½¿ç”¨ PyTorch å’Œ HuggingFace çš„ Transformersï¼‰"></a>Python ä»£ç ç¤ºä¾‹ï¼ˆä½¿ç”¨ PyTorch å’Œ HuggingFace çš„ Transformersï¼‰</h4><p>This notebook demonstrates the fine-tuning of a BERT model on the IMDB dataset for sentiment analysis. For detailed code implementation, please refer to the following link:<a href="https://colab.research.google.com/drive/15naxP8pNMoCCBMgMSOv4ETDRGL46YR38?usp=sharing">link</a>.</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> (</span><br><span class="line">    BertTokenizer,</span><br><span class="line">    BertForSequenceClassification,</span><br><span class="line">    Trainer,</span><br><span class="line">    TrainingArguments,</span><br><span class="line">)</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> datasets <span class="keyword">import</span> load_dataset, DatasetDict</span><br><span class="line"></span><br><span class="line"><span class="string">"""## 1.åŠ è½½å’Œå‡†å¤‡IMDBæ•°æ®é›†æ ·æœ¬</span></span><br><span class="line"><span class="string">é€‰å–ä¸€éƒ¨åˆ†æ•°æ®ç”¨äºFine-tuningã€‚</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åŠ è½½IMDBæ•°æ®é›†</span></span><br><span class="line">dataset = load_dataset(<span class="string">'imdb'</span>, split=<span class="string">'train'</span>)</span><br><span class="line">small_dataset = dataset.shuffle(seed=<span class="number">42</span>).select(<span class="built_in">range</span>(<span class="number">10000</span>))  <span class="comment"># é€‰å–å‰10000ä¸ªæ ·æœ¬</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆå§‹åŒ–tokenizer</span></span><br><span class="line">tokenizer = BertTokenizer.from_pretrained(<span class="string">"bert-base-uncased"</span>)</span><br><span class="line"></span><br><span class="line">device = <span class="string">"cuda"</span> <span class="keyword">if</span> torch.cuda.is_available() <span class="keyword">else</span> <span class="string">"cpu"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¼–ç æ•°æ®é›†</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encode</span>(<span class="params">examples</span>):</span><br><span class="line">    <span class="keyword">return</span> tokenizer(examples[<span class="string">"text"</span>], padding=<span class="string">"max_length"</span>, truncation=<span class="literal">True</span>, max_length=<span class="number">512</span>)</span><br><span class="line"></span><br><span class="line">encoded_small_dataset = small_dataset.<span class="built_in">map</span>(encode, batched=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> BertModel</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">visualize_attention</span>(<span class="params">sentence, model, tokenizer</span>):</span><br><span class="line">    model.to(device)</span><br><span class="line">    <span class="comment"># å°†æ¨¡å‹è®¾ç½®ä¸ºè¯„ä¼°æ¨¡å¼</span></span><br><span class="line">    model.<span class="built_in">eval</span>()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å°†è¾“å…¥æ–‡æœ¬è½¬æ¢ä¸ºæ¨¡å‹å¯ä»¥ç†è§£çš„å½¢å¼</span></span><br><span class="line">    inputs = tokenizer(sentence, return_tensors=<span class="string">"pt"</span>).to(device) <span class="comment"># ç¡®ä¿è¾“å…¥ä¹Ÿåœ¨ç›¸åŒè®¾å¤‡</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># ä½¿ç”¨æ¨¡å‹è·å–æ³¨æ„åŠ›æƒé‡</span></span><br><span class="line">    <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">        outputs = model(**inputs)</span><br><span class="line">    attentions = outputs.attentions</span><br><span class="line"></span><br><span class="line">    <span class="comment"># é€‰æ‹©è¦å¯è§†åŒ–çš„å±‚å’Œå¤´</span></span><br><span class="line">    layer = <span class="number">5</span></span><br><span class="line">    head = <span class="number">1</span></span><br><span class="line">    attention = attentions[layer][<span class="number">0</span>, head].cpu().numpy() <span class="comment"># å°†æ³¨æ„åŠ›æƒé‡ç§»å›CPUè¿›è¡Œå¯è§†åŒ–</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># è®¾ç½®å¯è§†åŒ–çš„tokens</span></span><br><span class="line">    tokens = tokenizer.convert_ids_to_tokens(inputs[<span class="string">"input_ids"</span>][<span class="number">0</span>].cpu()) <span class="comment"># åŒæ ·ç¡®ä¿tokensåœ¨CPUä¸Š</span></span><br><span class="line">    <span class="comment"># ç»˜åˆ¶æ³¨æ„åŠ›çŸ©é˜µ</span></span><br><span class="line">    plt.figure(figsize=(<span class="number">10</span>, <span class="number">10</span>))</span><br><span class="line">    plt.matshow(attention, cmap=<span class="string">'viridis'</span>)</span><br><span class="line">    plt.xticks(<span class="built_in">range</span>(<span class="built_in">len</span>(tokens)), tokens, rotation=<span class="number">90</span>)</span><br><span class="line">    plt.yticks(<span class="built_in">range</span>(<span class="built_in">len</span>(tokens)), tokens)</span><br><span class="line">    plt.colorbar()</span><br><span class="line">    plt.show()</span><br><span class="line"></span><br><span class="line"><span class="string">"""## 2. å¯è§†åŒ–ä¸€ä¸ªæ ·æœ¬å¥å­çš„æ³¨æ„åŠ›æƒé‡ï¼ˆæœªç»Fine-tuningï¼‰</span></span><br><span class="line"><span class="string">é€‰æ‹©æ•°æ®é›†ä¸­çš„ä¸€ä¸ªå¥å­å¹¶å±•ç¤ºå…¶åŸå§‹BERTæ¨¡å‹çš„æ³¨æ„åŠ›æƒé‡ã€‚</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨æœªç»Fine-tuningçš„æ¨¡å‹</span></span><br><span class="line">model = BertModel.from_pretrained(<span class="string">"bert-base-uncased"</span>, output_attentions=<span class="literal">True</span>)</span><br><span class="line">sample_sentence = <span class="string">"I love this movie, it's fantastic!"</span></span><br><span class="line">visualize_attention(sample_sentence, model, tokenizer)</span><br><span class="line"></span><br><span class="line"><span class="string">"""## 3. Fine-tuning BERTæ¨¡å‹</span></span><br><span class="line"><span class="string">åœ¨é€‰å–çš„IMDBæ ·æœ¬ä¸Šè¿›è¡ŒFine-tuningã€‚</span></span><br><span class="line"><span class="string">### 3.1 å‡†å¤‡æ•°æ®åŠ è½½å™¨</span></span><br><span class="line"><span class="string">ä¸ºäº†è®­ç»ƒæ¨¡å‹ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºPyTorchçš„DataLoaderã€‚è¿™å°†ä½¿æˆ‘ä»¬èƒ½å¤Ÿåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­æœ‰æ•ˆåœ°åŠ è½½æ•°æ®ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">### 3.2 è®¾ç½®Fine-tuningç¯å¢ƒ</span></span><br><span class="line"><span class="string">åˆå§‹åŒ–æ¨¡å‹ã€ä¼˜åŒ–å™¨ä»¥åŠæŸå¤±å‡½æ•°ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">### 3.3 Fine-tuningæ¨¡å‹</span></span><br><span class="line"><span class="string">æ‰§è¡ŒFine-tuningçš„è®­ç»ƒå¾ªç¯ã€‚æ‰§è¡Œä»¥ä¸Šä»£ç å°†åœ¨IMDBæ•°æ®é›†çš„å°æ ·æœ¬ä¸Šå¯¹BERTæ¨¡å‹è¿›è¡ŒFine-tuningã€‚è¿™å¯èƒ½éœ€è¦ä¸€äº›æ—¶é—´ï¼Œå…·ä½“å–å†³äºæ‚¨çš„ç¡¬ä»¶é…ç½®ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> torch.utils.data <span class="keyword">import</span> DataLoader</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†æ•°æ®é›†è½¬æ¢ä¸ºPyTorch Tensor</span></span><br><span class="line">encoded_small_dataset.set_format(<span class="string">'torch'</span>, columns=[<span class="string">'input_ids'</span>, <span class="string">'attention_mask'</span>, <span class="string">'label'</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºæ•°æ®åŠ è½½å™¨</span></span><br><span class="line">train_loader = DataLoader(encoded_small_dataset, batch_size=<span class="number">8</span>, shuffle=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> BertConfig, BertForSequenceClassification</span><br><span class="line"><span class="keyword">import</span> torch.optim <span class="keyword">as</span> optim</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŠ è½½é…ç½®å¹¶è®¾ç½®è¾“å‡ºæ³¨æ„åŠ›æƒé‡</span></span><br><span class="line">config = BertConfig.from_pretrained(<span class="string">"bert-base-uncased"</span>, output_attentions=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆå§‹åŒ–ç”¨äºåºåˆ—åˆ†ç±»çš„BERTæ¨¡å‹</span></span><br><span class="line"><span class="comment"># ä½¿ç”¨æ›´æ–°åçš„é…ç½®åŠ è½½æ¨¡å‹</span></span><br><span class="line">model = BertForSequenceClassification.from_pretrained(<span class="string">"bert-base-uncased"</span>, config=config)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®ä¼˜åŒ–å™¨</span></span><br><span class="line">optimizer = optim.AdamW(model.parameters(), lr=<span class="number">5e-5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨äº¤å‰ç†µæŸå¤±å‡½æ•°</span></span><br><span class="line">criterion = torch.nn.CrossEntropyLoss()</span><br><span class="line"></span><br><span class="line">model.to(device)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®è®­ç»ƒçš„è½®æ¬¡</span></span><br><span class="line">epochs = <span class="number">8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(epochs):</span><br><span class="line">    model.train()</span><br><span class="line">    total_loss = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> batch <span class="keyword">in</span> train_loader:</span><br><span class="line">        <span class="comment"># å°†æ•°æ®ç§»è‡³GPU</span></span><br><span class="line">        input_ids = batch[<span class="string">'input_ids'</span>].to(device)</span><br><span class="line">        attention_mask = batch[<span class="string">'attention_mask'</span>].to(device)</span><br><span class="line">        labels = batch[<span class="string">'label'</span>].to(device)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æ¨¡å‹å‰å‘ä¼ æ’­</span></span><br><span class="line">        outputs = model(input_ids, attention_mask=attention_mask)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># è®¡ç®—æŸå¤±</span></span><br><span class="line">        loss = criterion(outputs.logits, labels)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># åå‘ä¼ æ’­å’Œä¼˜åŒ–</span></span><br><span class="line">        optimizer.zero_grad()</span><br><span class="line">        loss.backward()</span><br><span class="line">        optimizer.step()</span><br><span class="line"></span><br><span class="line">        total_loss += loss.item()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"Epoch: <span class="subst">{epoch+<span class="number">1</span>}</span>, Loss: <span class="subst">{total_loss/<span class="built_in">len</span>(train_loader)}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">"""### 4. å¯è§†åŒ–åŒä¸€å¥å­çš„æ³¨æ„åŠ›æƒé‡ï¼ˆç»è¿‡Fine-tuningï¼‰</span></span><br><span class="line"><span class="string">ä½¿ç”¨Fine-tuningåçš„æ¨¡å‹å†æ¬¡å¯è§†åŒ–åŒä¸€å¥å­çš„æ³¨æ„åŠ›æƒé‡ã€‚æ‚¨å¯ä»¥é‡ç”¨ä¹‹å‰æä¾›çš„visualize_attentionå‡½æ•°ï¼š</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line">visualize_attention(sample_sentence, model, tokenizer)</span><br></pre></td></tr></tbody></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒBERT æ¨¡å‹åœ¨ç”µå½±è¯„è®ºæ•°æ®é›†ä¸Šè¿›è¡Œäº† fine-tuningï¼Œç”¨äºæƒ…æ„Ÿåˆ†æã€‚</p><h2 id="ä»€ä¹ˆæ˜¯-Further-Pretrainingï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯-Further-Pretrainingï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ Further Pretrainingï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ Further Pretrainingï¼Ÿ</h2><p>Further Pretrainingï¼ˆä¹Ÿç§°ä¸º Domain-adaptive Pretrainingï¼Œé¢†åŸŸé€‚åº”æ€§é¢„è®­ç»ƒï¼‰æ˜¯åœ¨ä¸€ä¸ªæ–°çš„æ•°æ®é›†ä¸Šç»§ç»­è®­ç»ƒä¸€ä¸ªé¢„è®­ç»ƒæ¨¡å‹çš„è¿‡ç¨‹ï¼Œè¿™ä¸ªæ–°çš„æ•°æ®é›†ä¸ç‰¹å®šçš„é¢†åŸŸæ›´ç›¸å…³ï¼Œä½†ä¸ä¸€å®šä¸ºç‰¹å®šä»»åŠ¡æ ‡æ³¨ã€‚</p><h3 id="ç¤ºä¾‹åœºæ™¯ï¼šæ³•å¾‹æ–‡æ¡£åˆ†æ"><a href="#ç¤ºä¾‹åœºæ™¯ï¼šæ³•å¾‹æ–‡æ¡£åˆ†æ" class="headerlink" title="ç¤ºä¾‹åœºæ™¯ï¼šæ³•å¾‹æ–‡æ¡£åˆ†æ"></a>ç¤ºä¾‹åœºæ™¯ï¼šæ³•å¾‹æ–‡æ¡£åˆ†æ</h3><p>å‡è®¾ä½ æ­£åœ¨å¤„ç†æ³•å¾‹æ–‡æ¡£ï¼Œå¹¶å¸Œæœ›åˆ©ç”¨ä¸€ä¸ªåœ¨é€šç”¨æ–‡æœ¬ä¸Šè®­ç»ƒçš„è¯­è¨€æ¨¡å‹ã€‚</p><h4 id="Further-Pretraining-çš„ä»£ç ç¤ºä¾‹"><a href="#Further-Pretraining-çš„ä»£ç ç¤ºä¾‹" class="headerlink" title="Further Pretraining çš„ä»£ç ç¤ºä¾‹"></a>Further Pretraining çš„ä»£ç ç¤ºä¾‹</h4><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> BertModel, BertTokenizer</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŠ è½½é¢„è®­ç»ƒçš„BERTæ¨¡å‹å’Œåˆ†è¯å™¨</span></span><br><span class="line">model = BertModel.from_pretrained(<span class="string">'bert-base-uncased'</span>)</span><br><span class="line">tokenizer = BertTokenizer.from_pretrained(<span class="string">'bert-base-uncased'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‡†å¤‡æ³•å¾‹æ–‡æ¡£æ•°æ®é›†</span></span><br><span class="line"><span class="comment"># å‡è®¾'legal_documents'æ˜¯æ³•å¾‹æ–‡æ¡£çš„æ–‡æœ¬åˆ—è¡¨</span></span><br><span class="line">encoded_input = tokenizer(legal_documents, padding=<span class="literal">True</span>, truncation=<span class="literal">True</span>, max_length=<span class="number">512</span>, return_tensors=<span class="string">'pt'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»§ç»­é¢„è®­ç»ƒæ¨¡å‹</span></span><br><span class="line"><span class="comment"># è¿™ä¸€æ­¥é€šå¸¸åŒ…æ‹¬æ©ç è¯­è¨€å»ºæ¨¡æˆ–å…¶ä»–é¢„è®­ç»ƒç›®æ ‡</span></span><br><span class="line"><span class="comment"># è¿™é‡Œæä¾›ä¸€ä¸ªæ¦‚å¿µæ€§ç¤ºä¾‹</span></span><br><span class="line">model.train()</span><br><span class="line"><span class="keyword">for</span> batch <span class="keyword">in</span> encoded_input:</span><br><span class="line">    outputs = model(**batch)</span><br><span class="line">    <span class="comment"># ... æ‰§è¡Œè¿›ä¸€æ­¥è®­ç»ƒæ­¥éª¤</span></span><br></pre></td></tr></tbody></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒBERT æ¨¡å‹åœ¨æ³•å¾‹æ–‡æ¡£æ•°æ®é›†ä¸Šè¿›è¡Œäº†è¿›ä¸€æ­¥çš„é¢„è®­ç»ƒï¼Œä½¿å…¶åœ¨è¿›è¡Œç‰¹å®šæ³•å¾‹ NLP ä»»åŠ¡çš„ fine-tuning ä¹‹å‰ï¼Œæ›´æ“…é•¿ç†è§£æ³•å¾‹æœ¯è¯­å’Œæ¦‚å¿µã€‚</p><h2 id="å…³é”®åŒºåˆ«"><a href="#å…³é”®åŒºåˆ«" class="headerlink" title="å…³é”®åŒºåˆ«"></a>å…³é”®åŒºåˆ«</h2><ul><li><strong>ç›®çš„</strong>ï¼šFine-tuning é’ˆå¯¹å…·æœ‰æ ‡ç­¾æ•°æ®çš„ç‰¹å®šä»»åŠ¡è¿›è¡Œæ¨¡å‹è°ƒæ•´ï¼Œè€Œ Further Pretraining åˆ™æ˜¯ä½¿æ¨¡å‹æ›´å¥½åœ°é€‚åº”ç‰¹å®šé¢†åŸŸæˆ–è¯­è¨€é£æ ¼ã€‚</li><li><strong>æ•°æ®é›†</strong>ï¼šFine-tuning ä½¿ç”¨ç‰¹å®šä»»åŠ¡çš„æ ‡æ³¨æ•°æ®é›†ã€‚Further Pretraining ä½¿ç”¨æ›´å¤§çš„ã€ç‰¹å®šé¢†åŸŸçš„æ•°æ®é›†ï¼Œè¿™äº›æ•°æ®é›†å¯èƒ½ä¸æ˜¯ä¸ºç‰¹å®šä»»åŠ¡æ ‡æ³¨çš„ã€‚</li><li><strong>è®­ç»ƒç›®æ ‡</strong>ï¼šFine-tuning æ¶‰åŠè°ƒæ•´æ¨¡å‹è¿›è¡Œç‰¹å®šé¢„æµ‹ï¼Œè€Œ Further Pretraining ä¾§é‡äºåœ¨æ–°é¢†åŸŸä¸­çš„é€šç”¨è¯­è¨€ç†è§£</li></ul><p>ã€‚</p><h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>Fine-tuning å’Œ Further Pretraining éƒ½æ˜¯ NLP é¢†åŸŸçš„å¼ºå¤§æŠ€æœ¯ã€‚é€šè¿‡ç†è§£å®ƒä»¬çš„åŒºåˆ«å’Œåº”ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥æ›´å¥½åœ°åˆ©ç”¨å¤§å‹è¯­è¨€æ¨¡å‹æ¥è§£å†³å„ç§é¢†åŸŸä¸­çš„å¤šæ ·åŒ–å’Œå¤æ‚ä»»åŠ¡ã€‚æ— è®ºä½ æ˜¯åœ¨æ„å»ºç¤¾äº¤åª’ä½“å¸–å­çš„æƒ…æ„Ÿåˆ†ææ¨¡å‹ï¼Œè¿˜æ˜¯è°ƒæ•´æ¨¡å‹ä»¥ç†è§£æ³•å¾‹æ–‡æ¡£ï¼Œè¿™äº›æŠ€æœ¯éƒ½ä¸º NLP é¢†åŸŸçš„ä¸æ–­å‘å±•æä¾›äº†ç¨³å¥çš„è§£å†³æ–¹æ¡ˆã€‚</p><hr><p><strong>æ³¨æ„</strong>ï¼šæä¾›çš„ä»£ç ç¤ºä¾‹æ˜¯æ¦‚å¿µæ€§çš„ï¼Œéœ€è¦é€‚å½“çš„ç¯å¢ƒè®¾ç½®ï¼ŒåŒ…æ‹¬å¿…è¦çš„åº“å’Œæ•°æ®é›†ï¼Œæ‰èƒ½æ‰§è¡Œã€‚</p>]]></content>
      
      
      <categories>
          
          <category> NLP Insights </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LLM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Understanding the Differences Between Fine-tuning and Further Pretraining in Large Language Models</title>
      <link href="/2024/02/19/NLP%20Insights/Understanding%20the%20Differences%20Between%20Fine-tuning%20and%20Further%20Pretraining%20in%20Large%20Language%20Models/"/>
      <url>/2024/02/19/NLP%20Insights/Understanding%20the%20Differences%20Between%20Fine-tuning%20and%20Further%20Pretraining%20in%20Large%20Language%20Models/</url>
      
        <content type="html"><![CDATA[<h1 id="Understanding-the-Differences-Between-Fine-tuning-and-Further-Pretraining-in-Large-Language-Models"><a href="#Understanding-the-Differences-Between-Fine-tuning-and-Further-Pretraining-in-Large-Language-Models" class="headerlink" title="Understanding the Differences Between Fine-tuning and Further Pretraining in Large Language Models"></a>Understanding the Differences Between Fine-tuning and Further Pretraining in Large Language Models</h1><p>In the world of Natural Language Processing (NLP), the advent of large language models like GPT and BERT has revolutionized how we approach tasks such as text classification, sentiment analysis, and question-answering. Two pivotal techniques in leveraging these models are Fine-tuning and Further Pretraining. While they may seem similar at a glance, they cater to different needs and scenarios in the NLP pipeline.</p><h2 id="What-is-Fine-tuning"><a href="#What-is-Fine-tuning" class="headerlink" title="What is Fine-tuning?"></a>What is Fine-tuning?</h2><p>Fine-tuning is a process where a pretrained model is further trained (or â€˜fine-tunedâ€™) on a specific task with a dataset corresponding to that task. This approach is particularly effective when the dataset is relatively small but well-labeled.</p><h3 id="Example-Scenario-Sentiment-Analysis"><a href="#Example-Scenario-Sentiment-Analysis" class="headerlink" title="Example Scenario: Sentiment Analysis"></a>Example Scenario: Sentiment Analysis</h3><p>Imagine you have a dataset of movie reviews, each labeled as positive or negative. You want to create a model that can predict the sentiment of a review.</p><h4 id="Code-Snippet-in-Python-using-PyTorch-and-HuggingFaceâ€™s-Transformers"><a href="#Code-Snippet-in-Python-using-PyTorch-and-HuggingFaceâ€™s-Transformers" class="headerlink" title="Code Snippet in Python (using PyTorch and HuggingFaceâ€™s Transformers)"></a>Code Snippet in Python (using PyTorch and HuggingFaceâ€™s Transformers)</h4><p>This notebook demonstrates the fine-tuning of a BERT model on the IMDB dataset for sentiment analysis. For detailed code implementation, please refer to the following link:<a href="https://colab.research.google.com/drive/15naxP8pNMoCCBMgMSOv4ETDRGL46YR38?usp=sharing">link</a>.</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line">ls -al ~/.ssh</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> (</span><br><span class="line">    BertTokenizer,</span><br><span class="line">    BertForSequenceClassification,</span><br><span class="line">    Trainer,</span><br><span class="line">    TrainingArguments,</span><br><span class="line">)</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> datasets <span class="keyword">import</span> load_dataset, DatasetDict</span><br><span class="line"></span><br><span class="line"><span class="string">"""## 1. Load and Prepare IMDB Dataset Samples</span></span><br><span class="line"><span class="string">Select a portion of the data for Fine-tuning.</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Load IMDB dataset</span></span><br><span class="line">dataset = load_dataset(<span class="string">'imdb'</span>, split=<span class="string">'train'</span>)</span><br><span class="line">small_dataset = dataset.shuffle(seed=<span class="number">42</span>).select(<span class="built_in">range</span>(<span class="number">10000</span>))  <span class="comment"># Selecting the first 10,000 samples</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Initialize tokenizer</span></span><br><span class="line">tokenizer = BertTokenizer.from_pretrained(<span class="string">"bert-base-uncased"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Encode the dataset</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encode</span>(<span class="params">examples</span>):</span><br><span class="line">    <span class="keyword">return</span> tokenizer(examples[<span class="string">"text"</span>], padding=<span class="string">"max_length"</span>, truncation=<span class="literal">True</span>, max_length=<span class="number">512</span>)</span><br><span class="line"></span><br><span class="line">encoded_small_dataset = small_dataset.<span class="built_in">map</span>(encode, batched=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> BertModel</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">visualize_attention</span>(<span class="params">sentence, model, tokenizer</span>):</span><br><span class="line">    <span class="comment"># Set the model to evaluation mode</span></span><br><span class="line">    model.<span class="built_in">eval</span>()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Convert the input text into a format understandable by the model</span></span><br><span class="line">    inputs = tokenizer(sentence, return_tensors=<span class="string">"pt"</span>).to(device) <span class="comment"># Making sure inputs are on the same device</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Get attention weights using the model</span></span><br><span class="line">    <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">        outputs = model(**inputs)</span><br><span class="line">    attentions = outputs.attentions</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Choose the layer and head to visualize</span></span><br><span class="line">    layer = <span class="number">5</span></span><br><span class="line">    head = <span class="number">1</span></span><br><span class="line">    attention = attentions[layer][<span class="number">0</span>, head].cpu().numpy() <span class="comment"># Move attention weights back to CPU for visualization</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Set tokens for visualization</span></span><br><span class="line">    tokens = tokenizer.convert_ids_to_tokens(inputs[<span class="string">"input_ids"</span>][<span class="number">0</span>].cpu()) <span class="comment"># Also make sure tokens are on CPU</span></span><br><span class="line">    <span class="comment"># Plot attention matrix</span></span><br><span class="line">    plt.figure(figsize=(<span class="number">10</span>, <span class="number">10</span>))</span><br><span class="line">    plt.matshow(attention, cmap=<span class="string">'viridis'</span>)</span><br><span class="line">    plt.xticks(<span class="built_in">range</span>(<span class="built_in">len</span>(tokens)), tokens, rotation=<span class="number">90</span>)</span><br><span class="line">    plt.yticks(<span class="built_in">range</span>(<span class="built_in">len</span>(tokens)), tokens)</span><br><span class="line">    plt.colorbar()</span><br><span class="line">    plt.show()</span><br><span class="line"></span><br><span class="line"><span class="string">"""## 2. Visualize Attention Weights of a Sample Sentence (Before Fine-tuning)</span></span><br><span class="line"><span class="string">Select a sentence from the dataset and visualize the attention weights of the original BERT model.</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Use the model without Fine-tuning</span></span><br><span class="line">model = BertModel.from_pretrained(<span class="string">"bert-base-uncased"</span>, output_attentions=<span class="literal">True</span>)</span><br><span class="line">sample_sentence = <span class="string">"I love this movie, it's fantastic!"</span></span><br><span class="line">visualize_attention(sample_sentence, model, tokenizer)</span><br><span class="line"></span><br><span class="line"><span class="string">"""## 3. Fine-tuning the BERT Model</span></span><br><span class="line"><span class="string">Perform Fine-tuning on the selected IMDB samples.</span></span><br><span class="line"><span class="string">### 3.1 Prepare Data Loaders</span></span><br><span class="line"><span class="string">To train the model, we need to create PyTorch's DataLoader. This will allow us to efficiently load data during training.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">### 3.2 Set up Fine-tuning Environment</span></span><br><span class="line"><span class="string">Initialize the model, optimizer, and loss function.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">### 3.3 Fine-tuning the Model</span></span><br><span class="line"><span class="string">Execute the training loop for Fine-tuning. Running the above code will Fine-tune the BERT model on a small sample of the IMDB dataset. This may take some time depending on your hardware configuration.</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> torch.utils.data <span class="keyword">import</span> DataLoader</span><br><span class="line"></span><br><span class="line"><span class="comment"># Convert the dataset to PyTorch Tensor</span></span><br><span class="line">encoded_small_dataset.set_format(<span class="string">'torch'</span>, columns=[<span class="string">'input_ids'</span>, <span class="string">'attention_mask'</span>, <span class="string">'label'</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create data loader</span></span><br><span class="line">train_loader = DataLoader(encoded_small_dataset, batch_size=<span class="number">8</span>, shuffle=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> BertConfig, BertForSequenceClassification</span><br><span class="line"><span class="keyword">import</span> torch.optim <span class="keyword">as</span> optim</span><br><span class="line"></span><br><span class="line"><span class="comment"># Load the configuration and set output attention weights</span></span><br><span class="line">config = BertConfig.from_pretrained(<span class="string">"bert-base-uncased"</span>, output_attentions=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Initialize the BERT model for sequence classification</span></span><br><span class="line"><span class="comment"># Load the model with updated configuration</span></span><br><span class="line">model = BertForSequenceClassification.from_pretrained(<span class="string">"bert-base-uncased"</span>, config=config)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set up the optimizer</span></span><br><span class="line">optimizer = optim.AdamW(model.parameters(), lr=<span class="number">5e-5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Use the cross-entropy loss function</span></span><br><span class="line">criterion = torch.nn.CrossEntropyLoss()</span><br><span class="line"></span><br><span class="line">device = <span class="string">"cuda"</span> <span class="keyword">if</span> torch.cuda.is_available() <span class="keyword">else</span> <span class="string">"cpu"</span></span><br><span class="line">model.to(device)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Set the number of epochs for training</span></span><br><span class="line">epochs = <span class="number">8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(epochs):</span><br><span class="line">    model.train()</span><br><span class="line">    total_loss = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> batch <span class="keyword">in</span> train_loader:</span><br><span class="line">        <span class="comment"># Move the data to GPU</span></span><br><span class="line">        input_ids = batch[<span class="string">'input_ids'</span>].to(device)</span><br><span class="line">        attention_mask = batch[<span class="string">'attention_mask'</span>].to(device)</span><br><span class="line">        labels = batch[<span class="string">'label'</span>].to(device)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Model forward pass</span></span><br><span class="line">        outputs = model(input_ids, attention_mask=attention_mask)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Compute the loss</span></span><br><span class="line">        loss = criterion(outputs.logits, labels)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Backpropagation and optimization</span></span><br><span class="line">        optimizer.zero_grad()</span><br><span class="line">        loss.backward()</span><br><span class="line">        optimizer.step()</span><br><span class="line"></span><br><span class="line">        total_loss += loss.item()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"Epoch: <span class="subst">{epoch+<span class="number">1</span>}</span>, Loss: <span class="subst">{total_loss/<span class="built_in">len</span>(train_loader)}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">"""### 4. Visualize Attention Weights of the Same Sentence (After Fine-tuning)</span></span><br><span class="line"><span class="string">Visualize the attention weights of the same sentence using the model after Fine-tuning. You can reuse the visualize_attention function provided earlier:</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line">visualize_attention(sample_sentence, model, tokenizer)</span><br></pre></td></tr></tbody></table></figure><p>In this example, the BERT model is fine-tuned on the movie reviews dataset for sentiment analysis.</p><h2 id="What-is-Further-Pretraining"><a href="#What-is-Further-Pretraining" class="headerlink" title="What is Further Pretraining?"></a>What is Further Pretraining?</h2><p>Further Pretraining, also known as Domain-adaptive Pretraining, is where a pretrained model is further trained on a new dataset that is more closely related to the specific domain of interest but not necessarily labeled for a specific task.</p><h3 id="Example-Scenario-Legal-Document-Analysis"><a href="#Example-Scenario-Legal-Document-Analysis" class="headerlink" title="Example Scenario: Legal Document Analysis"></a>Example Scenario: Legal Document Analysis</h3><p>Suppose youâ€™re working on legal documents and wish to leverage a language model trained on general texts.</p><h4 id="Code-Snippet-for-Further-Pretraining"><a href="#Code-Snippet-for-Further-Pretraining" class="headerlink" title="Code Snippet for Further Pretraining"></a>Code Snippet for Further Pretraining</h4><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> BertModel, BertTokenizer</span><br><span class="line"></span><br><span class="line"><span class="comment"># Load a pre-trained BERT model and tokenizer</span></span><br><span class="line">model = BertModel.from_pretrained(<span class="string">'bert-base-uncased'</span>)</span><br><span class="line">tokenizer = BertTokenizer.from_pretrained(<span class="string">'bert-base-uncased'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Prepare the legal documents dataset</span></span><br><span class="line"><span class="comment"># Assume 'legal_documents' is a list of text from legal documents</span></span><br><span class="line">encoded_input = tokenizer(legal_documents, padding=<span class="literal">True</span>, truncation=<span class="literal">True</span>, max_length=<span class="number">512</span>, return_tensors=<span class="string">'pt'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Further pretrain the model</span></span><br><span class="line"><span class="comment"># This step typically involves masked language modeling or other pretraining objectives</span></span><br><span class="line"><span class="comment"># Here we provide a conceptual example</span></span><br><span class="line">model.train()</span><br><span class="line"><span class="keyword">for</span> batch <span class="keyword">in</span> encoded_input:</span><br><span class="line">    outputs = model(**batch)</span><br><span class="line">    <span class="comment"># ... Perform further training steps</span></span><br></pre></td></tr></tbody></table></figure><p>In this case, the BERT model is further pretrained on a legal document dataset, making it more adept at understanding legal jargon and concepts before being fine-tuned on a specific legal NLP task.</p><h2 id="Key-Differences"><a href="#Key-Differences" class="headerlink" title="Key Differences"></a>Key Differences</h2><ul><li><strong>Purpose</strong>: Fine-tuning is tailored for a specific task with labeled data, while Further Pretraining is about adapting the model to a specific domain or style of language.</li><li><strong>Dataset</strong>: Fine-tuning uses task-specific, labeled datasets. Further Pretraining uses larger, domain-specific datasets, which may not be labeled for a specific task.</li><li><strong>Training Objective</strong>: Fine-tuning involves adjusting the model to make specific predictions, while Further Pretraining focuses on general language understanding in a new domain.</li></ul><h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>Both Fine-tuning and Further Pretraining are powerful techniques in NLP. By understanding their differences and applications, we can better leverage large language models to solve diverse and complex tasks in various domains. Whether youâ€™re building a sentiment analysis model for social media posts or adapting a model to understand legal documents, these techniques offer robust solutions in the ever-evolving field of NLP.</p><hr><p><strong>Note</strong>: The code examples provided are conceptual and require a suitable environment setup, including necessary libraries and datasets, for execution.</p>]]></content>
      
      
      <categories>
          
          <category> NLP Insights </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LLM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ğŸ¤– Create a Telegram Bot with Python and OpenAI in 10 Minutes! ğŸš€</title>
      <link href="/2023/09/24/NLP%20Insights/Create%20a%20Telegram%20Bot%20with%20Python%20and%20OpenAI%20in%2010%20Minutes/"/>
      <url>/2023/09/24/NLP%20Insights/Create%20a%20Telegram%20Bot%20with%20Python%20and%20OpenAI%20in%2010%20Minutes/</url>
      
        <content type="html"><![CDATA[<h1 id="ğŸ¤–-Create-a-Telegram-Bot-with-Python-and-OpenAI-in-10-Minutes-ğŸš€"><a href="#ğŸ¤–-Create-a-Telegram-Bot-with-Python-and-OpenAI-in-10-Minutes-ğŸš€" class="headerlink" title="ğŸ¤– Create a Telegram Bot with Python and OpenAI in 10 Minutes! ğŸš€"></a>ğŸ¤– Create a Telegram Bot with Python and OpenAI in 10 Minutes! ğŸš€</h1><p>In this fun tutorial, weâ€™ll show you how to create a Telegram bot that can chat with users and generate witty responses. Weâ€™ll explain each step in detail, making it easy for you to get started!</p><h2 id="Step-1-Create-a-Telegram-Bot-ğŸ¤–"><a href="#Step-1-Create-a-Telegram-Bot-ğŸ¤–" class="headerlink" title="Step 1: Create a Telegram Bot ğŸ¤–"></a>Step 1: Create a Telegram Bot ğŸ¤–</h2><p>First, letâ€™s create your very own Telegram bot. Hereâ€™s how:</p><ol><li>Open the Telegram app and search for â€œBotFather.â€</li><li>In the BotFather chat, use the <code>/newbot</code> command to create a new bot. Youâ€™ll need to give your bot a name, like â€œPunshineBot.â€</li><li>BotFather will generate a unique API token for you. Be sure to save this token; weâ€™ll use it in the code later.</li></ol><img src="/2023/09/24/NLP%20Insights/Create%20a%20Telegram%20Bot%20with%20Python%20and%20OpenAI%20in%2010%20Minutes/step1.jpg" class=""><h2 id="Step-2-Import-Necessary-Libraries-ğŸ“š"><a href="#Step-2-Import-Necessary-Libraries-ğŸ“š" class="headerlink" title="Step 2: Import Necessary Libraries ğŸ“š"></a>Step 2: Import Necessary Libraries ğŸ“š</h2><p>Weâ€™ll first need to import some Python libraries to create the Telegram bot and perform natural language processing with OpenAI.</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Final, Deque, <span class="type">Dict</span>, <span class="type">Union</span></span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> deque</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> openai</span><br><span class="line"><span class="keyword">from</span> telegram <span class="keyword">import</span> Update</span><br><span class="line"><span class="keyword">from</span> telegram.ext <span class="keyword">import</span> (</span><br><span class="line">    Application,</span><br><span class="line">    CommandHandler,</span><br><span class="line">    ContextTypes,</span><br><span class="line">    MessageHandler,</span><br><span class="line">    filters,</span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure><p>Make sure you have the Telegram Bot API and OpenAI Python library installed.</p><h2 id="Step-3-Set-API-Keys-and-Telegram-Token-ğŸ”‘"><a href="#Step-3-Set-API-Keys-and-Telegram-Token-ğŸ”‘" class="headerlink" title="Step 3: Set API Keys and Telegram Token ğŸ”‘"></a>Step 3: Set API Keys and Telegram Token ğŸ”‘</h2><p>In this step, we need to set the OpenAI API key and Telegram bot token. Make sure youâ€™ve signed up for OpenAI and obtained your API key. Then, replace the example API key and Telegram token in the following code with your own:</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">openai.api_key = <span class="string">"Your OpenAI API Key"</span></span><br><span class="line">TOKEN: Final = <span class="string">"Your Telegram Bot Token"</span></span><br></pre></td></tr></tbody></table></figure><h2 id="Step-4-Create-Start-and-Help-Commands-ğŸš€"><a href="#Step-4-Create-Start-and-Help-Commands-ğŸš€" class="headerlink" title="Step 4: Create Start and Help Commands ğŸš€"></a>Step 4: Create Start and Help Commands ğŸš€</h2><p>Next, weâ€™ll create two command handling functions for the start and help commands. These commands allow users to interact with the bot.</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">start_command</span>(<span class="params">update: Update, context: ContextTypes.DEFAULT_TYPE</span>):</span><br><span class="line">    <span class="keyword">await</span> update.message.reply_text(<span class="string">"Hello, world! ğŸ˜„"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">help_command</span>(<span class="params">update: Update, context: ContextTypes.DEFAULT_TYPE</span>):</span><br><span class="line">    <span class="keyword">await</span> update.message.reply_text(<span class="string">"I'm PunShine Bot, and I can help you find the funniest puns! ğŸ˜‚"</span>)</span><br></pre></td></tr></tbody></table></figure><p>The <code>start_command</code> function handles the start command, responding with â€œHello, world! ğŸ˜„â€ when users send the <code>/start</code> command. The <code>help_command</code> function handles the help command, providing assistance when users send the <code>/help</code> command.</p><h2 id="Step-5-Handle-User-Messages-ğŸ“¨"><a href="#Step-5-Handle-User-Messages-ğŸ“¨" class="headerlink" title="Step 5: Handle User Messages ğŸ“¨"></a>Step 5: Handle User Messages ğŸ“¨</h2><p>In this step, we define the <code>handle_response</code> function to process user messages and create the <code>message_handler</code>. The function adds user messages to the conversation history and uses the OpenAI API to generate responses.</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">handle_response</span>(<span class="params">chat_id: <span class="type">Union</span>[<span class="built_in">int</span>, <span class="built_in">str</span>], text: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="comment"># Get the chat history</span></span><br><span class="line">    chat_history = get_chat_history(chat_id)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Create a user message</span></span><br><span class="line">    user_message = {<span class="string">"role"</span>: <span class="string">"user"</span>, <span class="string">"content"</span>: text}</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Add the user message to the chat history</span></span><br><span class="line">    chat_history.append(user_message)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Build a message list, including a system message and user messages</span></span><br><span class="line">    messages = [</span><br><span class="line">        {</span><br><span class="line">            <span class="string">"role"</span>: <span class="string">"system"</span>,</span><br><span class="line">            <span class="string">"content"</span>: <span class="string">"You are PunshineBot, reply in English, keep it casual, use emojis, and keep responses short. ğŸ˜„ğŸš€"</span>,</span><br><span class="line">        }</span><br><span class="line">    ]</span><br><span class="line">    messages.extend(chat_history)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Use the OpenAI API to generate the bot's response</span></span><br><span class="line">    response = openai.ChatCompletion.create(</span><br><span class="line">        model=<span class="string">"gpt-3.5-turbo"</span>,</span><br><span class="line">        messages=messages,</span><br><span class="line">        temperature=<span class="number">1</span>,</span><br><span class="line">        max_tokens=<span class="number">256</span>,</span><br><span class="line">        top_p=<span class="number">1</span>,</span><br><span class="line">        frequency_penalty=<span class="number">0</span>,</span><br><span class="line">        presence_penalty=<span class="number">0</span>,</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    bot_response = response[<span class="string">"choices"</span>][<span class="number">0</span>][<span class="string">"message"</span>][<span class="string">"content"</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Add the bot's response to the conversation history</span></span><br><span class="line">    chat_history.append({<span class="string">"role"</span>: <span class="string">"assistant"</span>, <span class="string">"content"</span>: bot_response})</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> bot_response</span><br></pre></td></tr></tbody></table></figure><p>The <code>handle_response</code> function adds user messages to the conversation history and generates the botâ€™s response using the OpenAI API. The <code>message_handler</code> function processes messages sent by users, checking their type (group message or private chat) and content, and then calls the <code>handle_response</code> function to generate the botâ€™s response.</p><h2 id="Step-6-Run-the-Telegram-Bot-ğŸš€"><a href="#Step-6-Run-the-Telegram-Bot-ğŸš€" class="headerlink" title="Step 6: Run the Telegram Bot ğŸš€"></a>Step 6: Run the Telegram Bot ğŸš€</h2><p>Finally, in the main function, we create a Telegram bot application, add command handlers and message handlers, and start the Telegram bot to receive and process messages.</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    app = Application.builder().token(TOKEN).build()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Add command handlers</span></span><br><span class="line">    app.add_handler(CommandHandler(<span class="string">"start"</span>, start_command))</span><br><span class="line">    app.add_handler(CommandHandler(<span class="string">"help"</span>, help_command))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Add message handler</span></span><br><span class="line">    app.add_handler(MessageHandler(filters.TEXT, callback=message_handler))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Start the Telegram bot</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Bot started! ğŸ˜ğŸ¤–"</span>)</span><br><span class="line">    app.run_polling(poll_interval=<span class="number">1</span>)</span><br></pre></td></tr></tbody></table></figure><p><code>app.run_polling(poll_interval=1)</code> starts the Telegram bot, polling for new messages every second. This keeps the bot running and triggers the respective handlers when it receives messages.</p><img src="/2023/09/24/NLP%20Insights/Create%20a%20Telegram%20Bot%20with%20Python%20and%20OpenAI%20in%2010%20Minutes/step6_en.jpg" class=""><h2 id="Step-7-Host-Your-Telegram-Bot-Online-for-Free-24-x2F-7-ğŸš€"><a href="#Step-7-Host-Your-Telegram-Bot-Online-for-Free-24-x2F-7-ğŸš€" class="headerlink" title="Step 7: Host Your Telegram Bot Online for Free 24/7 ğŸš€"></a>Step 7: Host Your Telegram Bot Online for Free 24/7 ğŸš€</h2><p>In the previous tutorial, we showed you how to create a Telegram bot. However, to keep your bot online 24/7, you would need to leave your computer running, which can be inconvenient. In this blog post, weâ€™ll show you how to host your bot for free on a cloud server so that it can run around the clock.</p><p>PythonAnywhere is a website that allows you to host Python code for free. It comes with some usage limitations, but itâ€™s perfect for simple use cases. Hereâ€™s how to use PythonAnywhere to host your Telegram bot.</p><ol><li>Visit the <a href="https://www.pythonanywhere.com/">PythonAnywhere website</a> and create an account.</li></ol><img src="/2023/09/24/NLP%20Insights/Create%20a%20Telegram%20Bot%20with%20Python%20and%20OpenAI%20in%2010%20Minutes/step7.jpg" class=""><h3 id="Step-7-1-Create-a-Python-Script"><a href="#Step-7-1-Create-a-Python-Script" class="headerlink" title="Step 7.1: Create a Python Script"></a>Step 7.1: Create a Python Script</h3><p>Once youâ€™re logged into the PythonAnywhere dashboard, youâ€™ll see an option called â€œFiles.â€ Click on it and create a new file. Name it â€œtelegram_bot.py.â€ In this file, paste the Telegram bot code you created earlier.</p><h3 id="Step-7-2-Install-Required-Packages"><a href="#Step-7-2-Install-Required-Packages" class="headerlink" title="Step 7.2: Install Required Packages"></a>Step 7.2: Install Required Packages</h3><p>Before running the Telegram bot, we need to install the necessary Python packages. PythonAnywhere provides a command-line interface where you can execute the following commands:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install python-telegram-bot</span><br><span class="line">pip install openai</span><br></pre></td></tr></tbody></table></figure><p>This will install the Telegram bot library, allowing your code to communicate with the Telegram servers.</p><h3 id="Step-7-3-Run-the-Bot"><a href="#Step-7-3-Run-the-Bot" class="headerlink" title="Step 7.3: Run the Bot"></a>Step 7.3: Run the Bot</h3><p>Now, go back to the PythonAnywhere dashboard and find your â€œtelegram_bot.pyâ€ file under â€œFiles.â€ Click the â€œRunâ€ button, and your bot will start running. The bot will stay online even if you close your computer.</p><h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>Youâ€™ve now learned how to create a Python Telegram bot, integrate it with OpenAI to respond to user messages, and host it for free on a cloud server, ensuring it remains online 24/7. This way, you can interact with your bot without worrying about whether your computer is on. If you have other free hosting services or questions, feel free to share in the comments! Happy bot building! ğŸ¤–ğŸš€ğŸ˜„</p><p>Additionally, if you want to learn more about hosting bots on Discord, you can watch this YouTube video: <a href="https://www.youtube.com/watch?v=2TI-tCVhe9k">How To Host Your Bot Online 24/7 For FREE With Python (Telegram, Discord, Etc)</a>. The video provides more detailed tutorials and examples.</p><p>If you have any questions or need further assistance, please donâ€™t hesitate to leave a comment. Happy coding! ğŸš€ğŸ¤–ğŸ˜„</p><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul><li><a href="https://www.youtube.com/watch?v=vZtm1wuA2yc">How To Create A Telegram Bot In Python For Beginners (2023 Tutorial)</a></li><li><a href="https://www.youtube.com/watch?v=2TI-tCVhe9k">How To Host Your Bot Online 24/7 For FREE With Python (Telegram, Discord, Etc)</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Code Chronicles </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Chatbot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ğŸ¤– ååˆ†é’Ÿç”¨ Python å’Œ OpenAI åˆ›å»º Telegram æœºå™¨äººï¼ ğŸš€</title>
      <link href="/2023/09/24/NLP%20Insights/%E5%8D%81%E5%88%86%E9%92%9F%E7%94%A8%20Python%20%E5%92%8C%20OpenAI%20%E5%88%9B%E5%BB%BA%20Telegram%20%E6%9C%BA%E5%99%A8%E4%BA%BA/"/>
      <url>/2023/09/24/NLP%20Insights/%E5%8D%81%E5%88%86%E9%92%9F%E7%94%A8%20Python%20%E5%92%8C%20OpenAI%20%E5%88%9B%E5%BB%BA%20Telegram%20%E6%9C%BA%E5%99%A8%E4%BA%BA/</url>
      
        <content type="html"><![CDATA[<h1 id="ğŸ¤–-ååˆ†é’Ÿç”¨-Python-å’Œ-OpenAI-åˆ›å»º-Telegram-æœºå™¨äººï¼-ğŸš€"><a href="#ğŸ¤–-ååˆ†é’Ÿç”¨-Python-å’Œ-OpenAI-åˆ›å»º-Telegram-æœºå™¨äººï¼-ğŸš€" class="headerlink" title="ğŸ¤– ååˆ†é’Ÿç”¨ Python å’Œ OpenAI åˆ›å»º Telegram æœºå™¨äººï¼ ğŸš€"></a>ğŸ¤– ååˆ†é’Ÿç”¨ Python å’Œ OpenAI åˆ›å»º Telegram æœºå™¨äººï¼ ğŸš€</h1><p>åœ¨è¿™ä¸ªæœ‰è¶£çš„æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•åˆ›å»ºä¸€ä¸ªå…·æœ‰çš„ Telegram æœºå™¨äººï¼Œè¯¥æœºå™¨äººèƒ½å¤Ÿä¸ç”¨æˆ·èŠå¤©å¹¶ç”Ÿæˆå¹½é»˜å›å¤ã€‚æˆ‘ä»¬å°†è¯¦ç»†è§£é‡Šæ¯ä¸€æ­¥ï¼Œè®©æ‚¨è½»æ¾å…¥é—¨ï¼</p><h2 id="æ­¥éª¤-1ï¼šåˆ›å»º-Telegram-æœºå™¨äºº-ğŸ¤–"><a href="#æ­¥éª¤-1ï¼šåˆ›å»º-Telegram-æœºå™¨äºº-ğŸ¤–" class="headerlink" title="æ­¥éª¤ 1ï¼šåˆ›å»º Telegram æœºå™¨äºº ğŸ¤–"></a>æ­¥éª¤ 1ï¼šåˆ›å»º Telegram æœºå™¨äºº ğŸ¤–</h2><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬æ¥åˆ›å»ºæ‚¨è‡ªå·±çš„ Telegram æœºå™¨äººã€‚è¿™æ˜¯å¦‚ä½•åšçš„ï¼š</p><ol><li>æ‰“å¼€ Telegram åº”ç”¨å¹¶æœç´¢ â€œBotFatherâ€ã€‚</li><li>åœ¨ BotFather èŠå¤©ä¸­ï¼Œä½¿ç”¨ <code>/newbot</code> å‘½ä»¤åˆ›å»ºä¸€ä¸ªæ–°æœºå™¨äººã€‚æ‚¨éœ€è¦ä¸ºæœºå™¨äººå–ä¸ªåå­—ï¼Œæ¯”å¦‚ â€œPunshineBotâ€ã€‚</li><li>BotFather ä¼šä¸ºæ‚¨ç”Ÿæˆä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„ API ä»¤ç‰Œï¼ˆTokenï¼‰ã€‚ä¸€å®šè¦å¦¥å–„ä¿å­˜è¿™ä¸ªä»¤ç‰Œï¼Œç¨åæˆ‘ä»¬ä¼šåœ¨ä»£ç ä¸­ç”¨åˆ°å®ƒã€‚</li></ol><img src="/2023/09/24/NLP%20Insights/%E5%8D%81%E5%88%86%E9%92%9F%E7%94%A8%20Python%20%E5%92%8C%20OpenAI%20%E5%88%9B%E5%BB%BA%20Telegram%20%E6%9C%BA%E5%99%A8%E4%BA%BA/step1.jpg" class=""><h2 id="æ­¥éª¤-2ï¼šå¯¼å…¥å¿…è¦çš„åº“-ğŸ“š"><a href="#æ­¥éª¤-2ï¼šå¯¼å…¥å¿…è¦çš„åº“-ğŸ“š" class="headerlink" title="æ­¥éª¤ 2ï¼šå¯¼å…¥å¿…è¦çš„åº“ ğŸ“š"></a>æ­¥éª¤ 2ï¼šå¯¼å…¥å¿…è¦çš„åº“ ğŸ“š</h2><p>æˆ‘ä»¬é¦–å…ˆéœ€è¦å¯¼å…¥ä¸€äº› Python åº“ï¼Œä»¥ä¾¿åˆ›å»º Telegram æœºå™¨äººå¹¶ä¸ OpenAI è¿›è¡Œè‡ªç„¶è¯­è¨€å¤„ç†ã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Final, Deque, <span class="type">Dict</span>, <span class="type">Union</span></span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> deque</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> openai</span><br><span class="line"><span class="keyword">from</span> telegram <span class="keyword">import</span> Update</span><br><span class="line"><span class="keyword">from</span> telegram.ext <span class="keyword">import</span> (</span><br><span class="line">    Application,</span><br><span class="line">    CommandHandler,</span><br><span class="line">    ContextTypes,</span><br><span class="line">    MessageHandler,</span><br><span class="line">    filters,</span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure><p>è¯·ç¡®ä¿æ‚¨å·²ç»å®‰è£…äº† Telegram Bot API å’Œ OpenAI Python åº“ã€‚</p><h2 id="æ­¥éª¤-3ï¼šè®¾ç½®-API-å¯†é’¥å’Œ-Telegram-ä»¤ç‰Œ-ğŸ”‘"><a href="#æ­¥éª¤-3ï¼šè®¾ç½®-API-å¯†é’¥å’Œ-Telegram-ä»¤ç‰Œ-ğŸ”‘" class="headerlink" title="æ­¥éª¤ 3ï¼šè®¾ç½® API å¯†é’¥å’Œ Telegram ä»¤ç‰Œ ğŸ”‘"></a>æ­¥éª¤ 3ï¼šè®¾ç½® API å¯†é’¥å’Œ Telegram ä»¤ç‰Œ ğŸ”‘</h2><p>åœ¨è¿™ä¸€æ­¥ï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½® OpenAI API å¯†é’¥å’Œ Telegram æœºå™¨äººä»¤ç‰Œã€‚ç¡®ä¿æ‚¨å·²ç»æ³¨å†Œäº† OpenAI å¹¶è·å–äº† API å¯†é’¥ã€‚ç„¶åï¼Œå°†ä¸‹é¢çš„ç¤ºä¾‹ä»£ç ä¸­çš„ API å¯†é’¥å’Œ Telegram ä»¤ç‰Œæ›¿æ¢ä¸ºæ‚¨è‡ªå·±çš„ï¼š</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">openai.api_key = <span class="string">"æ‚¨çš„ OpenAI API å¯†é’¥"</span></span><br><span class="line">TOKEN: Final = <span class="string">"æ‚¨çš„ Telegram æœºå™¨äººä»¤ç‰Œ"</span></span><br></pre></td></tr></tbody></table></figure><h2 id="æ­¥éª¤-4ï¼šåˆ›å»ºå¯åŠ¨å’Œå¸®åŠ©å‘½ä»¤-ğŸš€"><a href="#æ­¥éª¤-4ï¼šåˆ›å»ºå¯åŠ¨å’Œå¸®åŠ©å‘½ä»¤-ğŸš€" class="headerlink" title="æ­¥éª¤ 4ï¼šåˆ›å»ºå¯åŠ¨å’Œå¸®åŠ©å‘½ä»¤ ğŸš€"></a>æ­¥éª¤ 4ï¼šåˆ›å»ºå¯åŠ¨å’Œå¸®åŠ©å‘½ä»¤ ğŸš€</h2><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸¤ä¸ªå‘½ä»¤å¤„ç†å‡½æ•°ï¼Œç”¨äºå¤„ç†å¯åŠ¨å’Œå¸®åŠ©å‘½ä»¤ã€‚è¿™äº›å‘½ä»¤å…è®¸ç”¨æˆ·ä¸æœºå™¨äººè¿›è¡Œäº’åŠ¨ã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">start_command</span>(<span class="params">update: Update, context: ContextTypes.DEFAULT_TYPE</span>):</span><br><span class="line">    <span class="keyword">await</span> update.message.reply_text(<span class="string">"ä½ å¥½ä¸–ç•Œ! ğŸ˜„"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">help_command</span>(<span class="params">update: Update, context: ContextTypes.DEFAULT_TYPE</span>):</span><br><span class="line">    <span class="keyword">await</span> update.message.reply_text(<span class="string">"æˆ‘æ˜¯ PunShine Botï¼Œæˆ‘å¯ä»¥å¸®ä½ æ‰¾åˆ°æœ€æç¬‘çš„åŒå…³è¯­ï¼ ğŸ˜‚"</span>)</span><br></pre></td></tr></tbody></table></figure><p><code>start_command</code> å‡½æ•°ç”¨äºå¤„ç†å¯åŠ¨å‘½ä»¤ï¼Œå½“ç”¨æˆ·å‘é€ <code>/start</code> å‘½ä»¤æ—¶ï¼Œæœºå™¨äººå°†å›å¤ â€œä½ å¥½ä¸–ç•Œ! ğŸ˜„â€ã€‚<code>help_command</code> å‡½æ•°ç”¨äºå¤„ç†å¸®åŠ©å‘½ä»¤ï¼Œå½“ç”¨æˆ·å‘é€ <code>/help</code> å‘½ä»¤æ—¶ï¼Œæœºå™¨äººå°†å›å¤å¸®åŠ©ä¿¡æ¯ã€‚</p><h2 id="æ­¥éª¤-5ï¼šå¤„ç†ç”¨æˆ·æ¶ˆæ¯-ğŸ“¨"><a href="#æ­¥éª¤-5ï¼šå¤„ç†ç”¨æˆ·æ¶ˆæ¯-ğŸ“¨" class="headerlink" title="æ­¥éª¤ 5ï¼šå¤„ç†ç”¨æˆ·æ¶ˆæ¯ ğŸ“¨"></a>æ­¥éª¤ 5ï¼šå¤„ç†ç”¨æˆ·æ¶ˆæ¯ ğŸ“¨</h2><p>åœ¨è¿™ä¸€æ­¥ï¼Œæˆ‘ä»¬å®šä¹‰äº†å¤„ç†ç”¨æˆ·æ¶ˆæ¯çš„ <code>handle_response</code> å‡½æ•°ï¼Œå¹¶åˆ›å»ºäº†æ¶ˆæ¯å¤„ç†ç¨‹åº <code>message_handler</code>ã€‚è¿™ä¸ªå‡½æ•°å°†ç”¨æˆ·çš„æ¶ˆæ¯æ·»åŠ åˆ°å¯¹è¯å†å²è®°å½•ä¸­ï¼Œå¹¶ä½¿ç”¨ OpenAI API ç”Ÿæˆæœºå™¨äººçš„å›å¤ã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">handle_response</span>(<span class="params">chat_id: <span class="type">Union</span>[<span class="built_in">int</span>, <span class="built_in">str</span>], text: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="comment"># è·å–èŠå¤©å†å²è®°å½•</span></span><br><span class="line">    chat_history = get_chat_history(chat_id)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># åˆ›å»ºç”¨æˆ·æ¶ˆæ¯</span></span><br><span class="line">    user_message = {<span class="string">"role"</span>: <span class="string">"user"</span>, <span class="string">"content"</span>: text}</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å°†ç”¨æˆ·æ¶ˆæ¯æ·»åŠ åˆ°èŠå¤©å†å²è®°å½•</span></span><br><span class="line">    chat_history.append(user_message)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ„å»ºæ¶ˆæ¯åˆ—è¡¨ï¼ŒåŒ…æ‹¬ç³»ç»Ÿæ¶ˆæ¯å’Œç”¨æˆ·æ¶ˆæ¯</span></span><br><span class="line">    messages = [</span><br><span class="line">        {</span><br><span class="line">            <span class="string">"role"</span>: <span class="string">"system"</span>,</span><br><span class="line">            <span class="string">"content"</span>: <span class="string">"ä½ æ˜¯ PunshineBotï¼Œç”¨ä¸­æ–‡å›ç­”ï¼Œè¯­æ°”éšæ„ï¼Œåˆ«å¤ªæ­£å¼ï¼Œå¤šç”¨ emojiï¼Œå›å¤è¦ç®€çŸ­ä¸€ç‚¹ã€‚ ğŸ˜„ğŸš€"</span>,</span><br><span class="line">        }</span><br><span class="line">    ]</span><br><span class="line">    messages.extend(chat_history)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># ä½¿ç”¨ OpenAI API ç”Ÿæˆæœºå™¨äººçš„å›å¤</span></span><br><span class="line">    response = openai.ChatCompletion.create(</span><br><span class="line">        model=<span class="string">"gpt-3.5-turbo"</span>,</span><br><span class="line">        messages=messages,</span><br><span class="line">        temperature=<span class="number">1</span>,</span><br><span class="line">        max_tokens=<span class="number">256</span>,</span><br><span class="line">        top_p=<span class="number">1</span>,</span><br><span class="line">        frequency_penalty=<span class="number">0</span>,</span><br><span class="line">        presence_penalty=<span class="number">0</span>,</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    bot_response = response[<span class="string">"choices"</span>][<span class="number">0</span>][<span class="string">"message"</span>][<span class="string">"content"</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å°†æœºå™¨äººçš„å›å¤æ·»åŠ åˆ°å¯¹è¯å†å²è®°å½•</span></span><br><span class="line">    chat_history.append({<span class="string">"role"</span>: <span class="string">"assistant"</span>, <span class="string">"content"</span>: bot_response})</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> bot_response</span><br></pre></td></tr></tbody></table></figure><p><code>handle_response</code> å‡½æ•°å°†ç”¨æˆ·æ¶ˆæ¯æ·»åŠ åˆ°å¯¹è¯å†å²è®°å½•ä¸­ï¼Œç„¶åä½¿ç”¨ OpenAI API ç”Ÿæˆæœºå™¨äººçš„å›å¤ï¼Œå¹¶å°†æœºå™¨äººçš„å›å¤æ·»åŠ åˆ°å¯¹è¯å†å²è®°å½•ä¸­ï¼Œä»¥ä¿æŒä¸Šä¸‹æ–‡ã€‚</p><p><code>message_handler</code> å‡½æ•°ç”¨äºå¤„ç†ç”¨æˆ·å‘é€çš„æ¶ˆæ¯ã€‚å®ƒæ£€æŸ¥æ¶ˆæ¯çš„ç±»å‹ï¼ˆç¾¤ç»„æ¶ˆæ¯æˆ–ç§èŠæ¶ˆæ¯ï¼‰ä»¥åŠæ¶ˆæ¯çš„å†…å®¹ï¼Œç„¶åè°ƒç”¨ <code>handle_response</code> å‡½æ•°ç”Ÿæˆæœºå™¨äººçš„å›å¤ã€‚</p><h2 id="æ­¥éª¤-6ï¼šè¿è¡Œ-Telegram-æœºå™¨äºº-ğŸš€"><a href="#æ­¥éª¤-6ï¼šè¿è¡Œ-Telegram-æœºå™¨äºº-ğŸš€" class="headerlink" title="æ­¥éª¤ 6ï¼šè¿è¡Œ Telegram æœºå™¨äºº ğŸš€"></a>æ­¥éª¤ 6ï¼šè¿è¡Œ Telegram æœºå™¨äºº ğŸš€</h2><p>æœ€åï¼Œåœ¨ä¸»å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª Telegram æœºå™¨äººåº”ç”¨ç¨‹åºï¼Œå¹¶æ·»åŠ äº†å‘½ä»¤å¤„ç†ç¨‹åºå’Œæ¶ˆæ¯å¤„ç†ç¨‹åºã€‚ç„¶åï¼Œæˆ‘ä»¬å¯åŠ¨äº† Telegram æœºå™¨äººï¼Œä½¿å…¶å¯ä»¥æ¥æ”¶å’Œå¤„ç†æ¶ˆæ¯ã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    app = Application.builder().token(TOKEN).build()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ·»åŠ å‘½ä»¤å¤„ç†ç¨‹åº</span></span><br><span class="line">    app.add_handler(CommandHandler(<span class="string">"start"</span>, start_command))</span><br><span class="line">    app.add_handler(CommandHandler(<span class="string">"help"</span>, help_command))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ·»åŠ æ¶ˆæ¯å¤„ç†ç¨‹åº</span></span><br><span class="line">    app.add_handler(MessageHandler(filters.TEXT, callback=message_handler))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¯åŠ¨ Telegram æœºå™¨äºº</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"æœºå™¨äººå·²å¯åŠ¨ï¼ ğŸ˜ğŸ¤–"</span>)</span><br><span class="line">    app.run_polling(poll_interval=<span class="number">1</span>)</span><br></pre></td></tr></tbody></table></figure><img src="/2023/09/24/NLP%20Insights/%E5%8D%81%E5%88%86%E9%92%9F%E7%94%A8%20Python%20%E5%92%8C%20OpenAI%20%E5%88%9B%E5%BB%BA%20Telegram%20%E6%9C%BA%E5%99%A8%E4%BA%BA/step6_zh.jpg" class=""><p><code>app.run_polling(poll_interval=1)</code> å¯åŠ¨äº† Telegram æœºå™¨äººï¼Œä»¥æ¯ç§’çš„é—´éš”è½®è¯¢æ–°æ¶ˆæ¯ã€‚è¿™æ„å‘³ç€æœºå™¨äººä¼šä¸€ç›´è¿è¡Œï¼Œå¹¶åœ¨æ¥æ”¶åˆ°æ¶ˆæ¯æ—¶è§¦å‘ç›¸åº”çš„å¤„ç†ç¨‹åºã€‚</p><h2 id="æ­¥éª¤-7ï¼šå…è´¹åœ¨çº¿æ‰˜ç®¡æ‚¨çš„-Telegram-æœºå™¨äºº-24-x2F-7-ğŸš€"><a href="#æ­¥éª¤-7ï¼šå…è´¹åœ¨çº¿æ‰˜ç®¡æ‚¨çš„-Telegram-æœºå™¨äºº-24-x2F-7-ğŸš€" class="headerlink" title="æ­¥éª¤ 7ï¼šå…è´¹åœ¨çº¿æ‰˜ç®¡æ‚¨çš„ Telegram æœºå™¨äºº 24/7 ğŸš€"></a>æ­¥éª¤ 7ï¼šå…è´¹åœ¨çº¿æ‰˜ç®¡æ‚¨çš„ Telegram æœºå™¨äºº 24/7 ğŸš€</h2><p>åœ¨ä¹‹å‰çš„æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬æ•™æ‚¨å¦‚ä½•åˆ›å»ºä¸€ä¸ª Telegram æœºå™¨äººã€‚ä½†æ˜¯ï¼Œè¦ä½¿æ‚¨çš„æœºå™¨äººä¸€ç›´åœ¨çº¿è¿è¡Œï¼Œæ‚¨éœ€è¦è®©æ‚¨çš„è®¡ç®—æœºä¿æŒå¼€å¯ï¼Œè¿™å¯èƒ½ä¸å¤ªæ–¹ä¾¿ã€‚åœ¨è¿™ç¯‡åšå®¢ä¸­ï¼Œæˆ‘ä»¬å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•å°†æ‚¨çš„æœºå™¨äººå…è´¹æ‰˜ç®¡åœ¨äº‘æœåŠ¡å™¨ä¸Šï¼Œä»¥ä¾¿æ‚¨çš„æœºå™¨äººå¯ä»¥å…¨å¤©å€™åœ¨çº¿è¿è¡Œã€‚</p><p>PythonAnywhere æ˜¯ä¸€ä¸ªå…è®¸æ‚¨å…è´¹æ‰˜ç®¡ Python ä»£ç çš„ç½‘ç«™ï¼Œå®ƒå…·æœ‰ä¸€å®šçš„ä½¿ç”¨é™åˆ¶ï¼Œä½†å¯¹äºç®€å•çš„ç”¨é€”æ¥è¯´ï¼Œéå¸¸åˆé€‚ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†å±•ç¤ºå¦‚ä½•ä½¿ç”¨ PythonAnywhere æ¥æ‰˜ç®¡æ‚¨çš„ Telegram æœºå™¨äººã€‚</p><p>è®¿é—® <a href="https://www.pythonanywhere.com/">PythonAnywhere ç½‘ç«™</a> å¹¶åˆ›å»ºä¸€ä¸ªå¸æˆ·ã€‚</p><img src="/2023/09/24/NLP%20Insights/%E5%8D%81%E5%88%86%E9%92%9F%E7%94%A8%20Python%20%E5%92%8C%20OpenAI%20%E5%88%9B%E5%BB%BA%20Telegram%20%E6%9C%BA%E5%99%A8%E4%BA%BA/step7.jpg" class=""><h3 id="7-1ï¼šåˆ›å»ºä¸€ä¸ª-Python-è„šæœ¬"><a href="#7-1ï¼šåˆ›å»ºä¸€ä¸ª-Python-è„šæœ¬" class="headerlink" title="7.1ï¼šåˆ›å»ºä¸€ä¸ª Python è„šæœ¬"></a>7.1ï¼šåˆ›å»ºä¸€ä¸ª Python è„šæœ¬</h3><p>ä¸€æ—¦æ‚¨ç™»å½•åˆ° PythonAnywhere çš„ä»ªè¡¨æ¿ï¼Œæ‚¨å°†çœ‹åˆ°ä¸€ä¸ªåä¸º â€œFilesâ€ çš„é€‰é¡¹ã€‚ç‚¹å‡»å®ƒï¼Œç„¶ååˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ï¼Œæˆ‘ä»¬å°†å‘½åå®ƒä¸º â€œtelegram_bot.pyâ€ã€‚åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å°†ç²˜è´´ä¹‹å‰åˆ›å»ºçš„ Telegram æœºå™¨äººä»£ç ã€‚</p><h3 id="7-2ï¼šå®‰è£…æ‰€éœ€çš„åŒ…"><a href="#7-2ï¼šå®‰è£…æ‰€éœ€çš„åŒ…" class="headerlink" title="7.2ï¼šå®‰è£…æ‰€éœ€çš„åŒ…"></a>7.2ï¼šå®‰è£…æ‰€éœ€çš„åŒ…</h3><p>åœ¨è¿è¡Œ Telegram æœºå™¨äººä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å®‰è£…æ‰€éœ€çš„ Python åŒ…ã€‚PythonAnywhere æä¾›äº†ä¸€ä¸ªå‘½ä»¤è¡Œç•Œé¢ï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install python-telegram-bot</span><br><span class="line">pip install openai</span><br></pre></td></tr></tbody></table></figure><p>è¿™å°†å®‰è£… Telegram æœºå™¨äººåº“ï¼Œä½¿æ‚¨çš„ä»£ç èƒ½å¤Ÿä¸ Telegram æœåŠ¡å™¨é€šä¿¡ã€‚</p><h3 id="7-3ï¼šè¿è¡Œæœºå™¨äºº"><a href="#7-3ï¼šè¿è¡Œæœºå™¨äºº" class="headerlink" title="7.3ï¼šè¿è¡Œæœºå™¨äºº"></a>7.3ï¼šè¿è¡Œæœºå™¨äºº</h3><p>ç°åœ¨ï¼Œæ‚¨å¯ä»¥è¿”å›åˆ° PythonAnywhere çš„ä»ªè¡¨æ¿ï¼Œå¹¶åœ¨ â€œFilesâ€ ä¸‹æ‰¾åˆ°æ‚¨çš„ â€œtelegram_bot.pyâ€ æ–‡ä»¶ã€‚ç„¶åï¼Œç‚¹å‡» â€œRunâ€ æŒ‰é’®ï¼Œæ‚¨çš„æœºå™¨äººå°†å¼€å§‹è¿è¡Œã€‚æœºå™¨äººå°†ä¸€ç›´åœ¨çº¿ï¼Œå³ä½¿æ‚¨å…³é—­äº†è®¡ç®—æœºä¹Ÿæ˜¯å¦‚æ­¤ã€‚</p><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>ç°åœ¨ï¼Œæ‚¨å·²ç»æŒæ¡äº†å¦‚ä½•åˆ›å»ºä¸€ä¸ª Python Telegram æœºå™¨äººï¼Œå¹¶ä¸ OpenAI é›†æˆï¼Œä½¿å…¶èƒ½å¤Ÿå›åº”ç”¨æˆ·çš„æ¶ˆæ¯å¹¶ç”Ÿæˆå›å¤ã€‚é€šè¿‡è¿™ä¸ªç®€å•çš„æ­¥éª¤ï¼Œæ‚¨å¯ä»¥å°†æ‚¨çš„ Telegram æœºå™¨äººå…è´¹æ‰˜ç®¡åœ¨äº‘æœåŠ¡å™¨ä¸Šï¼Œä»¥ä¾¿å®ƒå¯ä»¥å…¨å¤©å€™åœ¨çº¿è¿è¡Œã€‚è¿™æ ·ï¼Œæ‚¨å°±å¯ä»¥ä¸æ‚¨çš„æœºå™¨äººäº’åŠ¨ï¼Œè€Œä¸å¿…æ‹…å¿ƒè®¡ç®—æœºæ˜¯å¦å¼€å¯ã€‚å¦‚æœæ‚¨æœ‰å…¶ä»–å…è´¹æ‰˜ç®¡æœåŠ¡æˆ–å…¶ä»–é—®é¢˜ï¼Œæ¬¢è¿åœ¨è¯„è®ºä¸­åˆ†äº«ï¼ç¥æ‚¨çš„æœºå™¨äººè¿è¡Œæ„‰å¿«ï¼ğŸ¤–ğŸš€ğŸ˜„</p><p>å¦å¤–ï¼Œå¦‚æœæ‚¨æƒ³äº†è§£æ›´å¤šå…³äºå¦‚ä½•åœ¨ Discord ä¸Šæ‰˜ç®¡æœºå™¨äººçš„ä¿¡æ¯ï¼Œå¯ä»¥è§‚çœ‹æ­¤ YouTube è§†é¢‘ï¼š<a href="https://www.youtube.com/watch?v=2TI-tCVhe9k">How To Host Your Bot Online 24/7 For FREE With Python (Telegram, Discord, Etc)</a>ã€‚è§†é¢‘ä¸­æœ‰æ›´è¯¦ç»†çš„æ•™ç¨‹å’Œç¤ºä¾‹ã€‚</p><p>å¦‚æœæ‚¨æœ‰ä»»ä½•é—®é¢˜æˆ–éœ€è¦è¿›ä¸€æ­¥çš„å¸®åŠ©ï¼Œè¯·éšæ—¶ç•™ä¸‹è¯„è®ºã€‚ç¥æ‚¨ç¼–ç¨‹æ„‰å¿«ï¼ ğŸš€ğŸ¤–ğŸ˜„</p><h3 id="References"><a href="#References" class="headerlink" title="References"></a>References</h3><ul><li><a href="https://www.youtube.com/watch?v=vZtm1wuA2yc">How To Create A Telegram Bot In Python For Beginners (2023 Tutorial)</a></li><li><a href="https://www.youtube.com/watch?v=2TI-tCVhe9k">How To Host Your Bot Online 24/7 For FREE With Python (Telegram, Discord, Etc)</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Code Chronicles </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Chatbot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Resolving Port Conflicts: Identifying and Terminating Processes</title>
      <link href="/2023/09/13/Debugging%20Diaries/Resolving%20Port%20Conflicts:%20Identifying%20and%20Terminating%20Processes/"/>
      <url>/2023/09/13/Debugging%20Diaries/Resolving%20Port%20Conflicts:%20Identifying%20and%20Terminating%20Processes/</url>
      
        <content type="html"><![CDATA[<h1 id="Resolving-Port-Conflicts-Identifying-and-Terminating-Processes"><a href="#Resolving-Port-Conflicts-Identifying-and-Terminating-Processes" class="headerlink" title="Resolving Port Conflicts: Identifying and Terminating Processes"></a>Resolving Port Conflicts: Identifying and Terminating Processes</h1><h2 id="Table-of-Contents"><a href="#Table-of-Contents" class="headerlink" title="Table of Contents"></a>Table of Contents</h2><ul><li>Introduction ğŸ“</li><li>Finding Processes on Windows ğŸ•µï¸â€â™‚ï¸</li><li>Finding Processes on Linux/macOS ğŸ§</li><li>Viewing Process Details ğŸ“Š</li><li>Terminating Processes â›”ï¸</li></ul><h3 id="Introduction-ğŸ“"><a href="#Introduction-ğŸ“" class="headerlink" title="Introduction ğŸ“"></a>Introduction ğŸ“</h3><p>Sometimes, when you try to start an application or service, you may encounter an â€œAddress already in useâ€ error. This means that the specified port is already in use by another process. To resolve this issue, you need to identify which process is using that port and decide whether to terminate it or change the port configuration of your application.</p><h3 id="Finding-Processes-on-Windows-ğŸ•µï¸â€â™‚ï¸"><a href="#Finding-Processes-on-Windows-ğŸ•µï¸â€â™‚ï¸" class="headerlink" title="Finding Processes on Windows ğŸ•µï¸â€â™‚ï¸"></a>Finding Processes on Windows ğŸ•µï¸â€â™‚ï¸</h3><p>On Windows, you can use the Command Prompt to find the process that is using a specific port. Open the Command Prompt and run the following command:</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -ano | findstr :8080</span><br></pre></td></tr></tbody></table></figure><p>This command will list all processes using port 8080 and display their Process ID (PID).</p><h3 id="Finding-Processes-on-Linux-x2F-macOS-ğŸ§"><a href="#Finding-Processes-on-Linux-x2F-macOS-ğŸ§" class="headerlink" title="Finding Processes on Linux/macOS ğŸ§"></a>Finding Processes on Linux/macOS ğŸ§</h3><p>On Linux and macOS systems, you can use the terminal to find the process using a specific port. Open the terminal and run the following command:</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo lsof -i :8080</span><br></pre></td></tr></tbody></table></figure><p>This command will list all processes using port 8080 and display detailed information, including the PID and process name.</p><h3 id="Viewing-Process-Details-ğŸ“Š"><a href="#Viewing-Process-Details-ğŸ“Š" class="headerlink" title="Viewing Process Details ğŸ“Š"></a>Viewing Process Details ğŸ“Š</h3><p>Once you have the PID of the process, you can further view details about the process. On Linux and macOS, use the following command:</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -p &lt;PID&gt;</span><br></pre></td></tr></tbody></table></figure><p>On Windows, you can use the Task Manager or run the following command (replace <code>&lt;PID&gt;</code> with the correct PID):</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tasklist | findstr &lt;PID&gt;</span><br></pre></td></tr></tbody></table></figure><p>This will display detailed information about the process associated with the specified PID, including the process name and other relevant details.</p><h3 id="Terminating-Processes-â›”ï¸"><a href="#Terminating-Processes-â›”ï¸" class="headerlink" title="Terminating Processes â›”ï¸"></a>Terminating Processes â›”ï¸</h3><p>If you decide to terminate the process that is using a specific port, follow these steps:</p><p>On Windows, you can use the Task Manager or run the following command (replace <code>&lt;PID&gt;</code> with the correct PID):</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">taskkill /F /PID &lt;PID&gt;</span><br></pre></td></tr></tbody></table></figure><p>On Linux and macOS, you can run the following command (replace <code>&lt;PID&gt;</code> with the correct PID):</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo kill &lt;PID&gt;</span><br></pre></td></tr></tbody></table></figure><p>Please note that terminating a process may interrupt running applications or services, so use this operation carefully. Ensure that you know which process to terminate and avoid impacting critical system processes.</p>]]></content>
      
      
      <categories>
          
          <category> Debugging Diaries </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IssueFix </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è§£å†³ç«¯å£å†²çªï¼šæŸ¥æ‰¾å¹¶ç»ˆæ­¢è¿›ç¨‹</title>
      <link href="/2023/09/13/Debugging%20Diaries/%E8%A7%A3%E5%86%B3%E7%AB%AF%E5%8F%A3%E5%86%B2%E7%AA%81%EF%BC%9A%E6%9F%A5%E6%89%BE%E5%B9%B6%E7%BB%88%E6%AD%A2%E8%BF%9B%E7%A8%8B/"/>
      <url>/2023/09/13/Debugging%20Diaries/%E8%A7%A3%E5%86%B3%E7%AB%AF%E5%8F%A3%E5%86%B2%E7%AA%81%EF%BC%9A%E6%9F%A5%E6%89%BE%E5%B9%B6%E7%BB%88%E6%AD%A2%E8%BF%9B%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="è§£å†³ç«¯å£å†²çªï¼šæŸ¥æ‰¾å¹¶ç»ˆæ­¢è¿›ç¨‹"><a href="#è§£å†³ç«¯å£å†²çªï¼šæŸ¥æ‰¾å¹¶ç»ˆæ­¢è¿›ç¨‹" class="headerlink" title="è§£å†³ç«¯å£å†²çªï¼šæŸ¥æ‰¾å¹¶ç»ˆæ­¢è¿›ç¨‹"></a>è§£å†³ç«¯å£å†²çªï¼šæŸ¥æ‰¾å¹¶ç»ˆæ­¢è¿›ç¨‹</h1><h2 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h2><ul><li>ç®€ä»‹</li><li>åœ¨Windowsä¸ŠæŸ¥æ‰¾è¿›ç¨‹ ğŸ•µï¸â€â™‚ï¸</li><li>åœ¨Linux/macOSä¸ŠæŸ¥æ‰¾è¿›ç¨‹ ğŸ§</li><li>æŸ¥çœ‹è¿›ç¨‹è¯¦ç»†ä¿¡æ¯ ğŸ“Š</li><li>ç»ˆæ­¢è¿›ç¨‹ â›”ï¸</li></ul><h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>æœ‰æ—¶å€™ï¼Œå½“ä½ å°è¯•å¯åŠ¨ä¸€ä¸ªåº”ç”¨ç¨‹åºæˆ–æœåŠ¡æ—¶ï¼Œå¯èƒ½ä¼šé‡åˆ°â€Address already in useâ€ï¼ˆåœ°å€å·²ç»åœ¨ä½¿ç”¨ï¼‰çš„é”™è¯¯ï¼Œè¿™æ„å‘³ç€æŒ‡å®šçš„ç«¯å£å·²ç»è¢«å¦ä¸€ä¸ªè¿›ç¨‹å ç”¨ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½ éœ€è¦ç¡®å®šå“ªä¸ªè¿›ç¨‹æ­£åœ¨ä½¿ç”¨è¯¥ç«¯å£ï¼Œå¹¶å¯ä»¥é€‰æ‹©ç»ˆæ­¢è¯¥è¿›ç¨‹æˆ–æ›´æ”¹åº”ç”¨ç¨‹åºçš„ç«¯å£é…ç½®ã€‚</p><h3 id="åœ¨Windowsä¸ŠæŸ¥æ‰¾è¿›ç¨‹-ğŸ•µï¸â€â™‚ï¸"><a href="#åœ¨Windowsä¸ŠæŸ¥æ‰¾è¿›ç¨‹-ğŸ•µï¸â€â™‚ï¸" class="headerlink" title="åœ¨Windowsä¸ŠæŸ¥æ‰¾è¿›ç¨‹ ğŸ•µï¸â€â™‚ï¸"></a>åœ¨Windowsä¸ŠæŸ¥æ‰¾è¿›ç¨‹ ğŸ•µï¸â€â™‚ï¸</h3><p>åœ¨Windowsä¸Šï¼Œä½ å¯ä»¥ä½¿ç”¨å‘½ä»¤æç¤ºç¬¦æ¥æŸ¥æ‰¾æ­£åœ¨ä½¿ç”¨ç‰¹å®šç«¯å£çš„è¿›ç¨‹ã€‚æ‰“å¼€å‘½ä»¤æç¤ºç¬¦ï¼Œå¹¶æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -ano | findstr :8080</span><br></pre></td></tr></tbody></table></figure><p>è¿™ä¸ªå‘½ä»¤ä¼šåˆ—å‡ºæ‰€æœ‰æ­£åœ¨ä½¿ç”¨ç«¯å£8080çš„è¿›ç¨‹ï¼Œå¹¶æ˜¾ç¤ºå®ƒä»¬çš„è¿›ç¨‹IDï¼ˆPIDï¼‰ã€‚</p><h3 id="åœ¨Linux-x2F-macOSä¸ŠæŸ¥æ‰¾è¿›ç¨‹-ğŸ§"><a href="#åœ¨Linux-x2F-macOSä¸ŠæŸ¥æ‰¾è¿›ç¨‹-ğŸ§" class="headerlink" title="åœ¨Linux/macOSä¸ŠæŸ¥æ‰¾è¿›ç¨‹ ğŸ§"></a>åœ¨Linux/macOSä¸ŠæŸ¥æ‰¾è¿›ç¨‹ ğŸ§</h3><p>åœ¨Linuxå’ŒmacOSç³»ç»Ÿä¸Šï¼Œä½ å¯ä»¥ä½¿ç”¨ç»ˆç«¯æ¥æŸ¥æ‰¾æ­£åœ¨ä½¿ç”¨ç‰¹å®šç«¯å£çš„è¿›ç¨‹ã€‚æ‰“å¼€ç»ˆç«¯ï¼Œå¹¶æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo lsof -i :8080</span><br></pre></td></tr></tbody></table></figure><p>è¿™ä¸ªå‘½ä»¤ä¼šåˆ—å‡ºæ‰€æœ‰ä½¿ç”¨ç«¯å£8080çš„è¿›ç¨‹ï¼Œå¹¶æ˜¾ç¤ºå®ƒä»¬çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬PIDå’Œè¿›ç¨‹åã€‚</p><h3 id="æŸ¥çœ‹è¿›ç¨‹è¯¦ç»†ä¿¡æ¯-ğŸ“Š"><a href="#æŸ¥çœ‹è¿›ç¨‹è¯¦ç»†ä¿¡æ¯-ğŸ“Š" class="headerlink" title="æŸ¥çœ‹è¿›ç¨‹è¯¦ç»†ä¿¡æ¯ ğŸ“Š"></a>æŸ¥çœ‹è¿›ç¨‹è¯¦ç»†ä¿¡æ¯ ğŸ“Š</h3><p>ä¸€æ—¦ä½ è·å¾—äº†è¿›ç¨‹çš„PIDï¼Œä½ å¯ä»¥è¿›ä¸€æ­¥æŸ¥çœ‹æœ‰å…³è¿›ç¨‹çš„è¯¦ç»†ä¿¡æ¯ã€‚åœ¨Linuxå’ŒmacOSä¸Šï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -p &lt;PID&gt;</span><br></pre></td></tr></tbody></table></figure><p>åœ¨Windowsä¸Šï¼Œä½ å¯ä»¥ä½¿ç”¨ä»»åŠ¡ç®¡ç†å™¨æˆ–æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tasklist | findstr &lt;PID&gt;</span><br></pre></td></tr></tbody></table></figure><p>è¿™å°†æ˜¾ç¤ºä¸ç‰¹å®šPIDç›¸å…³çš„è¿›ç¨‹çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¿›ç¨‹åç§°å’Œå…¶ä»–è¯¦ç»†ä¿¡æ¯ã€‚</p><h3 id="ç»ˆæ­¢è¿›ç¨‹-â›”ï¸"><a href="#ç»ˆæ­¢è¿›ç¨‹-â›”ï¸" class="headerlink" title="ç»ˆæ­¢è¿›ç¨‹ â›”ï¸"></a>ç»ˆæ­¢è¿›ç¨‹ â›”ï¸</h3><p>å¦‚æœä½ ç¡®å®šè¦ç»ˆæ­¢æ­£åœ¨ä½¿ç”¨ç‰¹å®šç«¯å£çš„è¿›ç¨‹ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š</p><p>åœ¨Windowsä¸Šï¼Œä½ å¯ä»¥ä½¿ç”¨ä»»åŠ¡ç®¡ç†å™¨æˆ–æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼ˆä½¿ç”¨æ­£ç¡®çš„PIDæ›¿æ¢<pid>ï¼‰ï¼š</pid></p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">taskkill /F /PID &lt;PID&gt;</span><br></pre></td></tr></tbody></table></figure><p>åœ¨Linuxå’ŒmacOSä¸Šï¼Œä½ å¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼ˆä½¿ç”¨æ­£ç¡®çš„PIDæ›¿æ¢<pid>ï¼‰ï¼š</pid></p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo kill &lt;PID&gt;</span><br></pre></td></tr></tbody></table></figure><p>è¯·æ³¨æ„ï¼Œç»ˆæ­¢è¿›ç¨‹å¯èƒ½ä¼šå¯¼è‡´æ­£åœ¨è¿è¡Œçš„åº”ç”¨ç¨‹åºæˆ–æœåŠ¡ä¸­æ–­ï¼Œå› æ­¤è¯·è°¨æ…ä½¿ç”¨æ­¤æ“ä½œã€‚ç¡®ä¿ä½ çŸ¥é“ç»ˆæ­¢å“ªä¸ªè¿›ç¨‹ï¼Œå¹¶ç¡®ä¿ä¸ä¼šå½±å“åˆ°é‡è¦çš„ç³»ç»Ÿè¿›ç¨‹ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Debugging Diaries </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IssueFix </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ— æ–­å¼€çƒ¦æ¼ï¼è¿œç¨‹æœåŠ¡å™¨åå°è¿è¡Œç¨‹åºçš„3ç§æ–¹æ³•ï¼š`nohup`ã€`tmux`å’Œ`screen`</title>
      <link href="/2023/08/23/Code%20Chronicles/Python-Uninterrupted%20Remote%20Program%20Execution:%203%20Methods/"/>
      <url>/2023/08/23/Code%20Chronicles/Python-Uninterrupted%20Remote%20Program%20Execution:%203%20Methods/</url>
      
        <content type="html"><![CDATA[<h1 id="æ— æ–­å¼€çƒ¦æ¼ï¼è¿œç¨‹æœåŠ¡å™¨åå°è¿è¡Œç¨‹åºçš„3ç§æ–¹æ³•ï¼šnohupã€tmuxå’Œscreen"><a href="#æ— æ–­å¼€çƒ¦æ¼ï¼è¿œç¨‹æœåŠ¡å™¨åå°è¿è¡Œç¨‹åºçš„3ç§æ–¹æ³•ï¼šnohupã€tmuxå’Œscreen" class="headerlink" title="æ— æ–­å¼€çƒ¦æ¼ï¼è¿œç¨‹æœåŠ¡å™¨åå°è¿è¡Œç¨‹åºçš„3ç§æ–¹æ³•ï¼šnohupã€tmuxå’Œscreen"></a>æ— æ–­å¼€çƒ¦æ¼ï¼è¿œç¨‹æœåŠ¡å™¨åå°è¿è¡Œç¨‹åºçš„3ç§æ–¹æ³•ï¼š<code>nohup</code>ã€<code>tmux</code>å’Œ<code>screen</code></h1><h1 id="Uninterrupted-Remote-Program-Execution-3-Methods"><a href="#Uninterrupted-Remote-Program-Execution-3-Methods" class="headerlink" title="Uninterrupted Remote Program Execution: 3 Methods"></a>Uninterrupted Remote Program Execution: 3 Methods</h1><p>åœ¨æ•°æ®åˆ†ææˆ–æœºå™¨å­¦ä¹ é¡¹ç›®ä¸­ï¼Œç»å¸¸éœ€è¦åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šè¿è¡Œè€—æ—¶é•¿ã€è®¡ç®—å¯†é›†å‹çš„ä»»åŠ¡ã€‚é€šè¿‡SSHè¿æ¥åˆ°è¿œç¨‹æœåŠ¡å™¨æ˜¯å¸¸è§çš„æ“ä½œæ–¹å¼ã€‚ä½†æ˜¯ï¼Œå¦‚ä½•ç¡®ä¿åœ¨æ–­å¼€SSHè¿æ¥ä¹‹åï¼Œè¿œç¨‹æœåŠ¡å™¨ä¸Šçš„ç¨‹åºèƒ½å¤Ÿç»§ç»­è¿è¡Œå‘¢ï¼Ÿæœ¬æ–‡è¯¦ç»†ä»‹ç»äº†ä¸‰ç§æ–¹æ³•ï¼š<code>nohup</code>ã€<code>tmux</code>å’Œ<code>screen</code>ã€‚</p><h2 id="ä½¿ç”¨nohupå‘½ä»¤"><a href="#ä½¿ç”¨nohupå‘½ä»¤" class="headerlink" title="ä½¿ç”¨nohupå‘½ä»¤"></a>ä½¿ç”¨<code>nohup</code>å‘½ä»¤</h2><h3 id="å¼€å§‹"><a href="#å¼€å§‹" class="headerlink" title="å¼€å§‹"></a>å¼€å§‹</h3><ol><li><p><strong>è¿æ¥åˆ°è¿œç¨‹æœºå™¨</strong>ï¼šåœ¨æœ¬åœ°ç»ˆç«¯ä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ã€‚</p> <figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh username@remote-server-address</span><br></pre></td></tr></tbody></table></figure></li><li><p><strong>å¯åŠ¨åå°ç¨‹åº</strong>ï¼šåœ¨è¿œç¨‹æœºå™¨ä¸Šæ‰§è¡Œã€‚</p> <figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">nohup</span> your-command-to-run-the-program &amp;</span><br></pre></td></tr></tbody></table></figure></li></ol><p>ä¾‹å¦‚ï¼š</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">nohup</span> python train_model.py &amp;</span><br></pre></td></tr></tbody></table></figure><p>æ­¤æ–¹æ³•ä¼šå°†ç¨‹åºçš„è¾“å‡ºé‡å®šå‘åˆ°ä¸€ä¸ªåä¸º<code>nohup.out</code>çš„æ–‡ä»¶ä¸­ã€‚</p><h3 id="ç»“æŸ"><a href="#ç»“æŸ" class="headerlink" title="ç»“æŸ"></a>ç»“æŸ</h3><p>åœ¨è¿œç¨‹æœºå™¨ä¸Šæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ã€‚</p><ol><li><p>**æŸ¥æ‰¾ç¨‹åºçš„è¿›ç¨‹ID (PID)**ï¼š</p> <figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps aux | grep your-command-to-run-the-program</span><br></pre></td></tr></tbody></table></figure></li><li><p><strong>ç»“æŸè¿›ç¨‹</strong>ï¼š</p> <figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">kill</span> -9 PID</span><br></pre></td></tr></tbody></table></figure></li><li><p><strong>è¾“å‡ºå«ä¹‰</strong>:<br>å½“ä½ æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p></li></ol><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">nohup</span> python train_model.py &amp;</span><br></pre></td></tr></tbody></table></figure><p>ä½ å¯èƒ½ä¼šçœ‹åˆ°è¿™æ ·çš„è¾“å‡ºï¼š</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[1] 337082</span><br><span class="line"><span class="built_in">nohup</span>: ignoring input and appending output to <span class="string">'nohup.out'</span></span><br></pre></td></tr></tbody></table></figure><p>è¿™é‡Œï¼Œ</p><ul><li><strong><a href="%E8%BF%99%E6%98%AF%E8%AF%A5%E5%90%8E%E5%8F%B0%E4%BD%9C%E4%B8%9A%E7%9A%84%E4%BD%9C%E4%B8%9A%E7%BC%96%E5%8F%B7%E3%80%82%E5%A6%82%E6%9E%9C%E4%BD%A0%E5%9C%A8%E5%90%8E%E5%8F%B0%E8%BF%90%E8%A1%8C%E5%A4%9A%E4%B8%AA%E4%BD%9C%E4%B8%9A%EF%BC%8C%E6%AF%8F%E4%B8%AA%E4%BD%9C%E4%B8%9A%E9%83%BD%E4%BC%9A%E6%9C%89%E4%B8%80%E4%B8%AA%E5%94%AF%E4%B8%80%E7%9A%84%E4%BD%9C%E4%B8%9A%E7%BC%96%E5%8F%B7%E3%80%82">1</a> 337082</strong> è¡¨ç¤ºè¯¥ä»»åŠ¡ç°åœ¨åœ¨åå°è¿è¡Œï¼ŒPIDï¼ˆè¿›ç¨‹IDï¼‰ä¸º337082ã€‚<ul><li></li><li>337082: è¿™æ˜¯è¯¥åå°ä½œä¸šå¯¹åº”çš„è¿›ç¨‹ID (PID)ã€‚ä½ å¯ä»¥ä½¿ç”¨è¿™ä¸ªPIDæ¥ç›‘è§†æˆ–ç»“æŸè¯¥è¿›ç¨‹ã€‚</li></ul></li><li><strong>nohup: ignoring input and appending output to â€˜nohup.outâ€™</strong> è¡¨ç¤ºè¯¥è¿›ç¨‹ç°åœ¨å°†å¿½ç•¥ä»»ä½•è¾“å…¥ï¼Œå¹¶å°†è¾“å‡ºè¿½åŠ åˆ° <code>nohup.out</code> æ–‡ä»¶ã€‚<ul><li>è¿™æ˜¯ <code>nohup</code> å‘½ä»¤çš„æ ‡å‡†æ¶ˆæ¯ï¼Œå«ä¹‰å¦‚ä¸‹ï¼š<ul><li><code>ignoring input</code>: å½“ä½ ä½¿ç”¨ <code>nohup</code> å‘½ä»¤ï¼Œå®ƒå°†ä¸ä¼šæ¥æ”¶ä»»ä½•ä»ç»ˆç«¯è¾“å…¥çš„æ•°æ®ã€‚è¿™æ„å‘³ç€ï¼Œä¸€æ—¦ä½ ä½¿ç”¨ <code>nohup</code> å¯åŠ¨äº†ä¸€ä¸ªç¨‹åºï¼Œä½ ä¸èƒ½å†å‘å®ƒæä¾›ä»»ä½•äº¤äº’å¼è¾“å…¥ï¼ˆé™¤éç¨‹åºæœ‰å…¶ä»–çš„è¾“å…¥æ–¹æ³•ï¼‰ã€‚</li><li><code>appending output to 'nohup.out'</code>: é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>nohup</code> ä¼šå°†ç¨‹åºçš„è¾“å‡ºé‡å®šå‘åˆ°ä¸€ä¸ªåä¸º <code>nohup.out</code> çš„æ–‡ä»¶ä¸­ã€‚æ‰€ä»¥ï¼Œå¦‚æœä½ çš„ç¨‹åºåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­äº§ç”Ÿäº†ä»»ä½•è¾“å‡ºï¼ˆå¦‚æ‰“å°è¯­å¥ï¼‰ï¼Œè¿™äº›è¾“å‡ºéƒ½ä¼šè¢«å†™å…¥åˆ° <code>nohup.out</code> æ–‡ä»¶ä¸­ã€‚å¦‚æœè¯¥æ–‡ä»¶ä¹‹å‰ä¸å­˜åœ¨ï¼Œ<code>nohup</code> ä¼šè‡ªåŠ¨åˆ›å»ºå®ƒï¼›å¦‚æœæ–‡ä»¶å·²å­˜åœ¨ï¼Œ<code>nohup</code> ä¼šå°†æ–°çš„è¾“å‡ºè¿½åŠ åˆ°æ–‡ä»¶çš„æœ«å°¾ã€‚</li><li>å¦‚æœä½ æƒ³æŸ¥çœ‹ç¨‹åºçš„è¾“å‡ºï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>cat</code> æˆ– <code>tail</code> å‘½ä»¤æ¥æŸ¥çœ‹ <code>nohup.out</code> æ–‡ä»¶çš„å†…å®¹ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ <code>tail -f nohup.out</code> å¯ä»¥å®æ—¶æŸ¥çœ‹è¯¥æ–‡ä»¶çš„æœ«å°¾å†…å®¹ï¼Œè¿™å¯¹äºç›‘è§†ç¨‹åºçš„è¿è¡ŒçŠ¶æ€å¾ˆæœ‰ç”¨ã€‚</li></ul></li></ul></li></ul><h2 id="ä½¿ç”¨tmux"><a href="#ä½¿ç”¨tmux" class="headerlink" title="ä½¿ç”¨tmux"></a>ä½¿ç”¨<code>tmux</code></h2><h3 id="å¼€å§‹-1"><a href="#å¼€å§‹-1" class="headerlink" title="å¼€å§‹"></a>å¼€å§‹</h3><ol><li>**å®‰è£…<code>tmux</code>**ï¼šåœ¨è¿œç¨‹æœºå™¨ä¸Šæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ã€‚</li></ol><ul><li>Ubuntu/Debian  <figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install tmux <span class="comment"># Ubuntu/Debian</span></span><br></pre></td></tr></tbody></table></figure></li><li>MacOS  <figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install tmux</span><br></pre></td></tr></tbody></table></figure></li></ul><ol start="2"><li><p><strong>è¿æ¥åˆ°è¿œç¨‹æœºå™¨</strong>ï¼šåœ¨æœ¬åœ°ç»ˆç«¯ä¸­æ‰§è¡Œã€‚</p> <figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh username@remote-server-address</span><br></pre></td></tr></tbody></table></figure></li><li><p><strong>å¼€å§‹æ–°çš„tmuxä¼šè¯</strong>ï¼šåœ¨è¿œç¨‹æœºå™¨ä¸Šæ‰§è¡Œã€‚</p> <figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tmux</span><br></pre></td></tr></tbody></table></figure></li></ol><p>ç„¶ååœ¨tmuxä¼šè¯å†…è¿è¡Œæ‚¨çš„ç¨‹åºã€‚</p><ol start="4"><li><strong>æ–­å¼€ä¼šè¯</strong>ï¼šåœ¨è¿œç¨‹æœºå™¨ä¸ŠæŒ‰ <code>Ctrl+b d</code>ã€‚</li></ol><h3 id="ç»“æŸ-1"><a href="#ç»“æŸ-1" class="headerlink" title="ç»“æŸ"></a>ç»“æŸ</h3><p>åœ¨è¿œç¨‹æœºå™¨ä¸Šæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ã€‚</p><ol><li><p><strong>é‡æ–°è¿æ¥åˆ°tmuxä¼šè¯</strong>ï¼š</p> <figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tmux attach</span><br></pre></td></tr></tbody></table></figure></li><li><p><strong>ç»“æŸç¨‹åºå’Œä¼šè¯</strong>ï¼šä½¿ç”¨<code>Ctrl+c</code>ç»“æŸç¨‹åºï¼Œç„¶åæŒ‰<code>Ctrl+b</code>å†æŒ‰<code>x</code>ç»“æŸtmuxä¼šè¯ã€‚</p></li></ol><h2 id="ä½¿ç”¨screen"><a href="#ä½¿ç”¨screen" class="headerlink" title="ä½¿ç”¨screen"></a>ä½¿ç”¨<code>screen</code></h2><h3 id="å¼€å§‹-2"><a href="#å¼€å§‹-2" class="headerlink" title="å¼€å§‹"></a>å¼€å§‹</h3><ol><li>**å®‰è£…<code>screen</code>**ï¼šåœ¨æœ¬åœ°ç»ˆç«¯ä¸­æ‰§è¡Œã€‚</li></ol><ul><li>Ubuntu/Debian  <figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install screen <span class="comment"># Ubuntu/Debian</span></span><br></pre></td></tr></tbody></table></figure></li><li>MacOS  <figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install screen</span><br></pre></td></tr></tbody></table></figure></li></ul><ol><li><p><strong>è¿æ¥åˆ°è¿œç¨‹æœºå™¨</strong>ï¼šåœ¨æœ¬åœ°ç»ˆç«¯ä¸­æ‰§è¡Œã€‚</p> <figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh username@remote-server-address</span><br></pre></td></tr></tbody></table></figure></li><li><p><strong>å¼€å§‹æ–°çš„screenä¼šè¯</strong>ï¼šåœ¨è¿œç¨‹æœºå™¨ä¸Šæ‰§è¡Œã€‚</p> <figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">screen</span><br></pre></td></tr></tbody></table></figure></li></ol><p>ç„¶ååœ¨screenä¼šè¯å†…è¿è¡Œæ‚¨çš„ç¨‹åºã€‚</p><ol start="4"><li><strong>æ–­å¼€ä¼šè¯</strong>ï¼šåœ¨è¿œç¨‹æœºå™¨ä¸ŠæŒ‰ <code>Ctrl+a d</code>ã€‚</li></ol><h3 id="ç»“æŸ-2"><a href="#ç»“æŸ-2" class="headerlink" title="ç»“æŸ"></a>ç»“æŸ</h3><p>åœ¨è¿œç¨‹æœºå™¨ä¸Šæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ã€‚</p><ol><li><p><strong>é‡æ–°è¿æ¥åˆ°screenä¼šè¯</strong>ï¼š</p> <figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">screen -r</span><br></pre></td></tr></tbody></table></figure></li><li><p><strong>ç»“æŸç¨‹åºå’Œä¼šè¯</strong>ï¼šä½¿ç”¨<code>Ctrl+c</code>ç»“æŸç¨‹åºï¼Œç„¶åæŒ‰<code>Ctrl+a</code>å†æŒ‰<code>k</code>ç»“æŸscreenä¼šè¯ã€‚</p></li></ol><h2 id="ç‰¹æ®Šæƒ…å†µï¼šmacOSç”¨æˆ·"><a href="#ç‰¹æ®Šæƒ…å†µï¼šmacOSç”¨æˆ·" class="headerlink" title="ç‰¹æ®Šæƒ…å†µï¼šmacOSç”¨æˆ·"></a>ç‰¹æ®Šæƒ…å†µï¼šmacOSç”¨æˆ·</h2><p>macOSç”¨æˆ·å¯ä»¥ä½¿ç”¨Homebrewæ¥å®‰è£…<code>tmux</code>æˆ–<code>screen</code>ã€‚</p><ul><li><p>å®‰è£…<code>tmux</code>ï¼š</p>  <figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install tmux</span><br></pre></td></tr></tbody></table></figure></li><li><p>å®‰è£…<code>screen</code>ï¼š</p>  <figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install screen</span><br></pre></td></tr></tbody></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> Code Chronicles </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python Basic </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¶…è¶ŠPythonçš„è¾¹ç•Œï¼š`subprocess` åŠ©ä½ ä¸€é”®æ‰§è¡Œå¤–éƒ¨å‘½ä»¤</title>
      <link href="/2023/08/22/Code%20Chronicles/Python-subprocess/"/>
      <url>/2023/08/22/Code%20Chronicles/Python-subprocess/</url>
      
        <content type="html"><![CDATA[<h1 id="è¶…è¶ŠPythonçš„è¾¹ç•Œï¼šsubprocess-åŠ©ä½ ä¸€é”®æ‰§è¡Œå¤–éƒ¨å‘½ä»¤"><a href="#è¶…è¶ŠPythonçš„è¾¹ç•Œï¼šsubprocess-åŠ©ä½ ä¸€é”®æ‰§è¡Œå¤–éƒ¨å‘½ä»¤" class="headerlink" title="è¶…è¶ŠPythonçš„è¾¹ç•Œï¼šsubprocess åŠ©ä½ ä¸€é”®æ‰§è¡Œå¤–éƒ¨å‘½ä»¤"></a>è¶…è¶ŠPythonçš„è¾¹ç•Œï¼š<code>subprocess</code> åŠ©ä½ ä¸€é”®æ‰§è¡Œå¤–éƒ¨å‘½ä»¤</h1><p>åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿä» Python è„šæœ¬ä¸­æ‰§è¡Œç³»ç»Ÿå‘½ä»¤æˆ–è€…å…¶ä»–ç¨‹åºã€‚Python æä¾›äº† <code>subprocess</code> æ¨¡å—ï¼Œä½¿å¾—è¿™ä¸€æ“ä½œå˜å¾—æ—¢ç®€å•åˆå®‰å…¨ã€‚</p><h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><p><code>subprocess</code> æ¨¡å—æ˜¯ Python æ ‡å‡†åº“çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒæä¾›äº†ä¸€ç§ç®€å•ç»Ÿä¸€çš„æ–¹æ³•æ¥æ‰§è¡Œå¤–éƒ¨å‘½ä»¤ï¼Œä¸è¿›ç¨‹äº¤äº’ï¼Œè¯»å–å®ƒçš„è¾“å‡ºï¼Œå¹¶è·å–å®ƒçš„è¿”å›ç ã€‚æ— è®ºä½ æ˜¯åœ¨è‡ªåŠ¨åŒ–æŸä¸ªç³»ç»Ÿä»»åŠ¡ï¼Œè¿˜æ˜¯ç®€å•åœ°æƒ³è¦ä»å¦ä¸€ä¸ªç¨‹åºä¸­è·å–æ•°æ®ï¼Œ<code>subprocess</code> éƒ½èƒ½åŠ©ä½ ä¸€è‡‚ä¹‹åŠ›ã€‚</p><h2 id="åŠŸèƒ½ä¸ç”¨é€”"><a href="#åŠŸèƒ½ä¸ç”¨é€”" class="headerlink" title="åŠŸèƒ½ä¸ç”¨é€”"></a>åŠŸèƒ½ä¸ç”¨é€”</h2><ol><li><p><strong>æ‰§è¡Œå¤–éƒ¨å‘½ä»¤</strong>ï¼šä½ å¯ä»¥è½»æ˜“åœ°ä» Python è„šæœ¬ä¸­è¿è¡Œä»»ä½•å¤–éƒ¨å‘½ä»¤ï¼Œå°±åƒåœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥å‘½ä»¤ä¸€æ ·ã€‚è¿™ç§èƒ½åŠ›ä½¿å¾—ä½ èƒ½å¤Ÿåœ¨ä½ çš„ Python ç¨‹åºä¸­è°ƒç”¨å¹¶é›†æˆå…¶ä»–å‘½ä»¤è¡Œå·¥å…·ï¼Œæ‰©å±•ä½ çš„åº”ç”¨çš„åŠŸèƒ½ã€‚</p></li><li><p><strong>æ•è·å‘½ä»¤çš„è¾“å‡º</strong>ï¼šå¦‚æœä½ æƒ³è·å–å‘½ä»¤çš„è¾“å‡ºå¹¶åœ¨ Python è„šæœ¬ä¸­å¤„ç†ï¼Œ<code>subprocess</code> ä¹Ÿèƒ½æ»¡è¶³ä½ ã€‚ä½ å¯ä»¥å°†å‘½ä»¤çš„è¾“å‡ºä½œä¸ºå­—ç¬¦ä¸²æ•è·ï¼Œç„¶åè¿›ä¸€æ­¥åˆ†æå’Œå¤„ç†ï¼Œè¿™åœ¨éœ€è¦å¯¹å‘½ä»¤è¾“å‡ºè¿›è¡Œè§£ææˆ–è€…æå–æ—¶éå¸¸æœ‰ç”¨ã€‚</p></li><li><p><strong>é”™è¯¯å¤„ç†</strong>ï¼šé€šè¿‡æ•è·è¿”å›ç ï¼Œä½ å¯ä»¥çŸ¥é“å‘½ä»¤æ˜¯å¦æˆåŠŸæ‰§è¡Œï¼Œæˆ–è€…æ˜¯å¦å‘ç”Ÿäº†é”™è¯¯ã€‚è¿™ä½¿å¾—ä½ èƒ½å¤Ÿæ ¹æ®å‘½ä»¤çš„æ‰§è¡Œç»“æœé‡‡å–ä¸åŒçš„æ“ä½œï¼Œä»è€Œæé«˜ç¨‹åºçš„å¥å£®æ€§ã€‚</p></li><li><p><strong>ä¸è¿›ç¨‹äº¤äº’</strong>ï¼š<code>subprocess</code> ä¸ä»…å¯ä»¥å¯åŠ¨å’Œåœæ­¢è¿›ç¨‹ï¼Œè¿˜å¯ä»¥ä¸å®ƒä»¬è¿›è¡ŒåŒå‘é€šä¿¡ã€‚è¿™ä½¿å¾—ä½ èƒ½å¤Ÿåœ¨è¿è¡Œçš„å¤–éƒ¨è¿›ç¨‹ä¸­å‘é€è¾“å…¥ï¼Œå¹¶ä»å…¶è¾“å‡ºä¸­è·å–æ•°æ®ï¼Œä»è€Œå®ç°æ›´é«˜çº§çš„äº¤äº’å’Œæ§åˆ¶ã€‚</p></li></ol><h2 id="ä½¿ç”¨æ–¹æ³•"><a href="#ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h2><h3 id="åŸºæœ¬çš„å‘½ä»¤æ‰§è¡Œ"><a href="#åŸºæœ¬çš„å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="åŸºæœ¬çš„å‘½ä»¤æ‰§è¡Œ"></a>åŸºæœ¬çš„å‘½ä»¤æ‰§è¡Œ</h3><p>æ‰§è¡Œå‘½ä»¤æœ€ç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨ <code>subprocess.run()</code> å‡½æ•°ï¼Œå®ƒæ¥å—ä¸€ä¸ªå‘½ä»¤åŠå…¶å‚æ•°çš„åˆ—è¡¨ï¼Œå¹¶è¿”å›ä¸€ä¸ª <code>CompletedProcess</code> å¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«äº†å‘½ä»¤æ‰§è¡Œçš„ç»“æœã€‚è¿™ä½¿å¾—ä½ èƒ½å¤Ÿè½»æ¾åœ°åœ¨ä½ çš„è„šæœ¬ä¸­è¿è¡Œå¤–éƒ¨å‘½ä»¤ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line">result = subprocess.run([<span class="string">'ls'</span>, <span class="string">'-l'</span>])</span><br></pre></td></tr></tbody></table></figure><h3 id="æ•è·å‘½ä»¤è¾“å‡º"><a href="#æ•è·å‘½ä»¤è¾“å‡º" class="headerlink" title="æ•è·å‘½ä»¤è¾“å‡º"></a>æ•è·å‘½ä»¤è¾“å‡º</h3><p>æƒ³è¦æ•è·å‘½ä»¤çš„è¾“å‡ºåˆ° Python è„šæœ¬ä¸­ï¼Œå¯ä»¥è®¾ç½® <code>capture_output=True</code> å‚æ•°ã€‚æ­¤å¤–ï¼Œé€šè¿‡è®¾ç½® <code>text=True</code> å‚æ•°ï¼Œä½ å¯ä»¥ä»¥æ–‡æœ¬å½¢å¼è·å–å‘½ä»¤çš„è¾“å‡ºï¼š</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">result = subprocess.run([<span class="string">'ls'</span>, <span class="string">'-l'</span>], capture_output=<span class="literal">True</span>, text=<span class="literal">True</span>)</span><br><span class="line"><span class="built_in">print</span>(result.stdout)</span><br></pre></td></tr></tbody></table></figure><h3 id="ä½¿ç”¨-shell"><a href="#ä½¿ç”¨-shell" class="headerlink" title="ä½¿ç”¨ shell"></a>ä½¿ç”¨ shell</h3><p>å½“ä½ éœ€è¦æ‰§è¡ŒåŒ…å« shell åŠŸèƒ½ï¼ˆä¾‹å¦‚ç®¡é“æˆ–é€šé…ç¬¦ï¼‰çš„å‘½ä»¤æ—¶ï¼Œå¯ä»¥è®¾ç½® <code>shell=True</code> å‚æ•°ï¼Œå¹¶å°†å‘½ä»¤ä½œä¸ºå­—ç¬¦ä¸²ä¼ é€’ç»™ <code>subprocess.run()</code>ã€‚è¿™æ ·ï¼Œä½ å¯ä»¥æ‰§è¡Œæ›´å¤æ‚çš„å‘½ä»¤ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">result = subprocess.run(<span class="string">'ls -l | grep "my_file"'</span>, shell=<span class="literal">True</span>, capture_output=<span class="literal">True</span>, text=<span class="literal">True</span>)</span><br><span class="line"><span class="built_in">print</span>(result.stdout)</span><br></pre></td></tr></tbody></table></figure><p><strong>è­¦å‘Š</strong>ï¼šè™½ç„¶ <code>shell=True</code> å‚æ•°å¾ˆæœ‰ç”¨ï¼Œä½†ä½¿ç”¨æ—¶å¿…é¡»å°å¿ƒï¼Œå› ä¸ºå®ƒå¯èƒ½ä¼šè®©ä½ çš„ä»£ç æš´éœ²äºå‘½ä»¤æ³¨å…¥æ”»å‡»ã€‚ç¡®ä¿æ°¸è¿œä¸è¦æ‰§è¡ŒåŒ…å«ä¸å—ä¿¡ä»»çš„è¾“å…¥çš„å‘½ä»¤ã€‚</p><h3 id="é”™è¯¯å¤„ç†"><a href="#é”™è¯¯å¤„ç†" class="headerlink" title="é”™è¯¯å¤„ç†"></a>é”™è¯¯å¤„ç†</h3><p>å‘½ä»¤å¦‚æœè¿”å›ä¸€ä¸ªéé›¶çš„é€€å‡ºç ï¼Œå¯ä»¥é€šè¿‡ <code>check=True</code> å‚æ•°æ¥æŠ›å‡ºå¼‚å¸¸ã€‚è¿™ä½¿å¾—ä½ èƒ½å¤Ÿæ•è·å‘½ä»¤æ‰§è¡Œè¿‡ç¨‹ä¸­çš„é”™è¯¯ï¼Œä»è€Œè¿›è¡Œé€‚å½“çš„å¤„ç†ï¼š</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    result = subprocess.run([<span class="string">'ls'</span>, <span class="string">'non_existent_file'</span>], check=<span class="literal">True</span>)</span><br><span class="line"><span class="keyword">except</span> subprocess.CalledProcessError:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"å‘½ä»¤æ‰§è¡Œå‡ºé”™!"</span>)</span><br></pre></td></tr></tbody></table></figure><h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p><code>subprocess</code> æ¨¡å—æ˜¯ Python ä¸­æ‰§è¡Œå¤–éƒ¨å‘½ä»¤çš„å¼ºå¤§å·¥å…·ã€‚é€šè¿‡å®ƒï¼Œå¼€å‘è€…å¯ä»¥è½»æ¾åœ°ä¸æ“ä½œç³»ç»ŸåŠå…¶ä»–åº”ç”¨ç¨‹åºäº¤äº’ï¼Œæ‰©å±•ç¨‹åºçš„åŠŸèƒ½ã€‚ç„¶è€Œï¼Œåœ¨ä½¿ç”¨ <code>subprocess</code> æ—¶éœ€è¦æ³¨æ„å‘½ä»¤çš„å®‰å…¨æ€§ï¼Œä»¥é¿å…æ½œåœ¨çš„å®‰å…¨é£é™©ã€‚é€šè¿‡åˆç†åœ°åˆ©ç”¨ <code>subprocess</code> æ¨¡å—ï¼Œä½ å¯ä»¥æ›´å¥½åœ°ç®¡ç†å¤–éƒ¨å‘½ä»¤çš„æ‰§è¡Œï¼Œå¹¶å°†å…¶èå…¥åˆ°ä½ çš„ Python åº”ç”¨ä¸­ï¼Œæå‡å¼€å‘æ•ˆç‡ã€‚å¸Œæœ›æœ¬æ–‡èƒ½å¤Ÿå¸®åŠ©ä½ æ›´æ·±å…¥åœ°ç†è§£å’Œä½¿ç”¨ <code>subprocess</code> æ¨¡å—çš„ç§ç§åŠŸèƒ½ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Code Chronicles </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python Basic </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Conver Pytorch Model to ONNX Format</title>
      <link href="/2023/08/21/NLP%20Insights/Conver%20Pytorch%20Model%20to%20ONNX%20Format/"/>
      <url>/2023/08/21/NLP%20Insights/Conver%20Pytorch%20Model%20to%20ONNX%20Format/</url>
      
        <content type="html"><![CDATA[<h1 id="ä½¿ç”¨-PyTorch-å’Œ-ONNX-æ£€æŸ¥æ¨¡å‹ä¸€è‡´æ€§"><a href="#ä½¿ç”¨-PyTorch-å’Œ-ONNX-æ£€æŸ¥æ¨¡å‹ä¸€è‡´æ€§" class="headerlink" title="ä½¿ç”¨ PyTorch å’Œ ONNX æ£€æŸ¥æ¨¡å‹ä¸€è‡´æ€§"></a>ä½¿ç”¨ PyTorch å’Œ ONNX æ£€æŸ¥æ¨¡å‹ä¸€è‡´æ€§</h1><p>åœ¨æœºå™¨å­¦ä¹ å’Œæ·±åº¦å­¦ä¹ çš„å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæ¨¡å‹çš„äº’æ“ä½œæ€§å˜å¾—è¶Šæ¥è¶Šé‡è¦ã€‚ONNX (Open Neural Network Exchange) æ˜¯ä¸€ç§å¼€æ”¾æ ¼å¼ï¼Œç”¨äºè¡¨ç¤ºæœºå™¨å­¦ä¹ å’Œæ·±åº¦å­¦ä¹ æ¨¡å‹ã€‚å®ƒå…è®¸å¼€å‘è€…åœ¨å„ç§æ·±åº¦å­¦ä¹ æ¡†æ¶ä¹‹é—´è½»æ¾åœ°å…±äº«æ¨¡å‹ï¼Œä»è€Œæé«˜äº†æ¨¡å‹çš„å¯ç§»æ¤æ€§å’Œäº’æ“ä½œæ€§ã€‚</p><p>æœ¬æ•™ç¨‹å°†æŒ‡å¯¼æ‚¨å®Œæˆä»¥ä¸‹æ­¥éª¤ï¼š</p><ol><li>å°† PyTorch æ¨¡å‹è½¬æ¢ä¸º ONNX æ ¼å¼ã€‚</li><li>éªŒè¯è½¬æ¢åçš„ ONNX æ¨¡å‹ä¸åŸå§‹ PyTorch æ¨¡å‹çš„è¾“å‡ºæ˜¯å¦ä¸€è‡´ã€‚</li></ol><h2 id="1-å¯¼å…¥å¿…è¦çš„åº“"><a href="#1-å¯¼å…¥å¿…è¦çš„åº“" class="headerlink" title="1. å¯¼å…¥å¿…è¦çš„åº“"></a>1. å¯¼å…¥å¿…è¦çš„åº“</h2><p>é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥ä¸ºæ¨¡å‹è½¬æ¢å’ŒéªŒè¯æ‰€éœ€çš„æ‰€æœ‰åº“ã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> onnx</span><br><span class="line"><span class="keyword">import</span> onnxruntime</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br></pre></td></tr></tbody></table></figure><h2 id="2-å®šä¹‰æ¨¡å‹è½¬æ¢å‡½æ•°"><a href="#2-å®šä¹‰æ¨¡å‹è½¬æ¢å‡½æ•°" class="headerlink" title="2. å®šä¹‰æ¨¡å‹è½¬æ¢å‡½æ•°"></a>2. å®šä¹‰æ¨¡å‹è½¬æ¢å‡½æ•°</h2><p>ä¸ºäº†å°† PyTorch æ¨¡å‹è½¬æ¢ä¸º ONNX æ ¼å¼ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªåä¸º <code>convert_onnx</code> çš„å‡½æ•°ã€‚æ­¤å‡½æ•°ä½¿ç”¨ PyTorch çš„å†…ç½®å‡½æ•° <code>torch.onnx.export</code> å°†æ¨¡å‹è½¬æ¢ä¸º ONNX æ ¼å¼ã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">convert_onnx</span>(<span class="params">model, dummy_input, onnx_path</span>):</span><br><span class="line">    input_names = [<span class="string">'modelInput'</span>]</span><br><span class="line">    output_names = [<span class="string">"modelOutput"</span>]</span><br><span class="line">    torch.onnx.export(model=model,</span><br><span class="line">                      args=dummy_input,</span><br><span class="line">                      f=onnx_path,</span><br><span class="line">                      opset_version=<span class="number">10</span>,</span><br><span class="line">                      input_names=input_names,</span><br><span class="line">                      output_names=output_names)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p>æ­¤å‡½æ•°æ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼šPyTorch æ¨¡å‹ã€æ¨¡æ‹Ÿè¾“å…¥æ•°æ®ä»¥åŠè¦ä¿å­˜ ONNX æ¨¡å‹çš„è·¯å¾„ã€‚<code>torch.onnx.export</code> å‡½æ•°éœ€è¦æ¨¡å‹ã€è¾“å…¥å’Œä¿å­˜è·¯å¾„ä½œä¸ºå‚æ•°ï¼Œä»¥åŠå…¶ä»–ä¸€äº›å¯é€‰å‚æ•°æ¥æŒ‡å®šè¾“å…¥å’Œè¾“å‡ºçš„åç§°ã€‚</p><h2 id="3-å®šä¹‰ä¸€è‡´æ€§æ£€æŸ¥å‡½æ•°"><a href="#3-å®šä¹‰ä¸€è‡´æ€§æ£€æŸ¥å‡½æ•°" class="headerlink" title="3. å®šä¹‰ä¸€è‡´æ€§æ£€æŸ¥å‡½æ•°"></a>3. å®šä¹‰ä¸€è‡´æ€§æ£€æŸ¥å‡½æ•°</h2><p>ä¸€æ—¦æˆ‘ä»¬æœ‰äº† ONNX æ ¼å¼çš„æ¨¡å‹ï¼Œå°±å¯ä»¥ä½¿ç”¨ <code>check_consistency</code> å‡½æ•°æ¥éªŒè¯ PyTorch æ¨¡å‹å’Œ ONNX æ¨¡å‹çš„è¾“å‡ºæ˜¯å¦ä¸€è‡´ã€‚è¿™æ˜¯ç¡®ä¿è½¬æ¢è¿‡ç¨‹æ²¡æœ‰å¼•å…¥ä»»ä½•å·®å¼‚çš„å…³é”®æ­¥éª¤ã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">check_consistency</span>(<span class="params">pytorch_model, onnx_model_path, input_tensor, tolerance=<span class="number">1e-6</span></span>):</span><br><span class="line">    <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">        pytorch_output_dict = pytorch_model(input_tensor)</span><br><span class="line">        pytorch_output = pytorch_output_dict[<span class="string">'y_pred'</span>].cpu().numpy()</span><br><span class="line"></span><br><span class="line">    ort_session = onnxruntime.InferenceSession(onnx_model_path)</span><br><span class="line">    ort_inputs = {ort_session.get_inputs()[<span class="number">0</span>].name: input_tensor.cpu().numpy()}</span><br><span class="line">    ort_output = ort_session.run(<span class="literal">None</span>, ort_inputs)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    difference = np.<span class="built_in">abs</span>(pytorch_output - ort_output)</span><br><span class="line">    consistent = np.<span class="built_in">all</span>(difference &lt;= tolerance)</span><br><span class="line">    <span class="keyword">return</span> consistent</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p>æ­¤å‡½æ•°é¦–å…ˆä½¿ç”¨ PyTorch æ¨¡å‹è®¡ç®—è¾“å‡ºï¼Œç„¶åä½¿ç”¨ ONNX è¿è¡Œæ—¶è®¡ç®— ONNX æ¨¡å‹çš„è¾“å‡ºã€‚æœ€åï¼Œå®ƒæ¯”è¾ƒä¸¤ä¸ªè¾“å‡ºï¼Œæ£€æŸ¥å®ƒä»¬ä¹‹é—´çš„å·®å¼‚æ˜¯å¦åœ¨é¢„å®šä¹‰çš„å®¹å¿èŒƒå›´å†…ã€‚</p><h2 id="4-ç¤ºä¾‹è°ƒç”¨"><a href="#4-ç¤ºä¾‹è°ƒç”¨" class="headerlink" title="4. ç¤ºä¾‹è°ƒç”¨"></a>4. ç¤ºä¾‹è°ƒç”¨</h2><p>ä¸ºäº†ç¡®ä¿ä¸Šè¿°å‡½æ•°çš„æ­£ç¡®æ€§ï¼Œæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ä¸Šè¿°å‡½æ•°æ¥è½¬æ¢æ¨¡å‹å¹¶æ£€æŸ¥ä¸€è‡´æ€§ã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åŠ è½½ PyTorch æ¨¡å‹ (æ­¤å¤„åªæ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œéœ€è¦æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œä¿®æ”¹)</span></span><br><span class="line">model = YOUR_PYTORCH_MODEL</span><br><span class="line"></span><br><span class="line"><span class="comment"># è½¬æ¢ä¸º ONNX æ ¼å¼</span></span><br><span class="line">dummy_input = YOUR_INPUT_TENSOR</span><br><span class="line">onnx_path = <span class="string">"path_to_save_onnx_model.onnx"</span></span><br><span class="line">convert_onnx(model, dummy_input, onnx_path)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥ä¸€è‡´æ€§</span></span><br><span class="line">is_consistent = check_consistency(model, onnx_path, dummy_input)</span><br><span class="line"><span class="keyword">if</span> is_consistent:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"The outputs of the PyTorch model and the ONNX model are consistent!"</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"There is a discrepancy between the outputs of the PyTorch model and the ONNX model."</span>)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œç¡®ä¿æ ¹æ®æ‚¨çš„å®é™…æ¨¡å‹å’Œæ•°æ®æ›¿æ¢ <code>YOUR_PYTORCH_MODEL</code> å’Œ <code>YOUR_INPUT_TENSOR</code>ã€‚</p><hr><p>ä»¥ä¸Šå°±æ˜¯å…³äºå¦‚ä½•ä½¿ç”¨ PyTorch å’Œ ONNX æ¥æ£€æŸ¥æ¨¡å‹ä¸€è‡´æ€§çš„æ•™ç¨‹ã€‚å¸Œæœ›è¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œå¦‚æœæœ‰ä»»ä½•é—®é¢˜ï¼Œæ¬¢è¿åœ¨ä¸‹æ–¹ç•™è¨€ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> NLP Insights </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Onnx </tag>
            
            <tag> Deployment </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Training Llama 2 Model on Single GPU with int8 Quantization and LoRA</title>
      <link href="/2023/08/02/NLP%20Insights/LLAMA2/"/>
      <url>/2023/08/02/NLP%20Insights/LLAMA2/</url>
      
        <content type="html"><![CDATA[<h1 id="Training-Llama-2-Model-on-Single-GPU-with-int8-Quantization-and-LoRA"><a href="#Training-Llama-2-Model-on-Single-GPU-with-int8-Quantization-and-LoRA" class="headerlink" title="Training Llama 2 Model on Single GPU with int8 Quantization and LoRA"></a>Training Llama 2 Model on Single GPU with int8 Quantization and LoRA</h1><h1 id="Llama-2"><a href="#Llama-2" class="headerlink" title="Llama 2"></a>Llama 2</h1><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p><em>Llama 2</em> æ˜¯ä¸€ä¸ªåŒ…å«é¢„è®­ç»ƒå’Œå¾®è°ƒçš„ç”Ÿæˆå¼æ–‡æœ¬æ¨¡å‹çš„é›†åˆï¼Œå…¶è§„æ¨¡ä» 70 äº¿åˆ° 700 äº¿ä¸ªå‚æ•°ä¸ç­‰ã€‚Llama2æ¨¡å‹æ˜¯ç”±Hugo Touvron, Louis Martin, Kevin Stone, Peter Albertç­‰äººåœ¨<a href="https://ai.meta.com/research/publications/llama-2-open-foundation-and-fine-tuned-chat-models/">Llama 2: Open Foundation and Fine-Tuned Chat Models</a>ä¸­æå‡ºçš„ã€‚</p><p>è¯¥è®ºæ–‡çš„æ‘˜è¦å¦‚ä¸‹ï¼š</p><p>åœ¨è¿™é¡¹å·¥ä½œä¸­ï¼Œæˆ‘ä»¬å¼€å‘å¹¶å‘å¸ƒäº†Llama 2ï¼Œè¿™æ˜¯ä¸€ç»„ä»70äº¿åˆ°700äº¿å‚æ•°çš„é¢„è®­ç»ƒå’Œå¾®è°ƒçš„å¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMsï¼‰ã€‚æˆ‘ä»¬çš„å¾®è°ƒLLMsï¼Œç§°ä¸ºLlama 2-Chatï¼Œé’ˆå¯¹å¯¹è¯ç”¨ä¾‹è¿›è¡Œäº†ä¼˜åŒ–ã€‚æˆ‘ä»¬çš„æ¨¡å‹åœ¨æˆ‘ä»¬æµ‹è¯•çš„å¤§å¤šæ•°åŸºå‡†ä¸Šèƒœè¿‡å¼€æºèŠå¤©æ¨¡å‹ï¼Œå¹¶ä¸”åŸºäºæˆ‘ä»¬å¯¹æœ‰ç”¨æ€§å’Œå®‰å…¨æ€§çš„äººç±»è¯„ä¼°ï¼Œå¯èƒ½æ˜¯é—­æºæ¨¡å‹çš„åˆé€‚æ›¿ä»£å“ã€‚æˆ‘ä»¬æä¾›äº†å…³äºå¾®è°ƒå’Œæ”¹è¿›Llama 2-Chatå®‰å…¨æ€§çš„æ–¹æ³•çš„è¯¦ç»†æè¿°ï¼Œä»¥ä¾¿ç¤¾åŒºèƒ½å¤Ÿåœ¨æˆ‘ä»¬çš„å·¥ä½œåŸºç¡€ä¸Šæ„å»ºï¼Œå¹¶æœ‰åŠ©äºLLMsçš„è´Ÿè´£ä»»å‘å±•ã€‚</p><p><a href="https://huggingface.co/models?search=llama2">åœ¨æ­¤å¤„æŸ¥çœ‹æ‰€æœ‰Llama2æ¨¡å‹</a></p><h3 id="æç¤ºï¼š"><a href="#æç¤ºï¼š" class="headerlink" title="æç¤ºï¼š"></a>æç¤ºï¼š</h3><ul><li>é€šè¿‡å¡«å†™<a href="https://ai.meta.com/resources/models-and-libraries/llama-downloads/">æ­¤è¡¨æ ¼</a>å¯ä»¥è·å¾—Llama2æ¨¡å‹çš„æƒé‡</li><li>è¯¥æ¶æ„ä¸ç¬¬ä¸€ä¸ªLlamaéå¸¸ç›¸ä¼¼ï¼Œå¢åŠ äº†Groupe Query Attentionï¼ˆGQAï¼‰<a href="https://arxiv.org/pdf/2305.13245.pdf">æ­¤è®ºæ–‡</a>ä¹‹å</li><li>å°†<code>config.pretraining_tp</code>è®¾ç½®ä¸ºä¸åŒäº1çš„å€¼å°†æ¿€æ´»çº¿æ€§å±‚çš„æ›´å‡†ç¡®ä½†æ›´æ…¢çš„è®¡ç®—ï¼Œè¿™åº”æ›´å¥½åœ°åŒ¹é…åŸå§‹logitsã€‚</li><li>åŸå§‹æ¨¡å‹ä½¿ç”¨<code>pad_id = -1</code>ï¼Œè¿™æ„å‘³ç€æ²¡æœ‰å¡«å……ä»¤ç‰Œã€‚æˆ‘ä»¬ä¸èƒ½ä½¿ç”¨ç›¸åŒçš„é€»è¾‘ï¼Œè¯·ç¡®ä¿ä½¿ç”¨<code>tokenizer.add_special_tokens({"pad_token":"&lt;pad&gt;"})</code>æ·»åŠ å¡«å……ä»¤ç‰Œï¼Œå¹¶ç›¸åº”åœ°è°ƒæ•´ä»¤ç‰ŒåµŒå…¥å¤§å°ã€‚æ‚¨è¿˜åº”è®¾ç½®<code>model.config.pad_token_id</code>ã€‚æ¨¡å‹çš„embed_tokenså±‚ç”¨<code>self.embed_tokens = nn.Embedding(config.vocab_size, config.hidden_size, self.config.padding_idx)</code>åˆå§‹åŒ–ï¼Œç¡®ä¿ç¼–ç å¡«å……ä»¤ç‰Œå°†è¾“å‡ºé›¶ï¼Œå› æ­¤åœ¨åˆå§‹åŒ–æ—¶ä¼ é€’å®ƒæ˜¯æ¨èçš„ã€‚</li><li>å¡«å†™è¡¨æ ¼å¹¶è·å¾—æ¨¡å‹æ£€æŸ¥ç‚¹çš„è®¿é—®æƒé™åï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿä½¿ç”¨å·²è½¬æ¢çš„æ£€æŸ¥ç‚¹ã€‚å¦åˆ™ï¼Œå¦‚æœæ‚¨æ­£åœ¨è½¬æ¢è‡ªå·±çš„æ¨¡å‹ï¼Œè¯·éšæ—¶ä½¿ç”¨è½¬æ¢è„šæœ¬ã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ï¼ˆç¤ºä¾‹ï¼‰å‘½ä»¤è°ƒç”¨è„šæœ¬ï¼š<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python src/transformers/models/llama/convert_llama_weights_to_hf.py \</span><br><span class="line">    --input_dir /path/to/downloaded/llama/weights --model_size 7B --output_dir /output/path</span><br></pre></td></tr></tbody></table></figure></li></ul><h2 id="æ¨¡å‹è¯¦æƒ…"><a href="#æ¨¡å‹è¯¦æƒ…" class="headerlink" title="æ¨¡å‹è¯¦æƒ…"></a>æ¨¡å‹è¯¦æƒ…</h2><p>æ³¨æ„ï¼šä½¿ç”¨è¯¥æ¨¡å‹å— Meta è®¸å¯è¯çš„çº¦æŸã€‚ä¸ºäº†ä¸‹è½½æ¨¡å‹æƒé‡å’Œåˆ†è¯å™¨ï¼Œè¯·è®¿é—®ç½‘ç«™å¹¶åœ¨è¯·æ±‚è®¿é—®ä¹‹å‰æ¥å—è®¸å¯è¯ã€‚</p><p>Meta å¼€å‘å¹¶å…¬å¼€å‘å¸ƒäº† Llama 2 ç³»åˆ—å¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMsï¼‰ï¼Œè¿™æ˜¯ä¸€ç³»åˆ—è§„æ¨¡ä» 70 äº¿åˆ° 700 äº¿å‚æ•°çš„é¢„è®­ç»ƒå’Œå¾®è°ƒçš„ç”Ÿæˆå¼æ–‡æœ¬æ¨¡å‹ã€‚æˆ‘ä»¬çš„å¾®è°ƒ LLMsï¼Œç§°ä¸º Llama-2-Chatï¼Œç»è¿‡ä¼˜åŒ–ç”¨äºå¯¹è¯åº”ç”¨åœºæ™¯ã€‚Llama-2-Chat æ¨¡å‹åœ¨æˆ‘ä»¬æµ‹è¯•çš„å¤§å¤šæ•°åŸºå‡†æµ‹è¯•ä¸­ä¼˜äºå¼€æºèŠå¤©æ¨¡å‹ï¼Œå¹¶åœ¨æˆ‘ä»¬çš„äººå·¥è¯„ä¼°ä¸­åœ¨æœ‰ç”¨æ€§å’Œå®‰å…¨æ€§æ–¹é¢ä¸ä¸€äº›æµè¡Œçš„é—­æºæ¨¡å‹ï¼ˆå¦‚ChatGPTå’ŒPaLMï¼‰æŒå¹³ã€‚</p><h2 id="æ¨¡å‹å¼€å‘è€…"><a href="#æ¨¡å‹å¼€å‘è€…" class="headerlink" title="æ¨¡å‹å¼€å‘è€…"></a>æ¨¡å‹å¼€å‘è€…</h2><p>Model Developers Meta</p><h2 id="ä¸åŒç‰ˆæœ¬"><a href="#ä¸åŒç‰ˆæœ¬" class="headerlink" title="ä¸åŒç‰ˆæœ¬"></a>ä¸åŒç‰ˆæœ¬</h2><p>Llama 2 æœ‰ä¸åŒè§„æ¨¡çš„å‚æ•°ç‰ˆæœ¬ï¼ŒåŒ…æ‹¬ 7Bã€13B å’Œ 70Bï¼Œä»¥åŠé¢„è®­ç»ƒå’Œå¾®è°ƒçš„å˜ä½“ã€‚</p><h2 id="è¾“å…¥è¾“å‡º"><a href="#è¾“å…¥è¾“å‡º" class="headerlink" title="è¾“å…¥è¾“å‡º"></a>è¾“å…¥è¾“å‡º</h2><p>è¾“å…¥æ¨¡å‹ä»…æ”¯æŒæ–‡æœ¬è¾“å…¥ã€‚</p><p>è¾“å‡ºæ¨¡å‹ä»…ç”Ÿæˆæ–‡æœ¬ã€‚</p><h2 id="æ¨¡å‹æ¶æ„"><a href="#æ¨¡å‹æ¶æ„" class="headerlink" title="æ¨¡å‹æ¶æ„"></a>æ¨¡å‹æ¶æ„</h2><p>Llama 2 æ˜¯ä¸€ç§è‡ªå›å½’è¯­è¨€æ¨¡å‹ï¼Œé‡‡ç”¨äº†ä¼˜åŒ–çš„ Transformer æ¶æ„ã€‚å¾®è°ƒç‰ˆæœ¬ä½¿ç”¨æœ‰ç›‘ç£çš„å¾®è°ƒï¼ˆSFTï¼‰å’ŒåŸºäºäººç±»åé¦ˆçš„å¼ºåŒ–å­¦ä¹ ï¼ˆRLHFï¼‰æ¥ä¸äººç±»å¯¹ helpfulness å’Œ safety çš„åå¥½ä¿æŒä¸€è‡´ã€‚</p><h2 id="è®­ç»ƒæ•°æ®"><a href="#è®­ç»ƒæ•°æ®" class="headerlink" title="è®­ç»ƒæ•°æ®"></a>è®­ç»ƒæ•°æ®</h2><table><thead><tr><th>æ¨¡å‹åç§°</th><th>è®­ç»ƒæ•°æ®</th><th>å‚æ•°è§„æ¨¡</th><th>å†…å®¹é•¿åº¦</th><th>GQA</th><th>Tokens</th><th>LR</th></tr></thead><tbody><tr><td>Llama 2</td><td>ä¸€ç§æ–°çš„å…¬å¼€å¯ç”¨çš„åœ¨çº¿æ•°æ®æ··åˆ</td><td>7B</td><td>4k</td><td>âœ—</td><td>2.0T</td><td>3.0 x 10-4</td></tr><tr><td>Llama 2</td><td>ä¸€ç§æ–°çš„å…¬å¼€å¯ç”¨çš„åœ¨çº¿æ•°æ®æ··åˆ</td><td>13B</td><td>4k</td><td>âœ—</td><td>2.0T</td><td>3.0 x 10-4</td></tr><tr><td>Llama 2</td><td>ä¸€ç§æ–°çš„å…¬å¼€å¯ç”¨çš„åœ¨çº¿æ•°æ®æ··åˆ</td><td>70B</td><td>4k</td><td>âœ”</td><td>2.0T</td><td>1.5 x 10-4</td></tr></tbody></table><p>æ³¨ï¼šToken counts ä»…æŒ‡é¢„è®­ç»ƒæ•°æ®ã€‚æ‰€æœ‰æ¨¡å‹éƒ½ä½¿ç”¨å…¨å±€ batch-size ä¸º 4M tokens è¿›è¡Œè®­ç»ƒã€‚è§„æ¨¡æ›´å¤§çš„æ¨¡å‹ï¼ˆ70Bï¼‰ä½¿ç”¨ Grouped-Query Attentionï¼ˆGQAï¼‰æ¥æé«˜æ¨ç†å¯ä¼¸ç¼©æ€§ã€‚</p><h2 id="æ¨¡å‹è®­ç»ƒæ—¥æœŸ"><a href="#æ¨¡å‹è®­ç»ƒæ—¥æœŸ" class="headerlink" title="æ¨¡å‹è®­ç»ƒæ—¥æœŸ"></a>æ¨¡å‹è®­ç»ƒæ—¥æœŸ</h2><p>Llama 2 åœ¨2023å¹´1æœˆè‡³2023å¹´7æœˆä¹‹é—´è¿›è¡Œè®­ç»ƒã€‚</p><h2 id="çŠ¶æ€"><a href="#çŠ¶æ€" class="headerlink" title="çŠ¶æ€"></a>çŠ¶æ€</h2><p>è¿™æ˜¯ä¸€ä¸ªåœ¨ç¦»çº¿æ•°æ®é›†ä¸Šè®­ç»ƒçš„é™æ€æ¨¡å‹ã€‚éšç€æˆ‘ä»¬æ ¹æ®ç¤¾åŒºåé¦ˆæ”¹è¿›æ¨¡å‹çš„å®‰å…¨æ€§ï¼Œå°†å‘å¸ƒå¾®è°ƒç‰ˆæœ¬çš„æœªæ¥ç‰ˆæœ¬ã€‚</p><h2 id="è®¸å¯è¯"><a href="#è®¸å¯è¯" class="headerlink" title="è®¸å¯è¯"></a>è®¸å¯è¯</h2><p>å®šåˆ¶çš„å•†ä¸šè®¸å¯è¯å¯åœ¨ä»¥ä¸‹ç½‘å€è·å–ï¼š<a href="https://ai.meta.com/resources/models-and-libraries/llama-downloads/">https://ai.meta.com/resources/models-and-libraries/llama-downloads/</a></p><h2 id="ç ”ç©¶è®ºæ–‡"><a href="#ç ”ç©¶è®ºæ–‡" class="headerlink" title="ç ”ç©¶è®ºæ–‡"></a>ç ”ç©¶è®ºæ–‡</h2><p>ã€ŠLlama-2: Open Foundation and Fine-tuned Chat Modelsã€‹</p><h2 id="ä½¿ç”¨ç›®çš„"><a href="#ä½¿ç”¨ç›®çš„" class="headerlink" title="ä½¿ç”¨ç›®çš„"></a>ä½¿ç”¨ç›®çš„</h2><h3 id="é¢„æœŸç”¨é€”"><a href="#é¢„æœŸç”¨é€”" class="headerlink" title="é¢„æœŸç”¨é€”"></a>é¢„æœŸç”¨é€”</h3><p>Llama 2 æ—¨åœ¨ç”¨äºè‹±è¯­å•†ä¸šå’Œç ”ç©¶ç”¨é€”ã€‚å¾®è°ƒæ¨¡å‹é€‚ç”¨äºç±»ä¼¼åŠ©ç†çš„èŠå¤©åº”ç”¨ï¼Œè€Œé¢„è®­ç»ƒæ¨¡å‹å¯é€‚åº”å¤šç§è‡ªç„¶è¯­è¨€ç”Ÿæˆä»»åŠ¡ã€‚</p><p>è¦è·å¾—èŠå¤©ç‰ˆæœ¬çš„é¢„æœŸåŠŸèƒ½å’Œæ€§èƒ½ï¼Œéœ€è¦éµå¾ªç‰¹å®šçš„æ ¼å¼ï¼ŒåŒ…æ‹¬ INST å’Œ &lt;<sys>&gt; æ ‡ç­¾ã€BOS å’Œ EOS tokensï¼Œä»¥åŠå®ƒä»¬ä¹‹é—´çš„ç©ºæ ¼å’Œæ¢è¡Œç¬¦ï¼ˆæˆ‘ä»¬å»ºè®®å¯¹è¾“å…¥è°ƒç”¨ strip() æ–¹æ³•ï¼Œä»¥é¿å…åŒç©ºæ ¼ï¼‰ã€‚æœ‰å…³è¯¦æƒ…ï¼Œè¯·å‚é˜…æˆ‘ä»¬åœ¨ GitHub ä¸Šçš„å‚è€ƒä»£ç ï¼šchat_completionã€‚</sys></p><h3 id="ä¸åœ¨èŒƒå›´å†…çš„ç”¨é€”"><a href="#ä¸åœ¨èŒƒå›´å†…çš„ç”¨é€”" class="headerlink" title="ä¸åœ¨èŒƒå›´å†…çš„ç”¨é€”"></a>ä¸åœ¨èŒƒå›´å†…çš„ç”¨é€”</h3><ul><li>ç”¨äºè¿åé€‚ç”¨æ³•å¾‹æ³•è§„ï¼ˆåŒ…æ‹¬è´¸æ˜“åˆè§„æ³•ï¼‰çš„ä»»ä½•æ–¹å¼ã€‚</li><li>ç”¨äºé™¤è‹±è¯­ä»¥å¤–çš„å…¶ä»–è¯­è¨€ã€‚</li><li>ç”¨äº Llama 2 å¯æ¥å—ä½¿ç”¨æ”¿ç­–å’Œè®¸å¯åè®®æ‰€ç¦æ­¢çš„ä»»ä½•å…¶ä»–æ–¹å¼ã€‚</li></ul><h2 id="ç¡¬ä»¶å’Œè½¯ä»¶"><a href="#ç¡¬ä»¶å’Œè½¯ä»¶" class="headerlink" title="ç¡¬ä»¶å’Œè½¯ä»¶"></a>ç¡¬ä»¶å’Œè½¯ä»¶</h2><h3 id="è®­ç»ƒå› ç´ "><a href="#è®­ç»ƒå› ç´ " class="headerlink" title="è®­ç»ƒå› ç´ "></a>è®­ç»ƒå› ç´ </h3><p>æˆ‘ä»¬ä½¿ç”¨è‡ªå®šä¹‰è®­ç»ƒåº“ã€Meta çš„ Research Super Cluster ä»¥åŠç”Ÿäº§é›†ç¾¤è¿›è¡Œé¢„è®­ç»ƒã€‚å¾®è°ƒã€æ ‡æ³¨å’Œè¯„ä¼°ä¹Ÿæ˜¯åœ¨ç¬¬ä¸‰æ–¹äº‘è®¡ç®—ä¸Šæ‰§è¡Œçš„ã€‚</p><h3 id="ç¢³è¶³è¿¹"><a href="#ç¢³è¶³è¿¹" class="headerlink" title="ç¢³è¶³è¿¹"></a>ç¢³è¶³è¿¹</h3><p>é¢„è®­ç»ƒè¿‡ç¨‹ä¸­ä½¿ç”¨äº†ç´¯è®¡ 330 ä¸‡ GPU å°æ—¶çš„è®¡ç®—ï¼Œä½¿ç”¨çš„ç¡¬ä»¶ç±»å‹ä¸º A100-80GBï¼ˆTDP ä¸º 350-400Wï¼‰ã€‚é¢„è®¡æ€»æ’æ”¾é‡ä¸º 539 tCO2eqï¼Œå…¶ä¸­ 100% ç”± Meta çš„å¯æŒç»­æ€§è®¡åˆ’æŠµæ¶ˆã€‚</p><table><thead><tr><th>æ¨¡å‹</th><th>æ—¶é—´ï¼ˆGPU å°æ—¶ï¼‰</th><th>åŠŸè€—ï¼ˆç“¦ï¼‰</th><th>æ’æ”¾ç¢³é‡ï¼ˆtCO2eqï¼‰</th></tr></thead><tbody><tr><td>Llama 2 7B</td><td>184,320</td><td>400</td><td>31.22</td></tr><tr><td>Llama 2 13B</td><td>368,640</td><td>400</td><td>62.44</td></tr><tr><td>Llama 2 70B</td><td>1,720,320</td><td>400</td><td>291.42</td></tr><tr><td>æ€»è®¡</td><td>3,311,616</td><td></td><td>539.00</td></tr></tbody></table><p>é¢„è®­ç»ƒæœŸé—´çš„äºŒæ°§åŒ–ç¢³æ’æ”¾é‡ã€‚æ—¶é—´ï¼šæ¯ä¸ªæ¨¡å‹è®­ç»ƒæ‰€éœ€çš„æ€» GPU æ—¶é—´ã€‚åŠŸè€—ï¼šç”¨äºæ‰€ä½¿ç”¨çš„ GPU è®¾å¤‡çš„æ¯ä¸ª GPU çš„å³°å€¼åŠŸç‡å®¹é‡ï¼Œè°ƒæ•´åçš„</p><p>åŠŸè€—ä½¿ç”¨æ•ˆç‡ã€‚100% çš„æ’æ”¾ç›´æ¥ç”± Meta çš„å¯æŒç»­æ€§è®¡åˆ’æŠµæ¶ˆï¼Œå› ä¸ºæˆ‘ä»¬æ­£åœ¨å…¬å¼€å‘å¸ƒè¿™äº›æ¨¡å‹ï¼Œé¢„è®­ç»ƒæˆæœ¬ä¸éœ€è¦ç”±ä»–äººæ‰¿æ‹…ã€‚</p><h2 id="è®­ç»ƒæ•°æ®-1"><a href="#è®­ç»ƒæ•°æ®-1" class="headerlink" title="è®­ç»ƒæ•°æ®"></a>è®­ç»ƒæ•°æ®</h2><h3 id="æ¦‚è¿°-1"><a href="#æ¦‚è¿°-1" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h3><p>Llama 2 åœ¨æ¥è‡ªå…¬å¼€æ¥æºçš„æ•°æ®ä¸­é¢„è®­ç»ƒäº† 2 ä¸‡äº¿ä¸ª tokensã€‚å¾®è°ƒæ•°æ®åŒ…æ‹¬å…¬å¼€å¯ç”¨çš„æŒ‡å¯¼æ•°æ®é›†ï¼Œä»¥åŠä¸€ç™¾ä¸‡ä¸ªæ–°çš„äººå·¥æ ‡æ³¨ç¤ºä¾‹ã€‚é¢„è®­ç»ƒå’Œå¾®è°ƒæ•°æ®é›†å‡ä¸åŒ…å« Meta ç”¨æˆ·æ•°æ®ã€‚</p><h3 id="æ•°æ®æ–°é²œåº¦"><a href="#æ•°æ®æ–°é²œåº¦" class="headerlink" title="æ•°æ®æ–°é²œåº¦"></a>æ•°æ®æ–°é²œåº¦</h3><p>é¢„è®­ç»ƒæ•°æ®æˆªæ­¢æ—¥æœŸä¸º 2022 å¹´ 9 æœˆï¼Œä½†ä¸€äº›å¾®è°ƒæ•°æ®æ›´è¿‘ï¼Œæœ€å¤šè‡³ 2023 å¹´ 7 æœˆã€‚</p><h2 id="è¯„ä¼°ç»“æœ"><a href="#è¯„ä¼°ç»“æœ" class="headerlink" title="è¯„ä¼°ç»“æœ"></a>è¯„ä¼°ç»“æœ</h2><p>åœ¨æ­¤éƒ¨åˆ†ï¼Œæˆ‘ä»¬æŠ¥å‘Šäº† Llama 1 å’Œ Llama 2 æ¨¡å‹åœ¨æ ‡å‡†å­¦æœ¯åŸºå‡†æµ‹è¯•ä¸Šçš„ç»“æœã€‚å¯¹äºæ‰€æœ‰è¯„ä¼°ï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬çš„å†…éƒ¨è¯„ä¼°åº“ã€‚</p><table><thead><tr><th>æ¨¡å‹</th><th>è§„æ¨¡</th><th>Code</th><th>å¸¸è¯†æ¨ç†</th><th>ä¸–ç•ŒçŸ¥è¯†</th><th>é˜…è¯»ç†è§£</th><th>æ•°å­¦</th><th>MMLU</th><th>BBH</th><th>AGI Eval</th></tr></thead><tbody><tr><td>Llama 1</td><td>7B</td><td>14.1</td><td>60.8</td><td>46.2</td><td>58.5</td><td>6.95</td><td>35.1</td><td>30.3</td><td>23.9</td></tr><tr><td>Llama 1</td><td>13B</td><td>18.9</td><td>66.1</td><td>52.6</td><td>62.3</td><td>10.9</td><td>46.9</td><td>37.0</td><td>33.9</td></tr><tr><td>Llama 1</td><td>33B</td><td>26.0</td><td>70.0</td><td>58.4</td><td>67.6</td><td>21.4</td><td>57.8</td><td>39.8</td><td>41.7</td></tr><tr><td>Llama 1</td><td>65B</td><td>30.7</td><td>70.7</td><td>60.5</td><td>68.6</td><td>30.8</td><td>63.4</td><td>43.5</td><td>47.6</td></tr><tr><td>Llama 2</td><td>7B</td><td>16.8</td><td>63.9</td><td>48.9</td><td>61.3</td><td>14.6</td><td>45.3</td><td>32.6</td><td>29.3</td></tr><tr><td>Llama 2</td><td>13B</td><td>24.5</td><td>66.9</td><td>55.4</td><td>65.8</td><td>28.7</td><td>54.8</td><td>39.4</td><td>39.1</td></tr><tr><td>Llama 2</td><td>70B</td><td>37.5</td><td>71.9</td><td>63.6</td><td>69.4</td><td>35.2</td><td>68.9</td><td>51.2</td><td>54.2</td></tr></tbody></table><p>æ¨¡å‹åœ¨ grouped academic benchmarks ä¸Šçš„æ•´ä½“è¡¨ç°ã€‚Codeï¼šæˆ‘ä»¬æŠ¥å‘Šæ¨¡å‹åœ¨ HumanEval å’Œ MBPP ä¸Šçš„å¹³å‡ pass@1 åˆ†æ•°ã€‚å¸¸è¯†æ¨ç†ï¼šæˆ‘ä»¬æŠ¥å‘Š PIQAã€SIQAã€HellaSwagã€WinoGrandeã€ARC easy å’Œ challengeã€OpenBookQA å’Œ CommonsenseQA çš„å¹³å‡åˆ†æ•°ã€‚æˆ‘ä»¬å¯¹ CommonSenseQA è¿›è¡Œäº† 7-shot ç»“æœè¯„ä¼°ï¼Œå¯¹å…¶ä»–æ‰€æœ‰åŸºå‡†æµ‹è¯•è¿›è¡Œäº† 0-shot ç»“æœè¯„ä¼°ã€‚ä¸–ç•ŒçŸ¥è¯†ï¼šæˆ‘ä»¬åœ¨ NaturalQuestions å’Œ TriviaQA ä¸Šè¿›è¡Œ 5-shot æ€§èƒ½è¯„ä¼°å¹¶æŠ¥å‘Šå¹³å‡åˆ†æ•°ã€‚é˜…è¯»ç†è§£ï¼šå¯¹äºé˜…è¯»ç†è§£ï¼Œæˆ‘ä»¬æŠ¥å‘Š SQuADã€QuAC å’Œ BoolQ çš„ 0-shot å¹³å‡åˆ†æ•°ã€‚æ•°å­¦ï¼šæˆ‘ä»¬æŠ¥å‘Š GSM8Kï¼ˆ8-shotï¼‰å’Œ MATHï¼ˆ4-shotï¼‰åŸºå‡†æµ‹è¯•çš„å¹³å‡åˆ†æ•°ã€‚</p><h3 id="TruthfulQA-å’Œ-Toxigen"><a href="#TruthfulQA-å’Œ-Toxigen" class="headerlink" title="TruthfulQA å’Œ Toxigen"></a>TruthfulQA å’Œ Toxigen</h3><table><thead><tr><th>æ¨¡å‹</th><th>è§„æ¨¡</th><th>TruthfulQA</th><th>Toxigen</th></tr></thead><tbody><tr><td>Llama 1</td><td>7B</td><td>27.42</td><td>23.00</td></tr><tr><td>Llama 1</td><td>13B</td><td>41.74</td><td>23.08</td></tr><tr><td>Llama 1</td><td>33B</td><td>44.19</td><td>22.57</td></tr><tr><td>Llama 1</td><td>65B</td><td>48.71</td><td>21.77</td></tr><tr><td>Llama 2</td><td>7B</td><td>33.29</td><td>21.25</td></tr><tr><td>Llama 2</td><td>13B</td><td>41.86</td><td>26.10</td></tr><tr><td>Llama 2</td><td>70B</td><td>50.18</td><td>24.60</td></tr></tbody></table><p>é¢„è®­ç»ƒ LLMs åœ¨è‡ªåŠ¨å®‰å…¨åŸºå‡†æµ‹è¯•ä¸Šçš„è¯„ä¼°ç»“æœã€‚å¯¹äº TruthfulQAï¼Œæˆ‘ä»¬å‘ˆç°åŒæ—¶å…·æœ‰çœŸå®æ€§å’Œä¿¡æ¯é‡çš„ç”Ÿæˆç™¾åˆ†æ¯”ï¼ˆç™¾åˆ†æ¯”è¶Šé«˜è¶Šå¥½ï¼‰ã€‚å¯¹äº ToxiGenï¼Œæˆ‘ä»¬å‘ˆç°æœ‰å®³ç”Ÿæˆçš„ç™¾åˆ†æ¯”ï¼ˆç™¾åˆ†æ¯”è¶Šå°è¶Šå¥½ï¼‰ã€‚</p><h3 id="TruthfulQA-å’Œ-Toxigenï¼ˆå¾®è°ƒç‰ˆæœ¬-LLMsï¼‰"><a href="#TruthfulQA-å’Œ-Toxigenï¼ˆå¾®è°ƒç‰ˆæœ¬-LLMsï¼‰" class="headerlink" title="TruthfulQA å’Œ Toxigenï¼ˆå¾®è°ƒç‰ˆæœ¬ LLMsï¼‰"></a>TruthfulQA å’Œ Toxigenï¼ˆå¾®è°ƒç‰ˆæœ¬ LLMsï¼‰</h3><table><thead><tr><th>æ¨¡å‹</th><th>è§„æ¨¡</th><th>TruthfulQA</th><th>Toxigen</th></tr></thead><tbody><tr><td>Llama-2-Chat</td><td>7B</td><td>57.04</td><td>0.00</td></tr><tr><td>Llama-2-Chat</td><td>13B</td><td>62.18</td><td>0.00</td></tr><tr><td>Llama-2-Chat</td><td>70B</td><td>64.14</td><td>0.01</td></tr></tbody></table><p>ä¸åŒå®‰å…¨æ•°æ®é›†ä¸Šå¾®è°ƒ LLMs çš„è¯„ä¼°ç»“æœã€‚åº¦é‡æ ‡å‡†å®šä¹‰åŒä¸Šã€‚</p><h2 id="é“å¾·è€ƒè™‘å’Œå±€é™æ€§"><a href="#é“å¾·è€ƒè™‘å’Œå±€é™æ€§" class="headerlink" title="é“å¾·è€ƒè™‘å’Œå±€é™æ€§"></a>é“å¾·è€ƒè™‘å’Œå±€é™æ€§</h2><p>Llama 2 æ˜¯ä¸€é¡¹å…·æœ‰é£é™©çš„æ–°æŠ€æœ¯ã€‚è¿„ä»Šä¸ºæ­¢çš„æµ‹è¯•ä»…æ¶µç›–äº†è‹±è¯­ï¼Œå¹¶ä¸”æ— æ³•è¦†ç›–æ‰€æœ‰åœºæ™¯ã€‚å› æ­¤ï¼Œä¸æ‰€æœ‰ LLMs ä¸€æ ·ï¼ŒLlama 2 çš„æ½œåœ¨è¾“å‡ºæ— æ³•äº‹å…ˆé¢„æµ‹ï¼Œå¹¶ä¸”åœ¨æŸäº›æƒ…å†µä¸‹å¯èƒ½ä¼šäº§ç”Ÿä¸å‡†ç¡®ã€å¸¦åè§æˆ–å…¶ä»–ä¸å¯å–çš„å“åº”ã€‚å› æ­¤ï¼Œåœ¨éƒ¨ç½²ä»»ä½• Llama 2 åº”ç”¨ç¨‹åºä¹‹å‰ï¼Œå¼€å‘äººå‘˜åº”æ ¹æ®å…¶ç‰¹å®šçš„æ¨¡å‹åº”ç”¨è¿›è¡Œå®‰å…¨æµ‹è¯•å’Œè°ƒæ•´ã€‚</p><p>è¯·å‚é˜…â€œè´Ÿè´£ä»»ä½¿ç”¨æŒ‡å—â€ï¼Œç½‘å€ä¸ºï¼š<a href="https://ai.meta.com/llama/responsible-use-guide/">https://ai.meta.com/llama/responsible-use-guide/</a></p><h2 id="æŠ¥å‘Šé—®é¢˜"><a href="#æŠ¥å‘Šé—®é¢˜" class="headerlink" title="æŠ¥å‘Šé—®é¢˜"></a>æŠ¥å‘Šé—®é¢˜</h2><p>è¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼ä¹‹ä¸€æŠ¥å‘Šä»»ä½•è½¯ä»¶â€œbugâ€æˆ–æ¨¡å‹çš„å…¶ä»–é—®é¢˜ï¼š</p><ul><li>æŠ¥å‘Šæ¨¡å‹é—®é¢˜ï¼š[github.com/facebookresearch/llama](<a href="https://github/">https://github</a></li></ul><p>.com/facebookresearch/llama)</p><ul><li>æŠ¥å‘Šæ¨¡å‹ç”Ÿæˆçš„æœ‰é—®é¢˜å†…å®¹ï¼š<a href="https://developers.facebook.com/llama_output_feedback">developers.facebook.com/llama_output_feedback</a></li><li>æŠ¥å‘Š bug å’Œå®‰å…¨é—®é¢˜ï¼š<a href="https://facebook.com/whitehat/info">facebook.com/whitehat/info</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> NLP Insights </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LLM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LONGNET - Scaling Transformers to 1,000,000,000 Tokens</title>
      <link href="/2023/07/28/NLP%20Insights/LONGNET/"/>
      <url>/2023/07/28/NLP%20Insights/LONGNET/</url>
      
        <content type="html"><![CDATA[<h1 id="LONGNETï¼šå°†Transformeræ‰©å±•åˆ°10äº¿ä¸ªæ ‡è®°"><a href="#LONGNETï¼šå°†Transformeræ‰©å±•åˆ°10äº¿ä¸ªæ ‡è®°" class="headerlink" title="LONGNETï¼šå°†Transformeræ‰©å±•åˆ°10äº¿ä¸ªæ ‡è®°"></a>LONGNETï¼šå°†Transformeræ‰©å±•åˆ°10äº¿ä¸ªæ ‡è®°</h1><p>åœ¨æœ¬ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†è¯¦ç»†è®¨è®ºä¸€ä¸ªè¿‘æœŸå‘å¸ƒçš„å…ˆè¿›æ¨¡å‹â€”â€”â€œLongNetâ€ã€‚è¯¥æ¨¡å‹ç”±å¾®è½¯äºšæ´²ç ”ç©¶é™¢ç ”å‘ï¼Œäºå¤§çº¦ä¸¤å‘¨å‰æ­£å¼å…¬å¸ƒã€‚LongNetåŸºäºTransformeræ¨¡å‹æ„å»ºï¼Œå…¶æ ¸å¿ƒç†å¿µåœ¨äºæ‹“å±•Transformerçš„åº”ç”¨è§„æ¨¡ã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼Œç ”ç©¶å›¢é˜ŸæˆåŠŸåœ°å°†å…¶æ‰©å±•è‡³å¤„ç†10äº¿ä¸ªä»¤ç‰Œçš„è§„æ¨¡ã€‚å¯¹äºç†Ÿæ‚‰è¯­è¨€æ¨¡å‹çš„äººæ¥è¯´ï¼Œä¼šæ˜ç™½åºåˆ—é•¿åº¦å¯¹æ¨¡å‹æ€§èƒ½çš„å½±å“ï¼Œå› ä¸ºåºåˆ—é•¿åº¦å†³å®šäº†åœ¨æ‰§è¡Œæ³¨æ„åŠ›æœºåˆ¶æ—¶ï¼Œèƒ½å¤Ÿå…³è”çš„ä»¤ç‰Œæ•°é‡ï¼Œä»è€Œå½±å“æ¨¡å‹å¯ä»¥è·å–çš„ä¸Šä¸‹æ–‡ä¿¡æ¯é•¿åº¦ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¸Œæœ›åƒGPTè¿™æ ·çš„æ¨¡å‹èƒ½æ‹¥æœ‰æ›´é•¿çš„ä¸Šä¸‹æ–‡ï¼Œä½¿å¾—æ¨¡å‹å¯ä»¥å‚è€ƒæ›´ä¹…ä¹‹å‰çš„å•è¯æ¥é¢„æµ‹ä¸‹ä¸€ä¸ªä»¤ç‰Œã€‚è€ŒLongNetå°±æˆåŠŸåœ°å°†è¿™ä¸ªèƒ½åŠ›æ‰©å±•åˆ°äº†10äº¿ä¸ªä»¤ç‰Œã€‚ä»¥ä¸‹å›¾ä¸ºä¾‹ï¼Œå¯ä»¥æ¸…æ™°çœ‹å‡ºï¼ŒGPTçš„åºåˆ—é•¿åº¦ä»…ä¸º512ï¼Œè€ŒPower Transformerçš„åºåˆ—é•¿åº¦å¯æ‰©å±•è‡³12ã€000ã€64ã€262ã€000ã€ç”šè‡³1000ä¸‡ï¼Œç„¶è€ŒLongNetå°†åºåˆ—é•¿åº¦æ‰©å±•è‡³æƒŠäººçš„10äº¿ä¸ªä»¤ç‰Œã€‚è¯•æƒ³ä¸€ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ‰€æœ‰ç»´åŸºç™¾ç§‘çš„æ–‡æœ¬ä¿¡æ¯è¾“å…¥åˆ°æ¨¡å‹ä¸­ï¼Œæ¨¡å‹å¯ä»¥åˆ©ç”¨æ‰€æœ‰è¿™äº›ä»¤ç‰Œè¿›è¡Œæ³¨æ„åŠ›è®¡ç®—ã€‚æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬é¦–å…ˆæ¥äº†è§£ä¸€ä¸‹LongNetçš„å·¥ä½œåŸç†ã€‚</p><h2 id="æ‘˜è¦"><a href="#æ‘˜è¦" class="headerlink" title="æ‘˜è¦"></a>æ‘˜è¦</h2><p>åœ¨å¤§å‹è¯­è¨€æ¨¡å‹æ—¶ä»£ï¼Œæ‰©å±•åºåˆ—é•¿åº¦å·²æˆä¸ºä¸€ä¸ªé‡è¦éœ€æ±‚ã€‚ç„¶è€Œï¼Œç°æœ‰æ–¹æ³•åœ¨å¤„ç†è®¡ç®—å¤æ‚æ€§æˆ–æ¨¡å‹è¡¨è¾¾èƒ½åŠ›æ—¶é‡åˆ°å›°éš¾ï¼Œå¯¼è‡´æœ€å¤§åºåˆ—é•¿åº¦å—é™ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¼•å…¥äº†LONGNETï¼Œè¿™æ˜¯ä¸€ç§Transformerå˜ä½“ï¼Œå¯ä»¥å°†åºåˆ—é•¿åº¦æ‰©å±•åˆ°10äº¿ä¸ªæ ‡è®°ä»¥ä¸Šï¼ŒåŒæ—¶ä¸æŸå®³å¯¹è¾ƒçŸ­åºåˆ—çš„æ€§èƒ½ã€‚å…·ä½“è€Œè¨€ï¼Œæˆ‘ä»¬æå‡ºäº†æ‰©å¼ æ³¨æ„åŠ›ï¼ˆdilated attentionï¼‰ï¼Œéšç€è·ç¦»å¢åŠ ï¼Œå®ƒä»¥æŒ‡æ•°çº§æ‰©å±•æ³¨æ„åŠ›èŒƒå›´ã€‚LONGNETæœ‰æ˜¾è‘—çš„ä¼˜åŠ¿ï¼š1ï¼‰å®ƒå…·æœ‰çº¿æ€§è®¡ç®—å¤æ‚æ€§ï¼Œå¹¶ä¸”åºåˆ—ä¸­ä»»æ„ä¸¤ä¸ªæ ‡è®°ä¹‹é—´å­˜åœ¨å¯¹æ•°ä¾èµ–å…³ç³»ï¼›2ï¼‰å®ƒå¯ä»¥ä½œä¸ºåˆ†å¸ƒå¼è®­ç»ƒå™¨ç”¨äºéå¸¸é•¿çš„åºåˆ—ï¼›3ï¼‰å®ƒçš„æ‰©å¼ æ³¨æ„åŠ›å¯ä»¥æ— ç¼æ›¿æ¢æ ‡å‡†æ³¨æ„åŠ›ï¼Œå¹¶ä¸”å¯ä»¥ä¸ç°æœ‰åŸºäºTransformerçš„ä¼˜åŒ–æ–¹æ³•æ— ç¼é›†æˆã€‚å®éªŒç»“æœè¡¨æ˜ï¼ŒLONGNETåœ¨é•¿åºåˆ—å»ºæ¨¡å’Œä¸€èˆ¬è¯­è¨€ä»»åŠ¡ä¸Šè¡¨ç°å‡ºå¼ºå¤§çš„æ€§èƒ½ã€‚æˆ‘ä»¬çš„å·¥ä½œä¸ºå»ºæ¨¡éå¸¸é•¿çš„åºåˆ—æ‰“å¼€äº†æ–°çš„å¯èƒ½æ€§ï¼Œä¾‹å¦‚å°†æ•´ä¸ªè¯­æ–™åº“ç”šè‡³æ•´ä¸ªäº’è”ç½‘è§†ä¸ºä¸€ä¸ªåºåˆ—ã€‚</p><img src="/2023/07/28/NLP%20Insights/LONGNET/Figure_1.png" class="" title="Figure 1: Trend of Transformer sequence lengths over time."><h3 id="LongNetçš„ä¼˜ç‚¹"><a href="#LongNetçš„ä¼˜ç‚¹" class="headerlink" title="LongNetçš„ä¼˜ç‚¹"></a>LongNetçš„ä¼˜ç‚¹</h3><p>LongNetå…·æœ‰å¤šç§ä¼˜ç‚¹ã€‚é¦–å…ˆï¼Œå…¶è®¡ç®—å¤æ‚åº¦ä¸åºåˆ—é•¿åº¦å‘ˆçº¿æ€§å…³ç³»ï¼Œç¨åå°†å…·ä½“è§£é‡ŠåŸå› ã€‚å…¶æ¬¡ï¼Œä»¤ç‰Œä¹‹é—´å­˜åœ¨å¯¹æ•°ä¾èµ–ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸¤ä¸ªè·ç¦»è¾ƒè¿œçš„ä»¤ç‰Œä¹‹é—´çš„ä¾èµ–æ€§è¾ƒå¼±ï¼Œè€Œè·ç¦»è¾ƒè¿‘çš„ä»¤ç‰Œä¹‹é—´çš„ä¾èµ–æ€§è¾ƒå¼ºã€‚æ­¤å¤–ï¼Œå®ƒå¯åœ¨åˆ†å¸ƒå¼ç½‘ç»œä¸­è¿›è¡Œè®­ç»ƒï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥åˆ©ç”¨åˆ†å¸ƒå¼ç³»ç»Ÿè®¡ç®—è¯¥æ³¨æ„åŠ›æœºåˆ¶ï¼Œå¦‚ä½¿ç”¨å¤šä¸ªGPUæˆ–å¤šå°è®¡ç®—æœºã€‚åŒæ—¶ï¼ŒLongNetå¯ä»¥ä½œä¸ºæ ‡å‡†æ³¨æ„åŠ›çš„æ›¿ä»£å“ï¼Œè¿™æ„å‘³ç€å¦‚æœæˆ‘ä»¬å·²ç»æœ‰ä¸€ä¸ªä½¿ç”¨æ³¨æ„åŠ›æœºåˆ¶çš„æ¨¡å‹ï¼Œæˆ‘ä»¬åªéœ€å°†æ³¨æ„åŠ›æœºåˆ¶æ›¿æ¢ä¸ºLongNetçš„æœºåˆ¶ï¼Œæ— éœ€æ”¹å˜æ¨¡å‹çš„å…¶ä»–éƒ¨åˆ†ï¼Œæ¨¡å‹ä»ç„¶èƒ½å¤Ÿåƒä»¥å‰ä¸€æ ·è¿è¡Œï¼Œä½†é€šè¿‡ä½¿ç”¨è¿™ç§æ”¹è¿›çš„æ³¨æ„åŠ›æœºåˆ¶ï¼Œå¯ä»¥å¤„ç†æ›´é•¿çš„åºåˆ—é•¿åº¦ã€‚</p><h3 id="å…³äºTransformeræ¨¡å‹çš„æ¢³ç†"><a href="#å…³äºTransformeræ¨¡å‹çš„æ¢³ç†" class="headerlink" title="å…³äºTransformeræ¨¡å‹çš„æ¢³ç†"></a>å…³äºTransformeræ¨¡å‹çš„æ¢³ç†</h3><p>è‡ªæ³¨æ„åŠ›æœºåˆ¶ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†è¢«ç§°ä¸ºâ€œQã€Kã€Vâ€çš„çŸ©é˜µã€‚å…¶ä¸­ï¼Œâ€œQâ€çŸ©é˜µä»£è¡¨æŸ¥è¯¢ï¼Œå…¶è§„æ¨¡ä¸ºâ€œåºåˆ—é•¿åº¦ä¹˜ä»¥æ¨¡å‹å¤§å°â€ï¼Œæ¨¡å‹å¤§å°æŒ‡çš„æ˜¯æ¯ä¸ªè¯åµŒå…¥çš„å‘é‡è¡¨ç¤ºã€‚å½“æˆ‘ä»¬è®¡ç®—æŸ¥è¯¢ä¸é”®ï¼ˆKï¼‰çš„ä¹˜ç§¯ï¼Œæˆ–è€…æŸ¥è¯¢ä¸Kçš„è½¬ç½®çš„ä¹˜ç§¯æ¥äº§ç”Ÿæ­¤çŸ©é˜µæ—¶ï¼Œæ‰€éœ€çš„æ“ä½œæ¬¡æ•°æ˜¯â€œåºåˆ—é•¿åº¦çš„å¹³æ–¹ä¹˜ä»¥æ¨¡å‹å¤§å°â€ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦ä¸ºçŸ©é˜µä¸­çš„æ¯ä¸ªå…ƒç´ è®¡ç®—ç‚¹ç§¯ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè‡ªæ³¨æ„åŠ›çš„å¤æ‚åº¦æ˜¯â€œåºåˆ—é•¿åº¦çš„å¹³æ–¹ä¹˜ä»¥æ¨¡å‹å¤§å°â€ã€‚è¿™ä¸ªæ¯”è¾ƒåœ¨ç›¸å…³è®ºæ–‡ä¸­ä¹Ÿæœ‰è¯¦ç»†æè¿°ï¼Œå¸¸è§„çš„æ³¨æ„åŠ›å¤æ‚åº¦æ˜¯â€œåºåˆ—é•¿åº¦çš„å¹³æ–¹ä¹˜ä»¥æ¨¡å‹å¤§å°â€ï¼Œç„¶è€ŒLongNetè¿™ç§æ–°æ¨¡å‹ï¼Œå…¶æ³¨æ„åŠ›æœºåˆ¶å¤æ‚åº¦ä»…ä¸ºâ€œåºåˆ—é•¿åº¦ä¹˜ä»¥æ¨¡å‹å¤§å°â€ï¼Œä¸‹æ–‡æˆ‘å°†è¯´æ˜å¦‚ä½•å®ç°è¿™ç§çº¿æ€§å¤æ‚åº¦ã€‚</p><img src="/2023/07/28/NLP%20Insights/LONGNET/image-5.png" class="" title="Figure 2"><h3 id="LongNetçš„æ³¨æ„åŠ›åˆ†é…åŸç†"><a href="#LongNetçš„æ³¨æ„åŠ›åˆ†é…åŸç†" class="headerlink" title="LongNetçš„æ³¨æ„åŠ›åˆ†é…åŸç†"></a>LongNetçš„æ³¨æ„åŠ›åˆ†é…åŸç†</h3><p>LongNetçš„æ ¸å¿ƒåŸç†æ˜¯ï¼Œä»¤ç‰Œé—´çš„æ³¨æ„åŠ›åˆ†é…ä¼šéšç€å®ƒä»¬ä¹‹é—´è·ç¦»çš„å¢åŠ è€Œå‘ˆæŒ‡æ•°çº§åœ°å‡å°ã€‚è®©æˆ‘ä»¬å‚ç…§å›¾è¡¨æ¥ç†è§£å®ƒçš„è¿ä½œæ–¹å¼ã€‚åœ¨ä¼ ç»Ÿæ–¹å¼ä¸­ï¼Œæˆ‘ä»¬è®¡ç®—æ‰€æœ‰ä»¤ç‰Œä¸å…¶ä»–æ‰€æœ‰ä»¤ç‰Œä¹‹é—´çš„æ³¨æ„åŠ›ï¼Œä½†LongNetå¹¶æœªå¦‚æ­¤æ“ä½œã€‚å®ƒé‡‡ç”¨äº†ä¸€ç§å°†åºåˆ—åˆ‡åˆ†ä¸ºä¸åŒå¤§å°çª—å£çš„æ–¹æ³•ã€‚é¦–å…ˆï¼Œä»¥4ä¸ºçª—å£å¤§å°ä¸ºä¾‹ï¼Œè¿™é‡Œçš„â€œNâ€æ˜¯åºåˆ—çš„ä»¤ç‰Œæ•°ï¼Œæˆ‘ä»¬å°†å…¶åˆ†æˆå››ä¸ªå¤§å°ä¸º4çš„æ®µï¼Œå¹¶è®¡ç®—è¿™ä¸ªå°çª—å£å†…çš„æ‰€æœ‰è¯ä¸å…¶ä»–è¯ä¹‹é—´çš„æ³¨æ„åŠ›ã€‚ç„¶åï¼Œæˆ‘ä»¬å¯¹æ‰€æœ‰è¿™äº›å°æ®µä¸­çš„è¯æ‰§è¡ŒåŒæ ·çš„æ“ä½œï¼Œæ¥ç€ä½¿ç”¨æ›´å¤§çš„çª—å£ï¼Œè¿™æ¬¡çª—å£å¤§å°ä¸º8ã€‚å¦‚æ­¤ç±»æ¨ï¼Œç›´åˆ°è¦†ç›–æ•´ä¸ªåºåˆ—é•¿åº¦ï¼Œç„¶åæˆ‘ä»¬å†ä»¥å¢åŠ çª—å£å¤§å°çš„æ–¹å¼è¿›è¡Œæ“ä½œï¼ŒåŒæ—¶æˆ‘ä»¬ä¹Ÿå¢åŠ äº†è·³è¿‡çš„ä»¤ç‰Œæ•°ï¼Œå³â€œRâ€ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆè®¡ç®—å¤§å°ä¸º8çš„çª—å£ï¼Œç„¶åå°†â€œRâ€è®¾ä¸º2ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬ä¼šè·³è¿‡ä¸€ä¸ªä»¤ç‰Œï¼Œç„¶åè®¡ç®—æ³¨æ„åŠ›ï¼Œå†è·³è¿‡ä¸€ä¸ªä»¤ç‰Œï¼Œç»§ç»­è®¡ç®—æ³¨æ„åŠ›ã€‚ä»¥è¿™ç§æ–¹å¼ï¼Œéšç€çª—å£å¤§å°å’Œè·³è¿‡çš„ä»¤ç‰Œæ•°çš„å¢åŠ ï¼Œè®¡ç®—çš„å¤æ‚åº¦å˜å¾—æ›´å°ï¼Œå› ä¸ºæˆ‘ä»¬å¹¶ä¸æ˜¯è®¡ç®—æ¯ä¸ªä»¤ç‰Œä¸æ‰€æœ‰å…¶ä»–ä»¤ç‰Œä¹‹é—´çš„æ³¨æ„åŠ›ï¼Œè€Œæ˜¯åªè®¡ç®—åœ¨æœ‰é™èŒƒå›´å†…çš„æ³¨æ„åŠ›ã€‚è¿™æ ·ï¼ŒLongNetçš„æ³¨æ„åŠ›åˆ†é…å°±éµå¾ªäº†å¯¹æ•°ä¾èµ–çš„åŸåˆ™ï¼Œå³ï¼Œè·ç¦»è¾ƒè¿œçš„ä»¤ç‰Œä¹‹é—´çš„ä¾èµ–æ€§è¾ƒå¼±ï¼Œè€Œè·ç¦»è¾ƒè¿‘çš„ä»¤ç‰Œä¹‹é—´çš„ä¾èµ–æ€§è¾ƒå¼ºã€‚è¿™æ˜¯LongNetèƒ½åœ¨æ›´å¤§åºåˆ—é•¿åº¦ä¸Šè¿›è¡Œå·¥ä½œçš„å…³é”®ã€‚<br>æ‰©å±•æ³¨æ„åŠ›ç”±ä¸€ç³»åˆ—ç”¨äºå»ºæ¨¡çŸ­ç¨‹å’Œé•¿ç¨‹ä¾èµ–å…³ç³»çš„æ³¨æ„åŠ›æ¨¡å¼ç»„æˆï¼Œæ³¨æ„åŠ›æ¨¡å¼çš„æ•°é‡å¯ä»¥æ ¹æ®åºåˆ—é•¿åº¦è¿›è¡Œæ‰©å±•ã€‚åœ¨æ¯ä¸ªæ³¨æ„åŠ›æ¨¡å¼ä¸­ï¼ŒæŸ¥è¯¢å‘é‡å’Œé”®å‘é‡ä¹‹é—´çš„ç‚¹ç§¯è¢«åˆ†è§£ä¸ºå¤šä¸ªå­ç‚¹ç§¯ï¼Œæ¯ä¸ªå­ç‚¹ç§¯ä»…æ¶‰åŠåˆ°ä¸€å°éƒ¨åˆ†çš„é”®å‘é‡ã€‚è¿™ç§åˆ†è§£æ–¹å¼å¯ä»¥å‡å°‘è®¡ç®—å¤æ‚åº¦ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥ä½¿æ¨¡å‹æ›´å¥½åœ°å¤„ç†é•¿åºåˆ—ã€‚å…·ä½“å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><img src="/2023/07/28/NLP%20Insights/LONGNET/image.png" class="" title="Figure 3"><img src="/2023/07/28/NLP%20Insights/LONGNET/image-4.png" class="" title="Figure 4"><p>æ‰©å¼ æ³¨æ„åŠ›è¿˜å¼•å…¥äº†â€œå¤šå¤´â€æœºåˆ¶ï¼Œå¯ä»¥åœ¨ä¸åŒçš„å¤´ä¹‹é—´åˆ†åˆ«è®¡ç®—æ³¨æ„åŠ›ã€‚æ¯ä¸ªå¤´éƒ½æœ‰è‡ªå·±çš„åç§»é‡ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨ä¸åŒçš„ä½ç½®ä¸Šè®¡ç®—æ³¨æ„åŠ›ï¼Œä»è€Œæ›´å¥½åœ°æ•æ‰åºåˆ—ä¸­çš„ä¿¡æ¯ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæ‰©å¼ æ³¨æ„åŠ›å¯ä»¥æ›´å¥½åœ°å¤„ç†é•¿åºåˆ—ï¼ŒåŒæ—¶ä¿æŒè¾ƒçŸ­åºåˆ—çš„æ€§èƒ½ã€‚å…·ä½“å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><img src="/2023/07/28/NLP%20Insights/LONGNET/image-4.png" class="" title="Figure 5"><h3 id="è®¡ç®—å¤æ‚åº¦çš„ä¼˜åŒ–"><a href="#è®¡ç®—å¤æ‚åº¦çš„ä¼˜åŒ–" class="headerlink" title="è®¡ç®—å¤æ‚åº¦çš„ä¼˜åŒ–"></a>è®¡ç®—å¤æ‚åº¦çš„ä¼˜åŒ–</h3><p>ç°åœ¨æˆ‘ä»¬æ¥çœ‹çœ‹ä¸ºä»€ä¹ˆLongNetçš„è®¡ç®—å¤æ‚åº¦æ˜¯çº¿æ€§çš„ã€‚åœ¨ä¼ ç»Ÿçš„è‡ªæ³¨æ„åŠ›æœºåˆ¶ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ‰§è¡Œåºåˆ—é•¿åº¦å¹³æ–¹æ¬¡æ•°çš„ç‚¹ç§¯æ“ä½œï¼Œè€ŒLongNeté€šè¿‡ä½¿ç”¨çª—å£å’Œè·³è¿‡çš„æ–¹å¼ï¼Œå°†è®¡ç®—çš„å¤æ‚åº¦é™ä½åˆ°äº†çº¿æ€§ã€‚å¦‚æœæˆ‘ä»¬å‡è®¾çª—å£å¤§å°æ˜¯å›ºå®šçš„ï¼Œä¾‹å¦‚ä¸º4ï¼Œç„¶åâ€œRâ€ä¹Ÿæ˜¯å›ºå®šçš„ï¼Œä¾‹å¦‚ä¸º2ï¼Œé‚£ä¹ˆè®¡ç®—å¤æ‚åº¦å°†æ˜¯â€œO(N)â€ã€‚å½“ç„¶ï¼Œåœ¨å®é™…æ“ä½œä¸­ï¼Œçª—å£å¤§å°å’Œè·³è¿‡çš„ä»¤ç‰Œæ•°å¯èƒ½ä¼šæ ¹æ®å®é™…æƒ…å†µè¿›è¡Œè°ƒæ•´ï¼Œä½†æ˜¯å®ƒä»¬æ˜¯å¸¸æ•°ï¼Œä¸éšåºåˆ—é•¿åº¦å¢åŠ è€Œå¢åŠ ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆLongNetçš„è®¡ç®—å¤æ‚åº¦æ˜¯çº¿æ€§çš„ã€‚</p><img src="/2023/07/28/NLP%20Insights/LONGNET/image-3.png" class="" title="Figure 6"><h3 id="Tokenæ‰©å±•10äº¿"><a href="#Tokenæ‰©å±•10äº¿" class="headerlink" title="Tokenæ‰©å±•10äº¿+"></a>Tokenæ‰©å±•10äº¿+</h3><p>åˆ†å¸ƒå¼è®­ç»ƒæ–¹æ³•ï¼Œåˆ©ç”¨LONGNETçš„çº¿æ€§è®¡ç®—å¤æ‚åº¦ï¼Œå°†åºåˆ—ç»´åº¦åˆ†å¸ƒå¼åœ°è¿›è¡Œè®­ç»ƒã€‚å…·ä½“è€Œè¨€ï¼Œç®—æ³•é¦–å…ˆå°†è¾“å…¥åºåˆ—æ²¿ç€åºåˆ—ç»´åº¦è¿›è¡Œåˆ‡åˆ†ï¼Œæ¯ä¸ªåºåˆ—ç‰‡æ®µè¢«åˆ†é…åˆ°ä¸åŒçš„è®¾å¤‡ä¸Šè¿›è¡Œè®¡ç®—ã€‚ç„¶åï¼Œæ¯ä¸ªè®¾å¤‡å°†åºåˆ—ç‰‡æ®µæŠ•å½±ä¸ºæŸ¥è¯¢ã€é”®å’Œå€¼ï¼Œå¹¶ä½¿ç”¨æœ¬åœ°è®¡ç®—å¾—åˆ°å±€éƒ¨çš„æ³¨æ„åŠ›æƒé‡ã€‚å¯¹äºè¶…å‡ºæœ¬åœ°è®¾å¤‡åºåˆ—é•¿åº¦çš„éƒ¨åˆ†ï¼Œé”®å’Œå€¼å°†è¢«å‘é€åˆ°å…¶ä»–è®¾å¤‡ä¸Šè¿›è¡Œè®¡ç®—ã€‚æœ€åï¼Œæ‰€æœ‰è®¾å¤‡å°†å±€éƒ¨çš„æ³¨æ„åŠ›æƒé‡è¿›è¡Œæ±‡æ€»ï¼Œå¾—åˆ°å…¨å±€çš„æ³¨æ„åŠ›æƒé‡ï¼Œå¹¶ä½¿ç”¨å…¨å±€çš„æ³¨æ„åŠ›æƒé‡è®¡ç®—æ¯ä¸ªæ ‡è®°çš„è¡¨ç¤ºã€‚å…·ä½“å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><img src="/2023/07/28/NLP%20Insights/LONGNET/image-2.png" class="" title="Figure 7"><p>è¯¥ç®—æ³•å¯ä»¥åœ¨ä»»æ„æ•°é‡çš„è®¾å¤‡ä¸Šè¿›è¡Œæ‰©å±•ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡å¹¶è¡Œè®¡ç®—æ¥åŠ é€Ÿè®­ç»ƒè¿‡ç¨‹ã€‚ç”±äºLONGNETå…·æœ‰çº¿æ€§è®¡ç®—å¤æ‚åº¦ï¼Œå› æ­¤è¯¥ç®—æ³•å¯ä»¥æœ‰æ•ˆåœ°å¤„ç†è¶…é•¿åºåˆ—ï¼Œè€Œä¸ä¼šç‰ºç‰²è®­ç»ƒé€Ÿåº¦å’Œæ¨¡å‹æ€§èƒ½ã€‚æ­¤å¤–ï¼Œè¯¥ç®—æ³•è¿˜æ”¯æŒæ ‡å‡†Transformerçš„ä¼˜åŒ–æŠ€æœ¯ï¼Œä¾‹å¦‚å†…æ ¸èåˆã€é‡åŒ–å’Œåˆ†å¸ƒå¼è®­ç»ƒï¼Œä»è€Œä½¿å¾—LONGNETå¯ä»¥æ— ç¼åœ°ä¸ç°æœ‰çš„æ·±åº¦å­¦ä¹ æ¡†æ¶è¿›è¡Œé›†æˆã€‚</p><h3 id="LongNetçš„åº”ç”¨å‰æ™¯"><a href="#LongNetçš„åº”ç”¨å‰æ™¯" class="headerlink" title="LongNetçš„åº”ç”¨å‰æ™¯"></a>LongNetçš„åº”ç”¨å‰æ™¯</h3><p>LongNetçš„å‘å¸ƒä¸ºè‡ªç„¶è¯­è¨€å¤„ç†é¢†åŸŸå¸¦æ¥äº†è¯¸å¤šæ½œåœ¨çš„åº”ç”¨å‰æ™¯ã€‚é¦–å…ˆï¼Œå®ƒå¯ä»¥åº”ç”¨äºæ›´é•¿æ–‡æœ¬çš„ç”Ÿæˆä»»åŠ¡ï¼Œå¦‚ç”Ÿæˆé•¿ç¯‡å°è¯´æˆ–é•¿ç¯‡æ–°é—»æŠ¥é“ã€‚å…¶æ¬¡ï¼Œå®ƒå¯ä»¥åº”ç”¨äºæ›´å¤æ‚çš„å¯¹è¯ä»»åŠ¡ï¼Œå› ä¸ºåœ¨å¯¹è¯ä¸­ï¼Œæˆ‘ä»¬å¾€å¾€éœ€è¦å¤„ç†å¤§é‡çš„å†å²ä¿¡æ¯å’Œä¸Šä¸‹æ–‡ã€‚å¦å¤–ï¼Œå®ƒè¿˜å¯èƒ½åœ¨ç¿»è¯‘ä»»åŠ¡ä¸­å‘æŒ¥æ›´å¤§çš„ä½œç”¨ï¼Œå› ä¸ºç¿»è¯‘å¾€å¾€æ¶‰åŠåˆ°å¤„ç†é•¿å¥å­æˆ–é•¿æ®µè½çš„æƒ…å†µã€‚æ€»çš„æ¥è¯´ï¼ŒLongNetçš„å‘å¸ƒä¸ºæˆ‘ä»¬æä¾›äº†å¤„ç†æ›´é•¿æ–‡æœ¬çš„æ–°å·¥å…·å’Œå¯èƒ½æ€§ã€‚</p><h3 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h3><p>æ€»çš„æ¥è¯´ï¼ŒLongNetæ˜¯ä¸€ä¸ªåŸºäºTransformerçš„æ¨¡å‹ï¼Œå®ƒæˆåŠŸåœ°å°†è‡ªæ³¨æ„åŠ›æœºåˆ¶æ‰©å±•åˆ°äº†10äº¿ä¸ªä»¤ç‰Œï¼Œå®ç°äº†å¤„ç†æ›´é•¿æ–‡æœ¬çš„èƒ½åŠ›ã€‚å®ƒçš„ä¼˜åŠ¿åŒ…æ‹¬è®¡ç®—å¤æ‚åº¦æ˜¯çº¿æ€§çš„ã€éµå¾ªå¯¹æ•°ä¾èµ–åŸåˆ™ï¼Œä»¥åŠå¯ä»¥åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸Šè¿›è¡Œè®­ç»ƒã€‚é€šè¿‡LongNetï¼Œæˆ‘ä»¬å¯ä»¥æ¢ç´¢æ›´å¤šè‡ªç„¶è¯­è¨€å¤„ç†ä»»åŠ¡ï¼Œå¹¶å¤„ç†é‚£äº›è¿‡å»ç”±äºåºåˆ—é•¿åº¦é™åˆ¶è€Œéš¾ä»¥å¤„ç†çš„ä»»åŠ¡ã€‚è¿™ä¸ªæ–°æ¨¡å‹çš„å‘å¸ƒä¸ºæˆ‘ä»¬å¸¦æ¥äº†æ›´å¤šå¯èƒ½æ€§ã€‚</p><h1 id="References"><a href="#References" class="headerlink" title="References"></a>References</h1><ul><li><a href="https://arxiv.org/pdf/2307.02486.pdf">LONGNET: Scaling Transformers to 1,000,000,000 Tokens</a></li><li><a href="https://www.youtube.com/watch?v=nC2nU9j9DVQ">Youtube Tutorial by Umar Jamil</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> NLP Insights </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LLM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Prompt Engineering</title>
      <link href="/2023/07/27/NLP%20Insights/Prompt%20Engineering/"/>
      <url>/2023/07/27/NLP%20Insights/Prompt%20Engineering/</url>
      
        <content type="html"><![CDATA[<h1 id="Prompt-Engineering"><a href="#Prompt-Engineering" class="headerlink" title="Prompt Engineering"></a>Prompt Engineering</h1><p>Prompt Engineering, ä¹Ÿè¢«ç§°ä¸ºä¸Šä¸‹æ–‡æç¤ºï¼Œæ˜¯æŒ‡åœ¨ä¸æ›´æ–°æ¨¡å‹æƒé‡çš„æƒ…å†µä¸‹ï¼Œä¸LLMï¼ˆè¯­è¨€æ¨¡å‹ï¼‰è¿›è¡Œäº¤äº’ä»¥å¼•å¯¼å…¶äº§ç”ŸæœŸæœ›è¾“å‡ºçš„æ–¹æ³•ã€‚å®ƒæ˜¯ä¸€é—¨å®è¯ç§‘å­¦ï¼Œæç¤ºå·¥ç¨‹æ–¹æ³•çš„æ•ˆæœåœ¨ä¸åŒæ¨¡å‹ä¹‹é—´å¯èƒ½ä¼šæœ‰å¾ˆå¤§çš„å·®å¼‚ï¼Œå› æ­¤éœ€è¦è¿›è¡Œå¤§é‡çš„å®éªŒå’Œè¯•æ¢ã€‚</p><p>æœ¬æ–‡ä»…å…³æ³¨è‡ªå›å½’è¯­è¨€æ¨¡å‹çš„æç¤ºå·¥ç¨‹ï¼Œä¸æ¶‰åŠå¡«ç©ºæµ‹è¯•ã€å›¾åƒç”Ÿæˆæˆ–å¤šæ¨¡æ€æ¨¡å‹ã€‚åœ¨æœ¬è´¨ä¸Šï¼Œæç¤ºå·¥ç¨‹çš„ç›®æ ‡æ˜¯å®ç°æ¨¡å‹çš„å¯¹é½å’Œå¯æ“æ§æ€§ã€‚æ‚¨å¯ä»¥æŸ¥é˜…æˆ‘ä¹‹å‰å…³äºå¯æ§æ–‡æœ¬ç”Ÿæˆçš„å¸–å­ã€‚</p><h2 id="åŸºæœ¬æç¤ºæ–¹æ³•"><a href="#åŸºæœ¬æç¤ºæ–¹æ³•" class="headerlink" title="åŸºæœ¬æç¤ºæ–¹æ³•"></a>åŸºæœ¬æç¤ºæ–¹æ³•</h2><p>zero-shotå­¦ä¹ å’Œfew-shotå­¦ä¹ æ˜¯ä¸¤ç§æœ€åŸºæœ¬çš„æç¤ºæ¨¡å‹æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•ç”±è®¸å¤šLLMè®ºæ–‡é¦–åˆ›ï¼Œå¹¶ä¸”é€šå¸¸ç”¨äºè¯„ä¼°LLMæ€§èƒ½ã€‚</p><h3 id="zero-shotå­¦ä¹ "><a href="#zero-shotå­¦ä¹ " class="headerlink" title="zero-shotå­¦ä¹ "></a>zero-shotå­¦ä¹ </h3><p>zero-shotå­¦ä¹ æ˜¯å°†ä»»åŠ¡æ–‡æœ¬ç›´æ¥è¾“å…¥æ¨¡å‹å¹¶è¦æ±‚è·å¾—ç»“æœã€‚</p><p>ï¼ˆæ‰€æœ‰æƒ…æ„Ÿåˆ†æç¤ºä¾‹æ¥è‡ªäºSST-2æ•°æ®é›†ï¼‰</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Text: i'll bet the video game is a lot more fun than the film.</span><br><span class="line">Sentiment:</span><br></pre></td></tr></tbody></table></figure><h3 id="few-shotå­¦ä¹ "><a href="#few-shotå­¦ä¹ " class="headerlink" title="few-shotå­¦ä¹ "></a>few-shotå­¦ä¹ </h3><p>few-shotå­¦ä¹ é€šè¿‡æä¾›ä¸€ç»„é«˜è´¨é‡çš„ç¤ºä¾‹æ¼”ç¤ºï¼Œæ¯ä¸ªç¤ºä¾‹éƒ½åŒ…å«ç›®æ ‡ä»»åŠ¡çš„è¾“å…¥å’ŒæœŸæœ›è¾“å‡ºã€‚å½“æ¨¡å‹é¦–å…ˆçœ‹åˆ°å¥½çš„ç¤ºä¾‹æ—¶ï¼Œå®ƒå¯ä»¥æ›´å¥½åœ°ç†è§£äººç±»çš„æ„å›¾å’ŒæœŸæœ›çš„ç­”æ¡ˆç±»å‹ã€‚å› æ­¤ï¼Œfew-shotå­¦ä¹ é€šå¸¸æ¯”zero-shotå­¦ä¹ è¡¨ç°æ›´å¥½ã€‚ç„¶è€Œï¼Œè¿™æ ·åšçš„ä»£ä»·æ˜¯æ›´å¤šçš„è®°å·æ¶ˆè€—ï¼Œå¹¶ä¸”åœ¨è¾“å…¥å’Œè¾“å‡ºæ–‡æœ¬è¾ƒé•¿æ—¶å¯èƒ½ä¼šè¾¾åˆ°ä¸Šä¸‹æ–‡é•¿åº¦é™åˆ¶ã€‚</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Text: (lawrence bounces) all over the stage, dancing, running, sweating, mopping his face and generally displaying the wacky talent that brought him fame in the first place.</span><br><span class="line">Sentiment: positive</span><br><span class="line"></span><br><span class="line">Text: despite all evidence to the contrary, this clunker has somehow managed to pose as an actual feature movie, the kind that charges full admission and gets hyped on tv and purports to amuse small children and ostensible adults.</span><br><span class="line">Sentiment: negative</span><br><span class="line"></span><br><span class="line">Text: for the first time in years, de niro digs deep emotionally, perhaps because he's been stirred by the powerful work of his co-stars.</span><br><span class="line">Sentiment: positive</span><br><span class="line"></span><br><span class="line">Text: i'll bet the video game is a lot more fun than the film.</span><br><span class="line">Sentiment:</span><br></pre></td></tr></tbody></table></figure><p>è®¸å¤šç ”ç©¶éƒ½æ¢è®¨äº†å¦‚ä½•æ„å»ºä¸Šä¸‹æ–‡ç¤ºä¾‹ä»¥æœ€å¤§åŒ–æ€§èƒ½ï¼Œå¹¶è§‚å¯Ÿåˆ°æç¤ºæ ¼å¼ã€è®­ç»ƒç¤ºä¾‹å’Œç¤ºä¾‹çš„é¡ºåºé€‰æ‹©å¯èƒ½ä¼šå¯¼è‡´æˆªç„¶ä¸åŒçš„æ€§èƒ½ï¼Œä»å‡ ä¹éšæœºçŒœæµ‹åˆ°æ¥è¿‘SOTAï¼ˆState-of-the-Artï¼‰ã€‚</p><p>èµµç­‰äººï¼ˆ2021å¹´ï¼‰ç ”ç©¶äº†few-shotåˆ†ç±»çš„æƒ…å†µï¼Œå¹¶æå‡ºäº†ä¸€äº›ä¸LLMï¼ˆä»–ä»¬åœ¨å®éªŒä¸­ä½¿ç”¨äº†GPT-3ï¼‰ç›¸å…³çš„åå·®ï¼Œè¿™äº›åå·®å¯¼è‡´äº†é«˜æ–¹å·®çš„æƒ…å†µï¼š</p><ul><li>ï¼ˆ1ï¼‰å¤šæ•°ç±»åˆ«åå·®å­˜åœ¨äºç¤ºä¾‹çš„æ ‡ç­¾åˆ†å¸ƒä¸å¹³è¡¡çš„æƒ…å†µä¸‹ï¼›</li><li>ï¼ˆ2ï¼‰æœ€è¿‘åå·®æ˜¯æŒ‡æ¨¡å‹å¯èƒ½åœ¨ç»“å°¾é‡å¤æ ‡ç­¾ï¼›</li><li>ï¼ˆ3ï¼‰å¸¸è§è®°å·åå·®è¡¨æ˜LLMå€¾å‘äºæ›´é¢‘ç¹åœ°ç”Ÿæˆå¸¸è§çš„è®°å·è€Œä¸æ˜¯ç½•è§çš„è®°å·ã€‚ä¸ºäº†å…‹æœè¿™äº›åå·®ï¼Œä»–ä»¬æå‡ºäº†ä¸€ç§æ–¹æ³•ï¼Œé€šè¿‡å¯¹æ¨¡å‹è¾“å‡ºçš„æ ‡ç­¾æ¦‚ç‡è¿›è¡Œæ ¡å‡†ï¼Œä½¿å…¶åœ¨è¾“å…¥å­—ç¬¦ä¸²ä¸ºN/Aæ—¶ä¿æŒå‡åŒ€ã€‚</li></ul><h2 id="æç¤ºå·¥ç¨‹æŠ€å·§"><a href="#æç¤ºå·¥ç¨‹æŠ€å·§" class="headerlink" title="æç¤ºå·¥ç¨‹æŠ€å·§"></a>æç¤ºå·¥ç¨‹æŠ€å·§</h2><h3 id="ç¤ºä¾‹é€‰æ‹©çš„å»ºè®®"><a href="#ç¤ºä¾‹é€‰æ‹©çš„å»ºè®®" class="headerlink" title="ç¤ºä¾‹é€‰æ‹©çš„å»ºè®®"></a>ç¤ºä¾‹é€‰æ‹©çš„å»ºè®®</h3><ul><li><p>ä½¿ç”¨åµŒå…¥ç©ºé—´ä¸­çš„NNèšç±»ï¼ˆLiuç­‰äººï¼Œ2021å¹´ï¼‰æ¥é€‰æ‹©ä¸æµ‹è¯•ç¤ºä¾‹åœ¨è¯­ä¹‰ä¸Šç›¸ä¼¼çš„ç¤ºä¾‹ã€‚</p></li><li><p>Suç­‰äººï¼ˆ2022å¹´ï¼‰æå‡ºäº†ä¸€ç§åŸºäºå›¾çš„æ–¹æ³•æ¥é€‰æ‹©å¤šæ ·ä¸”ä»£è¡¨æ€§çš„ç¤ºä¾‹ï¼š</p><ol><li>é¦–å…ˆï¼Œæ ¹æ®æ ·æœ¬ä¹‹é—´çš„åµŒå…¥ï¼ˆä¾‹å¦‚SBERTæˆ–å…¶ä»–åµŒå…¥æ¨¡å‹ï¼‰ä½™å¼¦ç›¸ä¼¼æ€§æ„å»ºä¸€ä¸ªæœ‰å‘å›¾ï¼Œå…¶ä¸­æ¯ä¸ªèŠ‚ç‚¹æŒ‡å‘å…¶æœ€è¿‘çš„é‚»å±…ï¼›</li><li>å¼€å§‹æ—¶æœ‰ä¸€ç»„å·²é€‰æ‹©çš„ç¤ºä¾‹å’Œä¸€ç»„å‰©ä½™ç¤ºä¾‹ã€‚æ¯ä¸ªç¤ºä¾‹éƒ½é€šè¿‡å¾—åˆ†å‡½æ•°è¿›è¡Œè¯„åˆ†ï¼Œå…¶ä¸­å¾—åˆ†å‡½æ•°çš„ç›®æ ‡æ˜¯ä¿æŒä½å€¼ï¼Œä»¥é¼“åŠ±é€‰æ‹©å¤šæ ·åŒ–çš„ç¤ºä¾‹ã€‚å…·ä½“å¾—åˆ†å‡½æ•°çš„è®¡ç®—å…¬å¼æœªæä¾›ã€‚</li></ol></li><li><p>Rubinç­‰äººï¼ˆ2022å¹´ï¼‰æå‡ºäº†é’ˆå¯¹ä¸Šä¸‹æ–‡å­¦ä¹ ç¤ºä¾‹é€‰æ‹©çš„å¯¹æ¯”å­¦ä¹ æ–¹æ³•ã€‚å¯¹äºæ¯ä¸ªè®­ç»ƒå¯¹ï¼ˆæ ¼å¼åŒ–çš„è¾“å…¥-è¾“å‡ºå¯¹ï¼‰ï¼Œå¯ä»¥é€šè¿‡LMåˆ†é…çš„æ¡ä»¶æ¦‚ç‡æ¥è¡¡é‡ä¸€ä¸ªç¤ºä¾‹çš„è´¨é‡ã€‚ç„¶åï¼Œå¯ä»¥æ ¹æ®å¾—åˆ†å¯¹è®­ç»ƒå¯¹è¿›è¡Œæ’åï¼Œé€‰æ‹©å¾—åˆ†è¾ƒé«˜å’Œå¾—åˆ†è¾ƒä½çš„ç¤ºä¾‹ä½œä¸ºå¯¹æ¯”å­¦ä¹ çš„æ­£æ ·æœ¬å’Œè´Ÿæ ·æœ¬é›†ã€‚</p></li><li><p>æœ‰äº›ç ”ç©¶äººå‘˜å°è¯•ä½¿ç”¨Q-Learningè¿›è¡Œç¤ºä¾‹é€‰æ‹©ï¼ˆZhangç­‰äººï¼Œ2022å¹´ï¼‰ã€‚</p></li><li><p>å—ä¸ç¡®å®šæ€§ä¸»å¯¼çš„ä¸»åŠ¨å­¦ä¹ çš„å¯å‘ï¼ŒDiaoç­‰äººï¼ˆ2023å¹´ï¼‰å»ºè®®ç¡®å®šå…·æœ‰å¤šæ¬¡é‡‡æ ·è¯•éªŒä¸­é«˜åº¦ä¸ä¸€è‡´æˆ–ç†µå€¼è¾ƒé«˜çš„ç¤ºä¾‹ï¼Œå¹¶æ³¨é‡Šè¿™äº›ç¤ºä¾‹ä»¥åœ¨few-shotæç¤ºä¸­ä½¿ç”¨ã€‚</p></li></ul><h3 id="ç¤ºä¾‹æ’åºçš„å»ºè®®"><a href="#ç¤ºä¾‹æ’åºçš„å»ºè®®" class="headerlink" title="ç¤ºä¾‹æ’åºçš„å»ºè®®"></a>ç¤ºä¾‹æ’åºçš„å»ºè®®</h3><ul><li><p>ä¸€èˆ¬å»ºè®®ä¿æŒç¤ºä¾‹é€‰æ‹©çš„å¤šæ ·æ€§ï¼Œä¸æµ‹è¯•ç¤ºä¾‹ç›¸å…³ï¼Œå¹¶ä»¥éšæœºé¡ºåºè¿›è¡Œæ’åˆ—ï¼Œä»¥é¿å…å¤šæ•°ç±»åˆ«åå·®å’Œæœ€è¿‘åå·®ã€‚</p></li><li><p>å¢åŠ æ¨¡å‹å¤§å°æˆ–åŒ…å«æ›´å¤šè®­ç»ƒç¤ºä¾‹å¹¶ä¸èƒ½å‡å°‘ä¸Šä¸‹æ–‡ç¤ºä¾‹ä¸åŒæ’åˆ—ä¹‹é—´çš„æ–¹å·®ã€‚åŒä¸€é¡ºåºå¯¹ä¸€ä¸ªæ¨¡å‹å¯èƒ½æœ‰æ•ˆï¼Œä½†å¯¹å¦ä¸€ä¸ªæ¨¡å‹å¯èƒ½æ— æ•ˆã€‚å½“éªŒè¯é›†æœ‰é™æ—¶ï¼Œå¯ä»¥è€ƒè™‘é€‰æ‹©é¡ºåºï¼Œä»¥ä½¿æ¨¡å‹ä¸ä¼šäº§ç”Ÿæç«¯ä¸å¹³è¡¡çš„é¢„æµ‹æˆ–å¯¹å…¶é¢„æµ‹è¿‡äºè‡ªä¿¡ï¼ˆLuç­‰äººï¼Œ2022å¹´ï¼‰ã€‚</p></li></ul><h2 id="æŒ‡ä»¤æç¤º"><a href="#æŒ‡ä»¤æç¤º" class="headerlink" title="æŒ‡ä»¤æç¤º"></a>æŒ‡ä»¤æç¤º</h2><ul><li><p>åœ¨æç¤ºä¸­å±•ç¤ºfew-shotç¤ºä¾‹çš„ç›®çš„æ˜¯å‘æ¨¡å‹è§£é‡Šæˆ‘ä»¬çš„æ„å›¾ï¼›æ¢å¥è¯è¯´ï¼Œç”¨ç¤ºä¾‹æ¥æè¿°ä»»åŠ¡æŒ‡ä»¤ï¼Œä»¥ä¾¿æ¨¡å‹èƒ½å¤Ÿç†è§£ç”¨æˆ·æ„å›¾å¹¶éµå¾ªæŒ‡ä»¤ã€‚ç„¶è€Œï¼Œfew-shotçš„ä½¿ç”¨å¯èƒ½ä¼šæ¶ˆè€—è¾ƒå¤šçš„è®°å·ï¼Œå¹¶é™åˆ¶è¾“å…¥é•¿åº¦ï¼Œå› ä¸ºä¸Šä¸‹æ–‡é•¿åº¦æœ‰é™ã€‚æ‰€ä»¥ï¼Œä¸ºä»€ä¹ˆä¸ç›´æ¥ç»™å‡ºæŒ‡ä»¤å‘¢ï¼Ÿ</p></li><li><p>Instructed LMï¼ˆä¾‹å¦‚InstructGPTï¼Œè‡ªç„¶è¯­è¨€æŒ‡ä»¤ï¼‰ä½¿ç”¨é«˜è´¨é‡çš„ï¼ˆä»»åŠ¡æŒ‡ä»¤ï¼Œè¾“å…¥ï¼ŒçœŸå®è¾“å‡ºï¼‰å…ƒç»„å¯¹é¢„è®­ç»ƒæ¨¡å‹è¿›è¡Œå¾®è°ƒï¼Œä»¥ä½¿LMæ›´å¥½åœ°ç†è§£ç”¨æˆ·æ„å›¾å¹¶éµå¾ªæŒ‡ä»¤ã€‚RLHFï¼ˆäººç±»åé¦ˆçš„å¼ºåŒ–å­¦ä¹ ï¼‰æ˜¯ä¸€ç§å¸¸è§çš„æ–¹æ³•ã€‚é‡‡ç”¨æŒ‡ä»¤éµå¾ªé£æ ¼çš„å¾®è°ƒä½¿å¾—æ¨¡å‹æ›´åŠ ç¬¦åˆäººç±»æ„å›¾ï¼Œå¹¶æå¤§åœ°é™ä½äº†é€šä¿¡æˆæœ¬ã€‚</p></li><li><p>åœ¨ä¸æŒ‡ä»¤æ¨¡å‹è¿›è¡Œäº¤äº’æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥è¯¦ç»†æè¿°ä»»åŠ¡è¦æ±‚ï¼Œå°½é‡å…·ä½“å’Œå‡†ç¡®ï¼Œå¹¶é¿å…ä½¿ç”¨â€ä¸åšæŸäº‹â€çš„è¡¨è¿°ï¼Œè€Œæ˜¯è¦æ˜ç¡®æŒ‡å®šè¦åšä»€ä¹ˆã€‚</p></li></ul><h1 id="Chain-of-Thought-CoT-Prompting"><a href="#Chain-of-Thought-CoT-Prompting" class="headerlink" title="Chain-of-Thought (CoT) Prompting"></a>Chain-of-Thought (CoT) Prompting</h1><p>Chain-of-Thought (CoT) Promptingï¼ˆWeiç­‰äººï¼Œ2022å¹´ï¼‰é€šè¿‡ç”Ÿæˆä¸€ç³»åˆ—ç®€çŸ­çš„å¥å­ï¼Œé€æ­¥æè¿°æ¨ç†é€»è¾‘ï¼Œå³æ‰€è°“çš„æ¨ç†é“¾æˆ–ç†ç”±é“¾ï¼Œæœ€ç»ˆå¼•å¯¼å‡ºæœ€ç»ˆç­”æ¡ˆã€‚CoTåœ¨å¤æ‚çš„æ¨ç†ä»»åŠ¡ä¸­æ•ˆæœæ›´æ˜¾è‘—ï¼Œç‰¹åˆ«æ˜¯åœ¨ä½¿ç”¨å¤§å‹æ¨¡å‹ï¼ˆä¾‹å¦‚è¶…è¿‡50äº¿å‚æ•°çš„æ¨¡å‹ï¼‰æ—¶ã€‚å¯¹äºç®€å•çš„ä»»åŠ¡ï¼ŒCoTæç¤ºçš„å—ç›Šè¾ƒå°ã€‚</p><p>CoTæç¤ºçš„ä¸¤ç§ä¸»è¦ç±»å‹ï¼š</p><h2 id="few-shot-CoT"><a href="#few-shot-CoT" class="headerlink" title="few-shot CoT"></a>few-shot CoT</h2><p>few-shot CoTæ˜¯ä½¿ç”¨å°‘é‡æ¼”ç¤ºæ¥å¼•å¯¼æ¨¡å‹ï¼Œæ¯ä¸ªæ¼”ç¤ºåŒ…å«äººå·¥ç¼–å†™ï¼ˆæˆ–æ¨¡å‹ç”Ÿæˆï¼‰çš„é«˜è´¨é‡æ¨ç†é“¾ã€‚</p><p>ï¼ˆä»¥ä¸‹æ‰€æœ‰æ•°å­¦æ¨ç†ç¤ºä¾‹æ¥è‡ªGSM8kæ•°æ®é›†ï¼‰</p><p>é—®é¢˜ï¼šTomå’ŒElizabethæ¯”èµ›çˆ¬å±±ã€‚ElizabethèŠ±äº†30åˆ†é’Ÿçˆ¬ä¸Šå±±ã€‚TomèŠ±è´¹çš„æ—¶é—´æ˜¯Elizabethçš„å››å€ã€‚Tomçˆ¬ä¸Šå±±éœ€è¦å¤šå°‘å°æ—¶ï¼Ÿ</p><p>ç­”æ¡ˆï¼šToméœ€è¦30 * 4 = 120åˆ†é’Ÿçˆ¬ä¸Šå±±ã€‚<br>Toméœ€è¦120/60 = 2å°æ—¶çˆ¬ä¸Šå±±ã€‚<br>æ‰€ä»¥ç­”æ¡ˆæ˜¯2ã€‚</p><p>===</p><p>é—®é¢˜ï¼šJackæ˜¯ä¸ªè¶³çƒè¿åŠ¨å‘˜ã€‚ä»–éœ€è¦ä¹°ä¸¤åŒè¢œå­å’Œä¸€åŒè¶³çƒé‹ã€‚æ¯åŒè¢œå­çš„ä»·æ ¼æ˜¯9.50ç¾å…ƒï¼Œé‹å­çš„ä»·æ ¼æ˜¯92ç¾å…ƒã€‚Jackæœ‰40ç¾å…ƒã€‚Jackè¿˜éœ€è¦å¤šå°‘é’±ï¼Ÿ</p><p>ç­”æ¡ˆï¼šä¸¤åŒè¢œå­çš„æ€»è´¹ç”¨æ˜¯9.50ç¾å…ƒ x 2 = 19ç¾å…ƒã€‚<br>è¢œå­å’Œé‹å­çš„æ€»è´¹ç”¨æ˜¯19ç¾å…ƒ + 92ç¾å…ƒ = 111ç¾å…ƒã€‚<br>Jackè¿˜éœ€è¦111ç¾å…ƒ - 40ç¾å…ƒ = 71ç¾å…ƒã€‚<br>æ‰€ä»¥ç­”æ¡ˆæ˜¯71ã€‚</p><p>===</p><p>é—®é¢˜ï¼šMartyæœ‰100å˜ç±³çš„ç¼å¸¦ï¼Œä»–å¿…é¡»å°†å…¶åˆ†æˆ4ç­‰ä»½ã€‚æ¯ä¸ªåˆ‡å‰²éƒ¨åˆ†å¿…é¡»å†åˆ†æˆ5ç­‰ä»½ã€‚æ¯ä¸ªæœ€ç»ˆåˆ‡å‰²éƒ¨åˆ†å°†æœ‰å¤šé•¿ï¼Ÿ</p><p>ç­”æ¡ˆï¼šï¼ˆå¾…å¡«å†™ï¼‰</p><h2 id="zero-shot-CoT"><a href="#zero-shot-CoT" class="headerlink" title="zero-shot CoT"></a>zero-shot CoT</h2><p>zero-shot CoTæ˜¯ä½¿ç”¨è‡ªç„¶è¯­è¨€é™ˆè¿°ï¼Œä¾‹å¦‚â€œè®©æˆ‘ä»¬é€æ­¥æ€è€ƒâ€ï¼Œæ˜ç¡®åœ°é¼“åŠ±æ¨¡å‹é¦–å…ˆç”Ÿæˆæ¨ç†é“¾ï¼Œç„¶åå†é€šè¿‡â€œå› æ­¤ï¼Œç­”æ¡ˆæ˜¯â€ç­‰æç¤ºæ¥äº§ç”Ÿç­”æ¡ˆï¼ˆKojimaç­‰äººï¼Œ2022å¹´ï¼‰ã€‚æˆ–è€…ä½¿ç”¨ç±»ä¼¼çš„è¯­å¥â€œè®©æˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥æ¥è®¡ç®—ï¼Œç¡®ä¿æˆ‘ä»¬å¾—åˆ°æ­£ç¡®çš„ç­”æ¡ˆâ€ï¼ˆZhouç­‰äººï¼Œ2022å¹´ï¼‰ã€‚</p><p>é—®é¢˜ï¼šMartyæœ‰100å˜ç±³çš„ç¼å¸¦ï¼Œä»–å¿…é¡»å°†å…¶åˆ†æˆ4ç­‰ä»½ã€‚æ¯ä¸ªåˆ‡å‰²éƒ¨åˆ†å¿…é¡»å†åˆ†æˆ5ç­‰ä»½ã€‚æ¯ä¸ªæœ€ç»ˆåˆ‡å‰²éƒ¨åˆ†å°†æœ‰å¤šé•¿ï¼Ÿ</p><p>ç­”æ¡ˆï¼šè®©æˆ‘ä»¬é€æ­¥æ€è€ƒã€‚</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@article{weng2023prompt,</span><br><span class="line">  title   = "Prompt Engineering",</span><br><span class="line">  author  = "Weng, Lilian",</span><br><span class="line">  journal = "lilianweng.github.io",</span><br><span class="line">  year    = "2023",</span><br><span class="line">  month   = "Mar",</span><br><span class="line">  url     = "https://lilianweng.github.io/posts/2023-03-15-prompt-engineering/"</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>]]></content>
      
      
      <categories>
          
          <category> NLP Insights </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LLM </tag>
            
            <tag> Prompt </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ColoredLogger-å½©è‰²æ‰“å°æ—¥å¿—åˆ°æ§åˆ¶å°å¹¶è®°å½•åˆ°æ–‡ä»¶</title>
      <link href="/2023/07/10/Code%20Chronicles/ColoredLogger/"/>
      <url>/2023/07/10/Code%20Chronicles/ColoredLogger/</url>
      
        <content type="html"><![CDATA[<h1 id="å½©è‰²æ‰“å°æ—¥å¿—åˆ°æ§åˆ¶å°å¹¶è®°å½•åˆ°æ–‡ä»¶"><a href="#å½©è‰²æ‰“å°æ—¥å¿—åˆ°æ§åˆ¶å°å¹¶è®°å½•åˆ°æ–‡ä»¶" class="headerlink" title="å½©è‰²æ‰“å°æ—¥å¿—åˆ°æ§åˆ¶å°å¹¶è®°å½•åˆ°æ–‡ä»¶"></a>å½©è‰²æ‰“å°æ—¥å¿—åˆ°æ§åˆ¶å°å¹¶è®°å½•åˆ°æ–‡ä»¶</h1><p>æœ¬æ–‡æ¡£ä»‹ç»äº†ä¸€ä¸ªåä¸º ColoredLogger çš„æ—¥å¿—è®°å½•å™¨ç±»ï¼Œå®ƒå¯ä»¥æ ¹æ®ä¸åŒçš„æ¶ˆæ¯ç±»å‹ä»¥ä¸åŒçš„é¢œè‰²æ‰“å°æ—¥å¿—ï¼Œå¹¶å°†æ—¥å¿—è®°å½•åˆ°æ–‡ä»¶ä¸­ã€‚è¯¥ç±»ä½¿ç”¨äº† colorama åº“æ¥å®ç°åœ¨æ§åˆ¶å°ä¸­æ˜¾ç¤ºå¸¦é¢œè‰²çš„æ–‡æœ¬ã€‚ä¸ºäº†ä½¿æ§åˆ¶å°è¾“å‡ºçš„æ—¥å¿—æ›´åŠ æ˜“äºé˜…è¯»å’Œç†è§£ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šä½¿ç”¨å½©è‰²çš„è¾“å‡ºã€‚åŒæ—¶ï¼Œå°†æ—¥å¿—è®°å½•åˆ°æ–‡ä»¶ä¸­å¯ä»¥æ–¹ä¾¿æˆ‘ä»¬åç»­çš„è°ƒè¯•å’Œåˆ†æã€‚åœ¨Pythonä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>logging</code>å’Œ<code>colorama</code>åº“æ¥å®ç°è¿™æ ·çš„åŠŸèƒ½ã€‚</p><img src="/2023/07/10/Code%20Chronicles/ColoredLogger/image.png" class=""><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªå¦‚ä½•ä½¿ç”¨è¿™ä¸¤ä¸ªåº“çš„è¯¦ç»†ä»‹ç»ã€‚</p><h2 id="åŠŸèƒ½"><a href="#åŠŸèƒ½" class="headerlink" title="åŠŸèƒ½"></a>åŠŸèƒ½</h2><ul><li>å¯ä»¥æ ¹æ®ä¸åŒçš„æ¶ˆæ¯ç±»å‹ä»¥ä¸åŒçš„é¢œè‰²æ‰“å°æ—¥å¿—æ¶ˆæ¯ã€‚</li><li>å°†æ—¥å¿—æ¶ˆæ¯è®°å½•åˆ°æ–‡ä»¶ä¸­ï¼Œä½¿ç”¨æ ‡å‡†çš„ <code>logging</code> æ¨¡å—è¿›è¡Œè®°å½•ã€‚</li><li>åœ¨æ§åˆ¶å°ä¸­æ˜¾ç¤ºå¸¦é¢œè‰²çš„æ—¥å¿—æ¶ˆæ¯ã€‚</li></ul><h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p><code>logging</code>åº“æä¾›äº†å¼ºå¤§çš„æ—¥å¿—è®°å½•åŠŸèƒ½ï¼Œå…è®¸æˆ‘ä»¬å°†æ—¥å¿—è®°å½•åˆ°æ§åˆ¶å°ã€æ–‡ä»¶æˆ–è€…å…¶ä»–è¾“å‡ºè®¾å¤‡ï¼Œå¹¶æä¾›äº†è¯¦ç»†çš„é…ç½®é€‰é¡¹ã€‚</p><p><code>colorama</code>åº“å¯ä»¥ä½¿æˆ‘ä»¬åœ¨æ§åˆ¶å°è¾“å‡ºå½©è‰²çš„æ–‡æœ¬ã€‚å®ƒæä¾›äº†å¯¹ANSIé¢œè‰²ç¼–ç çš„æ”¯æŒï¼Œå¯ä»¥åœ¨å‡ ä¹æ‰€æœ‰çš„å¹³å°å’Œç»ˆç«¯ä¸­ä½¿ç”¨ã€‚</p><p>æˆ‘ä»¬å…ˆåˆå§‹åŒ–<code>colorama</code>ï¼Œç„¶åå®šä¹‰äº†ä¸€ä¸ª<code>ColoredLogger</code>ç±»ï¼Œå®ƒåŒ…å«äº†å„ç§å½©è‰²çš„è¾“å‡ºæ ·å¼å’Œå¯¹åº”çš„æ—¥å¿—çº§åˆ«ã€‚ç„¶åï¼Œæˆ‘ä»¬è®¾ç½®äº†<code>logging</code>çš„é…ç½®ï¼Œå®šä¹‰äº†æ—¥å¿—çš„è¾“å‡ºçº§åˆ«ã€è¾“å‡ºæ–‡ä»¶å’Œæ–‡ä»¶æ¨¡å¼ã€‚æœ€åï¼Œæˆ‘ä»¬ä½¿ç”¨<code>ColoredLogger</code>çš„<code>log</code>æ–¹æ³•æ¥è®°å½•æ—¥å¿—ï¼Œå®ƒä¼šåŒæ—¶å°†å½©è‰²çš„æ–‡æœ¬è¾“å‡ºåˆ°æ§åˆ¶å°ï¼Œå¹¶å»é™¤é¢œè‰²æ§åˆ¶å­—ç¬¦åå†™å…¥æ–‡ä»¶ã€‚<br><code>ColoredLogger</code> ç±»ä½¿ç”¨äº† <code>colorama</code> åº“æ¥è®¾ç½®æ§åˆ¶å°ä¸­çš„é¢œè‰²è¾“å‡ºã€‚å®ƒé€šè¿‡å®šä¹‰ä¸åŒç±»å‹æ¶ˆæ¯çš„é¢œè‰²ï¼Œå¹¶ä½¿ç”¨ <code>Fore</code> å’Œ <code>Style</code> ç±»æ¥åº”ç”¨ç›¸åº”çš„é¢œè‰²ã€‚</p><p><code>ColoredLogger</code> ç±»çš„ <code>log</code> æ–¹æ³•æ¥å—ä¸¤ä¸ªå‚æ•°ï¼š<code>msg_type</code> å’Œ <code>msg</code>ã€‚æ ¹æ® <code>msg_type</code> å‚æ•°çš„å€¼ï¼Œæ–¹æ³•å°†é€‰æ‹©é€‚å½“çš„é¢œè‰²ï¼Œå¹¶å°†å¸¦æœ‰é¢œè‰²çš„æ¶ˆæ¯æ‰“å°åˆ°æ§åˆ¶å°ä¸Šã€‚ç„¶åï¼Œå®ƒä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼å»é™¤é¢œè‰²æ§åˆ¶å­—ç¬¦ï¼Œå¹¶ä½¿ç”¨ <code>logging.info</code> æ–¹æ³•å°†ä¸å¸¦é¢œè‰²çš„æ¶ˆæ¯è®°å½•åˆ°æ–‡ä»¶ä¸­ã€‚</p><h2 id="ä½¿ç”¨æ–¹æ³•"><a href="#ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h2><ol><li><p>å®‰è£… <code>colorama</code> åº“ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install colorama</span><br></pre></td></tr></tbody></table></figure></li><li><p>å¯¼å…¥æ‰€éœ€çš„æ¨¡å—å’Œç±»ï¼š</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">from</span> colorama <span class="keyword">import</span> init, Fore, Style</span><br></pre></td></tr></tbody></table></figure></li><li><p>åˆå§‹åŒ– <code>colorama</code>ï¼š</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">init(autoreset=<span class="literal">True</span>)</span><br></pre></td></tr></tbody></table></figure></li><li><p>å®šä¹‰ <code>ColoredLogger</code> ç±»ï¼Œå¹¶è®¾ç½®ä¸åŒç±»å‹æ¶ˆæ¯çš„é¢œè‰²ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ColoredLogger</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">         self.type_A = Fore.CYAN + Style.BRIGHT</span><br><span class="line">         self.type_B = Fore.GREEN + Style.BRIGHT</span><br><span class="line">         self.type_C = Fore.YELLOW + Style.BRIGHT</span><br><span class="line">         self.type_D = Fore.MAGENTA + Style.BRIGHT</span><br><span class="line">         self.type_E = Fore.BLUE + Style.BRIGHT</span><br><span class="line">         self.RESET = Style.RESET_ALL</span><br></pre></td></tr></tbody></table></figure></li><li><p>å®ä¾‹åŒ– <code>ColoredLogger</code> ç±»ï¼Œå¹¶ä½¿ç”¨ <code>log</code> æ–¹æ³•æ‰“å°å’Œè®°å½•æ—¥å¿—æ¶ˆæ¯ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">logger = ColoredLogger()</span><br><span class="line">logger.log(<span class="string">'type_A'</span>, <span class="string">'This is a test message for type A.'</span>)</span><br><span class="line">logger.log(<span class="string">'type_B'</span>, <span class="string">'This is a test message for type B.'</span>)</span><br><span class="line"><span class="comment"># ...</span></span><br></pre></td></tr></tbody></table></figure></li><li><p>é€šè¿‡ä»¥ä¸‹å‘½ä»¤é…ç½®æ—¥å¿—è®°å½•å™¨ï¼Œå°†æ—¥å¿—æ¶ˆæ¯å†™å…¥æ–‡ä»¶ï¼š</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logging.basicConfig(level=logging.INFO, filename=<span class="string">'example.log'</span>, filemode=<span class="string">'w'</span>)</span><br></pre></td></tr></tbody></table></figure></li><li><p>è¿è¡Œä»£ç ï¼ŒæŸ¥çœ‹åœ¨æ§åˆ¶å°å’Œæ–‡ä»¶ä¸­æ˜¾ç¤ºçš„å¸¦é¢œè‰²çš„æ—¥å¿—æ¶ˆæ¯ã€‚</p></li></ol><h2 id="å®Œæ•´ä»£ç å®ç°"><a href="#å®Œæ•´ä»£ç å®ç°" class="headerlink" title="å®Œæ•´ä»£ç å®ç°"></a>å®Œæ•´ä»£ç å®ç°</h2><pre><code class="python">import reimport loggingfrom colorama import init, Fore, Style# Initialize coloramainit(autoreset=True)class ColoredLogger:    def __init__(self):        self.type_A = Fore.CYAN + Style.BRIGHT        self.type_B = Fore.GREEN + Style.BRIGHT        self.type_C = Fore.YELLOW + Style.BRIGHT        self.type_D = Fore.MAGENTA + Style.BRIGHT        self.type_E = Fore.BLUE + Style.BRIGHT        self.RESET = Style.RESET_ALL    def log(self, msg_type, msg):        if msg_type == "type_A":            self.print_and_log(self.type_A + f"type_A: {msg}" + self.RESET)        elif msg_type == "type_B":            self.print_and_log(self.type_B + f"type_B: {msg}" + self.RESET)        elif msg_type == "type_C":            self.print_and_log(self.type_C + f"type_C: {msg}" + self.RESET)        elif msg_type == "type_D":            self.print_and_log(self.type_D + f"type_D: {msg}" + self.RESET)        elif msg_type == "type_E":            self.print_and_log(self.type_E + f"type_E: {msg}" + self.RESET)    def print_and_log(self, msg):        # Print to console with color        print(msg)        # Remove color control chars for logging to file        msg_without_color = re.sub('\x1b\[[0-9;]*m', '', msg)        logging.info(msg_without_color)# Setup logging configurationlogging.basicConfig(level=logging.INFO, filename='example.log', filemode='w')# Use the ColoredLoggerlogger = ColoredLogger()logger.log('type_A', 'This is a test message for type A.')logger.log('type_B', 'This is a test message for type B.')logger.log('type_C', 'This is a test message for type C.')logger.log('type_D', 'This is a test message for type D.')logger.log('type_E', 'This is a test message for type E.')```![Alt text](image.png)## æ³¨æ„äº‹é¡¹1. `colorama`åº“çš„é¢œè‰²å’Œæ ·å¼å¯èƒ½åœ¨ä¸åŒçš„å¹³å°å’Œç»ˆç«¯ä¸Šæœ‰ä¸åŒçš„æ•ˆæœï¼Œæ‰€ä»¥éœ€è¦åœ¨ç›®æ ‡ç¯å¢ƒä¸Šè¿›è¡Œæµ‹è¯•ã€‚2. åœ¨å†™å…¥æ–‡ä»¶æ—¶ï¼Œéœ€è¦å»é™¤é¢œè‰²æ§åˆ¶å­—ç¬¦ï¼Œå¦åˆ™ä¼šåœ¨æ–‡æœ¬ä¸­ç•™ä¸‹ä¸€äº›æ— æ³•è¯†åˆ«çš„å­—ç¬¦ã€‚3. åœ¨è®¾ç½®`logging`çš„é…ç½®æ—¶ï¼Œéœ€è¦æ³¨æ„æ–‡ä»¶æ¨¡å¼çš„è®¾ç½®ã€‚'w'æ¨¡å¼ä¼šåœ¨æ¯æ¬¡è¿è¡Œæ—¶è¦†ç›–ä¹‹å‰çš„æ—¥å¿—ï¼Œè€Œ'a'æ¨¡å¼åˆ™ä¼šåœ¨ä¹‹å‰çš„æ—¥å¿—åè¿½åŠ æ–°çš„æ—¥å¿—ã€‚4. ä½¿ç”¨`logging`åº“è®°å½•æ—¥å¿—æ—¶ï¼Œéœ€è¦æ³¨æ„æ—¥å¿—çš„çº§åˆ«ã€‚ä¸åŒçº§åˆ«çš„æ—¥å¿—ä¼šæœ‰ä¸åŒçš„è¾“å‡ºæ•ˆæœå’Œè®°å½•æ–¹å¼ã€‚5. éœ€è¦æ³¨æ„çº¿ç¨‹å®‰å…¨ã€‚å¦‚æœåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä½¿ç”¨`logging`åº“ï¼Œå¯èƒ½éœ€è¦é¢å¤–çš„é…ç½®æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚</code></pre>]]></content>
      
      
      <categories>
          
          <category> Code Chronicles </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¯¦è§£æ¢¯åº¦ä¸‹é™ç®—æ³•</title>
      <link href="/2023/07/09/NLP%20Insights/%E8%AF%A6%E8%A7%A3%E6%A2%AF%E5%BA%A6%E4%B8%8B%E9%99%8D%E7%AE%97%E6%B3%95/"/>
      <url>/2023/07/09/NLP%20Insights/%E8%AF%A6%E8%A7%A3%E6%A2%AF%E5%BA%A6%E4%B8%8B%E9%99%8D%E7%AE%97%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h1 id="æ¢¯åº¦"><a href="#æ¢¯åº¦" class="headerlink" title="æ¢¯åº¦"></a>æ¢¯åº¦</h1><p>æ¢¯åº¦æ˜¯ä¸€ä¸ªåœ¨å¾®ç§¯åˆ†ä¸­ä½¿ç”¨çš„é‡è¦æ¦‚å¿µï¼Œå®ƒç”¨äºè¡¡é‡å‡½æ•°åœ¨ç»™å®šç‚¹ä¸Šçš„æ–¹å‘å¯¼æ•°æ²¿å„ä¸ªæ–¹å‘æœ€å¤§æ—¶çš„æœ€å¤§å€¼ã€‚å¯¹äºä¸€ä¸ªæ ‡é‡å‡½æ•°ï¼Œæ¢¯åº¦çš„æ–¹å‘æ˜¯å‡½æ•°å¢é•¿æœ€å¿«çš„æ–¹å‘ï¼Œè€Œæ¢¯åº¦çš„åæ–¹å‘åˆ™æ˜¯å‡½æ•°å‡å°æœ€å¿«çš„æ–¹å‘ã€‚</p><h2 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h2><p>å¯¹äºåœ¨ç‚¹$x \in \mathbb{R}^n$å¯å¾®çš„å‡½æ•°$f: \mathbb{R}^n \rightarrow \mathbb{R}$ï¼Œå…¶æ¢¯åº¦è¢«å®šä¹‰ä¸ºä¸€ä¸ªå‘é‡ï¼Œå…¶å„ä¸ªåˆ†é‡ä¸ºå‡½æ•°åœ¨è¯¥ç‚¹ä¸Šçš„åå¯¼æ•°ã€‚å¯¹äºå‡½æ•°$f(x_1, x_2, â€¦, x_n)$ï¼Œå®ƒçš„æ¢¯åº¦å¯ä»¥è¡¨ç¤ºä¸ºï¼š</p><p>$$<br>\nabla f(x) = \left[ \frac{\partial f}{\partial x_1}, \frac{\partial f}{\partial x_2}, â€¦, \frac{\partial f}{\partial x_n} \right]^T<br>$$</p><p>è¿™é‡Œï¼Œ$\nabla f(x)$è¡¨ç¤º$f(x)$çš„æ¢¯åº¦ï¼Œ$\frac{\partial f}{\partial x_i}$è¡¨ç¤º$f$å…³äº$x_i$çš„åå¯¼æ•°ï¼Œ$T$è¡¨ç¤ºçŸ©é˜µè½¬ç½®ã€‚</p><h2 id="ç‰©ç†å«ä¹‰"><a href="#ç‰©ç†å«ä¹‰" class="headerlink" title="ç‰©ç†å«ä¹‰"></a>ç‰©ç†å«ä¹‰</h2><p>æ¢¯åº¦æœ‰ä¸€ä¸ªé‡è¦çš„ç‰©ç†å«ä¹‰ã€‚åœ¨äºŒç»´ç©ºé—´ä¸­ï¼Œå¯ä»¥æŠŠå‡½æ•°$f(x, y)$çœ‹ä½œåœ°å½¢çš„é«˜åº¦ï¼Œé‚£ä¹ˆæ¢¯åº¦å°±æ˜¯æŒ‡å‘æœ€é™¡å³­ä¸Šå‡æ–¹å‘çš„å‘é‡ã€‚è€Œæ¢¯åº¦çš„å¤§å°ï¼Œåˆ™å¯¹åº”äº†æœ€é™¡å³­ä¸Šå‡æ–¹å‘çš„æ–œç‡ã€‚å› æ­¤ï¼Œåœ¨ä¼˜åŒ–é—®é¢˜ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸æ²¿ç€æ¢¯åº¦çš„åæ–¹å‘æ›´æ–°å‚æ•°ï¼Œä»¥æœ€å¿«åœ°é™ä½å‡½æ•°å€¼ã€‚</p><h2 id="æ¢¯åº¦åœ¨æœºå™¨å­¦ä¹ ä¸­çš„åº”ç”¨"><a href="#æ¢¯åº¦åœ¨æœºå™¨å­¦ä¹ ä¸­çš„åº”ç”¨" class="headerlink" title="æ¢¯åº¦åœ¨æœºå™¨å­¦ä¹ ä¸­çš„åº”ç”¨"></a>æ¢¯åº¦åœ¨æœºå™¨å­¦ä¹ ä¸­çš„åº”ç”¨</h2><p>åœ¨æœºå™¨å­¦ä¹ ä¸­ï¼Œæˆ‘ä»¬çš„ç›®æ ‡é€šå¸¸æ˜¯æ‰¾åˆ°ä¸€ç»„å‚æ•°ï¼Œä½¿å¾—æŸå¤±å‡½æ•°è¾¾åˆ°æœ€å°ã€‚ä¸ºäº†å®ç°è¿™ä¸ªç›®æ ‡ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ¢¯åº¦ä¸‹é™ç®—æ³•ï¼Œä¸æ–­åœ°æ²¿ç€æŸå¤±å‡½æ•°æ¢¯åº¦çš„åæ–¹å‘æ›´æ–°å‚æ•°ã€‚</p><p>åœ¨æ·±åº¦å­¦ä¹ ä¸­ï¼Œç”±äºæ¨¡å‹é€šå¸¸æœ‰å¤§é‡çš„å‚æ•°ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨åå‘ä¼ æ’­ç®—æ³•æ¥é«˜æ•ˆåœ°è®¡ç®—æ¢¯åº¦ã€‚è¿™ç§ç®—æ³•åŸºäºé“¾å¼æ³•åˆ™ï¼Œå¯ä»¥åœ¨è®¡ç®—å›¾ä¸­ä»è¾“å‡ºç«¯åˆ°è¾“å…¥ç«¯ï¼Œä¸€å±‚ä¸€å±‚åœ°è®¡ç®—å„ä¸ªå‚æ•°çš„æ¢¯åº¦ã€‚</p><h2 id="è®¡ç®—æ¢¯åº¦"><a href="#è®¡ç®—æ¢¯åº¦" class="headerlink" title="è®¡ç®—æ¢¯åº¦"></a>è®¡ç®—æ¢¯åº¦</h2><p>åœ¨å®è·µä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨è‡ªåŠ¨å¾®åˆ†ï¼ˆå¦‚PyTorchå’ŒTensorFlowæä¾›çš„è‡ªåŠ¨å¾®åˆ†åŠŸèƒ½ï¼‰æ¥è®¡ç®—æ¢¯åº¦ã€‚è¿™ä½¿å¾—æˆ‘ä»¬æ— éœ€æ‰‹åŠ¨æ¨å¯¼å’Œå®ç°å¤æ‚çš„æ¢¯åº¦å…¬å¼ï¼Œå¤§å¤§æé«˜äº†ç¼–ç¨‹çš„æ•ˆç‡ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªPyTorchä¸­è®¡ç®—æ¢¯åº¦çš„ä¾‹å­ï¼š</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªå¼ é‡ï¼Œå¹¶è®¾ç½®requires_grad=Trueä½¿å¾—æˆ‘ä»¬å¯ä»¥è®¡ç®—å…³äºå®ƒçš„æ¢¯åº¦</span></span><br><span class="line">x = torch.tensor([<span class="number">1.0</span>], requires_grad=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰å‡½æ•°</span></span><br><span class="line">y = <span class="number">2</span> * x * x</span><br><span class="line"></span><br><span class="line"><span class="comment"># é€šè¿‡åå‘ä¼ æ’­è®¡ç®—æ¢¯åº¦</span></span><br><span class="line">y.backward()</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡ºæ¢¯åº¦</span></span><br><span class="line"><span class="built_in">print</span>(x.grad)  <span class="comment"># è¾“å‡ºï¼štensor([4.])ï¼Œå› ä¸ºy = 2 * x^2, dy/dx = 4 * x = 4 * 1 = 4</span></span><br></pre></td></tr></tbody></table></figure><p>åœ¨ä¸Šè¿°ä¾‹å­ä¸­ï¼Œ<code>y.backward()</code>è¡¨ç¤ºè®¡ç®—å…³äº<code>y</code>çš„æ¢¯åº¦ï¼Œç„¶åå°†è¿™ä¸ªæ¢¯åº¦åå‘ä¼ æ’­å›å…¶è¾“å…¥<code>x</code>ã€‚å› æ­¤ï¼Œ<code>y</code>æœ¬èº«çš„æ¢¯åº¦è¢«è®¤ä¸ºæ˜¯1ï¼ˆå› ä¸ºå¯¹äºä»»ä½•å˜é‡<code>x</code>ï¼Œ<code>dx/dx</code>éƒ½ç­‰äº1ï¼‰ï¼Œç„¶åè¿™ä¸ªæ¢¯åº¦è¢«ä¼ é€’åˆ°<code>x</code>ï¼Œå¾—åˆ°çš„æ˜¯<code>y</code>å…³äº<code>x</code>çš„æ¢¯åº¦ï¼Œå³<code>dy/dx</code>ã€‚</p><p>æ³¨æ„ï¼Œ<code>y</code>æœ¬èº«æ²¡æœ‰<code>.grad</code>å±æ€§ï¼Œå› ä¸ºå®ƒä¸æ˜¯é€šè¿‡<code>requires_grad=True</code>åˆ›å»ºçš„ã€‚åªæœ‰é‚£äº›é€šè¿‡<code>requires_grad=True</code>åˆ›å»ºï¼Œå¹¶ä¸”å‚ä¸äº†è¿ç®—çš„å¼ é‡æ‰æœ‰<code>.grad</code>å±æ€§ï¼Œè¿™ä¸ªå±æ€§å­˜å‚¨äº†æ¢¯åº¦ä¿¡æ¯ã€‚</p><p>åœ¨PyTorchä¸­ï¼Œ<code>backward()</code>å‡½æ•°çš„ä½œç”¨æ˜¯è®¡ç®—æ¢¯åº¦ï¼Œå¹¶å°†æ¢¯åº¦ä¿¡æ¯å­˜å‚¨åœ¨<code>.grad</code>å±æ€§ä¸­ã€‚<code>backward()</code>å‡½æ•°çš„è°ƒç”¨è€…ï¼ˆå³<code>y</code>ï¼‰è‡ªèº«çš„æ¢¯åº¦è¢«è®¤ä¸ºæ˜¯1ï¼Œç„¶åè¿™ä¸ªæ¢¯åº¦ä¼šè¢«åå‘ä¼ æ’­å›æ‰€æœ‰å‚ä¸äº†è¿ç®—å¹¶éœ€è¦è®¡ç®—æ¢¯åº¦çš„å¼ é‡ã€‚</p><h1 id="æ¢¯åº¦ä¸‹é™ç®—æ³•"><a href="#æ¢¯åº¦ä¸‹é™ç®—æ³•" class="headerlink" title="æ¢¯åº¦ä¸‹é™ç®—æ³•"></a>æ¢¯åº¦ä¸‹é™ç®—æ³•</h1><h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>æ¢¯åº¦ä¸‹é™ç®—æ³•æ˜¯ä¸€ç§ç”¨äºä¼˜åŒ–ç›®æ ‡å‡½æ•°çš„è¿­ä»£æ–¹æ³•ã€‚å…·ä½“æ¥è¯´ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¯»æ‰¾å‡½æ•°æœ€å°å€¼çš„ç®—æ³•ã€‚å¯¹äºæœ€å¤§åŒ–é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æœ€å°åŒ–ç›®æ ‡å‡½æ•°çš„ç›¸åæ•°æ¥æ±‚è§£ã€‚</p><p>åœ¨æ¢¯åº¦ä¸‹é™ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆé€‰æ‹©ä¸€ä¸ªåˆå§‹ç‚¹ï¼ˆå³åˆå§‹å‚æ•°å€¼ï¼‰ï¼Œç„¶åæˆ‘ä»¬è¿­ä»£åœ°å°†å‚æ•°å‘è´Ÿæ¢¯åº¦æ–¹å‘ç§»åŠ¨ï¼Œè¿™æ ·åœ¨æ¯ä¸€æ­¥ï¼Œæˆ‘ä»¬éƒ½èƒ½å¤Ÿå‡å°ç›®æ ‡å‡½æ•°çš„å€¼ï¼Œç›´åˆ°æ‰¾åˆ°å‡½æ•°çš„å±€éƒ¨æœ€å°å€¼ã€‚</p><p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ¢¯åº¦ï¼ˆå‡½æ•°çš„ä¸€é˜¶å¯¼æ•°ï¼‰ç»™å‡ºäº†å‡½æ•°å€¼ä¸‹é™æœ€å¿«çš„æ–¹å‘ã€‚æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªå«åšå­¦ä¹ ç‡çš„å‚æ•°æ¥æ§åˆ¶æ¯ä¸€æ­¥ç§»åŠ¨çš„å¤§å°ã€‚å­¦ä¹ ç‡å†³å®šäº†æ¯æ¬¡è¿­ä»£æ—¶å‚æ•°æ›´æ–°çš„æ­¥é•¿ï¼Œè¿‡å¤§çš„å­¦ä¹ ç‡å¯èƒ½ä¼šä½¿ç®—æ³•åœ¨æœ€å°å€¼å¤„éœ‡è¡ï¼Œè¿‡å°åˆ™å¯èƒ½ä¼šå¯¼è‡´ç®—æ³•æ”¶æ•›é€Ÿåº¦è¿‡æ…¢ã€‚</p><h2 id="å…¬å¼"><a href="#å…¬å¼" class="headerlink" title="å…¬å¼"></a>å…¬å¼</h2><p>åŸºæœ¬çš„æ¢¯åº¦ä¸‹é™æ›´æ–°å…¬å¼ä¸ºï¼š</p><p>$$<br>\theta_{new} = \theta_{old} - \alpha \nabla J(\theta_{old})<br>$$</p><p>å…¶ä¸­ï¼Œ$\theta$ è¡¨ç¤ºæˆ‘ä»¬è¯•å›¾ä¼˜åŒ–çš„å‚æ•°ï¼Œ$J(\theta)$ æ˜¯æˆ‘ä»¬è¯•å›¾æœ€å°åŒ–çš„ç›®æ ‡å‡½æ•°ï¼Œ$\nabla J(\theta_{old})$ æ˜¯åœ¨å½“å‰å‚æ•°å€¼ $\theta_{old}$ å¤„çš„ç›®æ ‡å‡½æ•°çš„æ¢¯åº¦ï¼Œ$\alpha$ æ˜¯å­¦ä¹ ç‡ã€‚</p><h2 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h2><p>è€ƒè™‘ä¸€ä¸ªç®€å•çš„çº¿æ€§å›å½’é—®é¢˜ã€‚æˆ‘ä»¬æœ‰ä¸€ä¸ªç›®æ ‡å‡½æ•°ï¼ˆæŸå¤±å‡½æ•°ï¼‰ä¸ºå‡æ–¹è¯¯å·®ï¼š</p><p>$$<br>J(\theta) = \frac{1}{2m} \sum_{i=1}^{m} (h_{\theta}(x^{(i)}) - y^{(i)})^2<br>$$</p><p>å…¶ä¸­ï¼Œ$h_{\theta}(x^{(i)}) = \theta^T x^{(i)}$ æ˜¯é¢„æµ‹å‡½æ•°ï¼Œ$m$ æ˜¯è®­ç»ƒæ ·æœ¬æ•°é‡ã€‚</p><p>å¯¹äºè¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ¢¯åº¦ä¸‹é™ç®—æ³•æ¥æ‰¾åˆ°æœ€å°åŒ–æŸå¤±å‡½æ•°çš„å‚æ•° $\theta$ã€‚åœ¨æ¯æ¬¡è¿­ä»£ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆè®¡ç®—æŸå¤±å‡½æ•°çš„æ¢¯åº¦ï¼Œç„¶åæ ¹æ®å‰é¢çš„å…¬å¼æ›´æ–°å‚æ•°ã€‚</p><h2 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h2><p>ä¸‹é¢æ˜¯ä½¿ç”¨ Python å®ç°æ¢¯åº¦ä¸‹é™çš„ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gradient_descent</span>(<span class="params">X, y, theta, alpha, num_iters</span>):</span><br><span class="line">    m = y.size</span><br><span class="line">    J_history = np.zeros(num_iters)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(num_iters):</span><br><span class="line">        theta = theta - alpha * (<span class="number">1</span>/m) * (X.T @ (X @ theta - y))</span><br><span class="line">        J_history[i] = compute_cost(X, y, theta)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> theta, J_history</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">compute_cost</span>(<span class="params">X, y, theta</span>):</span><br><span class="line">    m = y.size</span><br><span class="line">    J = <span class="number">1</span>/(<span class="number">2</span>*m) * np.<span class="built_in">sum</span>(np.square(X @ theta - y))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> J</span><br></pre></td></tr></tbody></table></figure><p>åœ¨è¿™ä¸ªä»£ç ä¸­ï¼Œ<code>gradient_descent</code> å‡½æ•°å®ç°äº†æ¢¯åº¦ä¸‹é™ç®—æ³•ï¼Œ<code>compute_cost</code> å‡½æ•°ç”¨äºè®¡ç®—ç›®æ ‡å‡½æ•°ï¼ˆæŸå¤±å‡½æ•°ï¼‰çš„å€¼ã€‚</p><h1 id="æ¢¯åº¦ä¸‹é™ç®—æ³•çš„åˆ†ç±»"><a href="#æ¢¯åº¦ä¸‹é™ç®—æ³•çš„åˆ†ç±»" class="headerlink" title="æ¢¯åº¦ä¸‹é™ç®—æ³•çš„åˆ†ç±»"></a>æ¢¯åº¦ä¸‹é™ç®—æ³•çš„åˆ†ç±»</h1><p>æ¢¯åº¦ä¸‹é™ç®—æ³•æ˜¯ä¸€ç§ä¼˜åŒ–ç®—æ³•ï¼Œç”¨äºå¯»æ‰¾æŸå¤±å‡½æ•°çš„æœ€å°å€¼ã€‚åœ¨æœºå™¨å­¦ä¹ å’Œæ·±åº¦å­¦ä¹ ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨æ¢¯åº¦ä¸‹é™ç®—æ³•æ¥ä¼˜åŒ–æˆ‘ä»¬çš„æ¨¡å‹ï¼Œå³è°ƒæ•´æ¨¡å‹å‚æ•°ä»¥æœ€å°åŒ–æŸå¤±å‡½æ•°ã€‚ä»¥ä¸‹å°†ä»‹ç»æ¢¯åº¦ä¸‹é™çš„å‡ ç§ä¸»è¦å˜ä½“ã€‚</p><h2 id="æ‰¹é‡æ¢¯åº¦ä¸‹é™ï¼ˆBatch-Gradient-Descentï¼‰"><a href="#æ‰¹é‡æ¢¯åº¦ä¸‹é™ï¼ˆBatch-Gradient-Descentï¼‰" class="headerlink" title="æ‰¹é‡æ¢¯åº¦ä¸‹é™ï¼ˆBatch Gradient Descentï¼‰"></a>æ‰¹é‡æ¢¯åº¦ä¸‹é™ï¼ˆBatch Gradient Descentï¼‰</h2><p>æ‰¹é‡æ¢¯åº¦ä¸‹é™æ˜¯æœ€åŸºæœ¬çš„å½¢å¼ï¼Œå®ƒåœ¨æ¯ä¸€æ¬¡è¿­ä»£ä¸­éƒ½ä½¿ç”¨å…¨é‡çš„è®­ç»ƒæ•°æ®æ¥è®¡ç®—æŸå¤±å‡½æ•°çš„æ¢¯åº¦ã€‚å› æ­¤ï¼Œæ‰¹é‡æ¢¯åº¦ä¸‹é™çš„æ¯ä¸€æ­¥éƒ½æœç€å…¨å±€æœ€ä¼˜çš„æ–¹å‘ã€‚ç„¶è€Œï¼Œè¿™ä¹Ÿä½¿å¾—æ‰¹é‡æ¢¯åº¦ä¸‹é™åœ¨å¤§è§„æ¨¡æ•°æ®é›†ä¸Šéå¸¸æ…¢ï¼Œä¸”æ— æ³•åœ¨çº¿ï¼ˆå®æ—¶ï¼‰æ›´æ–°æ¨¡å‹ã€‚</p><p>æ›´æ–°å…¬å¼ï¼š</p><p>$$<br>\theta = \theta - \alpha \nabla J(\theta)<br>$$</p><p>å…¶ä¸­ï¼Œ$\theta$ æ˜¯å‚æ•°ï¼Œ$\alpha$ æ˜¯å­¦ä¹ ç‡ï¼Œ$\nabla J(\theta)$ æ˜¯æŸå¤±å‡½æ•° $J$ å…³äºå‚æ•° $\theta$ çš„æ¢¯åº¦ã€‚</p><h2 id="éšæœºæ¢¯åº¦ä¸‹é™ï¼ˆStochastic-Gradient-Descentï¼ŒSGDï¼‰"><a href="#éšæœºæ¢¯åº¦ä¸‹é™ï¼ˆStochastic-Gradient-Descentï¼ŒSGDï¼‰" class="headerlink" title="éšæœºæ¢¯åº¦ä¸‹é™ï¼ˆStochastic Gradient Descentï¼ŒSGDï¼‰"></a>éšæœºæ¢¯åº¦ä¸‹é™ï¼ˆStochastic Gradient Descentï¼ŒSGDï¼‰</h2><p>éšæœºæ¢¯åº¦ä¸‹é™åœ¨æ¯ä¸€æ¬¡è¿­ä»£ä¸­éšæœºé€‰æ‹©ä¸€ä¸ªæ ·æœ¬æ¥è®¡ç®—æ¢¯åº¦ã€‚å› æ­¤ï¼Œæ¯ä¸€æ­¥çš„æ›´æ–°æ–¹å‘å¹¶ä¸ä¸€å®šæ˜¯å…¨å±€æœ€ä¼˜çš„æ–¹å‘ï¼Œç»“æœä¼šæœ‰ä¸€äº›å™ªéŸ³ã€‚ç„¶è€Œï¼Œè¿™ä½¿å¾—éšæœºæ¢¯åº¦ä¸‹é™åœ¨å¤§è§„æ¨¡æ•°æ®é›†ä¸Šæ¯”æ‰¹é‡æ¢¯åº¦ä¸‹é™å¿«å¾ˆå¤šï¼Œä¸”èƒ½å¤Ÿåœ¨çº¿æ›´æ–°æ¨¡å‹ã€‚</p><p>æ›´æ–°å…¬å¼ä¸æ‰¹é‡æ¢¯åº¦ä¸‹é™ä¸€è‡´ï¼Œåªæ˜¯æ¯æ¬¡åªå¯¹ä¸€ä¸ªéšæœºæ ·æœ¬è¿›è¡Œè®¡ç®—ã€‚</p><h2 id="å°æ‰¹é‡æ¢¯åº¦ä¸‹é™ï¼ˆMini-Batch-Gradient-Descentï¼‰"><a href="#å°æ‰¹é‡æ¢¯åº¦ä¸‹é™ï¼ˆMini-Batch-Gradient-Descentï¼‰" class="headerlink" title="å°æ‰¹é‡æ¢¯åº¦ä¸‹é™ï¼ˆMini-Batch Gradient Descentï¼‰"></a>å°æ‰¹é‡æ¢¯åº¦ä¸‹é™ï¼ˆMini-Batch Gradient Descentï¼‰</h2><p>å°æ‰¹é‡æ¢¯åº¦ä¸‹é™æ˜¯æ‰¹é‡æ¢¯åº¦ä¸‹é™å’Œéšæœºæ¢¯åº¦ä¸‹é™çš„æŠ˜ä¸­ï¼Œå®ƒåœ¨æ¯ä¸€æ¬¡è¿­ä»£ä¸­ä½¿ç”¨ä¸€éƒ¨åˆ†ï¼ˆå°æ‰¹é‡ï¼‰æ ·æœ¬æ¥è®¡ç®—æ¢¯åº¦ã€‚å°æ‰¹é‡æ¢¯åº¦ä¸‹é™æ¯”éšæœºæ¢¯åº¦ä¸‹é™æ›´ç¨³å®šï¼ŒåŒæ—¶ä»ç„¶å…·æœ‰ç›¸å¯¹è¾ƒé«˜çš„è®¡ç®—é€Ÿåº¦ã€‚</p><p>æ›´æ–°å…¬å¼ä¸å‰é¢ä¸¤è€…ä¸€è‡´ï¼Œåªæ˜¯æ¯æ¬¡å¯¹ä¸€ä¸ªå°æ‰¹é‡çš„æ ·æœ¬è¿›è¡Œè®¡ç®—ã€‚</p><h1 id="æ¢¯åº¦ä¸‹é™ç®—æ³•çš„è¿›é˜¶å˜ä½“"><a href="#æ¢¯åº¦ä¸‹é™ç®—æ³•çš„è¿›é˜¶å˜ä½“" class="headerlink" title="æ¢¯åº¦ä¸‹é™ç®—æ³•çš„è¿›é˜¶å˜ä½“"></a>æ¢¯åº¦ä¸‹é™ç®—æ³•çš„è¿›é˜¶å˜ä½“</h1><p>åœ¨æ¢¯åº¦ä¸‹é™çš„åŸºç¡€ä¸Šï¼Œç ”ç©¶è€…ä»¬å¼•å…¥äº†ä¸€äº›é¢å¤–çš„æ¦‚å¿µä»¥æ”¹å–„ç®—æ³•çš„æ€§èƒ½ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¹¿ä¸ºä½¿ç”¨çš„æ¢¯åº¦ä¸‹é™ç®—æ³•çš„å˜ä½“ã€‚</p><h2 id="Momentum"><a href="#Momentum" class="headerlink" title="Momentum"></a>Momentum</h2><p>åŠ¨é‡ï¼ˆMomentumï¼‰æ˜¯ä¸€ç§å¸®åŠ©ä¼˜åŒ–å™¨åœ¨ç›¸å…³æ–¹å‘ä¸Šä¿æŒé€Ÿåº¦ï¼Œä»è€ŒæŠ‘åˆ¶æŒ¯è¡å¹¶åŠ å¿«æ”¶æ•›çš„ç­–ç•¥ã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯å¼•å…¥ä¸€ä¸ªæ–°çš„å˜é‡ï¼ˆé€šå¸¸ç§°ä¸ºé€Ÿåº¦ï¼‰ï¼Œå®ƒåœ¨æ¯ä¸€æ­¥ä¸­éƒ½ä¼šå¢åŠ å½“å‰æ¢¯åº¦ï¼Œç„¶åå‚æ•°æ›´æ–°ä¼šæŒ‰ç…§è¿™ä¸ªé€Ÿåº¦è¿›è¡Œã€‚</p><p>Momentumçš„æ›´æ–°å…¬å¼å¦‚ä¸‹ï¼š</p><p>$$<br>v = \beta v - \alpha \nabla J(\theta)<br>$$<br>$$<br>\theta = \theta + v<br>$$</p><p>å…¶ä¸­ï¼Œ$\theta$ æ˜¯å‚æ•°ï¼Œ$\nabla J(\theta)$ æ˜¯æŸå¤±å‡½æ•° $J$ å…³äºå‚æ•° $\theta$ çš„æ¢¯åº¦ï¼Œ$\alpha$ æ˜¯å­¦ä¹ ç‡ï¼Œ$v$ æ˜¯é€Ÿåº¦ï¼Œ$\beta$ æ˜¯åŠ¨é‡å› å­ï¼Œé€šå¸¸è®¾ä¸º0.9ã€‚</p><h2 id="AdaGrad"><a href="#AdaGrad" class="headerlink" title="AdaGrad"></a>AdaGrad</h2><p>AdaGradï¼ˆAdaptive Gradient Algorithmï¼‰çš„ä¸»è¦æ€æƒ³æ˜¯ä¸ºæ¯ä¸ªå‚æ•°åˆ†é…ä¸€ä¸ªè‡ªé€‚åº”çš„å­¦ä¹ ç‡ï¼Œè¿™å¯¹äºç¨€ç–æ•°æ®å’Œå¤„ç†éå¹³ç¨³ç›®æ ‡å‡½æ•°éå¸¸æœ‰ç”¨ã€‚å…·ä½“æ¥è¯´ï¼Œå¯¹äºç»å¸¸å‡ºç°ä¸”æœ‰å¤§æ¢¯åº¦çš„å‚æ•°ï¼Œå…¶å­¦ä¹ ç‡ä¼šè¢«é™ä½ï¼›åä¹‹ï¼Œå¯¹äºç¨€ç–æˆ–å°æ¢¯åº¦çš„å‚æ•°ï¼Œå…¶å­¦ä¹ ç‡ä¼šè¢«æé«˜ã€‚</p><p>AdaGradçš„æ›´æ–°å…¬å¼å¦‚ä¸‹ï¼š</p><p>$$<br>G_{t} = G_{t-1} + (\nabla J(\theta))^2<br>$$<br>$$<br>\theta = \theta - \frac{\alpha}{\sqrt{G_{t} + \epsilon}} \cdot \nabla J(\theta)<br>$$</p><p>å…¶ä¸­ï¼Œ$G_{t}$ æ˜¯åˆ°ç›®å‰ä¸ºæ­¢æ‰€æœ‰æ¢¯åº¦çš„å¹³æ–¹å’Œï¼Œ$\epsilon$ æ˜¯ä¸€ä¸ªå¾ˆå°çš„æ•°ï¼Œé€šå¸¸è®¾ä¸º1e-8ï¼Œç”¨äºé˜²æ­¢é™¤é›¶é”™è¯¯ã€‚</p><h2 id="RMSProp"><a href="#RMSProp" class="headerlink" title="RMSProp"></a>RMSProp</h2><p>RMSPropï¼ˆRoot Mean Square Propagationï¼‰æ˜¯AdaGradçš„ä¸€ä¸ªæ”¹è¿›ç‰ˆæœ¬ï¼Œä¸»è¦è§£å†³äº†AdaGradåœ¨éå‡¸è®¾ç½®ä¸‹å­¦ä¹ ç‡å¿«é€Ÿä¸‹é™çš„é—®é¢˜ã€‚ä¸AdaGradä¸€æ ·ï¼ŒRMSPropä¹Ÿæ˜¯ä¸ºæ¯ä¸ªå‚æ•°åˆ†é…ä¸€ä¸ªè‡ªé€‚åº”çš„å­¦ä¹ ç‡ï¼Œä½†æ˜¯å®ƒä½¿ç”¨äº†ä¸€ä¸ªæ»‘åŠ¨å¹³å‡çš„æ¢¯åº¦å¹³æ–¹æ¥æ›´æ–° $G_{t}$ã€‚</p><p>RMSPropçš„æ›´æ–°å…¬å¼å¦‚ä¸‹ï¼š</p><p>$$<br>G_{t} = \beta G_{t-1} + (1 - \beta) (\nabla J(\theta))^2<br>$$<br>$$<br>\theta = \theta - \frac{\alpha}{\sqrt{G_{t} + \epsilon}} \cdot \nabla J(\theta)<br>$$</p><p>å…¶ä¸­ï¼Œ$\beta$ æ˜¯å¹³æ–¹æ¢¯åº¦çš„æ»‘åŠ¨å¹³å‡å› å­ï¼Œé€šå¸¸è®¾ä¸º0.9ã€‚</p><h2 id="Adam"><a href="#Adam" class="headerlink" title="Adam"></a>Adam</h2><p>Adamï¼ˆAdaptive Moment Estimationï¼‰ç»“åˆäº†Momentumå’ŒRMSPropçš„æ€æƒ³ã€‚å®ƒè®¡ç®—äº†æ¢¯åº¦çš„æŒ‡æ•°æ»‘åŠ¨å¹³å‡ï¼ˆç¬¬ä¸€çŸ©ï¼‰å’Œå¹³æ–¹æ¢¯åº¦çš„æŒ‡æ•°æ»‘åŠ¨å¹³å‡ï¼ˆç¬¬äºŒçŸ©ï¼‰ï¼Œå¹¶ä½¿ç”¨è¿™ä¸¤ä¸ªé‡æ¥æ›´æ–°å‚æ•°ã€‚</p><p>Adamçš„æ›´æ–°å…¬å¼å¦‚ä¸‹ï¼š</p><p>$$<br>m = \beta_{1} m + (1 - \beta_{1}) \nabla J(\theta)<br>$$<br>$$<br>v = \beta_{2} v + (1 - \beta_{2}) (\nabla J(\theta))^2<br>$$<br>$$<br>\hat{m} = \frac{m}{1 - \beta_{1}^{t}}<br>$$<br>$$<br>\hat{v} = \frac{v}{1 - \beta_{2}^{t}}<br>$$<br>$$<br>\theta = \theta - \frac{\alpha \hat{m}}{\sqrt{\hat{v}} + \epsilon}<br>$$</p><p>å…¶ä¸­ï¼Œ$m$ å’Œ $v$ åˆ†åˆ«æ˜¯ç¬¬ä¸€çŸ©å’Œç¬¬äºŒçŸ©çš„ä¼°è®¡ï¼Œ$\beta_{1}$ å’Œ $\beta_{2}$ åˆ†åˆ«æ˜¯ç¬¬ä¸€çŸ©å’Œç¬¬äºŒçŸ©çš„æ»‘åŠ¨å¹³å‡å› å­ï¼Œé€šå¸¸è®¾ä¸º0.9å’Œ0.999ï¼Œ$t$ æ˜¯å½“å‰çš„è¿­ä»£æ­¥æ•°ã€‚</p><h1 id="PyTorchä¼˜åŒ–å™¨è¯¦ç»†ä»‹ç»"><a href="#PyTorchä¼˜åŒ–å™¨è¯¦ç»†ä»‹ç»" class="headerlink" title="PyTorchä¼˜åŒ–å™¨è¯¦ç»†ä»‹ç»"></a>PyTorchä¼˜åŒ–å™¨è¯¦ç»†ä»‹ç»</h1><p>PyTorchæä¾›äº†ä¸€äº›å·²ç»å®ç°çš„ä¼˜åŒ–å™¨ï¼Œè¿™äº›ä¼˜åŒ–å™¨éƒ½åœ¨torch.optimæ¨¡å—ä¸­ã€‚ä¼˜åŒ–å™¨çš„ä¸»è¦ä½œç”¨æ˜¯æ›´æ–°æ¨¡å‹çš„å‚æ•°ä»¥æœ€å°åŒ–ç›®æ ‡å‡½æ•°ï¼ˆé€šå¸¸ä¸ºæŸå¤±å‡½æ•°ï¼‰ã€‚</p><h2 id="å¸¸è§ä¼˜åŒ–å™¨ä»‹ç»åŠä½¿ç”¨"><a href="#å¸¸è§ä¼˜åŒ–å™¨ä»‹ç»åŠä½¿ç”¨" class="headerlink" title="å¸¸è§ä¼˜åŒ–å™¨ä»‹ç»åŠä½¿ç”¨"></a>å¸¸è§ä¼˜åŒ–å™¨ä»‹ç»åŠä½¿ç”¨</h2><ol><li><strong>éšæœºæ¢¯åº¦ä¸‹é™ï¼ˆSGDï¼‰</strong></li></ol><p>SGDæ˜¯æœ€åŸºæœ¬çš„ä¼˜åŒ–å™¨ï¼Œå®ƒå¯¹æ¯ä¸€ä¸ªå‚æ•°ä½¿ç”¨ç›¸åŒçš„å­¦ä¹ ç‡è¿›è¡Œæ›´æ–°ã€‚è¿™æ˜¯å…¶æ›´æ–°å…¬å¼ï¼š</p><p>$$<br>\theta_{new} = \theta_{old} - \alpha \nabla J(\theta_{old})<br>$$</p><p>åœ¨PyTorchä¸­ï¼Œå¯ä»¥è¿™æ ·ä½¿ç”¨SGDä¼˜åŒ–å™¨ï¼š</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">optimizer = torch.optim.SGD(model.parameters(), lr=<span class="number">0.1</span>)</span><br></pre></td></tr></tbody></table></figure><ol start="2"><li><strong>å¸¦åŠ¨é‡çš„éšæœºæ¢¯åº¦ä¸‹é™ï¼ˆMomentum SGDï¼‰</strong></li></ol><p>Momentum SGDæ˜¯SGDçš„ä¸€ç§æ”¹è¿›ï¼Œå®ƒåœ¨æ›´æ–°å‚æ•°æ—¶ä¼šè€ƒè™‘è¿‡å»çš„æ¢¯åº¦ï¼Œä»è€Œè¾¾åˆ°å¹³æ»‘æ›´æ–°çš„æ•ˆæœã€‚è¿™æ˜¯å…¶æ›´æ–°å…¬å¼ï¼š</p><p>$$<br>v = \beta v - \alpha \nabla J(\theta)<br>$$<br>$$<br>\theta = \theta + v<br>$$</p><p>å…¶ä¸­ï¼Œ$v$æ˜¯åŠ¨é‡ï¼Œ$\beta$æ˜¯åŠ¨é‡è¡°å‡å› å­ã€‚åœ¨PyTorchä¸­ï¼Œå¯ä»¥è¿™æ ·ä½¿ç”¨Momentum SGDä¼˜åŒ–å™¨ï¼š</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">optimizer = torch.optim.SGD(model.parameters(), lr=<span class="number">0.1</span>, momentum=<span class="number">0.9</span>)</span><br></pre></td></tr></tbody></table></figure><ol start="3"><li><strong>è‡ªé€‚åº”æ¢¯åº¦ç®—æ³•ï¼ˆAdagradï¼‰</strong></li></ol><p>Adagradæ˜¯ä¸€ç§è‡ªé€‚åº”å­¦ä¹ ç‡çš„ä¼˜åŒ–å™¨ï¼Œå®ƒä¼šå¯¹æ¯ä¸€ä¸ªå‚æ•°ä½¿ç”¨ä¸åŒçš„å­¦ä¹ ç‡è¿›è¡Œæ›´æ–°ã€‚è¿™ä½¿å¾—å®ƒåœ¨å¤„ç†ç¨€ç–æ•°æ®æ—¶æœ‰å¾ˆå¥½çš„è¡¨ç°ã€‚è¿™æ˜¯å…¶æ›´æ–°å…¬å¼ï¼š</p><p>$$<br>\theta_{new} = \theta_{old} - \frac{\alpha}{\sqrt{G_{t} + \epsilon}} \cdot \nabla J(\theta_{old})<br>$$</p><p>å…¶ä¸­ï¼Œ$G_{t}$æ˜¯åˆ°ç›®å‰ä¸ºæ­¢æ‰€æœ‰æ¢¯åº¦çš„å¹³æ–¹å’Œï¼Œ$\epsilon$æ˜¯ä¸€ä¸ªå¾ˆå°çš„æ•°ï¼ˆå¦‚1e-8ï¼‰ç”¨äºé˜²æ­¢é™¤é›¶é”™è¯¯ã€‚åœ¨PyTorchä¸­ï¼Œå¯ä»¥è¿™æ ·ä½¿ç”¨Adagradä¼˜åŒ–å™¨ï¼š</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">optimizer = torch.optim.Adagrad(model.parameters(), lr=<span class="number">0.1</span>)</span><br></pre></td></tr></tbody></table></figure><ol start="4"><li><strong>è‡ªé€‚åº”åŠ¨é‡ä¼°è®¡ï¼ˆAdamï¼‰</strong></li></ol><p>Adamç»“åˆäº†Momentum SGDå’ŒAdagradçš„æ€æƒ³ï¼Œå®ƒå¯¹æ¯ä¸ªå‚æ•°éƒ½æœ‰ä¸€ä¸ªè‡ªé€‚åº”çš„å­¦ä¹ ç‡ï¼Œå¹¶ä¸”ä¼šè€ƒè™‘è¿‡å»çš„æ¢¯åº¦ã€‚è¿™ä½¿å¾—å®ƒåœ¨è®¸å¤šä»»åŠ¡ä¸Šéƒ½æœ‰å¾ˆå¥½çš„è¡¨ç°ã€‚è¿™æ˜¯å…¶æ›´æ–°å…¬å¼ï¼š</p><p>$$<br>m = \beta_{1} m + (1 - \beta_{1}) \nabla J(\theta)<br>$$<br>$$<br>v = \beta_{2} v + (1 - \beta_{2}) (\nabla J(\theta))^2<br>$$<br>$$<br>\hat{m} = \frac{m}{1 - \beta_{1}^{t}}<br>$$<br>$$<br>\hat{v} = \frac{v}{1 - \beta_{2}^{t}}<br>$$<br>$$<br>\theta = \theta - \frac{\alpha \hat{m}}{\sqrt{\hat{v}} + \epsilon}<br>$$</p><p>å…¶ä¸­ï¼Œ$m$å’Œ$v$åˆ†åˆ«æ˜¯ç¬¬ä¸€å’Œç¬¬äºŒçŸ©ä¼°è®¡ï¼Œ$\beta_{1}$å’Œ$\beta_{2}$æ˜¯è¡°å‡å› å­ï¼ˆä¸€èˆ¬è®¾ä¸º0.9å’Œ0.999ï¼‰ï¼Œ$t$æ˜¯è¿­ä»£æ¬¡æ•°ã€‚åœ¨PyTorchä¸­ï¼Œå¯ä»¥è¿™æ ·ä½¿ç”¨Adamä¼˜åŒ–å™¨ï¼š</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">optimizer = torch.optim.Adam(model.parameters(), lr=<span class="number">0.001</span>)</span><br></pre></td></tr></tbody></table></figure><h2 id="ä¼˜åŒ–å™¨çš„ä½¿ç”¨æ–¹æ³•"><a href="#ä¼˜åŒ–å™¨çš„ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä¼˜åŒ–å™¨çš„ä½¿ç”¨æ–¹æ³•"></a>ä¼˜åŒ–å™¨çš„ä½¿ç”¨æ–¹æ³•</h2><p>ä¼˜åŒ–å™¨çš„åŸºæœ¬ä½¿ç”¨æµç¨‹å¦‚ä¸‹ï¼š</p><ol><li>å®šä¹‰æ¨¡å‹ï¼ˆmodelï¼‰ã€‚</li><li>å®šä¹‰æŸå¤±å‡½æ•°ï¼ˆloss functionï¼‰ã€‚</li><li>é€‰æ‹©ä¼˜åŒ–å™¨ï¼ˆoptimizerï¼‰ï¼Œå¹¶å°†æ¨¡å‹çš„å‚æ•°å’Œå­¦ä¹ ç‡ä¼ å…¥ä¼˜åŒ–å™¨ã€‚</li><li>åœ¨è®­ç»ƒå¾ªç¯ä¸­ï¼Œé¦–å…ˆæ¸…ç©ºä¼˜åŒ–å™¨çš„æ¢¯åº¦ï¼ˆoptimizer.zero_grad()ï¼‰ï¼Œç„¶åè®¡ç®—æŸå¤±ï¼ˆloss.backward()ï¼‰ï¼Œæœ€åæ›´æ–°æ¨¡å‹çš„å‚æ•°ï¼ˆoptimizer.step()ï¼‰ã€‚</li></ol><h2 id="ä¼˜åŒ–å™¨çš„é€‰æ‹©åœºæ™¯"><a href="#ä¼˜åŒ–å™¨çš„é€‰æ‹©åœºæ™¯" class="headerlink" title="ä¼˜åŒ–å™¨çš„é€‰æ‹©åœºæ™¯"></a>ä¼˜åŒ–å™¨çš„é€‰æ‹©åœºæ™¯</h2><ol><li><strong>SGD</strong>ï¼šé€‚ç”¨äºå¤§è§„æ¨¡çº¿æ€§æ¨¡å‹ï¼Œæˆ–è€…åœ¨è®­ç»ƒåˆæœŸå¿«é€Ÿé™ä½æŸå¤±ã€‚</li><li><strong>Momentum SGD</strong>ï¼šé€‚ç”¨äºæ·±åº¦å­¦ä¹ ä»»åŠ¡ï¼Œæ¯”SGDæœ‰æ›´å¿«çš„æ”¶æ•›é€Ÿåº¦ã€‚</li><li><strong>Adagrad</strong>ï¼šé€‚ç”¨äºå¤„ç†ç¨€ç–æ•°æ®çš„ä»»åŠ¡ï¼Œå¦‚è‡ªç„¶è¯­è¨€å¤„ç†ä¸­çš„è¯å‘é‡è®­ç»ƒã€‚</li><li><strong>Adam</strong>ï¼šé€‚ç”¨äºå¤§å¤šæ•°æ·±åº¦å­¦ä¹ ä»»åŠ¡ï¼Œæ˜¯ä¸€ä¸ªæ¯”è¾ƒé€šç”¨çš„ä¼˜åŒ–å™¨ã€‚</li></ol><p>é€‰æ‹©å“ªç§ä¼˜åŒ–å™¨å¹¶æ²¡æœ‰å›ºå®šçš„è§„åˆ™ï¼Œå…·ä½“è¦æ ¹æ®ä»»åŠ¡çš„ç‰¹ç‚¹å’Œæ•°æ®çš„ç‰¹æ€§æ¥å†³å®šã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå¯ä»¥å…ˆè¯•ç”¨Adamï¼Œå¦‚æœæ•ˆæœä¸ä½³ï¼Œå†è€ƒè™‘å…¶ä»–ä¼˜åŒ–å™¨ã€‚</p><h1 id="åå‘ä¼ æ’­ç®—æ³•"><a href="#åå‘ä¼ æ’­ç®—æ³•" class="headerlink" title="åå‘ä¼ æ’­ç®—æ³•"></a>åå‘ä¼ æ’­ç®—æ³•</h1><p>åå‘ä¼ æ’­ï¼ˆBackpropagationï¼‰æ˜¯ç¥ç»ç½‘ç»œä¸­ç”¨äºè®­ç»ƒæ¨¡å‹çš„ä¸»è¦ç®—æ³•ä¹‹ä¸€ï¼Œå®ƒæ˜¯è®¸å¤šç°ä»£æ·±åº¦å­¦ä¹ æ¡†æ¶ï¼ˆå¦‚TensorFlowå’ŒPyTorchï¼‰çš„æ ¸å¿ƒéƒ¨åˆ†ã€‚ä»¥ä¸‹å°†è¯¦ç»†ä»‹ç»åå‘ä¼ æ’­çš„å·¥ä½œåŸç†ã€‚å®ƒçš„ä¸»è¦ä»»åŠ¡æ˜¯é€šè¿‡è®¡ç®—æŸå¤±å‡½æ•°ï¼ˆä¸€ä¸ªè¡¡é‡æ¨¡å‹é¢„æµ‹ä¸çœŸå®å€¼å·®å¼‚çš„å‡½æ•°ï¼‰å¯¹æ¨¡å‹å‚æ•°çš„æ¢¯åº¦æ¥æœ‰æ•ˆåœ°æ›´æ–°ç½‘ç»œçš„æƒé‡å’Œåç½®ï¼Œä»¥æœ€å°åŒ–æŸå¤±å‡½æ•°ã€‚</p><h2 id="åŸç†-1"><a href="#åŸç†-1" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>åå‘ä¼ æ’­çš„ç›®æ ‡æ˜¯è®¡ç®—æŸå¤±å‡½æ•°å…³äºç¥ç»ç½‘ç»œå‚æ•°çš„æ¢¯åº¦ï¼Œä»¥ä¾¿ä½¿ç”¨æ¢¯åº¦ä¸‹é™æˆ–å…¶ä»–ä¼˜åŒ–ç®—æ³•æ¥æ›´æ–°å‚æ•°ã€‚ä¸ºæ­¤ï¼Œåå‘ä¼ æ’­ä»è¾“å‡ºå±‚å¼€å§‹ï¼Œæ²¿ç€ç¥ç»ç½‘ç»œåå‘ä¼ é€’æ¢¯åº¦ã€‚</p><p>åå‘ä¼ æ’­çš„å…³é”®æ€æƒ³æ˜¯é“¾å¼æ³•åˆ™ï¼ˆchain ruleï¼‰ï¼Œè¿™æ˜¯å¾®ç§¯åˆ†çš„ä¸€ä¸ªåŸºæœ¬å®šç†ï¼Œç”¨äºè®¡ç®—å¤åˆå‡½æ•°çš„å¯¼æ•°ã€‚åœ¨ç¥ç»ç½‘ç»œçš„ä¸Šä¸‹æ–‡ä¸­ï¼Œé“¾å¼æ³•åˆ™ç”¨äºè®¡ç®—æŸå¤±å‡½æ•°å…³äºå‚æ•°çš„æ¢¯åº¦ï¼Œé€šè¿‡å°†è¿™ä¸ªå¤åˆå‡½æ•°æ‹†åˆ†æˆä¸€ç³»åˆ—æ›´ç®€å•çš„å‡½æ•°ï¼Œå¹¶å°†å®ƒä»¬çš„å¯¼æ•°ç›¸ä¹˜ã€‚</p><h2 id="ç®—æ³•è¿‡ç¨‹"><a href="#ç®—æ³•è¿‡ç¨‹" class="headerlink" title="ç®—æ³•è¿‡ç¨‹"></a>ç®—æ³•è¿‡ç¨‹</h2><p>ä»¥ä¸‹æ˜¯åå‘ä¼ æ’­ç®—æ³•çš„ä¸€èˆ¬æ­¥éª¤ï¼š</p><ol><li><p><strong>å‰å‘ä¼ æ’­</strong>ï¼šä»è¾“å…¥å±‚å¼€å§‹ï¼Œé€šè¿‡ç½‘ç»œå‘å‰ä¼ æ’­æ•°æ®ï¼Œè®¡ç®—æ¯ä¸€å±‚çš„è¾“å‡ºï¼Œç›´åˆ°å¾—åˆ°æœ€ç»ˆçš„é¢„æµ‹ç»“æœã€‚</p></li><li><p><strong>è®¡ç®—æŸå¤±</strong>ï¼šä½¿ç”¨æŸå¤±å‡½æ•°è®¡ç®—é¢„æµ‹ç»“æœå’Œå®é™…ç›®æ ‡ä¹‹é—´çš„è¯¯å·®ã€‚</p></li><li><p><strong>åå‘ä¼ æ’­æŸå¤±</strong>ï¼šä»è¾“å‡ºå±‚å¼€å§‹ï¼Œè®¡ç®—æŸå¤±å‡½æ•°å…³äºæ¯ä¸€å±‚è¾“å‡ºçš„æ¢¯åº¦ï¼Œå¹¶åå‘ä¼ æ’­è¿™äº›æ¢¯åº¦ã€‚å…·ä½“æ¥è¯´ï¼Œå¯¹äºæ¯ä¸€å±‚ï¼Œæˆ‘ä»¬é¦–å…ˆè®¡ç®—æŸå¤±å‡½æ•°å…³äºè¿™ä¸€å±‚è¾“å‡ºçš„æ¢¯åº¦ï¼Œç„¶åä½¿ç”¨é“¾å¼æ³•åˆ™ï¼Œè®¡ç®—è¿™ä¸ªæ¢¯åº¦å…³äºè¿™ä¸€å±‚è¾“å…¥çš„æ¢¯åº¦ï¼Œä»¥åŠå…³äºè¿™ä¸€å±‚å‚æ•°çš„æ¢¯åº¦ã€‚</p></li><li><p><strong>æ›´æ–°å‚æ•°</strong>ï¼šä½¿ç”¨æ¢¯åº¦ä¸‹é™æˆ–å…¶ä»–ä¼˜åŒ–ç®—æ³•ï¼Œåˆ©ç”¨åœ¨æ­¥éª¤3ä¸­è®¡ç®—å‡ºçš„æ¢¯åº¦æ¥æ›´æ–°ç½‘ç»œå‚æ•°ã€‚</p></li></ol><p>è¿™ä¸ªè¿‡ç¨‹åœ¨æ¯ä¸ªè®­ç»ƒè¿­ä»£ä¸­é‡å¤ï¼Œç›´åˆ°ç½‘ç»œå‚æ•°æ”¶æ•›ï¼Œæˆ–è€…è¾¾åˆ°é¢„è®¾çš„æœ€å¤§è¿­ä»£æ¬¡æ•°ã€‚</p><h2 id="è®¡ç®—æ–¹æ³•"><a href="#è®¡ç®—æ–¹æ³•" class="headerlink" title="è®¡ç®—æ–¹æ³•"></a>è®¡ç®—æ–¹æ³•</h2><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªæŸå¤±å‡½æ•° $L$ï¼Œæˆ‘ä»¬æƒ³è¦çŸ¥é“å®ƒå…³äºæƒé‡ $w_{ij}$ ï¼ˆè¡¨ç¤ºä»ç¬¬ $i$ ä¸ªç¥ç»å…ƒåˆ°ç¬¬ $j$ ä¸ªç¥ç»å…ƒçš„æƒé‡ï¼‰çš„æ¢¯åº¦ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹çš„å…¬å¼ï¼š</p><p>$$<br>\frac{\partial L}{\partial w_{ij}} = \frac{\partial L}{\partial z_j} \cdot \frac{\partial z_j}{\partial w_{ij}}<br>$$</p><p>å…¶ä¸­ï¼Œ$z_j$ æ˜¯ $j$ ä¸ªç¥ç»å…ƒçš„è¾“å…¥ï¼Œå®ƒç­‰äº $\sum_i w_{ij} x_i + b_j$ã€‚</p><p>ç°åœ¨æˆ‘ä»¬éœ€è¦æ‰¾åˆ°æ¯ä¸ªéƒ¨åˆ†çš„å¯¼æ•°ã€‚é¦–å…ˆï¼Œ$\frac{\partial L}{\partial z_j}$ é€šå¸¸ç›´æ¥ç”±ç½‘ç»œçš„åé¢éƒ¨åˆ†æä¾›ã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬ä¸€èˆ¬ä¼šæŒ‰ç…§ä»åå‘å‰çš„é¡ºåºè®¡ç®—å¯¼æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬é¦–å…ˆè®¡ç®—å‡ºæŸå¤±å‡½æ•°å¯¹äºæœ€åä¸€å±‚çš„è¾“å‡ºçš„å¯¼æ•°ï¼Œç„¶åç”¨è¿™ä¸ªå¯¼æ•°æ¥è®¡ç®—æŸå¤±å‡½æ•°å¯¹äºå€’æ•°ç¬¬äºŒå±‚çš„è¾“å‡ºçš„å¯¼æ•°ï¼Œä»¥æ­¤ç±»æ¨ã€‚</p><p>ç„¶åï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ° $\frac{\partial z_j}{\partial w_{ij}}$ã€‚ç”±äº $z_j = \sum_i w_{ij} x_i + b_j$ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœæˆ‘ä»¬æ”¹å˜ $w_{ij}$ï¼Œ$z_j$ å°±ä¼šæŒ‰ç…§ $x_i$ çš„å¤§å°æ”¹å˜ã€‚æ‰€ä»¥ï¼Œ$\frac{\partial z_j}{\partial w_{ij}} = x_i$ã€‚</p><p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¾—åˆ°äº†ï¼š</p><p>$$<br>\frac{\partial L}{\partial w_{ij}} = \frac{\partial L}{\partial z_j} \cdot x_i<br>$$</p><p>è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªå…·ä½“çš„ä¾‹å­ã€‚å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç®€å•çš„ç¥ç»ç½‘ç»œï¼Œåªæœ‰è¾“å…¥å±‚å’Œè¾“å‡ºå±‚ï¼Œæ²¡æœ‰éšè—å±‚ã€‚è¾“å…¥å±‚æœ‰ä¸€ä¸ªç¥ç»å…ƒï¼Œå…¶å€¼ä¸º $x$ï¼Œè¾“å‡ºå±‚ä¹Ÿæœ‰ä¸€ä¸ªç¥ç»å…ƒï¼Œå…¶å€¼ä¸º $y$ã€‚ä»–ä»¬ä¹‹é—´çš„æƒé‡æ˜¯ $w$ï¼Œåç½®ä¸º $b$ã€‚é‚£ä¹ˆï¼Œ$y$ çš„è®¡ç®—å…¬å¼å°±æ˜¯ $y = wx + b$ã€‚æˆ‘ä»¬ç”¨å‡æ–¹è¯¯å·®ä½œä¸ºæŸå¤±å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœçœŸå®å€¼æ˜¯ $t$ï¼Œé‚£ä¹ˆæŸå¤±å‡½æ•°å°±æ˜¯ $L = (t - y)^2$ã€‚</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬æƒ³è¦è®¡ç®— $\frac{\partial L}{\partial w}$ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ° $\frac{\partial L}{\partial y}$ã€‚ç”±äº $L = (t - y)^2$ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ° $\frac{\partial L}{\partial y} = -2(t - y)$ã€‚</p><p>ç„¶åï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ° $\frac{\partial y}{\partial w}$ã€‚ç”±äº $y = wx + b$ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ° $\frac{\partial y}{\partial w} = x$ã€‚</p><p>æ‰€ä»¥ï¼Œæœ€åæˆ‘ä»¬å¾—åˆ°ï¼š</p><p>$$<br>\frac{\partial L}{\partial w} = \frac{\partial L}{\partial y} \cdot \frac{\partial y}{\partial w} = -2(t - y) \cdot x<br>$$</p><p>è¿™å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„æ¢¯åº¦ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥æ›´æ–°æƒé‡ $w$ï¼Œä»¥å‡å°æŸå¤±å‡½æ•°ã€‚</p><h2 id="ä»£ç å®ç°-1"><a href="#ä»£ç å®ç°-1" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h2><h3 id="PyyTorchä¸­çš„åå‘ä¼ æ’­"><a href="#PyyTorchä¸­çš„åå‘ä¼ æ’­" class="headerlink" title="PyyTorchä¸­çš„åå‘ä¼ æ’­"></a>PyyTorchä¸­çš„åå‘ä¼ æ’­</h3><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„åå‘ä¼ æ’­ç®—æ³•PyTorchä»£ç ç¤ºä¾‹è¿›è¡Œè¯¦ç»†åˆ†æ­¥è§£é‡Šï¼š</p><ol><li><strong>åˆ›å»ºä¸€ä¸ªç®€å•çš„ç¥ç»ç½‘ç»œ</strong>ï¼š</li></ol><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">model = nn.Sequential(</span><br><span class="line">    nn.Linear(<span class="number">10</span>, <span class="number">20</span>),</span><br><span class="line">    nn.ReLU(),</span><br><span class="line">    nn.Linear(<span class="number">20</span>, <span class="number">1</span>),</span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure><p>é¦–å…ˆï¼Œæˆ‘ä»¬ä½¿ç”¨PyTorchçš„<code>nn.Sequential</code>æ¥å®šä¹‰ä¸€ä¸ªç®€å•çš„ç¥ç»ç½‘ç»œã€‚è¿™ä¸ªç½‘ç»œç”±ä¸¤ä¸ªçº¿æ€§å±‚ï¼ˆ<code>nn.Linear</code>ï¼‰å’Œä¸€ä¸ªReLUæ¿€æ´»å‡½æ•°ï¼ˆ<code>nn.ReLU</code>ï¼‰ç»„æˆã€‚ç¬¬ä¸€ä¸ªçº¿æ€§å±‚å°†è¾“å…¥çš„å¤§å°ä»10å˜ä¸º20ï¼ŒReLUæ¿€æ´»å‡½æ•°å¢åŠ äº†æ¨¡å‹çš„éçº¿æ€§ï¼Œç¬¬äºŒä¸ªçº¿æ€§å±‚å°†å¤§å°ä¸º20çš„éšè—çŠ¶æ€æ˜ å°„ä¸ºå¤§å°ä¸º1çš„è¾“å‡ºã€‚</p><ol start="2"><li><strong>é€‰æ‹©æŸå¤±å‡½æ•°å’Œä¼˜åŒ–å™¨</strong>ï¼š</li></ol><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">criterion = nn.MSELoss()</span><br><span class="line">optimizer = torch.optim.SGD(model.parameters(), lr=<span class="number">0.01</span>)</span><br></pre></td></tr></tbody></table></figure><p>æ¥ç€ï¼Œæˆ‘ä»¬é€‰æ‹©ä¸€ä¸ªæŸå¤±å‡½æ•°å’Œä¸€ä¸ªä¼˜åŒ–å™¨ã€‚æŸå¤±å‡½æ•°ç”¨äºåº¦é‡æ¨¡å‹çš„é¢„æµ‹ä¸å®é™…ç›®æ ‡ä¹‹é—´çš„å·®è·ï¼Œä¼˜åŒ–å™¨ç”¨äºæ ¹æ®æŸå¤±çš„æ¢¯åº¦æ¥æ›´æ–°æ¨¡å‹çš„å‚æ•°ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é€‰æ‹©å‡æ–¹è¯¯å·®æŸå¤±ï¼ˆ<code>nn.MSELoss</code>ï¼‰ä½œä¸ºæŸå¤±å‡½æ•°ï¼Œé€‰æ‹©éšæœºæ¢¯åº¦ä¸‹é™ï¼ˆ<code>torch.optim.SGD</code>ï¼‰ä½œä¸ºä¼˜åŒ–å™¨ã€‚</p><ol start="3"><li><strong>æ¨¡æ‹Ÿè¾“å…¥å’Œç›®æ ‡æ•°æ®</strong>ï¼š</li></ol><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">inputs = torch.randn(<span class="number">5</span>, <span class="number">10</span>)</span><br><span class="line">targets = torch.randn(<span class="number">5</span>, <span class="number">1</span>)</span><br></pre></td></tr></tbody></table></figure><p>ç„¶åï¼Œæˆ‘ä»¬ç”Ÿæˆä¸€äº›æ¨¡æ‹Ÿçš„è¾“å…¥å’Œç›®æ ‡æ•°æ®ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ç”Ÿæˆä¸€ä¸ªå½¢çŠ¶ä¸º[5, 10]çš„è¾“å…¥å¼ é‡å’Œä¸€ä¸ªå½¢çŠ¶ä¸º[5, 1]çš„ç›®æ ‡å¼ é‡ã€‚</p><ol start="4"><li><strong>å‰å‘ä¼ æ’­</strong>ï¼š</li></ol><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">outputs = model(inputs)</span><br></pre></td></tr></tbody></table></figure><p>åœ¨å‰å‘ä¼ æ’­é˜¶æ®µï¼Œæˆ‘ä»¬å°†è¾“å…¥æ•°æ®ä¼ å…¥æ¨¡å‹ï¼Œå¾—åˆ°æ¨¡å‹çš„é¢„æµ‹è¾“å‡ºã€‚</p><ol start="5"><li><strong>è®¡ç®—æŸå¤±</strong>ï¼š</li></ol><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">loss = criterion(outputs, targets)</span><br></pre></td></tr></tbody></table></figure><p>æ¥ç€ï¼Œæˆ‘ä»¬ä½¿ç”¨æŸå¤±å‡½æ•°æ¥è®¡ç®—æ¨¡å‹çš„é¢„æµ‹è¾“å‡ºä¸å®é™…ç›®æ ‡ä¹‹é—´çš„å·®è·ã€‚</p><ol start="6"><li><strong>åå‘ä¼ æ’­</strong>ï¼š</li></ol><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">loss.backward()</span><br></pre></td></tr></tbody></table></figure><p>åœ¨åå‘ä¼ æ’­é˜¶æ®µï¼Œæˆ‘ä»¬è°ƒç”¨æŸå¤±å¼ é‡çš„<code>backward</code>æ–¹æ³•ï¼Œè®¡ç®—æŸå¤±å…³äºæ¨¡å‹å‚æ•°çš„æ¢¯åº¦ã€‚è¿™äº›æ¢¯åº¦å°†å­˜å‚¨åœ¨å¯¹åº”å‚æ•°çš„<code>.grad</code>å±æ€§ä¸­ã€‚</p><ol start="7"><li><strong>æ›´æ–°å‚æ•°</strong>ï¼š</li></ol><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">optimizer.step()</span><br></pre></td></tr></tbody></table></figure><p>ç„¶åï¼Œæˆ‘ä»¬è°ƒç”¨ä¼˜åŒ–å™¨çš„<code>step</code>æ–¹æ³•ï¼Œæ ¹æ®å­˜å‚¨åœ¨æ¨¡å‹å‚æ•°çš„<code>.grad</code>å±æ€§ä¸­çš„æ¢¯åº¦æ¥æ›´æ–°å‚æ•°ã€‚</p><ol start="8"><li><strong>æ¸…é›¶æ¢¯åº¦</strong>ï¼š</li></ol><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">optimizer.zero_grad()</span><br></pre></td></tr></tbody></table></figure><p>æœ€åï¼Œæˆ‘ä»¬è°ƒç”¨ä¼˜åŒ–å™¨çš„<code>zero_grad</code>æ–¹æ³•ï¼Œå°†æ¨¡å‹å‚æ•°çš„<code>.grad</code>å±æ€§ä¸­çš„æ¢¯åº¦æ¸…é›¶ã€‚è¿™ä¸€æ­¥æ˜¯å¿…è¦çš„ï¼Œå› ä¸ºPyTorché»˜è®¤ä¼šç´¯åŠ æ¢¯åº¦ï¼Œå³æ¯æ¬¡è°ƒç”¨<code>.backward</code>æ–¹æ³•æ—¶ï¼Œæ¢¯åº¦éƒ½ä¼šç´¯åŠ åˆ°<code>.grad</code>å±æ€§ä¸­ï¼Œè€Œä¸æ˜¯æ›¿æ¢ã€‚å¦‚æœä¸æ¸…é›¶æ¢¯åº¦ï¼Œä¸‹ä¸€æ¬¡è¿­ä»£æ—¶è®¡ç®—çš„æ¢¯åº¦å°†ä¼šä¸è¿™ä¸€æ¬¡è¿­ä»£çš„æ¢¯åº¦å åŠ ï¼Œå¯¼è‡´é”™è¯¯ã€‚</p><p>æ³¨æ„äº‹é¡¹ï¼šä»¥ä¸Šçš„ä»£ç æ˜¯ä¸€ä¸ªå®Œæ•´çš„è®­ç»ƒæ­¥éª¤ï¼Œå®é™…ä½¿ç”¨æ—¶é€šå¸¸éœ€è¦å°†è¿™ä¸ªè¿‡ç¨‹æ”¾å…¥ä¸€ä¸ªå¾ªç¯ä¸­ï¼Œå¯¹æ•´ä¸ªè®­ç»ƒæ•°æ®é›†è¿›è¡Œå¤šæ¬¡è¿­ä»£ï¼Œç›´åˆ°æ¨¡å‹æ€§èƒ½æ»¡è¶³è¦æ±‚æˆ–è¾¾åˆ°é¢„è®¾çš„æœ€å¤§è¿­ä»£æ¬¡æ•°ã€‚åœ¨æ¯æ¬¡è¿­ä»£ä¸­ï¼Œè¿˜å¯ä»¥æ·»åŠ ä¸€äº›ä»£ç æ¥è®°å½•è®­ç»ƒè¿›åº¦ï¼Œå¦‚æ‰“å°å½“å‰çš„æŸå¤±å€¼ï¼Œæˆ–è€…åœ¨éªŒè¯æ•°æ®é›†ä¸Šè¯„ä¼°æ¨¡å‹çš„æ€§èƒ½ã€‚</p><p>å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªç®€å•çš„ç¥ç»ç½‘ç»œ</span></span><br><span class="line">model = nn.Sequential(</span><br><span class="line">    nn.Linear(<span class="number">10</span>, <span class="number">20</span>),</span><br><span class="line">    nn.ReLU(),</span><br><span class="line">    nn.Linear(<span class="number">20</span>, <span class="number">1</span>),</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># é€‰æ‹©æŸå¤±å‡½æ•°å’Œä¼˜åŒ–å™¨</span></span><br><span class="line">criterion = nn.MSELoss()</span><br><span class="line">optimizer = torch.optim.SGD(model.parameters(), lr=<span class="number">0.01</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¨¡æ‹Ÿè¾“å…¥å’Œç›®æ ‡æ•°æ®</span></span><br><span class="line">inputs = torch.randn(<span class="number">5</span>, <span class="number">10</span>)</span><br><span class="line">targets = torch.randn(<span class="number">5</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‰å‘ä¼ æ’­</span></span><br><span class="line">outputs = model(inputs)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¡ç®—æŸå¤±</span></span><br><span class="line">loss = criterion(outputs, targets)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åå‘ä¼ æ’­</span></span><br><span class="line">loss.backward()</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ›´æ–°å‚æ•°</span></span><br><span class="line">optimizer.step()</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¸…é›¶æ¢¯åº¦ï¼Œä¸ºä¸‹ä¸€æ¬¡è¿­ä»£åšå‡†å¤‡</span></span><br><span class="line">optimizer.zero_grad()</span><br></pre></td></tr></tbody></table></figure><p>ä»¥ä¸Šå°±æ˜¯åå‘ä¼ æ’­ç®—æ³•çš„åŸºæœ¬ä»‹ç»ï¼Œå…¶åœ¨æ·±åº¦å­¦ä¹ è®­ç»ƒä¸­æ‰®æ¼”ç€éå¸¸é‡è¦çš„è§’è‰²ï¼Œæ˜¯ç†è§£å’Œå®ç°ç¥ç»ç½‘ç»œçš„åŸºç¡€çŸ¥è¯†ã€‚</p><h3 id="Pythonæ‰‹å†™åå‘ä¼ æ’­"><a href="#Pythonæ‰‹å†™åå‘ä¼ æ’­" class="headerlink" title="Pythonæ‰‹å†™åå‘ä¼ æ’­"></a>Pythonæ‰‹å†™åå‘ä¼ æ’­</h3><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„åå‘ä¼ æ’­ç®—æ³•Pythonä»£ç ç¤ºä¾‹è¿›è¡Œè¯¦ç»†åˆ†æ­¥è§£é‡Šï¼š</p><ol><li><p><strong>è®¾å®šéšæœºæ•°ç§å­å’Œæ•°æ®</strong>ï¼š</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">np.random.seed(<span class="number">0</span>)</span><br><span class="line">X = np.array([[<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>],[<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>],[<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>],[<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>]])</span><br><span class="line">y = np.array([[<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>]]).T</span><br></pre></td></tr></tbody></table></figure><p>è¿™æ®µä»£ç é¦–å…ˆè®¾å®šäº†éšæœºæ•°ç§å­ï¼Œä»¥ç¡®ä¿æ¯æ¬¡è¿è¡Œç¨‹åºæ—¶ï¼Œåˆå§‹åŒ–çš„æƒé‡å€¼éƒ½æ˜¯ä¸€æ ·çš„ã€‚æ¥ç€ï¼Œæˆ‘ä»¬è®¾å®šäº†è¾“å…¥æ•°æ®<code>X</code>å’Œè¾“å‡ºæ•°æ®<code>y</code>ã€‚</p></li><li><p><strong>å®šä¹‰Sigmoidå‡½æ•°</strong>ï¼š</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">sigmoid</span>(<span class="params">x, deriv=<span class="literal">False</span></span>):</span><br><span class="line">    <span class="keyword">if</span> deriv:</span><br><span class="line">        <span class="keyword">return</span> x*(<span class="number">1</span>-x)</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>/(<span class="number">1</span>+np.exp(-x))</span><br></pre></td></tr></tbody></table></figure><p>è¿™é‡Œæˆ‘ä»¬å®šä¹‰äº†Sigmoidå‡½æ•°ï¼Œè¯¥å‡½æ•°ç”¨äºæ¿€æ´»ç¥ç»å…ƒçš„è¾“å‡ºã€‚åœ¨å‚æ•°<code>deriv</code>ä¸ºTrueæ—¶ï¼Œè¯¥å‡½æ•°è¿”å›Sigmoidå‡½æ•°çš„å¯¼æ•°ï¼Œè¿™å¯¹äºåå‘ä¼ æ’­è®¡ç®—æ¢¯åº¦éå¸¸é‡è¦ã€‚</p></li><li><p><strong>åˆå§‹åŒ–æƒé‡</strong>ï¼š</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">w0 = <span class="number">2</span>*np.random.random((<span class="number">3</span>,<span class="number">4</span>)) - <span class="number">1</span></span><br><span class="line">w1 = <span class="number">2</span>*np.random.random((<span class="number">4</span>,<span class="number">1</span>)) - <span class="number">1</span></span><br></pre></td></tr></tbody></table></figure><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬åˆå§‹åŒ–äº†æƒé‡<code>w0</code>å’Œ<code>w1</code>ã€‚æˆ‘ä»¬çš„ç½‘ç»œæœ‰ä¸¤å±‚ï¼Œæ‰€ä»¥éœ€è¦ä¸¤ç»„æƒé‡ã€‚è¿™äº›æƒé‡çš„åˆå§‹åŒ–å€¼æ˜¯åœ¨-1åˆ°1ä¹‹é—´éšæœºé€‰æ‹©çš„ã€‚</p></li><li><p><strong>è¿­ä»£è®­ç»ƒ</strong>ï¼š</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">60000</span>):</span><br></pre></td></tr></tbody></table></figure><p>è¿™æ˜¯æˆ‘ä»¬çš„è®­ç»ƒå¾ªç¯ï¼Œæˆ‘ä»¬è®­ç»ƒç½‘ç»œ60000æ¬¡ã€‚</p></li><li><p><strong>å‰å‘ä¼ æ’­</strong>ï¼š</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">l0 = X</span><br><span class="line">l1 = sigmoid(np.dot(l0, w0))</span><br><span class="line">l2 = sigmoid(np.dot(l1, w1))</span><br></pre></td></tr></tbody></table></figure><p>è¿™æ˜¯æˆ‘ä»¬çš„å‰å‘ä¼ æ’­æ­¥éª¤ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬çš„è¾“å…¥<code>l0</code>å°±æ˜¯æ•°æ®<code>X</code>ã€‚ç„¶åï¼Œæˆ‘ä»¬è®¡ç®—<code>l1</code>å±‚ï¼Œè¿™æ˜¯<code>l0</code>å’Œ<code>w0</code>çš„ç‚¹ç§¯é€šè¿‡Sigmoidå‡½æ•°çš„ç»“æœã€‚åŒæ ·ï¼Œæˆ‘ä»¬è®¡ç®—<code>l2</code>ï¼Œè¿™æ˜¯<code>l1</code>å’Œ<code>w1</code>çš„ç‚¹ç§¯é€šè¿‡Sigmoidå‡½æ•°çš„ç»“æœã€‚</p></li><li><p><strong>è®¡ç®—è¯¯å·®</strong>ï¼š</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">l2_loss = y - l2</span><br></pre></td></tr></tbody></table></figure><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬è®¡ç®—äº†ç½‘ç»œé¢„æµ‹çš„è¯¯å·®ï¼Œè¿™å°±æ˜¯å®é™…å€¼<code>y</code>å‡å»é¢„æµ‹å€¼<code>l2</code>ã€‚</p></li><li><p><strong>æ‰“å°è¯¯å·®</strong>ï¼š</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> j % <span class="number">10000</span> == <span class="number">0</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f'Loss: <span class="subst">{np.mean(np.<span class="built_in">abs</span>(l2_loss))}</span>'</span>)</span><br></pre></td></tr></tbody></table></figure><p>æ¯10000æ¬¡è¿­ä»£ï¼Œæˆ‘ä»¬è®¡ç®—å¹¶æ‰“å°ä¸€æ¬¡å¹³å‡è¯¯å·®ã€‚</p></li><li><p><strong>åå‘ä¼ æ’­</strong>ï¼š</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">l2_delta = l2_loss * sigmoid(l2, deriv=<span class="literal">True</span>)</span><br><span class="line">l1_loss = l2_delta.dot(w1.T)</span><br><span class="line">l1_delta = l1_loss * sigmoid(l1, deriv=<span class="literal">True</span>)</span><br></pre></td></tr></tbody></table></figure><p>è¿™æ˜¯åå‘ä¼ æ’­çš„æ­¥éª¤ã€‚æˆ‘ä»¬é¦–å…ˆè®¡ç®—<code>l2_delta</code>ï¼Œè¿™æ˜¯<code>l2_loss</code>å’Œ<code>l2</code>é€šè¿‡Sigmoidå¯¼æ•°å‡½æ•°çš„ç»“æœã€‚ç„¶åï¼Œæˆ‘ä»¬è®¡ç®—<code>l1_loss</code>ï¼Œè¿™æ˜¯<code>l2_delta</code>å’Œ<code>w1</code>çš„è½¬ç½®çš„ç‚¹ç§¯ã€‚æœ€åï¼Œæˆ‘ä»¬è®¡ç®—<code>l1_delta</code>ï¼Œè¿™æ˜¯<code>l1_loss</code>å’Œ<code>l1</code>é€šè¿‡Sigmoidå¯¼æ•°å‡½æ•°çš„ç»“æœã€‚</p></li><li><p><strong>æ›´æ–°æƒé‡</strong>ï¼š</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">w1 += l1.T.dot(l2_delta)</span><br><span class="line">w0 += l0.T.dot(l1_delta)</span><br></pre></td></tr></tbody></table></figure><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æ ¹æ®åå‘ä¼ æ’­çš„ç»“æœæ›´æ–°æƒé‡ã€‚<code>w1</code>å¢åŠ çš„æ˜¯<code>l1</code>çš„è½¬ç½®å’Œ<code>l2_delta</code>çš„ç‚¹ç§¯ï¼Œ<code>w0</code>å¢åŠ çš„æ˜¯<code>l0</code>çš„è½¬ç½®å’Œ<code>l1_delta</code>çš„ç‚¹ç§¯ã€‚</p></li></ol><p>è¿™å°±æ˜¯æ•´ä¸ªç½‘ç»œçš„è®­ç»ƒè¿‡ç¨‹ï¼ŒåŒ…æ‹¬å‰å‘ä¼ æ’­ã€è®¡ç®—è¯¯å·®ã€åå‘ä¼ æ’­å’Œæ›´æ–°æƒé‡ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> NLP Insights </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Deep Learning </tag>
            
            <tag> Gradient Descent </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexoåšå®¢æ·»åŠ å¯äº¤äº’å¼è¶³è¿¹åœ°å›¾</title>
      <link href="/2023/07/08/Tech%20Toolbox/GeoMapToBlog/"/>
      <url>/2023/07/08/Tech%20Toolbox/GeoMapToBlog/</url>
      
        <content type="html"><![CDATA[<h1 id="åœ¨Blogä¸­æ·»åŠ å¯äº¤äº’å¼è¶³è¿¹åœ°å›¾"><a href="#åœ¨Blogä¸­æ·»åŠ å¯äº¤äº’å¼è¶³è¿¹åœ°å›¾" class="headerlink" title="åœ¨Blogä¸­æ·»åŠ å¯äº¤äº’å¼è¶³è¿¹åœ°å›¾"></a>åœ¨Blogä¸­æ·»åŠ å¯äº¤äº’å¼è¶³è¿¹åœ°å›¾</h1><p>è¿™ç¯‡æ–‡ç« å°†å‘ä½ å±•ç¤ºå¦‚ä½•åœ¨åŸºäºHexoå’ŒNextçš„GitHub Pagesåšå®¢ä¸­åˆ›å»ºä¸€ä¸ªäº¤äº’å¼çš„ä¸–ç•Œåœ°å›¾é¡µé¢ï¼Œè¿™ä¸ªåœ°å›¾å°†å±•ç¤ºä½ æ›¾ç»è®¿é—®è¿‡çš„åŸå¸‚ï¼Œä½ å¯ä»¥æ ¹æ®ä½ å¯¹æ¯ä¸ªåŸå¸‚è®¿é—®çš„é¢‘ç‡åœ¨åœ°å›¾ä¸Šæ˜¾ç¤ºä¸åŒé¢œè‰²çš„æ ‡è®°ï¼Œä½ è¿˜å¯ä»¥ç‚¹å‡»è¿™äº›æ ‡è®°æ¥æ˜¾ç¤ºæ›´å¤šå…³äºè¿™ä¸ªåŸå¸‚çš„ä¿¡æ¯ã€‚</p><h2 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h2><p>ä½ éœ€è¦å®‰è£…ä»¥ä¸‹å·¥å…·ï¼š</p><ul><li>Node.js å’Œ NPM</li><li>Hexo</li></ul><p>ç¡®ä¿ä½ çš„åšå®¢å·²ç»è¢«éƒ¨ç½²åˆ°GitHub Pagesï¼Œå¹¶ä¸”ä½ åœ¨æœ¬åœ°çš„å¼€å‘ç¯å¢ƒå·²ç»æ­£ç¡®è®¾ç½®ã€‚</p><h2 id="æ­¥éª¤ä¸€ï¼šåˆ›å»ºæ–°é¡µé¢"><a href="#æ­¥éª¤ä¸€ï¼šåˆ›å»ºæ–°é¡µé¢" class="headerlink" title="æ­¥éª¤ä¸€ï¼šåˆ›å»ºæ–°é¡µé¢"></a>æ­¥éª¤ä¸€ï¼šåˆ›å»ºæ–°é¡µé¢</h2><p>åœ¨ä½ çš„Hexoé¡¹ç›®çš„æ ¹ç›®å½•ä¸‹ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo new page <span class="string">"travel"</span></span><br></pre></td></tr></tbody></table></figure><p>è¿™ä¸ªå‘½ä»¤å°†åœ¨<code>source</code>ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸ºâ€travelâ€çš„æ–‡ä»¶å¤¹ï¼Œå¹¶åœ¨è¯¥æ–‡ä»¶å¤¹ä¸‹åˆ›å»ºä¸€ä¸ª<code>index.md</code>æ–‡ä»¶ã€‚</p><h2 id="æ­¥éª¤äºŒï¼šå®‰è£…-Leaflet"><a href="#æ­¥éª¤äºŒï¼šå®‰è£…-Leaflet" class="headerlink" title="æ­¥éª¤äºŒï¼šå®‰è£… Leaflet"></a>æ­¥éª¤äºŒï¼šå®‰è£… Leaflet</h2><p>åœ¨ä½ çš„Hexoé¡¹ç›®çš„æ ¹ç›®å½•ä¸‹ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install leaflet</span><br></pre></td></tr></tbody></table></figure><p>ç„¶ååœ¨<code>index.md</code>æ–‡ä»¶çš„æœ€é¡¶éƒ¨å¼•å…¥Leafletçš„CSSå’ŒJSï¼š</p><figure class="highlight markdown"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line"><span class="section">title: Travel</span></span><br><span class="line"><span class="section">---</span></span><br><span class="line"></span><br><span class="line">&lt;!-- å¼•å…¥ Leaflet çš„ CSS --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"/node_modules/leaflet/dist/leaflet.css"</span> /&gt;</span></span></span><br><span class="line"></span><br><span class="line">&lt;!-- å¼•å…¥ Leaflet çš„ JavaScript æ–‡ä»¶ --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"/node_modules/leaflet/dist/leaflet.js"</span>&gt;</span></span><span class="language-xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></tbody></table></figure><h2 id="æ­¥éª¤ä¸‰ï¼šåˆ›å»ºåœ°å›¾å®¹å™¨"><a href="#æ­¥éª¤ä¸‰ï¼šåˆ›å»ºåœ°å›¾å®¹å™¨" class="headerlink" title="æ­¥éª¤ä¸‰ï¼šåˆ›å»ºåœ°å›¾å®¹å™¨"></a>æ­¥éª¤ä¸‰ï¼šåˆ›å»ºåœ°å›¾å®¹å™¨</h2><p>åœ¨<code>index.md</code>ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªç”¨æ¥æ‰¿è½½åœ°å›¾çš„<code>&lt;div&gt;</code>å…ƒç´ ï¼Œç„¶åé€šè¿‡CSSç»™å®ƒè®¾ç½®ä¸€ä¸ªæ˜ç¡®çš„é«˜åº¦ï¼š</p><figure class="highlight markdown"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span></span><br><span class="line"><span class="code">    #map {</span></span><br><span class="line"><span class="code">        height: 500px;</span></span><br><span class="line"><span class="code">        width: 100%;</span></span><br><span class="line"><span class="code">        position: relative;</span></span><br><span class="line"><span class="code">    }</span></span><br><span class="line"><span class="code">&lt;/style&gt;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="language-xml"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"map"</span>&gt;</span></span></span><span class="language-xml"><span class="language-css">&lt;/<span class="selector-tag">div</span>&gt;</span></span></span><br></pre></td></tr></tbody></table></figure><h2 id="æ­¥éª¤å››ï¼šåˆå§‹åŒ–åœ°å›¾"><a href="#æ­¥éª¤å››ï¼šåˆå§‹åŒ–åœ°å›¾" class="headerlink" title="æ­¥éª¤å››ï¼šåˆå§‹åŒ–åœ°å›¾"></a>æ­¥éª¤å››ï¼šåˆå§‹åŒ–åœ°å›¾</h2><p>ä½¿ç”¨Leafletçš„APIåˆå§‹åŒ–åœ°å›¾ï¼Œå¹¶å°†å…¶ä¸­å¿ƒè®¾ç½®ä¸ºç»åº¦0,çº¬åº¦0ï¼ˆå¤§è¥¿æ´‹ä¸­éƒ¨ï¼‰ï¼Œå¹¶è®¾ç½®åˆå§‹çš„ç¼©æ”¾çº§åˆ«ä¸º2ã€‚</p><figure class="highlight markdown"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="code">    document.addEventListener('DOMContentLoaded', function() {</span></span><br><span class="line"><span class="code">        var map = L.map('map').setView([0, 0], 2);</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {</span></span><br><span class="line"><span class="code">            maxZoom: 19,</span></span><br><span class="line"><span class="code">        }).addTo(map);</span></span><br><span class="line"><span class="code">    });</span></span><br><span class="line"><span class="code">&lt;/script&gt;</span></span><br></pre></td></tr></tbody></table></figure><h2 id="æ­¥éª¤äº”ï¼šæ·»åŠ åŸå¸‚æ•°æ®"><a href="#æ­¥éª¤äº”ï¼šæ·»åŠ åŸå¸‚æ•°æ®" class="headerlink" title="æ­¥éª¤äº”ï¼šæ·»åŠ åŸå¸‚æ•°æ®"></a>æ­¥éª¤äº”ï¼šæ·»åŠ åŸå¸‚æ•°æ®</h2><p>åˆ›å»ºä¸€ä¸ªGeoJSONæ–‡ä»¶æ¥å­˜å‚¨åŸå¸‚çš„æ•°æ®ï¼ŒåŒ…æ‹¬åŸå¸‚çš„åç§°ï¼Œç»çº¬åº¦ï¼Œä½ è®¿é—®çš„æ¬¡æ•°ï¼Œä»¥åŠä¸€ä¸ªå›¾ç‰‡çš„URLã€‚æ–‡ä»¶çš„æ ¼å¼åº”è¯¥å¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"type"</span><span class="punctuation">:</span> <span class="string">"FeatureCollection"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"features"</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">{</span></span><br><span class="line">            <span class="attr">"type"</span><span class="punctuation">:</span> <span class="string">"Feature"</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"properties"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">                <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"åŒ—äº¬"</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">"visits"</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">"image"</span><span class="punctuation">:</span> <span class="string">"https://your-image-url.com"</span></span><br><span class="line">            <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">"geometry"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">                <span class="attr">"type"</span><span class="punctuation">:</span> <span class="string">"Point"</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">"coordinates"</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="number">116.4074</span><span class="punctuation">,</span> <span class="number">39.9042</span><span class="punctuation">]</span></span><br><span class="line">            <span class="punctuation">}</span></span><br><span class="line">        <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">        ...</span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure><p>å°†æ­¤æ–‡ä»¶ä¿å­˜åœ¨ä½ çš„Hexoé¡¹ç›®çš„<code>source</code>ç›®å½•ä¸‹ï¼Œä¾‹å¦‚ï¼Œä½ å¯ä»¥å‘½åä¸º<code>cities.json</code>ã€‚</p><h2 id="æ­¥éª¤å…­ï¼šåŠ è½½æ•°æ®å¹¶æ˜¾ç¤ºåœ¨åœ°å›¾ä¸Š"><a href="#æ­¥éª¤å…­ï¼šåŠ è½½æ•°æ®å¹¶æ˜¾ç¤ºåœ¨åœ°å›¾ä¸Š" class="headerlink" title="æ­¥éª¤å…­ï¼šåŠ è½½æ•°æ®å¹¶æ˜¾ç¤ºåœ¨åœ°å›¾ä¸Š"></a>æ­¥éª¤å…­ï¼šåŠ è½½æ•°æ®å¹¶æ˜¾ç¤ºåœ¨åœ°å›¾ä¸Š</h2><p>åœ¨<code>index.md</code>æ–‡ä»¶ä¸­ï¼Œæ·»åŠ ä»¥ä¸‹ä»£ç æ¥åŠ è½½GeoJSONæ–‡ä»¶ï¼Œç„¶ååœ¨åœ°å›¾ä¸Šæ˜¾ç¤ºæ•°æ®ï¼š</p><figure class="highlight markdown"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="code">    document.addEventListener('DOMContentLoaded', function() {</span></span><br><span class="line"><span class="code">        var map = L.map('map').setView([0, 0], 2);</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {</span></span><br><span class="line"><span class="code">            maxZoom: 19,</span></span><br><span class="line"><span class="code">        }).addTo(map);</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">        fetch('/travel/cities.json')</span></span><br><span class="line"><span class="code">            .then(response =&gt; response.json())</span></span><br><span class="line"><span class="code">            .then(data =&gt; {</span></span><br><span class="line"><span class="code">                L.geoJSON(data, {</span></span><br><span class="line"><span class="code">                    pointToLayer: function (feature, latlng) {</span></span><br><span class="line"><span class="code">                        var color = getColor(feature.properties.visits);</span></span><br><span class="line"><span class="code">                        return L.circleMarker(latlng, { fillColor: color, fillOpacity: 0.5 });</span></span><br><span class="line"><span class="code">                    },</span></span><br><span class="line"><span class="code">                    onEachFeature: function (feature, layer) {</span></span><br><span class="line"><span class="code">                        layer.bindPopup(`&lt;h2&gt;${feature.properties.name}&lt;/h2&gt;&lt;img src="${feature.properties.image}" width="200"&gt;`);</span></span><br><span class="line"><span class="code">                    }</span></span><br><span class="line"><span class="code">                }).addTo(map);</span></span><br><span class="line"><span class="code">            });</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">        function getColor(visits) {</span></span><br><span class="line"><span class="code">            // æ ¹æ®ä½ è®¿é—®çš„æ¬¡æ•°è¿”å›ä¸åŒçš„é¢œè‰²</span></span><br><span class="line"><span class="code">            return visits &gt; 10 ? '#800026' :</span></span><br><span class="line"><span class="code">                   visits &gt; 5  ? '#BD0026' :</span></span><br><span class="line"><span class="code">                   visits &gt; 2  ? '#E31A1C' :</span></span><br><span class="line"><span class="code">                   visits &gt; 1  ? '#FC4E2A' :</span></span><br><span class="line"><span class="code">                                 '#FFEDA0';</span></span><br><span class="line"><span class="code">        }</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">        // å¼ºåˆ¶Leafleté‡æ–°è®¡ç®—åœ°å›¾çš„å°ºå¯¸</span></span><br><span class="line"><span class="code">        setTimeout(function() {</span></span><br><span class="line"><span class="code">            map.invalidateSize();</span></span><br><span class="line"><span class="code">        }, 100);</span></span><br><span class="line"><span class="code">    });</span></span><br><span class="line"><span class="code">&lt;/script&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>ä»¥ä¸Šçš„JavaScriptä»£ç åœ¨é¡µé¢åŠ è½½å®Œæˆåä¼šè¿è¡Œï¼Œé¦–å…ˆåˆå§‹åŒ–åœ°å›¾ï¼Œç„¶ååŠ è½½å¹¶è§£æGeoJSONæ–‡ä»¶ï¼Œå¯¹äºæ¯ä¸€ä¸ªåŸå¸‚ï¼Œåˆ›å»ºä¸€ä¸ªåœ†å½¢çš„æ ‡è®°ï¼Œé¢œè‰²æ ¹æ®è®¿é—®æ¬¡æ•°å†³å®šã€‚å½“ç‚¹å‡»æ ‡è®°æ—¶ï¼Œå¼¹å‡ºä¸€ä¸ªåŒ…å«åŸå¸‚åç§°å’Œå›¾ç‰‡çš„çª—å£ã€‚</p><p>è‡³æ­¤ï¼Œä½ çš„åšå®¢å°±æˆåŠŸåœ°æ·»åŠ äº†ä¸€ä¸ªäº¤äº’å¼çš„è¶³è¿¹åœ°å›¾é¡µé¢ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Tech Toolbox </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Blog </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SUP Experience</title>
      <link href="/2023/07/07/Life%20Reflections/SUP%E4%BD%93%E9%AA%8C.en/"/>
      <url>/2023/07/07/Life%20Reflections/SUP%E4%BD%93%E9%AA%8C.en/</url>
      
        <content type="html"><![CDATA[<h1 id="Stand-Up-Paddleboarding-SUP"><a href="#Stand-Up-Paddleboarding-SUP" class="headerlink" title="Stand-Up Paddleboarding (SUP)"></a>Stand-Up Paddleboarding (SUP)</h1><p>Stand-Up Paddleboarding (SUP) is a water activity that originated from modern surfing in Hawaii. Surfers stand on a floating board and use a single paddle to propel themselves forward in the water. This sport has rapidly gained popularity worldwide in recent years and has become a beloved water activity for many people.</p><h2 id="Experience-ğŸŒŠ"><a href="#Experience-ğŸŒŠ" class="headerlink" title="Experience ğŸŒŠ"></a>Experience ğŸŒŠ</h2><p>If you are interested in stand-up paddleboarding, consider taking a dedicated course to learn and experience this activity. I recently participated in a stand-up paddleboarding course located on the East Coast of Singapore, and here is my experience sharing.</p><p>The class lasted for two hours, and the coach provided a detailed introduction to the basic knowledge and skills of SUP. They explained how to stand on the board and maintain balance, how to use the paddle correctly to propel oneself forward in the water, and how to turn and control the direction of the board. Although I felt a bit unstable at first, I quickly adapted to this standing posture and was able to easily master the skill of using the paddle.</p>  <style type="text/css"><pre><code>.fancybox &#123;    display: inline-block;&#125;</code></pre><p></style><p></p><p>The curriculum arrangement is very reasonable and suitable for beginners. With the guidance of the instructor, I was able to quickly get the hang of it, and only fell into the water once ğŸ˜…, which made me feel a little embarrassed. However, SUP is a very fun and challenging activity, and falling into the water is also part of the learning process. I believe that with practice, I will become more skilled and stable.</p><p>The courses take place in the open waters of the East Coast, which means we can freely surf in the vast ocean. This open environment makes people feel very comfortable and free. However, we also need to pay attention to sun protection â˜€ï¸, as prolonged exposure to sunlight can damage the skin.</p><h2 id="Registration-Information-ğŸ“"><a href="#Registration-Information-ğŸ“" class="headerlink" title="Registration Information ğŸ“"></a>Registration Information ğŸ“</h2><p>If you are interested in the Stand-Up Paddleboarding (SUP) Starter Course, you can register at the following website: <a href="https://www.onepa.gov.sg/courses/sup-starter-course-open-water-c026977237">https://www.onepa.gov.sg/courses/sup-starter-course-open-water-c026977237</a>. This course is offered by PAssion WaVe @ East Coast, an organization in Singapore. The registration fee is SGD 61 ğŸ’°.</p><p>Before registration, you need to meet certain course requirements.</p><p>You need to have basic swimming skills ğŸŠâ€â™‚ï¸ and be able to swim at least 50 meters in the ocean while wearing a life jacket. This is to ensure your safety during water activities.</p><p>The course venue is located at PAssion WaVe @ East Coast in Singapore, specifically at the address 1390 ECP, Singapore 468961 ğŸ“. This location is perfect for stand-up paddleboarding as it offers an open sea area and suitable conditions.</p><p>Vertical single-blade surfing is an exciting and exhilarating water activity that is a great choice for both surfing enthusiasts and beginners. By taking part in a course, you will be able to learn the correct techniques and safety knowledge, and enjoy the thrill of surfing while creating wonderful memories in the ocean. If you are interested in this activity, why not consider signing up for a course and start your journey of vertical single-blade surfing! ğŸ„â€â™‚ï¸ğŸŒŠ</p>]]></content>
      
      
      <categories>
          
          <category> Life Reflections </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Guide to Living on Singapore Island </tag>
            
            <tag> Sports </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SUPä½“éªŒ</title>
      <link href="/2023/07/07/Life%20Reflections/SUP%E4%BD%93%E9%AA%8C.zh-CN/"/>
      <url>/2023/07/07/Life%20Reflections/SUP%E4%BD%93%E9%AA%8C.zh-CN/</url>
      
        <content type="html"><![CDATA[<h1 id="ç«‹å¼å•æ¡¨å†²æµª-SUP"><a href="#ç«‹å¼å•æ¡¨å†²æµª-SUP" class="headerlink" title="ç«‹å¼å•æ¡¨å†²æµª (SUP)"></a>ç«‹å¼å•æ¡¨å†²æµª (SUP)</h1><p>ç«‹å¼å•æ¡¨å†²æµª (Stand-Up Paddleboarding, ç®€ç§°SUP) æ˜¯ä¸€é¡¹èµ·æºäºå¤å¨å¤·ç°ä»£å†²æµªè¿åŠ¨çš„æ°´ä¸Šæ´»åŠ¨ã€‚å†²æµªè€…ç«™åœ¨æ¼‚æµ®åœ¨æ°´é¢ä¸Šçš„æœ¨æ¿ä¸Šï¼Œé€šè¿‡ä½¿ç”¨å•æ¡¨æ¥æ¨åŠ¨è‡ªå·±åœ¨æ°´ä¸­å‰è¿›ã€‚è¿™é¡¹è¿åŠ¨è¿‘å¹´æ¥åœ¨ä¸–ç•Œå„åœ°è¿…é€Ÿæµè¡Œèµ·æ¥ï¼Œæˆä¸ºè®¸å¤šäººå–œçˆ±çš„æ°´ä¸Šæ´»åŠ¨ä¹‹ä¸€ã€‚</p><h2 id="ä½“éªŒ-ğŸŒŠ"><a href="#ä½“éªŒ-ğŸŒŠ" class="headerlink" title="ä½“éªŒ ğŸŒŠ"></a>ä½“éªŒ ğŸŒŠ</h2><p>å¦‚æœä½ å¯¹ç«‹å¼å•æ¡¨å†²æµªæ„Ÿå…´è¶£ï¼Œä¸å¦¨è€ƒè™‘å‚åŠ ä¸€ä¸ªä¸“é—¨çš„è¯¾ç¨‹æ¥äº†è§£å’Œä½“éªŒè¿™é¡¹æ´»åŠ¨ã€‚æˆ‘æœ€è¿‘å‚åŠ äº†ä¸€ä¸ªä½äºæ–°åŠ å¡ä¸œæµ·å²¸çš„ç«‹å¼å•æ¡¨å†²æµªè¯¾ç¨‹ï¼Œä»¥ä¸‹æ˜¯æˆ‘çš„ä½“éªŒåˆ†äº«ã€‚</p><p>è¯¾ç¨‹æŒç»­äº†ä¸¤ä¸ªå°æ—¶ï¼Œæ•™ç»ƒéå¸¸è¯¦ç»†åœ°ä»‹ç»äº†SUPçš„åŸºæœ¬çŸ¥è¯†å’ŒæŠ€å·§ã€‚ä»–ä»¬è§£é‡Šäº†å¦‚ä½•ç«™åœ¨æ¿ä¸Šä¿æŒå¹³è¡¡ï¼Œæ­£ç¡®ä½¿ç”¨æ¡¨æ¥æ¨åŠ¨è‡ªå·±åœ¨æ°´ä¸­å‰è¿›ï¼Œä»¥åŠå¦‚ä½•è½¬å‘å’Œæ§åˆ¶æ¿çš„æ–¹å‘ã€‚è™½ç„¶ä¸€å¼€å§‹æˆ‘æ„Ÿåˆ°æœ‰äº›ä¸ç¨³å®šï¼Œä½†å¾ˆå¿«å°±é€‚åº”äº†è¿™ç§ç«™ç«‹çš„å§¿åŠ¿ï¼Œå¹¶ä¸”èƒ½å¤Ÿè½»æ¾åœ°æŒæ¡æ¡¨çš„ä½¿ç”¨æŠ€å·§ã€‚</p><style type="text/css">    .fancybox {        display: inline-block;    }</style><p>è¯¾ç¨‹çš„å®‰æ’éå¸¸åˆç†ï¼Œé€‚åˆåˆå­¦è€…ã€‚åœ¨æ•™ç»ƒçš„æŒ‡å¯¼ä¸‹ï¼Œæˆ‘èƒ½å¤Ÿå¾ˆå¿«ä¸Šæ‰‹ï¼Œå¹¶ä¸”åªæ‰è¿›æµ·é‡Œä¸€æ¬¡ ğŸ˜…ï¼Œè¿™è®©æˆ‘æ„Ÿåˆ°æœ‰äº›å°´å°¬ã€‚ä¸è¿‡ï¼ŒSUPæ˜¯ä¸€é¡¹éå¸¸æœ‰è¶£å’ŒæŒ‘æˆ˜æ€§çš„æ´»åŠ¨ï¼Œæ‰è¿›æ°´é‡Œä¹Ÿæ˜¯å­¦ä¹ è¿‡ç¨‹ä¸­çš„ä¸€éƒ¨åˆ†ã€‚æˆ‘ç›¸ä¿¡éšç€ç»ƒä¹ çš„ç§¯ç´¯ï¼Œæˆ‘èƒ½å¤Ÿå˜å¾—æ›´åŠ ç†Ÿç»ƒå’Œç¨³å®šã€‚</p><p>è¯¾ç¨‹åœ¨ä¸œæµ·å²¸çš„å¼€æ”¾æµ·åŸŸè¿›è¡Œï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥åœ¨å¹¿é˜”çš„æµ·æ´‹ä¸­è‡ªç”±å†²æµªã€‚è¿™ç§å¼€æ”¾çš„ç¯å¢ƒè®©äººæ„Ÿåˆ°éå¸¸èˆ’é€‚å’Œè‡ªç”±ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦æ³¨æ„é˜²æ™’ â˜€ï¸ï¼Œå› ä¸ºé•¿æ—¶é—´æš´éœ²åœ¨é˜³å…‰ä¸‹å¯èƒ½ä¼šå¯¹çš®è‚¤é€ æˆä¼¤å®³ã€‚</p><h2 id="æŠ¥åä¿¡æ¯-ğŸ“"><a href="#æŠ¥åä¿¡æ¯-ğŸ“" class="headerlink" title="æŠ¥åä¿¡æ¯ ğŸ“"></a>æŠ¥åä¿¡æ¯ ğŸ“</h2><p>å¦‚æœä½ å¯¹ç«‹å¼å•æ¡¨å†²æµªè¯¾ç¨‹æ„Ÿå…´è¶£ï¼Œä½ å¯ä»¥åœ¨ä»¥ä¸‹ç½‘å€æŠ¥åï¼š<a href="https://www.onepa.gov.sg/courses/sup-starter-course-open-water-c026977237">https://www.onepa.gov.sg/courses/sup-starter-course-open-water-c026977237</a>ã€‚è¿™æ˜¯æ–°åŠ å¡ä¸€å®¶åä¸ºPAssion WaVe @ East Coastçš„æœºæ„æä¾›çš„è¯¾ç¨‹ã€‚æŠ¥åè´¹ç”¨ä¸º61æ–°å¸ ğŸ’°ã€‚</p><p>åœ¨æŠ¥åä¹‹å‰ï¼Œéœ€è¦æ»¡è¶³ä¸€äº›è¯¾ç¨‹è¦æ±‚</p><p>ã€‚ä½ éœ€è¦å…·å¤‡åŸºæœ¬çš„æ¸¸æ³³èƒ½åŠ› ğŸŠâ€â™‚ï¸ï¼Œå¹¶ä¸”å¯ä»¥åœ¨ç©¿ç€æ•‘ç”Ÿè¡£çš„æƒ…å†µä¸‹åœ¨æµ·é‡Œæ¸¸æ³³è‡³å°‘50ç±³ã€‚è¿™æ˜¯ä¸ºäº†ç¡®ä¿ä½ åœ¨æ°´ä¸Šæ´»åŠ¨ä¸­çš„å®‰å…¨ã€‚</p><p>è¯¾ç¨‹åœ°ç‚¹ä½äºæ–°åŠ å¡ä¸œæµ·å²¸çš„PAssion WaVe @ East Coastï¼Œå…·ä½“åœ°å€æ˜¯1390 ECP, Singapore 468961 ğŸ“ã€‚è¿™ä¸ªåœ°ç‚¹éå¸¸é€‚åˆè¿›è¡Œç«‹å¼å•æ¡¨å†²æµªï¼Œå› ä¸ºå®ƒæä¾›äº†å¼€æ”¾çš„æµ·åŸŸå’Œé€‚å®œçš„æ¡ä»¶ã€‚</p><p>ç«‹å¼å•æ¡¨å†²æµªæ˜¯ä¸€é¡¹ä»¤äººå…´å¥‹å’Œåˆºæ¿€çš„æ°´ä¸Šæ´»åŠ¨ï¼Œæ— è®ºæ˜¯å¯¹äºå†²æµªçˆ±å¥½è€…è¿˜æ˜¯åˆå­¦è€…æ¥è¯´ï¼Œéƒ½æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚é€šè¿‡å‚åŠ è¯¾ç¨‹ï¼Œä½ å°†èƒ½å¤Ÿå­¦ä¹ åˆ°æ­£ç¡®çš„æŠ€å·§å’Œå®‰å…¨çŸ¥è¯†ï¼Œäº«å—å†²æµªçš„ä¹è¶£ï¼Œå¹¶åœ¨æµ·æ´‹ä¸­ç•™ä¸‹ç¾å¥½çš„å›å¿†ã€‚å¦‚æœä½ å¯¹è¿™é¡¹æ´»åŠ¨æ„Ÿå…´è¶£ï¼Œä¸å¦¨è€ƒè™‘æŠ¥åå‚åŠ ä¸€ä¸ªè¯¾ç¨‹ï¼Œå¼€å§‹ä½ çš„ç«‹å¼å•æ¡¨å†²æµªä¹‹æ—…å§ï¼ğŸ„â€â™‚ï¸ğŸŒŠ</p>]]></content>
      
      
      <categories>
          
          <category> Life Reflections </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Sports </tag>
            
            <tag> å¡å²›ç”Ÿæ´»æŒ‡åŒ— </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SUPä½“éªŒ</title>
      <link href="/2023/07/07/Life%20Reflections/SUP%E4%BD%93%E9%AA%8C/"/>
      <url>/2023/07/07/Life%20Reflections/SUP%E4%BD%93%E9%AA%8C/</url>
      
        <content type="html"><![CDATA[<h1 id="ç«‹å¼å•æ¡¨å†²æµª-SUP"><a href="#ç«‹å¼å•æ¡¨å†²æµª-SUP" class="headerlink" title="ç«‹å¼å•æ¡¨å†²æµª (SUP)"></a>ç«‹å¼å•æ¡¨å†²æµª (SUP)</h1><p>ç«‹å¼å•æ¡¨å†²æµª (Stand-Up Paddleboarding, ç®€ç§°SUP) æ˜¯ä¸€é¡¹èµ·æºäºå¤å¨å¤·ç°ä»£å†²æµªè¿åŠ¨çš„æ°´ä¸Šæ´»åŠ¨ã€‚å†²æµªè€…ç«™åœ¨æ¼‚æµ®åœ¨æ°´é¢ä¸Šçš„æœ¨æ¿ä¸Šï¼Œé€šè¿‡ä½¿ç”¨å•æ¡¨æ¥æ¨åŠ¨è‡ªå·±åœ¨æ°´ä¸­å‰è¿›ã€‚è¿™é¡¹è¿åŠ¨è¿‘å¹´æ¥åœ¨ä¸–ç•Œå„åœ°è¿…é€Ÿæµè¡Œèµ·æ¥ï¼Œæˆä¸ºè®¸å¤šäººå–œçˆ±çš„æ°´ä¸Šæ´»åŠ¨ä¹‹ä¸€ã€‚</p><h2 id="ä½“éªŒ-ğŸŒŠ"><a href="#ä½“éªŒ-ğŸŒŠ" class="headerlink" title="ä½“éªŒ ğŸŒŠ"></a>ä½“éªŒ ğŸŒŠ</h2><p>å¦‚æœä½ å¯¹ç«‹å¼å•æ¡¨å†²æµªæ„Ÿå…´è¶£ï¼Œä¸å¦¨è€ƒè™‘å‚åŠ ä¸€ä¸ªä¸“é—¨çš„è¯¾ç¨‹æ¥äº†è§£å’Œä½“éªŒè¿™é¡¹æ´»åŠ¨ã€‚æˆ‘æœ€è¿‘å‚åŠ äº†ä¸€ä¸ªä½äºæ–°åŠ å¡ä¸œæµ·å²¸çš„ç«‹å¼å•æ¡¨å†²æµªè¯¾ç¨‹ï¼Œä»¥ä¸‹æ˜¯æˆ‘çš„ä½“éªŒåˆ†äº«ã€‚</p><p>è¯¾ç¨‹æŒç»­äº†ä¸¤ä¸ªå°æ—¶ï¼Œæ•™ç»ƒéå¸¸è¯¦ç»†åœ°ä»‹ç»äº†SUPçš„åŸºæœ¬çŸ¥è¯†å’ŒæŠ€å·§ã€‚ä»–ä»¬è§£é‡Šäº†å¦‚ä½•ç«™åœ¨æ¿ä¸Šä¿æŒå¹³è¡¡ï¼Œæ­£ç¡®ä½¿ç”¨æ¡¨æ¥æ¨åŠ¨è‡ªå·±åœ¨æ°´ä¸­å‰è¿›ï¼Œä»¥åŠå¦‚ä½•è½¬å‘å’Œæ§åˆ¶æ¿çš„æ–¹å‘ã€‚è™½ç„¶ä¸€å¼€å§‹æˆ‘æ„Ÿåˆ°æœ‰äº›ä¸ç¨³å®šï¼Œä½†å¾ˆå¿«å°±é€‚åº”äº†è¿™ç§ç«™ç«‹çš„å§¿åŠ¿ï¼Œå¹¶ä¸”èƒ½å¤Ÿè½»æ¾åœ°æŒæ¡æ¡¨çš„ä½¿ç”¨æŠ€å·§ã€‚</p><style type="text/css">    .fancybox {        display: inline-block;    }</style><img src="/2023/07/07/Life%20Reflections/SUP%E4%BD%93%E9%AA%8C/Me.jpg" class=""><img src="/2023/07/07/Life%20Reflections/SUP%E4%BD%93%E9%AA%8C/certification.jpg" class=""><p>è¯¾ç¨‹çš„å®‰æ’éå¸¸åˆç†ï¼Œé€‚åˆåˆå­¦è€…ã€‚åœ¨æ•™ç»ƒçš„æŒ‡å¯¼ä¸‹ï¼Œæˆ‘èƒ½å¤Ÿå¾ˆå¿«ä¸Šæ‰‹ï¼Œå¹¶ä¸”åªæ‰è¿›æµ·é‡Œä¸€æ¬¡ ğŸ˜…ï¼Œè¿™è®©æˆ‘æ„Ÿåˆ°æœ‰äº›å°´å°¬ã€‚ä¸è¿‡ï¼ŒSUPæ˜¯ä¸€é¡¹éå¸¸æœ‰è¶£å’ŒæŒ‘æˆ˜æ€§çš„æ´»åŠ¨ï¼Œæ‰è¿›æ°´é‡Œä¹Ÿæ˜¯å­¦ä¹ è¿‡ç¨‹ä¸­çš„ä¸€éƒ¨åˆ†ã€‚æˆ‘ç›¸ä¿¡éšç€ç»ƒä¹ çš„ç§¯ç´¯ï¼Œæˆ‘èƒ½å¤Ÿå˜å¾—æ›´åŠ ç†Ÿç»ƒå’Œç¨³å®šã€‚</p><p>è¯¾ç¨‹åœ¨ä¸œæµ·å²¸çš„å¼€æ”¾æµ·åŸŸè¿›è¡Œï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥åœ¨å¹¿é˜”çš„æµ·æ´‹ä¸­è‡ªç”±å†²æµªã€‚è¿™ç§å¼€æ”¾çš„ç¯å¢ƒè®©äººæ„Ÿåˆ°éå¸¸èˆ’é€‚å’Œè‡ªç”±ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦æ³¨æ„é˜²æ™’ â˜€ï¸ï¼Œå› ä¸ºé•¿æ—¶é—´æš´éœ²åœ¨é˜³å…‰ä¸‹å¯èƒ½ä¼šå¯¹çš®è‚¤é€ æˆä¼¤å®³ã€‚</p><h2 id="æŠ¥åä¿¡æ¯-ğŸ“"><a href="#æŠ¥åä¿¡æ¯-ğŸ“" class="headerlink" title="æŠ¥åä¿¡æ¯ ğŸ“"></a>æŠ¥åä¿¡æ¯ ğŸ“</h2><p>å¦‚æœä½ å¯¹ç«‹å¼å•æ¡¨å†²æµªè¯¾ç¨‹æ„Ÿå…´è¶£ï¼Œä½ å¯ä»¥åœ¨ä»¥ä¸‹ç½‘å€æŠ¥åï¼š<a href="https://www.onepa.gov.sg/courses/sup-starter-course-open-water-c026977237">https://www.onepa.gov.sg/courses/sup-starter-course-open-water-c026977237</a>ã€‚è¿™æ˜¯æ–°åŠ å¡ä¸€å®¶åä¸ºPAssion WaVe @ East Coastçš„æœºæ„æä¾›çš„è¯¾ç¨‹ã€‚æŠ¥åè´¹ç”¨ä¸º61æ–°å¸ ğŸ’°ã€‚</p><p>åœ¨æŠ¥åä¹‹å‰ï¼Œéœ€è¦æ»¡è¶³ä¸€äº›è¯¾ç¨‹è¦æ±‚</p><p>ã€‚ä½ éœ€è¦å…·å¤‡åŸºæœ¬çš„æ¸¸æ³³èƒ½åŠ› ğŸŠâ€â™‚ï¸ï¼Œå¹¶ä¸”å¯ä»¥åœ¨ç©¿ç€æ•‘ç”Ÿè¡£çš„æƒ…å†µä¸‹åœ¨æµ·é‡Œæ¸¸æ³³è‡³å°‘50ç±³ã€‚è¿™æ˜¯ä¸ºäº†ç¡®ä¿ä½ åœ¨æ°´ä¸Šæ´»åŠ¨ä¸­çš„å®‰å…¨ã€‚</p><p>è¯¾ç¨‹åœ°ç‚¹ä½äºæ–°åŠ å¡ä¸œæµ·å²¸çš„PAssion WaVe @ East Coastï¼Œå…·ä½“åœ°å€æ˜¯1390 ECP, Singapore 468961 ğŸ“ã€‚è¿™ä¸ªåœ°ç‚¹éå¸¸é€‚åˆè¿›è¡Œç«‹å¼å•æ¡¨å†²æµªï¼Œå› ä¸ºå®ƒæä¾›äº†å¼€æ”¾çš„æµ·åŸŸå’Œé€‚å®œçš„æ¡ä»¶ã€‚</p><p>ç«‹å¼å•æ¡¨å†²æµªæ˜¯ä¸€é¡¹ä»¤äººå…´å¥‹å’Œåˆºæ¿€çš„æ°´ä¸Šæ´»åŠ¨ï¼Œæ— è®ºæ˜¯å¯¹äºå†²æµªçˆ±å¥½è€…è¿˜æ˜¯åˆå­¦è€…æ¥è¯´ï¼Œéƒ½æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚é€šè¿‡å‚åŠ è¯¾ç¨‹ï¼Œä½ å°†èƒ½å¤Ÿå­¦ä¹ åˆ°æ­£ç¡®çš„æŠ€å·§å’Œå®‰å…¨çŸ¥è¯†ï¼Œäº«å—å†²æµªçš„ä¹è¶£ï¼Œå¹¶åœ¨æµ·æ´‹ä¸­ç•™ä¸‹ç¾å¥½çš„å›å¿†ã€‚å¦‚æœä½ å¯¹è¿™é¡¹æ´»åŠ¨æ„Ÿå…´è¶£ï¼Œä¸å¦¨è€ƒè™‘æŠ¥åå‚åŠ ä¸€ä¸ªè¯¾ç¨‹ï¼Œå¼€å§‹ä½ çš„ç«‹å¼å•æ¡¨å†²æµªä¹‹æ—…å§ï¼ğŸ„â€â™‚ï¸ğŸŒŠ</p>]]></content>
      
      
      <categories>
          
          <category> Life Reflections </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Sports </tag>
            
            <tag> å¡å²›ç”Ÿæ´»æŒ‡åŒ— </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DSSM æ¨¡å‹è¯¦è§£</title>
      <link href="/2023/07/07/NLP%20Insights/DSSM%20%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3/"/>
      <url>/2023/07/07/NLP%20Insights/DSSM%20%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<h1 id="DSSM-Deep-Structured-Semantic-Models-æ¨¡å‹è¯¦è§£"><a href="#DSSM-Deep-Structured-Semantic-Models-æ¨¡å‹è¯¦è§£" class="headerlink" title="DSSM (Deep Structured Semantic Models) æ¨¡å‹è¯¦è§£"></a>DSSM (Deep Structured Semantic Models) æ¨¡å‹è¯¦è§£</h1><h2 id="ä¸€ã€æ¨¡å‹ç®€ä»‹"><a href="#ä¸€ã€æ¨¡å‹ç®€ä»‹" class="headerlink" title="ä¸€ã€æ¨¡å‹ç®€ä»‹"></a>ä¸€ã€æ¨¡å‹ç®€ä»‹</h2><p>DSSMï¼ˆDeep Structured Semantic Modelsï¼‰æ˜¯å¾®è½¯æå‡ºçš„ä¸€ä¸ªæ·±åº¦å­¦ä¹ æ¨¡å‹ï¼Œç”¨äºå­¦ä¹ æ–‡æœ¬çš„è¯­ä¹‰è¡¨è¾¾ã€‚DSSMé¦–æ¬¡åœ¨ä¿¡æ¯æ£€ç´¢é¢†åŸŸä¸­è¢«æå‡ºï¼Œç”¨äºå¤„ç†æŸ¥è¯¢-æ–‡æ¡£åŒ¹é…ä»»åŠ¡ï¼Œä½†å¾ˆå¿«è¢«åº”ç”¨åˆ°äº†å„ç§å…¶ä»–åœºæ™¯ï¼Œå¦‚å¹¿å‘Šç‚¹å‡»ç‡é¢„æµ‹ï¼Œæ¨èç³»ç»Ÿç­‰ã€‚</p><h2 id="äºŒã€æ¨¡å‹ç»“æ„"><a href="#äºŒã€æ¨¡å‹ç»“æ„" class="headerlink" title="äºŒã€æ¨¡å‹ç»“æ„"></a>äºŒã€æ¨¡å‹ç»“æ„</h2><p>DSSMæ¨¡å‹ä¸»è¦ç”±ä¸‰ä¸ªéƒ¨åˆ†æ„æˆï¼š</p><ol><li><strong>è¾“å…¥å±‚</strong>ï¼šåœ¨è¿™ä¸€å±‚ï¼Œå°†è¾“å…¥çš„æ–‡æœ¬ï¼ˆæŸ¥è¯¢æˆ–è€…æ–‡æ¡£ï¼‰è½¬åŒ–ä¸ºè¯å‘é‡ã€‚</li><li><strong>æ·±åº¦ç¥ç»ç½‘ç»œ</strong>ï¼šè¾“å…¥å±‚ä¹‹åæ˜¯ä¸€ç³»åˆ—å…¨è¿æ¥å±‚ï¼Œå®ƒä»¬å­¦ä¹ è¾“å…¥çš„è¯­ä¹‰è¡¨ç¤ºã€‚</li><li><strong>è¾“å‡ºå±‚</strong>ï¼šæœ€åï¼Œè¾“å‡ºå±‚å°†æ·±åº¦ç¥ç»ç½‘ç»œçš„è¾“å‡ºè½¬åŒ–ä¸ºæ¦‚ç‡åˆ†å¸ƒï¼Œç”¨äºè¡¨ç¤ºæŸ¥è¯¢ä¸æ–‡æ¡£ä¹‹é—´çš„è¯­ä¹‰åŒ¹é…åº¦ã€‚</li></ol><h2 id="ä¸‰ã€åœ¨æ¨èç³»ç»Ÿä¸­çš„åº”ç”¨"><a href="#ä¸‰ã€åœ¨æ¨èç³»ç»Ÿä¸­çš„åº”ç”¨" class="headerlink" title="ä¸‰ã€åœ¨æ¨èç³»ç»Ÿä¸­çš„åº”ç”¨"></a>ä¸‰ã€åœ¨æ¨èç³»ç»Ÿä¸­çš„åº”ç”¨</h2><p>DSSMå¯åº”ç”¨åœ¨æ¨èç³»ç»Ÿä¸­ï¼Œå®ƒå¯ä»¥å­¦ä¹ ç”¨æˆ·çš„è¡Œä¸ºç‰¹å¾ä¸ç‰©å“ç‰¹å¾çš„è¯­ä¹‰åŒ¹é…åº¦ï¼Œç”¨äºè¯„ä¼°ç”¨æˆ·å¯¹ç‰©å“çš„å…´è¶£ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œé€šå¸¸å°†ç”¨æˆ·è¡Œä¸ºåºåˆ—ä½œä¸ºæŸ¥è¯¢ï¼Œå°†å€™é€‰ç‰©å“çš„ç‰¹å¾ä½œä¸ºæ–‡æ¡£ï¼Œé€šè¿‡DSSMå­¦ä¹ ç”¨æˆ·çš„å®æ—¶å…´è¶£ï¼Œå¹¶å°†å…´è¶£ä¸ç‰©å“çš„åŒ¹é…åº¦ç”¨äºæ’åºã€‚</p><h2 id="å››ã€æ¨¡å‹å®ç°"><a href="#å››ã€æ¨¡å‹å®ç°" class="headerlink" title="å››ã€æ¨¡å‹å®ç°"></a>å››ã€æ¨¡å‹å®ç°</h2><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨PyTorchå®ç°çš„DSSMæ¨¡å‹çš„ç¤ºä¾‹ï¼š</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DSSM</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, vocab_size, hidden_size</span>):</span><br><span class="line">        <span class="built_in">super</span>(DSSM, self).__init__()</span><br><span class="line">        self.vocab_size = vocab_size</span><br><span class="line">        self.hidden_size = hidden_size</span><br><span class="line">        self.linear1 = nn.Linear(vocab_size, hidden_size)</span><br><span class="line">        self.linear2 = nn.Linear(hidden_size, hidden_size)</span><br><span class="line">        self.linear3 = nn.Linear(hidden_size, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, query, doc</span>):</span><br><span class="line">        query = self.linear1(query)</span><br><span class="line">        query = torch.relu(query)</span><br><span class="line">        query = self.linear2(query)</span><br><span class="line">        query = torch.relu(query)</span><br><span class="line"></span><br><span class="line">        doc = self.linear1(doc)</span><br><span class="line">        doc = torch.relu(doc)</span><br><span class="line">        doc = self.linear2(doc)</span><br><span class="line">        doc = torch.relu(doc)</span><br><span class="line"></span><br><span class="line">        out = self.linear3(query * doc)</span><br><span class="line">        out = torch.sigmoid(out)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> out</span><br></pre></td></tr></tbody></table></figure><h2 id="äº”ã€è®­ç»ƒè¿‡ç¨‹"><a href="#äº”ã€è®­ç»ƒè¿‡ç¨‹" class="headerlink" title="äº”ã€è®­ç»ƒè¿‡ç¨‹"></a>äº”ã€è®­ç»ƒè¿‡ç¨‹</h2><p>åœ¨è®­ç»ƒDSSMæ¨¡å‹æ—¶ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šé‡‡ç”¨pairwiseçš„è®­ç»ƒæ–¹å¼ï¼Œä¹Ÿå°±æ˜¯åˆ©ç”¨æ­£æ ·æœ¬ï¼ˆæ­£åŒ¹é…å¯¹ï¼‰å’Œè´Ÿæ ·æœ¬ï¼ˆè´ŸåŒ¹é…å¯¹ï¼‰è¿›è¡Œè®­ç»ƒã€‚åœ¨ä¿¡æ¯æ£€ç´¢ä»»åŠ¡ä¸­ï¼Œä¸€ä¸ªæ­£æ ·æœ¬å¯èƒ½æ˜¯ä¸€ä¸ªæŸ¥è¯¢å’Œä¸€ä¸ªç›¸å…³çš„æ–‡æ¡£ï¼Œè´Ÿæ ·æœ¬å¯èƒ½æ˜¯åŒä¸€ä¸ªæŸ¥è¯¢å’Œä¸€ä¸ªä¸ç›¸å…³çš„æ–‡æ¡£ã€‚</p><p>å¯¹äºæ¯ä¸ªè®­ç»ƒæ ·æœ¬ï¼Œéƒ½å°†ç»è¿‡DSSMæ¨¡å‹ï¼Œå¾—åˆ°æŸ¥è¯¢å’Œæ–‡æ¡£çš„å‘é‡è¡¨ç¤ºï¼Œç„¶åè®¡ç®—ä¸¤è€…çš„ä½™å¼¦ç›¸ä¼¼åº¦ä½œä¸ºé¢„æµ‹çš„åŒ¹é…åˆ†æ•°ã€‚æ¥ä¸‹æ¥ï¼Œä½¿ç”¨ä¸€ä¸ªåˆé€‚çš„æŸå¤±å‡½æ•°ï¼Œä¾‹å¦‚äº¤å‰ç†µæŸå¤±ï¼Œæ¥ä¼˜åŒ–æ¨¡å‹å‚æ•°ã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨PyTorchè®­ç»ƒDSSMæ¨¡å‹çš„ç¤ºä¾‹ï¼š</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.optim <span class="keyword">as</span> optim</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆå§‹åŒ–æ¨¡å‹</span></span><br><span class="line">model = DSSM(vocab_size=<span class="number">10000</span>, hidden_size=<span class="number">128</span>)</span><br><span class="line"><span class="comment"># ä½¿ç”¨Adamä¼˜åŒ–å™¨</span></span><br><span class="line">optimizer = optim.Adam(model.parameters(), lr=<span class="number">0.001</span>)</span><br><span class="line"><span class="comment"># ä½¿ç”¨äºŒå…ƒäº¤å‰ç†µä½œä¸ºæŸå¤±å‡½æ•°</span></span><br><span class="line">criterion = torch.nn.BCELoss()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(num_epochs):</span><br><span class="line">    <span class="keyword">for</span> i, data <span class="keyword">in</span> <span class="built_in">enumerate</span>(train_loader, <span class="number">0</span>):</span><br><span class="line">        query, doc, label = data</span><br><span class="line">        <span class="comment"># æ¸…é›¶æ¢¯åº¦</span></span><br><span class="line">        optimizer.zero_grad()</span><br><span class="line">        <span class="comment"># å‰å‘ä¼ æ’­</span></span><br><span class="line">        output = model(query, doc)</span><br><span class="line">        <span class="comment"># è®¡ç®—æŸå¤±</span></span><br><span class="line">        loss = criterion(output, label)</span><br><span class="line">        <span class="comment"># åå‘ä¼ æ’­</span></span><br><span class="line">        loss.backward()</span><br><span class="line">        <span class="comment"># æ›´æ–°æƒé‡</span></span><br><span class="line">        optimizer.step()</span><br></pre></td></tr></tbody></table></figure><p>ä»¥ä¸Šä»£ç ä¸­ï¼Œé¦–å…ˆåˆå§‹åŒ–äº†ä¸€ä¸ªDSSMæ¨¡å‹ï¼Œå¹¶å®šä¹‰äº†ä¸€ä¸ªä¼˜åŒ–å™¨å’ŒæŸå¤±å‡½æ•°ã€‚åœ¨æ¯ä¸ªè®­ç»ƒæ­¥éª¤ä¸­ï¼Œæˆ‘ä»¬å¯¹æ•°æ®è¿›è¡Œå‰å‘ä¼ æ’­ï¼Œè®¡ç®—æŸå¤±ï¼Œç„¶åè¿›è¡Œåå‘ä¼ æ’­å’Œä¼˜åŒ–ã€‚</p><p>åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œå¯ä»¥åœ¨éªŒè¯é›†ä¸Šè¯„ä¼°æ¨¡å‹çš„æ•ˆæœï¼Œå¹¶æ ¹æ®éœ€è¦è°ƒæ•´å­¦ä¹ ç‡å’Œå…¶ä»–è®­ç»ƒå‚æ•°ã€‚è®­ç»ƒç»“æŸåï¼Œé€šå¸¸ä¼šåœ¨æµ‹è¯•é›†ä¸Šå¯¹æ¨¡å‹è¿›è¡Œæœ€åçš„è¯„ä¼°ï¼Œä»¥ç¡®ä¿æ¨¡å‹èƒ½å¤Ÿå¾ˆå¥½åœ°æ³›åŒ–åˆ°æœªè§è¿‡çš„æ•°æ®ã€‚</p><p>è®­ç»ƒDSSMæ¨¡å‹çš„ä¸»è¦æŒ‘æˆ˜æ˜¯é€‰æ‹©åˆé€‚çš„æ­£æ ·æœ¬å’Œè´Ÿæ ·æœ¬ï¼Œä»¥åŠè®¾ç½®åˆç†çš„è®­ç»ƒå‚æ•°ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨ä¸€äº›ç­–ç•¥æ¥å¹³è¡¡æ­£è´Ÿæ ·æœ¬çš„æ¯”ä¾‹ï¼Œæˆ–è€…ä½¿ç”¨æ›´å¤æ‚çš„æŸå¤±å‡½æ•°æ¥å¤„ç†ä¸å‡è¡¡çš„æ•°æ®ã€‚</p><h2 id="å…­ã€çº¿ä¸Šæ¨ç†æ–¹æ³•"><a href="#å…­ã€çº¿ä¸Šæ¨ç†æ–¹æ³•" class="headerlink" title="å…­ã€çº¿ä¸Šæ¨ç†æ–¹æ³•"></a>å…­ã€çº¿ä¸Šæ¨ç†æ–¹æ³•</h2><p>DSSMæ¨¡å‹åœ¨çº¿ä¸Šæ¨ç†ä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ä¸ªæ­¥éª¤ï¼š</p><ol><li><strong>å‘é‡åŒ–</strong>ï¼šåœ¨æ¨¡å‹è®­ç»ƒå®Œæ¯•åï¼Œå¯ä»¥å…ˆå¯¹æ‰€æœ‰çš„ç‰©å“è¿›è¡Œå‘é‡åŒ–å¤„ç†ï¼Œä¿å­˜ä¸ºç‰©å“çš„å‘é‡è¡¨ç¤ºã€‚å½“æ–°çš„ç”¨æˆ·è¯·æ±‚åˆ°æ¥æ—¶ï¼Œå°†ç”¨æˆ·çš„è¡Œä¸ºåºåˆ—è½¬åŒ–ä¸ºå‘é‡è¡¨ç¤ºã€‚</li><li><strong>è®¡ç®—ç›¸ä¼¼åº¦</strong>ï¼šç„¶åï¼Œè®¡ç®—ç”¨æˆ·å‘é‡ä¸å„ä¸ªç‰©å“å‘é‡çš„ç›¸ä¼¼åº¦ï¼Œä¸€èˆ¬ä½¿ç”¨ä½™å¼¦ç›¸ä¼¼åº¦ä½œä¸ºè®¡ç®—æ–¹æ³•ã€‚ç›¸ä¼¼åº¦è¶Šé«˜ï¼Œè¡¨ç¤ºç”¨æˆ·å¯¹ç‰©å“çš„å…´è¶£è¶Šå¤§ã€‚</li></ol><p>å…·ä½“å®æ–½æ—¶ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸ºäº†æé«˜åœ¨çº¿æ¨ç†çš„æ•ˆç‡ï¼Œé€šå¸¸ä¼šé‡‡ç”¨ä¸€äº›è¿‘ä¼¼æœ€è¿‘é‚»æœç´¢çš„æŠ€æœ¯ï¼ˆå¦‚Faissç­‰ï¼‰æ¥å¿«é€Ÿæ‰¾åˆ°ä¸ç”¨æˆ·æœ€ç›¸ä¼¼çš„ç‰©å“ï¼Œè€Œä¸æ˜¯éå†æ‰€æœ‰çš„ç‰©å“ã€‚</p><p>æ€»çš„æ¥è¯´ï¼ŒDSSMæ˜¯ä¸€ä¸ªéå¸¸æœ‰æ•ˆçš„æ·±åº¦å­¦ä¹ æ¨¡å‹ï¼Œç”¨äºå­¦ä¹ æ–‡æœ¬æˆ–å…¶ä»–ç±»å‹æ•°æ®çš„è¯­ä¹‰è¡¨ç¤ºï¼Œå¹¿æ³›åº”ç”¨äºä¿¡æ¯æ£€ç´¢ã€æ¨èç³»ç»Ÿç­‰å¤šç§åœºæ™¯ä¸­ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> NLP Insights </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DSSM </tag>
            
            <tag> Recommendation </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ¨èç³»ç»Ÿç¦»çº¿è¯„ä¼°æŒ‡æ ‡è¯¦è§£</title>
      <link href="/2023/07/07/NLP%20Insights/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E7%A6%BB%E7%BA%BF%E8%AF%84%E4%BC%B0%E6%8C%87%E6%A0%87%E8%AF%A6%E8%A7%A3/"/>
      <url>/2023/07/07/NLP%20Insights/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E7%A6%BB%E7%BA%BF%E8%AF%84%E4%BC%B0%E6%8C%87%E6%A0%87%E8%AF%A6%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<h1 id="æ¨èç³»ç»Ÿç¦»çº¿è¯„ä¼°æŒ‡æ ‡è¯¦è§£"><a href="#æ¨èç³»ç»Ÿç¦»çº¿è¯„ä¼°æŒ‡æ ‡è¯¦è§£" class="headerlink" title="æ¨èç³»ç»Ÿç¦»çº¿è¯„ä¼°æŒ‡æ ‡è¯¦è§£"></a>æ¨èç³»ç»Ÿç¦»çº¿è¯„ä¼°æŒ‡æ ‡è¯¦è§£</h1><p>æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»æ¨èç³»ç»Ÿä¸­å¸¸ç”¨çš„ç¦»çº¿è¯„ä¼°æŒ‡æ ‡ï¼ŒåŒ…æ‹¬ç²¾ç¡®ç‡ï¼ˆPrecisionï¼‰ã€å¬å›ç‡ï¼ˆRecallï¼‰ã€å‡†ç¡®ç‡ï¼ˆAccuracyï¼‰ã€F1-Scoreã€NDCGã€å‘½ä¸­ç‡ï¼ˆHit Rateï¼‰ã€AUCã€GAUCå’Œå¯¹æ•°æŸå¤±ï¼ˆLog Lossï¼‰ã€‚è¿™äº›æŒ‡æ ‡å¯¹äºè¯„ä¼°æ¨èç³»ç»Ÿçš„æ€§èƒ½å’Œæ•ˆæœè‡³å…³é‡è¦ã€‚è¿™äº›æŒ‡æ ‡å¯¹äºè¯„ä¼°æ¨èç³»ç»Ÿçš„æ€§èƒ½å’Œæ•ˆæœè‡³å…³é‡è¦ã€‚</p><p>åœ¨æ¨èç³»ç»Ÿä¸­ï¼Œç²¾ç¡®ç‡è¡¡é‡äº†æ¨èåˆ—è¡¨ä¸­çœŸæ­£ç¬¦åˆç”¨æˆ·å…´è¶£çš„ç‰©å“æ¯”ä¾‹ï¼Œå¬å›ç‡è¡¡é‡äº†æ‰€æœ‰ç¬¦åˆç”¨æˆ·å…´è¶£çš„ç‰©å“ä¸­è¢«æˆåŠŸæ¨èå‡ºçš„æ¯”ä¾‹ã€‚å‡†ç¡®ç‡ç”¨äºè¡¡é‡æ¨¡å‹é¢„æµ‹ç»“æœä¸å®é™…ç»“æœä¸€è‡´çš„æ¯”ä¾‹ã€‚F1-Scoreç»¼åˆè€ƒè™‘äº†ç²¾ç¡®ç‡å’Œå¬å›ç‡ï¼Œå¯¹æ¨¡å‹è¿›è¡Œç»¼åˆè¯„ä»·ã€‚NDCGåˆ™ç”¨äºè¯„ä»·æ¨èç³»ç»Ÿæ’åºè´¨é‡ï¼Œç‰¹åˆ«é€‚ç”¨äºè€ƒè™‘å…ƒç´ ç›¸å…³æ€§æ’åºçš„æ¨èç³»ç»Ÿã€‚</p><p>æˆ‘ä»¬å°†ä¸ºæ¯ä¸ªæŒ‡æ ‡æä¾›è¯¦ç»†çš„è§£é‡Šå’Œè®¡ç®—å…¬å¼ï¼Œå¹¶ç»™å‡ºPythonå®ç°çš„ç¤ºä¾‹ä»£ç ã€‚è¿™äº›æŒ‡æ ‡çš„é€‚ç”¨æ€§å°†æ ¹æ®æ¨èç³»ç»Ÿçš„éœ€æ±‚è¿›è¡Œè¯„ä¼°ï¼Œä»¥å¸®åŠ©æ‚¨é€‰æ‹©é€‚åˆè‡ªå·±ç³»ç»Ÿè¯„ä¼°çš„æŒ‡æ ‡ã€‚</p><p>é€šè¿‡æ·±å…¥äº†è§£è¿™äº›ç¦»çº¿è¯„ä¼°æŒ‡æ ‡ï¼Œæ‚¨å°†èƒ½å¤Ÿæ›´å¥½åœ°è¯„ä¼°å’Œæ”¹è¿›æ‚¨çš„æ¨èç³»ç»Ÿï¼Œæä¾›æ›´å‡†ç¡®å’Œä¸ªæ€§åŒ–çš„æ¨èæœåŠ¡ã€‚</p><h2 id="1-ç²¾ç¡®ç‡-Precision"><a href="#1-ç²¾ç¡®ç‡-Precision" class="headerlink" title="1. ç²¾ç¡®ç‡ (Precision)"></a>1. ç²¾ç¡®ç‡ (Precision)</h2><h3 id="åŠŸèƒ½"><a href="#åŠŸèƒ½" class="headerlink" title="åŠŸèƒ½"></a>åŠŸèƒ½</h3><p>ç²¾ç¡®ç‡ç”¨äºåº¦é‡åˆ†ç±»æ¨¡å‹çš„å‡†ç¡®ç¨‹åº¦ï¼Œå³æ¨¡å‹é¢„æµ‹ä¸ºæ­£ç±»åˆ«çš„æ ·æœ¬ä¸­å®é™…ä¸ºæ­£ç±»åˆ«çš„æ¯”ä¾‹ã€‚åœ¨æ¨èç³»ç»Ÿä¸­ï¼Œç²¾ç¡®ç‡å¯ä»¥ç†è§£ä¸ºåœ¨ç”¨æˆ·æ¥æ”¶çš„æ¨èç‰©å“ä¸­ï¼ŒçœŸæ­£ç¬¦åˆç”¨æˆ·å…´è¶£çš„ç‰©å“æ¯”ä¾‹ã€‚</p><h3 id="è®¡ç®—å…¬å¼"><a href="#è®¡ç®—å…¬å¼" class="headerlink" title="è®¡ç®—å…¬å¼"></a>è®¡ç®—å…¬å¼</h3><p>åœ¨äºŒåˆ†ç±»é—®é¢˜ä¸­ï¼Œç²¾ç¡®ç‡çš„è®¡ç®—å…¬å¼ä¸ºï¼š</p><p>$$ Precision = \frac{TP}{TP+FP} $$</p><p>å…¶ä¸­ï¼ŒTPè¡¨ç¤ºçœŸæ­£ä¾‹ï¼ˆTrue Positivesï¼‰ï¼ŒFPè¡¨ç¤ºå‡æ­£ä¾‹ï¼ˆFalse Positivesï¼‰ã€‚</p><h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><p>å‡è®¾ä¸€ä¸ªæ¨èç³»ç»Ÿæ¨èå‡ºäº†10ä¸ªå•†å“ï¼Œå…¶ä¸­5ä¸ªå•†å“æ˜¯ç”¨æˆ·çœŸæ­£æ„Ÿå…´è¶£çš„ã€‚é‚£ä¹ˆç²¾ç¡®ç‡ä¸ºï¼š5 / 10 = 0.5ã€‚</p><h3 id="Python-å®ç°"><a href="#Python-å®ç°" class="headerlink" title="Python å®ç°"></a>Python å®ç°</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> precision_score</span><br><span class="line"></span><br><span class="line"><span class="comment"># y_true è¡¨ç¤ºçœŸå®æ ‡ç­¾ï¼Œy_pred è¡¨ç¤ºé¢„æµ‹æ ‡ç­¾</span></span><br><span class="line">y_true = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>]</span><br><span class="line">y_pred = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">precision = precision_score(y_true, y_pred)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f'Precision: <span class="subst">{precision}</span>'</span>)</span><br></pre></td></tr></tbody></table></figure><h3 id="é€‚ç”¨æ€§"><a href="#é€‚ç”¨æ€§" class="headerlink" title="é€‚ç”¨æ€§"></a>é€‚ç”¨æ€§</h3><p>â­ï¸â­ï¸â­ï¸â­ï¸â­ï¸</p><p>ç²¾ç¡®ç‡éå¸¸é€‚ç”¨äºæ¨èç³»ç»Ÿçš„è¯„ä¼°ã€‚æ¨èç³»ç»Ÿçš„ä¸»è¦ç›®æ ‡å°±æ˜¯å‡†ç¡®åœ°æ¨èç”¨æˆ·å¯èƒ½æ„Ÿå…´è¶£çš„å•†å“æˆ–æœåŠ¡ã€‚å¦‚æœæ¨èçš„å•†å“ä¸­å¤§éƒ¨åˆ†éƒ½æ˜¯ç”¨æˆ·æ„Ÿå…´è¶£çš„ï¼Œé‚£ä¹ˆç²¾ç¡®ç‡å°±é«˜ã€‚</p><hr><h2 id="2-å¬å›ç‡-Recall"><a href="#2-å¬å›ç‡-Recall" class="headerlink" title="2. å¬å›ç‡ (Recall)"></a>2. å¬å›ç‡ (Recall)</h2><h3 id="åŠŸèƒ½-1"><a href="#åŠŸèƒ½-1" class="headerlink" title="åŠŸèƒ½"></a>åŠŸèƒ½</h3><p>å¬å›ç‡ç”¨äºåº¦é‡åˆ†ç±»æ¨¡å‹è¦†ç›–æ­£ç±»æ ·æœ¬çš„èƒ½åŠ›ï¼Œå³åœ¨æ‰€æœ‰å®é™…ä¸ºæ­£ç±»åˆ«çš„æ ·æœ¬ä¸­ï¼Œæ¨¡å‹é¢„æµ‹ä¸ºæ­£ç±»åˆ«çš„æ¯”ä¾‹ã€‚åœ¨æ¨èç³»ç»Ÿä¸­ï¼Œå¬å›ç‡å¯ä»¥ç†è§£ä¸ºæ‰€æœ‰ç¬¦åˆç”¨æˆ·å…´è¶£çš„ç‰©å“ä¸­ï¼Œè¢«æ¨¡å‹æˆåŠŸæ¨èå‡ºçš„ç‰©å“æ¯”ä¾‹ã€‚</p><h3 id="è®¡ç®—å…¬å¼-1"><a href="#è®¡ç®—å…¬å¼-1" class="headerlink" title="è®¡ç®—å…¬å¼"></a>è®¡ç®—å…¬å¼</h3><p>åœ¨äºŒåˆ†ç±»é—®é¢˜ä¸­ï¼Œå¬å›ç‡çš„è®¡ç®—å…¬å¼ä¸ºï¼š</p><p>$$ Recall = \frac{TP}{TP+FN} $$</p><p>å…¶ä¸­ï¼ŒTPè¡¨ç¤ºçœŸæ­£ä¾‹ï¼ˆTrue Positivesï¼‰ï¼ŒFNè¡¨ç¤ºå‡åä¾‹ï¼ˆFalse Negativesï¼‰ã€‚</p><h3 id="ç¤ºä¾‹-1"><a href="#ç¤ºä¾‹-1" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><p>å‡è®¾ä¸€ä¸ªç”¨æˆ·çœŸæ­£æ„Ÿå…´è¶£çš„å•†å“æœ‰20ä¸ªï¼Œæ¨èç³»ç»ŸæˆåŠŸæ¨èå‡ºäº†10ä¸ªã€‚é‚£ä¹ˆå¬å›ç‡ä¸ºï¼š10 / 20 = 0.5ã€‚</p><h3 id="Python-å®ç°-1"><a href="#Python-å®ç°-1" class="headerlink" title="Python å®ç°"></a>Python å®ç°</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> recall_score</span><br><span class="line"></span><br><span class="line"><span class="comment"># y_true è¡¨ç¤ºçœŸå®æ ‡ç­¾ï¼Œy_pred è¡¨ç¤ºé¢„æµ‹æ ‡ç­¾</span></span><br><span class="line">y_true = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>]</span><br><span class="line">y_pred = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">recall = recall_score(y_true, y_pred)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f'Recall: <span class="subst">{recall}</span>'</span>)</span><br></pre></td></tr></tbody></table></figure><h3 id="é€‚ç”¨æ€§-1"><a href="#é€‚ç”¨æ€§-1" class="headerlink" title="é€‚ç”¨æ€§"></a>é€‚ç”¨æ€§</h3><p>â­ï¸â­ï¸â­ï¸â­ï¸â­ï¸</p><p>å¬å›ç‡ä¹Ÿéå¸¸é€‚ç”¨äºæ¨èç³»ç»Ÿçš„è¯„ä¼°ã€‚æ¨èç³»ç»Ÿçš„ç›®æ ‡ä¹‹ä¸€æ˜¯è¦†ç›–å°½å¯èƒ½å¤šçš„ç”¨æˆ·æ„Ÿå…´è¶£çš„å•†å“æˆ–æœåŠ¡ã€‚å¦‚æœèƒ½å°†ç”¨æˆ·æ„Ÿå…´è¶£çš„å•†å“å¤§éƒ¨åˆ†éƒ½æ¨èå‡ºæ¥ï¼Œé‚£ä¹ˆå¬å›ç‡å°±é«˜ã€‚</p><hr><h2 id="3-å‡†ç¡®ç‡-Accuracy"><a href="#3-å‡†ç¡®ç‡-Accuracy" class="headerlink" title="3. å‡†ç¡®ç‡ (Accuracy)"></a>3. å‡†ç¡®ç‡ (Accuracy)</h2><h3 id="åŠŸèƒ½-2"><a href="#åŠŸèƒ½-2" class="headerlink" title="åŠŸèƒ½"></a>åŠŸèƒ½</h3><p>å‡†ç¡®ç‡ç”¨äºåº¦é‡åˆ†ç±»æ¨¡å‹çš„é¢„æµ‹ç»“æœä¸å®é™…ç»“æœä¸€è‡´çš„æ¯”ä¾‹ï¼Œå³åœ¨æ‰€æœ‰æ ·æœ¬ä¸­ï¼Œæ¨¡å‹é¢„æµ‹æ­£ç¡®çš„æ¯”ä¾‹ã€‚</p><h3 id="è®¡ç®—å…¬å¼-2"><a href="#è®¡ç®—å…¬å¼-2" class="headerlink" title="è®¡ç®—å…¬å¼"></a>è®¡ç®—å…¬å¼</h3><p>åœ¨äºŒåˆ†ç±»é—®é¢˜ä¸­ï¼Œå‡†ç¡®ç‡çš„è®¡ç®—å…¬å¼ä¸ºï¼š</p><p>$$ Accuracy = \frac{TP+TN}{TP+FP+TN+FN} $$</p><p>å…¶ä¸­ï¼ŒTPè¡¨ç¤ºçœŸæ­£ä¾‹ï¼ˆTrue Positivesï¼‰ï¼ŒTNè¡¨ç¤ºçœŸåä¾‹ï¼ˆTrue Negativesï¼‰ï¼ŒFPè¡¨ç¤ºå‡æ­£ä¾‹ï¼ˆFalse Positivesï¼‰ï¼ŒFNè¡¨ç¤ºå‡åä¾‹ï¼ˆFalse Negativesï¼‰ã€‚</p><h3 id="ç¤ºä¾‹-2"><a href="#ç¤ºä¾‹-2" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><p>å‡è®¾ä¸€ä¸ªæ¨èç³»ç»Ÿå¯¹100ä¸ªå•†å“åšå‡ºäº†é¢„æµ‹ï¼Œå…¶ä¸­70ä¸ªé¢„æµ‹æ­£ç¡®ï¼Œé‚£ä¹ˆå‡†ç¡®ç‡ä¸ºï¼š70 / 100 = 0.7ã€‚</p><h3 id="Python-å®ç°-2"><a href="#Python-å®ç°-2" class="headerlink" title="Python å®ç°"></a>Python å®ç°</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> accuracy_score</span><br><span class="line"></span><br><span class="line"><span class="comment"># y_true è¡¨ç¤ºçœŸå®æ ‡ç­¾ï¼Œy_pred è¡¨ç¤ºé¢„æµ‹æ ‡ç­¾</span></span><br><span class="line">y_true = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>]</span><br><span class="line">y_pred = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">accuracy = accuracy_score(y_true, y_pred)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f'Accuracy: <span class="subst">{accuracy}</span>'</span>)</span><br></pre></td></tr></tbody></table></figure><h3 id="é€‚ç”¨æ€§-2"><a href="#é€‚ç”¨æ€§-2" class="headerlink" title="é€‚ç”¨æ€§"></a>é€‚ç”¨æ€§</h3><p>â­ï¸â­ï¸â­ï¸</p><p>å‡†ç¡®ç‡åœ¨æ¨èç³»ç»Ÿä¸­çš„é€‚ç”¨æ€§è¾ƒä½ï¼Œå› ä¸ºæ¨èç³»ç»Ÿå¾€å¾€é¢ä¸´ç€ä¸å¹³è¡¡çš„æ ‡ç­¾é—®é¢˜ã€‚æ¯”å¦‚ï¼Œåœ¨ä¸€ä¸ªå•†å“æ¨èç³»ç»Ÿä¸­ï¼Œç”¨æˆ·å¯èƒ½å¯¹å¤§éƒ¨åˆ†å•†å“éƒ½æ²¡æœ‰å…´è¶£ï¼Œè¿™æ ·å‡†ç¡®ç‡å°±ä¸èƒ½å¾ˆå¥½åœ°åæ˜ å‡ºæ¨¡å‹çš„æ€§èƒ½ã€‚</p><hr><h2 id="4-F1-Score"><a href="#4-F1-Score" class="headerlink" title="4. F1-Score"></a>4. F1-Score</h2><h3 id="åŠŸèƒ½-3"><a href="#åŠŸèƒ½-3" class="headerlink" title="åŠŸèƒ½"></a>åŠŸèƒ½</h3><p>F1-Score æ˜¯ç²¾ç¡®ç‡å’Œå¬å›ç‡çš„è°ƒå’Œå¹³å‡å€¼ï¼Œç”¨äºåŒæ—¶è€ƒè™‘ç²¾ç¡®ç‡å’Œå¬å›ç‡ï¼Œå¯¹æ¨¡å‹è¿›è¡Œç»¼åˆè¯„ä»·ã€‚</p><h3 id="è®¡ç®—å…¬å¼-3"><a href="#è®¡ç®—å…¬å¼-3" class="headerlink" title="è®¡ç®—å…¬å¼"></a>è®¡ç®—å…¬å¼</h3><p>F1-Score çš„è®¡ç®—å…¬å¼ä¸ºï¼š</p><p>$$ F1-Score = 2 \times \frac{Precision \times Recall}{Precision + Recall} $$</p><h3 id="ç¤ºä¾‹-3"><a href="#ç¤ºä¾‹-3" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><p>å‡è®¾ä¸€ä¸ªæ¨èç³»ç»Ÿçš„ç²¾ç¡®ç‡ä¸º0.5ï¼Œå¬å›ç‡ä¸º0.7ï¼Œé‚£ä¹ˆ F1-Score ä¸ºï¼š2 * (0.5 * 0.7) / (0.5 + 0.7) = 0.583ã€‚</p><h3 id="Python-å®ç°-3"><a href="#Python-å®ç°-3" class="headerlink" title="Python å®ç°"></a>Python å®ç°</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> f1_score</span><br><span class="line"></span><br><span class="line"><span class="comment"># y_true è¡¨ç¤ºçœŸå®æ ‡ç­¾ï¼Œy_pred è¡¨ç¤ºé¢„æµ‹æ ‡ç­¾</span></span><br><span class="line">y_true = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>]</span><br><span class="line">y_pred = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">f1 = f1_score(y_true, y_pred)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f'F1-Score: <span class="subst">{f1}</span>'</span>)</span><br></pre></td></tr></tbody></table></figure><h3 id=""><a href="#" class="headerlink" title=""></a></h3><p>é€‚ç”¨æ€§</p><p>â­ï¸â­ï¸â­ï¸â­ï¸â­ï¸</p><p>F1-Score éå¸¸é€‚ç”¨äºæ¨èç³»ç»Ÿçš„è¯„ä¼°ã€‚æ¨èç³»ç»Ÿéœ€è¦å¹³è¡¡ç²¾ç¡®ç‡å’Œå¬å›ç‡ï¼Œç²¾ç¡®ç‡é«˜è¯´æ˜æ¨èçš„å‡†ç¡®ï¼Œå¬å›ç‡é«˜è¯´æ˜æ¨èçš„å…¨é¢ï¼Œè€Œ F1-Score æ­£æ˜¯ä¸€ä¸ªå…¼é¡¾ä¸¤è€…çš„è¯„ä»·æŒ‡æ ‡ã€‚</p><hr><h2 id="5-NDCG-Normalized-Discounted-Cumulative-Gain"><a href="#5-NDCG-Normalized-Discounted-Cumulative-Gain" class="headerlink" title="5. NDCG (Normalized Discounted Cumulative Gain)"></a>5. NDCG (Normalized Discounted Cumulative Gain)</h2><h3 id="åŠŸèƒ½-4"><a href="#åŠŸèƒ½-4" class="headerlink" title="åŠŸèƒ½"></a>åŠŸèƒ½</h3><p>NDCG æ˜¯ä¸€ä¸ªç”¨äºè¯„ä»·æ¨èç³»ç»Ÿæ’åºè´¨é‡çš„æŒ‡æ ‡ï¼Œç‰¹åˆ«æ˜¯å¯¹äºé‚£äº›è€ƒè™‘å…ƒç´ ç›¸å…³æ€§æ’åºçš„æ¨èç³»ç»Ÿã€‚å®ƒå¯ä»¥è¡¡é‡æ¨¡å‹é¢„æµ‹çš„æ’åºåˆ—è¡¨ä¸çœŸå®çš„æ’åºåˆ—è¡¨çš„ç›¸ä¼¼ç¨‹åº¦ã€‚</p><h3 id="è®¡ç®—å…¬å¼-4"><a href="#è®¡ç®—å…¬å¼-4" class="headerlink" title="è®¡ç®—å…¬å¼"></a>è®¡ç®—å…¬å¼</h3><p>NDCG çš„è®¡ç®—å…¬å¼ä¸ºï¼š</p><p>$$ NDCG = \frac{DCG}{IDCG} $$</p><p>å…¶ä¸­ï¼ŒDCG è¡¨ç¤ºæ¨èåˆ—è¡¨çš„ Discounted Cumulative Gainï¼Œè®¡ç®—å…¬å¼ä¸ºï¼š</p><p>$$ DCG = \sum_{i=1}^{N} \frac{2^{rel_i} - 1}{log_2(i + 1)} $$</p><p>IDCG è¡¨ç¤ºç†æƒ³æƒ…å†µä¸‹çš„æœ€å¤§ DCGï¼Œå³æ‰€æœ‰ç›¸å…³æ€§å•†å“éƒ½æ’åœ¨å‰é¢ï¼Œè®¡ç®—å…¬å¼ä¸ DCG ç›¸åŒï¼Œåªæ˜¯å•†å“çš„æ’åºæŒ‰ç…§ç›¸å…³æ€§ä»å¤§åˆ°å°ã€‚</p><h3 id="ç¤ºä¾‹-4"><a href="#ç¤ºä¾‹-4" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><p>å‡è®¾ä¸€ä¸ªæ¨èç³»ç»Ÿå¯¹5ä¸ªå•†å“çš„ç›¸å…³æ€§é¢„æµ‹ä¸º [3, 2, 3, 0, 1]ï¼Œé‚£ä¹ˆ DCG = (2^3 - 1)/log2(1+1) + (2^2 - 1)/log2(2+1) + (2^3 - 1)/log2(3+1) + (2^0 - 1)/log2(4+1) + (2^1 - 1)/log2(5+1)ã€‚å¦‚æœç†æƒ³çš„æ’åºä¸º [3, 3, 2, 1, 0]ï¼Œé‚£ä¹ˆ IDCG å¯ä»¥æŒ‰ç…§ç›¸åŒçš„æ–¹å¼è®¡ç®—ï¼ŒNDCG = DCG / IDCGã€‚</p><h3 id="Python-å®ç°-4"><a href="#Python-å®ç°-4" class="headerlink" title="Python å®ç°"></a>Python å®ç°</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> ndcg_score</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># y_true è¡¨ç¤ºçœŸå®çš„ç›¸å…³æ€§ï¼Œy_score è¡¨ç¤ºé¢„æµ‹çš„ç›¸å…³æ€§</span></span><br><span class="line">y_true = np.array([[<span class="number">3</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">1</span>]])</span><br><span class="line">y_score = np.array([[<span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">3</span>]])</span><br><span class="line"></span><br><span class="line">ndcg = ndcg_score(y_true, y_score)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f'NDCG: <span class="subst">{ndcg}</span>'</span>)</span><br></pre></td></tr></tbody></table></figure><h3 id="é€‚ç”¨æ€§-3"><a href="#é€‚ç”¨æ€§-3" class="headerlink" title="é€‚ç”¨æ€§"></a>é€‚ç”¨æ€§</h3><p>â­ï¸â­ï¸â­ï¸â­ï¸â­ï¸</p><p>NDCG éå¸¸é€‚ç”¨äºæ¨èç³»ç»Ÿçš„è¯„ä¼°ï¼Œç‰¹åˆ«æ˜¯å¯¹äºéœ€è¦è€ƒè™‘æ¨èæ’åºçš„ç³»ç»Ÿã€‚NDCG èƒ½å¤Ÿè¡¡é‡æ¨èç³»ç»Ÿé¢„æµ‹çš„æ’åºåˆ—è¡¨ä¸çœŸå®çš„æ’åºåˆ—è¡¨çš„ç›¸ä¼¼ç¨‹åº¦ï¼Œä»è€Œè¯„ä»·æ¨¡å‹çš„æ€§èƒ½ã€‚</p><hr><p>ä»¥ä¸‹å‡ ä¸ªæŒ‡æ ‡ï¼ˆHit Rate, AUC, GAUC, LogLossï¼‰ç”±äºç¯‡å¹…é™åˆ¶ï¼Œæˆ‘å°†åœ¨ä¸‹ä¸€æ¬¡</p><p>å›å¤ä¸­ç»§ç»­ä»‹ç»ã€‚</p><h2 id="6-å‘½ä¸­ç‡-Hit-Rate"><a href="#6-å‘½ä¸­ç‡-Hit-Rate" class="headerlink" title="6. å‘½ä¸­ç‡ (Hit Rate)"></a>6. å‘½ä¸­ç‡ (Hit Rate)</h2><h3 id="åŠŸèƒ½-5"><a href="#åŠŸèƒ½-5" class="headerlink" title="åŠŸèƒ½"></a>åŠŸèƒ½</h3><p>å‘½ä¸­ç‡æ˜¯è¯„ä»·æ¨èç³»ç»Ÿæ˜¯å¦èƒ½å¤Ÿæ¨èå‡ºç”¨æˆ·æ„Ÿå…´è¶£çš„ç‰©å“çš„æŒ‡æ ‡ï¼Œå¯ä»¥ç†è§£ä¸ºç³»ç»Ÿæ˜¯å¦â€œå‘½ä¸­â€ç”¨æˆ·æ„Ÿå…´è¶£çš„å•†å“ã€‚</p><h3 id="è®¡ç®—å…¬å¼-5"><a href="#è®¡ç®—å…¬å¼-5" class="headerlink" title="è®¡ç®—å…¬å¼"></a>è®¡ç®—å…¬å¼</h3><p>å‘½ä¸­ç‡çš„è®¡ç®—å…¬å¼ä¸ºï¼š</p><p>$$ HitRate = \frac{Number\ of\ Hits}{Total\ Number\ of\ Tests} $$</p><h3 id="ç¤ºä¾‹-5"><a href="#ç¤ºä¾‹-5" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><p>å‡è®¾ä¸€ä¸ªæ¨èç³»ç»Ÿå¯¹10ä¸ªå•†å“åšå‡ºäº†é¢„æµ‹ï¼Œå…¶ä¸­3ä¸ªé¢„æµ‹å‘½ä¸­ï¼Œé‚£ä¹ˆå‘½ä¸­ç‡ä¸ºï¼š3 / 10 = 0.3ã€‚</p><h3 id="Python-å®ç°-5"><a href="#Python-å®ç°-5" class="headerlink" title="Python å®ç°"></a>Python å®ç°</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">hit_rate</span>(<span class="params">recommended_items, true_items</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(<span class="built_in">any</span>(item <span class="keyword">in</span> true_items <span class="keyword">for</span> item <span class="keyword">in</span> recommended_items))</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¨èçš„å•†å“å’ŒçœŸæ­£æ„Ÿå…´è¶£çš„å•†å“</span></span><br><span class="line">recommended_items = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line">true_items = [<span class="number">2</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]</span><br><span class="line"></span><br><span class="line">hit_rate = hit_rate(recommended_items, true_items)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f'Hit Rate: <span class="subst">{hit_rate}</span>'</span>)</span><br></pre></td></tr></tbody></table></figure><h3 id="é€‚ç”¨æ€§-4"><a href="#é€‚ç”¨æ€§-4" class="headerlink" title="é€‚ç”¨æ€§"></a>é€‚ç”¨æ€§</h3><p>â­ï¸â­ï¸â­ï¸â­ï¸â­ï¸</p><p>å‘½ä¸­ç‡å¯¹äºæ¨èç³»ç»Ÿçš„è¯„ä¼°éå¸¸é‡è¦ã€‚å› ä¸ºæ¨èç³»ç»Ÿçš„ä¸»è¦ç›®æ ‡å°±æ˜¯æ¨èå‡ºç”¨æˆ·æ„Ÿå…´è¶£çš„ç‰©å“ï¼Œå¦‚æœæ¨èçš„ç‰©å“ä¸­åŒ…å«äº†ç”¨æˆ·çœŸæ­£æ„Ÿå…´è¶£çš„ç‰©å“ï¼Œé‚£ä¹ˆå‘½ä¸­ç‡å°±é«˜ã€‚</p><hr><p>éå¸¸æ„Ÿè°¢æ‚¨çš„å»ºè®®ï¼Œä¸‹é¢æ˜¯æ ¹æ®æ‚¨çš„å»ºè®®ä¿®æ”¹åçš„ AUC å’Œ GAUC çš„ä»‹ç»ã€‚</p><h2 id="7-AUC-Area-Under-Curve"><a href="#7-AUC-Area-Under-Curve" class="headerlink" title="7. AUC (Area Under Curve)"></a>7. AUC (Area Under Curve)</h2><h3 id="åŠŸèƒ½-6"><a href="#åŠŸèƒ½-6" class="headerlink" title="åŠŸèƒ½"></a>åŠŸèƒ½</h3><p>AUC æ˜¯ä¸€ç§å¸¸ç”¨çš„åˆ†ç±»é—®é¢˜çš„æ€§èƒ½è¯„ä¼°æŒ‡æ ‡ï¼Œç‰¹åˆ«æ˜¯å¯¹äºæ¨èç³»ç»Ÿï¼Œå®ƒæ˜¯ä¸€ä¸ªè¡¡é‡æ¨¡å‹å¯¹æ­£è´Ÿæ ·æœ¬åŒºåˆ†åº¦çš„æŒ‡æ ‡ã€‚å¯¹äºæ¯ä¸€ä¸ªæ­£æ ·æœ¬ï¼Œè®¡ç®—å…¶é¢„æµ‹åˆ†æ•°é«˜äºå¤šå°‘æ¯”ä¾‹çš„è´Ÿæ ·æœ¬ï¼Œå³æ­£æ ·æœ¬çš„â€œæ­£æ ·æœ¬ç‡â€ã€‚AUC å°±æ˜¯æ‰€æœ‰æ­£æ ·æœ¬çš„å¹³å‡æ­£æ ·æœ¬ç‡ã€‚</p><h3 id="è®¡ç®—å…¬å¼-6"><a href="#è®¡ç®—å…¬å¼-6" class="headerlink" title="è®¡ç®—å…¬å¼"></a>è®¡ç®—å…¬å¼</h3><p>AUC çš„è®¡ç®—å¯ä»¥æè¿°ä¸ºï¼š</p><ol><li>å¯¹äºæ¯ä¸ªç”¨æˆ·ï¼Œè®¡ç®—æ¨èç³»ç»Ÿå¯¹äºæ­£æ ·æœ¬å’Œè´Ÿæ ·æœ¬çš„é¢„æµ‹åˆ†æ•°ã€‚</li><li>å¯¹äºæ¯ä¸ªæ­£æ ·æœ¬ï¼Œè®¡ç®—å…¶é¢„æµ‹åˆ†æ•°é«˜äºå¤šå°‘æ¯”ä¾‹çš„è´Ÿæ ·æœ¬ï¼Œå³æ­£æ ·æœ¬çš„â€œæ­£æ ·æœ¬ç‡â€ã€‚</li><li>è®¡ç®—æ‰€æœ‰æ­£æ ·æœ¬çš„å¹³å‡æ­£æ ·æœ¬ç‡ï¼Œå³ AUCã€‚</li></ol><p>å…·ä½“çš„å…¬å¼å¯ä»¥è¡¨ç¤ºä¸ºï¼š</p><p>$$ AUC = \frac{1}{M}\sum_{i=1}^{M} \frac{1}{P_iN_i} \sum_{j=1}^{P_i} \sum_{k=1}^{N_i} I(s_{ij} &gt; s_{ik}) $$</p><p>å…¶ä¸­ï¼Œ$M$ æ˜¯ç”¨æˆ·æ•°ï¼Œ$P_i$ å’Œ $N_i$ åˆ†åˆ«æ˜¯ç”¨æˆ· $i$ çš„æ­£æ ·æœ¬æ•°å’Œè´Ÿæ ·æœ¬æ•°ï¼Œ$s_{ij}$ å’Œ $s_{ik}$ åˆ†åˆ«æ˜¯ç”¨æˆ· $i$ çš„æ­£æ ·æœ¬ $j$ å’Œè´Ÿæ ·æœ¬ $k$ çš„é¢„æµ‹åˆ†æ•°ï¼Œ$I(\cdot)$ æ˜¯æŒ‡ç¤ºå‡½æ•°ã€‚</p><h3 id="Python-å®ç°-6"><a href="#Python-å®ç°-6" class="headerlink" title="Python å®ç°"></a>Python å®ç°</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> roc_auc_score</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¹æ¯ä¸ªç”¨æˆ·è®¡ç®— AUCï¼Œç„¶åå–å¹³å‡</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">calculate_auc</span>(<span class="params">users, y_true, y_score</span>):</span><br><span class="line">    auc_list = []</span><br><span class="line">    <span class="keyword">for</span> user <span class="keyword">in</span> users:</span><br><span class="line">        auc = roc_auc_score(y_true[user], y_score[user])</span><br><span class="line">        auc_list.append(auc)</span><br><span class="line">    <span class="keyword">return</span> np.mean(auc_list)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”¨æˆ·åˆ—è¡¨ã€çœŸå®æ ‡ç­¾ã€é¢„æµ‹å¾—åˆ†</span></span><br><span class="line">users = [<span class="string">'user1'</span>, <span class="string">'user2'</span>]</span><br><span class="line">y_true = {<span class="string">'user1'</span>: [<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>], <span class="string">'user2'</span>: [<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>]}</span><br><span class="line">y_score = {<span class="string">'user1'</span>: [<span class="number">0.9</span>, <span class="number">0.8</span>, <span class="number">0.5</span>, <span class="number">0.4</span>], <span class="string">'user2'</span>: [<span class="number">0.7</span>, <span class="number">0.6</span>, <span class="number">0.3</span>, <span class="number">0.2</span>]}</span><br><span class="line"></span><br><span class="line">auc = calculate_auc(users, y_true, y_score)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f'AUC: <span class="subst">{auc}</span>'</span>)</span><br></pre></td></tr></tbody></table></figure><p>ç‰¹åˆ«éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨é¢è¯•ä¸­ç»å¸¸é‡åˆ°è¦æ±‚ä½¿ç”¨ Python æ‰‹å†™ AUC è®¡ç®—é¢è¯•é¢˜ï¼Œä¸‹é¢å±•ç¤ºä¸€ä¸ªå®ä¾‹ï¼Œè¯¥ç¤ºä¾‹ä¸»è¦è€ƒè™‘äºŒåˆ†ç±»é—®é¢˜ã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">calculate_auc_manual</span>(<span class="params">y_true, y_score</span>):</span><br><span class="line">    <span class="comment"># é¦–å…ˆï¼Œè·å–æ‰€æœ‰æ­£æ ·æœ¬å’Œè´Ÿæ ·æœ¬çš„ç´¢å¼•</span></span><br><span class="line">    pos_indices = [i <span class="keyword">for</span> i, x <span class="keyword">in</span> <span class="built_in">enumerate</span>(y_true) <span class="keyword">if</span> x == <span class="number">1</span>]</span><br><span class="line">    neg_indices = [i <span class="keyword">for</span> i, x <span class="keyword">in</span> <span class="built_in">enumerate</span>(y_true) <span class="keyword">if</span> x == <span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è®¡ç®—æ‰€æœ‰æ­£æ ·æœ¬çš„åˆ†æ•°é«˜äºå¤šå°‘æ¯”ä¾‹çš„è´Ÿæ ·æœ¬</span></span><br><span class="line">    pos_count = <span class="built_in">len</span>(pos_indices)</span><br><span class="line">    neg_count = <span class="built_in">len</span>(neg_indices)</span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> pos_indices:</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> neg_indices:</span><br><span class="line">            <span class="keyword">if</span> y_score[i] &gt; y_score[j]:</span><br><span class="line">                count += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ­£æ ·æœ¬ç‡å°±æ˜¯æ‰€æœ‰æ­£æ ·æœ¬çš„åˆ†æ•°é«˜äºè´Ÿæ ·æœ¬çš„æ•°é‡æ¯”ä¸Šæ€»çš„æ­£è´Ÿæ ·æœ¬å¯¹çš„æ•°é‡</span></span><br><span class="line">    pos_rate = count / (pos_count * neg_count)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> pos_rate</span><br><span class="line"></span><br><span class="line"><span class="comment"># çœŸå®æ ‡ç­¾</span></span><br><span class="line">y_true = [<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>]</span><br><span class="line"><span class="comment"># é¢„æµ‹å¾—åˆ†</span></span><br><span class="line">y_score = [<span class="number">0.9</span>, <span class="number">0.8</span>, <span class="number">0.1</span>, <span class="number">0.4</span>, <span class="number">0.95</span>, <span class="number">0.6</span>]</span><br><span class="line"></span><br><span class="line">auc = calculate_auc_manual(y_true, y_score)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f'AUC: <span class="subst">{auc}</span>'</span>)</span><br><span class="line">``````</span><br><span class="line"></span><br><span class="line">åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆè·å–æ‰€æœ‰æ­£æ ·æœ¬å’Œè´Ÿæ ·æœ¬çš„ç´¢å¼•ã€‚ç„¶åï¼Œå¯¹äºæ¯ä¸€ä¸ªæ­£æ ·æœ¬ï¼Œæˆ‘ä»¬è®¡ç®—å…¶é¢„æµ‹åˆ†æ•°é«˜äºå¤šå°‘æ¯”ä¾‹çš„è´Ÿæ ·æœ¬ã€‚æœ€åï¼Œæ‰€æœ‰æ­£æ ·æœ¬çš„å¹³å‡æ­£æ ·æœ¬ç‡å³ä¸º AUCã€‚</span><br><span class="line"></span><br><span class="line">æ³¨æ„ï¼šåœ¨çœŸå®ç¯å¢ƒä¸­ï¼Œä¸Šè¿°å®ç°å¯èƒ½ä¼šéå¸¸æ…¢ï¼Œå› ä¸ºå®ƒéœ€è¦å¯¹æ‰€æœ‰æ­£è´Ÿæ ·æœ¬å¯¹è¿›è¡Œæ¯”è¾ƒã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šä½¿ç”¨æ›´æœ‰æ•ˆçš„ç®—æ³•æ¥è®¡ç®— AUCï¼Œä¾‹å¦‚ä½¿ç”¨æ’åºå’Œè®¡æ•°æ–¹æ³•ã€‚</span><br><span class="line"></span><br><span class="line"><span class="comment">### é€‚ç”¨æ€§</span></span><br><span class="line"></span><br><span class="line">â­ï¸â­ï¸â­ï¸â­ï¸â­ï¸</span><br><span class="line"></span><br><span class="line">AUC éå¸¸é€‚ç”¨äºæ¨èç³»ç»Ÿçš„è¯„ä¼°ã€‚AUC å¯ä»¥è¡¡é‡æ¨¡å‹å¯¹æ­£è´Ÿæ ·æœ¬çš„åŒºåˆ†èƒ½åŠ›ï¼Œå¯¹äºæ¨èç³»ç»Ÿæ¥è¯´ï¼Œå°±æ˜¯èƒ½å¦å‡†ç¡®åœ°æ‰¾å‡ºç”¨æˆ·æ„Ÿå…´è¶£çš„ç‰©å“ã€‚å› æ­¤ï¼ŒAUC æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„è¯„ä»·æŒ‡æ ‡ã€‚</span><br><span class="line"></span><br><span class="line">------</span><br><span class="line"></span><br><span class="line"><span class="comment">## 8. GAUC (Group Area Under Curve)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###</span></span><br><span class="line"></span><br><span class="line">åŠŸèƒ½</span><br><span class="line"></span><br><span class="line">GAUC æ˜¯ AUC çš„æ‰©å±•ï¼Œä¸»è¦åº”ç”¨äºæ¨èç³»ç»Ÿç­‰åœºæ™¯ã€‚å®ƒçš„è®¡ç®—æ–¹æ³•å’Œ AUC ç±»ä¼¼ï¼Œåªæ˜¯åœ¨è®¡ç®—æ­£æ ·æœ¬ç‡æ—¶ï¼Œéœ€è¦æŒ‰ç…§ç”¨æˆ·ç»„è¿›è¡Œè®¡ç®—ï¼Œè€Œä¸æ˜¯æŒ‰ç…§å•ä¸ªæ ·æœ¬è¿›è¡Œè®¡ç®—ã€‚</span><br><span class="line"></span><br><span class="line"><span class="comment">### è®¡ç®—å…¬å¼</span></span><br><span class="line"></span><br><span class="line">GAUC çš„è®¡ç®—æ­¥éª¤å¦‚ä¸‹ï¼š</span><br><span class="line"></span><br><span class="line"><span class="number">1.</span> å¯¹äºæ¯ä¸ªç”¨æˆ·ï¼Œè®¡ç®—æ¨èç³»ç»Ÿå¯¹äºæ­£æ ·æœ¬å’Œè´Ÿæ ·æœ¬çš„é¢„æµ‹åˆ†æ•°ã€‚</span><br><span class="line"><span class="number">2.</span> å¯¹äºæ¯ä¸ªç”¨æˆ·ï¼Œè®¡ç®—å…¶æ­£æ ·æœ¬çš„é¢„æµ‹åˆ†æ•°é«˜äºå¤šå°‘æ¯”ä¾‹çš„è´Ÿæ ·æœ¬ï¼Œå³ç”¨æˆ·çš„â€œæ­£æ ·æœ¬ç‡â€ã€‚</span><br><span class="line"><span class="number">3.</span> è®¡ç®—æ‰€æœ‰ç”¨æˆ·çš„å¹³å‡æ­£æ ·æœ¬ç‡ï¼Œå³ GAUCã€‚</span><br><span class="line"></span><br><span class="line">å…·ä½“çš„å…¬å¼å¯ä»¥è¡¨ç¤ºä¸ºï¼š</span><br><span class="line"></span><br><span class="line">$$ GAUC = \frac{<span class="number">1</span>}{M}\sum_{i=<span class="number">1</span>}^{M} \left( \frac{<span class="number">1</span>}{P_iN_i} \sum_{j=<span class="number">1</span>}^{P_i} \sum_{k=<span class="number">1</span>}^{N_i} I(s_{ij} &gt; s_{ik}) \right) $$</span><br><span class="line"></span><br><span class="line">å…¶ä¸­ï¼Œ$M$ æ˜¯ç”¨æˆ·æ•°ï¼Œ$P_i$ å’Œ $N_i$ åˆ†åˆ«æ˜¯ç”¨æˆ· $i$ çš„æ­£æ ·æœ¬æ•°å’Œè´Ÿæ ·æœ¬æ•°ï¼Œ$s_{ij}$ å’Œ $s_{ik}$ åˆ†åˆ«æ˜¯ç”¨æˆ· $i$ çš„æ­£æ ·æœ¬ $j$ å’Œè´Ÿæ ·æœ¬ $k$ çš„é¢„æµ‹åˆ†æ•°ï¼Œ$I(\cdot)$ æ˜¯æŒ‡ç¤ºå‡½æ•°ã€‚</span><br><span class="line"></span><br><span class="line"><span class="comment">### Python å®ç°</span></span><br><span class="line"></span><br><span class="line">Python å®ç°éœ€è¦æ ¹æ®å…·ä½“çš„æ•°æ®æƒ…å†µè¿›è¡Œï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ªåŸºæœ¬çš„ç¤ºä¾‹ã€‚</span><br><span class="line"></span><br><span class="line">```python</span><br><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> roc_auc_score</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¹æ¯ä¸ªç”¨æˆ·è®¡ç®— AUCï¼Œç„¶åå–å¹³å‡</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">calculate_gauc</span>(<span class="params">users, y_true, y_score</span>):</span><br><span class="line">    auc_list = []</span><br><span class="line">    <span class="keyword">for</span> user <span class="keyword">in</span> users:</span><br><span class="line">        auc = roc_auc_score(y_true[user], y_score[user])</span><br><span class="line">        auc_list.append(auc)</span><br><span class="line">    <span class="keyword">return</span> np.mean(auc_list)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”¨æˆ·åˆ—è¡¨ã€çœŸå®æ ‡ç­¾ã€é¢„æµ‹å¾—åˆ†</span></span><br><span class="line">users = [<span class="string">'user1'</span>, <span class="string">'user2'</span>]</span><br><span class="line">y_true = {<span class="string">'user1'</span>: [<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>], <span class="string">'user2'</span>: [<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>]}</span><br><span class="line">y_score = {<span class="string">'user1'</span>: [<span class="number">0.9</span>, <span class="number">0.8</span>, <span class="number">0.5</span>, <span class="number">0.4</span>], <span class="string">'user2'</span>: [<span class="number">0.7</span>, <span class="number">0.6</span>, <span class="number">0.3</span>, <span class="number">0.2</span>]}</span><br><span class="line"></span><br><span class="line">gauc = calculate_gauc(users, y_true, y_score)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f'GAUC: <span class="subst">{gauc}</span>'</span>)</span><br></pre></td></tr></tbody></table></figure><h3 id="é€‚ç”¨æ€§-5"><a href="#é€‚ç”¨æ€§-5" class="headerlink" title="é€‚ç”¨æ€§"></a>é€‚ç”¨æ€§</h3><p>â­ï¸â­ï¸â­ï¸â­ï¸â­ï¸</p><p>GAUC ä¹Ÿéå¸¸é€‚ç”¨äºæ¨èç³»ç»Ÿçš„è¯„ä¼°ï¼Œå°¤å…¶æ˜¯å¯¹äºé‚£äº›éœ€è¦è€ƒè™‘ä¸ªä½“å·®å¼‚çš„ç³»ç»Ÿã€‚é€šè¿‡è®¡ç®—æ¯ä¸ªç”¨æˆ·çš„ AUC å¹¶å–å¹³å‡ï¼ŒGAUC èƒ½å¤Ÿæ›´å…¨é¢åœ°åæ˜ æ¨èç³»ç»Ÿçš„æ€§èƒ½ã€‚</p><h3 id="é€‚ç”¨æ€§-6"><a href="#é€‚ç”¨æ€§-6" class="headerlink" title="é€‚ç”¨æ€§"></a>é€‚ç”¨æ€§</h3><p>â­ï¸â­ï¸â­ï¸â­ï¸â­ï¸</p><p>GAUC ä¹Ÿéå¸¸é€‚ç”¨äºæ¨èç³»ç»Ÿçš„è¯„ä¼°ï¼Œå°¤å…¶æ˜¯å¯¹äºé‚£äº›éœ€è¦è€ƒè™‘ä¸ªä½“å·®å¼‚çš„ç³»ç»Ÿã€‚é€šè¿‡è®¡ç®—æ¯ä¸ªç”¨æˆ·çš„ AUC å¹¶å–å¹³å‡ï¼ŒGAUC èƒ½å¤Ÿæ›´å…¨é¢åœ°åæ˜ æ¨èç³»ç»Ÿçš„æ€§èƒ½ã€‚</p><hr><h2 id="9-LogLoss-Logarithmic-Loss"><a href="#9-LogLoss-Logarithmic-Loss" class="headerlink" title="9. LogLoss (Logarithmic Loss)"></a>9. LogLoss (Logarithmic Loss)</h2><h3 id="åŠŸèƒ½-7"><a href="#åŠŸèƒ½-7" class="headerlink" title="åŠŸèƒ½"></a>åŠŸèƒ½</h3><p>LogLoss æ˜¯ä¸€ç§è¡¡é‡åˆ†ç±»æ¨¡å‹çš„æŸå¤±å‡½æ•°ï¼Œå®ƒè€ƒè™‘äº†æ¨¡å‹é¢„æµ‹çš„æ¦‚ç‡å€¼ã€‚å¯¹äºäºŒåˆ†ç±»é—®é¢˜ï¼Œå…¶å€¼è¶Šå°ï¼Œè¡¨ç¤ºæ¨¡å‹çš„æ€§èƒ½è¶Šå¥½ã€‚</p><h3 id="è®¡ç®—å…¬å¼-7"><a href="#è®¡ç®—å…¬å¼-7" class="headerlink" title="è®¡ç®—å…¬å¼"></a>è®¡ç®—å…¬å¼</h3><p>LogLoss çš„è®¡ç®—å…¬å¼ä¸ºï¼š</p><p>$$ LogLoss = -\frac{1}{n}\sum_{i=1}^{n}[y_i\log(p_i) + (1 - y_i)\log(1 - p_i)] $$</p><h3 id="ç¤ºä¾‹-6"><a href="#ç¤ºä¾‹-6" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><p>å‡è®¾ä¸€ä¸ªæ¨èç³»ç»Ÿå¯¹3ä¸ªæ ·æœ¬çš„é¢„æµ‹æ¦‚ç‡åˆ†åˆ«ä¸º [0.8, 0.6, 0.3]ï¼Œè€Œè¿™3ä¸ªæ ·æœ¬çš„çœŸå®æ ‡ç­¾åˆ†åˆ«ä¸º [1, 1, 0]ï¼Œé‚£ä¹ˆ LogLoss å¯ä»¥é€šè¿‡ä»£å…¥å…¬å¼è¿›è¡Œè®¡ç®—ã€‚</p><h3 id="Python-å®ç°-7"><a href="#Python-å®ç°-7" class="headerlink" title="Python å®ç°"></a>Python å®ç°</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> log_loss</span><br><span class="line"></span><br><span class="line"><span class="comment"># y_true è¡¨ç¤ºçœŸå®æ ‡ç­¾ï¼Œy_pred è¡¨ç¤ºé¢„æµ‹çš„æ¦‚ç‡</span></span><br><span class="line">y_true = [<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>]</span><br><span class="line">y_pred = [<span class="number">0.8</span>, <span class="number">0.6</span>, <span class="number">0.3</span>]</span><br><span class="line"></span><br><span class="line">logloss = log_loss(y_true, y_pred)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f'LogLoss: <span class="subst">{logloss}</span>'</span>)</span><br></pre></td></tr></tbody></table></figure><h3 id="é€‚ç”¨æ€§-7"><a href="#é€‚ç”¨æ€§-7" class="headerlink" title="é€‚ç”¨æ€§"></a>é€‚ç”¨æ€§</h3><p>â­ï¸â­ï¸â­ï¸â­ï¸</p><p>LogLoss åœ¨æ¨èç³»ç»Ÿçš„è¯„ä¼°ä¸­é€‚ç”¨ï¼Œä½†å¯èƒ½å¹¶ä¸æ˜¯æœ€ä¸»è¦çš„æŒ‡æ ‡ã€‚LogLoss æ›´æ³¨é‡æ¨¡å‹é¢„æµ‹çš„æ¦‚ç‡å€¼æ˜¯å¦å‡†ç¡®ï¼Œè€Œæ¨èç³»ç»Ÿé™¤äº†é¢„æµ‹çš„å‡†ç¡®æ€§å¤–ï¼Œè¿˜éœ€è¦è€ƒè™‘å…¶ä»–å› ç´ ï¼Œå¦‚è¦†ç›–ç‡ã€æ–°é¢–æ€§ç­‰ã€‚å› æ­¤ï¼ŒLogLoss å¯ä»¥ä½œä¸ºè¡¡é‡æ¨èç³»ç»Ÿçš„ä¸€ä¸ªè¾…åŠ©æŒ‡æ ‡ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> NLP Insights </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Recommendation </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>VS Code Remote SSHè¿æ¥å¤±è´¥é—®é¢˜</title>
      <link href="/2023/07/06/Debugging%20Diaries/VS%20Code%20Remote%20SSH%E8%BF%9E%E6%8E%A5%E5%A4%B1%E8%B4%A5%E9%97%AE%E9%A2%98/"/>
      <url>/2023/07/06/Debugging%20Diaries/VS%20Code%20Remote%20SSH%E8%BF%9E%E6%8E%A5%E5%A4%B1%E8%B4%A5%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h1 id="VS-Code-Remote-SSHè¿æ¥å¤±è´¥çš„é—®é¢˜è§£å†³"><a href="#VS-Code-Remote-SSHè¿æ¥å¤±è´¥çš„é—®é¢˜è§£å†³" class="headerlink" title="VS Code Remote SSHè¿æ¥å¤±è´¥çš„é—®é¢˜è§£å†³"></a>VS Code Remote SSHè¿æ¥å¤±è´¥çš„é—®é¢˜è§£å†³</h1><p>æœ¬æ–‡æ¡£é’ˆå¯¹VS Codeä¸­çš„Remote SSHæ’ä»¶åœ¨å°è¯•è¿æ¥è¿œç¨‹æœåŠ¡å™¨æ—¶å‡ºç°â€Failed to parse remote port from server outputâ€é”™è¯¯çš„æƒ…å†µæä¾›è§£å†³æ–¹æ¡ˆã€‚ä½œè€…åœ¨ç»è¿‡ä¸€ç³»åˆ—çš„æ’æŸ¥å’Œå°è¯•åï¼Œæœ€ç»ˆæ‰¾åˆ°äº†è§£å†³çš„æ–¹æ³•ã€‚</p><h2 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h2><p>åœ¨ä½¿ç”¨VS Codeçš„Remote SSHæ’ä»¶å°è¯•è¿æ¥è¿œç¨‹æœåŠ¡å™¨æ—¶ï¼Œé‡åˆ°äº†é”™è¯¯æç¤ºâ€Failed to parse remote port from server outputâ€ã€‚æ­¤é”™è¯¯æç¤ºå¯èƒ½æ˜¯ç”±äºVS Codeä¸èƒ½æ­£ç¡®åœ°ä»SSHæœåŠ¡å™¨çš„è¾“å‡ºä¸­è§£æå‡ºè¿œç¨‹ç«¯å£ã€‚</p><h2 id="å°è¯•çš„è§£å†³æ–¹æ³•"><a href="#å°è¯•çš„è§£å†³æ–¹æ³•" class="headerlink" title="å°è¯•çš„è§£å†³æ–¹æ³•"></a>å°è¯•çš„è§£å†³æ–¹æ³•</h2><ol><li>æ£€æŸ¥SSHé…ç½®æ–‡ä»¶</li><li>æ›´æ–°VS Codeå’ŒRemote SSHæ‰©å±•</li><li>æ‰‹åŠ¨SSHè¿æ¥</li><li>æ£€æŸ¥è¿œç¨‹æœåŠ¡å™¨çš„çŠ¶æ€</li><li>é‡å¯VS Code</li></ol><p>ä»¥ä¸Šå¸¸è§çš„è§£å†³æ–¹æ³•éƒ½æœªèƒ½è§£å†³é—®é¢˜ã€‚</p><h2 id="æˆåŠŸçš„è§£å†³æ–¹æ¡ˆ"><a href="#æˆåŠŸçš„è§£å†³æ–¹æ¡ˆ" class="headerlink" title="æˆåŠŸçš„è§£å†³æ–¹æ¡ˆ"></a>æˆåŠŸçš„è§£å†³æ–¹æ¡ˆ</h2><p>æœ€ç»ˆï¼Œä½œè€…å°è¯•äº†å–æ¶ˆå‹¾é€‰VS Codeè®¾ç½®ä¸­çš„<code>Remote.SSH: Use Local Server</code>é€‰é¡¹ï¼ŒæˆåŠŸè¿æ¥åˆ°äº†è¿œç¨‹æœåŠ¡å™¨ã€‚å½“è¯¥é€‰é¡¹è¢«é€‰ä¸­ï¼ˆé»˜è®¤ï¼‰æ—¶ï¼ŒVS Codeä¼šåœ¨æœ¬åœ°æœºå™¨ä¸Šå¯åŠ¨ä¸€ä¸ªæœåŠ¡å™¨ï¼Œç„¶åé€šè¿‡è¯¥æœ¬åœ°æœåŠ¡å™¨è¿æ¥åˆ°è¿œç¨‹SSHæœåŠ¡å™¨ã€‚å½“å–æ¶ˆå‹¾é€‰æ­¤é€‰é¡¹æ—¶ï¼ŒVS Codeä¼šç›´æ¥è¿æ¥åˆ°è¿œç¨‹SSHæœåŠ¡å™¨ï¼Œè€Œä¸é€šè¿‡æœ¬åœ°æœåŠ¡å™¨ã€‚</p><h3 id="è§£å†³æ­¥éª¤"><a href="#è§£å†³æ­¥éª¤" class="headerlink" title="è§£å†³æ­¥éª¤"></a>è§£å†³æ­¥éª¤</h3><ol><li>æ‰“å¼€VS Codeã€‚</li><li>åœ¨å·¦ä¾§çš„æ´»åŠ¨æ ç‚¹å‡»é½¿è½®å›¾æ ‡æ‰“å¼€è®¾ç½®ã€‚</li><li>åœ¨è®¾ç½®æœç´¢æ¡†ä¸­è¾“å…¥<code>Remote.SSH: Use Local Server</code>ã€‚</li><li>å–æ¶ˆé€‰ä¸­å‡ºç°çš„<code>Remote.SSH: Use Local Server</code>å¤é€‰æ¡†ã€‚</li></ol><h2 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h2><p>è™½ç„¶ç›´æ¥è¿æ¥åˆ°è¿œç¨‹SSHæœåŠ¡å™¨å¯ä»¥è§£å†³æŸäº›è¿æ¥é—®é¢˜ï¼Œä½†ç”±äºæ²¡æœ‰åˆ©ç”¨åˆ°æœ¬åœ°æœåŠ¡å™¨çš„ä¼˜åŠ¿ï¼Œå¯èƒ½ä¼šå¯¼è‡´VS Codeçš„æ€§èƒ½ç¨æœ‰ä¸‹é™ã€‚ä½†åªè¦æ²¡æœ‰é‡åˆ°æ€§èƒ½é—®é¢˜ï¼Œè¿™ä¸ªè®¾ç½®å°±ä¸éœ€è¦è¿‡äºæ‹…å¿ƒã€‚</p><h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>å¦‚æœä½ åœ¨ä½¿ç”¨VS Codeçš„Remote SSHæ’ä»¶è¿æ¥è¿œç¨‹æœåŠ¡å™¨æ—¶é‡åˆ°äº†ç±»ä¼¼çš„é—®é¢˜ï¼Œä½ ä¹Ÿå¯ä»¥è¯•è¯•è¿™ä¸ªæ–¹æ³•ï¼Œå¸Œæœ›è¿™ä¸ªè§£å†³æ–¹æ¡ˆèƒ½å¸®åŠ©åˆ°ä½ ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Debugging Diaries </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IssueFix </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>KubernetesåŸºç¡€</title>
      <link href="/2023/06/06/Tech%20Toolbox/Kubernetes%E5%9F%BA%E7%A1%80/"/>
      <url>/2023/06/06/Tech%20Toolbox/Kubernetes%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<blockquote><p>å‰è¨€ï¼šæœ¬æ–‡å°†ä»‹ç»KubernetesåŸºç¡€ä¸­çš„é‡è¦æ¦‚å¿µâ€”â€”Podï¼Œä»¥åŠå®ƒåœ¨Kubernetesä¸­çš„åº”ç”¨å’ŒåŠŸèƒ½ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å°†è¯¦ç»†è§£é‡ŠPodçš„åŸºæœ¬æ¦‚å¿µå’Œæ„æˆï¼ŒåŒ…æ‹¬å®ƒä½œä¸ºæœ€å°å¯éƒ¨ç½²å•å…ƒçš„ç‰¹ç‚¹å’ŒåŒ…å«çš„èµ„æºã€‚ç„¶åï¼Œæˆ‘ä»¬å°†æ¢è®¨Podåœ¨Kubernetesä¸­çš„ä½œç”¨ä¸åŠŸèƒ½ï¼ŒåŒ…æ‹¬è°ƒåº¦å•ä½ã€ç½‘ç»œå•å…ƒã€å­˜å‚¨å•å…ƒã€ç”Ÿå‘½å‘¨æœŸç®¡ç†å’Œæ°´å¹³æ‰©å±•ã€‚é€šè¿‡æ·±å…¥äº†è§£Podï¼Œæ‚¨å°†å¯¹Kubernetesä¸­çš„æ ¸å¿ƒæ¦‚å¿µæœ‰æ›´å…¨é¢çš„ç†è§£ã€‚</p></blockquote><h2 id="I-KubernetesåŸºç¡€ï¼šPodç†è§£ä¸åº”ç”¨"><a href="#I-KubernetesåŸºç¡€ï¼šPodç†è§£ä¸åº”ç”¨" class="headerlink" title="I. KubernetesåŸºç¡€ï¼šPodç†è§£ä¸åº”ç”¨"></a><strong>I. KubernetesåŸºç¡€ï¼šPodç†è§£ä¸åº”ç”¨</strong></h2><h3 id="1-1-Podçš„åŸºæœ¬æ¦‚å¿µä¸æ„æˆ"><a href="#1-1-Podçš„åŸºæœ¬æ¦‚å¿µä¸æ„æˆ" class="headerlink" title="1.1 Podçš„åŸºæœ¬æ¦‚å¿µä¸æ„æˆ"></a><strong>1.1 Podçš„åŸºæœ¬æ¦‚å¿µä¸æ„æˆ</strong></h3><p>åœ¨Kubernetesï¼ˆç®€ç§°K8sï¼‰ä¸­ï¼ŒPodï¼ˆå®¹å™¨ç»„ï¼‰æ˜¯æœ€å°çš„å¯éƒ¨ç½²å•å…ƒã€‚å®ƒæ˜¯Kubernetesé›†ç¾¤ä¸­å¯ä»¥è¿è¡Œçš„ä¸€ç»„ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨çš„é€»è¾‘ä¸»æœºã€‚Podæä¾›äº†ä¸€ä¸ªç‹¬ç«‹çš„ç¯å¢ƒï¼Œå…¶ä¸­åŒ…å«è¿è¡Œåº”ç”¨ç¨‹åºæ‰€éœ€çš„æ‰€æœ‰èµ„æºï¼Œå¦‚å­˜å‚¨ã€ç½‘ç»œå’Œå…¶ä»–ä¾èµ–é¡¹ã€‚</p><p>Podé€šå¸¸ç”±ä¸€ä¸ªæˆ–å¤šä¸ªç´§å¯†ç›¸å…³çš„å®¹å™¨ç»„æˆï¼Œè¿™äº›å®¹å™¨å…±äº«ç›¸åŒçš„å‘½åç©ºé—´ã€ç½‘ç»œå’Œå­˜å‚¨å·ã€‚å®ƒä»¬å¯ä»¥é€šè¿‡æœ¬åœ°ä¸»æœºä¸Šçš„localhostè¿›è¡Œé€šä¿¡ï¼Œå¹¶ä¸”å¯ä»¥å…±äº«æ–‡ä»¶ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†æˆ–å…¨éƒ¨å†…å®¹ã€‚</p><h3 id="1-2-Podåœ¨Kubernetesä¸­çš„ä½œç”¨ä¸åŠŸèƒ½"><a href="#1-2-Podåœ¨Kubernetesä¸­çš„ä½œç”¨ä¸åŠŸèƒ½" class="headerlink" title="1.2 Podåœ¨Kubernetesä¸­çš„ä½œç”¨ä¸åŠŸèƒ½"></a><strong>1.2 Podåœ¨Kubernetesä¸­çš„ä½œç”¨ä¸åŠŸèƒ½</strong></h3><p>Podåœ¨Kubernetesä¸­çš„ä½œç”¨æ˜¯ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p><ol><li>è°ƒåº¦å•ä½ï¼šKuberneteså°†Podä½œä¸ºè°ƒåº¦çš„åŸºæœ¬å•ä½ï¼Œå†³å®šåœ¨å“ªä¸ªèŠ‚ç‚¹ä¸Šè¿è¡ŒPodã€‚</li><li>ç½‘ç»œå•å…ƒï¼šæ¯ä¸ªPodéƒ½æœ‰è‡ªå·±çš„IPåœ°å€ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡Kubernetesé›†ç¾¤å†…éƒ¨å’Œå¤–éƒ¨çš„æœåŠ¡å‘ç°æœºåˆ¶ä¸å…¶ä»–Podæˆ–å¤–éƒ¨æœåŠ¡é€šä¿¡ã€‚</li><li>å­˜å‚¨å•å…ƒï¼šPodå¯ä»¥å…±äº«å­˜å‚¨å·ï¼Œå®¹å™¨ä¹‹é—´å¯ä»¥å…±äº«æ–‡ä»¶ç³»ç»Ÿä¸­çš„æ•°æ®ã€‚</li><li>ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼šPodå¯ä»¥åˆ›å»ºã€å¯åŠ¨ã€åœæ­¢å’Œé”€æ¯ï¼Œå®ƒä»¬çš„ç”Ÿå‘½å‘¨æœŸç”±Kubernetesæ§åˆ¶å™¨ç®¡ç†ã€‚</li><li>æ°´å¹³æ‰©å±•ï¼šå¯ä»¥é€šè¿‡å¤åˆ¶Podçš„æ–¹å¼æ°´å¹³æ‰©å±•åº”ç”¨ç¨‹åºçš„å®ä¾‹ã€‚</li></ol><h2 id="II-Kubernetesåº”ç”¨å®è·µï¼šåœ¨Kubernetesä¸­å®‰è£…å’Œé…ç½®Miniconda"><a href="#II-Kubernetesåº”ç”¨å®è·µï¼šåœ¨Kubernetesä¸­å®‰è£…å’Œé…ç½®Miniconda" class="headerlink" title="II. Kubernetesåº”ç”¨å®è·µï¼šåœ¨Kubernetesä¸­å®‰è£…å’Œé…ç½®Miniconda"></a><strong><strong>II. Kubernetesåº”ç”¨å®è·µï¼šåœ¨Kubernetesä¸­å®‰è£…å’Œé…ç½®Miniconda</strong></strong></h2><h3 id="2-1-å®‰è£…å’Œé…ç½®Minicondaçš„æ­¥éª¤"><a href="#2-1-å®‰è£…å’Œé…ç½®Minicondaçš„æ­¥éª¤" class="headerlink" title="2.1 å®‰è£…å’Œé…ç½®Minicondaçš„æ­¥éª¤"></a><strong><strong>2.1 å®‰è£…å’Œé…ç½®Minicondaçš„æ­¥éª¤</strong></strong></h3><p>æœ¬æ–‡ä»‹ç»äº†å¦‚ä½•åœ¨Kubernetesé›†ç¾¤ä¸­å®‰è£…å’Œé…ç½®Minicondaã€‚Minicondaæ˜¯ä¸€ä¸ªè½»é‡çº§çš„Pythonç¯å¢ƒç®¡ç†å·¥å…·ï¼Œå¯ç”¨äºåˆ›å»ºå’Œç®¡ç†Pythonç¯å¢ƒåŠå…¶ç›¸å…³åŒ…ã€‚</p><h3 id="æ­¥éª¤-1ï¼šç™»å½•åˆ°Kubernetes-Podçš„ç»ˆç«¯"><a href="#æ­¥éª¤-1ï¼šç™»å½•åˆ°Kubernetes-Podçš„ç»ˆç«¯" class="headerlink" title="æ­¥éª¤ 1ï¼šç™»å½•åˆ°Kubernetes Podçš„ç»ˆç«¯"></a>æ­¥éª¤ 1ï¼šç™»å½•åˆ°Kubernetes Podçš„ç»ˆç«¯</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl <span class="built_in">exec</span> -it &lt;pod-name&gt; -- /bin/bash</span><br></pre></td></tr></tbody></table></figure><p>å°† <code>&lt;pod-name&gt;</code> æ›¿æ¢ä¸ºè¦ç™»å½•çš„Podçš„åç§°ã€‚</p><h3 id="æ­¥éª¤-2ï¼šä¸‹è½½å’Œå®‰è£…Miniconda"><a href="#æ­¥éª¤-2ï¼šä¸‹è½½å’Œå®‰è£…Miniconda" class="headerlink" title="æ­¥éª¤ 2ï¼šä¸‹è½½å’Œå®‰è£…Miniconda"></a>æ­¥éª¤ 2ï¼šä¸‹è½½å’Œå®‰è£…Miniconda</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -O https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh</span><br><span class="line">bash Miniconda3-latest-Linux-x86_64.sh</span><br></pre></td></tr></tbody></table></figure><p>è¿™å°†ä¸‹è½½Minicondaçš„å®‰è£…è„šæœ¬å¹¶å¯åŠ¨å®‰è£…è¿‡ç¨‹ã€‚</p><h3 id="æ­¥éª¤-3ï¼šå®Œæˆå®‰è£…å‘å¯¼"><a href="#æ­¥éª¤-3ï¼šå®Œæˆå®‰è£…å‘å¯¼" class="headerlink" title="æ­¥éª¤ 3ï¼šå®Œæˆå®‰è£…å‘å¯¼"></a>æ­¥éª¤ 3ï¼šå®Œæˆå®‰è£…å‘å¯¼</h3><p>æ ¹æ®å®‰è£…å‘å¯¼çš„æç¤ºï¼Œé€‰æ‹©å®‰è£…è·¯å¾„ã€ç¯å¢ƒå˜é‡é…ç½®ç­‰é€‰é¡¹å®ŒæˆMinicondaçš„å®‰è£…ã€‚</p><h3 id="æ­¥éª¤-4ï¼šæ¿€æ´»Minicondaç¯å¢ƒ"><a href="#æ­¥éª¤-4ï¼šæ¿€æ´»Minicondaç¯å¢ƒ" class="headerlink" title="æ­¥éª¤ 4ï¼šæ¿€æ´»Minicondaç¯å¢ƒ"></a>æ­¥éª¤ 4ï¼šæ¿€æ´»Minicondaç¯å¢ƒ</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br></pre></td></tr></tbody></table></figure><p>é‡æ–°åŠ è½½ç»ˆç«¯æˆ–æ‰§è¡Œä¸Šè¿°å‘½ä»¤æ¥æ¿€æ´»Minicondaç¯å¢ƒã€‚</p><h3 id="æ­¥éª¤-5ï¼šä½¿ç”¨Miniconda"><a href="#æ­¥éª¤-5ï¼šä½¿ç”¨Miniconda" class="headerlink" title="æ­¥éª¤ 5ï¼šä½¿ç”¨Miniconda"></a>æ­¥éª¤ 5ï¼šä½¿ç”¨Miniconda</h3><p>åœ¨æ¿€æ´»çš„Minicondaç¯å¢ƒä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥ç®¡ç†ç¯å¢ƒå’Œå®‰è£…PythonåŒ…ï¼š</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">conda create --name myenv python=3.9</span><br><span class="line">conda activate myenv</span><br><span class="line">conda install package_name</span><br></pre></td></tr></tbody></table></figure><h3 id="2-2-å®‰è£…å’Œä½¿ç”¨Minicondaçš„æ³¨æ„äº‹é¡¹"><a href="#2-2-å®‰è£…å’Œä½¿ç”¨Minicondaçš„æ³¨æ„äº‹é¡¹" class="headerlink" title="2.2 å®‰è£…å’Œä½¿ç”¨Minicondaçš„æ³¨æ„äº‹é¡¹"></a><strong><strong>2.2 å®‰è£…å’Œä½¿ç”¨Minicondaçš„æ³¨æ„äº‹é¡¹</strong></strong></h3><ul><li>è¯·æ ¹æ®Podçš„æ“ä½œç³»ç»Ÿå’Œæ¶æ„è°ƒæ•´Minicondaçš„ä¸‹è½½é“¾æ¥å’Œå®‰è£…å‘½ä»¤ã€‚</li><li>ä¸ºäº†è‡ªåŠ¨åŒ–å®‰è£…å’Œé…ç½®Minicondaï¼Œè¯·å°†ç›¸å…³æ­¥éª¤å’Œç¯å¢ƒé…ç½®åŒ…å«åœ¨Podçš„åˆå§‹åŒ–è„šæœ¬æˆ–å®¹å™¨é•œåƒæ„å»ºè¿‡ç¨‹ä¸­ã€‚</li><li>è¯·åœ¨å®‰è£…å’Œä½¿ç”¨Minicondaæ—¶éµå¾ªé€‚å½“çš„æœ€ä½³å®è·µå’Œå®‰å…¨æ€§æªæ–½ï¼Œå¹¶æ ¹æ®å…·ä½“éœ€æ±‚è¿›è¡Œé…ç½®å’Œç®¡ç†ã€‚</li></ul><h3 id="2-3-å®‰è£…å’Œé…ç½®Minicondaçš„æ€»ç»“"><a href="#2-3-å®‰è£…å’Œé…ç½®Minicondaçš„æ€»ç»“" class="headerlink" title="2.3 å®‰è£…å’Œé…ç½®Minicondaçš„æ€»ç»“"></a><strong><strong>2.3 å®‰è£…å’Œé…ç½®Minicondaçš„æ€»ç»“</strong></strong></h3><p>é€šè¿‡æŒ‰ç…§æœ¬æ–‡ä¸­çš„æ­¥éª¤ï¼Œåœ¨Kubernetesä¸­å®‰è£…å’Œé…ç½®Minicondaï¼Œæ‚¨å¯ä»¥è½»æ¾ç®¡ç†Pythonç¯å¢ƒå’ŒåŒ…ï¼Œå¹¶ä¸ºæ‚¨çš„åº”ç”¨ç¨‹åºæä¾›æ‰€éœ€çš„ä¾èµ–é¡¹ã€‚Minicondaçš„çµæ´»æ€§å’Œå¯æ‰©å±•æ€§ä½¿å…¶æˆä¸ºåœ¨Kubernetesç¯å¢ƒä¸­å¼€å‘å’Œéƒ¨ç½²Pythonåº”ç”¨ç¨‹åºçš„ç†æƒ³é€‰æ‹©ã€‚</p><h2 id="III-Kubernetesæ•°æ®æ“ä½œï¼šåœ¨æœ¬åœ°Macç”µè„‘å°†æ–‡ä»¶ä¼ è¾“åˆ°Kubernetesé›†ç¾¤çš„æµç¨‹"><a href="#III-Kubernetesæ•°æ®æ“ä½œï¼šåœ¨æœ¬åœ°Macç”µè„‘å°†æ–‡ä»¶ä¼ è¾“åˆ°Kubernetesé›†ç¾¤çš„æµç¨‹" class="headerlink" title="III. Kubernetesæ•°æ®æ“ä½œï¼šåœ¨æœ¬åœ°Macç”µè„‘å°†æ–‡ä»¶ä¼ è¾“åˆ°Kubernetesé›†ç¾¤çš„æµç¨‹"></a><strong><strong>III. Kubernetesæ•°æ®æ“ä½œï¼šåœ¨æœ¬åœ°Macç”µè„‘å°†æ–‡ä»¶ä¼ è¾“åˆ°Kubernetesé›†ç¾¤çš„æµç¨‹</strong></strong></h2><p>æœ¬æ–‡ä»‹ç»äº†å¦‚ä½•åœ¨æœ¬åœ°Macç”µè„‘ä¸Šå°†æ–‡ä»¶ä¼ è¾“åˆ°Kubernetesé›†ç¾¤ä¸­çš„Podã€‚æˆ‘ä»¬ä½¿ç”¨lrzszå·¥å…·æ¥å®ç°æ–‡ä»¶çš„ä¸Šä¼ å’Œä¸‹è½½æ“ä½œã€‚</p><h3 id="3-1-æ–‡ä»¶ä¼ è¾“å‰çš„å‡†å¤‡å·¥ä½œ"><a href="#3-1-æ–‡ä»¶ä¼ è¾“å‰çš„å‡†å¤‡å·¥ä½œ" class="headerlink" title="3.1 æ–‡ä»¶ä¼ è¾“å‰çš„å‡†å¤‡å·¥ä½œ"></a><strong><strong>3.1 æ–‡ä»¶ä¼ è¾“å‰çš„å‡†å¤‡å·¥ä½œ</strong></strong></h3><ul><li>æœ¬åœ°Macç”µè„‘å·²ç»å®‰è£…äº†Homebrewã€‚</li><li>Kubernetesé›†ç¾¤å·²ç»å®‰è£…äº†lrzszå·¥å…·ã€‚</li></ul><p><strong>[åœ¨æœ¬åœ°æ‰§è¡Œ]</strong></p><ol><li><p>æ‰“å¼€ç»ˆç«¯åº”ç”¨ç¨‹åºã€‚</p></li><li><p>å®‰è£…lrzszå·¥å…·ã€‚åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p> <figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install lrzsz</span><br></pre></td></tr></tbody></table></figure></li><li><p>ç¡®ä¿Kubernetesé›†ç¾¤ä¸­å·²ç»å®‰è£…äº†lrzszå·¥å…·ã€‚åœ¨Kubernetesé›†ç¾¤ä¸­çš„ç»ˆç«¯ä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p> <figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt-get update</span><br><span class="line">apt-get install lrzsz</span><br></pre></td></tr></tbody></table></figure></li></ol><p>[<strong>åœ¨Kubernetesé›†ç¾¤ä¸­æ‰§è¡Œ]</strong></p><ol><li><p>ç™»å½•åˆ°Podçš„ç»ˆç«¯ã€‚åœ¨Kubernetesé›†ç¾¤ä¸­çš„ç»ˆç«¯ä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p> <figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl <span class="built_in">exec</span> -it &lt;pod-name&gt; -- /bin/bash</span><br></pre></td></tr></tbody></table></figure><p> å°† <code>&lt;pod-name&gt;</code> æ›¿æ¢ä¸ºç›®æ ‡Podçš„åç§°ã€‚</p></li><li><p>åœ¨Podçš„ç»ˆç«¯ä¸­ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥æ¥æ”¶æ–‡ä»¶ï¼š</p> <figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rz</span><br></pre></td></tr></tbody></table></figure><p> æ‰§è¡Œè¯¥å‘½ä»¤åï¼Œå°†å¼¹å‡ºä¸€ä¸ªæ–‡ä»¶é€‰æ‹©çª—å£ã€‚</p></li></ol><h3 id="3-2-æ–‡ä»¶ä¼ è¾“çš„å…·ä½“æ­¥éª¤"><a href="#3-2-æ–‡ä»¶ä¼ è¾“çš„å…·ä½“æ­¥éª¤" class="headerlink" title="3.2 æ–‡ä»¶ä¼ è¾“çš„å…·ä½“æ­¥éª¤"></a><strong><strong>3.2 æ–‡ä»¶ä¼ è¾“çš„å…·ä½“æ­¥éª¤</strong></strong></h3><p><strong>[åœ¨æœ¬åœ°æ‰§è¡Œ]</strong></p><ol><li><p>åœ¨æœ¬åœ°ç»ˆç«¯ä¸­ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°†æ–‡ä»¶å‘é€åˆ°Kubernetesé›†ç¾¤çš„Podï¼š<br>å°† <code>/path/to/environ.yaml</code> æ›¿æ¢ä¸º <code>environ.yaml</code> æ–‡ä»¶åœ¨æœ¬åœ°è®¡ç®—æœºä¸Šçš„è·¯å¾„ã€‚</p> <figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sz /path/to/environ.yaml</span><br></pre></td></tr></tbody></table></figure></li></ol><p><strong>[åœ¨Kubernetesé›†ç¾¤ä¸­æ‰§è¡Œ]</strong></p><ol><li>åœ¨Kubernetesé›†ç¾¤ä¸­çš„ç»ˆç«¯çš„æ–‡ä»¶é€‰æ‹©çª—å£ä¸­ï¼Œé€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶ <code>environ.yaml</code>ã€‚</li></ol><p>æ–‡ä»¶ä¼ è¾“å°†åœ¨æœ¬åœ°å’ŒKubernetesé›†ç¾¤ä¹‹é—´è¿›è¡Œï¼Œä½¿ç”¨äº†lrzszå·¥å…·çš„ä¸Šä¼ å’Œä¸‹è½½å‘½ä»¤ã€‚è¯·ç¡®ä¿åœ¨æœ¬åœ°å’ŒKubernetesé›†ç¾¤ä¸­éƒ½æŒ‰ç…§ç›¸åº”çš„æ­¥éª¤è¿›è¡Œå®‰è£…å’Œæ“ä½œï¼Œå¹¶ä½¿ç”¨æ­£ç¡®çš„å‘½ä»¤è¿›è¡Œæ–‡ä»¶ä¼ è¾“ã€‚</p><p>è¯·åœ¨è¿›è¡Œæ–‡ä»¶ä¼ è¾“æ“ä½œæ—¶ï¼Œéµå¾ªé€‚å½“çš„å®‰å…¨æ€§å’Œæœ€ä½³å®è·µï¼Œä»¥ä¿æŠ¤æ•°æ®å’Œç³»ç»Ÿçš„å®‰å…¨æ€§ã€‚</p><h2 id="IV-å¦‚ä½•æ£€æŸ¥åœ¨ç»ˆç«¯æ–­å¼€è¿æ¥å-Linux-å‘½ä»¤æ˜¯å¦ç»§ç»­æ‰§è¡Œ"><a href="#IV-å¦‚ä½•æ£€æŸ¥åœ¨ç»ˆç«¯æ–­å¼€è¿æ¥å-Linux-å‘½ä»¤æ˜¯å¦ç»§ç»­æ‰§è¡Œ" class="headerlink" title="IV. å¦‚ä½•æ£€æŸ¥åœ¨ç»ˆç«¯æ–­å¼€è¿æ¥å Linux å‘½ä»¤æ˜¯å¦ç»§ç»­æ‰§è¡Œ"></a><strong>IV. å¦‚ä½•æ£€æŸ¥åœ¨ç»ˆç«¯æ–­å¼€è¿æ¥å Linux å‘½ä»¤æ˜¯å¦ç»§ç»­æ‰§è¡Œ</strong></h2><p>åœ¨ Linux ç»ˆç«¯ä¸­è¿è¡Œå‘½ä»¤æˆ–è„šæœ¬æ—¶ï¼Œå¦‚æœç»ˆç«¯è¿æ¥æ–­å¼€ï¼Œæ‚¨å¯èƒ½ä¼šæƒ³çŸ¥é“å‘½ä»¤æˆ–è„šæœ¬æ˜¯å¦ä»åœ¨åå°æ‰§è¡Œã€‚ä»¥ä¸‹æ˜¯å‡ ç§æ–¹æ³•æ¥æ£€æŸ¥ Linux å‘½ä»¤åœ¨ç»ˆç«¯æ–­å¼€è¿æ¥åæ˜¯å¦ç»§ç»­æ‰§è¡Œã€‚</p><h3 id="4-1-æ–¹æ³•ä¸€ï¼šä½¿ç”¨-ps-å‘½ä»¤"><a href="#4-1-æ–¹æ³•ä¸€ï¼šä½¿ç”¨-ps-å‘½ä»¤" class="headerlink" title="4.1 æ–¹æ³•ä¸€ï¼šä½¿ç”¨ ps å‘½ä»¤"></a>4.1 <strong>æ–¹æ³•ä¸€ï¼šä½¿ç”¨ ps å‘½ä»¤</strong></h3><ol><li>æ‰“å¼€æ–°çš„ç»ˆç«¯çª—å£ã€‚</li><li>è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š<code>ps aux | grep &lt;å‘½ä»¤æˆ–è„šæœ¬å…³é”®è¯&gt;</code></li><li>æ£€æŸ¥è¾“å‡ºç»“æœä¸­æ˜¯å¦å­˜åœ¨ä¸å‘½ä»¤æˆ–è„šæœ¬ç›¸å…³çš„è¿›ç¨‹ã€‚å¦‚æœå­˜åœ¨ï¼Œè¡¨ç¤ºå‘½ä»¤æˆ–è„šæœ¬ä»åœ¨åå°æ‰§è¡Œã€‚</li></ol><h3 id="4-2-æ–¹æ³•äºŒï¼šä½¿ç”¨-pgrep-å‘½ä»¤"><a href="#4-2-æ–¹æ³•äºŒï¼šä½¿ç”¨-pgrep-å‘½ä»¤" class="headerlink" title="4.2 æ–¹æ³•äºŒï¼šä½¿ç”¨ pgrep å‘½ä»¤"></a>4.2 <strong>æ–¹æ³•äºŒï¼šä½¿ç”¨ pgrep å‘½ä»¤</strong></h3><ol><li>æ‰“å¼€æ–°çš„ç»ˆç«¯çª—å£ã€‚</li><li>è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š<code>pgrep -f &lt;å‘½ä»¤æˆ–è„šæœ¬å…³é”®è¯&gt;</code></li><li>æ£€æŸ¥è¾“å‡ºç»“æœä¸­æ˜¯å¦å­˜åœ¨ä¸å‘½ä»¤æˆ–è„šæœ¬ç›¸å…³çš„è¿›ç¨‹ IDã€‚å¦‚æœå­˜åœ¨ï¼Œè¡¨ç¤ºå‘½ä»¤æˆ–è„šæœ¬ä»åœ¨åå°æ‰§è¡Œã€‚</li></ol><h3 id="4-3-æ–¹æ³•ä¸‰ï¼šä½¿ç”¨æ—¥å¿—æ–‡ä»¶æˆ–è¾“å‡ºæ–‡ä»¶"><a href="#4-3-æ–¹æ³•ä¸‰ï¼šä½¿ç”¨æ—¥å¿—æ–‡ä»¶æˆ–è¾“å‡ºæ–‡ä»¶" class="headerlink" title="4.3 æ–¹æ³•ä¸‰ï¼šä½¿ç”¨æ—¥å¿—æ–‡ä»¶æˆ–è¾“å‡ºæ–‡ä»¶"></a>4.3 <strong>æ–¹æ³•ä¸‰ï¼šä½¿ç”¨æ—¥å¿—æ–‡ä»¶æˆ–è¾“å‡ºæ–‡ä»¶</strong></h3><ol><li>å¦‚æœåœ¨å‘½ä»¤æˆ–è„šæœ¬ä¸­ä½¿ç”¨äº†è¾“å‡ºé‡å®šå‘ï¼ˆå¦‚ <code>tee</code>ï¼‰ï¼Œè¯·æ£€æŸ¥æ—¥å¿—æ–‡ä»¶æˆ–è¾“å‡ºæ–‡ä»¶ã€‚</li><li>æ‰“å¼€æ–°çš„ç»ˆç«¯çª—å£ã€‚</li><li>ä½¿ç”¨ <code>tail</code> å‘½ä»¤æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶æˆ–è¾“å‡ºæ–‡ä»¶çš„æœ€åå‡ è¡Œï¼š<code>tail -n &lt;è¡Œæ•°&gt; &lt;æ–‡ä»¶è·¯å¾„&gt;</code></li><li>æ£€æŸ¥æœ€åå‡ è¡Œæ˜¯å¦åŒ…å«ä¸å‘½ä»¤æˆ–è„šæœ¬çš„è¾“å‡ºç›¸å…³çš„å†…å®¹ã€‚å¦‚æœæœ‰æ–°çš„è¾“å‡ºï¼Œè¡¨ç¤ºå‘½ä»¤æˆ–è„šæœ¬ä»åœ¨æ‰§è¡Œã€‚</li></ol><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå³ä½¿å‘½ä»¤æˆ–è„šæœ¬åœ¨ç»ˆç«¯æ–­å¼€è¿æ¥åä»åœ¨åå°æ‰§è¡Œï¼Œå¦‚æœå‘ç”Ÿé”™è¯¯æˆ–é—®é¢˜ï¼Œå®ƒä»¬å¯èƒ½ä¼šç»ˆæ­¢æˆ–åœæ­¢è¿è¡Œã€‚å› æ­¤ï¼Œè¿˜åº”æ£€æŸ¥å‘½ä»¤æˆ–è„šæœ¬æœ¬èº«æ˜¯å¦å­˜åœ¨é—®é¢˜ã€‚</p><p>æ€»ç»“ï¼š<br>é€šè¿‡ä½¿ç”¨ ps å‘½ä»¤ã€pgrep å‘½ä»¤æˆ–æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶æˆ–è¾“å‡ºæ–‡ä»¶ï¼Œæ‚¨å¯ä»¥æ£€æŸ¥åœ¨ç»ˆç«¯æ–­å¼€è¿æ¥å Linux å‘½ä»¤æ˜¯å¦ç»§ç»­æ‰§è¡Œã€‚è¿™äº›æ–¹æ³•æä¾›äº†ä¸€ç§äº†è§£å‘½ä»¤æˆ–è„šæœ¬æ˜¯å¦åœ¨åå°æŒç»­æ‰§è¡Œçš„æ–¹å¼ï¼Œä»¥ç¡®ä¿ä»»åŠ¡èƒ½å¤Ÿæ­£å¸¸è¿›è¡Œã€‚</p><h2 id="V-ä½¿ç”¨-Bash-è„šæœ¬æ‰§è¡Œ-Python-è„šæœ¬"><a href="#V-ä½¿ç”¨-Bash-è„šæœ¬æ‰§è¡Œ-Python-è„šæœ¬" class="headerlink" title="V. ä½¿ç”¨ Bash è„šæœ¬æ‰§è¡Œ Python è„šæœ¬"></a><strong>V.</strong> ä½¿ç”¨ Bash è„šæœ¬æ‰§è¡Œ Python è„šæœ¬</h2><p>æœ¬æ–‡æ¡£ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ Bash è„šæœ¬æ¥æ‰§è¡ŒæŒ‡å®šçš„ Python è„šæœ¬ï¼Œå¹¶æä¾›äº†ä¸€ä¸ªç¤ºä¾‹è„šæœ¬ã€‚è¯¥è„šæœ¬è¿˜æ¶‰åŠä½¿ç”¨ conda ç¯å¢ƒæ¥è¿è¡Œ Pythonã€‚</p><h3 id="5-1-ç®€ä»‹"><a href="#5-1-ç®€ä»‹" class="headerlink" title="5.1 ç®€ä»‹"></a>5.1 ç®€ä»‹</h3><p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ‚¨å¯èƒ½éœ€è¦åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œé•¿æ—¶é—´è¿è¡Œçš„ Python è„šæœ¬ã€‚ä¸ºäº†ç¡®ä¿æŒä¹…æ€§å¹¶æ–¹ä¾¿ç®¡ç†ï¼Œå¯ä»¥ç¼–å†™ä¸€ä¸ª Bash è„šæœ¬æ¥è¿è¡Œ Python è„šæœ¬ã€‚æœ¬æ–‡æ¡£æä¾›äº†ä¸€ä¸ªç¤ºä¾‹è„šæœ¬ï¼Œæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ Bash è„šæœ¬æ¥æ‰§è¡Œ Python è„šæœ¬ã€‚</p><h3 id="5-2-è„šæœ¬ç¤ºä¾‹"><a href="#5-2-è„šæœ¬ç¤ºä¾‹" class="headerlink" title="5. 2 è„šæœ¬ç¤ºä¾‹"></a>5. 2 è„šæœ¬ç¤ºä¾‹</h3><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ Bash è„šæœ¬ï¼Œç”¨äºæ‰§è¡Œç‰¹å®šçš„ Python è„šæœ¬ï¼Œå¹¶ä½¿ç”¨ conda ç¯å¢ƒï¼š</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰ conda ç¯å¢ƒåç§°</span></span><br><span class="line">conda_env=<span class="string">"python3.10"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¿€æ´» conda ç¯å¢ƒ</span></span><br><span class="line"><span class="built_in">source</span> activate <span class="variable">$conda_env</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰§è¡Œ Python è„šæœ¬ï¼Œå¹¶ä½¿ç”¨ tee å°†è¾“å‡ºåŒæ—¶é‡å®šå‘åˆ°æ–‡ä»¶å’Œæ§åˆ¶å°</span></span><br><span class="line">python data_gen_updated.py conversations_0607_v1_500 500 | <span class="built_in">tee</span> output.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœç”¨ conda ç¯å¢ƒ</span></span><br><span class="line">conda deactivate</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p>ä¸Šè¿°è„šæœ¬åŒ…å«ä»¥ä¸‹æ­¥éª¤ï¼š</p><ol><li>å®šä¹‰ conda ç¯å¢ƒçš„åç§°ï¼ˆæ ¹æ®éœ€è¦è¿›è¡Œä¿®æ”¹ï¼‰ã€‚</li><li>ä½¿ç”¨ <code>source activate</code> å‘½ä»¤æ¿€æ´»æŒ‡å®šçš„ conda ç¯å¢ƒã€‚</li><li>ä½¿ç”¨ <code>python</code> å‘½ä»¤æ‰§è¡Œç‰¹å®šçš„ Python è„šæœ¬ã€‚åŒæ—¶ï¼Œä½¿ç”¨ <code>tee</code> å‘½ä»¤å°†è¾“å‡ºåŒæ—¶é‡å®šå‘åˆ°æ–‡ä»¶å’Œæ§åˆ¶å°ã€‚</li><li>ä½¿ç”¨ <code>conda deactivate</code> å‘½ä»¤åœç”¨ conda ç¯å¢ƒã€‚</li></ol><h3 id="5-3-ä½¿ç”¨è„šæœ¬"><a href="#5-3-ä½¿ç”¨è„šæœ¬" class="headerlink" title="5.3 ä½¿ç”¨è„šæœ¬"></a>5.3 ä½¿ç”¨è„šæœ¬</h3><p>æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤åœ¨ç»ˆç«¯ä¸­ä½¿ç”¨è„šæœ¬ï¼š</p><ol><li><p>ä½¿ç”¨æ–‡æœ¬ç¼–è¾‘å™¨åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ï¼Œå¹¶å°†ä¸Šè¿°ç¤ºä¾‹è„šæœ¬ç²˜è´´è¿›å»ã€‚</p></li><li><p>ä¿å­˜æ–‡ä»¶å¹¶å…³é—­æ–‡æœ¬ç¼–è¾‘å™¨ã€‚</p></li><li><p>åœ¨ç»ˆç«¯ä¸­ï¼Œèµ‹äºˆè„šæœ¬æ‰§è¡Œæƒé™ï¼š</p> <figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x script.sh</span><br></pre></td></tr></tbody></table></figure></li><li><p>è¿è¡Œè„šæœ¬ï¼š</p> <figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./script.sh</span><br></pre></td></tr></tbody></table></figure></li></ol><p>ç¡®ä¿åœ¨è¿è¡Œè„šæœ¬ä¹‹å‰ï¼Œå·²æ­£ç¡®å®‰è£…å¹¶é…ç½®æ‰€éœ€çš„ conda ç¯å¢ƒï¼Œå¹¶å°†è„šæœ¬ä¸­çš„ <code>python data_gen_updated.py conversations_0607_v1_500 500</code> æ›¿æ¢ä¸ºæ‚¨è¦æ‰§è¡Œçš„å®é™…å‘½ä»¤ã€‚</p><h3 id="5-4-ç»“è®º"><a href="#5-4-ç»“è®º" class="headerlink" title="5.4 ç»“è®º"></a>5.4 ç»“è®º</h3><p>ä½¿ç”¨ Bash è„šæœ¬å¯ä»¥åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œ Python è„šæœ¬ï¼Œå¹¶æä¾›æŒä¹…æ€§å’Œç®¡ç†çµæ´»æ€§ã€‚æœ¬æ–‡æ¡£æä¾›äº†ä¸€ä¸ªç¤ºä¾‹è„šæœ¬ï¼Œå¸®åŠ©æ‚¨å¼€å§‹ä½¿ç”¨ Bash è„šæœ¬æ¥æ‰§è¡Œ Python è„šæœ¬ï¼Œå¹¶æ¼”ç¤ºäº†ä½¿ç”¨ conda ç¯å¢ƒçš„æ–¹æ³•ã€‚æ ¹æ®æ‚¨çš„å®é™…éœ€æ±‚ï¼Œå¯ä»¥ä¿®æ”¹å’Œè°ƒæ•´è„š</p>]]></content>
      
      
      <categories>
          
          <category> Tech Toolbox </category>
          
      </categories>
      
      
        <tags>
            
            <tag> K8s </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GitLog</title>
      <link href="/2023/05/23/Tech%20Toolbox/GitLog/"/>
      <url>/2023/05/23/Tech%20Toolbox/GitLog/</url>
      
        <content type="html"><![CDATA[<h1 id="Git-Log"><a href="#Git-Log" class="headerlink" title="Git Log"></a>Git Log</h1><p>å½“ä½¿ç”¨Gitè¿›è¡Œç‰ˆæœ¬æ§åˆ¶æ—¶ï¼Œ**<code>git log</code>**å‘½ä»¤æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„å·¥å…·ï¼Œå®ƒå¯ä»¥æ˜¾ç¤ºæäº¤å†å²è®°å½•å’Œåˆ†æ”¯ä¹‹é—´çš„å…³ç³»ã€‚</p><h3 id="åŸºæœ¬ç”¨æ³•"><a href="#åŸºæœ¬ç”¨æ³•" class="headerlink" title="åŸºæœ¬ç”¨æ³•"></a>åŸºæœ¬ç”¨æ³•</h3><p>åœ¨ç»ˆç«¯æˆ–å‘½ä»¤è¡Œä¸­ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ ¼å¼æ¥è°ƒç”¨<code>git log</code>ï¼š</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span></span><br></pre></td></tr></tbody></table></figure><p>è¿™å°†æ˜¾ç¤ºåŒ…å«æ‰€æœ‰æäº¤å†å²è®°å½•çš„åˆ—è¡¨ï¼Œæœ€æ–°çš„æäº¤æ˜¾ç¤ºåœ¨æœ€ä¸Šé¢ã€‚</p><h3 id="é™åˆ¶è¾“å‡º"><a href="#é™åˆ¶è¾“å‡º" class="headerlink" title="é™åˆ¶è¾“å‡º"></a>é™åˆ¶è¾“å‡º</h3><p><code>git log</code>æä¾›äº†ä¸€äº›é€‰é¡¹æ¥é™åˆ¶è¾“å‡ºï¼Œä»¥æ»¡è¶³ä¸åŒçš„éœ€æ±‚ã€‚</p><ul><li><code>-oneline</code>ï¼šä»¥ç´§å‡‘çš„ä¸€è¡Œæ‘˜è¦å½¢å¼æ˜¾ç¤ºæäº¤å†å²è®°å½•ã€‚</li></ul><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span> --oneline</span><br></pre></td></tr></tbody></table></figure><ul><li><code>-decorate</code>ï¼šåœ¨è¾“å‡ºä¸­æ˜¾ç¤ºåˆ†æ”¯å’Œæ ‡ç­¾çš„å¼•ç”¨åç§°ã€‚</li></ul><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git log --decorate</span><br></pre></td></tr></tbody></table></figure><ul><li><code>-graph</code>ï¼šä½¿ç”¨å›¾å½¢è¡¨ç¤ºæ³•å±•ç¤ºåˆ†æ”¯å’Œåˆå¹¶çš„å…³ç³»ã€‚</li></ul><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span> --graph</span><br></pre></td></tr></tbody></table></figure><p>å¯ä»¥å°†è¿™äº›é€‰é¡¹ç»„åˆåœ¨ä¸€èµ·ä½¿ç”¨ï¼š</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span> --oneline --decorate --graph</span><br></pre></td></tr></tbody></table></figure><p>å½“æ‚¨è¡Œ <strong><code>git log --oneline --decorate --graph</code></strong> å‘½ä»¤æ—¶ï¼Œè¾“å‡ºç»“æœä¼šä»¥ä¸€ç§ç´§å‡‘ã€å›¾å½¢åŒ–çš„æ–¹å¼æ˜¾ç¤ºæäº¤å†å²è®°å½•å’Œåˆ†æ”¯ä¹‹é—´çš„å…³ç³»ã€‚ä¸‹é¢æ˜¯å¯¹è¾“å‡ºç»“æœä¸­æ¯ä¸ªéƒ¨åˆ†çš„è§£é‡Šï¼š</p><ol><li>Commit Hashï¼ˆæäº¤å“ˆå¸Œå€¼ï¼‰ï¼šæ¯ä¸ªæäº¤çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œé€šå¸¸ä½¿ç”¨çŸ­çš„å“ˆå¸Œå€¼ã€‚è¿™äº›å“ˆå¸Œå€¼æ˜¯æäº¤çš„ç‹¬ç‰¹æ ‡è¯†ï¼Œå¯ä»¥ç”¨æ¥å¼•ç”¨å’Œæ£€ç´¢ç‰¹å®šçš„æäº¤ã€‚</li><li>Commit Messageï¼ˆæäº¤æ¶ˆæ¯ï¼‰ï¼šæäº¤æ—¶è¾“å…¥çš„æè¿°æ€§æ¶ˆæ¯ï¼Œç”¨äºè¯´æ˜è¯¥æäº¤æ‰€åšçš„æ›´æ”¹å’Œç›®çš„ã€‚</li><li>Branches and Tagsï¼ˆåˆ†æ”¯å’Œæ ‡ç­¾ï¼‰ï¼šæ˜¾ç¤ºå½“å‰æäº¤æ‰€åœ¨çš„åˆ†æ”¯å’Œç›¸å…³æ ‡ç­¾çš„å¼•ç”¨åç§°ã€‚è¿™äº›å¼•ç”¨åç§°æ˜¾ç¤ºåœ¨æäº¤å“ˆå¸Œå€¼åçš„æ‹¬å·å†…ï¼Œä»¥åŠåœ¨åˆ†æ”¯å’Œæ ‡ç­¾ä¹‹å‰çš„è£…é¥°ç¬¦ **<code>decorate</code>**ã€‚</li><li>Graphical Representationï¼ˆå›¾å½¢è¡¨ç¤ºï¼‰ï¼šä½¿ç”¨å­—ç¬¦ï¼ˆå¦‚æ–œçº¿ã€åæ–œçº¿ã€ç«–çº¿å’Œæ˜Ÿå·ï¼‰è¡¨ç¤ºåˆ†æ”¯å’Œåˆå¹¶çš„å…³ç³»ã€‚è¿™éƒ¨åˆ†ä½¿ç”¨å›¾å½¢è¡¨ç¤ºæ³•å±•ç¤ºäº†æäº¤å†å²è®°å½•ä¸­ä¸åŒåˆ†æ”¯çš„å‘å±•å’Œåˆå¹¶æƒ…å†µã€‚æ–œçº¿ï¼ˆ/ï¼‰å’Œåæ–œçº¿ï¼ˆ\ï¼‰è¡¨ç¤ºåˆ†æ”¯çš„å‘å±•ï¼Œç«–çº¿ï¼ˆ|ï¼‰è¡¨ç¤ºåˆ†æ”¯çš„åˆ†å‰ï¼Œæ˜Ÿå·ï¼ˆ*ï¼‰è¡¨ç¤ºåˆå¹¶ç‚¹ã€‚</li></ol><p>å‘½ä»¤çš„è¾“å‡ºç»“æœå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è¿›è¡Œé˜…è¯»ï¼š</p><ol><li>æ¯è¡Œè¡¨ç¤ºä¸€ä¸ªæäº¤ï¼ŒåŒ…å«ç®€çŸ­çš„æäº¤å“ˆå¸Œå€¼å’Œæäº¤æ¶ˆæ¯ã€‚ä¾‹å¦‚ï¼š**<code>579ac2d Resolved merge conflicts with master branch</code>**ã€‚</li><li>åˆ†æ”¯å’Œæ ‡ç­¾çš„å¼•ç”¨åç§°æ˜¾ç¤ºåœ¨æ¯ä¸ªæäº¤çš„åé¢ã€‚å®ƒä»¬ç”¨æ‹¬å·æ‹¬èµ·æ¥ï¼Œå¹¶åœ¨å¼•ç”¨åç§°å‰åŠ ä¸Š <strong><code>tag:</code></strong> æˆ– <strong><code>HEAD -&gt;</code></strong> çš„æ ‡è¯†ç¬¦ã€‚ä¾‹å¦‚ï¼š**<code>(HEAD -&gt; huiyu/product_search_similarity_test, origin/huiyu/product_search_similarity_test)</code>** è¡¨ç¤ºå½“å‰æ‰€åœ¨çš„åˆ†æ”¯å’Œè¿œç¨‹åˆ†æ”¯ã€‚</li><li>å›¾å½¢è¡¨ç¤ºæ³•å±•ç¤ºäº†åˆ†æ”¯å’Œåˆå¹¶çš„å…³ç³»ã€‚åˆå¹¶æäº¤æ˜¾ç¤ºä¸ºä¸€ä¸ªæˆ–å¤šä¸ªåˆ†æ”¯åˆå¹¶åœ¨ä¸€èµ·çš„çº¿æ¡ã€‚ä¾‹å¦‚ï¼Œ**<code>\</code>** å’Œ <strong><code>/</code></strong> å­—ç¬¦è¡¨ç¤ºä¸åŒçš„åˆ†æ”¯åˆå¹¶ã€‚**<code>|</code>** å­—ç¬¦è¡¨ç¤ºåˆ†æ”¯çš„åˆ†å‰ã€‚è¿™ç§å›¾å½¢è¡¨ç¤ºæ³•å¯ä»¥å¸®åŠ©æ‚¨ç†è§£æäº¤å†å²ä¸­ä¸åŒåˆ†æ”¯ä¹‹é—´çš„å…³ç³»ã€‚</li></ol><p>é€šè¿‡é˜…è¯»è¿™äº›è¾“å‡ºç»“æœï¼Œæ‚¨å¯ä»¥äº†è§£æ¯ä¸ªæäº¤çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬æäº¤å“ˆå¸Œå€¼ã€æäº¤æ¶ˆæ¯ã€åˆ†æ”¯å’Œæ ‡ç­¾çš„å¼•ç”¨åç§°ï¼Œä»¥åŠåˆ†æ”¯å’Œåˆå¹¶çš„å…³ç³»ã€‚è¿™æœ‰åŠ©äºæ‚¨è·Ÿè¸ªä»£ç çš„å‘å±•å†ç¨‹ã€åˆ†æ”¯çš„åˆå¹¶æƒ…å†µä»¥åŠä¸åŒåˆ†æ”¯ä¹‹é—´çš„å…³ç³»ã€‚</p><h3 id="è¿‡æ»¤å’Œæ’åºæäº¤"><a href="#è¿‡æ»¤å’Œæ’åºæäº¤" class="headerlink" title="è¿‡æ»¤å’Œæ’åºæäº¤"></a>è¿‡æ»¤å’Œæ’åºæäº¤</h3><p>æ‚¨å¯ä»¥ä½¿ç”¨ä¸€äº›é€‰é¡¹æ¥è¿‡æ»¤å’Œæ’åºæäº¤å†å²è®°å½•ã€‚</p><ul><li><code>-author=&lt;author&gt;</code>ï¼šä»…æ˜¾ç¤ºç‰¹å®šä½œè€…çš„æäº¤å†å²è®°å½•ã€‚</li></ul><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span> --author=John</span><br></pre></td></tr></tbody></table></figure><ul><li><code>-since=&lt;date&gt;</code>ï¼šä»…æ˜¾ç¤ºæŒ‡å®šæ—¥æœŸä¹‹åçš„æäº¤å†å²è®°å½•ã€‚</li></ul><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span> --since=<span class="string">"2023-01-01"</span></span><br></pre></td></tr></tbody></table></figure><ul><li><code>-until=&lt;date&gt;</code>ï¼šä»…æ˜¾ç¤ºæŒ‡å®šæ—¥æœŸä¹‹å‰çš„æäº¤å†å²è®°å½•ã€‚</li></ul><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span> --<span class="keyword">until</span>=<span class="string">"2023-02-01"</span></span><br></pre></td></tr></tbody></table></figure><ul><li><code>-grep=&lt;pattern&gt;</code>ï¼šä»…æ˜¾ç¤ºåŒ…å«æŒ‡å®šæ¨¡å¼çš„æäº¤æ¶ˆæ¯ã€‚</li></ul><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span> --grep=<span class="string">"bug fix"</span></span><br></pre></td></tr></tbody></table></figure><ul><li><code>-follow &lt;file&gt;</code>ï¼šè·Ÿè¸ªæŒ‡å®šæ–‡ä»¶çš„æ”¹åŠ¨å†å²è®°å½•ã€‚</li></ul><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span> --follow file.txt</span><br></pre></td></tr></tbody></table></figure><ul><li><code>-reverse</code>ï¼šæŒ‰ç…§æäº¤æ—¶é—´çš„é€†åºæ˜¾ç¤ºæäº¤å†å²è®°å½•ã€‚</li></ul><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span> --reverse</span><br></pre></td></tr></tbody></table></figure><h3 id="åˆ†æ”¯å’Œæ ‡ç­¾"><a href="#åˆ†æ”¯å’Œæ ‡ç­¾" class="headerlink" title="åˆ†æ”¯å’Œæ ‡ç­¾"></a>åˆ†æ”¯å’Œæ ‡ç­¾</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>git log</code>æ˜¾ç¤ºæ‰€æœ‰åˆ†æ”¯çš„æäº¤å†å²è®°å½•ã€‚æ‚¨è¿˜å¯ä»¥æŒ‡å®šç‰¹å®šçš„åˆ†æ”¯æˆ–æ ‡ç­¾ã€‚</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span> &lt;branch-name&gt;</span><br></pre></td></tr></tbody></table></figure><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span> &lt;tag-name&gt;</span><br></pre></td></tr></tbody></table></figure><h3 id="å…¶ä»–é€‰é¡¹"><a href="#å…¶ä»–é€‰é¡¹" class="headerlink" title="å…¶ä»–é€‰é¡¹"></a>å…¶ä»–é€‰é¡¹</h3><p><code>git log</code>å‘½ä»¤è¿˜æä¾›å…¶ä»–ä¸€äº›æœ‰ç”¨çš„é€‰é¡¹ï¼Œä¾‹å¦‚ï¼š</p><ul><li><code>-stat</code>ï¼šæ˜¾ç¤ºæ¯ä¸ªæäº¤çš„ç®€è¦ç»Ÿè®¡ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ”¹åŠ¨çš„æ–‡ä»¶å’Œæ’å…¥/åˆ é™¤çš„è¡Œæ•°ã€‚</li></ul><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span> --<span class="built_in">stat</span></span><br></pre></td></tr></tbody></table></figure><ul><li><code>-pretty=&lt;format&gt;</code>ï¼šä½¿ç”¨è‡ªå®šä¹‰çš„è¾“å‡ºæ ¼å¼æ˜¾ç¤ºæäº¤å†å²è®°å½•ã€‚</li></ul><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span> --pretty=format:<span class="string">"%h - %an, %ar : %s"</span></span><br></pre></td></tr></tbody></table></figure><ul><li><code>-graph</code>å’Œ<code>-oneline</code>å¯ä»¥ä¸å…¶ä»–é€‰é¡¹ç»„åˆä½¿ç”¨ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> Tech Toolbox </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>FAISSå‘é‡æŸ¥è¯¢ç®€ä»‹</title>
      <link href="/2023/02/23/Code%20Chronicles/FAISS%E5%90%91%E9%87%8F%E6%9F%A5%E8%AF%A2%E7%AE%80%E4%BB%8B/"/>
      <url>/2023/02/23/Code%20Chronicles/FAISS%E5%90%91%E9%87%8F%E6%9F%A5%E8%AF%A2%E7%AE%80%E4%BB%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="Faiss"><a href="#Faiss" class="headerlink" title="Faiss"></a>Faiss</h1><h2 id="Install"><a href="#Install" class="headerlink" title="Install"></a>Install</h2><ul><li>æ”¯æŒ CUDA çš„ Linux ï¼š<br><code>conda install -c pytorch faiss-gpu</code></li><li>å…¶ä»–ï¼š<br><code>conda install -c pytorch faiss-cpu</code></li></ul><h2 id="IndexFlatL2"><a href="#IndexFlatL2" class="headerlink" title="IndexFlatL2"></a><strong><strong>IndexFlatL2</strong></strong></h2><p><strong>IndexFlatL2</strong><br>æµ‹é‡æŸ¥è¯¢å‘é‡ä¸åŠ è½½åˆ°ç´¢å¼•ä¸­çš„å‘é‡ä¹‹é—´æ‰€æœ‰ç»™å®šç‚¹ä¹‹é—´çš„ L2ï¼ˆæˆ–æ¬§å‡ é‡Œå¾—ï¼‰è·ç¦»ã€‚å®ƒå¾ˆç®€å•ï¼Œéå¸¸å‡†ç¡®ï¼Œä½†ä¹Ÿä¸ä¼šå¤ªå¿«ã€‚</p><p>ç»™å®šä¸€ç»„ç»´åº¦ä¸º$d$çš„å‘é‡${ x_1,â€¦, x_n }$ï¼ŒFaissåœ¨Ramä¸­æ„æ¶ä¸€ä¸ªæ•°æ®ç»“æ„â€”â€”<code>index</code> ï¼Œæ„é€ å®Œç»“æ„åï¼Œå½“ç»™å®šä¸€ä¸ªæ–°çš„ç»´åº¦ä¸º$d$å‘é‡$x$æ—¶ï¼Œå¯ä»¥é«˜æ•ˆçš„æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p><p>$$<br>i = \mathrm{argmin}_i || x - x_i ||<br>$$</p><p>å…¶ä¸­$||.||$è¡¨ç¤ºæ¬§æ°ï¼ˆEuclidean distanceï¼‰è·ç¦»ï¼ˆL2ï¼‰</p><p>ç”¨ Faiss æœ¯è¯­æ¥è¯´ï¼Œæ•°æ®ç»“æ„æ˜¯ä¸€ä¸ª*<code>index</code><em>ï¼Œ<code>index</code> æ˜¯ä¸€ä¸ªå…·æœ‰</em><code>addæ–¹æ³•</code>çš„å¯¹è±¡ã€‚*addå¯ä»¥ç”¨äºæ·»åŠ  <code>x_i</code>å‘é‡ã€‚è¯·æ³¨æ„ï¼Œå‡å®š <code>x_i</code>æ˜¯å›ºå®šçš„ã€‚</p><img src="/2023/02/23/Code%20Chronicles/FAISS%E5%90%91%E9%87%8F%E6%9F%A5%E8%AF%A2%E7%AE%80%E4%BB%8B/faiss1.png" class=""><p>åœ¨ Python ä¸­ï¼Œæˆ‘ä»¬ä¼šIndexFlatL2ç”¨æˆ‘ä»¬çš„å‘é‡ç»´åº¦ï¼ˆ768â€”â€”æˆ‘ä»¬å¥å­åµŒå…¥çš„è¾“å‡ºå¤§å°ï¼‰åˆå§‹åŒ–æˆ‘ä»¬çš„ç´¢å¼•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> faiss</span><br><span class="line">d=sentence_embeddings.shape[<span class="number">1</span>]</span><br><span class="line"><span class="comment"># &gt;&gt; d=768</span></span><br><span class="line">index = faiss.IndexFlatL2(d)</span><br><span class="line">index.is_trained</span><br><span class="line"><span class="comment"># &gt;&gt; True</span></span><br></pre></td></tr></tbody></table></figure><p>é€šå¸¸ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„ç´¢å¼•éœ€è¦æˆ‘ä»¬åœ¨åŠ è½½æ•°æ®ä¹‹å‰å¯¹å…¶è¿›è¡Œè®­ç»ƒã€‚</p><p>åœ¨ Faiss ä¸­ï¼Œ**<code>Index</code>** æ˜¯å»ºç«‹åœ¨å‘é‡æ•°æ®é›†ä¸Šçš„ç´¢å¼•ç»“æ„ï¼Œç”¨äºæ”¯æŒåœ¨å‘é‡æ•°æ®é›†ä¸­è¿›è¡Œå¿«é€Ÿç›¸ä¼¼æ€§æœç´¢ã€‚**<code>is_trained</code>** æ˜¯ <strong><code>Index</code></strong> ç±»çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºæ£€æŸ¥ç´¢å¼•ç»“æ„æ˜¯å¦å·²ç»è¢«è®­ç»ƒï¼ˆå³åˆå§‹åŒ–ï¼‰ã€‚</p><p>å¦‚æœ <strong><code>index.is_trained</code></strong> è¿”å› Trueï¼Œåˆ™è¡¨ç¤ºç´¢å¼•å·²ç»è¢«è®­ç»ƒå¹¶å·²ç»å‡†å¤‡å¥½æ¥å—æŸ¥è¯¢ã€‚æ¢å¥è¯è¯´ï¼Œè¿™æ„å‘³ç€ç´¢å¼•ç»“æ„å·²ç»è¢«åˆå§‹åŒ–ï¼Œå¯ä»¥å¯¹å…¶è¿›è¡Œè¯»å–ã€æ·»åŠ æˆ–åˆ é™¤å‘é‡ï¼Œå¹¶ä½¿ç”¨å®ƒæ‰§è¡Œç›¸ä¼¼æ€§æœç´¢æ“ä½œã€‚å¦‚æœ <strong><code>index.is_trained</code></strong> è¿”å› Falseï¼Œåˆ™è¡¨ç¤ºç´¢å¼•å°šæœªè¢«è®­ç»ƒï¼Œå¹¶ä¸”éœ€è¦ä½¿ç”¨å‘é‡æ•°æ®é›†è¿›è¡Œåˆå§‹åŒ–æ‰èƒ½è¿›è¡ŒæŸ¥è¯¢æ“ä½œã€‚</p><p>å‡†å¤‡å°±ç»ªåï¼Œæˆ‘ä»¬åŠ è½½æˆ‘ä»¬çš„åµŒå…¥å’ŒæŸ¥è¯¢ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">index.add(sentence_embeddings)</span><br><span class="line">index.ntotal</span><br></pre></td></tr></tbody></table></figure><p><strong><code>add()</code></strong> æ˜¯ <strong><code>Index</code></strong> ç±»çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºå°†å‘é‡æ•°æ®æ·»åŠ åˆ°ç´¢å¼•ä¸­ã€‚**<code>sentence_embeddings</code>** æ˜¯ä¸€ä¸ªåŒ…å«å‘é‡çš„æ•°ç»„ï¼Œæ¯ä¸ªå‘é‡å¯¹åº”ä¸€ä¸ªå¥å­çš„åµŒå…¥ã€‚</p><p><strong><code>index.ntotal</code></strong> æ˜¯ <strong><code>Index</code></strong> ç±»çš„å¦ä¸€ä¸ªå±æ€§ï¼Œç”¨äºè¿”å›å½“å‰ç´¢å¼•ä¸­åŒ…å«çš„å‘é‡æ•°é‡ã€‚åœ¨ä½¿ç”¨ <strong><code>add()</code></strong> æ–¹æ³•å°† <strong><code>sentence_embeddings</code></strong> ä¸­çš„å‘é‡æ·»åŠ åˆ°ç´¢å¼•ä¸­åï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨ <strong><code>index.ntotal</code></strong> æ–¹æ³•æ¥è·å–ç´¢å¼•ä¸­å·²åŒ…å«çš„å‘é‡æ•°é‡ã€‚è¿™å¯ä»¥ç”¨äºæ£€æŸ¥ç´¢å¼•æ˜¯å¦å·²æ­£ç¡®åœ°æ·»åŠ æ‰€æœ‰å‘é‡ã€‚</p><p>ä¾‹å¦‚ï¼Œå¦‚æœ <strong><code>sentence_embeddings</code></strong> ä¸­æœ‰100ä¸ªå¥å­çš„åµŒå…¥å‘é‡ï¼Œå¹¶ä¸”è¿™äº›å‘é‡å·²é€šè¿‡ <strong><code>add()</code></strong> æ–¹æ³•æ·»åŠ åˆ°ç´¢å¼•ä¸­ï¼Œåˆ™ <strong><code>index.ntotal</code></strong> æ–¹æ³•å°†è¿”å›100ï¼Œè¡¨ç¤ºç´¢å¼•ä¸­ç°åœ¨åŒ…å«100ä¸ªå‘é‡ã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">k = <span class="number">4</span></span><br><span class="line">xq = model.encode([<span class="string">"Someone sprints with a football"</span>])</span><br></pre></td></tr></tbody></table></figure><p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œ**<code>k</code>** æ˜¯ä¸€ä¸ªæ•´æ•°å˜é‡ï¼Œè¡¨ç¤ºåœ¨è¿›è¡Œç›¸ä¼¼æ€§æœç´¢æ—¶è¦è¿”å›çš„æœ€è¿‘é‚»å‘é‡çš„æ•°é‡ã€‚åœ¨ Faiss ä¸­ï¼Œç›¸ä¼¼æ€§æœç´¢å¯ä»¥ä½¿ç”¨ <strong><code>Index</code></strong> ç±»çš„ <strong><code>search()</code></strong> æ–¹æ³•æ¥å®Œæˆï¼Œè¯¥æ–¹æ³•å°†æŸ¥è¯¢å‘é‡ä½œä¸ºè¾“å…¥ï¼Œå¹¶è¿”å›ä¸å…¶æœ€ç›¸ä¼¼çš„ <strong><code>k</code></strong> ä¸ªå‘é‡ã€‚</p><p>å¦å¤–ï¼Œ**<code>model.encode(["Someone sprints with a football"])</code>** æ˜¯ç”¨æ¥è®¡ç®—è¾“å…¥å¥å­çš„åµŒå…¥å‘é‡çš„æ–¹æ³•è°ƒç”¨ã€‚è¿™ä¸ªæ–¹æ³•ä½¿ç”¨é¢„å…ˆè®­ç»ƒå¥½çš„æ¨¡å‹å°†è¾“å…¥çš„å¥å­è½¬æ¢ä¸ºä¸€ä¸ªå‘é‡è¡¨ç¤ºï¼Œè¯¥å‘é‡è¡¨ç¤ºåŒ…å«è¾“å…¥å¥å­çš„è¯­ä¹‰ä¿¡æ¯ã€‚</p><p>å› æ­¤ï¼Œå°†ä¸Šè¿°ä»£ç ä¸­çš„ä¸¤ä¸ªéƒ¨åˆ†ç»“åˆèµ·æ¥ï¼Œå¯ä»¥å¾—åˆ°ä¸€ä¸ªæŸ¥è¯¢å‘é‡ **<code>xq</code>**ï¼Œå®ƒè¡¨ç¤ºå¥å­ â€œSomeone sprints with a footballâ€ çš„åµŒå…¥å‘é‡ã€‚ç„¶åï¼Œå¯ä»¥ä½¿ç”¨ <strong><code>Index</code></strong> ç±»çš„ <strong><code>search()</code></strong> æ–¹æ³•æ¥æŸ¥æ‰¾ä¸ <strong><code>xq</code></strong> æœ€ç›¸ä¼¼çš„ <strong><code>k</code></strong> ä¸ªå‘é‡ï¼Œå¹¶è¿”å›è¿™äº›å‘é‡çš„ç´¢å¼•åˆ—è¡¨å’Œç›¸ä¼¼åº¦å¾—åˆ†åˆ—è¡¨ã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">%%time</span><br><span class="line">D, I = index.search(xq, k)  <span class="comment"># search</span></span><br><span class="line"><span class="built_in">print</span>(I)</span><br></pre></td></tr></tbody></table></figure><p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œ**<code>%%time</code>** æ˜¯ Jupyter Notebook ä¸­çš„ä¸€ç§é­”æœ¯å‘½ä»¤ï¼Œç”¨äºæµ‹é‡ä»£ç å•å…ƒæ ¼çš„è¿è¡Œæ—¶é—´ã€‚**<code>D</code>** å’Œ <strong><code>I</code></strong> æ˜¯åœ¨ä½¿ç”¨ <strong><code>Index</code></strong> ç±»çš„ <strong><code>search()</code></strong> æ–¹æ³•è¿›è¡Œç›¸ä¼¼æ€§æœç´¢æ—¶è¿”å›çš„ä¸¤ä¸ªç»“æœã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œ**<code>D</code>** æ˜¯ä¸€ä¸ªåŒ…å«ç›¸ä¼¼åº¦å¾—åˆ†çš„æ•°ç»„ï¼Œè¡¨ç¤ºæŸ¥è¯¢å‘é‡ <strong><code>xq</code></strong> ä¸æ£€ç´¢åˆ°çš„ <strong><code>k</code></strong> ä¸ªæœ€ç›¸ä¼¼å‘é‡ä¹‹é—´çš„ç›¸ä¼¼åº¦ã€‚**<code>I</code>** æ˜¯ä¸€ä¸ªåŒ…å«ç›¸åº”å‘é‡çš„ç´¢å¼•çš„æ•°ç»„ï¼Œè¡¨ç¤ºä¸æŸ¥è¯¢å‘é‡ <strong><code>xq</code></strong> æœ€ç›¸ä¼¼çš„ <strong><code>k</code></strong> ä¸ªå‘é‡åœ¨ç´¢å¼•æ•°æ®é›†ä¸­çš„ç´¢å¼•ä½ç½®ã€‚</p><p>å› æ­¤ï¼Œå°†ä¸Šè¿°ä»£ç ä¸­çš„ä¸¤ä¸ªéƒ¨åˆ†ç»“åˆèµ·æ¥ï¼Œå¯ä»¥ä½¿ç”¨ **<code>Index</code>**ç±»çš„ **<code>search()</code>**æ–¹æ³•åœ¨ç´¢å¼•ä¸­æŸ¥æ‰¾ä¸æŸ¥è¯¢å‘é‡ **<code>xq</code>**æœ€ç›¸ä¼¼çš„ **<code>k</code>**ä¸ªå‘é‡ï¼Œå¹¶è¿”å›è¿™äº›å‘é‡çš„ç´¢å¼•åˆ—è¡¨å’Œç›¸ä¼¼åº¦å¾—åˆ†åˆ—è¡¨ã€‚ç„¶åï¼Œä½¿ç”¨ **<code>print(I)</code>**æ¥è¾“å‡ºæ£€ç´¢åˆ°çš„æœ€ç›¸ä¼¼çš„å‘é‡çš„ç´¢å¼•åˆ—è¡¨ã€‚ç”±äº **<code>%time</code>**é­”æœ¯å‘½ä»¤è¢«ä½¿ç”¨ï¼Œè¯¥ä»£ç å•å…ƒæ ¼è¿˜ä¼šæ‰“å°å‡ºè¯¥ä»£ç å•å…ƒæ ¼çš„æ‰§è¡Œæ—¶é—´ã€‚</p><h2 id="Partitioning-The-Index"><a href="#Partitioning-The-Index" class="headerlink" title="Partitioning The Index"></a><strong><strong>Partitioning The Index</strong></strong></h2><p>Faiss å…è®¸æˆ‘ä»¬æ·»åŠ å¤šä¸ªæ­¥éª¤ï¼Œè¿™äº›æ­¥éª¤å¯ä»¥ä½¿ç”¨è®¸å¤šä¸åŒçš„æ–¹æ³•ä¼˜åŒ–æˆ‘ä»¬çš„æœç´¢ã€‚<br>ä¸€ç§æµè¡Œçš„æ–¹æ³•æ˜¯å°†ç´¢å¼•åˆ’åˆ†ä¸º Voronoi å•å…ƒ</p><img src="/2023/02/23/Code%20Chronicles/FAISS%E5%90%91%E9%87%8F%E6%9F%A5%E8%AF%A2%E7%AE%80%E4%BB%8B/faiss2.png" class=""><p>æˆ‘ä»¬å¯ä»¥å°†æˆ‘ä»¬çš„å‘é‡æƒ³è±¡æˆæ¯ä¸ªå‘é‡éƒ½åŒ…å«åœ¨ä¸€ä¸ª Voronoi å•å…ƒä¸­â€”â€”å½“æˆ‘ä»¬å¼•å…¥ä¸€ä¸ªæ–°çš„æŸ¥è¯¢å‘é‡æ—¶ï¼Œæˆ‘ä»¬é¦–å…ˆæµ‹é‡å®ƒçš„è´¨å¿ƒä¹‹é—´çš„è·ç¦»ï¼Œç„¶åå°†æˆ‘ä»¬çš„æœç´¢èŒƒå›´é™åˆ¶åœ¨è¯¥è´¨å¿ƒçš„å•å…ƒå†…ã€‚</p><p>ä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œæˆ‘ä»¬å°†è·å–ä¸€ä¸ªæŸ¥è¯¢å‘é‡xqï¼Œè¯†åˆ«å®ƒæ‰€å±çš„å•å…ƒæ ¼ï¼Œç„¶åä½¿ç”¨æˆ‘ä»¬çš„IndexFlatL2ï¼ˆæˆ–å¦ä¸€ä¸ªåº¦é‡ï¼‰åœ¨æŸ¥è¯¢å‘é‡å’Œå±äºè¯¥ç‰¹å®šå•å…ƒæ ¼çš„æ‰€æœ‰å…¶ä»–å‘é‡ä¹‹é—´è¿›è¡Œæœç´¢ã€‚</p><p>å› æ­¤ï¼Œæˆ‘ä»¬æ­£åœ¨ç¼©å°æœç´¢èŒƒå›´ï¼Œç”Ÿæˆä¸€ä¸ªè¿‘ä¼¼ç­”æ¡ˆï¼Œè€Œä¸æ˜¯ç²¾ç¡®ç­”æ¡ˆï¼ˆé€šè¿‡è¯¦å°½æœç´¢å¾—å‡ºï¼‰ã€‚</p><p>ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬é¦–å…ˆåˆå§‹åŒ–æˆ‘ä»¬çš„ç´¢å¼•IndexFlatL2â€”â€”ä½†è¿™æ¬¡ï¼Œæˆ‘ä»¬ä½¿ç”¨ L2 ç´¢å¼•ä½œä¸ºé‡åŒ–å™¨æ­¥éª¤â€”â€”æˆ‘ä»¬å°†å…¶è¾“å…¥åˆ†åŒºç´¢å¼•IndexIVFFlatã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nlist = <span class="number">50</span>  <span class="comment"># how many cells</span></span><br><span class="line">quantizer = faiss.IndexFlatL2(d)</span><br><span class="line">index = faiss.IndexIVFFlat(quantizer, d, nlist)</span><br></pre></td></tr></tbody></table></figure><p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œ<code>nlist</code> æ˜¯ä¸€ä¸ªæ•´æ•°å˜é‡ï¼Œç”¨äºæŒ‡å®š IVFï¼ˆinverted fileï¼‰ç´¢å¼•ä¸­å­˜å‚¨çš„èšç±»ä¸­å¿ƒæ•°ï¼Œå³å°†æ•°æ®é›†åˆ’åˆ†ä¸ºå¤šå°‘ä¸ªå­é›†ã€‚<code>quantizer</code> æ˜¯ä¸€ä¸ª Faiss ç´¢å¼•å¯¹è±¡ï¼Œç”¨äºå°†å‘é‡åˆ†é…åˆ° IVF ç´¢å¼•çš„å­é›†ä¸­ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨äº† Faiss æä¾›çš„ <code>IndexFlatL2</code> ç±»å‹ä½œä¸º <code>quantizer</code>ï¼Œå®ƒä½¿ç”¨æ¬§å‡ é‡Œå¾—è·ç¦»åº¦é‡æ¥è®¡ç®—å‘é‡ä¹‹é—´çš„ç›¸ä¼¼åº¦ï¼Œå¹¶å°†å‘é‡å­˜å‚¨åœ¨ä¸€ä¸ªå¹³é¢çš„ç´¢å¼•ç»“æ„ä¸­ã€‚</p><p>å¦å¤–ï¼Œ<code>d</code> æ˜¯ä¸€ä¸ªæ•´æ•°å˜é‡ï¼Œè¡¨ç¤ºåµŒå…¥å‘é‡çš„ç»´åº¦å¤§å°ã€‚è¿™ä¸ªå€¼æ˜¯æ ¹æ®é¢„è®­ç»ƒçš„æ¨¡å‹å’ŒåµŒå…¥å‘é‡çš„ç‰¹å¾ç»´åº¦ç¡®å®šçš„ã€‚</p><p>æœ€åï¼Œ<code>index</code> æ˜¯ä¸€ä¸ª Faiss ç´¢å¼•å¯¹è±¡ï¼Œç”¨äºæ”¯æŒåœ¨å‘é‡æ•°æ®é›†ä¸­è¿›è¡Œå¿«é€Ÿç›¸ä¼¼æ€§æœç´¢ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨äº† <code>IndexIVFFlat</code> ç±»å‹ä½œä¸º <code>index</code>ï¼Œå®ƒä½¿ç”¨äº†ä¸€ç§ç§°ä¸ºå€’æ’æ–‡ä»¶ï¼ˆinverted fileï¼‰çš„æ•°æ®ç»“æ„æ¥ç»„ç»‡å‘é‡æ•°æ®é›†ï¼Œå¹¶ä½¿ç”¨ <code>quantizer</code> æ¥å°†å‘é‡åˆ†é…åˆ°ä¸åŒçš„å­é›†ä¸­ã€‚è¿™ç§ç´¢å¼•ç»“æ„å¯ä»¥åŠ é€Ÿç›¸ä¼¼æ€§æœç´¢ï¼Œå¹¶ä¸”åœ¨å­˜å‚¨å¤§è§„æ¨¡å‘é‡æ•°æ®é›†æ—¶éå¸¸æœ‰æ•ˆã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">index.is_trained</span><br><span class="line">&gt;&gt; <span class="literal">False</span></span><br></pre></td></tr></tbody></table></figure><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">index.train(sentence_embeddings)</span><br><span class="line">index.is_trained</span><br><span class="line">&gt;&gt; <span class="literal">True</span></span><br></pre></td></tr></tbody></table></figure><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">index.add(sentence_embeddings)</span><br><span class="line">index.ntotal</span><br><span class="line">&gt;&gt; <span class="number">14504</span></span><br></pre></td></tr></tbody></table></figure><p>ç°åœ¨æˆ‘ä»¬çš„ç´¢å¼•å·²ç»è¿‡è®­ç»ƒï¼Œæˆ‘ä»¬å¯ä»¥åƒä»¥å‰ä¸€æ ·æ·»åŠ æ•°æ®ã€‚</p><p>è®©æˆ‘ä»¬ä½¿ç”¨ç›¸åŒçš„ç´¢å¼•å¥å­åµŒå…¥å’Œç›¸åŒçš„æŸ¥è¯¢å‘é‡å†æ¬¡æœç´¢<code>xq</code></p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">%%time</span><br><span class="line">D, I = index.search(xq, k)  <span class="comment"># search</span></span><br><span class="line"><span class="built_in">print</span>(I)</span><br></pre></td></tr></tbody></table></figure><h2 id="Quantization"><a href="#Quantization" class="headerlink" title="Quantization"></a><strong><strong>Quantization</strong></strong></h2><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬æ‰€æœ‰çš„ç´¢å¼•éƒ½å°†æˆ‘ä»¬çš„å‘é‡å­˜å‚¨ä¸ºå®Œæ•´çš„ï¼ˆä¾‹å¦‚<code>Flat</code>ï¼‰å‘é‡ã€‚ç°åœ¨ï¼Œåœ¨éå¸¸å¤§çš„æ•°æ®é›†ä¸­ï¼Œè¿™å¾ˆå¿«å°±ä¼šæˆä¸ºä¸€ä¸ªé—®é¢˜ã€‚</p><p>Faiss å…·æœ‰ä½¿ç”¨ä¹˜ç§¯é‡åŒ– (PQ)å‹ç¼©å‘é‡çš„èƒ½åŠ›ã€‚æˆ‘ä»¬å¯ä»¥å°†å…¶è§†ä¸ºä¸€ä¸ªé¢å¤–çš„è¿‘ä¼¼æ­¥éª¤ï¼Œå…¶ç»“æœä¸æˆ‘ä»¬ä½¿ç”¨IVFçš„ç»“æœç›¸ä¼¼ã€‚åœ¨ IVF å…è®¸æˆ‘ä»¬é€šè¿‡ç¼©å°æœç´¢èŒƒå›´è¿›è¡Œè¿‘ä¼¼çš„æƒ…å†µä¸‹ï¼ŒPQ æ”¹ä¸ºè¿‘ä¼¼è®¡ç®—è·ç¦»/ç›¸ä¼¼æ€§ã€‚</p><img src="/2023/02/23/Code%20Chronicles/FAISS%E5%90%91%E9%87%8F%E6%9F%A5%E8%AF%A2%E7%AE%80%E4%BB%8B/faiss3.png" class=""><ol><li>æˆ‘ä»¬å°†åŸå§‹å‘é‡æ‹†åˆ†ä¸ºå‡ ä¸ªå­å‘é‡ã€‚ </li><li>å¯¹äºæ¯ç»„å­å‘é‡ï¼Œæˆ‘ä»¬æ‰§è¡Œèšç±»æ“ä½œâ€”â€”ä¸ºæ¯ä¸ªå­å‘é‡é›†åˆ›å»ºå¤šä¸ªè´¨å¿ƒã€‚ </li><li>åœ¨å­å‘é‡ä¸­ï¼Œæˆ‘ä»¬ç”¨å®ƒæœ€è¿‘çš„ç‰¹å®šé›†åˆè´¨å¿ƒçš„ ID æ›¿æ¢æ¯ä¸ªå­å‘é‡</li></ol><p>æˆ‘ä»¬ä½¿ç”¨ <code>IndexIVFPQ</code> è®­ç»ƒç´¢å¼•â€”â€”åœ¨æ·»åŠ åµŒå…¥ä¹‹å‰æˆ‘ä»¬è¿˜éœ€è¦ç´¢å¼•</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">m = <span class="number">8</span>  <span class="comment"># number of centroid IDs in final compressed vectors</span></span><br><span class="line">bits = <span class="number">8</span> <span class="comment"># number of bits in each centroid</span></span><br><span class="line"></span><br><span class="line">quantizer = faiss.IndexFlatL2(d)  <span class="comment"># we keep the same L2 distance flat index</span></span><br><span class="line">index = faiss.IndexIVFPQ(quantizer, d, nlist, m, bits)</span><br></pre></td></tr></tbody></table></figure><p>**<code>m</code>**æ˜¯ä¸€ä¸ªæ•´æ•°å˜é‡ï¼Œè¡¨ç¤ºå¯¹æ¯ä¸ªå‘é‡è¿›è¡ŒçŸ¢é‡é‡åŒ–åï¼Œè¦ä¿ç•™çš„èšç±»ä¸­å¿ƒçš„æ•°é‡ã€‚èšç±»ä¸­å¿ƒæ˜¯é€šè¿‡ä½¿ç”¨ K-means èšç±»ç®—æ³•ä»å‘é‡æ•°æ®é›†ä¸­é€‰æ‹©çš„ä¸€ç»„ä»£è¡¨æ€§å‘é‡ï¼Œå¯ä»¥ç”¨æ¥è¿‘ä¼¼è¡¨ç¤ºåŸå§‹å‘é‡ã€‚</p><p>**<code>bits</code>**æ˜¯ä¸€ä¸ªæ•´æ•°å˜é‡ï¼Œç”¨äºæŒ‡å®šçŸ¢é‡é‡åŒ–åæ¯ä¸ªèšç±»ä¸­å¿ƒçš„ä½æ•°ã€‚è¾ƒé«˜çš„ <strong><code>bits</code></strong><br>å€¼å¯ä»¥æé«˜çŸ¢é‡é‡åŒ–çš„å‡†ç¡®æ€§ï¼Œä½†ä¹Ÿä¼šå¢åŠ å­˜å‚¨å’Œè®¡ç®—æˆæœ¬ã€‚</p><p>å¦å¤–ï¼Œ**<code>quantizer</code>** æ˜¯ä¸€ä¸ª Faiss ç´¢å¼•å¯¹è±¡ï¼Œç”¨äºå°†å‘é‡åˆ†é…åˆ° IVF ç´¢å¼•çš„å­é›†ä¸­ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨äº† Faiss æä¾›çš„ <strong><code>IndexFlatL2</code></strong> ç±»å‹ä½œä¸º **<code>quantizer</code>**ï¼Œå®ƒä½¿ç”¨æ¬§å‡ é‡Œå¾—è·ç¦»åº¦é‡æ¥è®¡ç®—å‘é‡ä¹‹é—´çš„ç›¸ä¼¼åº¦ï¼Œå¹¶å°†å‘é‡å­˜å‚¨åœ¨ä¸€ä¸ªå¹³é¢çš„ç´¢å¼•ç»“æ„ä¸­ã€‚</p><p>æœ€åï¼Œ**<code>index</code>** æ˜¯ä¸€ä¸ª Faiss ç´¢å¼•å¯¹è±¡ï¼Œç”¨äºæ”¯æŒåœ¨å‘é‡æ•°æ®é›†ä¸­è¿›è¡Œå¿«é€Ÿç›¸ä¼¼æ€§æœç´¢ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨äº† <strong><code>IndexIVFPQ</code></strong> ç±»å‹ä½œä¸º **<code>index</code>**ï¼Œå®ƒä½¿ç”¨äº†ä¸€ç§ç§°ä¸ºå€’æ’æ–‡ä»¶ï¼ˆinverted fileï¼‰çš„æ•°æ®ç»“æ„æ¥ç»„ç»‡å‘é‡æ•°æ®é›†ï¼Œå¹¶ä½¿ç”¨çŸ¢é‡é‡åŒ–å’Œä¹˜ç§¯é‡åŒ–ï¼ˆproduct quantizationï¼‰æŠ€æœ¯æ¥å‹ç¼©å‘é‡ã€‚è¿™ç§ç´¢å¼•ç»“æ„å¯ä»¥åŠ é€Ÿç›¸ä¼¼æ€§æœç´¢ï¼Œå¹¶ä¸”åœ¨å­˜å‚¨å¤§è§„æ¨¡å‘é‡æ•°æ®é›†æ—¶éå¸¸æœ‰æ•ˆã€‚</p><h2 id="Nearest-Neighbour-Indexes-for-Similarity-Search"><a href="#Nearest-Neighbour-Indexes-for-Similarity-Search" class="headerlink" title="Nearest Neighbour Indexes for Similarity Search"></a><strong><strong>Nearest Neighbour Indexes for Similarity Search</strong></strong></h2><h3 id="Flat"><a href="#Flat" class="headerlink" title="Flat"></a>Flat</h3><p>åº”è¯¥é¦–å…ˆæŸ¥çœ‹çš„ç´¢å¼•æ˜¯æœ€ç®€å•çš„â€”â€”å¹³é¢ç´¢å¼•ã€‚</p><p>Flatç´¢å¼•æ˜¯â€œå¹³é¢â€çš„ï¼Œæˆ‘ä»¬ä¸ä¿®æ”¹è¾“å…¥å‘é‡ã€‚ç”±äºå‘é‡æ²¡æœ‰è¿‘ä¼¼å€¼æˆ–èšç±»â€”â€”è¿™äº›ç´¢å¼•äº§ç”Ÿæœ€å‡†ç¡®çš„ç»“æœã€‚æˆ‘ä»¬æ‹¥æœ‰å®Œç¾çš„æœç´¢è´¨é‡ï¼Œä½†è¿™æ˜¯ä»¥å¤§é‡æœç´¢æ—¶é—´ä¸ºä»£ä»·çš„ã€‚ä½¿ç”¨Flatç´¢å¼•ï¼Œæˆ‘ä»¬å¼•å…¥æŸ¥è¯¢å‘é‡xqå¹¶å°†å…¶ä¸ç´¢å¼•ä¸­çš„æ‰€æœ‰å…¶ä»–å…¨å°ºå¯¸å‘é‡è¿›è¡Œæ¯”è¾ƒâ€”â€”è®¡ç®—åˆ°æ¯ä¸ªå‘é‡çš„è·ç¦»ã€‚</p><img src="/2023/02/23/Code%20Chronicles/FAISS%E5%90%91%E9%87%8F%E6%9F%A5%E8%AF%A2%E7%AE%80%E4%BB%8B/faiss4.png" class=""><p>ä½¿ç”¨Flatç´¢å¼•ï¼Œæˆ‘ä»¬å°†æœç´¢æŸ¥è¯¢<strong>xq</strong>ä¸ç´¢å¼•ä¸­çš„æ¯ä¸ªå…¶ä»–å‘é‡è¿›è¡Œæ¯”è¾ƒã€‚</p><p>åœ¨è®¡ç®—å®Œæ‰€æœ‰è¿™äº›è·ç¦»åï¼Œæˆ‘ä»¬å°†è¿”å›æœ€è¿‘çš„ k ä¸ªä½œä¸ºæˆ‘ä»¬æœ€è¿‘çš„åŒ¹é…é¡¹ã€‚<br>k æœ€è¿‘é‚» (kNN) æœç´¢ã€‚</p><img src="/2023/02/23/Code%20Chronicles/FAISS%E5%90%91%E9%87%8F%E6%9F%A5%E8%AF%A2%E7%AE%80%E4%BB%8B/faiss5.png" class=""><p>é‚£ä¹ˆä»€ä¹ˆæ—¶å€™åº”è¯¥ä½¿ç”¨æ‰å¹³ç´¢å¼•å‘¢ï¼Ÿå½“æœç´¢è´¨é‡æ— ç–‘æ˜¯ä¸€ä¸ªé«˜ä¼˜å…ˆçº§æ—¶â€”â€”æœç´¢é€Ÿåº¦å°±ä¸é‚£ä¹ˆé‡è¦äº†ã€‚æ­¤å¤–å¯¹äºè¾ƒå°çš„æ•°æ®é›†ï¼Œæœç´¢é€Ÿåº¦å¯èƒ½æ˜¯ä¸€ä¸ªæ— å…³ç´§è¦çš„å› ç´ â€”â€”å°¤å…¶æ˜¯åœ¨ä½¿ç”¨æ›´å¼ºå¤§çš„ç¡¬ä»¶æ—¶ã€‚</p><p>ç®€è€Œè¨€ä¹‹ï¼Œåœ¨ä»¥ä¸‹æƒ…å†µä¸‹ä½¿ç”¨å¹³é¢ç´¢å¼•ï¼š</p><ol><li>æœç´¢è´¨é‡æ˜¯ä¸€ä¸ªéå¸¸é«˜çš„ä¼˜å…ˆçº§ã€‚</li><li>æœç´¢æ—¶é—´æ— å…³ç´§è¦æˆ–ä½¿ç”¨å°ç´¢å¼•ï¼ˆ&lt;10Kï¼‰æ—¶ã€‚</li></ol><p>æ€æ ·æ‰èƒ½ä½¿æˆ‘ä»¬çš„æœç´¢æ›´å¿«å‘¢ï¼Ÿæœ‰ä¸¤ç§ä¸»è¦æ–¹æ³•ï¼š</p><ol><li>å‡å°‘å‘é‡å¤§å°â€”â€”é€šè¿‡é™ç»´æˆ–å‡å°‘è¡¨ç¤ºå‘é‡å€¼çš„ä½æ•°ã€‚</li><li>ç¼©å°æœç´¢èŒƒå›´â€”â€”æˆ‘ä»¬å¯ä»¥æ ¹æ®æŸäº›å±æ€§ã€ç›¸ä¼¼æ€§æˆ–è·ç¦»å°†å‘é‡èšç±»æˆ–ç»„ç»‡æˆæ ‘ç»“æ„â€”â€”å¹¶å°†æˆ‘ä»¬çš„æœç´¢é™åˆ¶åœ¨æœ€è¿‘çš„é›†ç¾¤æˆ–è¿‡æ»¤æœ€ç›¸ä¼¼çš„åˆ†æ”¯ã€‚</li></ol><p>ä½¿ç”¨è¿™ä¸¤ç§æ–¹æ³•ä¸­çš„ä»»ä½•ä¸€ç§éƒ½æ„å‘³ç€æˆ‘ä»¬ä¸å†æ‰§è¡Œè¯¦å°½çš„æœ€è¿‘é‚»æœç´¢ï¼Œè€Œæ˜¯æ‰§è¡Œè¿‘ä¼¼æœ€è¿‘é‚» (ANN) æœç´¢â€”â€”å› ä¸ºæˆ‘ä»¬ä¸å†æœç´¢æ•´ä¸ªå…¨æ•°æ®é›†ã€‚</p><h3 id="Locality-Sensitive-Hashing"><a href="#Locality-Sensitive-Hashing" class="headerlink" title="Locality Sensitive Hashing"></a><strong>Locality Sensitive Hashing</strong></h3><p>å±€éƒ¨æ•æ„Ÿå“ˆå¸Œï¼ˆLocality-Sensitive Hashingï¼ŒLSHï¼‰æ˜¯ä¸€ç§ç”¨äºåœ¨é«˜ç»´ç©ºé—´ä¸­å¿«é€Ÿè¿‘ä¼¼æœç´¢ç›¸ä¼¼å¯¹è±¡çš„æŠ€æœ¯ã€‚åœ¨å¾ˆå¤šç°å®ä¸–ç•Œçš„é—®é¢˜ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å¯¹é«˜ç»´å‘é‡ï¼ˆæ¯”å¦‚å›¾åƒã€éŸ³é¢‘ã€æ–‡æœ¬ç­‰ï¼‰è¿›è¡Œç›¸ä¼¼æ€§æœç´¢ï¼Œä½†æ˜¯ä¼ ç»Ÿçš„çº¿æ€§æœç´¢æ–¹æ³•åœ¨é«˜ç»´ç©ºé—´ä¸­æ•ˆç‡éå¸¸ä½ä¸‹ï¼Œå› ä¸ºéšç€ç»´åº¦çš„å¢åŠ ï¼Œæœç´¢çš„å¤æ‚åº¦å‘ˆæŒ‡æ•°çº§å¢é•¿ã€‚</p><p>LSHæ˜¯ä¸€ç§é€šè¿‡å“ˆå¸Œå‡½æ•°å°†ç›¸ä¼¼çš„å‘é‡æ˜ å°„åˆ°åŒä¸€ä¸ªâ€œæ¡¶â€ä¸­çš„æŠ€æœ¯ï¼Œå› æ­¤å¯ä»¥å¤§å¤§å‡å°‘éœ€è¦æ¯”è¾ƒçš„å‘é‡æ•°é‡ï¼Œä»è€Œæé«˜æœç´¢æ•ˆç‡ã€‚å…·ä½“æ¥è¯´ï¼ŒLSHå°†æ¯ä¸ªå‘é‡æ˜ å°„åˆ°å¤šä¸ªå“ˆå¸Œè¡¨ä¸­ï¼Œæ¯ä¸ªå“ˆå¸Œè¡¨ç”±å¤šä¸ªå“ˆå¸Œå‡½æ•°ç»„æˆã€‚å¯¹äºä¸€ä¸ªæŸ¥è¯¢å‘é‡ï¼ŒLSHä¼šå°†å…¶æ˜ å°„åˆ°æ¯ä¸ªå“ˆå¸Œè¡¨ä¸­ï¼Œç„¶ååªå¯¹åŒä¸€ä¸ªæ¡¶ä¸­çš„å‘é‡è¿›è¡Œç›¸ä¼¼æ€§æ¯”è¾ƒã€‚</p><p>LSHå¯ä»¥æ ¹æ®ä¸åŒçš„ç›¸ä¼¼æ€§åº¦é‡æ¥è®¾è®¡ä¸åŒçš„å“ˆå¸Œå‡½æ•°ï¼Œä¾‹å¦‚æ¬§å‡ é‡Œå¾—è·ç¦»ã€ä½™å¼¦ç›¸ä¼¼åº¦ç­‰ã€‚ä¸åŒçš„å“ˆå¸Œå‡½æ•°å¯ä»¥åœ¨ä¸åŒçš„ç©ºé—´ä¸­æ•æ‰åˆ°å‘é‡çš„ä¸åŒç‰¹å¾ï¼Œä»è€Œé€‚åº”ä¸åŒçš„åº”ç”¨åœºæ™¯ã€‚</p><p>å±€éƒ¨æ•æ„Ÿå“ˆå¸Œ (LSH) çš„å·¥ä½œåŸç†æ˜¯å°†å‘é‡åˆ†ç»„åˆ°æ¡¶ä¸­ï¼Œæ–¹æ³•æ˜¯é€šè¿‡å“ˆå¸Œå‡½æ•°å¤„ç†æ¯ä¸ªå‘é‡ï¼Œè¯¥å“ˆå¸Œå‡½æ•°æœ€å¤§åŒ–å“ˆå¸Œå†²çªï¼Œè€Œä¸æ˜¯åƒé€šå¸¸ä½¿ç”¨å“ˆå¸Œå‡½æ•°é‚£æ ·æœ€å°åŒ–ã€‚</p><p>è¿™æ„å‘³ç€ä»€ä¹ˆï¼Ÿå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ª Python å­—å…¸ã€‚å½“æˆ‘ä»¬åœ¨å­—å…¸ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„é”®å€¼å¯¹æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨æ•£åˆ—å‡½æ•°å¯¹é”®è¿›è¡Œæ•£åˆ—ã€‚è¿™ä¸ªé”®çš„å“ˆå¸Œå€¼å†³å®šäº†æˆ‘ä»¬å­˜å‚¨å…¶å„è‡ªå€¼çš„â€œæ¡¶â€ï¼š</p><img src="/2023/02/23/Code%20Chronicles/FAISS%E5%90%91%E9%87%8F%E6%9F%A5%E8%AF%A2%E7%AE%80%E4%BB%8B/faiss6.png" class=""><p>Python å­—å…¸æ˜¯å“ˆå¸Œè¡¨çš„ä¸€ä¸ªç¤ºä¾‹ï¼Œå®ƒä½¿ç”¨å…¸å‹çš„å“ˆå¸Œå‡½æ•°æ¥<em>æœ€å°åŒ–</em>å“ˆå¸Œå†²çªï¼Œå³ä¸¤ä¸ªä¸åŒå¯¹è±¡ï¼ˆé”®ï¼‰äº§ç”Ÿç›¸åŒå“ˆå¸Œçš„å“ˆå¸Œå†²çªã€‚</p><p>åœ¨æˆ‘ä»¬çš„å­—å…¸ä¸­ï¼Œæˆ‘ä»¬å¸Œæœ›é¿å…è¿™äº›å†²çªï¼Œå› ä¸ºè¿™æ„å‘³ç€æˆ‘ä»¬ä¼šå°†å¤šä¸ªå¯¹è±¡æ˜ å°„åˆ°ä¸€ä¸ªé”®â€”â€”ä½†å¯¹äº LSHï¼Œæˆ‘ä»¬å¸Œæœ›æœ€å¤§åŒ–<em>æ•£åˆ—</em>å†²çªã€‚</p><p>ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦æœ€å¤§åŒ–ç¢°æ’ï¼Ÿé‚£ä¹ˆï¼Œå¯¹äºæœç´¢ï¼Œæˆ‘ä»¬ä½¿ç”¨ LSH å°†ç›¸ä¼¼çš„å¯¹è±¡åˆ†ç»„åœ¨ä¸€èµ·ã€‚å½“æˆ‘ä»¬å¼•å…¥ä¸€ä¸ªæ–°çš„æŸ¥è¯¢å¯¹è±¡ï¼ˆæˆ–å‘é‡ï¼‰æ—¶ï¼Œæˆ‘ä»¬çš„ LSH ç®—æ³•å¯ä»¥ç”¨æ¥æ‰¾åˆ°æœ€æ¥è¿‘çš„åŒ¹é…ç»„ï¼š</p><img src="/2023/02/23/Code%20Chronicles/FAISS%E5%90%91%E9%87%8F%E6%9F%A5%E8%AF%A2%E7%AE%80%E4%BB%8B/faiss7.png" class=""><p>æˆ‘ä»¬çš„ LSH æ•£åˆ—å‡½æ•°è¯•å›¾æœ€å¤§åŒ–æ•£åˆ—å†²çªï¼Œäº§ç”Ÿå‘é‡åˆ†ç»„ã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">nbits = d*<span class="number">4</span>  <span class="comment"># resolution of bucketed vectors</span></span><br><span class="line"><span class="comment"># initialize index and add vectors</span></span><br><span class="line">index = faiss.IndexLSH(d, nbits)</span><br><span class="line">index.add(sentence_embeddings)</span><br><span class="line"><span class="comment"># and search</span></span><br><span class="line">D, I = index.search(xq, k)</span><br></pre></td></tr></tbody></table></figure><p>è¿™æ®µä»£ç ä½¿ç”¨äº†Faissåº“ä¸­çš„LSHç´¢å¼•ï¼Œå…¶ä¸­dæ˜¯å‘é‡çš„ç»´åº¦ï¼Œnbitsæ˜¯å“ˆå¸Œå€¼çš„ä½æ•°ï¼Œnbitsçš„å–å€¼é€šå¸¸æ˜¯dçš„æŸä¸ªå€æ•°ï¼Œè¿™é‡Œè®¾ç½®ä¸ºd*4ã€‚</p><p>åœ¨åˆå§‹åŒ–ç´¢å¼•åï¼Œä»£ç é€šè¿‡**<code>add</code><strong>æ–¹æ³•å°†æ‰€æœ‰çš„sentence embeddingsæ·»åŠ åˆ°LSHç´¢å¼•ä¸­ã€‚æ¥ä¸‹æ¥ï¼Œä»£ç é€šè¿‡</strong><code>search</code>**æ–¹æ³•åœ¨LSHç´¢å¼•ä¸­æœç´¢ä¸æŸ¥è¯¢å‘é‡xqæœ€ç›¸ä¼¼çš„kä¸ªå‘é‡ï¼Œè¿”å›çš„Dæ˜¯ç›¸ä¼¼åº¦åˆ†æ•°ï¼ŒIæ˜¯å¯¹åº”çš„å‘é‡ç´¢å¼•ã€‚</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒFaissçš„LSHç´¢å¼•ä½¿ç”¨å“ˆå¸Œå‡½æ•°å°†å‘é‡æ˜ å°„åˆ°æ¡¶ï¼ˆbucketï¼‰ä¸­ï¼Œæ¯ä¸ªæ¡¶ä¸­åŒ…å«ä¸€ç»„ç›¸ä¼¼çš„å‘é‡ã€‚å› æ­¤ï¼ŒLSHç´¢å¼•é€‚ç”¨äºé«˜ç»´ç¨€ç–å‘é‡çš„ç›¸ä¼¼æ€§æœç´¢ï¼Œå…¶ä¸­ç›¸ä¼¼å‘é‡é›†ä¸­åœ¨å°‘æ•°çš„æ¡¶ä¸­ï¼Œä»è€Œå‡å°‘æœç´¢çš„æ—¶é—´å¤æ‚åº¦ã€‚ä½†æ˜¯ï¼ŒLSHç´¢å¼•çš„å‡†ç¡®æ€§å¯èƒ½ä¼šå—åˆ°å“ˆå¸Œå†²çªçš„å½±å“ï¼Œéœ€è¦æ ¹æ®å…·ä½“çš„åº”ç”¨éœ€æ±‚è¿›è¡Œè°ƒæ•´ã€‚</p><p><code>nbits</code>æ˜¯æŒ‡æ•£åˆ—å‘é‡çš„â€œåˆ†è¾¨ç‡â€ã€‚æ›´é«˜çš„<code>nbits</code>å€¼æ„å‘³ç€æ›´é«˜çš„å‡†ç¡®æ€§ï¼Œä½†ä¼šå ç”¨æ›´å¤šçš„å†…å­˜å’Œæ›´æ…¢çš„æœç´¢é€Ÿåº¦ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œnbitsè¶Šå¤§ï¼Œå“ˆå¸Œè®¡ç®—å¤æ‚åº¦ä¹Ÿè¶Šé«˜ã€‚è¿™æ˜¯å› ä¸ºnbitsçš„å¢åŠ ä¼šä½¿å¾—å“ˆå¸Œå€¼ç©ºé—´å˜å¾—æ›´å¤§ï¼Œä»è€Œå¢åŠ è®¡ç®—å“ˆå¸Œå€¼æ‰€éœ€è¦çš„è¿ç®—é‡å’Œå­˜å‚¨ç©ºé—´ã€‚</p><h3 id="Hierarchical-Navigable-Small-World-Graphs"><a href="#Hierarchical-Navigable-Small-World-Graphs" class="headerlink" title="Hierarchical Navigable Small World Graphs"></a><strong><strong>Hierarchical Navigable Small World Graphs</strong></strong></h3><p>Hierarchical Navigable Small Worldï¼ˆHNSWï¼‰æ˜¯ä¸€ç§ç”¨äºé«˜ç»´å‘é‡ç´¢å¼•çš„ç®—æ³•ï¼Œæ—¨åœ¨æä¾›å¿«é€Ÿå’Œå‡†ç¡®çš„ç›¸ä¼¼åº¦æœç´¢ã€‚å®ƒæ˜¯åœ¨Small Worldç½‘ç»œå’ŒNavigable Small Worldç®—æ³•çš„åŸºç¡€ä¸Šè¿›ä¸€æ­¥å‘å±•è€Œæ¥çš„ã€‚</p><img src="/2023/02/23/Code%20Chronicles/FAISS%E5%90%91%E9%87%8F%E6%9F%A5%E8%AF%A2%E7%AE%80%E4%BB%8B/faiss8.png" class=""><p>HNSWç®—æ³•å°†é«˜ç»´ç©ºé—´ä¸­çš„å‘é‡è¡¨ç¤ºä¸ºèŠ‚ç‚¹ï¼Œå¹¶æ„å»ºä¸€æ£µæ ‘ç»“æ„æ¥ç»„ç»‡è¿™äº›èŠ‚ç‚¹ã€‚æ ‘ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½è¡¨ç¤ºä¸€ä¸ªå‘é‡ï¼Œå¹¶ä¿å­˜è¯¥å‘é‡åœ¨ç´¢å¼•ä¸­çš„ä½ç½®ä»¥åŠä¸å…¶ä»–èŠ‚ç‚¹çš„ç›¸ä¼¼åº¦ä¿¡æ¯ã€‚HNSWä½¿ç”¨è¿‘ä¼¼çš„ç›¸ä¼¼åº¦è®¡ç®—æ–¹æ³•æ¥è¿æ¥èŠ‚ç‚¹ï¼Œè¿™ä½¿å¾—æ ‘çš„ç»“æ„å¯ä»¥åœ¨é«˜ç»´ç©ºé—´ä¸­å¿«é€Ÿå¯¼èˆªã€‚</p><p>åœ¨æ„å»ºHNSWç´¢å¼•æ—¶ï¼Œé¦–å…ˆæ„å»ºä¸€ä¸ªç¨ å¯†çš„åˆå§‹å›¾ã€‚ç„¶åï¼Œå°†èŠ‚ç‚¹é€æ­¥æ·»åŠ åˆ°å›¾ä¸­ï¼Œå¹¶ä½¿ç”¨è¿‘ä¼¼çš„ç›¸ä¼¼åº¦è®¡ç®—æ–¹æ³•æ¥è¿æ¥èŠ‚ç‚¹ã€‚è¿™äº›è¿æ¥åœ¨ä¸åŒå±‚æ¬¡çš„æ ‘ç»“æ„ä¸­è¢«å»ºç«‹ï¼Œä»è€Œå½¢æˆäº†ä¸€ç»„å±‚æ¬¡ç»“æ„ã€‚HNSWä½¿ç”¨è¿™ç§å±‚æ¬¡ç»“æ„æ¥åŠ é€Ÿç›¸ä¼¼åº¦æœç´¢ï¼Œä»è€Œæé«˜äº†æœç´¢æ•ˆç‡ã€‚</p><img src="/2023/02/23/Code%20Chronicles/FAISS%E5%90%91%E9%87%8F%E6%9F%A5%E8%AF%A2%E7%AE%80%E4%BB%8B/faiss9.png" class=""><p>ç›¸æ¯”äºä¼ ç»Ÿçš„æ ‘å‹ç»“æ„å’Œçº¿æ€§æ‰«ææ–¹æ³•ï¼ŒHNSWå…·æœ‰æ›´é«˜çš„æœç´¢æ•ˆç‡å’Œæ›´å¥½çš„å¯æ‰©å±•æ€§ã€‚å®ƒåœ¨å¤§è§„æ¨¡é«˜ç»´å‘é‡çš„ç›¸ä¼¼åº¦æœç´¢ä»»åŠ¡ä¸­è¡¨ç°å‡ºè‰²ï¼Œå¹¶è¢«å¹¿æ³›åº”ç”¨äºå›¾åƒã€æ–‡æœ¬ã€è¯­éŸ³ç­‰é¢†åŸŸçš„æ•°æ®æŒ–æ˜å’Œæœºå™¨å­¦ä¹ ä»»åŠ¡ä¸­ã€‚</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># set HNSW index parameters</span></span><br><span class="line">M = <span class="number">64</span>  <span class="comment"># number of connections each vertex will have</span></span><br><span class="line">ef_search = <span class="number">32</span>  <span class="comment"># depth of layers explored during search</span></span><br><span class="line">ef_construction = <span class="number">64</span>  <span class="comment"># depth of layers explored during index construction</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># initialize index (d == 128)</span></span><br><span class="line">index = faiss.IndexHNSWFlat(d, M)</span><br><span class="line"><span class="comment"># set efConstruction and efSearch parameters</span></span><br><span class="line">index.hnsw.efConstruction = ef_construction</span><br><span class="line">index.hnsw.efSearch = ef_search</span><br><span class="line"><span class="comment"># add data to index</span></span><br><span class="line">index.add(wb)</span><br><span class="line"></span><br><span class="line"><span class="comment"># search as usual</span></span><br><span class="line">D, I = index.search(wb, k)</span><br></pre></td></tr></tbody></table></figure><p>è¿™æ®µä»£ç ä½¿ç”¨äº†HNSWç®—æ³•æ¥æ„å»ºé«˜ç»´å‘é‡çš„ç´¢å¼•ï¼Œå¹¶è¿›è¡Œç›¸ä¼¼åº¦æœç´¢ã€‚</p><p>å…¶ä¸­</p><ul><li><code>M</code>æ˜¯æ¯ä¸ªèŠ‚ç‚¹è¿æ¥çš„è¿‘é‚»æ•°ç›®ï¼Œå³æ¯ä¸ªèŠ‚ç‚¹åœ¨æ„å»ºç´¢å¼•æ—¶æœ€å¤šè¿æ¥Mä¸ªæœ€è¿‘é‚»èŠ‚ç‚¹ã€‚</li><li><code>ef_search</code>æ˜¯åœ¨æœç´¢æ—¶éå†çš„å±‚æ•°ï¼Œå³æœç´¢çš„æ·±åº¦ï¼Œ</li><li><code>ef_construction</code>æ˜¯åœ¨æ„å»ºç´¢å¼•æ—¶ä½¿ç”¨çš„éå†å±‚æ•°ã€‚</li></ul><p>è¿™äº›å‚æ•°å¯ä»¥è°ƒæ•´æ¥å¹³è¡¡æœç´¢æ—¶é—´å’Œç´¢å¼•æ„å»ºæ—¶é—´ä¹‹é—´çš„æƒè¡¡ã€‚</p><p><code>M</code>å’Œ<code>efSearch</code>å¯¹æœç´¢æ—¶é—´æœ‰æ›´å¤§çš„å½±å“ï¼›<code>efConstruction</code>ä¸»è¦æ˜¯å¢åŠ äº†ç´¢å¼•æ„å»ºæ—¶é—´ï¼ˆæ„å‘³ç€æ›´æ…¢index.addï¼‰</p><p>æ¥ä¸‹æ¥ï¼Œä½¿ç”¨<code>faiss.IndexHNSWFlat</code>åˆå§‹åŒ–HNSWç´¢å¼•ã€‚ç„¶åï¼Œå°†<code>efConstruction</code>å’Œ<code>efSearch</code>å‚æ•°è®¾ç½®ä¸ºé¢„å®šä¹‰çš„å€¼ã€‚æœ€åï¼Œä½¿ç”¨<code>index.add</code>æ–¹æ³•å°†å‘é‡æ•°æ®æ·»åŠ åˆ°ç´¢å¼•ä¸­ã€‚</p><p>æœ€åä¸€è¡Œä»£ç ä½¿ç”¨<code>index.search</code>æ–¹æ³•è¿›è¡Œæœç´¢ã€‚å®ƒä¼šè¿”å›æŸ¥è¯¢å‘é‡<code>wb</code>åœ¨ç´¢å¼•ä¸­çš„kä¸ªæœ€è¿‘é‚»å‘é‡çš„è·ç¦»å’Œç´¢å¼•ä½ç½®ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Code Chronicles </category>
          
      </categories>
      
      
        <tags>
            
            <tag> FAISS </tag>
            
            <tag> Embedding </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Intersection &amp; Union</title>
      <link href="/2023/02/20/Code%20Chronicles/Python-IntersectionUnion/"/>
      <url>/2023/02/20/Code%20Chronicles/Python-IntersectionUnion/</url>
      
        <content type="html"><![CDATA[<h1 id="Intersection-amp-Union"><a href="#Intersection-amp-Union" class="headerlink" title="Intersection &amp; Union"></a>Intersection &amp; Union</h1><p>äº¤é›†å’Œå¹¶é›†</p><h1 id="Intersection"><a href="#Intersection" class="headerlink" title="Intersection"></a>Intersection</h1><p>Pythonä¸­çš„<code>intersection()</code>æ–¹æ³•æ˜¯ç”¨äºè·å–ä¸¤ä¸ªé›†åˆçš„äº¤é›†ã€‚è¿™ä¸ªæ–¹æ³•æ˜¯setå¯¹è±¡çš„æ–¹æ³•ï¼Œå› æ­¤å®ƒåªèƒ½ç”¨äºsetå¯¹è±¡ä¸­ã€‚</p><p>å¦‚æœæ‚¨æƒ³åœ¨å…¶ä»–ç±»å‹çš„å®¹å™¨ä¸­è·å–äº¤é›†ï¼Œå¯ä»¥ä½¿ç”¨Pythonçš„å†…ç½®å‡½æ•°set()å°†å®ƒä»¬è½¬æ¢ä¸ºsetå¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç æ¥è·å–ä¸¤ä¸ªåˆ—è¡¨çš„äº¤é›†ï¼š</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line">b = [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]</span><br><span class="line">intersection = <span class="built_in">set</span>(a).intersection(<span class="built_in">set</span>(b))</span><br></pre></td></tr></tbody></table></figure><p>è¿™é‡Œï¼Œæˆ‘ä»¬é¦–å…ˆä½¿ç”¨set()å°†ä¸¤ä¸ªåˆ—è¡¨aå’Œbè½¬æ¢ä¸ºsetå¯¹è±¡ï¼Œç„¶åä½¿ç”¨intersection()æ–¹æ³•è·å–å®ƒä»¬çš„äº¤é›†ã€‚æ³¨æ„ï¼Œç”±äºé›†åˆæ˜¯æ— åºçš„ï¼Œå› æ­¤ç»“æœé›†åˆä¸­çš„å…ƒç´ é¡ºåºå¯èƒ½ä¸åŸå§‹åˆ—è¡¨ä¸­çš„é¡ºåºä¸åŒã€‚</p><p>é™¤äº†setå¯¹è±¡ä¹‹å¤–ï¼ŒPythonçš„å­—å…¸ç±»å‹ä¹Ÿå…·æœ‰ç±»ä¼¼çš„intersection()æ–¹æ³•ï¼Œç”¨äºè·å–ä¸¤ä¸ªå­—å…¸çš„ç›¸åŒé”®çš„äº¤é›†ï¼Œä½†è¿™ä¸ä¸Šè¿°æƒ…å†µä¸åŒã€‚</p><h1 id="Union"><a href="#Union" class="headerlink" title="Union"></a>Union</h1><p>å¦‚æœæƒ³è·å–ä¸¤ä¸ªå®¹å™¨çš„å¹¶é›†ï¼Œå¯ä»¥ä½¿ç”¨Pythonçš„å†…ç½®å‡½æ•°<code>set()</code>å°†å®ƒä»¬è½¬æ¢ä¸ºsetå¯¹è±¡ï¼Œç„¶åä½¿ç”¨<code>union()</code>æ–¹æ³•è·å–å®ƒä»¬çš„å¹¶é›†ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹ä»£ç å¯ä»¥è·å–ä¸¤ä¸ªåˆ—è¡¨çš„å¹¶é›†ï¼š</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line">b = [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]</span><br><span class="line">union = <span class="built_in">set</span>(a).union(<span class="built_in">set</span>(b))</span><br></pre></td></tr></tbody></table></figure><p>è¿™é‡Œï¼Œæˆ‘ä»¬é¦–å…ˆä½¿ç”¨<code>set()</code>å°†ä¸¤ä¸ªåˆ—è¡¨<code>a</code>å’Œ<code>b</code>è½¬æ¢ä¸º<code>set</code>å¯¹è±¡ï¼Œç„¶åä½¿ç”¨<code>union()</code>æ–¹æ³•è·å–å®ƒä»¬çš„å¹¶é›†ã€‚æ³¨æ„ï¼Œç”±äºé›†åˆæ˜¯æ— åºçš„ï¼Œå› æ­¤ç»“æœé›†åˆä¸­çš„å…ƒç´ é¡ºåºå¯èƒ½ä¸åŸå§‹åˆ—è¡¨ä¸­çš„é¡ºåºä¸åŒã€‚</p><p>é™¤äº†setå¯¹è±¡ä¹‹å¤–ï¼ŒPythonçš„å­—å…¸ç±»å‹ä¸æ”¯æŒå¹¶é›†æ“ä½œã€‚å¦‚æœæ‚¨éœ€è¦å¯¹å­—å…¸è¿›è¡Œå¹¶é›†æ“ä½œï¼Œå¯ä»¥å°†å…¶é”®æˆ–å€¼è½¬æ¢ä¸ºsetå¯¹è±¡ï¼Œç„¶åè¿›è¡Œé›†åˆæ“ä½œã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹ä»£ç å¯ä»¥è·å–ä¸¤ä¸ªå­—å…¸çš„é”®çš„å¹¶é›†ï¼š</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a = {<span class="string">'x'</span>: <span class="number">1</span>, <span class="string">'y'</span>: <span class="number">2</span>, <span class="string">'z'</span>: <span class="number">3</span>}</span><br><span class="line">b = {<span class="string">'z'</span>: <span class="number">4</span>, <span class="string">'w'</span>: <span class="number">5</span>}</span><br><span class="line">union = <span class="built_in">set</span>(a.keys()).union(<span class="built_in">set</span>(b.keys()))</span><br></pre></td></tr></tbody></table></figure><p>è¿™é‡Œï¼Œæˆ‘ä»¬å°†ä¸¤ä¸ªå­—å…¸çš„é”®è½¬æ¢ä¸ºsetå¯¹è±¡ï¼Œç„¶åä½¿ç”¨union()æ–¹æ³•è·å–å®ƒä»¬çš„å¹¶é›†ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Code Chronicles </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python Basic </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python -m å‚æ•°è§£é‡Š</title>
      <link href="/2023/02/01/Code%20Chronicles/Python%20-m%20%E5%8F%82%E6%95%B0%E8%A7%A3%E9%87%8A/"/>
      <url>/2023/02/01/Code%20Chronicles/Python%20-m%20%E5%8F%82%E6%95%B0%E8%A7%A3%E9%87%8A/</url>
      
        <content type="html"><![CDATA[<h1 id="Python-m-å‚æ•°è§£é‡Š"><a href="#Python-m-å‚æ•°è§£é‡Š" class="headerlink" title="Python -m å‚æ•°è§£é‡Š"></a>Python -m å‚æ•°è§£é‡Š</h1><h2 id="1-Python-m-å‚æ•°è§£é‡Š"><a href="#1-Python-m-å‚æ•°è§£é‡Š" class="headerlink" title="1. Python -m å‚æ•°è§£é‡Š"></a>1. Python -m å‚æ•°è§£é‡Š</h2><h3 id="åœ¨shellè°ƒç”¨æ—¶ï¼Œpython-mçš„å‚æ•°æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ"><a href="#åœ¨shellè°ƒç”¨æ—¶ï¼Œpython-mçš„å‚æ•°æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ" class="headerlink" title="åœ¨shellè°ƒç”¨æ—¶ï¼Œpython -mçš„å‚æ•°æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ"></a>åœ¨shellè°ƒç”¨æ—¶ï¼Œpython -mçš„å‚æ•°æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ</h3><p>å½“åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥ â€œpython -m <module-name>â€œ æ—¶ï¼Œè¿™è¡¨ç¤ºä½¿ç”¨Pythonçš„å†…ç½®æ¨¡å—è¿è¡Œç¨‹åºï¼Œå…¶ä¸­<module-name>æ˜¯è¦è¿è¡Œçš„æ¨¡å—çš„åç§°ã€‚è¿™ç±»ä¼¼äºåœ¨Pythonè„šæœ¬ä¸­ä½¿ç”¨ â€œimport <module-name>â€œ å¹¶è¿è¡Œ â€œmodule-name.run()â€ã€‚</module-name></module-name></module-name></p><p>ä¾‹å¦‚ï¼š â€œpython -m http.serverâ€ å°†å¯åŠ¨Pythonå†…ç½®çš„HTTPæœåŠ¡å™¨ï¼Œå¯ä»¥åœ¨æµè§ˆå™¨ä¸­è®¿é—®å½“å‰ç›®å½•ä¸­çš„æ–‡ä»¶ã€‚ â€œpython -m unittest discoverâ€ å°†åœ¨å½“å‰ç›®å½•ä¸­æŸ¥æ‰¾å¹¶è¿è¡Œæ‰€æœ‰ä»¥test_*.pyå‘½åçš„å•å…ƒæµ‹è¯•è„šæœ¬ã€‚</p><h3 id="module-name-run-éœ€è¦è‡ªå·±åœ¨æ¨¡å—ä¸­ç¼–å†™runå‡½æ•°å—ï¼Ÿ"><a href="#module-name-run-éœ€è¦è‡ªå·±åœ¨æ¨¡å—ä¸­ç¼–å†™runå‡½æ•°å—ï¼Ÿ" class="headerlink" title="module-name.run() éœ€è¦è‡ªå·±åœ¨æ¨¡å—ä¸­ç¼–å†™runå‡½æ•°å—ï¼Ÿ"></a>module-name.run() éœ€è¦è‡ªå·±åœ¨æ¨¡å—ä¸­ç¼–å†™runå‡½æ•°å—ï¼Ÿ</h3><p>ä¸éœ€è¦ã€‚åœ¨è°ƒç”¨ â€œpython -m <module-name>â€œ æ—¶ï¼ŒPythonä¼šè‡ªåŠ¨åœ¨æ¨¡å—ä¸­å¯»æ‰¾å¹¶è¿è¡Œåä¸º â€œrun()â€ çš„å‡½æ•°ã€‚å¦‚æœè¯¥å‡½æ•°ä¸å­˜åœ¨ï¼Œåˆ™ä¼šåœ¨æ¨¡å—ä¸­å¯»æ‰¾å¹¶è¿è¡Œåä¸º â€œmain()â€ çš„å‡½æ•°ã€‚</module-name></p><p>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå¦‚æœæ¨¡å—æ˜¯ä¸€ä¸ªå¯æ‰§è¡Œç¨‹åºï¼Œåˆ™åº”è¯¥åœ¨å…¶ä¸­ç¼–å†™ä¸€ä¸ªåä¸º â€œmain()â€ çš„å‡½æ•°ï¼Œå¹¶åœ¨è¯¥å‡½æ•°ä¸­ç¼–å†™ç¨‹åºé€»è¾‘ã€‚</p><p>å¦‚æœæ¨¡å—æ˜¯ä¸€ä¸ªåº“ï¼Œè€Œä¸æ˜¯å¯æ‰§è¡Œç¨‹åºï¼Œåˆ™ä¸éœ€è¦ç¼–å†™ â€œmain()â€ æˆ– â€œrun()â€ å‡½æ•°ã€‚è¿™äº›å‡½æ•°ä¸ä¼šè¢«è°ƒç”¨ï¼Œå› ä¸ºæ¨¡å—è¢«å¯¼å…¥æ—¶ï¼Œå…¶ä¸­çš„å‡½æ•°å’Œå˜é‡éƒ½å¯ä»¥åœ¨å…¶ä»–ä»£ç ä¸­è°ƒç”¨ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Code Chronicles </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python Basic </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python yield</title>
      <link href="/2023/02/01/Code%20Chronicles/Python-yield/"/>
      <url>/2023/02/01/Code%20Chronicles/Python-yield/</url>
      
        <content type="html"><![CDATA[<h1 id="Python-yield"><a href="#Python-yield" class="headerlink" title="Python yield"></a>Python yield</h1><p>åœ¨ Python ä¸­ï¼Œ**<code>yield</code>** æ˜¯ä¸€ä¸ªå…³é”®å­—ï¼Œå®ƒé€šå¸¸ç”¨äºç”Ÿæˆå™¨å‡½æ•°ä¸­ï¼Œç”¨äºç”Ÿæˆåºåˆ—åŒ–çš„å€¼è€Œä¸éœ€è¦å°†æ•´ä¸ªåºåˆ—ä¿å­˜åœ¨å†…å­˜ä¸­ã€‚</p><p>å½“å‡½æ•°è¢«è°ƒç”¨å¹¶åŒ…å« <strong><code>yield</code></strong> è¯­å¥æ—¶ï¼Œå®ƒå¹¶ä¸ä¼šç«‹å³æ‰§è¡Œå‡½æ•°ä½“çš„æ‰€æœ‰ä»£ç ã€‚ç›¸åï¼Œå®ƒå°†è¿”å›ä¸€ä¸ªç”Ÿæˆå™¨å¯¹è±¡ï¼Œæ¯æ¬¡è°ƒç”¨ç”Ÿæˆå™¨å¯¹è±¡çš„ <strong><code>__next__()</code></strong> æ–¹æ³•æ—¶ï¼Œå‡½æ•°ä½“å°†ä»ä¸Šæ¬¡ <strong><code>yield</code></strong> è¯­å¥åœæ­¢çš„ä½ç½®ç»§ç»­æ‰§è¡Œï¼Œç›´åˆ°é‡åˆ°ä¸‹ä¸€ä¸ª <strong><code>yield</code></strong> è¯­å¥æˆ–å‡½æ•°ç»“æŸã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œä¸‹é¢çš„ä»£ç å±•ç¤ºäº†ä¸€ä¸ªç®€å•çš„ç”Ÿæˆå™¨å‡½æ•°ï¼Œå®ƒä½¿ç”¨ <strong><code>yield</code></strong> è¯­å¥äº§ç”Ÿæ•°å­—åºåˆ—ï¼š</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">number_generator</span>(<span class="params">n</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        <span class="keyword">yield</span> i</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨ç”Ÿæˆå™¨å¯¹è±¡æ‰“å°æ•°å­—åºåˆ—</span></span><br><span class="line">my_generator = number_generator(<span class="number">5</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">next</span>(my_generator))  <span class="comment"># 0</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">next</span>(my_generator))  <span class="comment"># 1</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">next</span>(my_generator))  <span class="comment"># 2</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">next</span>(my_generator))  <span class="comment"># 3</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">next</span>(my_generator))  <span class="comment"># 4</span></span><br></pre></td></tr></tbody></table></figure><p>è¿™é‡Œï¼Œ**<code>number_generator()</code>** å‡½æ•°ä½¿ç”¨ <strong><code>yield</code></strong> è¯­å¥äº§ç”Ÿæ•°å­—åºåˆ—ã€‚å½“å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œå®ƒå°†è¿”å›ä¸€ä¸ªç”Ÿæˆå™¨å¯¹è±¡ **<code>my_generator</code>**ã€‚æ¯æ¬¡è°ƒç”¨ç”Ÿæˆå™¨å¯¹è±¡çš„ <strong><code>__next__()</code></strong> æ–¹æ³•æ—¶ï¼Œå‡½æ•°ä½“å°†ä»ä¸Šæ¬¡ <strong><code>yield</code></strong> è¯­å¥åœæ­¢çš„ä½ç½®ç»§ç»­æ‰§è¡Œï¼Œç›´åˆ°å‡½æ•°ç»“æŸæˆ–è€…å†æ¬¡é‡åˆ° <strong><code>yield</code></strong> è¯­å¥ã€‚ç”±äºç”Ÿæˆå™¨åªåœ¨éœ€è¦æ—¶æ‰äº§ç”Ÿå€¼ï¼Œå› æ­¤å¯ä»¥å‡å°‘å†…å­˜çš„å ç”¨ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Code Chronicles </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python Basic </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexoåšå®¢çš„åˆ›å»ºä¸éƒ¨ç½²</title>
      <link href="/2023/01/11/Tech%20Toolbox/Hexo%20%E5%8D%9A%E5%AE%A2%E7%9A%84%E5%88%9B%E5%BB%BA%E4%B8%8E%E9%83%A8%E7%BD%B2/"/>
      <url>/2023/01/11/Tech%20Toolbox/Hexo%20%E5%8D%9A%E5%AE%A2%E7%9A%84%E5%88%9B%E5%BB%BA%E4%B8%8E%E9%83%A8%E7%BD%B2/</url>
      
        <content type="html"><![CDATA[<p>ï¼ˆç”Ÿæ´»åæ€ï¼‰<br>ï¼ˆä»£ç ç¼–å¹´å²ï¼‰<br>ï¼ˆæµæµªç™–ç¬”è®°ï¼‰<br>NLP Insightsï¼ˆè‡ªç„¶è¯­è¨€å¤„ç†æ´å¯Ÿï¼‰<br>Tech Toolboxï¼ˆæŠ€æœ¯å·¥å…·ç®±ï¼‰<br>Travel Talesï¼ˆæ—…è¡Œæ•…äº‹ï¼‰<br>Debugging Diaries</p><blockquote><p>å‰è¨€ï¼šå¤§å®¶å¥½ï¼Œæˆ‘æ˜¯åšä¸»é»‘å¤´å‘†é±¼ã€‚ä¹‹å‰æˆ‘çš„æ—§ç”µè„‘é€€ä¼‘äº†ï¼Œè¿™å¯¼è‡´æˆ‘ä¹‹å‰åšå®¢çš„å†…å®¹æ‰¾ä¸åˆ°äº†ã€‚æ‰€ä»¥ï¼Œæˆ‘å†³å®šåœ¨æ–°åšå®¢çš„ç¬¬ä¸€ç¯‡æ–‡ç« ä¸­åˆ†äº«å¦‚ä½•åˆ›å»ºåšå®¢å¹¶ä¸Šä¼ æºä»£ç åˆ° GitHubã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬å¼€å§‹å§ï¼</p></blockquote><h1 id="Hexo-åšå®¢çš„åˆ›å»ºä¸éƒ¨ç½²"><a href="#Hexo-åšå®¢çš„åˆ›å»ºä¸éƒ¨ç½²" class="headerlink" title="Hexo åšå®¢çš„åˆ›å»ºä¸éƒ¨ç½²"></a>Hexo åšå®¢çš„åˆ›å»ºä¸éƒ¨ç½²</h1><p>ä»¥ä¸‹æ˜¯åˆ›å»ºæ–°çš„ Hexo åšå®¢å¹¶éƒ¨ç½²åˆ° GitHub çš„è¯¦ç»†æ­¥éª¤ï¼š</p><h2 id="å®‰è£…å‰ç½®è½¯ä»¶"><a href="#å®‰è£…å‰ç½®è½¯ä»¶" class="headerlink" title="å®‰è£…å‰ç½®è½¯ä»¶"></a>å®‰è£…å‰ç½®è½¯ä»¶</h2><h3 id="å®‰è£…-Node-js-å’Œ-npm"><a href="#å®‰è£…-Node-js-å’Œ-npm" class="headerlink" title="å®‰è£… Node.js å’Œ npm"></a>å®‰è£… Node.js å’Œ npm</h3><p>Hexo æ˜¯åŸºäº Node.js æ„å»ºçš„ï¼Œæ‰€ä»¥é¦–å…ˆä½ éœ€è¦å®‰è£… Node.js å’Œ npmï¼ˆNode åŒ…ç®¡ç†å™¨ï¼‰ã€‚è®¿é—® <a href="https://nodejs.org/">Node.js çš„å®˜æ–¹ç½‘ç«™</a> è¿›è¡Œä¸‹è½½å®‰è£…ã€‚</p><h3 id="å®‰è£…-Hexo"><a href="#å®‰è£…-Hexo" class="headerlink" title="å®‰è£… Hexo"></a>å®‰è£… Hexo</h3><p>åœ¨ Node.js å’Œ npm å®‰è£…å®Œæˆåï¼Œé€šè¿‡ npm å…¨å±€å®‰è£… Hexoã€‚åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g hexo-cli</span><br></pre></td></tr></tbody></table></figure><h2 id="åˆ›å»ºæ–°çš„-Hexo-åšå®¢"><a href="#åˆ›å»ºæ–°çš„-Hexo-åšå®¢" class="headerlink" title="åˆ›å»ºæ–°çš„ Hexo åšå®¢"></a>åˆ›å»ºæ–°çš„ Hexo åšå®¢</h2><h3 id="åˆå§‹åŒ–æ–°çš„-Hexo-åšå®¢"><a href="#åˆå§‹åŒ–æ–°çš„-Hexo-åšå®¢" class="headerlink" title="åˆå§‹åŒ–æ–°çš„ Hexo åšå®¢"></a>åˆå§‹åŒ–æ–°çš„ Hexo åšå®¢</h3><p>åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶å¤¹ä½œä¸ºä½ çš„åšå®¢çš„æ ¹ç›®å½•ï¼Œç„¶ååœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hexo init blog</span><br><span class="line"><span class="built_in">cd</span> blog</span><br></pre></td></tr></tbody></table></figure><p>è¿™å°†åœ¨ â€œblogâ€ æ–‡ä»¶å¤¹ä¸‹åˆ›å»ºä¸€ä¸ªæ–°çš„ Hexo åšå®¢ã€‚</p><h3 id="å®‰è£…åšå®¢ä¾èµ–"><a href="#å®‰è£…åšå®¢ä¾èµ–" class="headerlink" title="å®‰è£…åšå®¢ä¾èµ–"></a>å®‰è£…åšå®¢ä¾èµ–</h3><p>è¿›å…¥ä½ çš„åšå®¢ç›®å½•ï¼Œç„¶åè¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥å®‰è£…åšå®¢æ‰€éœ€çš„ä¾èµ–ï¼š</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install</span><br></pre></td></tr></tbody></table></figure><h2 id="é…ç½®ä½ çš„åšå®¢"><a href="#é…ç½®ä½ çš„åšå®¢" class="headerlink" title="é…ç½®ä½ çš„åšå®¢"></a>é…ç½®ä½ çš„åšå®¢</h2><h3 id="é…ç½®-Hexo"><a href="#é…ç½®-Hexo" class="headerlink" title="é…ç½® Hexo"></a>é…ç½® Hexo</h3><p>ä½¿ç”¨ä½ çš„æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€ <code>_config.yml</code> æ–‡ä»¶ï¼Œè¿™æ˜¯ Hexo åšå®¢çš„é…ç½®æ–‡ä»¶ã€‚ä½ éœ€è¦å°† <code>url</code> è®¾ç½®ä¸ºä½ çš„ GitHub Pages çš„ URLï¼ˆé€šå¸¸æ˜¯ <code>https://&lt;username&gt;.github.io</code>ï¼‰ï¼Œå¹¶ä¸”ä½ å¯èƒ½è¿˜æƒ³é…ç½®å…¶ä»–çš„ä¸€äº›é€‰é¡¹ï¼Œæ¯”å¦‚åšå®¢çš„æ ‡é¢˜ã€æè¿°å’Œä½œè€…ä¿¡æ¯ã€‚</p><h2 id="éƒ¨ç½²åˆ°-GitHub"><a href="#éƒ¨ç½²åˆ°-GitHub" class="headerlink" title="éƒ¨ç½²åˆ° GitHub"></a>éƒ¨ç½²åˆ° GitHub</h2><h3 id="å®‰è£…-Hexo-éƒ¨ç½²æ’ä»¶"><a href="#å®‰è£…-Hexo-éƒ¨ç½²æ’ä»¶" class="headerlink" title="å®‰è£… Hexo éƒ¨ç½²æ’ä»¶"></a>å®‰è£… Hexo éƒ¨ç½²æ’ä»¶</h3><p>é¦–å…ˆï¼Œä½ éœ€è¦å®‰è£… <code>hexo-deployer-git</code> æ’ä»¶ï¼Œè¿™ä¸ªæ’ä»¶å¯ä»¥è®©ä½ ç›´æ¥å°†ä½ çš„åšå®¢éƒ¨ç½²åˆ° GitHubã€‚åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥å®‰è£…ï¼š</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-deployer-git --save</span><br></pre></td></tr></tbody></table></figure><h3 id="é…ç½®éƒ¨ç½²å‚æ•°"><a href="#é…ç½®éƒ¨ç½²å‚æ•°" class="headerlink" title="é…ç½®éƒ¨ç½²å‚æ•°"></a>é…ç½®éƒ¨ç½²å‚æ•°</h3><p>åœ¨ <code>_config.yml</code> æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š</p><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">git</span></span><br><span class="line">  <span class="attr">repository:</span> <span class="string">git@github.com:&lt;username&gt;/&lt;username&gt;.github.io.git</span></span><br><span class="line">  <span class="attr">branch:</span> <span class="string">master</span></span><br></pre></td></tr></tbody></table></figure><p>å°† <code>&lt;username&gt;</code> æ›¿æ¢ä¸ºä½ çš„ GitHub ç”¨æˆ·åã€‚</p><h3 id="ç”Ÿæˆé™æ€æ–‡ä»¶å¹¶éƒ¨ç½²"><a href="#ç”Ÿæˆé™æ€æ–‡ä»¶å¹¶éƒ¨ç½²" class="headerlink" title="ç”Ÿæˆé™æ€æ–‡ä»¶å¹¶éƒ¨ç½²"></a>ç”Ÿæˆé™æ€æ–‡ä»¶å¹¶éƒ¨ç½²</h3><p>åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥ç”Ÿæˆé™æ€æ–‡ä»¶å¹¶å°†å®ƒä»¬éƒ¨ç½²åˆ° GitHubï¼š</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hexo generate</span><br><span class="line">hexo deploy</span><br></pre></td></tr></tbody></table></figure><p>æˆ–è€…ä½ å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å•ä¸ªå‘½ä»¤æ¥å®Œæˆè¿™ä¸¤ä¸ªæ­¥éª¤ï¼š</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo g -d</span><br></pre></td></tr></tbody></table></figure><h2 id="æ·»åŠ æ–°æ–‡ç« "><a href="#æ·»åŠ æ–°æ–‡ç« " class="headerlink" title="æ·»åŠ æ–°æ–‡ç« "></a>æ·»åŠ æ–°æ–‡ç« </h2><p>ä½ å¯ä»¥ä½¿ç”¨ Hexo çš„ <code>new</code> å‘½ä»¤æ¥å¿«é€Ÿåˆ›å»ºæ–°çš„æ–‡ç« ã€‚åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo new <span class="string">"æ–‡ç« æ ‡é¢˜"</span></span><br></pre></td></tr></tbody></table></figure><p>å°† â€œæ–‡ç« æ ‡é¢˜â€ æ›¿æ¢ä¸ºä½ æƒ³è¦çš„æ–‡ç« æ ‡é¢˜ã€‚è¿™å°†åœ¨ <code>source/_posts</code> ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ–°çš„ Markdown æ–‡ä»¶ï¼Œæ–‡ä»¶åå°±æ˜¯ä½ æŒ‡å®šçš„æ–‡ç« æ ‡é¢˜ï¼ˆæŠŠç©ºæ ¼æ›¿æ¢ä¸º <code>-</code>ï¼‰ã€‚</p><p>ä½ å¯ä»¥ä½¿ç”¨ä»»ä½•ä½ å–œæ¬¢çš„æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€è¿™ä¸ªæ–‡ä»¶ï¼Œå¹¶åœ¨é‡Œé¢å†™ä¸‹ä½ çš„æ–‡ç« å†…å®¹ã€‚Hexo ä½¿ç”¨ Markdown è¯­æ³•ï¼Œä½ å¯ä»¥æŸ¥çœ‹ <a href="https://markdown-zh.readthedocs.io/en/latest/">Markdown è¯­æ³•æ‰‹å†Œ</a> æ¥å­¦ä¹ å¦‚ä½•ä½¿ç”¨ Markdownã€‚</p><p>å®Œæˆåï¼Œä½ å¯ä»¥é‡æ–°ç”Ÿæˆå¹¶éƒ¨ç½²ä½ çš„åšå®¢ï¼Œæ–°çš„æ–‡ç« å°±ä¼šå‡ºç°åœ¨ä½ çš„åšå®¢ä¸Šäº†ã€‚</p><h2 id="æ–‡ç« åˆ†ç±»"><a href="#æ–‡ç« åˆ†ç±»" class="headerlink" title="æ–‡ç« åˆ†ç±»"></a>æ–‡ç« åˆ†ç±»</h2><p>ä½ å¯ä»¥åœ¨ä½ çš„æ–‡ç« ä¸­ä½¿ç”¨ YAML å‰ç½®è¯¾ï¼ˆFront-matterï¼‰æ¥ä¸ºæ–‡ç« åˆ†é…åˆ†ç±»ï¼ˆcategoriesï¼‰å’Œæ ‡ç­¾ï¼ˆtagsï¼‰ã€‚å‰ç½®è¯¾åº”è¯¥æ”¾åœ¨æ¯ç¯‡æ–‡ç« çš„é¡¶éƒ¨ï¼Œä¸¾ä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight markdown"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: æ–‡ç« æ ‡é¢˜</span><br><span class="line">date: 2023-07-06 00:00:00</span><br><span class="line">categories:</span><br><span class="line"><span class="bullet">-</span> åˆ†ç±»1</span><br><span class="line"><span class="bullet">-</span> åˆ†ç±»2</span><br><span class="line">tags:</span><br><span class="line"><span class="bullet">-</span> æ ‡ç­¾1</span><br><span class="line"><span class="section">- æ ‡ç­¾2</span></span><br><span class="line"><span class="section">---</span></span><br><span class="line"></span><br><span class="line">è¿™é‡Œæ˜¯æ–‡ç« çš„å†…å®¹ã€‚</span><br></pre></td></tr></tbody></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œè¿™ç¯‡æ–‡ç« è¢«åˆ†é…åˆ°äº† â€œåˆ†ç±»1â€ å’Œ â€œåˆ†ç±»2â€ è¿™ä¸¤ä¸ªåˆ†ç±»ï¼ŒåŒæ—¶ä¹Ÿè¢«åˆ†é…äº† â€œæ ‡ç­¾1â€ å’Œ â€œæ ‡ç­¾2â€ è¿™ä¸¤ä¸ªæ ‡ç­¾ã€‚</p><p>å½“ä½ ç”Ÿæˆä½ çš„åšå®¢æ—¶ï¼ŒHexo ä¼šè‡ªåŠ¨æ ¹æ®è¿™äº›åˆ†ç±»å’Œæ ‡ç­¾åˆ›å»ºç´¢å¼•ï¼Œè®¿é—®è€…å¯ä»¥é€šè¿‡åˆ†ç±»å’Œæ ‡ç­¾æ¥æŸ¥æ‰¾æ–‡ç« ã€‚</p><h2 id="å°†åšå®¢æºæ–‡ä»¶ä¿å­˜åˆ°-GitHub"><a href="#å°†åšå®¢æºæ–‡ä»¶ä¿å­˜åˆ°-GitHub" class="headerlink" title="å°†åšå®¢æºæ–‡ä»¶ä¿å­˜åˆ° GitHub"></a>å°†åšå®¢æºæ–‡ä»¶ä¿å­˜åˆ° GitHub</h2><h3 id="åˆ›å»ºä¸€ä¸ªæ–°çš„-GitHub-ä»“åº“"><a href="#åˆ›å»ºä¸€ä¸ªæ–°çš„-GitHub-ä»“åº“" class="headerlink" title="åˆ›å»ºä¸€ä¸ªæ–°çš„ GitHub ä»“åº“"></a>åˆ›å»ºä¸€ä¸ªæ–°çš„ GitHub ä»“åº“</h3><p>ç™»å½•åˆ°ä½ çš„ GitHub è´¦å·ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªæ–°çš„ä»“åº“ã€‚ä½ å¯ä»¥ç»™è¿™ä¸ªä»“åº“å–ä»»ä½•ä½ å–œæ¬¢çš„åå­—ï¼Œæ¯”å¦‚ <code>my-hexo-blog</code>ã€‚ä¸éœ€è¦åˆå§‹åŒ– READMEã€.gitignore æˆ–è€…è®¸å¯è¯ã€‚</p><h3 id="åˆå§‹åŒ–-Git"><a href="#åˆå§‹åŒ–-Git" class="headerlink" title="åˆå§‹åŒ– Git"></a>åˆå§‹åŒ– Git</h3><p>åœ¨ä½ çš„åšå®¢ç›®å½•ä¸­ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥åˆå§‹åŒ– Gitï¼š</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git init</span><br></pre></td></tr></tbody></table></figure><h3 id="æ·»åŠ æ‰€æœ‰æ–‡ä»¶åˆ°-Git"><a href="#æ·»åŠ æ‰€æœ‰æ–‡ä»¶åˆ°-Git" class="headerlink" title="æ·»åŠ æ‰€æœ‰æ–‡ä»¶åˆ° Git"></a>æ·»åŠ æ‰€æœ‰æ–‡ä»¶åˆ° Git</h3><p>è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥æ·»åŠ æ‰€æœ‰æ–‡ä»¶åˆ° Gitï¼š</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git add .</span><br></pre></td></tr></tbody></table></figure><h3 id="æäº¤ä½ çš„æ›´æ”¹"><a href="#æäº¤ä½ çš„æ›´æ”¹" class="headerlink" title="æäº¤ä½ çš„æ›´æ”¹"></a>æäº¤ä½ çš„æ›´æ”¹</h3><p>è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥æäº¤ä½ çš„æ›´æ”¹ï¼š</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git commit -m <span class="string">"Initial commit"</span></span><br></pre></td></tr></tbody></table></figure><h3 id="æ·»åŠ è¿œç¨‹ä»“åº“"><a href="#æ·»åŠ è¿œç¨‹ä»“åº“" class="headerlink" title="æ·»åŠ è¿œç¨‹ä»“åº“"></a>æ·»åŠ è¿œç¨‹ä»“åº“</h3><p>è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥æ·»åŠ ä½ åˆšæ‰åœ¨ GitHub ä¸Šåˆ›å»ºçš„ä»“åº“ä½œä¸ºè¿œç¨‹ä»“åº“ï¼š</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote add origin git@github.com:&lt;username&gt;/my-hexo-blog.git</span><br></pre></td></tr></tbody></table></figure><p>å°† <code>&lt;username&gt;</code> æ›¿æ¢ä¸ºä½ çš„ GitHub ç”¨æˆ·åã€‚</p><h3 id="æ¨é€åˆ°-GitHub"><a href="#æ¨é€åˆ°-GitHub" class="headerlink" title="æ¨é€åˆ° GitHub"></a>æ¨é€åˆ° GitHub</h3><p>è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥å°†ä½ çš„åšå®¢æºæ–‡ä»¶æ¨é€åˆ° GitHubï¼š</p><pre><code class="bash">git push -u origin master</code></pre><p>å®Œæˆè¿™äº›æ­¥éª¤åï¼Œä½ çš„ Hexo åšå®¢å°±å·²ç»éƒ¨ç½²åˆ° GitHub Pages ä¸Šäº†ã€‚ä½ å¯ä»¥è®¿é—® <code>https://&lt;username&gt;.github.io</code> æ¥æŸ¥çœ‹ä½ çš„åšå®¢ã€‚æœªæ¥æ¯æ¬¡ä½ æƒ³è¦æ·»åŠ æ–°çš„æ–‡ç« ï¼Œåªéœ€åœ¨ <code>source/_posts</code> ç›®å½•ä¸‹æ·»åŠ æ–°çš„ Markdown æ–‡ä»¶ï¼Œç„¶åé‡æ–°ç”Ÿæˆå¹¶éƒ¨ç½²ä½ çš„åšå®¢å°±å¯ä»¥äº†ã€‚</p><p>åœ¨æœªæ¥ï¼Œæ¯æ¬¡ä½ ä¿®æ”¹äº†åšå®¢æºæ–‡ä»¶ï¼ˆæ¯”å¦‚æ·»åŠ æ–°çš„æ–‡ç« ï¼‰ï¼Œä½ éƒ½éœ€è¦è¿è¡Œ <code>git add .</code>ï¼Œ<code>git commit -m "your message"</code> å’Œ <code>git push</code> å‘½ä»¤æ¥æ›´æ–°ä½ åœ¨ GitHub ä¸Šçš„å¤‡ä»½ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Tech Toolbox </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Blog </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å—æ´‹çš„æ¤°é£æµ·éŸµ</title>
      <link href="/2022/08/09/Wanderlust%20Adventures/%E5%8D%97%E6%B4%8B%E7%9A%84%E6%A4%B0%E9%A3%8E%E6%B5%B7%E9%9F%B5/"/>
      <url>/2022/08/09/Wanderlust%20Adventures/%E5%8D%97%E6%B4%8B%E7%9A%84%E6%A4%B0%E9%A3%8E%E6%B5%B7%E9%9F%B5/</url>
      
        <content type="html"><![CDATA[<h1 id="å—æ´‹çš„æ¤°é£æµ·éŸµ"><a href="#å—æ´‹çš„æ¤°é£æµ·éŸµ" class="headerlink" title="å—æ´‹çš„æ¤°é£æµ·éŸµ"></a>å—æ´‹çš„æ¤°é£æµ·éŸµ</h1><img src="/2022/08/09/Wanderlust%20Adventures/%E5%8D%97%E6%B4%8B%E7%9A%84%E6%A4%B0%E9%A3%8E%E6%B5%B7%E9%9F%B5/%E5%8D%97%E6%B4%8B%E7%9A%84%E6%A4%B0%E9%A3%8E%E6%B5%B7%E9%9F%B5.png" class="" title="å—æ´‹çš„æ¤°é£æµ·éŸµ"><p>è½»æŸ”çš„æ¤°é£ï¼Œå¹æ‹‚ç€å—æ´‹çš„æµ·æ»¨ï¼Œ<br>ç¿ ç»¿çš„æ£•æ¦ˆï¼ŒèˆåŠ¨åœ¨ç¢§è“çš„å¤©é™…ã€‚<br>å¤§æµ·çš„æ³¢æ¶›ï¼Œå¦‚æ­Œå¦‚æ³£ï¼Œè€³ç•”å›è¡ã€‚<br>æ½®èµ·æ½®è½é—´ï¼Œæ‚ è¿œæ¶›å£°å¦‚è¯—éŸµé¸£å“ï¼Œ</p><p>æ²¿ç€æµ·å²¸çº¿ï¼Œç™½è‰²æµªèŠ±è½»è½»æ‹¥æŠ±æ²™æ»©ï¼Œ<br>ç»†ç»†æ²™ç²’ï¼Œè„šä¸‹è½»è½»æ¶¦æ¹¿ã€‚<br>è¿œå¤„ç¤çŸ³ï¼Œé™é™å‡æœ›æµ·çš„æ— å°½è¾½é˜”ï¼Œ<br>ä»¿ä½›å¤è€æ™ºè€…ï¼Œå®ˆæŠ¤ç§˜å¯†ã€‚</p><p>å¤œå¹•é™ä¸´ï¼Œæ˜Ÿç©ºå¦‚ç’€ç’¨ç å®æ•£è½å¤©ç©¹ï¼Œ<br>æµ·é£å¸¦æ¥ç›ˆç›ˆæœˆå…‰ï¼Œå¦‚é“¶æ²³å€¾æ³»è€Œä¸‹ï¼Œ<br>æ¤°æ ‘æ‘‡æ›³ï¼Œå¸¦å…¥æ— è¾¹è¯—ç”»ï¼Œ<br>æ¢¦æƒ³å’Œå¸Œæœ›ï¼Œäº¤ç»‡æˆç¾ä¸½å›¾æ™¯ï¼Œ<br>æ°¸é“­å—æ´‹æ¤°é£æµ·éŸµï¼Œçµé­‚é©¿ç«™ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Wanderlust Adventures </category>
          
      </categories>
      
      
    </entry>
    
    
  
  
</search>
